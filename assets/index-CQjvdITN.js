(function(){const W=document.createElement("link").relList;if(W&&W.supports&&W.supports("modulepreload"))return;for(const Z of document.querySelectorAll('link[rel="modulepreload"]'))V(Z);new MutationObserver(Z=>{for(const re of Z)if(re.type==="childList")for(const se of re.addedNodes)se.tagName==="LINK"&&se.rel==="modulepreload"&&V(se)}).observe(document,{childList:!0,subtree:!0});function X(Z){const re={};return Z.integrity&&(re.integrity=Z.integrity),Z.referrerPolicy&&(re.referrerPolicy=Z.referrerPolicy),Z.crossOrigin==="use-credentials"?re.credentials="include":Z.crossOrigin==="anonymous"?re.credentials="omit":re.credentials="same-origin",re}function V(Z){if(Z.ep)return;Z.ep=!0;const re=X(Z);fetch(Z.href,re)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(G){return G&&G.__esModule&&Object.prototype.hasOwnProperty.call(G,"default")?G.default:G}function getAugmentedNamespace(G){if(G.__esModule)return G;var W=G.default;if(typeof W=="function"){var X=function V(){return this instanceof V?Reflect.construct(W,arguments,this.constructor):W.apply(this,arguments)};X.prototype=W.prototype}else X={};return Object.defineProperty(X,"__esModule",{value:!0}),Object.keys(G).forEach(function(V){var Z=Object.getOwnPropertyDescriptor(G,V);Object.defineProperty(X,V,Z.get?Z:{enumerable:!0,get:function(){return G[V]}})}),X}var check=function(G){return G&&G.Math===Math&&G},global$10=check(typeof globalThis=="object"&&globalThis)||check(typeof window=="object"&&window)||check(typeof self=="object"&&self)||check(typeof commonjsGlobal=="object"&&commonjsGlobal)||check(typeof commonjsGlobal=="object"&&commonjsGlobal)||function(){return this}()||Function("return this")(),objectGetOwnPropertyDescriptor={},fails$1p=function(G){try{return!!G()}catch{return!0}},fails$1o=fails$1p,descriptors=!fails$1o(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),fails$1n=fails$1p,functionBindNative=!fails$1n(function(){var G=(function(){}).bind();return typeof G!="function"||G.hasOwnProperty("prototype")}),NATIVE_BIND$4=functionBindNative,call$G=Function.prototype.call,functionCall=NATIVE_BIND$4?call$G.bind(call$G):function(){return call$G.apply(call$G,arguments)},objectPropertyIsEnumerable={},$propertyIsEnumerable$2={}.propertyIsEnumerable,getOwnPropertyDescriptor$9=Object.getOwnPropertyDescriptor,NASHORN_BUG=getOwnPropertyDescriptor$9&&!$propertyIsEnumerable$2.call({1:2},1);objectPropertyIsEnumerable.f=NASHORN_BUG?function(W){var X=getOwnPropertyDescriptor$9(this,W);return!!X&&X.enumerable}:$propertyIsEnumerable$2;var createPropertyDescriptor$c=function(G,W){return{enumerable:!(G&1),configurable:!(G&2),writable:!(G&4),value:W}},NATIVE_BIND$3=functionBindNative,FunctionPrototype$4=Function.prototype,call$F=FunctionPrototype$4.call,uncurryThisWithBind=NATIVE_BIND$3&&FunctionPrototype$4.bind.bind(call$F,call$F),functionUncurryThis=NATIVE_BIND$3?uncurryThisWithBind:function(G){return function(){return call$F.apply(G,arguments)}},uncurryThis$1r=functionUncurryThis,toString$G=uncurryThis$1r({}.toString),stringSlice$i=uncurryThis$1r("".slice),classofRaw$2=function(G){return stringSlice$i(toString$G(G),8,-1)},uncurryThis$1q=functionUncurryThis,fails$1m=fails$1p,classof$o=classofRaw$2,$Object$5=Object,split$3=uncurryThis$1q("".split),indexedObject=fails$1m(function(){return!$Object$5("z").propertyIsEnumerable(0)})?function(G){return classof$o(G)==="String"?split$3(G,""):$Object$5(G)}:$Object$5,isNullOrUndefined$f=function(G){return G==null},isNullOrUndefined$e=isNullOrUndefined$f,$TypeError$q=TypeError,requireObjectCoercible$n=function(G){if(isNullOrUndefined$e(G))throw new $TypeError$q("Can't call method on "+G);return G},IndexedObject$5=indexedObject,requireObjectCoercible$m=requireObjectCoercible$n,toIndexedObject$j=function(G){return IndexedObject$5(requireObjectCoercible$m(G))},documentAll=typeof document=="object"&&document.all,isCallable$y=typeof documentAll>"u"&&documentAll!==void 0?function(G){return typeof G=="function"||G===documentAll}:function(G){return typeof G=="function"},isCallable$x=isCallable$y,isObject$G=function(G){return typeof G=="object"?G!==null:isCallable$x(G)},global$$=global$10,isCallable$w=isCallable$y,aFunction=function(G){return isCallable$w(G)?G:void 0},getBuiltIn$p=function(G,W){return arguments.length<2?aFunction(global$$[G]):global$$[G]&&global$$[G][W]},uncurryThis$1p=functionUncurryThis,objectIsPrototypeOf=uncurryThis$1p({}.isPrototypeOf),engineUserAgent=typeof navigator<"u"&&String(navigator.userAgent)||"",global$_=global$10,userAgent$6=engineUserAgent,process$3=global$_.process,Deno$1=global$_.Deno,versions=process$3&&process$3.versions||Deno$1&&Deno$1.version,v8=versions&&versions.v8,match,version$1;v8&&(match=v8.split("."),version$1=match[0]>0&&match[0]<4?1:+(match[0]+match[1]));!version$1&&userAgent$6&&(match=userAgent$6.match(/Edge\/(\d+)/),(!match||match[1]>=74)&&(match=userAgent$6.match(/Chrome\/(\d+)/),match&&(version$1=+match[1])));var engineV8Version=version$1,V8_VERSION$3=engineV8Version,fails$1l=fails$1p,global$Z=global$10,$String$8=global$Z.String,symbolConstructorDetection=!!Object.getOwnPropertySymbols&&!fails$1l(function(){var G=Symbol("symbol detection");return!$String$8(G)||!(Object(G)instanceof Symbol)||!Symbol.sham&&V8_VERSION$3&&V8_VERSION$3<41}),NATIVE_SYMBOL$6=symbolConstructorDetection,useSymbolAsUid=NATIVE_SYMBOL$6&&!Symbol.sham&&typeof Symbol.iterator=="symbol",getBuiltIn$o=getBuiltIn$p,isCallable$v=isCallable$y,isPrototypeOf$c=objectIsPrototypeOf,USE_SYMBOL_AS_UID$1=useSymbolAsUid,$Object$4=Object,isSymbol$d=USE_SYMBOL_AS_UID$1?function(G){return typeof G=="symbol"}:function(G){var W=getBuiltIn$o("Symbol");return isCallable$v(W)&&isPrototypeOf$c(W.prototype,$Object$4(G))},$String$7=String,tryToString$7=function(G){try{return $String$7(G)}catch{return"Object"}},isCallable$u=isCallable$y,tryToString$6=tryToString$7,$TypeError$p=TypeError,aCallable$n=function(G){if(isCallable$u(G))return G;throw new $TypeError$p(tryToString$6(G)+" is not a function")},aCallable$m=aCallable$n,isNullOrUndefined$d=isNullOrUndefined$f,getMethod$9=function(G,W){var X=G[W];return isNullOrUndefined$d(X)?void 0:aCallable$m(X)},call$E=functionCall,isCallable$t=isCallable$y,isObject$F=isObject$G,$TypeError$o=TypeError,ordinaryToPrimitive$2=function(G,W){var X,V;if(W==="string"&&isCallable$t(X=G.toString)&&!isObject$F(V=call$E(X,G))||isCallable$t(X=G.valueOf)&&!isObject$F(V=call$E(X,G))||W!=="string"&&isCallable$t(X=G.toString)&&!isObject$F(V=call$E(X,G)))return V;throw new $TypeError$o("Can't convert object to primitive value")},sharedStore={exports:{}},isPure=!1,global$Y=global$10,defineProperty$h=Object.defineProperty,defineGlobalProperty$3=function(G,W){try{defineProperty$h(global$Y,G,{value:W,configurable:!0,writable:!0})}catch{global$Y[G]=W}return W},globalThis$1=global$10,defineGlobalProperty$2=defineGlobalProperty$3,SHARED="__core-js_shared__",store$3=sharedStore.exports=globalThis$1[SHARED]||defineGlobalProperty$2(SHARED,{});(store$3.versions||(store$3.versions=[])).push({version:"3.36.0",mode:"global",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.36.0/LICENSE",source:"https://github.com/zloirock/core-js"});var sharedStoreExports=sharedStore.exports,store$2=sharedStoreExports,shared$7=function(G,W){return store$2[G]||(store$2[G]=W||{})},requireObjectCoercible$l=requireObjectCoercible$n,$Object$3=Object,toObject$t=function(G){return $Object$3(requireObjectCoercible$l(G))},uncurryThis$1o=functionUncurryThis,toObject$s=toObject$t,hasOwnProperty$6=uncurryThis$1o({}.hasOwnProperty),hasOwnProperty_1=Object.hasOwn||function(W,X){return hasOwnProperty$6(toObject$s(W),X)},uncurryThis$1n=functionUncurryThis,id$2=0,postfix=Math.random(),toString$F=uncurryThis$1n(1 .toString),uid$6=function(G){return"Symbol("+(G===void 0?"":G)+")_"+toString$F(++id$2+postfix,36)},global$X=global$10,shared$6=shared$7,hasOwn$w=hasOwnProperty_1,uid$5=uid$6,NATIVE_SYMBOL$5=symbolConstructorDetection,USE_SYMBOL_AS_UID=useSymbolAsUid,Symbol$8=global$X.Symbol,WellKnownSymbolsStore$1=shared$6("wks"),createWellKnownSymbol=USE_SYMBOL_AS_UID?Symbol$8.for||Symbol$8:Symbol$8&&Symbol$8.withoutSetter||uid$5,wellKnownSymbol$z=function(G){return hasOwn$w(WellKnownSymbolsStore$1,G)||(WellKnownSymbolsStore$1[G]=NATIVE_SYMBOL$5&&hasOwn$w(Symbol$8,G)?Symbol$8[G]:createWellKnownSymbol("Symbol."+G)),WellKnownSymbolsStore$1[G]},call$D=functionCall,isObject$E=isObject$G,isSymbol$c=isSymbol$d,getMethod$8=getMethod$9,ordinaryToPrimitive$1=ordinaryToPrimitive$2,wellKnownSymbol$y=wellKnownSymbol$z,$TypeError$n=TypeError,TO_PRIMITIVE$1=wellKnownSymbol$y("toPrimitive"),toPrimitive$4=function(G,W){if(!isObject$E(G)||isSymbol$c(G))return G;var X=getMethod$8(G,TO_PRIMITIVE$1),V;if(X){if(W===void 0&&(W="default"),V=call$D(X,G,W),!isObject$E(V)||isSymbol$c(V))return V;throw new $TypeError$n("Can't convert object to primitive value")}return W===void 0&&(W="number"),ordinaryToPrimitive$1(G,W)},toPrimitive$3=toPrimitive$4,isSymbol$b=isSymbol$d,toPropertyKey$8=function(G){var W=toPrimitive$3(G,"string");return isSymbol$b(W)?W:W+""},global$W=global$10,isObject$D=isObject$G,document$3=global$W.document,EXISTS$1=isObject$D(document$3)&&isObject$D(document$3.createElement),documentCreateElement$2=function(G){return EXISTS$1?document$3.createElement(G):{}},DESCRIPTORS$M=descriptors,fails$1k=fails$1p,createElement$1=documentCreateElement$2,ie8DomDefine=!DESCRIPTORS$M&&!fails$1k(function(){return Object.defineProperty(createElement$1("div"),"a",{get:function(){return 7}}).a!==7}),DESCRIPTORS$L=descriptors,call$C=functionCall,propertyIsEnumerableModule$2=objectPropertyIsEnumerable,createPropertyDescriptor$b=createPropertyDescriptor$c,toIndexedObject$i=toIndexedObject$j,toPropertyKey$7=toPropertyKey$8,hasOwn$v=hasOwnProperty_1,IE8_DOM_DEFINE$1=ie8DomDefine,$getOwnPropertyDescriptor$2=Object.getOwnPropertyDescriptor;objectGetOwnPropertyDescriptor.f=DESCRIPTORS$L?$getOwnPropertyDescriptor$2:function(W,X){if(W=toIndexedObject$i(W),X=toPropertyKey$7(X),IE8_DOM_DEFINE$1)try{return $getOwnPropertyDescriptor$2(W,X)}catch{}if(hasOwn$v(W,X))return createPropertyDescriptor$b(!call$C(propertyIsEnumerableModule$2.f,W,X),W[X])};var objectDefineProperty={},DESCRIPTORS$K=descriptors,fails$1j=fails$1p,v8PrototypeDefineBug=DESCRIPTORS$K&&fails$1j(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),isObject$C=isObject$G,$String$6=String,$TypeError$m=TypeError,anObject$D=function(G){if(isObject$C(G))return G;throw new $TypeError$m($String$6(G)+" is not an object")},DESCRIPTORS$J=descriptors,IE8_DOM_DEFINE=ie8DomDefine,V8_PROTOTYPE_DEFINE_BUG$1=v8PrototypeDefineBug,anObject$C=anObject$D,toPropertyKey$6=toPropertyKey$8,$TypeError$l=TypeError,$defineProperty$1=Object.defineProperty,$getOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor,ENUMERABLE="enumerable",CONFIGURABLE$1="configurable",WRITABLE="writable";objectDefineProperty.f=DESCRIPTORS$J?V8_PROTOTYPE_DEFINE_BUG$1?function(W,X,V){if(anObject$C(W),X=toPropertyKey$6(X),anObject$C(V),typeof W=="function"&&X==="prototype"&&"value"in V&&WRITABLE in V&&!V[WRITABLE]){var Z=$getOwnPropertyDescriptor$1(W,X);Z&&Z[WRITABLE]&&(W[X]=V.value,V={configurable:CONFIGURABLE$1 in V?V[CONFIGURABLE$1]:Z[CONFIGURABLE$1],enumerable:ENUMERABLE in V?V[ENUMERABLE]:Z[ENUMERABLE],writable:!1})}return $defineProperty$1(W,X,V)}:$defineProperty$1:function(W,X,V){if(anObject$C(W),X=toPropertyKey$6(X),anObject$C(V),IE8_DOM_DEFINE)try{return $defineProperty$1(W,X,V)}catch{}if("get"in V||"set"in V)throw new $TypeError$l("Accessors not supported");return"value"in V&&(W[X]=V.value),W};var DESCRIPTORS$I=descriptors,definePropertyModule$b=objectDefineProperty,createPropertyDescriptor$a=createPropertyDescriptor$c,createNonEnumerableProperty$f=DESCRIPTORS$I?function(G,W,X){return definePropertyModule$b.f(G,W,createPropertyDescriptor$a(1,X))}:function(G,W,X){return G[W]=X,G},makeBuiltIn$4={exports:{}},DESCRIPTORS$H=descriptors,hasOwn$u=hasOwnProperty_1,FunctionPrototype$3=Function.prototype,getDescriptor=DESCRIPTORS$H&&Object.getOwnPropertyDescriptor,EXISTS=hasOwn$u(FunctionPrototype$3,"name"),PROPER=EXISTS&&(function(){}).name==="something",CONFIGURABLE=EXISTS&&(!DESCRIPTORS$H||DESCRIPTORS$H&&getDescriptor(FunctionPrototype$3,"name").configurable),functionName={EXISTS,PROPER,CONFIGURABLE},uncurryThis$1m=functionUncurryThis,isCallable$s=isCallable$y,store$1=sharedStoreExports,functionToString$2=uncurryThis$1m(Function.toString);isCallable$s(store$1.inspectSource)||(store$1.inspectSource=function(G){return functionToString$2(G)});var inspectSource$3=store$1.inspectSource,global$V=global$10,isCallable$r=isCallable$y,WeakMap$2=global$V.WeakMap,weakMapBasicDetection=isCallable$r(WeakMap$2)&&/native code/.test(String(WeakMap$2)),shared$5=shared$7,uid$4=uid$6,keys$2=shared$5("keys"),sharedKey$4=function(G){return keys$2[G]||(keys$2[G]=uid$4(G))},hiddenKeys$6={},NATIVE_WEAK_MAP$1=weakMapBasicDetection,global$U=global$10,isObject$B=isObject$G,createNonEnumerableProperty$e=createNonEnumerableProperty$f,hasOwn$t=hasOwnProperty_1,shared$4=sharedStoreExports,sharedKey$3=sharedKey$4,hiddenKeys$5=hiddenKeys$6,OBJECT_ALREADY_INITIALIZED="Object already initialized",TypeError$9=global$U.TypeError,WeakMap$1=global$U.WeakMap,set$4,get$3,has$2,enforce=function(G){return has$2(G)?get$3(G):set$4(G,{})},getterFor$1=function(G){return function(W){var X;if(!isObject$B(W)||(X=get$3(W)).type!==G)throw new TypeError$9("Incompatible receiver, "+G+" required");return X}};if(NATIVE_WEAK_MAP$1||shared$4.state){var store=shared$4.state||(shared$4.state=new WeakMap$1);store.get=store.get,store.has=store.has,store.set=store.set,set$4=function(G,W){if(store.has(G))throw new TypeError$9(OBJECT_ALREADY_INITIALIZED);return W.facade=G,store.set(G,W),W},get$3=function(G){return store.get(G)||{}},has$2=function(G){return store.has(G)}}else{var STATE=sharedKey$3("state");hiddenKeys$5[STATE]=!0,set$4=function(G,W){if(hasOwn$t(G,STATE))throw new TypeError$9(OBJECT_ALREADY_INITIALIZED);return W.facade=G,createNonEnumerableProperty$e(G,STATE,W),W},get$3=function(G){return hasOwn$t(G,STATE)?G[STATE]:{}},has$2=function(G){return hasOwn$t(G,STATE)}}var internalState={set:set$4,get:get$3,has:has$2,enforce,getterFor:getterFor$1},uncurryThis$1l=functionUncurryThis,fails$1i=fails$1p,isCallable$q=isCallable$y,hasOwn$s=hasOwnProperty_1,DESCRIPTORS$G=descriptors,CONFIGURABLE_FUNCTION_NAME$2=functionName.CONFIGURABLE,inspectSource$2=inspectSource$3,InternalStateModule$d=internalState,enforceInternalState$4=InternalStateModule$d.enforce,getInternalState$a=InternalStateModule$d.get,$String$5=String,defineProperty$g=Object.defineProperty,stringSlice$h=uncurryThis$1l("".slice),replace$c=uncurryThis$1l("".replace),join$8=uncurryThis$1l([].join),CONFIGURABLE_LENGTH=DESCRIPTORS$G&&!fails$1i(function(){return defineProperty$g(function(){},"length",{value:8}).length!==8}),TEMPLATE=String(String).split("String"),makeBuiltIn$3=makeBuiltIn$4.exports=function(G,W,X){stringSlice$h($String$5(W),0,7)==="Symbol("&&(W="["+replace$c($String$5(W),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),X&&X.getter&&(W="get "+W),X&&X.setter&&(W="set "+W),(!hasOwn$s(G,"name")||CONFIGURABLE_FUNCTION_NAME$2&&G.name!==W)&&(DESCRIPTORS$G?defineProperty$g(G,"name",{value:W,configurable:!0}):G.name=W),CONFIGURABLE_LENGTH&&X&&hasOwn$s(X,"arity")&&G.length!==X.arity&&defineProperty$g(G,"length",{value:X.arity});try{X&&hasOwn$s(X,"constructor")&&X.constructor?DESCRIPTORS$G&&defineProperty$g(G,"prototype",{writable:!1}):G.prototype&&(G.prototype=void 0)}catch{}var V=enforceInternalState$4(G);return hasOwn$s(V,"source")||(V.source=join$8(TEMPLATE,typeof W=="string"?W:"")),G};Function.prototype.toString=makeBuiltIn$3(function(){return isCallable$q(this)&&getInternalState$a(this).source||inspectSource$2(this)},"toString");var makeBuiltInExports=makeBuiltIn$4.exports,isCallable$p=isCallable$y,definePropertyModule$a=objectDefineProperty,makeBuiltIn$2=makeBuiltInExports,defineGlobalProperty$1=defineGlobalProperty$3,defineBuiltIn$o=function(G,W,X,V){V||(V={});var Z=V.enumerable,re=V.name!==void 0?V.name:W;if(isCallable$p(X)&&makeBuiltIn$2(X,re,V),V.global)Z?G[W]=X:defineGlobalProperty$1(W,X);else{try{V.unsafe?G[W]&&(Z=!0):delete G[W]}catch{}Z?G[W]=X:definePropertyModule$a.f(G,W,{value:X,enumerable:!1,configurable:!V.nonConfigurable,writable:!V.nonWritable})}return G},objectGetOwnPropertyNames={},ceil$1=Math.ceil,floor$a=Math.floor,mathTrunc=Math.trunc||function(W){var X=+W;return(X>0?floor$a:ceil$1)(X)},trunc$1=mathTrunc,toIntegerOrInfinity$l=function(G){var W=+G;return W!==W||W===0?0:trunc$1(W)},toIntegerOrInfinity$k=toIntegerOrInfinity$l,max$6=Math.max,min$b=Math.min,toAbsoluteIndex$9=function(G,W){var X=toIntegerOrInfinity$k(G);return X<0?max$6(X+W,0):min$b(X,W)},toIntegerOrInfinity$j=toIntegerOrInfinity$l,min$a=Math.min,toLength$d=function(G){var W=toIntegerOrInfinity$j(G);return W>0?min$a(W,9007199254740991):0},toLength$c=toLength$d,lengthOfArrayLike$s=function(G){return toLength$c(G.length)},toIndexedObject$h=toIndexedObject$j,toAbsoluteIndex$8=toAbsoluteIndex$9,lengthOfArrayLike$r=lengthOfArrayLike$s,createMethod$7=function(G){return function(W,X,V){var Z=toIndexedObject$h(W),re=lengthOfArrayLike$r(Z);if(re===0)return!G&&-1;var se=toAbsoluteIndex$8(V,re),ue;if(G&&X!==X){for(;re>se;)if(ue=Z[se++],ue!==ue)return!0}else for(;re>se;se++)if((G||se in Z)&&Z[se]===X)return G||se||0;return!G&&-1}},arrayIncludes={includes:createMethod$7(!0),indexOf:createMethod$7(!1)},uncurryThis$1k=functionUncurryThis,hasOwn$r=hasOwnProperty_1,toIndexedObject$g=toIndexedObject$j,indexOf$3=arrayIncludes.indexOf,hiddenKeys$4=hiddenKeys$6,push$h=uncurryThis$1k([].push),objectKeysInternal=function(G,W){var X=toIndexedObject$g(G),V=0,Z=[],re;for(re in X)!hasOwn$r(hiddenKeys$4,re)&&hasOwn$r(X,re)&&push$h(Z,re);for(;W.length>V;)hasOwn$r(X,re=W[V++])&&(~indexOf$3(Z,re)||push$h(Z,re));return Z},enumBugKeys$3=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],internalObjectKeys$1=objectKeysInternal,enumBugKeys$2=enumBugKeys$3,hiddenKeys$3=enumBugKeys$2.concat("length","prototype");objectGetOwnPropertyNames.f=Object.getOwnPropertyNames||function(W){return internalObjectKeys$1(W,hiddenKeys$3)};var objectGetOwnPropertySymbols={};objectGetOwnPropertySymbols.f=Object.getOwnPropertySymbols;var getBuiltIn$n=getBuiltIn$p,uncurryThis$1j=functionUncurryThis,getOwnPropertyNamesModule$2=objectGetOwnPropertyNames,getOwnPropertySymbolsModule$3=objectGetOwnPropertySymbols,anObject$B=anObject$D,concat$3=uncurryThis$1j([].concat),ownKeys$3=getBuiltIn$n("Reflect","ownKeys")||function(W){var X=getOwnPropertyNamesModule$2.f(anObject$B(W)),V=getOwnPropertySymbolsModule$3.f;return V?concat$3(X,V(W)):X},hasOwn$q=hasOwnProperty_1,ownKeys$2=ownKeys$3,getOwnPropertyDescriptorModule$6=objectGetOwnPropertyDescriptor,definePropertyModule$9=objectDefineProperty,copyConstructorProperties$6=function(G,W,X){for(var V=ownKeys$2(W),Z=definePropertyModule$9.f,re=getOwnPropertyDescriptorModule$6.f,se=0;se<V.length;se++){var ue=V[se];!hasOwn$q(G,ue)&&!(X&&hasOwn$q(X,ue))&&Z(G,ue,re(W,ue))}},fails$1h=fails$1p,isCallable$o=isCallable$y,replacement=/#|\.prototype\./,isForced$5=function(G,W){var X=data[normalize(G)];return X===POLYFILL?!0:X===NATIVE?!1:isCallable$o(W)?fails$1h(W):!!W},normalize=isForced$5.normalize=function(G){return String(G).replace(replacement,".").toLowerCase()},data=isForced$5.data={},NATIVE=isForced$5.NATIVE="N",POLYFILL=isForced$5.POLYFILL="P",isForced_1=isForced$5,global$T=global$10,getOwnPropertyDescriptor$8=objectGetOwnPropertyDescriptor.f,createNonEnumerableProperty$d=createNonEnumerableProperty$f,defineBuiltIn$n=defineBuiltIn$o,defineGlobalProperty=defineGlobalProperty$3,copyConstructorProperties$5=copyConstructorProperties$6,isForced$4=isForced_1,_export=function(G,W){var X=G.target,V=G.global,Z=G.stat,re,se,ue,H,ye,Ie;if(V?se=global$T:Z?se=global$T[X]||defineGlobalProperty(X,{}):se=global$T[X]&&global$T[X].prototype,se)for(ue in W){if(ye=W[ue],G.dontCallGetSet?(Ie=getOwnPropertyDescriptor$8(se,ue),H=Ie&&Ie.value):H=se[ue],re=isForced$4(V?ue:X+(Z?".":"#")+ue,G.forced),!re&&H!==void 0){if(typeof ye==typeof H)continue;copyConstructorProperties$5(ye,H)}(G.sham||H&&H.sham)&&createNonEnumerableProperty$d(ye,"sham",!0),defineBuiltIn$n(se,ue,ye,G)}},wellKnownSymbol$x=wellKnownSymbol$z,TO_STRING_TAG$4=wellKnownSymbol$x("toStringTag"),test$2={};test$2[TO_STRING_TAG$4]="z";var toStringTagSupport=String(test$2)==="[object z]",TO_STRING_TAG_SUPPORT$2=toStringTagSupport,isCallable$n=isCallable$y,classofRaw$1=classofRaw$2,wellKnownSymbol$w=wellKnownSymbol$z,TO_STRING_TAG$3=wellKnownSymbol$w("toStringTag"),$Object$2=Object,CORRECT_ARGUMENTS=classofRaw$1(function(){return arguments}())==="Arguments",tryGet=function(G,W){try{return G[W]}catch{}},classof$n=TO_STRING_TAG_SUPPORT$2?classofRaw$1:function(G){var W,X,V;return G===void 0?"Undefined":G===null?"Null":typeof(X=tryGet(W=$Object$2(G),TO_STRING_TAG$3))=="string"?X:CORRECT_ARGUMENTS?classofRaw$1(W):(V=classofRaw$1(W))==="Object"&&isCallable$n(W.callee)?"Arguments":V},classof$m=classof$n,$String$4=String,toString$E=function(G){if(classof$m(G)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return $String$4(G)},objectDefineProperties={},internalObjectKeys=objectKeysInternal,enumBugKeys$1=enumBugKeys$3,objectKeys$5=Object.keys||function(W){return internalObjectKeys(W,enumBugKeys$1)},DESCRIPTORS$F=descriptors,V8_PROTOTYPE_DEFINE_BUG=v8PrototypeDefineBug,definePropertyModule$8=objectDefineProperty,anObject$A=anObject$D,toIndexedObject$f=toIndexedObject$j,objectKeys$4=objectKeys$5;objectDefineProperties.f=DESCRIPTORS$F&&!V8_PROTOTYPE_DEFINE_BUG?Object.defineProperties:function(W,X){anObject$A(W);for(var V=toIndexedObject$f(X),Z=objectKeys$4(X),re=Z.length,se=0,ue;re>se;)definePropertyModule$8.f(W,ue=Z[se++],V[ue]);return W};var getBuiltIn$m=getBuiltIn$p,html$2=getBuiltIn$m("document","documentElement"),anObject$z=anObject$D,definePropertiesModule$1=objectDefineProperties,enumBugKeys=enumBugKeys$3,hiddenKeys$2=hiddenKeys$6,html$1=html$2,documentCreateElement$1=documentCreateElement$2,sharedKey$2=sharedKey$4,GT=">",LT="<",PROTOTYPE$2="prototype",SCRIPT="script",IE_PROTO$1=sharedKey$2("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(G){return LT+SCRIPT+GT+G+LT+"/"+SCRIPT+GT},NullProtoObjectViaActiveX=function(G){G.write(scriptTag("")),G.close();var W=G.parentWindow.Object;return G=null,W},NullProtoObjectViaIFrame=function(){var G=documentCreateElement$1("iframe"),W="java"+SCRIPT+":",X;return G.style.display="none",html$1.appendChild(G),G.src=String(W),X=G.contentWindow.document,X.open(),X.write(scriptTag("document.F=Object")),X.close(),X.F},activeXDocument,NullProtoObject=function(){try{activeXDocument=new ActiveXObject("htmlfile")}catch{}NullProtoObject=typeof document<"u"?document.domain&&activeXDocument?NullProtoObjectViaActiveX(activeXDocument):NullProtoObjectViaIFrame():NullProtoObjectViaActiveX(activeXDocument);for(var G=enumBugKeys.length;G--;)delete NullProtoObject[PROTOTYPE$2][enumBugKeys[G]];return NullProtoObject()};hiddenKeys$2[IE_PROTO$1]=!0;var objectCreate=Object.create||function(W,X){var V;return W!==null?(EmptyConstructor[PROTOTYPE$2]=anObject$z(W),V=new EmptyConstructor,EmptyConstructor[PROTOTYPE$2]=null,V[IE_PROTO$1]=W):V=NullProtoObject(),X===void 0?V:definePropertiesModule$1.f(V,X)},objectGetOwnPropertyNamesExternal={},uncurryThis$1i=functionUncurryThis,arraySlice$a=uncurryThis$1i([].slice),classof$l=classofRaw$2,toIndexedObject$e=toIndexedObject$j,$getOwnPropertyNames$1=objectGetOwnPropertyNames.f,arraySlice$9=arraySlice$a,windowNames=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],getWindowNames=function(G){try{return $getOwnPropertyNames$1(G)}catch{return arraySlice$9(windowNames)}};objectGetOwnPropertyNamesExternal.f=function(W){return windowNames&&classof$l(W)==="Window"?getWindowNames(W):$getOwnPropertyNames$1(toIndexedObject$e(W))};var makeBuiltIn$1=makeBuiltInExports,defineProperty$f=objectDefineProperty,defineBuiltInAccessor$i=function(G,W,X){return X.get&&makeBuiltIn$1(X.get,W,{getter:!0}),X.set&&makeBuiltIn$1(X.set,W,{setter:!0}),defineProperty$f.f(G,W,X)},wellKnownSymbolWrapped={},wellKnownSymbol$v=wellKnownSymbol$z;wellKnownSymbolWrapped.f=wellKnownSymbol$v;var global$S=global$10,path$2=global$S,path$1=path$2,hasOwn$p=hasOwnProperty_1,wrappedWellKnownSymbolModule$1=wellKnownSymbolWrapped,defineProperty$e=objectDefineProperty.f,wellKnownSymbolDefine=function(G){var W=path$1.Symbol||(path$1.Symbol={});hasOwn$p(W,G)||defineProperty$e(W,G,{value:wrappedWellKnownSymbolModule$1.f(G)})},call$B=functionCall,getBuiltIn$l=getBuiltIn$p,wellKnownSymbol$u=wellKnownSymbol$z,defineBuiltIn$m=defineBuiltIn$o,symbolDefineToPrimitive=function(){var G=getBuiltIn$l("Symbol"),W=G&&G.prototype,X=W&&W.valueOf,V=wellKnownSymbol$u("toPrimitive");W&&!W[V]&&defineBuiltIn$m(W,V,function(Z){return call$B(X,this)},{arity:1})},defineProperty$d=objectDefineProperty.f,hasOwn$o=hasOwnProperty_1,wellKnownSymbol$t=wellKnownSymbol$z,TO_STRING_TAG$2=wellKnownSymbol$t("toStringTag"),setToStringTag$e=function(G,W,X){G&&!X&&(G=G.prototype),G&&!hasOwn$o(G,TO_STRING_TAG$2)&&defineProperty$d(G,TO_STRING_TAG$2,{configurable:!0,value:W})},classofRaw=classofRaw$2,uncurryThis$1h=functionUncurryThis,functionUncurryThisClause=function(G){if(classofRaw(G)==="Function")return uncurryThis$1h(G)},uncurryThis$1g=functionUncurryThisClause,aCallable$l=aCallable$n,NATIVE_BIND$2=functionBindNative,bind$e=uncurryThis$1g(uncurryThis$1g.bind),functionBindContext=function(G,W){return aCallable$l(G),W===void 0?G:NATIVE_BIND$2?bind$e(G,W):function(){return G.apply(W,arguments)}},classof$k=classofRaw$2,isArray$g=Array.isArray||function(W){return classof$k(W)==="Array"},uncurryThis$1f=functionUncurryThis,fails$1g=fails$1p,isCallable$m=isCallable$y,classof$j=classof$n,getBuiltIn$k=getBuiltIn$p,inspectSource$1=inspectSource$3,noop$1=function(){},construct$1=getBuiltIn$k("Reflect","construct"),constructorRegExp=/^\s*(?:class|function)\b/,exec$9=uncurryThis$1f(constructorRegExp.exec),INCORRECT_TO_STRING$2=!constructorRegExp.test(noop$1),isConstructorModern=function(W){if(!isCallable$m(W))return!1;try{return construct$1(noop$1,[],W),!0}catch{return!1}},isConstructorLegacy=function(W){if(!isCallable$m(W))return!1;switch(classof$j(W)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return INCORRECT_TO_STRING$2||!!exec$9(constructorRegExp,inspectSource$1(W))}catch{return!0}};isConstructorLegacy.sham=!0;var isConstructor$6=!construct$1||fails$1g(function(){var G;return isConstructorModern(isConstructorModern.call)||!isConstructorModern(Object)||!isConstructorModern(function(){G=!0})||G})?isConstructorLegacy:isConstructorModern,isArray$f=isArray$g,isConstructor$5=isConstructor$6,isObject$A=isObject$G,wellKnownSymbol$s=wellKnownSymbol$z,SPECIES$6=wellKnownSymbol$s("species"),$Array$9=Array,arraySpeciesConstructor$1=function(G){var W;return isArray$f(G)&&(W=G.constructor,isConstructor$5(W)&&(W===$Array$9||isArray$f(W.prototype))?W=void 0:isObject$A(W)&&(W=W[SPECIES$6],W===null&&(W=void 0))),W===void 0?$Array$9:W},arraySpeciesConstructor=arraySpeciesConstructor$1,arraySpeciesCreate$5=function(G,W){return new(arraySpeciesConstructor(G))(W===0?0:W)},bind$d=functionBindContext,uncurryThis$1e=functionUncurryThis,IndexedObject$4=indexedObject,toObject$r=toObject$t,lengthOfArrayLike$q=lengthOfArrayLike$s,arraySpeciesCreate$4=arraySpeciesCreate$5,push$g=uncurryThis$1e([].push),createMethod$6=function(G){var W=G===1,X=G===2,V=G===3,Z=G===4,re=G===6,se=G===7,ue=G===5||re;return function(H,ye,Ie,Ee){for(var Fe=toObject$r(H),je=IndexedObject$4(Fe),mt=lengthOfArrayLike$q(je),wt=bind$d(ye,Ie),Ot=0,$t=Ee||arraySpeciesCreate$4,jt=W?$t(H,mt):X||se?$t(H,0):void 0,nr,sr;mt>Ot;Ot++)if((ue||Ot in je)&&(nr=je[Ot],sr=wt(nr,Ot,Fe),G))if(W)jt[Ot]=sr;else if(sr)switch(G){case 3:return!0;case 5:return nr;case 6:return Ot;case 2:push$g(jt,nr)}else switch(G){case 4:return!1;case 7:push$g(jt,nr)}return re?-1:V||Z?Z:jt}},arrayIteration={forEach:createMethod$6(0),map:createMethod$6(1),filter:createMethod$6(2),some:createMethod$6(3),every:createMethod$6(4),find:createMethod$6(5),findIndex:createMethod$6(6),filterReject:createMethod$6(7)},$$34=_export,global$R=global$10,call$A=functionCall,uncurryThis$1d=functionUncurryThis,DESCRIPTORS$E=descriptors,NATIVE_SYMBOL$4=symbolConstructorDetection,fails$1f=fails$1p,hasOwn$n=hasOwnProperty_1,isPrototypeOf$b=objectIsPrototypeOf,anObject$y=anObject$D,toIndexedObject$d=toIndexedObject$j,toPropertyKey$5=toPropertyKey$8,$toString$3=toString$E,createPropertyDescriptor$9=createPropertyDescriptor$c,nativeObjectCreate=objectCreate,objectKeys$3=objectKeys$5,getOwnPropertyNamesModule$1=objectGetOwnPropertyNames,getOwnPropertyNamesExternal=objectGetOwnPropertyNamesExternal,getOwnPropertySymbolsModule$2=objectGetOwnPropertySymbols,getOwnPropertyDescriptorModule$5=objectGetOwnPropertyDescriptor,definePropertyModule$7=objectDefineProperty,definePropertiesModule=objectDefineProperties,propertyIsEnumerableModule$1=objectPropertyIsEnumerable,defineBuiltIn$l=defineBuiltIn$o,defineBuiltInAccessor$h=defineBuiltInAccessor$i,shared$3=shared$7,sharedKey$1=sharedKey$4,hiddenKeys$1=hiddenKeys$6,uid$3=uid$6,wellKnownSymbol$r=wellKnownSymbol$z,wrappedWellKnownSymbolModule=wellKnownSymbolWrapped,defineWellKnownSymbol$d=wellKnownSymbolDefine,defineSymbolToPrimitive$1=symbolDefineToPrimitive,setToStringTag$d=setToStringTag$e,InternalStateModule$c=internalState,$forEach$2=arrayIteration.forEach,HIDDEN=sharedKey$1("hidden"),SYMBOL="Symbol",PROTOTYPE$1="prototype",setInternalState$b=InternalStateModule$c.set,getInternalState$9=InternalStateModule$c.getterFor(SYMBOL),ObjectPrototype$5=Object[PROTOTYPE$1],$Symbol=global$R.Symbol,SymbolPrototype$1=$Symbol&&$Symbol[PROTOTYPE$1],RangeError$4=global$R.RangeError,TypeError$8=global$R.TypeError,QObject=global$R.QObject,nativeGetOwnPropertyDescriptor$2=getOwnPropertyDescriptorModule$5.f,nativeDefineProperty$1=definePropertyModule$7.f,nativeGetOwnPropertyNames=getOwnPropertyNamesExternal.f,nativePropertyIsEnumerable=propertyIsEnumerableModule$1.f,push$f=uncurryThis$1d([].push),AllSymbols=shared$3("symbols"),ObjectPrototypeSymbols=shared$3("op-symbols"),WellKnownSymbolsStore=shared$3("wks"),USE_SETTER=!QObject||!QObject[PROTOTYPE$1]||!QObject[PROTOTYPE$1].findChild,fallbackDefineProperty=function(G,W,X){var V=nativeGetOwnPropertyDescriptor$2(ObjectPrototype$5,W);V&&delete ObjectPrototype$5[W],nativeDefineProperty$1(G,W,X),V&&G!==ObjectPrototype$5&&nativeDefineProperty$1(ObjectPrototype$5,W,V)},setSymbolDescriptor=DESCRIPTORS$E&&fails$1f(function(){return nativeObjectCreate(nativeDefineProperty$1({},"a",{get:function(){return nativeDefineProperty$1(this,"a",{value:7}).a}})).a!==7})?fallbackDefineProperty:nativeDefineProperty$1,wrap=function(G,W){var X=AllSymbols[G]=nativeObjectCreate(SymbolPrototype$1);return setInternalState$b(X,{type:SYMBOL,tag:G,description:W}),DESCRIPTORS$E||(X.description=W),X},$defineProperty=function(W,X,V){W===ObjectPrototype$5&&$defineProperty(ObjectPrototypeSymbols,X,V),anObject$y(W);var Z=toPropertyKey$5(X);return anObject$y(V),hasOwn$n(AllSymbols,Z)?(V.enumerable?(hasOwn$n(W,HIDDEN)&&W[HIDDEN][Z]&&(W[HIDDEN][Z]=!1),V=nativeObjectCreate(V,{enumerable:createPropertyDescriptor$9(0,!1)})):(hasOwn$n(W,HIDDEN)||nativeDefineProperty$1(W,HIDDEN,createPropertyDescriptor$9(1,nativeObjectCreate(null))),W[HIDDEN][Z]=!0),setSymbolDescriptor(W,Z,V)):nativeDefineProperty$1(W,Z,V)},$defineProperties=function(W,X){anObject$y(W);var V=toIndexedObject$d(X),Z=objectKeys$3(V).concat($getOwnPropertySymbols(V));return $forEach$2(Z,function(re){(!DESCRIPTORS$E||call$A($propertyIsEnumerable$1,V,re))&&$defineProperty(W,re,V[re])}),W},$create=function(W,X){return X===void 0?nativeObjectCreate(W):$defineProperties(nativeObjectCreate(W),X)},$propertyIsEnumerable$1=function(W){var X=toPropertyKey$5(W),V=call$A(nativePropertyIsEnumerable,this,X);return this===ObjectPrototype$5&&hasOwn$n(AllSymbols,X)&&!hasOwn$n(ObjectPrototypeSymbols,X)?!1:V||!hasOwn$n(this,X)||!hasOwn$n(AllSymbols,X)||hasOwn$n(this,HIDDEN)&&this[HIDDEN][X]?V:!0},$getOwnPropertyDescriptor=function(W,X){var V=toIndexedObject$d(W),Z=toPropertyKey$5(X);if(!(V===ObjectPrototype$5&&hasOwn$n(AllSymbols,Z)&&!hasOwn$n(ObjectPrototypeSymbols,Z))){var re=nativeGetOwnPropertyDescriptor$2(V,Z);return re&&hasOwn$n(AllSymbols,Z)&&!(hasOwn$n(V,HIDDEN)&&V[HIDDEN][Z])&&(re.enumerable=!0),re}},$getOwnPropertyNames=function(W){var X=nativeGetOwnPropertyNames(toIndexedObject$d(W)),V=[];return $forEach$2(X,function(Z){!hasOwn$n(AllSymbols,Z)&&!hasOwn$n(hiddenKeys$1,Z)&&push$f(V,Z)}),V},$getOwnPropertySymbols=function(G){var W=G===ObjectPrototype$5,X=nativeGetOwnPropertyNames(W?ObjectPrototypeSymbols:toIndexedObject$d(G)),V=[];return $forEach$2(X,function(Z){hasOwn$n(AllSymbols,Z)&&(!W||hasOwn$n(ObjectPrototype$5,Z))&&push$f(V,AllSymbols[Z])}),V};NATIVE_SYMBOL$4||($Symbol=function(){if(isPrototypeOf$b(SymbolPrototype$1,this))throw new TypeError$8("Symbol is not a constructor");var W=!arguments.length||arguments[0]===void 0?void 0:$toString$3(arguments[0]),X=uid$3(W),V=function(Z){var re=this===void 0?global$R:this;re===ObjectPrototype$5&&call$A(V,ObjectPrototypeSymbols,Z),hasOwn$n(re,HIDDEN)&&hasOwn$n(re[HIDDEN],X)&&(re[HIDDEN][X]=!1);var se=createPropertyDescriptor$9(1,Z);try{setSymbolDescriptor(re,X,se)}catch(ue){if(!(ue instanceof RangeError$4))throw ue;fallbackDefineProperty(re,X,se)}};return DESCRIPTORS$E&&USE_SETTER&&setSymbolDescriptor(ObjectPrototype$5,X,{configurable:!0,set:V}),wrap(X,W)},SymbolPrototype$1=$Symbol[PROTOTYPE$1],defineBuiltIn$l(SymbolPrototype$1,"toString",function(){return getInternalState$9(this).tag}),defineBuiltIn$l($Symbol,"withoutSetter",function(G){return wrap(uid$3(G),G)}),propertyIsEnumerableModule$1.f=$propertyIsEnumerable$1,definePropertyModule$7.f=$defineProperty,definePropertiesModule.f=$defineProperties,getOwnPropertyDescriptorModule$5.f=$getOwnPropertyDescriptor,getOwnPropertyNamesModule$1.f=getOwnPropertyNamesExternal.f=$getOwnPropertyNames,getOwnPropertySymbolsModule$2.f=$getOwnPropertySymbols,wrappedWellKnownSymbolModule.f=function(G){return wrap(wellKnownSymbol$r(G),G)},DESCRIPTORS$E&&(defineBuiltInAccessor$h(SymbolPrototype$1,"description",{configurable:!0,get:function(){return getInternalState$9(this).description}}),defineBuiltIn$l(ObjectPrototype$5,"propertyIsEnumerable",$propertyIsEnumerable$1,{unsafe:!0})));$$34({global:!0,constructor:!0,wrap:!0,forced:!NATIVE_SYMBOL$4,sham:!NATIVE_SYMBOL$4},{Symbol:$Symbol});$forEach$2(objectKeys$3(WellKnownSymbolsStore),function(G){defineWellKnownSymbol$d(G)});$$34({target:SYMBOL,stat:!0,forced:!NATIVE_SYMBOL$4},{useSetter:function(){USE_SETTER=!0},useSimple:function(){USE_SETTER=!1}});$$34({target:"Object",stat:!0,forced:!NATIVE_SYMBOL$4,sham:!DESCRIPTORS$E},{create:$create,defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor});$$34({target:"Object",stat:!0,forced:!NATIVE_SYMBOL$4},{getOwnPropertyNames:$getOwnPropertyNames});defineSymbolToPrimitive$1();setToStringTag$d($Symbol,SYMBOL);hiddenKeys$1[HIDDEN]=!0;var NATIVE_SYMBOL$3=symbolConstructorDetection,symbolRegistryDetection=NATIVE_SYMBOL$3&&!!Symbol.for&&!!Symbol.keyFor,$$33=_export,getBuiltIn$j=getBuiltIn$p,hasOwn$m=hasOwnProperty_1,toString$D=toString$E,shared$2=shared$7,NATIVE_SYMBOL_REGISTRY$1=symbolRegistryDetection,StringToSymbolRegistry=shared$2("string-to-symbol-registry"),SymbolToStringRegistry$1=shared$2("symbol-to-string-registry");$$33({target:"Symbol",stat:!0,forced:!NATIVE_SYMBOL_REGISTRY$1},{for:function(G){var W=toString$D(G);if(hasOwn$m(StringToSymbolRegistry,W))return StringToSymbolRegistry[W];var X=getBuiltIn$j("Symbol")(W);return StringToSymbolRegistry[W]=X,SymbolToStringRegistry$1[X]=W,X}});var $$32=_export,hasOwn$l=hasOwnProperty_1,isSymbol$a=isSymbol$d,tryToString$5=tryToString$7,shared$1=shared$7,NATIVE_SYMBOL_REGISTRY=symbolRegistryDetection,SymbolToStringRegistry=shared$1("symbol-to-string-registry");$$32({target:"Symbol",stat:!0,forced:!NATIVE_SYMBOL_REGISTRY},{keyFor:function(W){if(!isSymbol$a(W))throw new TypeError(tryToString$5(W)+" is not a symbol");if(hasOwn$l(SymbolToStringRegistry,W))return SymbolToStringRegistry[W]}});var NATIVE_BIND$1=functionBindNative,FunctionPrototype$2=Function.prototype,apply$c=FunctionPrototype$2.apply,call$z=FunctionPrototype$2.call,functionApply$1=typeof Reflect=="object"&&Reflect.apply||(NATIVE_BIND$1?call$z.bind(apply$c):function(){return call$z.apply(apply$c,arguments)}),uncurryThis$1c=functionUncurryThis,isArray$e=isArray$g,isCallable$l=isCallable$y,classof$i=classofRaw$2,toString$C=toString$E,push$e=uncurryThis$1c([].push),getJsonReplacerFunction=function(G){if(isCallable$l(G))return G;if(isArray$e(G)){for(var W=G.length,X=[],V=0;V<W;V++){var Z=G[V];typeof Z=="string"?push$e(X,Z):(typeof Z=="number"||classof$i(Z)==="Number"||classof$i(Z)==="String")&&push$e(X,toString$C(Z))}var re=X.length,se=!0;return function(ue,H){if(se)return se=!1,H;if(isArray$e(this))return H;for(var ye=0;ye<re;ye++)if(X[ye]===ue)return H}}},$$31=_export,getBuiltIn$i=getBuiltIn$p,apply$b=functionApply$1,call$y=functionCall,uncurryThis$1b=functionUncurryThis,fails$1e=fails$1p,isCallable$k=isCallable$y,isSymbol$9=isSymbol$d,arraySlice$8=arraySlice$a,getReplacerFunction=getJsonReplacerFunction,NATIVE_SYMBOL$2=symbolConstructorDetection,$String$3=String,$stringify=getBuiltIn$i("JSON","stringify"),exec$8=uncurryThis$1b(/./.exec),charAt$f=uncurryThis$1b("".charAt),charCodeAt$7=uncurryThis$1b("".charCodeAt),replace$b=uncurryThis$1b("".replace),numberToString$2=uncurryThis$1b(1 .toString),tester=/[\uD800-\uDFFF]/g,low=/^[\uD800-\uDBFF]$/,hi=/^[\uDC00-\uDFFF]$/,WRONG_SYMBOLS_CONVERSION=!NATIVE_SYMBOL$2||fails$1e(function(){var G=getBuiltIn$i("Symbol")("stringify detection");return $stringify([G])!=="[null]"||$stringify({a:G})!=="{}"||$stringify(Object(G))!=="{}"}),ILL_FORMED_UNICODE=fails$1e(function(){return $stringify("\uDF06\uD834")!=='"\\udf06\\ud834"'||$stringify("\uDEAD")!=='"\\udead"'}),stringifyWithSymbolsFix=function(G,W){var X=arraySlice$8(arguments),V=getReplacerFunction(W);if(!(!isCallable$k(V)&&(G===void 0||isSymbol$9(G))))return X[1]=function(Z,re){if(isCallable$k(V)&&(re=call$y(V,this,$String$3(Z),re)),!isSymbol$9(re))return re},apply$b($stringify,null,X)},fixIllFormed=function(G,W,X){var V=charAt$f(X,W-1),Z=charAt$f(X,W+1);return exec$8(low,G)&&!exec$8(hi,Z)||exec$8(hi,G)&&!exec$8(low,V)?"\\u"+numberToString$2(charCodeAt$7(G,0),16):G};$stringify&&$$31({target:"JSON",stat:!0,arity:3,forced:WRONG_SYMBOLS_CONVERSION||ILL_FORMED_UNICODE},{stringify:function(W,X,V){var Z=arraySlice$8(arguments),re=apply$b(WRONG_SYMBOLS_CONVERSION?stringifyWithSymbolsFix:$stringify,null,Z);return ILL_FORMED_UNICODE&&typeof re=="string"?replace$b(re,tester,fixIllFormed):re}});var $$30=_export,NATIVE_SYMBOL$1=symbolConstructorDetection,fails$1d=fails$1p,getOwnPropertySymbolsModule$1=objectGetOwnPropertySymbols,toObject$q=toObject$t,FORCED$E=!NATIVE_SYMBOL$1||fails$1d(function(){getOwnPropertySymbolsModule$1.f(1)});$$30({target:"Object",stat:!0,forced:FORCED$E},{getOwnPropertySymbols:function(W){var X=getOwnPropertySymbolsModule$1.f;return X?X(toObject$q(W)):[]}});var $$2$=_export,DESCRIPTORS$D=descriptors,global$Q=global$10,uncurryThis$1a=functionUncurryThis,hasOwn$k=hasOwnProperty_1,isCallable$j=isCallable$y,isPrototypeOf$a=objectIsPrototypeOf,toString$B=toString$E,defineBuiltInAccessor$g=defineBuiltInAccessor$i,copyConstructorProperties$4=copyConstructorProperties$6,NativeSymbol=global$Q.Symbol,SymbolPrototype=NativeSymbol&&NativeSymbol.prototype;if(DESCRIPTORS$D&&isCallable$j(NativeSymbol)&&(!("description"in SymbolPrototype)||NativeSymbol().description!==void 0)){var EmptyStringDescriptionStore={},SymbolWrapper=function(){var W=arguments.length<1||arguments[0]===void 0?void 0:toString$B(arguments[0]),X=isPrototypeOf$a(SymbolPrototype,this)?new NativeSymbol(W):W===void 0?NativeSymbol():NativeSymbol(W);return W===""&&(EmptyStringDescriptionStore[X]=!0),X};copyConstructorProperties$4(SymbolWrapper,NativeSymbol),SymbolWrapper.prototype=SymbolPrototype,SymbolPrototype.constructor=SymbolWrapper;var NATIVE_SYMBOL=String(NativeSymbol("description detection"))==="Symbol(description detection)",thisSymbolValue=uncurryThis$1a(SymbolPrototype.valueOf),symbolDescriptiveString=uncurryThis$1a(SymbolPrototype.toString),regexp=/^Symbol\((.*)\)[^)]+$/,replace$a=uncurryThis$1a("".replace),stringSlice$g=uncurryThis$1a("".slice);defineBuiltInAccessor$g(SymbolPrototype,"description",{configurable:!0,get:function(){var W=thisSymbolValue(this);if(hasOwn$k(EmptyStringDescriptionStore,W))return"";var X=symbolDescriptiveString(W),V=NATIVE_SYMBOL?stringSlice$g(X,7,-1):replace$a(X,regexp,"$1");return V===""?void 0:V}}),$$2$({global:!0,constructor:!0,forced:!0},{Symbol:SymbolWrapper})}var defineWellKnownSymbol$c=wellKnownSymbolDefine;defineWellKnownSymbol$c("asyncIterator");var defineWellKnownSymbol$b=wellKnownSymbolDefine;defineWellKnownSymbol$b("hasInstance");var defineWellKnownSymbol$a=wellKnownSymbolDefine;defineWellKnownSymbol$a("isConcatSpreadable");var defineWellKnownSymbol$9=wellKnownSymbolDefine;defineWellKnownSymbol$9("iterator");var defineWellKnownSymbol$8=wellKnownSymbolDefine;defineWellKnownSymbol$8("match");var defineWellKnownSymbol$7=wellKnownSymbolDefine;defineWellKnownSymbol$7("matchAll");var defineWellKnownSymbol$6=wellKnownSymbolDefine;defineWellKnownSymbol$6("replace");var defineWellKnownSymbol$5=wellKnownSymbolDefine;defineWellKnownSymbol$5("search");var defineWellKnownSymbol$4=wellKnownSymbolDefine;defineWellKnownSymbol$4("species");var defineWellKnownSymbol$3=wellKnownSymbolDefine;defineWellKnownSymbol$3("split");var defineWellKnownSymbol$2=wellKnownSymbolDefine,defineSymbolToPrimitive=symbolDefineToPrimitive;defineWellKnownSymbol$2("toPrimitive");defineSymbolToPrimitive();var getBuiltIn$h=getBuiltIn$p,defineWellKnownSymbol$1=wellKnownSymbolDefine,setToStringTag$c=setToStringTag$e;defineWellKnownSymbol$1("toStringTag");setToStringTag$c(getBuiltIn$h("Symbol"),"Symbol");var defineWellKnownSymbol=wellKnownSymbolDefine;defineWellKnownSymbol("unscopables");var uncurryThis$19=functionUncurryThis,aCallable$k=aCallable$n,functionUncurryThisAccessor=function(G,W,X){try{return uncurryThis$19(aCallable$k(Object.getOwnPropertyDescriptor(G,W)[X]))}catch{}},isObject$z=isObject$G,isPossiblePrototype$2=function(G){return isObject$z(G)||G===null},isPossiblePrototype$1=isPossiblePrototype$2,$String$2=String,$TypeError$k=TypeError,aPossiblePrototype$2=function(G){if(isPossiblePrototype$1(G))return G;throw new $TypeError$k("Can't set "+$String$2(G)+" as a prototype")},uncurryThisAccessor$2=functionUncurryThisAccessor,anObject$x=anObject$D,aPossiblePrototype$1=aPossiblePrototype$2,objectSetPrototypeOf$1=Object.setPrototypeOf||("__proto__"in{}?function(){var G=!1,W={},X;try{X=uncurryThisAccessor$2(Object.prototype,"__proto__","set"),X(W,[]),G=W instanceof Array}catch{}return function(Z,re){return anObject$x(Z),aPossiblePrototype$1(re),G?X(Z,re):Z.__proto__=re,Z}}():void 0),defineProperty$c=objectDefineProperty.f,proxyAccessor$2=function(G,W,X){X in G||defineProperty$c(G,X,{configurable:!0,get:function(){return W[X]},set:function(V){W[X]=V}})},isCallable$i=isCallable$y,isObject$y=isObject$G,setPrototypeOf$9=objectSetPrototypeOf$1,inheritIfRequired$7=function(G,W,X){var V,Z;return setPrototypeOf$9&&isCallable$i(V=W.constructor)&&V!==X&&isObject$y(Z=V.prototype)&&Z!==X.prototype&&setPrototypeOf$9(G,Z),G},toString$A=toString$E,normalizeStringArgument$5=function(G,W){return G===void 0?arguments.length<2?"":W:toString$A(G)},isObject$x=isObject$G,createNonEnumerableProperty$c=createNonEnumerableProperty$f,installErrorCause$2=function(G,W){isObject$x(W)&&"cause"in W&&createNonEnumerableProperty$c(G,"cause",W.cause)},uncurryThis$18=functionUncurryThis,$Error$1=Error,replace$9=uncurryThis$18("".replace),TEST=function(G){return String(new $Error$1(G).stack)}("zxcasd"),V8_OR_CHAKRA_STACK_ENTRY=/\n\s*at [^:]*:[^\n]*/,IS_V8_OR_CHAKRA_STACK=V8_OR_CHAKRA_STACK_ENTRY.test(TEST),errorStackClear=function(G,W){if(IS_V8_OR_CHAKRA_STACK&&typeof G=="string"&&!$Error$1.prepareStackTrace)for(;W--;)G=replace$9(G,V8_OR_CHAKRA_STACK_ENTRY,"");return G},fails$1c=fails$1p,createPropertyDescriptor$8=createPropertyDescriptor$c,errorStackInstallable=!fails$1c(function(){var G=new Error("a");return"stack"in G?(Object.defineProperty(G,"stack",createPropertyDescriptor$8(1,7)),G.stack!==7):!0}),createNonEnumerableProperty$b=createNonEnumerableProperty$f,clearErrorStack$2=errorStackClear,ERROR_STACK_INSTALLABLE$1=errorStackInstallable,captureStackTrace=Error.captureStackTrace,errorStackInstall=function(G,W,X,V){ERROR_STACK_INSTALLABLE$1&&(captureStackTrace?captureStackTrace(G,W):createNonEnumerableProperty$b(G,"stack",clearErrorStack$2(X,V)))},getBuiltIn$g=getBuiltIn$p,hasOwn$j=hasOwnProperty_1,createNonEnumerableProperty$a=createNonEnumerableProperty$f,isPrototypeOf$9=objectIsPrototypeOf,setPrototypeOf$8=objectSetPrototypeOf$1,copyConstructorProperties$3=copyConstructorProperties$6,proxyAccessor$1=proxyAccessor$2,inheritIfRequired$6=inheritIfRequired$7,normalizeStringArgument$4=normalizeStringArgument$5,installErrorCause$1=installErrorCause$2,installErrorStack$1=errorStackInstall,DESCRIPTORS$C=descriptors,wrapErrorConstructorWithCause$2=function(G,W,X,V){var Z="stackTraceLimit",re=V?2:1,se=G.split("."),ue=se[se.length-1],H=getBuiltIn$g.apply(null,se);if(H){var ye=H.prototype;if(hasOwn$j(ye,"cause")&&delete ye.cause,!X)return H;var Ie=getBuiltIn$g("Error"),Ee=W(function(Fe,je){var mt=normalizeStringArgument$4(V?je:Fe,void 0),wt=V?new H(Fe):new H;return mt!==void 0&&createNonEnumerableProperty$a(wt,"message",mt),installErrorStack$1(wt,Ee,wt.stack,2),this&&isPrototypeOf$9(ye,this)&&inheritIfRequired$6(wt,this,Ee),arguments.length>re&&installErrorCause$1(wt,arguments[re]),wt});Ee.prototype=ye,ue!=="Error"?setPrototypeOf$8?setPrototypeOf$8(Ee,Ie):copyConstructorProperties$3(Ee,Ie,{name:!0}):DESCRIPTORS$C&&Z in H&&(proxyAccessor$1(Ee,H,Z),proxyAccessor$1(Ee,H,"prepareStackTrace")),copyConstructorProperties$3(Ee,H);try{ye.name!==ue&&createNonEnumerableProperty$a(ye,"name",ue),ye.constructor=Ee}catch{}return Ee}},$$2_=_export,global$P=global$10,apply$a=functionApply$1,wrapErrorConstructorWithCause$1=wrapErrorConstructorWithCause$2,WEB_ASSEMBLY="WebAssembly",WebAssembly=global$P[WEB_ASSEMBLY],FORCED$D=new Error("e",{cause:7}).cause!==7,exportGlobalErrorCauseWrapper=function(G,W){var X={};X[G]=wrapErrorConstructorWithCause$1(G,W,FORCED$D),$$2_({global:!0,constructor:!0,arity:1,forced:FORCED$D},X)},exportWebAssemblyErrorCauseWrapper=function(G,W){if(WebAssembly&&WebAssembly[G]){var X={};X[G]=wrapErrorConstructorWithCause$1(WEB_ASSEMBLY+"."+G,W,FORCED$D),$$2_({target:WEB_ASSEMBLY,stat:!0,constructor:!0,arity:1,forced:FORCED$D},X)}};exportGlobalErrorCauseWrapper("Error",function(G){return function(X){return apply$a(G,this,arguments)}});exportGlobalErrorCauseWrapper("EvalError",function(G){return function(X){return apply$a(G,this,arguments)}});exportGlobalErrorCauseWrapper("RangeError",function(G){return function(X){return apply$a(G,this,arguments)}});exportGlobalErrorCauseWrapper("ReferenceError",function(G){return function(X){return apply$a(G,this,arguments)}});exportGlobalErrorCauseWrapper("SyntaxError",function(G){return function(X){return apply$a(G,this,arguments)}});exportGlobalErrorCauseWrapper("TypeError",function(G){return function(X){return apply$a(G,this,arguments)}});exportGlobalErrorCauseWrapper("URIError",function(G){return function(X){return apply$a(G,this,arguments)}});exportWebAssemblyErrorCauseWrapper("CompileError",function(G){return function(X){return apply$a(G,this,arguments)}});exportWebAssemblyErrorCauseWrapper("LinkError",function(G){return function(X){return apply$a(G,this,arguments)}});exportWebAssemblyErrorCauseWrapper("RuntimeError",function(G){return function(X){return apply$a(G,this,arguments)}});var DESCRIPTORS$B=descriptors,fails$1b=fails$1p,anObject$w=anObject$D,normalizeStringArgument$3=normalizeStringArgument$5,nativeErrorToString=Error.prototype.toString,INCORRECT_TO_STRING$1=fails$1b(function(){if(DESCRIPTORS$B){var G=Object.create(Object.defineProperty({},"name",{get:function(){return this===G}}));if(nativeErrorToString.call(G)!=="true")return!0}return nativeErrorToString.call({message:1,name:2})!=="2: 1"||nativeErrorToString.call({})!=="Error"}),errorToString$2=INCORRECT_TO_STRING$1?function(){var W=anObject$w(this),X=normalizeStringArgument$3(W.name,"Error"),V=normalizeStringArgument$3(W.message);return X?V?X+": "+V:X:V}:nativeErrorToString,defineBuiltIn$k=defineBuiltIn$o,errorToString$1=errorToString$2,ErrorPrototype$1=Error.prototype;ErrorPrototype$1.toString!==errorToString$1&&defineBuiltIn$k(ErrorPrototype$1,"toString",errorToString$1);var fails$1a=fails$1p,correctPrototypeGetter=!fails$1a(function(){function G(){}return G.prototype.constructor=null,Object.getPrototypeOf(new G)!==G.prototype}),hasOwn$i=hasOwnProperty_1,isCallable$h=isCallable$y,toObject$p=toObject$t,sharedKey=sharedKey$4,CORRECT_PROTOTYPE_GETTER$2=correctPrototypeGetter,IE_PROTO=sharedKey("IE_PROTO"),$Object$1=Object,ObjectPrototype$4=$Object$1.prototype,objectGetPrototypeOf$2=CORRECT_PROTOTYPE_GETTER$2?$Object$1.getPrototypeOf:function(G){var W=toObject$p(G);if(hasOwn$i(W,IE_PROTO))return W[IE_PROTO];var X=W.constructor;return isCallable$h(X)&&W instanceof X?X.prototype:W instanceof $Object$1?ObjectPrototype$4:null},iterators={},wellKnownSymbol$q=wellKnownSymbol$z,Iterators$4=iterators,ITERATOR$a=wellKnownSymbol$q("iterator"),ArrayPrototype$1=Array.prototype,isArrayIteratorMethod$3=function(G){return G!==void 0&&(Iterators$4.Array===G||ArrayPrototype$1[ITERATOR$a]===G)},classof$h=classof$n,getMethod$7=getMethod$9,isNullOrUndefined$c=isNullOrUndefined$f,Iterators$3=iterators,wellKnownSymbol$p=wellKnownSymbol$z,ITERATOR$9=wellKnownSymbol$p("iterator"),getIteratorMethod$5=function(G){if(!isNullOrUndefined$c(G))return getMethod$7(G,ITERATOR$9)||getMethod$7(G,"@@iterator")||Iterators$3[classof$h(G)]},call$x=functionCall,aCallable$j=aCallable$n,anObject$v=anObject$D,tryToString$4=tryToString$7,getIteratorMethod$4=getIteratorMethod$5,$TypeError$j=TypeError,getIterator$4=function(G,W){var X=arguments.length<2?getIteratorMethod$4(G):W;if(aCallable$j(X))return anObject$v(call$x(X,G));throw new $TypeError$j(tryToString$4(G)+" is not iterable")},call$w=functionCall,anObject$u=anObject$D,getMethod$6=getMethod$9,iteratorClose$2=function(G,W,X){var V,Z;anObject$u(G);try{if(V=getMethod$6(G,"return"),!V){if(W==="throw")throw X;return X}V=call$w(V,G)}catch(re){Z=!0,V=re}if(W==="throw")throw X;if(Z)throw V;return anObject$u(V),X},bind$c=functionBindContext,call$v=functionCall,anObject$t=anObject$D,tryToString$3=tryToString$7,isArrayIteratorMethod$2=isArrayIteratorMethod$3,lengthOfArrayLike$p=lengthOfArrayLike$s,isPrototypeOf$8=objectIsPrototypeOf,getIterator$3=getIterator$4,getIteratorMethod$3=getIteratorMethod$5,iteratorClose$1=iteratorClose$2,$TypeError$i=TypeError,Result=function(G,W){this.stopped=G,this.result=W},ResultPrototype=Result.prototype,iterate$c=function(G,W,X){var V=X&&X.that,Z=!!(X&&X.AS_ENTRIES),re=!!(X&&X.IS_RECORD),se=!!(X&&X.IS_ITERATOR),ue=!!(X&&X.INTERRUPTED),H=bind$c(W,V),ye,Ie,Ee,Fe,je,mt,wt,Ot=function(jt){return ye&&iteratorClose$1(ye,"normal",jt),new Result(!0,jt)},$t=function(jt){return Z?(anObject$t(jt),ue?H(jt[0],jt[1],Ot):H(jt[0],jt[1])):ue?H(jt,Ot):H(jt)};if(re)ye=G.iterator;else if(se)ye=G;else{if(Ie=getIteratorMethod$3(G),!Ie)throw new $TypeError$i(tryToString$3(G)+" is not iterable");if(isArrayIteratorMethod$2(Ie)){for(Ee=0,Fe=lengthOfArrayLike$p(G);Fe>Ee;Ee++)if(je=$t(G[Ee]),je&&isPrototypeOf$8(ResultPrototype,je))return je;return new Result(!1)}ye=getIterator$3(G,Ie)}for(mt=re?G.next:ye.next;!(wt=call$v(mt,ye)).done;){try{je=$t(wt.value)}catch(jt){iteratorClose$1(ye,"throw",jt)}if(typeof je=="object"&&je&&isPrototypeOf$8(ResultPrototype,je))return je}return new Result(!1)},$$2Z=_export,isPrototypeOf$7=objectIsPrototypeOf,getPrototypeOf$9=objectGetPrototypeOf$2,setPrototypeOf$7=objectSetPrototypeOf$1,copyConstructorProperties$2=copyConstructorProperties$6,create$d=objectCreate,createNonEnumerableProperty$9=createNonEnumerableProperty$f,createPropertyDescriptor$7=createPropertyDescriptor$c,installErrorCause=installErrorCause$2,installErrorStack=errorStackInstall,iterate$b=iterate$c,normalizeStringArgument$2=normalizeStringArgument$5,wellKnownSymbol$o=wellKnownSymbol$z,TO_STRING_TAG$1=wellKnownSymbol$o("toStringTag"),$Error=Error,push$d=[].push,$AggregateError$1=function(W,X){var V=isPrototypeOf$7(AggregateErrorPrototype,this),Z;setPrototypeOf$7?Z=setPrototypeOf$7(new $Error,V?getPrototypeOf$9(this):AggregateErrorPrototype):(Z=V?this:create$d(AggregateErrorPrototype),createNonEnumerableProperty$9(Z,TO_STRING_TAG$1,"Error")),X!==void 0&&createNonEnumerableProperty$9(Z,"message",normalizeStringArgument$2(X)),installErrorStack(Z,$AggregateError$1,Z.stack,1),arguments.length>2&&installErrorCause(Z,arguments[2]);var re=[];return iterate$b(W,push$d,{that:re}),createNonEnumerableProperty$9(Z,"errors",re),Z};setPrototypeOf$7?setPrototypeOf$7($AggregateError$1,$Error):copyConstructorProperties$2($AggregateError$1,$Error,{name:!0});var AggregateErrorPrototype=$AggregateError$1.prototype=create$d($Error.prototype,{constructor:createPropertyDescriptor$7(1,$AggregateError$1),message:createPropertyDescriptor$7(1,""),name:createPropertyDescriptor$7(1,"AggregateError")});$$2Z({global:!0,constructor:!0,arity:2},{AggregateError:$AggregateError$1});var $$2Y=_export,getBuiltIn$f=getBuiltIn$p,apply$9=functionApply$1,fails$19=fails$1p,wrapErrorConstructorWithCause=wrapErrorConstructorWithCause$2,AGGREGATE_ERROR="AggregateError",$AggregateError=getBuiltIn$f(AGGREGATE_ERROR),FORCED$C=!fails$19(function(){return $AggregateError([1]).errors[0]!==1})&&fails$19(function(){return $AggregateError([1],AGGREGATE_ERROR,{cause:7}).cause!==7});$$2Y({global:!0,constructor:!0,arity:2,forced:FORCED$C},{AggregateError:wrapErrorConstructorWithCause(AGGREGATE_ERROR,function(G){return function(X,V){return apply$9(G,this,arguments)}},FORCED$C,!0)});var wellKnownSymbol$n=wellKnownSymbol$z,create$c=objectCreate,defineProperty$b=objectDefineProperty.f,UNSCOPABLES=wellKnownSymbol$n("unscopables"),ArrayPrototype=Array.prototype;ArrayPrototype[UNSCOPABLES]===void 0&&defineProperty$b(ArrayPrototype,UNSCOPABLES,{configurable:!0,value:create$c(null)});var addToUnscopables$e=function(G){ArrayPrototype[UNSCOPABLES][G]=!0},$$2X=_export,toObject$o=toObject$t,lengthOfArrayLike$o=lengthOfArrayLike$s,toIntegerOrInfinity$i=toIntegerOrInfinity$l,addToUnscopables$d=addToUnscopables$e;$$2X({target:"Array",proto:!0},{at:function(W){var X=toObject$o(this),V=lengthOfArrayLike$o(X),Z=toIntegerOrInfinity$i(W),re=Z>=0?Z:V+Z;return re<0||re>=V?void 0:X[re]}});addToUnscopables$d("at");var $TypeError$h=TypeError,MAX_SAFE_INTEGER$2=9007199254740991,doesNotExceedSafeInteger$6=function(G){if(G>MAX_SAFE_INTEGER$2)throw $TypeError$h("Maximum allowed index exceeded");return G},DESCRIPTORS$A=descriptors,definePropertyModule$6=objectDefineProperty,createPropertyDescriptor$6=createPropertyDescriptor$c,createProperty$8=function(G,W,X){DESCRIPTORS$A?definePropertyModule$6.f(G,W,createPropertyDescriptor$6(0,X)):G[W]=X},fails$18=fails$1p,wellKnownSymbol$m=wellKnownSymbol$z,V8_VERSION$2=engineV8Version,SPECIES$5=wellKnownSymbol$m("species"),arrayMethodHasSpeciesSupport$5=function(G){return V8_VERSION$2>=51||!fails$18(function(){var W=[],X=W.constructor={};return X[SPECIES$5]=function(){return{foo:1}},W[G](Boolean).foo!==1})},$$2W=_export,fails$17=fails$1p,isArray$d=isArray$g,isObject$w=isObject$G,toObject$n=toObject$t,lengthOfArrayLike$n=lengthOfArrayLike$s,doesNotExceedSafeInteger$5=doesNotExceedSafeInteger$6,createProperty$7=createProperty$8,arraySpeciesCreate$3=arraySpeciesCreate$5,arrayMethodHasSpeciesSupport$4=arrayMethodHasSpeciesSupport$5,wellKnownSymbol$l=wellKnownSymbol$z,V8_VERSION$1=engineV8Version,IS_CONCAT_SPREADABLE=wellKnownSymbol$l("isConcatSpreadable"),IS_CONCAT_SPREADABLE_SUPPORT=V8_VERSION$1>=51||!fails$17(function(){var G=[];return G[IS_CONCAT_SPREADABLE]=!1,G.concat()[0]!==G}),isConcatSpreadable=function(G){if(!isObject$w(G))return!1;var W=G[IS_CONCAT_SPREADABLE];return W!==void 0?!!W:isArray$d(G)},FORCED$B=!IS_CONCAT_SPREADABLE_SUPPORT||!arrayMethodHasSpeciesSupport$4("concat");$$2W({target:"Array",proto:!0,arity:1,forced:FORCED$B},{concat:function(W){var X=toObject$n(this),V=arraySpeciesCreate$3(X,0),Z=0,re,se,ue,H,ye;for(re=-1,ue=arguments.length;re<ue;re++)if(ye=re===-1?X:arguments[re],isConcatSpreadable(ye))for(H=lengthOfArrayLike$n(ye),doesNotExceedSafeInteger$5(Z+H),se=0;se<H;se++,Z++)se in ye&&createProperty$7(V,Z,ye[se]);else doesNotExceedSafeInteger$5(Z+1),createProperty$7(V,Z++,ye);return V.length=Z,V}});var tryToString$2=tryToString$7,$TypeError$g=TypeError,deletePropertyOrThrow$4=function(G,W){if(!delete G[W])throw new $TypeError$g("Cannot delete property "+tryToString$2(W)+" of "+tryToString$2(G))},toObject$m=toObject$t,toAbsoluteIndex$7=toAbsoluteIndex$9,lengthOfArrayLike$m=lengthOfArrayLike$s,deletePropertyOrThrow$3=deletePropertyOrThrow$4,min$9=Math.min,arrayCopyWithin=[].copyWithin||function(W,X){var V=toObject$m(this),Z=lengthOfArrayLike$m(V),re=toAbsoluteIndex$7(W,Z),se=toAbsoluteIndex$7(X,Z),ue=arguments.length>2?arguments[2]:void 0,H=min$9((ue===void 0?Z:toAbsoluteIndex$7(ue,Z))-se,Z-re),ye=1;for(se<re&&re<se+H&&(ye=-1,se+=H-1,re+=H-1);H-- >0;)se in V?V[re]=V[se]:deletePropertyOrThrow$3(V,re),re+=ye,se+=ye;return V},$$2V=_export,copyWithin=arrayCopyWithin,addToUnscopables$c=addToUnscopables$e;$$2V({target:"Array",proto:!0},{copyWithin});addToUnscopables$c("copyWithin");var fails$16=fails$1p,arrayMethodIsStrict$9=function(G,W){var X=[][G];return!!X&&fails$16(function(){X.call(null,W||function(){return 1},1)})},$$2U=_export,$every$1=arrayIteration.every,arrayMethodIsStrict$8=arrayMethodIsStrict$9,STRICT_METHOD$4=arrayMethodIsStrict$8("every");$$2U({target:"Array",proto:!0,forced:!STRICT_METHOD$4},{every:function(W){return $every$1(this,W,arguments.length>1?arguments[1]:void 0)}});var toObject$l=toObject$t,toAbsoluteIndex$6=toAbsoluteIndex$9,lengthOfArrayLike$l=lengthOfArrayLike$s,arrayFill$1=function(W){for(var X=toObject$l(this),V=lengthOfArrayLike$l(X),Z=arguments.length,re=toAbsoluteIndex$6(Z>1?arguments[1]:void 0,V),se=Z>2?arguments[2]:void 0,ue=se===void 0?V:toAbsoluteIndex$6(se,V);ue>re;)X[re++]=W;return X},$$2T=_export,fill$1=arrayFill$1,addToUnscopables$b=addToUnscopables$e;$$2T({target:"Array",proto:!0},{fill:fill$1});addToUnscopables$b("fill");var $$2S=_export,$filter$1=arrayIteration.filter,arrayMethodHasSpeciesSupport$3=arrayMethodHasSpeciesSupport$5,HAS_SPECIES_SUPPORT$3=arrayMethodHasSpeciesSupport$3("filter");$$2S({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$3},{filter:function(W){return $filter$1(this,W,arguments.length>1?arguments[1]:void 0)}});var $$2R=_export,$find$1=arrayIteration.find,addToUnscopables$a=addToUnscopables$e,FIND="find",SKIPS_HOLES$1=!0;FIND in[]&&Array(1)[FIND](function(){SKIPS_HOLES$1=!1});$$2R({target:"Array",proto:!0,forced:SKIPS_HOLES$1},{find:function(W){return $find$1(this,W,arguments.length>1?arguments[1]:void 0)}});addToUnscopables$a(FIND);var $$2Q=_export,$findIndex$1=arrayIteration.findIndex,addToUnscopables$9=addToUnscopables$e,FIND_INDEX="findIndex",SKIPS_HOLES=!0;FIND_INDEX in[]&&Array(1)[FIND_INDEX](function(){SKIPS_HOLES=!1});$$2Q({target:"Array",proto:!0,forced:SKIPS_HOLES},{findIndex:function(W){return $findIndex$1(this,W,arguments.length>1?arguments[1]:void 0)}});addToUnscopables$9(FIND_INDEX);var bind$b=functionBindContext,IndexedObject$3=indexedObject,toObject$k=toObject$t,lengthOfArrayLike$k=lengthOfArrayLike$s,createMethod$5=function(G){var W=G===1;return function(X,V,Z){for(var re=toObject$k(X),se=IndexedObject$3(re),ue=lengthOfArrayLike$k(se),H=bind$b(V,Z),ye,Ie;ue-- >0;)if(ye=se[ue],Ie=H(ye,ue,re),Ie)switch(G){case 0:return ye;case 1:return ue}return W?-1:void 0}},arrayIterationFromLast={findLast:createMethod$5(0),findLastIndex:createMethod$5(1)},$$2P=_export,$findLast$1=arrayIterationFromLast.findLast,addToUnscopables$8=addToUnscopables$e;$$2P({target:"Array",proto:!0},{findLast:function(W){return $findLast$1(this,W,arguments.length>1?arguments[1]:void 0)}});addToUnscopables$8("findLast");var $$2O=_export,$findLastIndex$1=arrayIterationFromLast.findLastIndex,addToUnscopables$7=addToUnscopables$e;$$2O({target:"Array",proto:!0},{findLastIndex:function(W){return $findLastIndex$1(this,W,arguments.length>1?arguments[1]:void 0)}});addToUnscopables$7("findLastIndex");var isArray$c=isArray$g,lengthOfArrayLike$j=lengthOfArrayLike$s,doesNotExceedSafeInteger$4=doesNotExceedSafeInteger$6,bind$a=functionBindContext,flattenIntoArray$2=function(G,W,X,V,Z,re,se,ue){for(var H=Z,ye=0,Ie=se?bind$a(se,ue):!1,Ee,Fe;ye<V;)ye in X&&(Ee=Ie?Ie(X[ye],ye,W):X[ye],re>0&&isArray$c(Ee)?(Fe=lengthOfArrayLike$j(Ee),H=flattenIntoArray$2(G,W,Ee,Fe,H,re-1)-1):(doesNotExceedSafeInteger$4(H+1),G[H]=Ee),H++),ye++;return H},flattenIntoArray_1=flattenIntoArray$2,$$2N=_export,flattenIntoArray$1=flattenIntoArray_1,toObject$j=toObject$t,lengthOfArrayLike$i=lengthOfArrayLike$s,toIntegerOrInfinity$h=toIntegerOrInfinity$l,arraySpeciesCreate$2=arraySpeciesCreate$5;$$2N({target:"Array",proto:!0},{flat:function(){var W=arguments.length?arguments[0]:void 0,X=toObject$j(this),V=lengthOfArrayLike$i(X),Z=arraySpeciesCreate$2(X,0);return Z.length=flattenIntoArray$1(Z,X,X,V,0,W===void 0?1:toIntegerOrInfinity$h(W)),Z}});var $$2M=_export,flattenIntoArray=flattenIntoArray_1,aCallable$i=aCallable$n,toObject$i=toObject$t,lengthOfArrayLike$h=lengthOfArrayLike$s,arraySpeciesCreate$1=arraySpeciesCreate$5;$$2M({target:"Array",proto:!0},{flatMap:function(W){var X=toObject$i(this),V=lengthOfArrayLike$h(X),Z;return aCallable$i(W),Z=arraySpeciesCreate$1(X,0),Z.length=flattenIntoArray(Z,X,X,V,0,1,W,arguments.length>1?arguments[1]:void 0),Z}});var $forEach$1=arrayIteration.forEach,arrayMethodIsStrict$7=arrayMethodIsStrict$9,STRICT_METHOD$3=arrayMethodIsStrict$7("forEach"),arrayForEach=STRICT_METHOD$3?[].forEach:function(W){return $forEach$1(this,W,arguments.length>1?arguments[1]:void 0)},$$2L=_export,forEach$5=arrayForEach;$$2L({target:"Array",proto:!0,forced:[].forEach!==forEach$5},{forEach:forEach$5});var anObject$s=anObject$D,iteratorClose=iteratorClose$2,callWithSafeIterationClosing$1=function(G,W,X,V){try{return V?W(anObject$s(X)[0],X[1]):W(X)}catch(Z){iteratorClose(G,"throw",Z)}},bind$9=functionBindContext,call$u=functionCall,toObject$h=toObject$t,callWithSafeIterationClosing=callWithSafeIterationClosing$1,isArrayIteratorMethod$1=isArrayIteratorMethod$3,isConstructor$4=isConstructor$6,lengthOfArrayLike$g=lengthOfArrayLike$s,createProperty$6=createProperty$8,getIterator$2=getIterator$4,getIteratorMethod$2=getIteratorMethod$5,$Array$8=Array,arrayFrom$1=function(W){var X=toObject$h(W),V=isConstructor$4(this),Z=arguments.length,re=Z>1?arguments[1]:void 0,se=re!==void 0;se&&(re=bind$9(re,Z>2?arguments[2]:void 0));var ue=getIteratorMethod$2(X),H=0,ye,Ie,Ee,Fe,je,mt;if(ue&&!(this===$Array$8&&isArrayIteratorMethod$1(ue)))for(Fe=getIterator$2(X,ue),je=Fe.next,Ie=V?new this:[];!(Ee=call$u(je,Fe)).done;H++)mt=se?callWithSafeIterationClosing(Fe,re,[Ee.value,H],!0):Ee.value,createProperty$6(Ie,H,mt);else for(ye=lengthOfArrayLike$g(X),Ie=V?new this(ye):$Array$8(ye);ye>H;H++)mt=se?re(X[H],H):X[H],createProperty$6(Ie,H,mt);return Ie.length=H,Ie},wellKnownSymbol$k=wellKnownSymbol$z,ITERATOR$8=wellKnownSymbol$k("iterator"),SAFE_CLOSING=!1;try{var called=0,iteratorWithReturn={next:function(){return{done:!!called++}},return:function(){SAFE_CLOSING=!0}};iteratorWithReturn[ITERATOR$8]=function(){return this},Array.from(iteratorWithReturn,function(){throw 2})}catch{}var checkCorrectnessOfIteration$4=function(G,W){try{if(!W&&!SAFE_CLOSING)return!1}catch{return!1}var X=!1;try{var V={};V[ITERATOR$8]=function(){return{next:function(){return{done:X=!0}}}},G(V)}catch{}return X},$$2K=_export,from=arrayFrom$1,checkCorrectnessOfIteration$3=checkCorrectnessOfIteration$4,INCORRECT_ITERATION=!checkCorrectnessOfIteration$3(function(G){Array.from(G)});$$2K({target:"Array",stat:!0,forced:INCORRECT_ITERATION},{from});var $$2J=_export,$includes$1=arrayIncludes.includes,fails$15=fails$1p,addToUnscopables$6=addToUnscopables$e,BROKEN_ON_SPARSE=fails$15(function(){return!Array(1).includes()});$$2J({target:"Array",proto:!0,forced:BROKEN_ON_SPARSE},{includes:function(W){return $includes$1(this,W,arguments.length>1?arguments[1]:void 0)}});addToUnscopables$6("includes");var $$2I=_export,uncurryThis$17=functionUncurryThisClause,$indexOf$1=arrayIncludes.indexOf,arrayMethodIsStrict$6=arrayMethodIsStrict$9,nativeIndexOf=uncurryThis$17([].indexOf),NEGATIVE_ZERO$1=!!nativeIndexOf&&1/nativeIndexOf([1],1,-0)<0,FORCED$A=NEGATIVE_ZERO$1||!arrayMethodIsStrict$6("indexOf");$$2I({target:"Array",proto:!0,forced:FORCED$A},{indexOf:function(W){var X=arguments.length>1?arguments[1]:void 0;return NEGATIVE_ZERO$1?nativeIndexOf(this,W,X)||0:$indexOf$1(this,W,X)}});var $$2H=_export,isArray$b=isArray$g;$$2H({target:"Array",stat:!0},{isArray:isArray$b});var fails$14=fails$1p,isCallable$g=isCallable$y,isObject$v=isObject$G,getPrototypeOf$8=objectGetPrototypeOf$2,defineBuiltIn$j=defineBuiltIn$o,wellKnownSymbol$j=wellKnownSymbol$z,ITERATOR$7=wellKnownSymbol$j("iterator"),BUGGY_SAFARI_ITERATORS$1=!1,IteratorPrototype$2,PrototypeOfArrayIteratorPrototype,arrayIterator;[].keys&&(arrayIterator=[].keys(),"next"in arrayIterator?(PrototypeOfArrayIteratorPrototype=getPrototypeOf$8(getPrototypeOf$8(arrayIterator)),PrototypeOfArrayIteratorPrototype!==Object.prototype&&(IteratorPrototype$2=PrototypeOfArrayIteratorPrototype)):BUGGY_SAFARI_ITERATORS$1=!0);var NEW_ITERATOR_PROTOTYPE=!isObject$v(IteratorPrototype$2)||fails$14(function(){var G={};return IteratorPrototype$2[ITERATOR$7].call(G)!==G});NEW_ITERATOR_PROTOTYPE&&(IteratorPrototype$2={});isCallable$g(IteratorPrototype$2[ITERATOR$7])||defineBuiltIn$j(IteratorPrototype$2,ITERATOR$7,function(){return this});var iteratorsCore={IteratorPrototype:IteratorPrototype$2,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS$1},IteratorPrototype$1=iteratorsCore.IteratorPrototype,create$b=objectCreate,createPropertyDescriptor$5=createPropertyDescriptor$c,setToStringTag$b=setToStringTag$e,Iterators$2=iterators,returnThis$1=function(){return this},iteratorCreateConstructor=function(G,W,X,V){var Z=W+" Iterator";return G.prototype=create$b(IteratorPrototype$1,{next:createPropertyDescriptor$5(+!V,X)}),setToStringTag$b(G,Z,!1),Iterators$2[Z]=returnThis$1,G},$$2G=_export,call$t=functionCall,FunctionName$1=functionName,isCallable$f=isCallable$y,createIteratorConstructor$2=iteratorCreateConstructor,getPrototypeOf$7=objectGetPrototypeOf$2,setPrototypeOf$6=objectSetPrototypeOf$1,setToStringTag$a=setToStringTag$e,createNonEnumerableProperty$8=createNonEnumerableProperty$f,defineBuiltIn$i=defineBuiltIn$o,wellKnownSymbol$i=wellKnownSymbol$z,Iterators$1=iterators,IteratorsCore=iteratorsCore,PROPER_FUNCTION_NAME$3=FunctionName$1.PROPER,CONFIGURABLE_FUNCTION_NAME$1=FunctionName$1.CONFIGURABLE,IteratorPrototype=IteratorsCore.IteratorPrototype,BUGGY_SAFARI_ITERATORS=IteratorsCore.BUGGY_SAFARI_ITERATORS,ITERATOR$6=wellKnownSymbol$i("iterator"),KEYS="keys",VALUES="values",ENTRIES="entries",returnThis=function(){return this},iteratorDefine=function(G,W,X,V,Z,re,se){createIteratorConstructor$2(X,W,V);var ue=function($t){if($t===Z&&Fe)return Fe;if(!BUGGY_SAFARI_ITERATORS&&$t&&$t in Ie)return Ie[$t];switch($t){case KEYS:return function(){return new X(this,$t)};case VALUES:return function(){return new X(this,$t)};case ENTRIES:return function(){return new X(this,$t)}}return function(){return new X(this)}},H=W+" Iterator",ye=!1,Ie=G.prototype,Ee=Ie[ITERATOR$6]||Ie["@@iterator"]||Z&&Ie[Z],Fe=!BUGGY_SAFARI_ITERATORS&&Ee||ue(Z),je=W==="Array"&&Ie.entries||Ee,mt,wt,Ot;if(je&&(mt=getPrototypeOf$7(je.call(new G)),mt!==Object.prototype&&mt.next&&(getPrototypeOf$7(mt)!==IteratorPrototype&&(setPrototypeOf$6?setPrototypeOf$6(mt,IteratorPrototype):isCallable$f(mt[ITERATOR$6])||defineBuiltIn$i(mt,ITERATOR$6,returnThis)),setToStringTag$a(mt,H,!0))),PROPER_FUNCTION_NAME$3&&Z===VALUES&&Ee&&Ee.name!==VALUES&&(CONFIGURABLE_FUNCTION_NAME$1?createNonEnumerableProperty$8(Ie,"name",VALUES):(ye=!0,Fe=function(){return call$t(Ee,this)})),Z)if(wt={values:ue(VALUES),keys:re?Fe:ue(KEYS),entries:ue(ENTRIES)},se)for(Ot in wt)(BUGGY_SAFARI_ITERATORS||ye||!(Ot in Ie))&&defineBuiltIn$i(Ie,Ot,wt[Ot]);else $$2G({target:W,proto:!0,forced:BUGGY_SAFARI_ITERATORS||ye},wt);return Ie[ITERATOR$6]!==Fe&&defineBuiltIn$i(Ie,ITERATOR$6,Fe,{name:Z}),Iterators$1[W]=Fe,wt},createIterResultObject$5=function(G,W){return{value:G,done:W}},toIndexedObject$c=toIndexedObject$j,addToUnscopables$5=addToUnscopables$e,Iterators=iterators,InternalStateModule$b=internalState,defineProperty$a=objectDefineProperty.f,defineIterator$2=iteratorDefine,createIterResultObject$4=createIterResultObject$5,DESCRIPTORS$z=descriptors,ARRAY_ITERATOR="Array Iterator",setInternalState$a=InternalStateModule$b.set,getInternalState$8=InternalStateModule$b.getterFor(ARRAY_ITERATOR),es_array_iterator=defineIterator$2(Array,"Array",function(G,W){setInternalState$a(this,{type:ARRAY_ITERATOR,target:toIndexedObject$c(G),index:0,kind:W})},function(){var G=getInternalState$8(this),W=G.target,X=G.index++;if(!W||X>=W.length)return G.target=void 0,createIterResultObject$4(void 0,!0);switch(G.kind){case"keys":return createIterResultObject$4(X,!1);case"values":return createIterResultObject$4(W[X],!1)}return createIterResultObject$4([X,W[X]],!1)},"values"),values=Iterators.Arguments=Iterators.Array;addToUnscopables$5("keys");addToUnscopables$5("values");addToUnscopables$5("entries");if(DESCRIPTORS$z&&values.name!=="values")try{defineProperty$a(values,"name",{value:"values"})}catch{}var $$2F=_export,uncurryThis$16=functionUncurryThis,IndexedObject$2=indexedObject,toIndexedObject$b=toIndexedObject$j,arrayMethodIsStrict$5=arrayMethodIsStrict$9,nativeJoin=uncurryThis$16([].join),ES3_STRINGS=IndexedObject$2!==Object,FORCED$z=ES3_STRINGS||!arrayMethodIsStrict$5("join",",");$$2F({target:"Array",proto:!0,forced:FORCED$z},{join:function(W){return nativeJoin(toIndexedObject$b(this),W===void 0?",":W)}});var apply$8=functionApply$1,toIndexedObject$a=toIndexedObject$j,toIntegerOrInfinity$g=toIntegerOrInfinity$l,lengthOfArrayLike$f=lengthOfArrayLike$s,arrayMethodIsStrict$4=arrayMethodIsStrict$9,min$8=Math.min,$lastIndexOf$1=[].lastIndexOf,NEGATIVE_ZERO=!!$lastIndexOf$1&&1/[1].lastIndexOf(1,-0)<0,STRICT_METHOD$2=arrayMethodIsStrict$4("lastIndexOf"),FORCED$y=NEGATIVE_ZERO||!STRICT_METHOD$2,arrayLastIndexOf=FORCED$y?function(W){if(NEGATIVE_ZERO)return apply$8($lastIndexOf$1,this,arguments)||0;var X=toIndexedObject$a(this),V=lengthOfArrayLike$f(X);if(V===0)return-1;var Z=V-1;for(arguments.length>1&&(Z=min$8(Z,toIntegerOrInfinity$g(arguments[1]))),Z<0&&(Z=V+Z);Z>=0;Z--)if(Z in X&&X[Z]===W)return Z||0;return-1}:$lastIndexOf$1,$$2E=_export,lastIndexOf=arrayLastIndexOf;$$2E({target:"Array",proto:!0,forced:lastIndexOf!==[].lastIndexOf},{lastIndexOf});var $$2D=_export,$map$1=arrayIteration.map,arrayMethodHasSpeciesSupport$2=arrayMethodHasSpeciesSupport$5,HAS_SPECIES_SUPPORT$2=arrayMethodHasSpeciesSupport$2("map");$$2D({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$2},{map:function(W){return $map$1(this,W,arguments.length>1?arguments[1]:void 0)}});var $$2C=_export,fails$13=fails$1p,isConstructor$3=isConstructor$6,createProperty$5=createProperty$8,$Array$7=Array,ISNT_GENERIC=fails$13(function(){function G(){}return!($Array$7.of.call(G)instanceof G)});$$2C({target:"Array",stat:!0,forced:ISNT_GENERIC},{of:function(){for(var W=0,X=arguments.length,V=new(isConstructor$3(this)?this:$Array$7)(X);X>W;)createProperty$5(V,W,arguments[W++]);return V.length=X,V}});var DESCRIPTORS$y=descriptors,isArray$a=isArray$g,$TypeError$f=TypeError,getOwnPropertyDescriptor$7=Object.getOwnPropertyDescriptor,SILENT_ON_NON_WRITABLE_LENGTH_SET=DESCRIPTORS$y&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(G){return G instanceof TypeError}}(),arraySetLength=SILENT_ON_NON_WRITABLE_LENGTH_SET?function(G,W){if(isArray$a(G)&&!getOwnPropertyDescriptor$7(G,"length").writable)throw new $TypeError$f("Cannot set read only .length");return G.length=W}:function(G,W){return G.length=W},$$2B=_export,toObject$g=toObject$t,lengthOfArrayLike$e=lengthOfArrayLike$s,setArrayLength$2=arraySetLength,doesNotExceedSafeInteger$3=doesNotExceedSafeInteger$6,fails$12=fails$1p,INCORRECT_TO_LENGTH=fails$12(function(){return[].push.call({length:4294967296},1)!==4294967297}),properErrorOnNonWritableLength$1=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(G){return G instanceof TypeError}},FORCED$x=INCORRECT_TO_LENGTH||!properErrorOnNonWritableLength$1();$$2B({target:"Array",proto:!0,arity:1,forced:FORCED$x},{push:function(W){var X=toObject$g(this),V=lengthOfArrayLike$e(X),Z=arguments.length;doesNotExceedSafeInteger$3(V+Z);for(var re=0;re<Z;re++)X[V]=arguments[re],V++;return setArrayLength$2(X,V),V}});var aCallable$h=aCallable$n,toObject$f=toObject$t,IndexedObject$1=indexedObject,lengthOfArrayLike$d=lengthOfArrayLike$s,$TypeError$e=TypeError,REDUCE_EMPTY="Reduce of empty array with no initial value",createMethod$4=function(G){return function(W,X,V,Z){var re=toObject$f(W),se=IndexedObject$1(re),ue=lengthOfArrayLike$d(re);if(aCallable$h(X),ue===0&&V<2)throw new $TypeError$e(REDUCE_EMPTY);var H=G?ue-1:0,ye=G?-1:1;if(V<2)for(;;){if(H in se){Z=se[H],H+=ye;break}if(H+=ye,G?H<0:ue<=H)throw new $TypeError$e(REDUCE_EMPTY)}for(;G?H>=0:ue>H;H+=ye)H in se&&(Z=X(Z,se[H],H,re));return Z}},arrayReduce={left:createMethod$4(!1),right:createMethod$4(!0)},global$O=global$10,classof$g=classofRaw$2,engineIsNode=classof$g(global$O.process)==="process",$$2A=_export,$reduce$1=arrayReduce.left,arrayMethodIsStrict$3=arrayMethodIsStrict$9,CHROME_VERSION$1=engineV8Version,IS_NODE$7=engineIsNode,CHROME_BUG$1=!IS_NODE$7&&CHROME_VERSION$1>79&&CHROME_VERSION$1<83,FORCED$w=CHROME_BUG$1||!arrayMethodIsStrict$3("reduce");$$2A({target:"Array",proto:!0,forced:FORCED$w},{reduce:function(W){var X=arguments.length;return $reduce$1(this,W,X,X>1?arguments[1]:void 0)}});var $$2z=_export,$reduceRight$1=arrayReduce.right,arrayMethodIsStrict$2=arrayMethodIsStrict$9,CHROME_VERSION=engineV8Version,IS_NODE$6=engineIsNode,CHROME_BUG=!IS_NODE$6&&CHROME_VERSION>79&&CHROME_VERSION<83,FORCED$v=CHROME_BUG||!arrayMethodIsStrict$2("reduceRight");$$2z({target:"Array",proto:!0,forced:FORCED$v},{reduceRight:function(W){return $reduceRight$1(this,W,arguments.length,arguments.length>1?arguments[1]:void 0)}});var $$2y=_export,uncurryThis$15=functionUncurryThis,isArray$9=isArray$g,nativeReverse=uncurryThis$15([].reverse),test$1=[1,2];$$2y({target:"Array",proto:!0,forced:String(test$1)===String(test$1.reverse())},{reverse:function(){return isArray$9(this)&&(this.length=this.length),nativeReverse(this)}});var $$2x=_export,isArray$8=isArray$g,isConstructor$2=isConstructor$6,isObject$u=isObject$G,toAbsoluteIndex$5=toAbsoluteIndex$9,lengthOfArrayLike$c=lengthOfArrayLike$s,toIndexedObject$9=toIndexedObject$j,createProperty$4=createProperty$8,wellKnownSymbol$h=wellKnownSymbol$z,arrayMethodHasSpeciesSupport$1=arrayMethodHasSpeciesSupport$5,nativeSlice=arraySlice$a,HAS_SPECIES_SUPPORT$1=arrayMethodHasSpeciesSupport$1("slice"),SPECIES$4=wellKnownSymbol$h("species"),$Array$6=Array,max$5=Math.max;$$2x({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$1},{slice:function(W,X){var V=toIndexedObject$9(this),Z=lengthOfArrayLike$c(V),re=toAbsoluteIndex$5(W,Z),se=toAbsoluteIndex$5(X===void 0?Z:X,Z),ue,H,ye;if(isArray$8(V)&&(ue=V.constructor,isConstructor$2(ue)&&(ue===$Array$6||isArray$8(ue.prototype))?ue=void 0:isObject$u(ue)&&(ue=ue[SPECIES$4],ue===null&&(ue=void 0)),ue===$Array$6||ue===void 0))return nativeSlice(V,re,se);for(H=new(ue===void 0?$Array$6:ue)(max$5(se-re,0)),ye=0;re<se;re++,ye++)re in V&&createProperty$4(H,ye,V[re]);return H.length=ye,H}});var $$2w=_export,$some$1=arrayIteration.some,arrayMethodIsStrict$1=arrayMethodIsStrict$9,STRICT_METHOD$1=arrayMethodIsStrict$1("some");$$2w({target:"Array",proto:!0,forced:!STRICT_METHOD$1},{some:function(W){return $some$1(this,W,arguments.length>1?arguments[1]:void 0)}});var arraySlice$7=arraySlice$a,floor$9=Math.floor,sort$2=function(G,W){var X=G.length;if(X<8)for(var V=1,Z,re;V<X;){for(re=V,Z=G[V];re&&W(G[re-1],Z)>0;)G[re]=G[--re];re!==V++&&(G[re]=Z)}else for(var se=floor$9(X/2),ue=sort$2(arraySlice$7(G,0,se),W),H=sort$2(arraySlice$7(G,se),W),ye=ue.length,Ie=H.length,Ee=0,Fe=0;Ee<ye||Fe<Ie;)G[Ee+Fe]=Ee<ye&&Fe<Ie?W(ue[Ee],H[Fe])<=0?ue[Ee++]:H[Fe++]:Ee<ye?ue[Ee++]:H[Fe++];return G},arraySort$1=sort$2,userAgent$5=engineUserAgent,firefox=userAgent$5.match(/firefox\/(\d+)/i),engineFfVersion=!!firefox&&+firefox[1],UA=engineUserAgent,engineIsIeOrEdge=/MSIE|Trident/.test(UA),userAgent$4=engineUserAgent,webkit=userAgent$4.match(/AppleWebKit\/(\d+)\./),engineWebkitVersion=!!webkit&&+webkit[1],$$2v=_export,uncurryThis$14=functionUncurryThis,aCallable$g=aCallable$n,toObject$e=toObject$t,lengthOfArrayLike$b=lengthOfArrayLike$s,deletePropertyOrThrow$2=deletePropertyOrThrow$4,toString$z=toString$E,fails$11=fails$1p,internalSort$1=arraySort$1,arrayMethodIsStrict=arrayMethodIsStrict$9,FF$1=engineFfVersion,IE_OR_EDGE$1=engineIsIeOrEdge,V8$2=engineV8Version,WEBKIT$2=engineWebkitVersion,test=[],nativeSort$1=uncurryThis$14(test.sort),push$c=uncurryThis$14(test.push),FAILS_ON_UNDEFINED=fails$11(function(){test.sort(void 0)}),FAILS_ON_NULL=fails$11(function(){test.sort(null)}),STRICT_METHOD=arrayMethodIsStrict("sort"),STABLE_SORT$1=!fails$11(function(){if(V8$2)return V8$2<70;if(!(FF$1&&FF$1>3)){if(IE_OR_EDGE$1)return!0;if(WEBKIT$2)return WEBKIT$2<603;var G="",W,X,V,Z;for(W=65;W<76;W++){switch(X=String.fromCharCode(W),W){case 66:case 69:case 70:case 72:V=3;break;case 68:case 71:V=4;break;default:V=2}for(Z=0;Z<47;Z++)test.push({k:X+Z,v:V})}for(test.sort(function(re,se){return se.v-re.v}),Z=0;Z<test.length;Z++)X=test[Z].k.charAt(0),G.charAt(G.length-1)!==X&&(G+=X);return G!=="DGBEFHACIJK"}}),FORCED$u=FAILS_ON_UNDEFINED||!FAILS_ON_NULL||!STRICT_METHOD||!STABLE_SORT$1,getSortCompare$1=function(G){return function(W,X){return X===void 0?-1:W===void 0?1:G!==void 0?+G(W,X)||0:toString$z(W)>toString$z(X)?1:-1}};$$2v({target:"Array",proto:!0,forced:FORCED$u},{sort:function(W){W!==void 0&&aCallable$g(W);var X=toObject$e(this);if(STABLE_SORT$1)return W===void 0?nativeSort$1(X):nativeSort$1(X,W);var V=[],Z=lengthOfArrayLike$b(X),re,se;for(se=0;se<Z;se++)se in X&&push$c(V,X[se]);for(internalSort$1(V,getSortCompare$1(W)),re=lengthOfArrayLike$b(V),se=0;se<re;)X[se]=V[se++];for(;se<Z;)deletePropertyOrThrow$2(X,se++);return X}});var getBuiltIn$e=getBuiltIn$p,defineBuiltInAccessor$f=defineBuiltInAccessor$i,wellKnownSymbol$g=wellKnownSymbol$z,DESCRIPTORS$x=descriptors,SPECIES$3=wellKnownSymbol$g("species"),setSpecies$6=function(G){var W=getBuiltIn$e(G);DESCRIPTORS$x&&W&&!W[SPECIES$3]&&defineBuiltInAccessor$f(W,SPECIES$3,{configurable:!0,get:function(){return this}})},setSpecies$5=setSpecies$6;setSpecies$5("Array");var $$2u=_export,toObject$d=toObject$t,toAbsoluteIndex$4=toAbsoluteIndex$9,toIntegerOrInfinity$f=toIntegerOrInfinity$l,lengthOfArrayLike$a=lengthOfArrayLike$s,setArrayLength$1=arraySetLength,doesNotExceedSafeInteger$2=doesNotExceedSafeInteger$6,arraySpeciesCreate=arraySpeciesCreate$5,createProperty$3=createProperty$8,deletePropertyOrThrow$1=deletePropertyOrThrow$4,arrayMethodHasSpeciesSupport=arrayMethodHasSpeciesSupport$5,HAS_SPECIES_SUPPORT=arrayMethodHasSpeciesSupport("splice"),max$4=Math.max,min$7=Math.min;$$2u({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT},{splice:function(W,X){var V=toObject$d(this),Z=lengthOfArrayLike$a(V),re=toAbsoluteIndex$4(W,Z),se=arguments.length,ue,H,ye,Ie,Ee,Fe;for(se===0?ue=H=0:se===1?(ue=0,H=Z-re):(ue=se-2,H=min$7(max$4(toIntegerOrInfinity$f(X),0),Z-re)),doesNotExceedSafeInteger$2(Z+ue-H),ye=arraySpeciesCreate(V,H),Ie=0;Ie<H;Ie++)Ee=re+Ie,Ee in V&&createProperty$3(ye,Ie,V[Ee]);if(ye.length=H,ue<H){for(Ie=re;Ie<Z-H;Ie++)Ee=Ie+H,Fe=Ie+ue,Ee in V?V[Fe]=V[Ee]:deletePropertyOrThrow$1(V,Fe);for(Ie=Z;Ie>Z-H+ue;Ie--)deletePropertyOrThrow$1(V,Ie-1)}else if(ue>H)for(Ie=Z-H;Ie>re;Ie--)Ee=Ie+H-1,Fe=Ie+ue-1,Ee in V?V[Fe]=V[Ee]:deletePropertyOrThrow$1(V,Fe);for(Ie=0;Ie<ue;Ie++)V[Ie+re]=arguments[Ie+2];return setArrayLength$1(V,Z-H+ue),ye}});var lengthOfArrayLike$9=lengthOfArrayLike$s,arrayToReversed$2=function(G,W){for(var X=lengthOfArrayLike$9(G),V=new W(X),Z=0;Z<X;Z++)V[Z]=G[X-Z-1];return V},$$2t=_export,arrayToReversed$1=arrayToReversed$2,toIndexedObject$8=toIndexedObject$j,addToUnscopables$4=addToUnscopables$e,$Array$5=Array;$$2t({target:"Array",proto:!0},{toReversed:function(){return arrayToReversed$1(toIndexedObject$8(this),$Array$5)}});addToUnscopables$4("toReversed");var lengthOfArrayLike$8=lengthOfArrayLike$s,arrayFromConstructorAndList$4=function(G,W,X){for(var V=0,Z=arguments.length>2?X:lengthOfArrayLike$8(W),re=new G(Z);Z>V;)re[V]=W[V++];return re},global$N=global$10,getBuiltInPrototypeMethod$1=function(G,W){var X=global$N[G],V=X&&X.prototype;return V&&V[W]},$$2s=_export,uncurryThis$13=functionUncurryThis,aCallable$f=aCallable$n,toIndexedObject$7=toIndexedObject$j,arrayFromConstructorAndList$3=arrayFromConstructorAndList$4,getBuiltInPrototypeMethod=getBuiltInPrototypeMethod$1,addToUnscopables$3=addToUnscopables$e,$Array$4=Array,sort$1=uncurryThis$13(getBuiltInPrototypeMethod("Array","sort"));$$2s({target:"Array",proto:!0},{toSorted:function(W){W!==void 0&&aCallable$f(W);var X=toIndexedObject$7(this),V=arrayFromConstructorAndList$3($Array$4,X);return sort$1(V,W)}});addToUnscopables$3("toSorted");var $$2r=_export,addToUnscopables$2=addToUnscopables$e,doesNotExceedSafeInteger$1=doesNotExceedSafeInteger$6,lengthOfArrayLike$7=lengthOfArrayLike$s,toAbsoluteIndex$3=toAbsoluteIndex$9,toIndexedObject$6=toIndexedObject$j,toIntegerOrInfinity$e=toIntegerOrInfinity$l,$Array$3=Array,max$3=Math.max,min$6=Math.min;$$2r({target:"Array",proto:!0},{toSpliced:function(W,X){var V=toIndexedObject$6(this),Z=lengthOfArrayLike$7(V),re=toAbsoluteIndex$3(W,Z),se=arguments.length,ue=0,H,ye,Ie,Ee;for(se===0?H=ye=0:se===1?(H=0,ye=Z-re):(H=se-2,ye=min$6(max$3(toIntegerOrInfinity$e(X),0),Z-re)),Ie=doesNotExceedSafeInteger$1(Z+H-ye),Ee=$Array$3(Ie);ue<re;ue++)Ee[ue]=V[ue];for(;ue<re+H;ue++)Ee[ue]=arguments[ue-re+2];for(;ue<Ie;ue++)Ee[ue]=V[ue+ye-H];return Ee}});addToUnscopables$2("toSpliced");var addToUnscopables$1=addToUnscopables$e;addToUnscopables$1("flat");var addToUnscopables=addToUnscopables$e;addToUnscopables("flatMap");var $$2q=_export,toObject$c=toObject$t,lengthOfArrayLike$6=lengthOfArrayLike$s,setArrayLength=arraySetLength,deletePropertyOrThrow=deletePropertyOrThrow$4,doesNotExceedSafeInteger=doesNotExceedSafeInteger$6,INCORRECT_RESULT=[].unshift(0)!==1,properErrorOnNonWritableLength=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(G){return G instanceof TypeError}},FORCED$t=INCORRECT_RESULT||!properErrorOnNonWritableLength();$$2q({target:"Array",proto:!0,arity:1,forced:FORCED$t},{unshift:function(W){var X=toObject$c(this),V=lengthOfArrayLike$6(X),Z=arguments.length;if(Z){doesNotExceedSafeInteger(V+Z);for(var re=V;re--;){var se=re+Z;re in X?X[se]=X[re]:deletePropertyOrThrow(X,se)}for(var ue=0;ue<Z;ue++)X[ue]=arguments[ue]}return setArrayLength(X,V+Z)}});var lengthOfArrayLike$5=lengthOfArrayLike$s,toIntegerOrInfinity$d=toIntegerOrInfinity$l,$RangeError$9=RangeError,arrayWith$2=function(G,W,X,V){var Z=lengthOfArrayLike$5(G),re=toIntegerOrInfinity$d(X),se=re<0?Z+re:re;if(se>=Z||se<0)throw new $RangeError$9("Incorrect index");for(var ue=new W(Z),H=0;H<Z;H++)ue[H]=H===se?V:G[H];return ue},$$2p=_export,arrayWith$1=arrayWith$2,toIndexedObject$5=toIndexedObject$j,$Array$2=Array;$$2p({target:"Array",proto:!0},{with:function(G,W){return arrayWith$1(toIndexedObject$5(this),$Array$2,G,W)}});var arrayBufferBasicDetection=typeof ArrayBuffer<"u"&&typeof DataView<"u",defineBuiltIn$h=defineBuiltIn$o,defineBuiltIns$5=function(G,W,X){for(var V in W)defineBuiltIn$h(G,V,W[V],X);return G},isPrototypeOf$6=objectIsPrototypeOf,$TypeError$d=TypeError,anInstance$a=function(G,W){if(isPrototypeOf$6(W,G))return G;throw new $TypeError$d("Incorrect invocation")},toIntegerOrInfinity$c=toIntegerOrInfinity$l,toLength$b=toLength$d,$RangeError$8=RangeError,toIndex$3=function(G){if(G===void 0)return 0;var W=toIntegerOrInfinity$c(G),X=toLength$b(W);if(W!==X)throw new $RangeError$8("Wrong length or index");return X},mathSign=Math.sign||function(W){var X=+W;return X===0||X!==X?X:X<0?-1:1},sign$2=mathSign,abs$8=Math.abs,EPSILON=2220446049250313e-31,INVERSE_EPSILON=1/EPSILON,roundTiesToEven=function(G){return G+INVERSE_EPSILON-INVERSE_EPSILON},mathFloatRound=function(G,W,X,V){var Z=+G,re=abs$8(Z),se=sign$2(Z);if(re<V)return se*roundTiesToEven(re/V/W)*V*W;var ue=(1+W/EPSILON)*re,H=ue-(ue-re);return H>X||H!==H?se*(1/0):se*H},floatRound=mathFloatRound,FLOAT32_EPSILON=11920928955078125e-23,FLOAT32_MAX_VALUE=34028234663852886e22,FLOAT32_MIN_VALUE=11754943508222875e-54,mathFround=Math.fround||function(W){return floatRound(W,FLOAT32_EPSILON,FLOAT32_MAX_VALUE,FLOAT32_MIN_VALUE)},$Array$1=Array,abs$7=Math.abs,pow$4=Math.pow,floor$8=Math.floor,log$8=Math.log,LN2$2=Math.LN2,pack=function(G,W,X){var V=$Array$1(X),Z=X*8-W-1,re=(1<<Z)-1,se=re>>1,ue=W===23?pow$4(2,-24)-pow$4(2,-77):0,H=G<0||G===0&&1/G<0?1:0,ye=0,Ie,Ee,Fe;for(G=abs$7(G),G!==G||G===1/0?(Ee=G!==G?1:0,Ie=re):(Ie=floor$8(log$8(G)/LN2$2),Fe=pow$4(2,-Ie),G*Fe<1&&(Ie--,Fe*=2),Ie+se>=1?G+=ue/Fe:G+=ue*pow$4(2,1-se),G*Fe>=2&&(Ie++,Fe/=2),Ie+se>=re?(Ee=0,Ie=re):Ie+se>=1?(Ee=(G*Fe-1)*pow$4(2,W),Ie+=se):(Ee=G*pow$4(2,se-1)*pow$4(2,W),Ie=0));W>=8;)V[ye++]=Ee&255,Ee/=256,W-=8;for(Ie=Ie<<W|Ee,Z+=W;Z>0;)V[ye++]=Ie&255,Ie/=256,Z-=8;return V[--ye]|=H*128,V},unpack=function(G,W){var X=G.length,V=X*8-W-1,Z=(1<<V)-1,re=Z>>1,se=V-7,ue=X-1,H=G[ue--],ye=H&127,Ie;for(H>>=7;se>0;)ye=ye*256+G[ue--],se-=8;for(Ie=ye&(1<<-se)-1,ye>>=-se,se+=W;se>0;)Ie=Ie*256+G[ue--],se-=8;if(ye===0)ye=1-re;else{if(ye===Z)return Ie?NaN:H?-1/0:1/0;Ie+=pow$4(2,W),ye-=re}return(H?-1:1)*Ie*pow$4(2,ye-W)},ieee754$1={pack,unpack},global$M=global$10,uncurryThis$12=functionUncurryThis,DESCRIPTORS$w=descriptors,NATIVE_ARRAY_BUFFER$2=arrayBufferBasicDetection,FunctionName=functionName,createNonEnumerableProperty$7=createNonEnumerableProperty$f,defineBuiltInAccessor$e=defineBuiltInAccessor$i,defineBuiltIns$4=defineBuiltIns$5,fails$10=fails$1p,anInstance$9=anInstance$a,toIntegerOrInfinity$b=toIntegerOrInfinity$l,toLength$a=toLength$d,toIndex$2=toIndex$3,fround$1=mathFround,IEEE754=ieee754$1,getPrototypeOf$6=objectGetPrototypeOf$2,setPrototypeOf$5=objectSetPrototypeOf$1,arrayFill=arrayFill$1,arraySlice$6=arraySlice$a,inheritIfRequired$5=inheritIfRequired$7,copyConstructorProperties$1=copyConstructorProperties$6,setToStringTag$9=setToStringTag$e,InternalStateModule$a=internalState,PROPER_FUNCTION_NAME$2=FunctionName.PROPER,CONFIGURABLE_FUNCTION_NAME=FunctionName.CONFIGURABLE,ARRAY_BUFFER$1="ArrayBuffer",DATA_VIEW="DataView",PROTOTYPE="prototype",WRONG_LENGTH$1="Wrong length",WRONG_INDEX="Wrong index",getInternalArrayBufferState=InternalStateModule$a.getterFor(ARRAY_BUFFER$1),getInternalDataViewState=InternalStateModule$a.getterFor(DATA_VIEW),setInternalState$9=InternalStateModule$a.set,NativeArrayBuffer$1=global$M[ARRAY_BUFFER$1],$ArrayBuffer$1=NativeArrayBuffer$1,ArrayBufferPrototype$3=$ArrayBuffer$1&&$ArrayBuffer$1[PROTOTYPE],$DataView=global$M[DATA_VIEW],DataViewPrototype$2=$DataView&&$DataView[PROTOTYPE],ObjectPrototype$3=Object.prototype,Array$2=global$M.Array,RangeError$3=global$M.RangeError,fill=uncurryThis$12(arrayFill),reverse=uncurryThis$12([].reverse),packIEEE754=IEEE754.pack,unpackIEEE754=IEEE754.unpack,packInt8=function(G){return[G&255]},packInt16=function(G){return[G&255,G>>8&255]},packInt32=function(G){return[G&255,G>>8&255,G>>16&255,G>>24&255]},unpackInt32=function(G){return G[3]<<24|G[2]<<16|G[1]<<8|G[0]},packFloat32=function(G){return packIEEE754(fround$1(G),23,4)},packFloat64=function(G){return packIEEE754(G,52,8)},addGetter$1=function(G,W,X){defineBuiltInAccessor$e(G[PROTOTYPE],W,{configurable:!0,get:function(){return X(this)[W]}})},get$2=function(G,W,X,V){var Z=getInternalDataViewState(G),re=toIndex$2(X),se=!!V;if(re+W>Z.byteLength)throw new RangeError$3(WRONG_INDEX);var ue=Z.bytes,H=re+Z.byteOffset,ye=arraySlice$6(ue,H,H+W);return se?ye:reverse(ye)},set$3=function(G,W,X,V,Z,re){var se=getInternalDataViewState(G),ue=toIndex$2(X),H=V(+Z),ye=!!re;if(ue+W>se.byteLength)throw new RangeError$3(WRONG_INDEX);for(var Ie=se.bytes,Ee=ue+se.byteOffset,Fe=0;Fe<W;Fe++)Ie[Ee+Fe]=H[ye?Fe:W-Fe-1]};if(!NATIVE_ARRAY_BUFFER$2)$ArrayBuffer$1=function(W){anInstance$9(this,ArrayBufferPrototype$3);var X=toIndex$2(W);setInternalState$9(this,{type:ARRAY_BUFFER$1,bytes:fill(Array$2(X),0),byteLength:X}),DESCRIPTORS$w||(this.byteLength=X,this.detached=!1)},ArrayBufferPrototype$3=$ArrayBuffer$1[PROTOTYPE],$DataView=function(W,X,V){anInstance$9(this,DataViewPrototype$2),anInstance$9(W,ArrayBufferPrototype$3);var Z=getInternalArrayBufferState(W),re=Z.byteLength,se=toIntegerOrInfinity$b(X);if(se<0||se>re)throw new RangeError$3("Wrong offset");if(V=V===void 0?re-se:toLength$a(V),se+V>re)throw new RangeError$3(WRONG_LENGTH$1);setInternalState$9(this,{type:DATA_VIEW,buffer:W,byteLength:V,byteOffset:se,bytes:Z.bytes}),DESCRIPTORS$w||(this.buffer=W,this.byteLength=V,this.byteOffset=se)},DataViewPrototype$2=$DataView[PROTOTYPE],DESCRIPTORS$w&&(addGetter$1($ArrayBuffer$1,"byteLength",getInternalArrayBufferState),addGetter$1($DataView,"buffer",getInternalDataViewState),addGetter$1($DataView,"byteLength",getInternalDataViewState),addGetter$1($DataView,"byteOffset",getInternalDataViewState)),defineBuiltIns$4(DataViewPrototype$2,{getInt8:function(W){return get$2(this,1,W)[0]<<24>>24},getUint8:function(W){return get$2(this,1,W)[0]},getInt16:function(W){var X=get$2(this,2,W,arguments.length>1?arguments[1]:!1);return(X[1]<<8|X[0])<<16>>16},getUint16:function(W){var X=get$2(this,2,W,arguments.length>1?arguments[1]:!1);return X[1]<<8|X[0]},getInt32:function(W){return unpackInt32(get$2(this,4,W,arguments.length>1?arguments[1]:!1))},getUint32:function(W){return unpackInt32(get$2(this,4,W,arguments.length>1?arguments[1]:!1))>>>0},getFloat32:function(W){return unpackIEEE754(get$2(this,4,W,arguments.length>1?arguments[1]:!1),23)},getFloat64:function(W){return unpackIEEE754(get$2(this,8,W,arguments.length>1?arguments[1]:!1),52)},setInt8:function(W,X){set$3(this,1,W,packInt8,X)},setUint8:function(W,X){set$3(this,1,W,packInt8,X)},setInt16:function(W,X){set$3(this,2,W,packInt16,X,arguments.length>2?arguments[2]:!1)},setUint16:function(W,X){set$3(this,2,W,packInt16,X,arguments.length>2?arguments[2]:!1)},setInt32:function(W,X){set$3(this,4,W,packInt32,X,arguments.length>2?arguments[2]:!1)},setUint32:function(W,X){set$3(this,4,W,packInt32,X,arguments.length>2?arguments[2]:!1)},setFloat32:function(W,X){set$3(this,4,W,packFloat32,X,arguments.length>2?arguments[2]:!1)},setFloat64:function(W,X){set$3(this,8,W,packFloat64,X,arguments.length>2?arguments[2]:!1)}});else{var INCORRECT_ARRAY_BUFFER_NAME=PROPER_FUNCTION_NAME$2&&NativeArrayBuffer$1.name!==ARRAY_BUFFER$1;!fails$10(function(){NativeArrayBuffer$1(1)})||!fails$10(function(){new NativeArrayBuffer$1(-1)})||fails$10(function(){return new NativeArrayBuffer$1,new NativeArrayBuffer$1(1.5),new NativeArrayBuffer$1(NaN),NativeArrayBuffer$1.length!==1||INCORRECT_ARRAY_BUFFER_NAME&&!CONFIGURABLE_FUNCTION_NAME})?($ArrayBuffer$1=function(W){return anInstance$9(this,ArrayBufferPrototype$3),inheritIfRequired$5(new NativeArrayBuffer$1(toIndex$2(W)),this,$ArrayBuffer$1)},$ArrayBuffer$1[PROTOTYPE]=ArrayBufferPrototype$3,ArrayBufferPrototype$3.constructor=$ArrayBuffer$1,copyConstructorProperties$1($ArrayBuffer$1,NativeArrayBuffer$1)):INCORRECT_ARRAY_BUFFER_NAME&&CONFIGURABLE_FUNCTION_NAME&&createNonEnumerableProperty$7(NativeArrayBuffer$1,"name",ARRAY_BUFFER$1),setPrototypeOf$5&&getPrototypeOf$6(DataViewPrototype$2)!==ObjectPrototype$3&&setPrototypeOf$5(DataViewPrototype$2,ObjectPrototype$3);var testView=new $DataView(new $ArrayBuffer$1(2)),$setInt8=uncurryThis$12(DataViewPrototype$2.setInt8);testView.setInt8(0,2147483648),testView.setInt8(1,2147483649),(testView.getInt8(0)||!testView.getInt8(1))&&defineBuiltIns$4(DataViewPrototype$2,{setInt8:function(W,X){$setInt8(this,W,X<<24>>24)},setUint8:function(W,X){$setInt8(this,W,X<<24>>24)}},{unsafe:!0})}setToStringTag$9($ArrayBuffer$1,ARRAY_BUFFER$1);setToStringTag$9($DataView,DATA_VIEW);var arrayBuffer={ArrayBuffer:$ArrayBuffer$1,DataView:$DataView},$$2o=_export,global$L=global$10,arrayBufferModule=arrayBuffer,setSpecies$4=setSpecies$6,ARRAY_BUFFER="ArrayBuffer",ArrayBuffer$5=arrayBufferModule[ARRAY_BUFFER],NativeArrayBuffer=global$L[ARRAY_BUFFER];$$2o({global:!0,constructor:!0,forced:NativeArrayBuffer!==ArrayBuffer$5},{ArrayBuffer:ArrayBuffer$5});setSpecies$4(ARRAY_BUFFER);var NATIVE_ARRAY_BUFFER$1=arrayBufferBasicDetection,DESCRIPTORS$v=descriptors,global$K=global$10,isCallable$e=isCallable$y,isObject$t=isObject$G,hasOwn$h=hasOwnProperty_1,classof$f=classof$n,tryToString$1=tryToString$7,createNonEnumerableProperty$6=createNonEnumerableProperty$f,defineBuiltIn$g=defineBuiltIn$o,defineBuiltInAccessor$d=defineBuiltInAccessor$i,isPrototypeOf$5=objectIsPrototypeOf,getPrototypeOf$5=objectGetPrototypeOf$2,setPrototypeOf$4=objectSetPrototypeOf$1,wellKnownSymbol$f=wellKnownSymbol$z,uid$2=uid$6,InternalStateModule$9=internalState,enforceInternalState$3=InternalStateModule$9.enforce,getInternalState$7=InternalStateModule$9.get,Int8Array$4=global$K.Int8Array,Int8ArrayPrototype$1=Int8Array$4&&Int8Array$4.prototype,Uint8ClampedArray$1=global$K.Uint8ClampedArray,Uint8ClampedArrayPrototype=Uint8ClampedArray$1&&Uint8ClampedArray$1.prototype,TypedArray$1=Int8Array$4&&getPrototypeOf$5(Int8Array$4),TypedArrayPrototype$2=Int8ArrayPrototype$1&&getPrototypeOf$5(Int8ArrayPrototype$1),ObjectPrototype$2=Object.prototype,TypeError$7=global$K.TypeError,TO_STRING_TAG=wellKnownSymbol$f("toStringTag"),TYPED_ARRAY_TAG$1=uid$2("TYPED_ARRAY_TAG"),TYPED_ARRAY_CONSTRUCTOR="TypedArrayConstructor",NATIVE_ARRAY_BUFFER_VIEWS$3=NATIVE_ARRAY_BUFFER$1&&!!setPrototypeOf$4&&classof$f(global$K.opera)!=="Opera",TYPED_ARRAY_TAG_REQUIRED=!1,NAME$1,Constructor,Prototype,TypedArrayConstructorsList={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},BigIntArrayConstructorsList={BigInt64Array:8,BigUint64Array:8},isView=function(W){if(!isObject$t(W))return!1;var X=classof$f(W);return X==="DataView"||hasOwn$h(TypedArrayConstructorsList,X)||hasOwn$h(BigIntArrayConstructorsList,X)},getTypedArrayConstructor$4=function(G){var W=getPrototypeOf$5(G);if(isObject$t(W)){var X=getInternalState$7(W);return X&&hasOwn$h(X,TYPED_ARRAY_CONSTRUCTOR)?X[TYPED_ARRAY_CONSTRUCTOR]:getTypedArrayConstructor$4(W)}},isTypedArray$1=function(G){if(!isObject$t(G))return!1;var W=classof$f(G);return hasOwn$h(TypedArrayConstructorsList,W)||hasOwn$h(BigIntArrayConstructorsList,W)},aTypedArray$s=function(G){if(isTypedArray$1(G))return G;throw new TypeError$7("Target is not a typed array")},aTypedArrayConstructor$3=function(G){if(isCallable$e(G)&&(!setPrototypeOf$4||isPrototypeOf$5(TypedArray$1,G)))return G;throw new TypeError$7(tryToString$1(G)+" is not a typed array constructor")},exportTypedArrayMethod$t=function(G,W,X,V){if(DESCRIPTORS$v){if(X)for(var Z in TypedArrayConstructorsList){var re=global$K[Z];if(re&&hasOwn$h(re.prototype,G))try{delete re.prototype[G]}catch{try{re.prototype[G]=W}catch{}}}(!TypedArrayPrototype$2[G]||X)&&defineBuiltIn$g(TypedArrayPrototype$2,G,X?W:NATIVE_ARRAY_BUFFER_VIEWS$3&&Int8ArrayPrototype$1[G]||W,V)}},exportTypedArrayStaticMethod$2=function(G,W,X){var V,Z;if(DESCRIPTORS$v){if(setPrototypeOf$4){if(X){for(V in TypedArrayConstructorsList)if(Z=global$K[V],Z&&hasOwn$h(Z,G))try{delete Z[G]}catch{}}if(!TypedArray$1[G]||X)try{return defineBuiltIn$g(TypedArray$1,G,X?W:NATIVE_ARRAY_BUFFER_VIEWS$3&&TypedArray$1[G]||W)}catch{}else return}for(V in TypedArrayConstructorsList)Z=global$K[V],Z&&(!Z[G]||X)&&defineBuiltIn$g(Z,G,W)}};for(NAME$1 in TypedArrayConstructorsList)Constructor=global$K[NAME$1],Prototype=Constructor&&Constructor.prototype,Prototype?enforceInternalState$3(Prototype)[TYPED_ARRAY_CONSTRUCTOR]=Constructor:NATIVE_ARRAY_BUFFER_VIEWS$3=!1;for(NAME$1 in BigIntArrayConstructorsList)Constructor=global$K[NAME$1],Prototype=Constructor&&Constructor.prototype,Prototype&&(enforceInternalState$3(Prototype)[TYPED_ARRAY_CONSTRUCTOR]=Constructor);if((!NATIVE_ARRAY_BUFFER_VIEWS$3||!isCallable$e(TypedArray$1)||TypedArray$1===Function.prototype)&&(TypedArray$1=function(){throw new TypeError$7("Incorrect invocation")},NATIVE_ARRAY_BUFFER_VIEWS$3))for(NAME$1 in TypedArrayConstructorsList)global$K[NAME$1]&&setPrototypeOf$4(global$K[NAME$1],TypedArray$1);if((!NATIVE_ARRAY_BUFFER_VIEWS$3||!TypedArrayPrototype$2||TypedArrayPrototype$2===ObjectPrototype$2)&&(TypedArrayPrototype$2=TypedArray$1.prototype,NATIVE_ARRAY_BUFFER_VIEWS$3))for(NAME$1 in TypedArrayConstructorsList)global$K[NAME$1]&&setPrototypeOf$4(global$K[NAME$1].prototype,TypedArrayPrototype$2);NATIVE_ARRAY_BUFFER_VIEWS$3&&getPrototypeOf$5(Uint8ClampedArrayPrototype)!==TypedArrayPrototype$2&&setPrototypeOf$4(Uint8ClampedArrayPrototype,TypedArrayPrototype$2);if(DESCRIPTORS$v&&!hasOwn$h(TypedArrayPrototype$2,TO_STRING_TAG)){TYPED_ARRAY_TAG_REQUIRED=!0,defineBuiltInAccessor$d(TypedArrayPrototype$2,TO_STRING_TAG,{configurable:!0,get:function(){return isObject$t(this)?this[TYPED_ARRAY_TAG$1]:void 0}});for(NAME$1 in TypedArrayConstructorsList)global$K[NAME$1]&&createNonEnumerableProperty$6(global$K[NAME$1],TYPED_ARRAY_TAG$1,NAME$1)}var arrayBufferViewCore={NATIVE_ARRAY_BUFFER_VIEWS:NATIVE_ARRAY_BUFFER_VIEWS$3,TYPED_ARRAY_TAG:TYPED_ARRAY_TAG_REQUIRED&&TYPED_ARRAY_TAG$1,aTypedArray:aTypedArray$s,aTypedArrayConstructor:aTypedArrayConstructor$3,exportTypedArrayMethod:exportTypedArrayMethod$t,exportTypedArrayStaticMethod:exportTypedArrayStaticMethod$2,getTypedArrayConstructor:getTypedArrayConstructor$4,isView,isTypedArray:isTypedArray$1,TypedArray:TypedArray$1,TypedArrayPrototype:TypedArrayPrototype$2},$$2n=_export,ArrayBufferViewCore$v=arrayBufferViewCore,NATIVE_ARRAY_BUFFER_VIEWS$2=ArrayBufferViewCore$v.NATIVE_ARRAY_BUFFER_VIEWS;$$2n({target:"ArrayBuffer",stat:!0,forced:!NATIVE_ARRAY_BUFFER_VIEWS$2},{isView:ArrayBufferViewCore$v.isView});var isConstructor$1=isConstructor$6,tryToString=tryToString$7,$TypeError$c=TypeError,aConstructor$3=function(G){if(isConstructor$1(G))return G;throw new $TypeError$c(tryToString(G)+" is not a constructor")},anObject$r=anObject$D,aConstructor$2=aConstructor$3,isNullOrUndefined$b=isNullOrUndefined$f,wellKnownSymbol$e=wellKnownSymbol$z,SPECIES$2=wellKnownSymbol$e("species"),speciesConstructor$6=function(G,W){var X=anObject$r(G).constructor,V;return X===void 0||isNullOrUndefined$b(V=anObject$r(X)[SPECIES$2])?W:aConstructor$2(V)},$$2m=_export,uncurryThis$11=functionUncurryThisClause,fails$$=fails$1p,ArrayBufferModule$2=arrayBuffer,anObject$q=anObject$D,toAbsoluteIndex$2=toAbsoluteIndex$9,toLength$9=toLength$d,speciesConstructor$5=speciesConstructor$6,ArrayBuffer$4=ArrayBufferModule$2.ArrayBuffer,DataView$3=ArrayBufferModule$2.DataView,DataViewPrototype$1=DataView$3.prototype,nativeArrayBufferSlice=uncurryThis$11(ArrayBuffer$4.prototype.slice),getUint8=uncurryThis$11(DataViewPrototype$1.getUint8),setUint8=uncurryThis$11(DataViewPrototype$1.setUint8),INCORRECT_SLICE=fails$$(function(){return!new ArrayBuffer$4(2).slice(1,void 0).byteLength});$$2m({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:INCORRECT_SLICE},{slice:function(W,X){if(nativeArrayBufferSlice&&X===void 0)return nativeArrayBufferSlice(anObject$q(this),W);for(var V=anObject$q(this).byteLength,Z=toAbsoluteIndex$2(W,V),re=toAbsoluteIndex$2(X===void 0?V:X,V),se=new(speciesConstructor$5(this,ArrayBuffer$4))(toLength$9(re-Z)),ue=new DataView$3(this),H=new DataView$3(se),ye=0;Z<re;)setUint8(H,ye++,getUint8(ue,Z++));return se}});var $$2l=_export,ArrayBufferModule$1=arrayBuffer,NATIVE_ARRAY_BUFFER=arrayBufferBasicDetection;$$2l({global:!0,constructor:!0,forced:!NATIVE_ARRAY_BUFFER},{DataView:ArrayBufferModule$1.DataView});var uncurryThisAccessor$1=functionUncurryThisAccessor,classof$e=classofRaw$2,$TypeError$b=TypeError,arrayBufferByteLength$2=uncurryThisAccessor$1(ArrayBuffer.prototype,"byteLength","get")||function(G){if(classof$e(G)!=="ArrayBuffer")throw new $TypeError$b("ArrayBuffer expected");return G.byteLength},uncurryThis$10=functionUncurryThis,arrayBufferByteLength$1=arrayBufferByteLength$2,slice$3=uncurryThis$10(ArrayBuffer.prototype.slice),arrayBufferIsDetached=function(G){if(arrayBufferByteLength$1(G)!==0)return!1;try{return slice$3(G,0,0),!1}catch{return!0}},DESCRIPTORS$u=descriptors,defineBuiltInAccessor$c=defineBuiltInAccessor$i,isDetached$1=arrayBufferIsDetached,ArrayBufferPrototype$2=ArrayBuffer.prototype;DESCRIPTORS$u&&!("detached"in ArrayBufferPrototype$2)&&defineBuiltInAccessor$c(ArrayBufferPrototype$2,"detached",{configurable:!0,get:function(){return isDetached$1(this)}});var IS_NODE$5=engineIsNode,tryNodeRequire$2=function(G){try{if(IS_NODE$5)return Function('return require("'+G+'")')()}catch{}},engineIsDeno=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",IS_DENO$2=engineIsDeno,IS_NODE$4=engineIsNode,engineIsBrowser=!IS_DENO$2&&!IS_NODE$4&&typeof window=="object"&&typeof document=="object",global$J=global$10,fails$_=fails$1p,V8$1=engineV8Version,IS_BROWSER$1=engineIsBrowser,IS_DENO$1=engineIsDeno,IS_NODE$3=engineIsNode,structuredClone$2=global$J.structuredClone,structuredCloneProperTransfer=!!structuredClone$2&&!fails$_(function(){if(IS_DENO$1&&V8$1>92||IS_NODE$3&&V8$1>94||IS_BROWSER$1&&V8$1>97)return!1;var G=new ArrayBuffer(8),W=structuredClone$2(G,{transfer:[G]});return G.byteLength!==0||W.byteLength!==8}),global$I=global$10,tryNodeRequire$1=tryNodeRequire$2,PROPER_STRUCTURED_CLONE_TRANSFER$2=structuredCloneProperTransfer,structuredClone$1=global$I.structuredClone,$ArrayBuffer=global$I.ArrayBuffer,$MessageChannel=global$I.MessageChannel,detach=!1,WorkerThreads,channel$1,buffer$1,$detach;if(PROPER_STRUCTURED_CLONE_TRANSFER$2)detach=function(G){structuredClone$1(G,{transfer:[G]})};else if($ArrayBuffer)try{$MessageChannel||(WorkerThreads=tryNodeRequire$1("worker_threads"),WorkerThreads&&($MessageChannel=WorkerThreads.MessageChannel)),$MessageChannel&&(channel$1=new $MessageChannel,buffer$1=new $ArrayBuffer(2),$detach=function(G){channel$1.port1.postMessage(null,[G])},buffer$1.byteLength===2&&($detach(buffer$1),buffer$1.byteLength===0&&(detach=$detach)))}catch{}var detachTransferable$2=detach,global$H=global$10,uncurryThis$$=functionUncurryThis,uncurryThisAccessor=functionUncurryThisAccessor,toIndex$1=toIndex$3,isDetached=arrayBufferIsDetached,arrayBufferByteLength=arrayBufferByteLength$2,detachTransferable$1=detachTransferable$2,PROPER_STRUCTURED_CLONE_TRANSFER$1=structuredCloneProperTransfer,structuredClone=global$H.structuredClone,ArrayBuffer$3=global$H.ArrayBuffer,DataView$2=global$H.DataView,TypeError$6=global$H.TypeError,min$5=Math.min,ArrayBufferPrototype$1=ArrayBuffer$3.prototype,DataViewPrototype=DataView$2.prototype,slice$2=uncurryThis$$(ArrayBufferPrototype$1.slice),isResizable=uncurryThisAccessor(ArrayBufferPrototype$1,"resizable","get"),maxByteLength=uncurryThisAccessor(ArrayBufferPrototype$1,"maxByteLength","get"),getInt8=uncurryThis$$(DataViewPrototype.getInt8),setInt8=uncurryThis$$(DataViewPrototype.setInt8),arrayBufferTransfer=(PROPER_STRUCTURED_CLONE_TRANSFER$1||detachTransferable$1)&&function(G,W,X){var V=arrayBufferByteLength(G),Z=W===void 0?V:toIndex$1(W),re=!isResizable||!isResizable(G),se;if(isDetached(G))throw new TypeError$6("ArrayBuffer is detached");if(PROPER_STRUCTURED_CLONE_TRANSFER$1&&(G=structuredClone(G,{transfer:[G]}),V===Z&&(X||re)))return G;if(V>=Z&&(!X||re))se=slice$2(G,0,Z);else{var ue=X&&!re&&maxByteLength?{maxByteLength:maxByteLength(G)}:void 0;se=new ArrayBuffer$3(Z,ue);for(var H=new DataView$2(G),ye=new DataView$2(se),Ie=min$5(Z,V),Ee=0;Ee<Ie;Ee++)setInt8(ye,Ee,getInt8(H,Ee))}return PROPER_STRUCTURED_CLONE_TRANSFER$1||detachTransferable$1(G),se},$$2k=_export,$transfer$1=arrayBufferTransfer;$transfer$1&&$$2k({target:"ArrayBuffer",proto:!0},{transfer:function(){return $transfer$1(this,arguments.length?arguments[0]:void 0,!0)}});var $$2j=_export,$transfer=arrayBufferTransfer;$transfer&&$$2j({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return $transfer(this,arguments.length?arguments[0]:void 0,!1)}});var $$2i=_export,uncurryThis$_=functionUncurryThis,fails$Z=fails$1p,FORCED$s=fails$Z(function(){return new Date(16e11).getYear()!==120}),getFullYear=uncurryThis$_(Date.prototype.getFullYear);$$2i({target:"Date",proto:!0,forced:FORCED$s},{getYear:function(){return getFullYear(this)-1900}});var $$2h=_export,uncurryThis$Z=functionUncurryThis,$Date=Date,thisTimeValue$4=uncurryThis$Z($Date.prototype.getTime);$$2h({target:"Date",stat:!0},{now:function(){return thisTimeValue$4(new $Date)}});var $$2g=_export,uncurryThis$Y=functionUncurryThis,toIntegerOrInfinity$a=toIntegerOrInfinity$l,DatePrototype$3=Date.prototype,thisTimeValue$3=uncurryThis$Y(DatePrototype$3.getTime),setFullYear=uncurryThis$Y(DatePrototype$3.setFullYear);$$2g({target:"Date",proto:!0},{setYear:function(W){thisTimeValue$3(this);var X=toIntegerOrInfinity$a(W),V=X>=0&&X<=99?X+1900:X;return setFullYear(this,V)}});var $$2f=_export;$$2f({target:"Date",proto:!0},{toGMTString:Date.prototype.toUTCString});var toIntegerOrInfinity$9=toIntegerOrInfinity$l,toString$y=toString$E,requireObjectCoercible$k=requireObjectCoercible$n,$RangeError$7=RangeError,stringRepeat=function(W){var X=toString$y(requireObjectCoercible$k(this)),V="",Z=toIntegerOrInfinity$9(W);if(Z<0||Z===1/0)throw new $RangeError$7("Wrong number of repetitions");for(;Z>0;(Z>>>=1)&&(X+=X))Z&1&&(V+=X);return V},uncurryThis$X=functionUncurryThis,toLength$8=toLength$d,toString$x=toString$E,$repeat$2=stringRepeat,requireObjectCoercible$j=requireObjectCoercible$n,repeat$3=uncurryThis$X($repeat$2),stringSlice$f=uncurryThis$X("".slice),ceil=Math.ceil,createMethod$3=function(G){return function(W,X,V){var Z=toString$x(requireObjectCoercible$j(W)),re=toLength$8(X),se=Z.length,ue=V===void 0?" ":toString$x(V),H,ye;return re<=se||ue===""?Z:(H=re-se,ye=repeat$3(ue,ceil(H/ue.length)),ye.length>H&&(ye=stringSlice$f(ye,0,H)),G?Z+ye:ye+Z)}},stringPad={start:createMethod$3(!1),end:createMethod$3(!0)},uncurryThis$W=functionUncurryThis,fails$Y=fails$1p,padStart=stringPad.start,$RangeError$6=RangeError,$isFinite$1=isFinite,abs$6=Math.abs,DatePrototype$2=Date.prototype,nativeDateToISOString=DatePrototype$2.toISOString,thisTimeValue$2=uncurryThis$W(DatePrototype$2.getTime),getUTCDate=uncurryThis$W(DatePrototype$2.getUTCDate),getUTCFullYear=uncurryThis$W(DatePrototype$2.getUTCFullYear),getUTCHours=uncurryThis$W(DatePrototype$2.getUTCHours),getUTCMilliseconds=uncurryThis$W(DatePrototype$2.getUTCMilliseconds),getUTCMinutes=uncurryThis$W(DatePrototype$2.getUTCMinutes),getUTCMonth=uncurryThis$W(DatePrototype$2.getUTCMonth),getUTCSeconds=uncurryThis$W(DatePrototype$2.getUTCSeconds),dateToIsoString=fails$Y(function(){return nativeDateToISOString.call(new Date(-5e13-1))!=="0385-07-25T07:06:39.999Z"})||!fails$Y(function(){nativeDateToISOString.call(new Date(NaN))})?function(){if(!$isFinite$1(thisTimeValue$2(this)))throw new $RangeError$6("Invalid time value");var W=this,X=getUTCFullYear(W),V=getUTCMilliseconds(W),Z=X<0?"-":X>9999?"+":"";return Z+padStart(abs$6(X),Z?6:4,0)+"-"+padStart(getUTCMonth(W)+1,2,0)+"-"+padStart(getUTCDate(W),2,0)+"T"+padStart(getUTCHours(W),2,0)+":"+padStart(getUTCMinutes(W),2,0)+":"+padStart(getUTCSeconds(W),2,0)+"."+padStart(V,3,0)+"Z"}:nativeDateToISOString,$$2e=_export,toISOString=dateToIsoString;$$2e({target:"Date",proto:!0,forced:Date.prototype.toISOString!==toISOString},{toISOString});var $$2d=_export,fails$X=fails$1p,toObject$b=toObject$t,toPrimitive$2=toPrimitive$4,FORCED$r=fails$X(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});$$2d({target:"Date",proto:!0,arity:1,forced:FORCED$r},{toJSON:function(W){var X=toObject$b(this),V=toPrimitive$2(X,"number");return typeof V=="number"&&!isFinite(V)?null:X.toISOString()}});var anObject$p=anObject$D,ordinaryToPrimitive=ordinaryToPrimitive$2,$TypeError$a=TypeError,dateToPrimitive$1=function(G){if(anObject$p(this),G==="string"||G==="default")G="string";else if(G!=="number")throw new $TypeError$a("Incorrect hint");return ordinaryToPrimitive(this,G)},hasOwn$g=hasOwnProperty_1,defineBuiltIn$f=defineBuiltIn$o,dateToPrimitive=dateToPrimitive$1,wellKnownSymbol$d=wellKnownSymbol$z,TO_PRIMITIVE=wellKnownSymbol$d("toPrimitive"),DatePrototype$1=Date.prototype;hasOwn$g(DatePrototype$1,TO_PRIMITIVE)||defineBuiltIn$f(DatePrototype$1,TO_PRIMITIVE,dateToPrimitive);var uncurryThis$V=functionUncurryThis,defineBuiltIn$e=defineBuiltIn$o,DatePrototype=Date.prototype,INVALID_DATE="Invalid Date",TO_STRING$1="toString",nativeDateToString=uncurryThis$V(DatePrototype[TO_STRING$1]),thisTimeValue$1=uncurryThis$V(DatePrototype.getTime);String(new Date(NaN))!==INVALID_DATE&&defineBuiltIn$e(DatePrototype,TO_STRING$1,function(){var W=thisTimeValue$1(this);return W===W?nativeDateToString(this):INVALID_DATE});var $$2c=_export,uncurryThis$U=functionUncurryThis,toString$w=toString$E,charAt$e=uncurryThis$U("".charAt),charCodeAt$6=uncurryThis$U("".charCodeAt),exec$7=uncurryThis$U(/./.exec),numberToString$1=uncurryThis$U(1 .toString),toUpperCase=uncurryThis$U("".toUpperCase),raw=/[\w*+\-./@]/,hex$1=function(G,W){for(var X=numberToString$1(G,16);X.length<W;)X="0"+X;return X};$$2c({global:!0},{escape:function(W){for(var X=toString$w(W),V="",Z=X.length,re=0,se,ue;re<Z;)se=charAt$e(X,re++),exec$7(raw,se)?V+=se:(ue=charCodeAt$6(se,0),ue<256?V+="%"+hex$1(ue,2):V+="%u"+toUpperCase(hex$1(ue,4)));return V}});var uncurryThis$T=functionUncurryThis,aCallable$e=aCallable$n,isObject$s=isObject$G,hasOwn$f=hasOwnProperty_1,arraySlice$5=arraySlice$a,NATIVE_BIND=functionBindNative,$Function=Function,concat$2=uncurryThis$T([].concat),join$7=uncurryThis$T([].join),factories={},construct=function(G,W,X){if(!hasOwn$f(factories,W)){for(var V=[],Z=0;Z<W;Z++)V[Z]="a["+Z+"]";factories[W]=$Function("C,a","return new C("+join$7(V,",")+")")}return factories[W](G,X)},functionBind=NATIVE_BIND?$Function.bind:function(W){var X=aCallable$e(this),V=X.prototype,Z=arraySlice$5(arguments,1),re=function(){var ue=concat$2(Z,arraySlice$5(arguments));return this instanceof re?construct(X,ue.length,ue):X.apply(W,ue)};return isObject$s(V)&&(re.prototype=V),re},$$2b=_export,bind$8=functionBind;$$2b({target:"Function",proto:!0,forced:Function.bind!==bind$8},{bind:bind$8});var isCallable$d=isCallable$y,isObject$r=isObject$G,definePropertyModule$5=objectDefineProperty,isPrototypeOf$4=objectIsPrototypeOf,wellKnownSymbol$c=wellKnownSymbol$z,makeBuiltIn=makeBuiltInExports,HAS_INSTANCE=wellKnownSymbol$c("hasInstance"),FunctionPrototype$1=Function.prototype;HAS_INSTANCE in FunctionPrototype$1||definePropertyModule$5.f(FunctionPrototype$1,HAS_INSTANCE,{value:makeBuiltIn(function(G){if(!isCallable$d(this)||!isObject$r(G))return!1;var W=this.prototype;return isObject$r(W)?isPrototypeOf$4(W,G):G instanceof this},HAS_INSTANCE)});var DESCRIPTORS$t=descriptors,FUNCTION_NAME_EXISTS=functionName.EXISTS,uncurryThis$S=functionUncurryThis,defineBuiltInAccessor$b=defineBuiltInAccessor$i,FunctionPrototype=Function.prototype,functionToString$1=uncurryThis$S(FunctionPrototype.toString),nameRE=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,regExpExec$5=uncurryThis$S(nameRE.exec),NAME="name";DESCRIPTORS$t&&!FUNCTION_NAME_EXISTS&&defineBuiltInAccessor$b(FunctionPrototype,NAME,{configurable:!0,get:function(){try{return regExpExec$5(nameRE,functionToString$1(this))[1]}catch{return""}}});var $$2a=_export,global$G=global$10;$$2a({global:!0,forced:global$G.globalThis!==global$G},{globalThis:global$G});var global$F=global$10,setToStringTag$8=setToStringTag$e;setToStringTag$8(global$F.JSON,"JSON",!0);var internalMetadata={exports:{}},fails$W=fails$1p,arrayBufferNonExtensible=fails$W(function(){if(typeof ArrayBuffer=="function"){var G=new ArrayBuffer(8);Object.isExtensible(G)&&Object.defineProperty(G,"a",{value:8})}}),fails$V=fails$1p,isObject$q=isObject$G,classof$d=classofRaw$2,ARRAY_BUFFER_NON_EXTENSIBLE$2=arrayBufferNonExtensible,$isExtensible$2=Object.isExtensible,FAILS_ON_PRIMITIVES$6=fails$V(function(){$isExtensible$2(1)}),objectIsExtensible=FAILS_ON_PRIMITIVES$6||ARRAY_BUFFER_NON_EXTENSIBLE$2?function(W){return!isObject$q(W)||ARRAY_BUFFER_NON_EXTENSIBLE$2&&classof$d(W)==="ArrayBuffer"?!1:$isExtensible$2?$isExtensible$2(W):!0}:$isExtensible$2,fails$U=fails$1p,freezing=!fails$U(function(){return Object.isExtensible(Object.preventExtensions({}))}),$$29=_export,uncurryThis$R=functionUncurryThis,hiddenKeys=hiddenKeys$6,isObject$p=isObject$G,hasOwn$e=hasOwnProperty_1,defineProperty$9=objectDefineProperty.f,getOwnPropertyNamesModule=objectGetOwnPropertyNames,getOwnPropertyNamesExternalModule=objectGetOwnPropertyNamesExternal,isExtensible$1=objectIsExtensible,uid$1=uid$6,FREEZING$5=freezing,REQUIRED=!1,METADATA=uid$1("meta"),id$1=0,setMetadata=function(G){defineProperty$9(G,METADATA,{value:{objectID:"O"+id$1++,weakData:{}}})},fastKey$1=function(G,W){if(!isObject$p(G))return typeof G=="symbol"?G:(typeof G=="string"?"S":"P")+G;if(!hasOwn$e(G,METADATA)){if(!isExtensible$1(G))return"F";if(!W)return"E";setMetadata(G)}return G[METADATA].objectID},getWeakData$1=function(G,W){if(!hasOwn$e(G,METADATA)){if(!isExtensible$1(G))return!0;if(!W)return!1;setMetadata(G)}return G[METADATA].weakData},onFreeze$3=function(G){return FREEZING$5&&REQUIRED&&isExtensible$1(G)&&!hasOwn$e(G,METADATA)&&setMetadata(G),G},enable=function(){meta.enable=function(){},REQUIRED=!0;var G=getOwnPropertyNamesModule.f,W=uncurryThis$R([].splice),X={};X[METADATA]=1,G(X).length&&(getOwnPropertyNamesModule.f=function(V){for(var Z=G(V),re=0,se=Z.length;re<se;re++)if(Z[re]===METADATA){W(Z,re,1);break}return Z},$$29({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:getOwnPropertyNamesExternalModule.f}))},meta=internalMetadata.exports={enable,fastKey:fastKey$1,getWeakData:getWeakData$1,onFreeze:onFreeze$3};hiddenKeys[METADATA]=!0;var internalMetadataExports=internalMetadata.exports,$$28=_export,global$E=global$10,uncurryThis$Q=functionUncurryThis,isForced$3=isForced_1,defineBuiltIn$d=defineBuiltIn$o,InternalMetadataModule$1=internalMetadataExports,iterate$a=iterate$c,anInstance$8=anInstance$a,isCallable$c=isCallable$y,isNullOrUndefined$a=isNullOrUndefined$f,isObject$o=isObject$G,fails$T=fails$1p,checkCorrectnessOfIteration$2=checkCorrectnessOfIteration$4,setToStringTag$7=setToStringTag$e,inheritIfRequired$4=inheritIfRequired$7,collection$4=function(G,W,X){var V=G.indexOf("Map")!==-1,Z=G.indexOf("Weak")!==-1,re=V?"set":"add",se=global$E[G],ue=se&&se.prototype,H=se,ye={},Ie=function($t){var jt=uncurryThis$Q(ue[$t]);defineBuiltIn$d(ue,$t,$t==="add"?function(sr){return jt(this,sr===0?0:sr),this}:$t==="delete"?function(nr){return Z&&!isObject$o(nr)?!1:jt(this,nr===0?0:nr)}:$t==="get"?function(sr){return Z&&!isObject$o(sr)?void 0:jt(this,sr===0?0:sr)}:$t==="has"?function(sr){return Z&&!isObject$o(sr)?!1:jt(this,sr===0?0:sr)}:function(sr,gr){return jt(this,sr===0?0:sr,gr),this})},Ee=isForced$3(G,!isCallable$c(se)||!(Z||ue.forEach&&!fails$T(function(){new se().entries().next()})));if(Ee)H=X.getConstructor(W,G,V,re),InternalMetadataModule$1.enable();else if(isForced$3(G,!0)){var Fe=new H,je=Fe[re](Z?{}:-0,1)!==Fe,mt=fails$T(function(){Fe.has(1)}),wt=checkCorrectnessOfIteration$2(function($t){new se($t)}),Ot=!Z&&fails$T(function(){for(var $t=new se,jt=5;jt--;)$t[re](jt,jt);return!$t.has(-0)});wt||(H=W(function($t,jt){anInstance$8($t,ue);var nr=inheritIfRequired$4(new se,$t,H);return isNullOrUndefined$a(jt)||iterate$a(jt,nr[re],{that:nr,AS_ENTRIES:V}),nr}),H.prototype=ue,ue.constructor=H),(mt||Ot)&&(Ie("delete"),Ie("has"),V&&Ie("get")),(Ot||je)&&Ie(re),Z&&ue.clear&&delete ue.clear}return ye[G]=H,$$28({global:!0,constructor:!0,forced:H!==se},ye),setToStringTag$7(H,G),Z||X.setStrong(H,G,V),H},create$a=objectCreate,defineBuiltInAccessor$a=defineBuiltInAccessor$i,defineBuiltIns$3=defineBuiltIns$5,bind$7=functionBindContext,anInstance$7=anInstance$a,isNullOrUndefined$9=isNullOrUndefined$f,iterate$9=iterate$c,defineIterator$1=iteratorDefine,createIterResultObject$3=createIterResultObject$5,setSpecies$3=setSpecies$6,DESCRIPTORS$s=descriptors,fastKey=internalMetadataExports.fastKey,InternalStateModule$8=internalState,setInternalState$8=InternalStateModule$8.set,internalStateGetterFor$1=InternalStateModule$8.getterFor,collectionStrong$2={getConstructor:function(G,W,X,V){var Z=G(function(ye,Ie){anInstance$7(ye,re),setInternalState$8(ye,{type:W,index:create$a(null),first:void 0,last:void 0,size:0}),DESCRIPTORS$s||(ye.size=0),isNullOrUndefined$9(Ie)||iterate$9(Ie,ye[V],{that:ye,AS_ENTRIES:X})}),re=Z.prototype,se=internalStateGetterFor$1(W),ue=function(ye,Ie,Ee){var Fe=se(ye),je=H(ye,Ie),mt,wt;return je?je.value=Ee:(Fe.last=je={index:wt=fastKey(Ie,!0),key:Ie,value:Ee,previous:mt=Fe.last,next:void 0,removed:!1},Fe.first||(Fe.first=je),mt&&(mt.next=je),DESCRIPTORS$s?Fe.size++:ye.size++,wt!=="F"&&(Fe.index[wt]=je)),ye},H=function(ye,Ie){var Ee=se(ye),Fe=fastKey(Ie),je;if(Fe!=="F")return Ee.index[Fe];for(je=Ee.first;je;je=je.next)if(je.key===Ie)return je};return defineBuiltIns$3(re,{clear:function(){for(var Ie=this,Ee=se(Ie),Fe=Ee.first;Fe;)Fe.removed=!0,Fe.previous&&(Fe.previous=Fe.previous.next=void 0),Fe=Fe.next;Ee.first=Ee.last=void 0,Ee.index=create$a(null),DESCRIPTORS$s?Ee.size=0:Ie.size=0},delete:function(ye){var Ie=this,Ee=se(Ie),Fe=H(Ie,ye);if(Fe){var je=Fe.next,mt=Fe.previous;delete Ee.index[Fe.index],Fe.removed=!0,mt&&(mt.next=je),je&&(je.previous=mt),Ee.first===Fe&&(Ee.first=je),Ee.last===Fe&&(Ee.last=mt),DESCRIPTORS$s?Ee.size--:Ie.size--}return!!Fe},forEach:function(Ie){for(var Ee=se(this),Fe=bind$7(Ie,arguments.length>1?arguments[1]:void 0),je;je=je?je.next:Ee.first;)for(Fe(je.value,je.key,this);je&&je.removed;)je=je.previous},has:function(Ie){return!!H(this,Ie)}}),defineBuiltIns$3(re,X?{get:function(Ie){var Ee=H(this,Ie);return Ee&&Ee.value},set:function(Ie,Ee){return ue(this,Ie===0?0:Ie,Ee)}}:{add:function(Ie){return ue(this,Ie=Ie===0?0:Ie,Ie)}}),DESCRIPTORS$s&&defineBuiltInAccessor$a(re,"size",{configurable:!0,get:function(){return se(this).size}}),Z},setStrong:function(G,W,X){var V=W+" Iterator",Z=internalStateGetterFor$1(W),re=internalStateGetterFor$1(V);defineIterator$1(G,W,function(se,ue){setInternalState$8(this,{type:V,target:se,state:Z(se),kind:ue,last:void 0})},function(){for(var se=re(this),ue=se.kind,H=se.last;H&&H.removed;)H=H.previous;return!se.target||!(se.last=H=H?H.next:se.state.first)?(se.target=void 0,createIterResultObject$3(void 0,!0)):createIterResultObject$3(ue==="keys"?H.key:ue==="values"?H.value:[H.key,H.value],!1)},X?"entries":"values",!X,!0),setSpecies$3(W)}},collection$3=collection$4,collectionStrong$1=collectionStrong$2;collection$3("Map",function(G){return function(){return G(this,arguments.length?arguments[0]:void 0)}},collectionStrong$1);var uncurryThis$P=functionUncurryThis,MapPrototype=Map.prototype,mapHelpers={Map,set:uncurryThis$P(MapPrototype.set),get:uncurryThis$P(MapPrototype.get),has:uncurryThis$P(MapPrototype.has),remove:uncurryThis$P(MapPrototype.delete),proto:MapPrototype},$$27=_export,uncurryThis$O=functionUncurryThis,aCallable$d=aCallable$n,requireObjectCoercible$i=requireObjectCoercible$n,iterate$8=iterate$c,MapHelpers$1=mapHelpers,IS_PURE$3=isPure,Map$4=MapHelpers$1.Map,has$1=MapHelpers$1.has,get$1=MapHelpers$1.get,set$2=MapHelpers$1.set,push$b=uncurryThis$O([].push);$$27({target:"Map",stat:!0,forced:IS_PURE$3},{groupBy:function(W,X){requireObjectCoercible$i(W),aCallable$d(X);var V=new Map$4,Z=0;return iterate$8(W,function(re){var se=X(re,Z++);has$1(V,se)?push$b(get$1(V,se),re):set$2(V,se,[re])}),V}});var log$7=Math.log,mathLog1p=Math.log1p||function(W){var X=+W;return X>-1e-8&&X<1e-8?X-X*X/2:log$7(1+X)},$$26=_export,log1p$1=mathLog1p,$acosh=Math.acosh,log$6=Math.log,sqrt$2=Math.sqrt,LN2$1=Math.LN2,FORCED$q=!$acosh||Math.floor($acosh(Number.MAX_VALUE))!==710||$acosh(1/0)!==1/0;$$26({target:"Math",stat:!0,forced:FORCED$q},{acosh:function(W){var X=+W;return X<1?NaN:X>9490626562425156e-8?log$6(X)+LN2$1:log1p$1(X-1+sqrt$2(X-1)*sqrt$2(X+1))}});var $$25=_export,$asinh=Math.asinh,log$5=Math.log,sqrt$1=Math.sqrt;function asinh(G){var W=+G;return!isFinite(W)||W===0?W:W<0?-asinh(-W):log$5(W+sqrt$1(W*W+1))}var FORCED$p=!($asinh&&1/$asinh(0)>0);$$25({target:"Math",stat:!0,forced:FORCED$p},{asinh});var $$24=_export,$atanh=Math.atanh,log$4=Math.log,FORCED$o=!($atanh&&1/$atanh(-0)<0);$$24({target:"Math",stat:!0,forced:FORCED$o},{atanh:function(W){var X=+W;return X===0?X:log$4((1+X)/(1-X))/2}});var $$23=_export,sign$1=mathSign,abs$5=Math.abs,pow$3=Math.pow;$$23({target:"Math",stat:!0},{cbrt:function(W){var X=+W;return sign$1(X)*pow$3(abs$5(X),1/3)}});var $$22=_export,floor$7=Math.floor,log$3=Math.log,LOG2E=Math.LOG2E;$$22({target:"Math",stat:!0},{clz32:function(W){var X=W>>>0;return X?31-floor$7(log$3(X+.5)*LOG2E):32}});var $expm1=Math.expm1,exp$2=Math.exp,mathExpm1=!$expm1||$expm1(10)>22025.465794806718||$expm1(10)<22025.465794806718||$expm1(-2e-17)!==-2e-17?function(W){var X=+W;return X===0?X:X>-1e-6&&X<1e-6?X+X*X/2:exp$2(X)-1}:$expm1,$$21=_export,expm1$3=mathExpm1,$cosh=Math.cosh,abs$4=Math.abs,E$1=Math.E,FORCED$n=!$cosh||$cosh(710)===1/0;$$21({target:"Math",stat:!0,forced:FORCED$n},{cosh:function(W){var X=expm1$3(abs$4(W)-1)+1;return(X+1/(X*E$1*E$1))*(E$1/2)}});var $$20=_export,expm1$2=mathExpm1;$$20({target:"Math",stat:!0,forced:expm1$2!==Math.expm1},{expm1:expm1$2});var $$1$=_export,fround=mathFround;$$1$({target:"Math",stat:!0},{fround});var $$1_=_export,$hypot=Math.hypot,abs$3=Math.abs,sqrt=Math.sqrt,FORCED$m=!!$hypot&&$hypot(1/0,NaN)!==1/0;$$1_({target:"Math",stat:!0,arity:2,forced:FORCED$m},{hypot:function(W,X){for(var V=0,Z=0,re=arguments.length,se=0,ue,H;Z<re;)ue=abs$3(arguments[Z++]),se<ue?(H=se/ue,V=V*H*H+1,se=ue):ue>0?(H=ue/se,V+=H*H):V+=ue;return se===1/0?1/0:se*sqrt(V)}});var $$1Z=_export,fails$S=fails$1p,$imul=Math.imul,FORCED$l=fails$S(function(){return $imul(4294967295,5)!==-5||$imul.length!==2});$$1Z({target:"Math",stat:!0,forced:FORCED$l},{imul:function(W,X){var V=65535,Z=+W,re=+X,se=V&Z,ue=V&re;return 0|se*ue+((V&Z>>>16)*ue+se*(V&re>>>16)<<16>>>0)}});var log$2=Math.log,LOG10E=Math.LOG10E,mathLog10=Math.log10||function(W){return log$2(W)*LOG10E},$$1Y=_export,log10$1=mathLog10;$$1Y({target:"Math",stat:!0},{log10:log10$1});var $$1X=_export,log1p=mathLog1p;$$1X({target:"Math",stat:!0},{log1p});var $$1W=_export,log$1=Math.log,LN2=Math.LN2;$$1W({target:"Math",stat:!0},{log2:function(W){return log$1(W)/LN2}});var $$1V=_export,sign=mathSign;$$1V({target:"Math",stat:!0},{sign});var $$1U=_export,fails$R=fails$1p,expm1$1=mathExpm1,abs$2=Math.abs,exp$1=Math.exp,E=Math.E,FORCED$k=fails$R(function(){return Math.sinh(-2e-17)!==-2e-17});$$1U({target:"Math",stat:!0,forced:FORCED$k},{sinh:function(W){var X=+W;return abs$2(X)<1?(expm1$1(X)-expm1$1(-X))/2:(exp$1(X-1)-exp$1(-X-1))*(E/2)}});var $$1T=_export,expm1=mathExpm1,exp=Math.exp;$$1T({target:"Math",stat:!0},{tanh:function(W){var X=+W,V=expm1(X),Z=expm1(-X);return V===1/0?1:Z===1/0?-1:(V-Z)/(exp(X)+exp(-X))}});var setToStringTag$6=setToStringTag$e;setToStringTag$6(Math,"Math",!0);var $$1S=_export,trunc=mathTrunc;$$1S({target:"Math",stat:!0},{trunc});var uncurryThis$N=functionUncurryThis,thisNumberValue$5=uncurryThis$N(1 .valueOf),whitespaces$5=`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF`,uncurryThis$M=functionUncurryThis,requireObjectCoercible$h=requireObjectCoercible$n,toString$v=toString$E,whitespaces$4=whitespaces$5,replace$8=uncurryThis$M("".replace),ltrim=RegExp("^["+whitespaces$4+"]+"),rtrim=RegExp("(^|[^"+whitespaces$4+"])["+whitespaces$4+"]+$"),createMethod$2=function(G){return function(W){var X=toString$v(requireObjectCoercible$h(W));return G&1&&(X=replace$8(X,ltrim,"")),G&2&&(X=replace$8(X,rtrim,"$1")),X}},stringTrim={start:createMethod$2(1),end:createMethod$2(2),trim:createMethod$2(3)},$$1R=_export,IS_PURE$2=isPure,DESCRIPTORS$r=descriptors,global$D=global$10,path=path$2,uncurryThis$L=functionUncurryThis,isForced$2=isForced_1,hasOwn$d=hasOwnProperty_1,inheritIfRequired$3=inheritIfRequired$7,isPrototypeOf$3=objectIsPrototypeOf,isSymbol$8=isSymbol$d,toPrimitive$1=toPrimitive$4,fails$Q=fails$1p,getOwnPropertyNames$3=objectGetOwnPropertyNames.f,getOwnPropertyDescriptor$6=objectGetOwnPropertyDescriptor.f,defineProperty$8=objectDefineProperty.f,thisNumberValue$4=thisNumberValue$5,trim$2=stringTrim.trim,NUMBER="Number",NativeNumber=global$D[NUMBER];path[NUMBER];var NumberPrototype=NativeNumber.prototype,TypeError$5=global$D.TypeError,stringSlice$e=uncurryThis$L("".slice),charCodeAt$5=uncurryThis$L("".charCodeAt),toNumeric=function(G){var W=toPrimitive$1(G,"number");return typeof W=="bigint"?W:toNumber$2(W)},toNumber$2=function(G){var W=toPrimitive$1(G,"number"),X,V,Z,re,se,ue,H,ye;if(isSymbol$8(W))throw new TypeError$5("Cannot convert a Symbol value to a number");if(typeof W=="string"&&W.length>2){if(W=trim$2(W),X=charCodeAt$5(W,0),X===43||X===45){if(V=charCodeAt$5(W,2),V===88||V===120)return NaN}else if(X===48){switch(charCodeAt$5(W,1)){case 66:case 98:Z=2,re=49;break;case 79:case 111:Z=8,re=55;break;default:return+W}for(se=stringSlice$e(W,2),ue=se.length,H=0;H<ue;H++)if(ye=charCodeAt$5(se,H),ye<48||ye>re)return NaN;return parseInt(se,Z)}}return+W},FORCED$j=isForced$2(NUMBER,!NativeNumber(" 0o1")||!NativeNumber("0b1")||NativeNumber("+0x1")),calledWithNew=function(G){return isPrototypeOf$3(NumberPrototype,G)&&fails$Q(function(){thisNumberValue$4(G)})},NumberWrapper=function(W){var X=arguments.length<1?0:NativeNumber(toNumeric(W));return calledWithNew(this)?inheritIfRequired$3(Object(X),this,NumberWrapper):X};NumberWrapper.prototype=NumberPrototype;FORCED$j&&!IS_PURE$2&&(NumberPrototype.constructor=NumberWrapper);$$1R({global:!0,constructor:!0,wrap:!0,forced:FORCED$j},{Number:NumberWrapper});var copyConstructorProperties=function(G,W){for(var X=DESCRIPTORS$r?getOwnPropertyNames$3(W):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),V=0,Z;X.length>V;V++)hasOwn$d(W,Z=X[V])&&!hasOwn$d(G,Z)&&defineProperty$8(G,Z,getOwnPropertyDescriptor$6(W,Z))};(FORCED$j||IS_PURE$2)&&copyConstructorProperties(path[NUMBER],NativeNumber);var $$1Q=_export;$$1Q({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{EPSILON:Math.pow(2,-52)});var global$C=global$10,globalIsFinite=global$C.isFinite,numberIsFinite$1=Number.isFinite||function(W){return typeof W=="number"&&globalIsFinite(W)},$$1P=_export,numberIsFinite=numberIsFinite$1;$$1P({target:"Number",stat:!0},{isFinite:numberIsFinite});var isObject$n=isObject$G,floor$6=Math.floor,isIntegralNumber$3=Number.isInteger||function(W){return!isObject$n(W)&&isFinite(W)&&floor$6(W)===W},$$1O=_export,isIntegralNumber$2=isIntegralNumber$3;$$1O({target:"Number",stat:!0},{isInteger:isIntegralNumber$2});var $$1N=_export;$$1N({target:"Number",stat:!0},{isNaN:function(W){return W!==W}});var $$1M=_export,isIntegralNumber$1=isIntegralNumber$3,abs$1=Math.abs;$$1M({target:"Number",stat:!0},{isSafeInteger:function(W){return isIntegralNumber$1(W)&&abs$1(W)<=9007199254740991}});var $$1L=_export;$$1L({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991});var $$1K=_export;$$1K({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MIN_SAFE_INTEGER:-9007199254740991});var global$B=global$10,fails$P=fails$1p,uncurryThis$K=functionUncurryThis,toString$u=toString$E,trim$1=stringTrim.trim,whitespaces$3=whitespaces$5,charAt$d=uncurryThis$K("".charAt),$parseFloat$1=global$B.parseFloat,Symbol$7=global$B.Symbol,ITERATOR$5=Symbol$7&&Symbol$7.iterator,FORCED$i=1/$parseFloat$1(whitespaces$3+"-0")!==-1/0||ITERATOR$5&&!fails$P(function(){$parseFloat$1(Object(ITERATOR$5))}),numberParseFloat=FORCED$i?function(W){var X=trim$1(toString$u(W)),V=$parseFloat$1(X);return V===0&&charAt$d(X,0)==="-"?-0:V}:$parseFloat$1,$$1J=_export,parseFloat$1=numberParseFloat;$$1J({target:"Number",stat:!0,forced:Number.parseFloat!==parseFloat$1},{parseFloat:parseFloat$1});var global$A=global$10,fails$O=fails$1p,uncurryThis$J=functionUncurryThis,toString$t=toString$E,trim=stringTrim.trim,whitespaces$2=whitespaces$5,$parseInt$1=global$A.parseInt,Symbol$6=global$A.Symbol,ITERATOR$4=Symbol$6&&Symbol$6.iterator,hex=/^[+-]?0x/i,exec$6=uncurryThis$J(hex.exec),FORCED$h=$parseInt$1(whitespaces$2+"08")!==8||$parseInt$1(whitespaces$2+"0x16")!==22||ITERATOR$4&&!fails$O(function(){$parseInt$1(Object(ITERATOR$4))}),numberParseInt=FORCED$h?function(W,X){var V=trim(toString$t(W));return $parseInt$1(V,X>>>0||(exec$6(hex,V)?16:10))}:$parseInt$1,$$1I=_export,parseInt$2=numberParseInt;$$1I({target:"Number",stat:!0,forced:Number.parseInt!==parseInt$2},{parseInt:parseInt$2});var $$1H=_export,uncurryThis$I=functionUncurryThis,toIntegerOrInfinity$8=toIntegerOrInfinity$l,thisNumberValue$3=thisNumberValue$5,$repeat$1=stringRepeat,log10=mathLog10,fails$N=fails$1p,$RangeError$5=RangeError,$String$1=String,$isFinite=isFinite,abs=Math.abs,floor$5=Math.floor,pow$2=Math.pow,round$1=Math.round,nativeToExponential=uncurryThis$I(1 .toExponential),repeat$2=uncurryThis$I($repeat$1),stringSlice$d=uncurryThis$I("".slice),ROUNDS_PROPERLY=nativeToExponential(-69e-12,4)==="-6.9000e-11"&&nativeToExponential(1.255,2)==="1.25e+0"&&nativeToExponential(12345,3)==="1.235e+4"&&nativeToExponential(25,0)==="3e+1",throwsOnInfinityFraction=function(){return fails$N(function(){nativeToExponential(1,1/0)})&&fails$N(function(){nativeToExponential(1,-1/0)})},properNonFiniteThisCheck=function(){return!fails$N(function(){nativeToExponential(1/0,1/0),nativeToExponential(NaN,1/0)})},FORCED$g=!ROUNDS_PROPERLY||!throwsOnInfinityFraction()||!properNonFiniteThisCheck();$$1H({target:"Number",proto:!0,forced:FORCED$g},{toExponential:function(W){var X=thisNumberValue$3(this);if(W===void 0)return nativeToExponential(X);var V=toIntegerOrInfinity$8(W);if(!$isFinite(X))return String(X);if(V<0||V>20)throw new $RangeError$5("Incorrect fraction digits");if(ROUNDS_PROPERLY)return nativeToExponential(X,V);var Z="",re="",se=0,ue="",H="";if(X<0&&(Z="-",X=-X),X===0)se=0,re=repeat$2("0",V+1);else{var ye=log10(X);se=floor$5(ye);var Ie=0,Ee=pow$2(10,se-V);Ie=round$1(X/Ee),2*X>=(2*Ie+1)*Ee&&(Ie+=1),Ie>=pow$2(10,V+1)&&(Ie/=10,se+=1),re=$String$1(Ie)}return V!==0&&(re=stringSlice$d(re,0,1)+"."+stringSlice$d(re,1)),se===0?(ue="+",H="0"):(ue=se>0?"+":"-",H=$String$1(abs(se))),re+="e"+ue+H,Z+re}});var $$1G=_export,uncurryThis$H=functionUncurryThis,toIntegerOrInfinity$7=toIntegerOrInfinity$l,thisNumberValue$2=thisNumberValue$5,$repeat=stringRepeat,fails$M=fails$1p,$RangeError$4=RangeError,$String=String,floor$4=Math.floor,repeat$1=uncurryThis$H($repeat),stringSlice$c=uncurryThis$H("".slice),nativeToFixed=uncurryThis$H(1 .toFixed),pow$1=function(G,W,X){return W===0?X:W%2===1?pow$1(G,W-1,X*G):pow$1(G*G,W/2,X)},log=function(G){for(var W=0,X=G;X>=4096;)W+=12,X/=4096;for(;X>=2;)W+=1,X/=2;return W},multiply=function(G,W,X){for(var V=-1,Z=X;++V<6;)Z+=W*G[V],G[V]=Z%1e7,Z=floor$4(Z/1e7)},divide=function(G,W){for(var X=6,V=0;--X>=0;)V+=G[X],G[X]=floor$4(V/W),V=V%W*1e7},dataToString=function(G){for(var W=6,X="";--W>=0;)if(X!==""||W===0||G[W]!==0){var V=$String(G[W]);X=X===""?V:X+repeat$1("0",7-V.length)+V}return X},FORCED$f=fails$M(function(){return nativeToFixed(8e-5,3)!=="0.000"||nativeToFixed(.9,0)!=="1"||nativeToFixed(1.255,2)!=="1.25"||nativeToFixed(0xde0b6b3a7640080,0)!=="1000000000000000128"})||!fails$M(function(){nativeToFixed({})});$$1G({target:"Number",proto:!0,forced:FORCED$f},{toFixed:function(W){var X=thisNumberValue$2(this),V=toIntegerOrInfinity$7(W),Z=[0,0,0,0,0,0],re="",se="0",ue,H,ye,Ie;if(V<0||V>20)throw new $RangeError$4("Incorrect fraction digits");if(X!==X)return"NaN";if(X<=-1e21||X>=1e21)return $String(X);if(X<0&&(re="-",X=-X),X>1e-21)if(ue=log(X*pow$1(2,69,1))-69,H=ue<0?X*pow$1(2,-ue,1):X/pow$1(2,ue,1),H*=4503599627370496,ue=52-ue,ue>0){for(multiply(Z,0,H),ye=V;ye>=7;)multiply(Z,1e7,0),ye-=7;for(multiply(Z,pow$1(10,ye,1),0),ye=ue-1;ye>=23;)divide(Z,1<<23),ye-=23;divide(Z,1<<ye),multiply(Z,1,1),divide(Z,2),se=dataToString(Z)}else multiply(Z,0,H),multiply(Z,1<<-ue,0),se=dataToString(Z)+repeat$1("0",V);return V>0?(Ie=se.length,se=re+(Ie<=V?"0."+repeat$1("0",V-Ie)+se:stringSlice$c(se,0,Ie-V)+"."+stringSlice$c(se,Ie-V))):se=re+se,se}});var $$1F=_export,uncurryThis$G=functionUncurryThis,fails$L=fails$1p,thisNumberValue$1=thisNumberValue$5,nativeToPrecision=uncurryThis$G(1 .toPrecision),FORCED$e=fails$L(function(){return nativeToPrecision(1,void 0)!=="1"})||!fails$L(function(){nativeToPrecision({})});$$1F({target:"Number",proto:!0,forced:FORCED$e},{toPrecision:function(W){return W===void 0?nativeToPrecision(thisNumberValue$1(this)):nativeToPrecision(thisNumberValue$1(this),W)}});var DESCRIPTORS$q=descriptors,uncurryThis$F=functionUncurryThis,call$s=functionCall,fails$K=fails$1p,objectKeys$2=objectKeys$5,getOwnPropertySymbolsModule=objectGetOwnPropertySymbols,propertyIsEnumerableModule=objectPropertyIsEnumerable,toObject$a=toObject$t,IndexedObject=indexedObject,$assign=Object.assign,defineProperty$7=Object.defineProperty,concat$1=uncurryThis$F([].concat),objectAssign=!$assign||fails$K(function(){if(DESCRIPTORS$q&&$assign({b:1},$assign(defineProperty$7({},"a",{enumerable:!0,get:function(){defineProperty$7(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var G={},W={},X=Symbol("assign detection"),V="abcdefghijklmnopqrst";return G[X]=7,V.split("").forEach(function(Z){W[Z]=Z}),$assign({},G)[X]!==7||objectKeys$2($assign({},W)).join("")!==V})?function(W,X){for(var V=toObject$a(W),Z=arguments.length,re=1,se=getOwnPropertySymbolsModule.f,ue=propertyIsEnumerableModule.f;Z>re;)for(var H=IndexedObject(arguments[re++]),ye=se?concat$1(objectKeys$2(H),se(H)):objectKeys$2(H),Ie=ye.length,Ee=0,Fe;Ie>Ee;)Fe=ye[Ee++],(!DESCRIPTORS$q||call$s(ue,H,Fe))&&(V[Fe]=H[Fe]);return V}:$assign,$$1E=_export,assign$1=objectAssign;$$1E({target:"Object",stat:!0,arity:2,forced:Object.assign!==assign$1},{assign:assign$1});var $$1D=_export,DESCRIPTORS$p=descriptors,create$9=objectCreate;$$1D({target:"Object",stat:!0,sham:!DESCRIPTORS$p},{create:create$9});var global$z=global$10,fails$J=fails$1p,WEBKIT$1=engineWebkitVersion,objectPrototypeAccessorsForced=!fails$J(function(){if(!(WEBKIT$1&&WEBKIT$1<535)){var G=Math.random();__defineSetter__.call(null,G,function(){}),delete global$z[G]}}),$$1C=_export,DESCRIPTORS$o=descriptors,FORCED$d=objectPrototypeAccessorsForced,aCallable$c=aCallable$n,toObject$9=toObject$t,definePropertyModule$4=objectDefineProperty;DESCRIPTORS$o&&$$1C({target:"Object",proto:!0,forced:FORCED$d},{__defineGetter__:function(W,X){definePropertyModule$4.f(toObject$9(this),W,{get:aCallable$c(X),enumerable:!0,configurable:!0})}});var $$1B=_export,DESCRIPTORS$n=descriptors,defineProperties=objectDefineProperties.f;$$1B({target:"Object",stat:!0,forced:Object.defineProperties!==defineProperties,sham:!DESCRIPTORS$n},{defineProperties});var $$1A=_export,DESCRIPTORS$m=descriptors,defineProperty$6=objectDefineProperty.f;$$1A({target:"Object",stat:!0,forced:Object.defineProperty!==defineProperty$6,sham:!DESCRIPTORS$m},{defineProperty:defineProperty$6});var $$1z=_export,DESCRIPTORS$l=descriptors,FORCED$c=objectPrototypeAccessorsForced,aCallable$b=aCallable$n,toObject$8=toObject$t,definePropertyModule$3=objectDefineProperty;DESCRIPTORS$l&&$$1z({target:"Object",proto:!0,forced:FORCED$c},{__defineSetter__:function(W,X){definePropertyModule$3.f(toObject$8(this),W,{set:aCallable$b(X),enumerable:!0,configurable:!0})}});var DESCRIPTORS$k=descriptors,fails$I=fails$1p,uncurryThis$E=functionUncurryThis,objectGetPrototypeOf$1=objectGetPrototypeOf$2,objectKeys$1=objectKeys$5,toIndexedObject$4=toIndexedObject$j,$propertyIsEnumerable=objectPropertyIsEnumerable.f,propertyIsEnumerable$1=uncurryThis$E($propertyIsEnumerable),push$a=uncurryThis$E([].push),IE_BUG=DESCRIPTORS$k&&fails$I(function(){var G=Object.create(null);return G[2]=2,!propertyIsEnumerable$1(G,2)}),createMethod$1=function(G){return function(W){for(var X=toIndexedObject$4(W),V=objectKeys$1(X),Z=IE_BUG&&objectGetPrototypeOf$1(X)===null,re=V.length,se=0,ue=[],H;re>se;)H=V[se++],(!DESCRIPTORS$k||(Z?H in X:propertyIsEnumerable$1(X,H)))&&push$a(ue,G?[H,X[H]]:X[H]);return ue}},objectToArray={entries:createMethod$1(!0),values:createMethod$1(!1)},$$1y=_export,$entries=objectToArray.entries;$$1y({target:"Object",stat:!0},{entries:function(W){return $entries(W)}});var $$1x=_export,FREEZING$4=freezing,fails$H=fails$1p,isObject$m=isObject$G,onFreeze$2=internalMetadataExports.onFreeze,$freeze=Object.freeze,FAILS_ON_PRIMITIVES$5=fails$H(function(){$freeze(1)});$$1x({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$5,sham:!FREEZING$4},{freeze:function(W){return $freeze&&isObject$m(W)?$freeze(onFreeze$2(W)):W}});var $$1w=_export,iterate$7=iterate$c,createProperty$2=createProperty$8;$$1w({target:"Object",stat:!0},{fromEntries:function(W){var X={};return iterate$7(W,function(V,Z){createProperty$2(X,V,Z)},{AS_ENTRIES:!0}),X}});var $$1v=_export,fails$G=fails$1p,toIndexedObject$3=toIndexedObject$j,nativeGetOwnPropertyDescriptor$1=objectGetOwnPropertyDescriptor.f,DESCRIPTORS$j=descriptors,FORCED$b=!DESCRIPTORS$j||fails$G(function(){nativeGetOwnPropertyDescriptor$1(1)});$$1v({target:"Object",stat:!0,forced:FORCED$b,sham:!DESCRIPTORS$j},{getOwnPropertyDescriptor:function(W,X){return nativeGetOwnPropertyDescriptor$1(toIndexedObject$3(W),X)}});var $$1u=_export,DESCRIPTORS$i=descriptors,ownKeys$1=ownKeys$3,toIndexedObject$2=toIndexedObject$j,getOwnPropertyDescriptorModule$4=objectGetOwnPropertyDescriptor,createProperty$1=createProperty$8;$$1u({target:"Object",stat:!0,sham:!DESCRIPTORS$i},{getOwnPropertyDescriptors:function(W){for(var X=toIndexedObject$2(W),V=getOwnPropertyDescriptorModule$4.f,Z=ownKeys$1(X),re={},se=0,ue,H;Z.length>se;)H=V(X,ue=Z[se++]),H!==void 0&&createProperty$1(re,ue,H);return re}});var $$1t=_export,fails$F=fails$1p,getOwnPropertyNames$2=objectGetOwnPropertyNamesExternal.f,FAILS_ON_PRIMITIVES$4=fails$F(function(){return!Object.getOwnPropertyNames(1)});$$1t({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$4},{getOwnPropertyNames:getOwnPropertyNames$2});var $$1s=_export,fails$E=fails$1p,toObject$7=toObject$t,nativeGetPrototypeOf=objectGetPrototypeOf$2,CORRECT_PROTOTYPE_GETTER$1=correctPrototypeGetter,FAILS_ON_PRIMITIVES$3=fails$E(function(){nativeGetPrototypeOf(1)});$$1s({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$3,sham:!CORRECT_PROTOTYPE_GETTER$1},{getPrototypeOf:function(W){return nativeGetPrototypeOf(toObject$7(W))}});var $$1r=_export,getBuiltIn$d=getBuiltIn$p,uncurryThis$D=functionUncurryThis,aCallable$a=aCallable$n,requireObjectCoercible$g=requireObjectCoercible$n,toPropertyKey$4=toPropertyKey$8,iterate$6=iterate$c,create$8=getBuiltIn$d("Object","create"),push$9=uncurryThis$D([].push);$$1r({target:"Object",stat:!0},{groupBy:function(W,X){requireObjectCoercible$g(W),aCallable$a(X);var V=create$8(null),Z=0;return iterate$6(W,function(re){var se=toPropertyKey$4(X(re,Z++));se in V?push$9(V[se],re):V[se]=[re]}),V}});var $$1q=_export,hasOwn$c=hasOwnProperty_1;$$1q({target:"Object",stat:!0},{hasOwn:hasOwn$c});var sameValue$1=Object.is||function(W,X){return W===X?W!==0||1/W===1/X:W!==W&&X!==X},$$1p=_export,is=sameValue$1;$$1p({target:"Object",stat:!0},{is});var $$1o=_export,$isExtensible$1=objectIsExtensible;$$1o({target:"Object",stat:!0,forced:Object.isExtensible!==$isExtensible$1},{isExtensible:$isExtensible$1});var $$1n=_export,fails$D=fails$1p,isObject$l=isObject$G,classof$c=classofRaw$2,ARRAY_BUFFER_NON_EXTENSIBLE$1=arrayBufferNonExtensible,$isFrozen=Object.isFrozen,FORCED$a=ARRAY_BUFFER_NON_EXTENSIBLE$1||fails$D(function(){$isFrozen(1)});$$1n({target:"Object",stat:!0,forced:FORCED$a},{isFrozen:function(W){return!isObject$l(W)||ARRAY_BUFFER_NON_EXTENSIBLE$1&&classof$c(W)==="ArrayBuffer"?!0:$isFrozen?$isFrozen(W):!1}});var $$1m=_export,fails$C=fails$1p,isObject$k=isObject$G,classof$b=classofRaw$2,ARRAY_BUFFER_NON_EXTENSIBLE=arrayBufferNonExtensible,$isSealed=Object.isSealed,FORCED$9=ARRAY_BUFFER_NON_EXTENSIBLE||fails$C(function(){$isSealed(1)});$$1m({target:"Object",stat:!0,forced:FORCED$9},{isSealed:function(W){return!isObject$k(W)||ARRAY_BUFFER_NON_EXTENSIBLE&&classof$b(W)==="ArrayBuffer"?!0:$isSealed?$isSealed(W):!1}});var $$1l=_export,toObject$6=toObject$t,nativeKeys=objectKeys$5,fails$B=fails$1p,FAILS_ON_PRIMITIVES$2=fails$B(function(){nativeKeys(1)});$$1l({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$2},{keys:function(W){return nativeKeys(toObject$6(W))}});var $$1k=_export,DESCRIPTORS$h=descriptors,FORCED$8=objectPrototypeAccessorsForced,toObject$5=toObject$t,toPropertyKey$3=toPropertyKey$8,getPrototypeOf$4=objectGetPrototypeOf$2,getOwnPropertyDescriptor$5=objectGetOwnPropertyDescriptor.f;DESCRIPTORS$h&&$$1k({target:"Object",proto:!0,forced:FORCED$8},{__lookupGetter__:function(W){var X=toObject$5(this),V=toPropertyKey$3(W),Z;do if(Z=getOwnPropertyDescriptor$5(X,V))return Z.get;while(X=getPrototypeOf$4(X))}});var $$1j=_export,DESCRIPTORS$g=descriptors,FORCED$7=objectPrototypeAccessorsForced,toObject$4=toObject$t,toPropertyKey$2=toPropertyKey$8,getPrototypeOf$3=objectGetPrototypeOf$2,getOwnPropertyDescriptor$4=objectGetOwnPropertyDescriptor.f;DESCRIPTORS$g&&$$1j({target:"Object",proto:!0,forced:FORCED$7},{__lookupSetter__:function(W){var X=toObject$4(this),V=toPropertyKey$2(W),Z;do if(Z=getOwnPropertyDescriptor$4(X,V))return Z.set;while(X=getPrototypeOf$3(X))}});var $$1i=_export,isObject$j=isObject$G,onFreeze$1=internalMetadataExports.onFreeze,FREEZING$3=freezing,fails$A=fails$1p,$preventExtensions=Object.preventExtensions,FAILS_ON_PRIMITIVES$1=fails$A(function(){$preventExtensions(1)});$$1i({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$1,sham:!FREEZING$3},{preventExtensions:function(W){return $preventExtensions&&isObject$j(W)?$preventExtensions(onFreeze$1(W)):W}});var DESCRIPTORS$f=descriptors,defineBuiltInAccessor$9=defineBuiltInAccessor$i,isObject$i=isObject$G,isPossiblePrototype=isPossiblePrototype$2,toObject$3=toObject$t,requireObjectCoercible$f=requireObjectCoercible$n,getPrototypeOf$2=Object.getPrototypeOf,setPrototypeOf$3=Object.setPrototypeOf,ObjectPrototype$1=Object.prototype,PROTO="__proto__";if(DESCRIPTORS$f&&getPrototypeOf$2&&setPrototypeOf$3&&!(PROTO in ObjectPrototype$1))try{defineBuiltInAccessor$9(ObjectPrototype$1,PROTO,{configurable:!0,get:function(){return getPrototypeOf$2(toObject$3(this))},set:function(W){var X=requireObjectCoercible$f(this);isPossiblePrototype(W)&&isObject$i(X)&&setPrototypeOf$3(X,W)}})}catch{}var $$1h=_export,isObject$h=isObject$G,onFreeze=internalMetadataExports.onFreeze,FREEZING$2=freezing,fails$z=fails$1p,$seal=Object.seal,FAILS_ON_PRIMITIVES=fails$z(function(){$seal(1)});$$1h({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES,sham:!FREEZING$2},{seal:function(W){return $seal&&isObject$h(W)?$seal(onFreeze(W)):W}});var $$1g=_export,setPrototypeOf$2=objectSetPrototypeOf$1;$$1g({target:"Object",stat:!0},{setPrototypeOf:setPrototypeOf$2});var TO_STRING_TAG_SUPPORT$1=toStringTagSupport,classof$a=classof$n,objectToString$3=TO_STRING_TAG_SUPPORT$1?{}.toString:function(){return"[object "+classof$a(this)+"]"},TO_STRING_TAG_SUPPORT=toStringTagSupport,defineBuiltIn$c=defineBuiltIn$o,toString$s=objectToString$3;TO_STRING_TAG_SUPPORT||defineBuiltIn$c(Object.prototype,"toString",toString$s,{unsafe:!0});var $$1f=_export,$values=objectToArray.values;$$1f({target:"Object",stat:!0},{values:function(W){return $values(W)}});var $$1e=_export,$parseFloat=numberParseFloat;$$1e({global:!0,forced:parseFloat!==$parseFloat},{parseFloat:$parseFloat});var $$1d=_export,$parseInt=numberParseInt;$$1d({global:!0,forced:parseInt!==$parseInt},{parseInt:$parseInt});var $TypeError$9=TypeError,validateArgumentsLength$b=function(G,W){if(G<W)throw new $TypeError$9("Not enough arguments");return G},userAgent$3=engineUserAgent,engineIsIos=/(?:ipad|iphone|ipod).*applewebkit/i.test(userAgent$3),global$y=global$10,apply$7=functionApply$1,bind$6=functionBindContext,isCallable$b=isCallable$y,hasOwn$b=hasOwnProperty_1,fails$y=fails$1p,html=html$2,arraySlice$4=arraySlice$a,createElement=documentCreateElement$2,validateArgumentsLength$a=validateArgumentsLength$b,IS_IOS$1=engineIsIos,IS_NODE$2=engineIsNode,set$1=global$y.setImmediate,clear=global$y.clearImmediate,process$2=global$y.process,Dispatch=global$y.Dispatch,Function$2=global$y.Function,MessageChannel$1=global$y.MessageChannel,String$1=global$y.String,counter=0,queue$2={},ONREADYSTATECHANGE="onreadystatechange",$location,defer,channel,port;fails$y(function(){$location=global$y.location});var run=function(G){if(hasOwn$b(queue$2,G)){var W=queue$2[G];delete queue$2[G],W()}},runner=function(G){return function(){run(G)}},eventListener=function(G){run(G.data)},globalPostMessageDefer=function(G){global$y.postMessage(String$1(G),$location.protocol+"//"+$location.host)};(!set$1||!clear)&&(set$1=function(W){validateArgumentsLength$a(arguments.length,1);var X=isCallable$b(W)?W:Function$2(W),V=arraySlice$4(arguments,1);return queue$2[++counter]=function(){apply$7(X,void 0,V)},defer(counter),counter},clear=function(W){delete queue$2[W]},IS_NODE$2?defer=function(G){process$2.nextTick(runner(G))}:Dispatch&&Dispatch.now?defer=function(G){Dispatch.now(runner(G))}:MessageChannel$1&&!IS_IOS$1?(channel=new MessageChannel$1,port=channel.port2,channel.port1.onmessage=eventListener,defer=bind$6(port.postMessage,port)):global$y.addEventListener&&isCallable$b(global$y.postMessage)&&!global$y.importScripts&&$location&&$location.protocol!=="file:"&&!fails$y(globalPostMessageDefer)?(defer=globalPostMessageDefer,global$y.addEventListener("message",eventListener,!1)):ONREADYSTATECHANGE in createElement("script")?defer=function(G){html.appendChild(createElement("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run(G)}}:defer=function(G){setTimeout(runner(G),0)});var task$1={set:set$1,clear},global$x=global$10,DESCRIPTORS$e=descriptors,getOwnPropertyDescriptor$3=Object.getOwnPropertyDescriptor,safeGetBuiltIn$2=function(G){if(!DESCRIPTORS$e)return global$x[G];var W=getOwnPropertyDescriptor$3(global$x,G);return W&&W.value},Queue$2=function(){this.head=null,this.tail=null};Queue$2.prototype={add:function(G){var W={item:G,next:null},X=this.tail;X?X.next=W:this.head=W,this.tail=W},get:function(){var G=this.head;if(G){var W=this.head=G.next;return W===null&&(this.tail=null),G.item}}};var queue$1=Queue$2,userAgent$2=engineUserAgent,engineIsIosPebble=/ipad|iphone|ipod/i.test(userAgent$2)&&typeof Pebble<"u",userAgent$1=engineUserAgent,engineIsWebosWebkit=/web0s(?!.*chrome)/i.test(userAgent$1),global$w=global$10,safeGetBuiltIn$1=safeGetBuiltIn$2,bind$5=functionBindContext,macrotask=task$1.set,Queue$1=queue$1,IS_IOS=engineIsIos,IS_IOS_PEBBLE=engineIsIosPebble,IS_WEBOS_WEBKIT=engineIsWebosWebkit,IS_NODE$1=engineIsNode,MutationObserver$1=global$w.MutationObserver||global$w.WebKitMutationObserver,document$2=global$w.document,process$1=global$w.process,Promise$1=global$w.Promise,microtask$2=safeGetBuiltIn$1("queueMicrotask"),notify$1,toggle,node,promise,then;if(!microtask$2){var queue=new Queue$1,flush=function(){var G,W;for(IS_NODE$1&&(G=process$1.domain)&&G.exit();W=queue.get();)try{W()}catch(X){throw queue.head&&notify$1(),X}G&&G.enter()};!IS_IOS&&!IS_NODE$1&&!IS_WEBOS_WEBKIT&&MutationObserver$1&&document$2?(toggle=!0,node=document$2.createTextNode(""),new MutationObserver$1(flush).observe(node,{characterData:!0}),notify$1=function(){node.data=toggle=!toggle}):!IS_IOS_PEBBLE&&Promise$1&&Promise$1.resolve?(promise=Promise$1.resolve(void 0),promise.constructor=Promise$1,then=bind$5(promise.then,promise),notify$1=function(){then(flush)}):IS_NODE$1?notify$1=function(){process$1.nextTick(flush)}:(macrotask=bind$5(macrotask,global$w),notify$1=function(){macrotask(flush)}),microtask$2=function(G){queue.head||notify$1(),queue.add(G)}}var microtask_1=microtask$2,hostReportErrors$1=function(G,W){try{arguments.length===1?console.error(G):console.error(G,W)}catch{}},perform$5=function(G){try{return{error:!1,value:G()}}catch(W){return{error:!0,value:W}}},global$v=global$10,promiseNativeConstructor=global$v.Promise,global$u=global$10,NativePromiseConstructor$4=promiseNativeConstructor,isCallable$a=isCallable$y,isForced$1=isForced_1,inspectSource=inspectSource$3,wellKnownSymbol$b=wellKnownSymbol$z,IS_BROWSER=engineIsBrowser,IS_DENO=engineIsDeno,V8_VERSION=engineV8Version;NativePromiseConstructor$4&&NativePromiseConstructor$4.prototype;var SPECIES$1=wellKnownSymbol$b("species"),SUBCLASSING=!1,NATIVE_PROMISE_REJECTION_EVENT$1=isCallable$a(global$u.PromiseRejectionEvent),FORCED_PROMISE_CONSTRUCTOR$5=isForced$1("Promise",function(){var G=inspectSource(NativePromiseConstructor$4),W=G!==String(NativePromiseConstructor$4);if(!W&&V8_VERSION===66)return!0;if(!V8_VERSION||V8_VERSION<51||!/native code/.test(G)){var X=new NativePromiseConstructor$4(function(re){re(1)}),V=function(re){re(function(){},function(){})},Z=X.constructor={};if(Z[SPECIES$1]=V,SUBCLASSING=X.then(function(){})instanceof V,!SUBCLASSING)return!0}return!W&&(IS_BROWSER||IS_DENO)&&!NATIVE_PROMISE_REJECTION_EVENT$1}),promiseConstructorDetection={CONSTRUCTOR:FORCED_PROMISE_CONSTRUCTOR$5,REJECTION_EVENT:NATIVE_PROMISE_REJECTION_EVENT$1,SUBCLASSING},newPromiseCapability$2={},aCallable$9=aCallable$n,$TypeError$8=TypeError,PromiseCapability=function(G){var W,X;this.promise=new G(function(V,Z){if(W!==void 0||X!==void 0)throw new $TypeError$8("Bad Promise constructor");W=V,X=Z}),this.resolve=aCallable$9(W),this.reject=aCallable$9(X)};newPromiseCapability$2.f=function(G){return new PromiseCapability(G)};var $$1c=_export,IS_NODE=engineIsNode,global$t=global$10,call$r=functionCall,defineBuiltIn$b=defineBuiltIn$o,setPrototypeOf$1=objectSetPrototypeOf$1,setToStringTag$5=setToStringTag$e,setSpecies$2=setSpecies$6,aCallable$8=aCallable$n,isCallable$9=isCallable$y,isObject$g=isObject$G,anInstance$6=anInstance$a,speciesConstructor$4=speciesConstructor$6,task=task$1.set,microtask$1=microtask_1,hostReportErrors=hostReportErrors$1,perform$4=perform$5,Queue=queue$1,InternalStateModule$7=internalState,NativePromiseConstructor$3=promiseNativeConstructor,PromiseConstructorDetection=promiseConstructorDetection,newPromiseCapabilityModule$6=newPromiseCapability$2,PROMISE="Promise",FORCED_PROMISE_CONSTRUCTOR$4=PromiseConstructorDetection.CONSTRUCTOR,NATIVE_PROMISE_REJECTION_EVENT=PromiseConstructorDetection.REJECTION_EVENT,NATIVE_PROMISE_SUBCLASSING=PromiseConstructorDetection.SUBCLASSING,getInternalPromiseState=InternalStateModule$7.getterFor(PROMISE),setInternalState$7=InternalStateModule$7.set,NativePromisePrototype$2=NativePromiseConstructor$3&&NativePromiseConstructor$3.prototype,PromiseConstructor=NativePromiseConstructor$3,PromisePrototype=NativePromisePrototype$2,TypeError$4=global$t.TypeError,document$1=global$t.document,process=global$t.process,newPromiseCapability$1=newPromiseCapabilityModule$6.f,newGenericPromiseCapability=newPromiseCapability$1,DISPATCH_EVENT=!!(document$1&&document$1.createEvent&&global$t.dispatchEvent),UNHANDLED_REJECTION="unhandledrejection",REJECTION_HANDLED="rejectionhandled",PENDING=0,FULFILLED=1,REJECTED=2,HANDLED=1,UNHANDLED=2,Internal,OwnPromiseCapability,PromiseWrapper,nativeThen,isThenable=function(G){var W;return isObject$g(G)&&isCallable$9(W=G.then)?W:!1},callReaction=function(G,W){var X=W.value,V=W.state===FULFILLED,Z=V?G.ok:G.fail,re=G.resolve,se=G.reject,ue=G.domain,H,ye,Ie;try{Z?(V||(W.rejection===UNHANDLED&&onHandleUnhandled(W),W.rejection=HANDLED),Z===!0?H=X:(ue&&ue.enter(),H=Z(X),ue&&(ue.exit(),Ie=!0)),H===G.promise?se(new TypeError$4("Promise-chain cycle")):(ye=isThenable(H))?call$r(ye,H,re,se):re(H)):se(X)}catch(Ee){ue&&!Ie&&ue.exit(),se(Ee)}},notify=function(G,W){G.notified||(G.notified=!0,microtask$1(function(){for(var X=G.reactions,V;V=X.get();)callReaction(V,G);G.notified=!1,W&&!G.rejection&&onUnhandled(G)}))},dispatchEvent=function(G,W,X){var V,Z;DISPATCH_EVENT?(V=document$1.createEvent("Event"),V.promise=W,V.reason=X,V.initEvent(G,!1,!0),global$t.dispatchEvent(V)):V={promise:W,reason:X},!NATIVE_PROMISE_REJECTION_EVENT&&(Z=global$t["on"+G])?Z(V):G===UNHANDLED_REJECTION&&hostReportErrors("Unhandled promise rejection",X)},onUnhandled=function(G){call$r(task,global$t,function(){var W=G.facade,X=G.value,V=isUnhandled(G),Z;if(V&&(Z=perform$4(function(){IS_NODE?process.emit("unhandledRejection",X,W):dispatchEvent(UNHANDLED_REJECTION,W,X)}),G.rejection=IS_NODE||isUnhandled(G)?UNHANDLED:HANDLED,Z.error))throw Z.value})},isUnhandled=function(G){return G.rejection!==HANDLED&&!G.parent},onHandleUnhandled=function(G){call$r(task,global$t,function(){var W=G.facade;IS_NODE?process.emit("rejectionHandled",W):dispatchEvent(REJECTION_HANDLED,W,G.value)})},bind$4=function(G,W,X){return function(V){G(W,V,X)}},internalReject=function(G,W,X){G.done||(G.done=!0,X&&(G=X),G.value=W,G.state=REJECTED,notify(G,!0))},internalResolve=function(G,W,X){if(!G.done){G.done=!0,X&&(G=X);try{if(G.facade===W)throw new TypeError$4("Promise can't be resolved itself");var V=isThenable(W);V?microtask$1(function(){var Z={done:!1};try{call$r(V,W,bind$4(internalResolve,Z,G),bind$4(internalReject,Z,G))}catch(re){internalReject(Z,re,G)}}):(G.value=W,G.state=FULFILLED,notify(G,!1))}catch(Z){internalReject({done:!1},Z,G)}}};if(FORCED_PROMISE_CONSTRUCTOR$4&&(PromiseConstructor=function(W){anInstance$6(this,PromisePrototype),aCallable$8(W),call$r(Internal,this);var X=getInternalPromiseState(this);try{W(bind$4(internalResolve,X),bind$4(internalReject,X))}catch(V){internalReject(X,V)}},PromisePrototype=PromiseConstructor.prototype,Internal=function(W){setInternalState$7(this,{type:PROMISE,done:!1,notified:!1,parent:!1,reactions:new Queue,rejection:!1,state:PENDING,value:void 0})},Internal.prototype=defineBuiltIn$b(PromisePrototype,"then",function(W,X){var V=getInternalPromiseState(this),Z=newPromiseCapability$1(speciesConstructor$4(this,PromiseConstructor));return V.parent=!0,Z.ok=isCallable$9(W)?W:!0,Z.fail=isCallable$9(X)&&X,Z.domain=IS_NODE?process.domain:void 0,V.state===PENDING?V.reactions.add(Z):microtask$1(function(){callReaction(Z,V)}),Z.promise}),OwnPromiseCapability=function(){var G=new Internal,W=getInternalPromiseState(G);this.promise=G,this.resolve=bind$4(internalResolve,W),this.reject=bind$4(internalReject,W)},newPromiseCapabilityModule$6.f=newPromiseCapability$1=function(G){return G===PromiseConstructor||G===PromiseWrapper?new OwnPromiseCapability(G):newGenericPromiseCapability(G)},isCallable$9(NativePromiseConstructor$3)&&NativePromisePrototype$2!==Object.prototype)){nativeThen=NativePromisePrototype$2.then,NATIVE_PROMISE_SUBCLASSING||defineBuiltIn$b(NativePromisePrototype$2,"then",function(W,X){var V=this;return new PromiseConstructor(function(Z,re){call$r(nativeThen,V,Z,re)}).then(W,X)},{unsafe:!0});try{delete NativePromisePrototype$2.constructor}catch{}setPrototypeOf$1&&setPrototypeOf$1(NativePromisePrototype$2,PromisePrototype)}$$1c({global:!0,constructor:!0,wrap:!0,forced:FORCED_PROMISE_CONSTRUCTOR$4},{Promise:PromiseConstructor});setToStringTag$5(PromiseConstructor,PROMISE,!1);setSpecies$2(PROMISE);var NativePromiseConstructor$2=promiseNativeConstructor,checkCorrectnessOfIteration$1=checkCorrectnessOfIteration$4,FORCED_PROMISE_CONSTRUCTOR$3=promiseConstructorDetection.CONSTRUCTOR,promiseStaticsIncorrectIteration=FORCED_PROMISE_CONSTRUCTOR$3||!checkCorrectnessOfIteration$1(function(G){NativePromiseConstructor$2.all(G).then(void 0,function(){})}),$$1b=_export,call$q=functionCall,aCallable$7=aCallable$n,newPromiseCapabilityModule$5=newPromiseCapability$2,perform$3=perform$5,iterate$5=iterate$c,PROMISE_STATICS_INCORRECT_ITERATION$3=promiseStaticsIncorrectIteration;$$1b({target:"Promise",stat:!0,forced:PROMISE_STATICS_INCORRECT_ITERATION$3},{all:function(W){var X=this,V=newPromiseCapabilityModule$5.f(X),Z=V.resolve,re=V.reject,se=perform$3(function(){var ue=aCallable$7(X.resolve),H=[],ye=0,Ie=1;iterate$5(W,function(Ee){var Fe=ye++,je=!1;Ie++,call$q(ue,X,Ee).then(function(mt){je||(je=!0,H[Fe]=mt,--Ie||Z(H))},re)}),--Ie||Z(H)});return se.error&&re(se.value),V.promise}});var $$1a=_export,FORCED_PROMISE_CONSTRUCTOR$2=promiseConstructorDetection.CONSTRUCTOR,NativePromiseConstructor$1=promiseNativeConstructor,getBuiltIn$c=getBuiltIn$p,isCallable$8=isCallable$y,defineBuiltIn$a=defineBuiltIn$o,NativePromisePrototype$1=NativePromiseConstructor$1&&NativePromiseConstructor$1.prototype;$$1a({target:"Promise",proto:!0,forced:FORCED_PROMISE_CONSTRUCTOR$2,real:!0},{catch:function(G){return this.then(void 0,G)}});if(isCallable$8(NativePromiseConstructor$1)){var method$1=getBuiltIn$c("Promise").prototype.catch;NativePromisePrototype$1.catch!==method$1&&defineBuiltIn$a(NativePromisePrototype$1,"catch",method$1,{unsafe:!0})}var $$19=_export,call$p=functionCall,aCallable$6=aCallable$n,newPromiseCapabilityModule$4=newPromiseCapability$2,perform$2=perform$5,iterate$4=iterate$c,PROMISE_STATICS_INCORRECT_ITERATION$2=promiseStaticsIncorrectIteration;$$19({target:"Promise",stat:!0,forced:PROMISE_STATICS_INCORRECT_ITERATION$2},{race:function(W){var X=this,V=newPromiseCapabilityModule$4.f(X),Z=V.reject,re=perform$2(function(){var se=aCallable$6(X.resolve);iterate$4(W,function(ue){call$p(se,X,ue).then(V.resolve,Z)})});return re.error&&Z(re.value),V.promise}});var $$18=_export,newPromiseCapabilityModule$3=newPromiseCapability$2,FORCED_PROMISE_CONSTRUCTOR$1=promiseConstructorDetection.CONSTRUCTOR;$$18({target:"Promise",stat:!0,forced:FORCED_PROMISE_CONSTRUCTOR$1},{reject:function(W){var X=newPromiseCapabilityModule$3.f(this),V=X.reject;return V(W),X.promise}});var anObject$o=anObject$D,isObject$f=isObject$G,newPromiseCapability=newPromiseCapability$2,promiseResolve$2=function(G,W){if(anObject$o(G),isObject$f(W)&&W.constructor===G)return W;var X=newPromiseCapability.f(G),V=X.resolve;return V(W),X.promise},$$17=_export,getBuiltIn$b=getBuiltIn$p,FORCED_PROMISE_CONSTRUCTOR=promiseConstructorDetection.CONSTRUCTOR,promiseResolve$1=promiseResolve$2;getBuiltIn$b("Promise");$$17({target:"Promise",stat:!0,forced:FORCED_PROMISE_CONSTRUCTOR},{resolve:function(W){return promiseResolve$1(this,W)}});var $$16=_export,call$o=functionCall,aCallable$5=aCallable$n,newPromiseCapabilityModule$2=newPromiseCapability$2,perform$1=perform$5,iterate$3=iterate$c,PROMISE_STATICS_INCORRECT_ITERATION$1=promiseStaticsIncorrectIteration;$$16({target:"Promise",stat:!0,forced:PROMISE_STATICS_INCORRECT_ITERATION$1},{allSettled:function(W){var X=this,V=newPromiseCapabilityModule$2.f(X),Z=V.resolve,re=V.reject,se=perform$1(function(){var ue=aCallable$5(X.resolve),H=[],ye=0,Ie=1;iterate$3(W,function(Ee){var Fe=ye++,je=!1;Ie++,call$o(ue,X,Ee).then(function(mt){je||(je=!0,H[Fe]={status:"fulfilled",value:mt},--Ie||Z(H))},function(mt){je||(je=!0,H[Fe]={status:"rejected",reason:mt},--Ie||Z(H))})}),--Ie||Z(H)});return se.error&&re(se.value),V.promise}});var $$15=_export,call$n=functionCall,aCallable$4=aCallable$n,getBuiltIn$a=getBuiltIn$p,newPromiseCapabilityModule$1=newPromiseCapability$2,perform=perform$5,iterate$2=iterate$c,PROMISE_STATICS_INCORRECT_ITERATION=promiseStaticsIncorrectIteration,PROMISE_ANY_ERROR="No one promise resolved";$$15({target:"Promise",stat:!0,forced:PROMISE_STATICS_INCORRECT_ITERATION},{any:function(W){var X=this,V=getBuiltIn$a("AggregateError"),Z=newPromiseCapabilityModule$1.f(X),re=Z.resolve,se=Z.reject,ue=perform(function(){var H=aCallable$4(X.resolve),ye=[],Ie=0,Ee=1,Fe=!1;iterate$2(W,function(je){var mt=Ie++,wt=!1;Ee++,call$n(H,X,je).then(function(Ot){wt||Fe||(Fe=!0,re(Ot))},function(Ot){wt||Fe||(wt=!0,ye[mt]=Ot,--Ee||se(new V(ye,PROMISE_ANY_ERROR)))})}),--Ee||se(new V(ye,PROMISE_ANY_ERROR))});return ue.error&&se(ue.value),Z.promise}});var $$14=_export,NativePromiseConstructor=promiseNativeConstructor,fails$x=fails$1p,getBuiltIn$9=getBuiltIn$p,isCallable$7=isCallable$y,speciesConstructor$3=speciesConstructor$6,promiseResolve=promiseResolve$2,defineBuiltIn$9=defineBuiltIn$o,NativePromisePrototype=NativePromiseConstructor&&NativePromiseConstructor.prototype,NON_GENERIC=!!NativePromiseConstructor&&fails$x(function(){NativePromisePrototype.finally.call({then:function(){}},function(){})});$$14({target:"Promise",proto:!0,real:!0,forced:NON_GENERIC},{finally:function(G){var W=speciesConstructor$3(this,getBuiltIn$9("Promise")),X=isCallable$7(G);return this.then(X?function(V){return promiseResolve(W,G()).then(function(){return V})}:G,X?function(V){return promiseResolve(W,G()).then(function(){throw V})}:G)}});if(isCallable$7(NativePromiseConstructor)){var method=getBuiltIn$9("Promise").prototype.finally;NativePromisePrototype.finally!==method&&defineBuiltIn$9(NativePromisePrototype,"finally",method,{unsafe:!0})}var $$13=_export,newPromiseCapabilityModule=newPromiseCapability$2;$$13({target:"Promise",stat:!0},{withResolvers:function(){var W=newPromiseCapabilityModule.f(this);return{promise:W.promise,resolve:W.resolve,reject:W.reject}}});var $$12=_export,functionApply=functionApply$1,aCallable$3=aCallable$n,anObject$n=anObject$D,fails$w=fails$1p,OPTIONAL_ARGUMENTS_LIST=!fails$w(function(){Reflect.apply(function(){})});$$12({target:"Reflect",stat:!0,forced:OPTIONAL_ARGUMENTS_LIST},{apply:function(W,X,V){return functionApply(aCallable$3(W),X,anObject$n(V))}});var $$11=_export,getBuiltIn$8=getBuiltIn$p,apply$6=functionApply$1,bind$3=functionBind,aConstructor$1=aConstructor$3,anObject$m=anObject$D,isObject$e=isObject$G,create$7=objectCreate,fails$v=fails$1p,nativeConstruct=getBuiltIn$8("Reflect","construct"),ObjectPrototype=Object.prototype,push$8=[].push,NEW_TARGET_BUG=fails$v(function(){function G(){}return!(nativeConstruct(function(){},[],G)instanceof G)}),ARGS_BUG=!fails$v(function(){nativeConstruct(function(){})}),FORCED$6=NEW_TARGET_BUG||ARGS_BUG;$$11({target:"Reflect",stat:!0,forced:FORCED$6,sham:FORCED$6},{construct:function(W,X){aConstructor$1(W),anObject$m(X);var V=arguments.length<3?W:aConstructor$1(arguments[2]);if(ARGS_BUG&&!NEW_TARGET_BUG)return nativeConstruct(W,X,V);if(W===V){switch(X.length){case 0:return new W;case 1:return new W(X[0]);case 2:return new W(X[0],X[1]);case 3:return new W(X[0],X[1],X[2]);case 4:return new W(X[0],X[1],X[2],X[3])}var Z=[null];return apply$6(push$8,Z,X),new(apply$6(bind$3,W,Z))}var re=V.prototype,se=create$7(isObject$e(re)?re:ObjectPrototype),ue=apply$6(W,se,X);return isObject$e(ue)?ue:se}});var $$10=_export,DESCRIPTORS$d=descriptors,anObject$l=anObject$D,toPropertyKey$1=toPropertyKey$8,definePropertyModule$2=objectDefineProperty,fails$u=fails$1p,ERROR_INSTEAD_OF_FALSE=fails$u(function(){Reflect.defineProperty(definePropertyModule$2.f({},1,{value:1}),1,{value:2})});$$10({target:"Reflect",stat:!0,forced:ERROR_INSTEAD_OF_FALSE,sham:!DESCRIPTORS$d},{defineProperty:function(W,X,V){anObject$l(W);var Z=toPropertyKey$1(X);anObject$l(V);try{return definePropertyModule$2.f(W,Z,V),!0}catch{return!1}}});var $$$=_export,anObject$k=anObject$D,getOwnPropertyDescriptor$2=objectGetOwnPropertyDescriptor.f;$$$({target:"Reflect",stat:!0},{deleteProperty:function(W,X){var V=getOwnPropertyDescriptor$2(anObject$k(W),X);return V&&!V.configurable?!1:delete W[X]}});var hasOwn$a=hasOwnProperty_1,isDataDescriptor$2=function(G){return G!==void 0&&(hasOwn$a(G,"value")||hasOwn$a(G,"writable"))},$$_=_export,call$m=functionCall,isObject$d=isObject$G,anObject$j=anObject$D,isDataDescriptor$1=isDataDescriptor$2,getOwnPropertyDescriptorModule$3=objectGetOwnPropertyDescriptor,getPrototypeOf$1=objectGetPrototypeOf$2;function get(G,W){var X=arguments.length<3?G:arguments[2],V,Z;if(anObject$j(G)===X)return G[W];if(V=getOwnPropertyDescriptorModule$3.f(G,W),V)return isDataDescriptor$1(V)?V.value:V.get===void 0?void 0:call$m(V.get,X);if(isObject$d(Z=getPrototypeOf$1(G)))return get(Z,W,X)}$$_({target:"Reflect",stat:!0},{get});var $$Z=_export,DESCRIPTORS$c=descriptors,anObject$i=anObject$D,getOwnPropertyDescriptorModule$2=objectGetOwnPropertyDescriptor;$$Z({target:"Reflect",stat:!0,sham:!DESCRIPTORS$c},{getOwnPropertyDescriptor:function(W,X){return getOwnPropertyDescriptorModule$2.f(anObject$i(W),X)}});var $$Y=_export,anObject$h=anObject$D,objectGetPrototypeOf=objectGetPrototypeOf$2,CORRECT_PROTOTYPE_GETTER=correctPrototypeGetter;$$Y({target:"Reflect",stat:!0,sham:!CORRECT_PROTOTYPE_GETTER},{getPrototypeOf:function(W){return objectGetPrototypeOf(anObject$h(W))}});var $$X=_export;$$X({target:"Reflect",stat:!0},{has:function(W,X){return X in W}});var $$W=_export,anObject$g=anObject$D,$isExtensible=objectIsExtensible;$$W({target:"Reflect",stat:!0},{isExtensible:function(W){return anObject$g(W),$isExtensible(W)}});var $$V=_export,ownKeys=ownKeys$3;$$V({target:"Reflect",stat:!0},{ownKeys});var $$U=_export,getBuiltIn$7=getBuiltIn$p,anObject$f=anObject$D,FREEZING$1=freezing;$$U({target:"Reflect",stat:!0,sham:!FREEZING$1},{preventExtensions:function(W){anObject$f(W);try{var X=getBuiltIn$7("Object","preventExtensions");return X&&X(W),!0}catch{return!1}}});var $$T=_export,call$l=functionCall,anObject$e=anObject$D,isObject$c=isObject$G,isDataDescriptor=isDataDescriptor$2,fails$t=fails$1p,definePropertyModule$1=objectDefineProperty,getOwnPropertyDescriptorModule$1=objectGetOwnPropertyDescriptor,getPrototypeOf=objectGetPrototypeOf$2,createPropertyDescriptor$4=createPropertyDescriptor$c;function set(G,W,X){var V=arguments.length<4?G:arguments[3],Z=getOwnPropertyDescriptorModule$1.f(anObject$e(G),W),re,se,ue;if(!Z){if(isObject$c(se=getPrototypeOf(G)))return set(se,W,X,V);Z=createPropertyDescriptor$4(0)}if(isDataDescriptor(Z)){if(Z.writable===!1||!isObject$c(V))return!1;if(re=getOwnPropertyDescriptorModule$1.f(V,W)){if(re.get||re.set||re.writable===!1)return!1;re.value=X,definePropertyModule$1.f(V,W,re)}else definePropertyModule$1.f(V,W,createPropertyDescriptor$4(0,X))}else{if(ue=Z.set,ue===void 0)return!1;call$l(ue,V,X)}return!0}var MS_EDGE_BUG=fails$t(function(){var G=function(){},W=definePropertyModule$1.f(new G,"a",{configurable:!0});return Reflect.set(G.prototype,"a",1,W)!==!1});$$T({target:"Reflect",stat:!0,forced:MS_EDGE_BUG},{set});var $$S=_export,anObject$d=anObject$D,aPossiblePrototype=aPossiblePrototype$2,objectSetPrototypeOf=objectSetPrototypeOf$1;objectSetPrototypeOf&&$$S({target:"Reflect",stat:!0},{setPrototypeOf:function(W,X){anObject$d(W),aPossiblePrototype(X);try{return objectSetPrototypeOf(W,X),!0}catch{return!1}}});var $$R=_export,global$s=global$10,setToStringTag$4=setToStringTag$e;$$R({global:!0},{Reflect:{}});setToStringTag$4(global$s.Reflect,"Reflect",!0);var isObject$b=isObject$G,classof$9=classofRaw$2,wellKnownSymbol$a=wellKnownSymbol$z,MATCH$2=wellKnownSymbol$a("match"),isRegexp=function(G){var W;return isObject$b(G)&&((W=G[MATCH$2])!==void 0?!!W:classof$9(G)==="RegExp")},anObject$c=anObject$D,regexpFlags$1=function(){var G=anObject$c(this),W="";return G.hasIndices&&(W+="d"),G.global&&(W+="g"),G.ignoreCase&&(W+="i"),G.multiline&&(W+="m"),G.dotAll&&(W+="s"),G.unicode&&(W+="u"),G.unicodeSets&&(W+="v"),G.sticky&&(W+="y"),W},call$k=functionCall,hasOwn$9=hasOwnProperty_1,isPrototypeOf$2=objectIsPrototypeOf,regExpFlags$1=regexpFlags$1,RegExpPrototype$7=RegExp.prototype,regexpGetFlags=function(G){var W=G.flags;return W===void 0&&!("flags"in RegExpPrototype$7)&&!hasOwn$9(G,"flags")&&isPrototypeOf$2(RegExpPrototype$7,G)?call$k(regExpFlags$1,G):W},fails$s=fails$1p,global$r=global$10,$RegExp$2=global$r.RegExp,UNSUPPORTED_Y$3=fails$s(function(){var G=$RegExp$2("a","y");return G.lastIndex=2,G.exec("abcd")!==null}),MISSED_STICKY$2=UNSUPPORTED_Y$3||fails$s(function(){return!$RegExp$2("a","y").sticky}),BROKEN_CARET=UNSUPPORTED_Y$3||fails$s(function(){var G=$RegExp$2("^r","gy");return G.lastIndex=2,G.exec("str")!==null}),regexpStickyHelpers={BROKEN_CARET,MISSED_STICKY:MISSED_STICKY$2,UNSUPPORTED_Y:UNSUPPORTED_Y$3},fails$r=fails$1p,global$q=global$10,$RegExp$1=global$q.RegExp,regexpUnsupportedDotAll=fails$r(function(){var G=$RegExp$1(".","s");return!(G.dotAll&&G.test(`
`)&&G.flags==="s")}),fails$q=fails$1p,global$p=global$10,$RegExp=global$p.RegExp,regexpUnsupportedNcg=fails$q(function(){var G=$RegExp("(?<a>b)","g");return G.exec("b").groups.a!=="b"||"b".replace(G,"$<a>c")!=="bc"}),DESCRIPTORS$b=descriptors,global$o=global$10,uncurryThis$C=functionUncurryThis,isForced=isForced_1,inheritIfRequired$2=inheritIfRequired$7,createNonEnumerableProperty$5=createNonEnumerableProperty$f,create$6=objectCreate,getOwnPropertyNames$1=objectGetOwnPropertyNames.f,isPrototypeOf$1=objectIsPrototypeOf,isRegExp$4=isRegexp,toString$r=toString$E,getRegExpFlags$4=regexpGetFlags,stickyHelpers$2=regexpStickyHelpers,proxyAccessor=proxyAccessor$2,defineBuiltIn$8=defineBuiltIn$o,fails$p=fails$1p,hasOwn$8=hasOwnProperty_1,enforceInternalState$2=internalState.enforce,setSpecies$1=setSpecies$6,wellKnownSymbol$9=wellKnownSymbol$z,UNSUPPORTED_DOT_ALL$2=regexpUnsupportedDotAll,UNSUPPORTED_NCG$1=regexpUnsupportedNcg,MATCH$1=wellKnownSymbol$9("match"),NativeRegExp=global$o.RegExp,RegExpPrototype$6=NativeRegExp.prototype,SyntaxError=global$o.SyntaxError,exec$5=uncurryThis$C(RegExpPrototype$6.exec),charAt$c=uncurryThis$C("".charAt),replace$7=uncurryThis$C("".replace),stringIndexOf$3=uncurryThis$C("".indexOf),stringSlice$b=uncurryThis$C("".slice),IS_NCG=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,re1=/a/g,re2=/a/g,CORRECT_NEW=new NativeRegExp(re1)!==re1,MISSED_STICKY$1=stickyHelpers$2.MISSED_STICKY,UNSUPPORTED_Y$2=stickyHelpers$2.UNSUPPORTED_Y,BASE_FORCED=DESCRIPTORS$b&&(!CORRECT_NEW||MISSED_STICKY$1||UNSUPPORTED_DOT_ALL$2||UNSUPPORTED_NCG$1||fails$p(function(){return re2[MATCH$1]=!1,NativeRegExp(re1)!==re1||NativeRegExp(re2)===re2||String(NativeRegExp(re1,"i"))!=="/a/i"})),handleDotAll=function(G){for(var W=G.length,X=0,V="",Z=!1,re;X<=W;X++){if(re=charAt$c(G,X),re==="\\"){V+=re+charAt$c(G,++X);continue}!Z&&re==="."?V+="[\\s\\S]":(re==="["?Z=!0:re==="]"&&(Z=!1),V+=re)}return V},handleNCG=function(G){for(var W=G.length,X=0,V="",Z=[],re=create$6(null),se=!1,ue=!1,H=0,ye="",Ie;X<=W;X++){if(Ie=charAt$c(G,X),Ie==="\\")Ie+=charAt$c(G,++X);else if(Ie==="]")se=!1;else if(!se)switch(!0){case Ie==="[":se=!0;break;case Ie==="(":exec$5(IS_NCG,stringSlice$b(G,X+1))&&(X+=2,ue=!0),V+=Ie,H++;continue;case(Ie===">"&&ue):if(ye===""||hasOwn$8(re,ye))throw new SyntaxError("Invalid capture group name");re[ye]=!0,Z[Z.length]=[ye,H],ue=!1,ye="";continue}ue?ye+=Ie:V+=Ie}return[V,Z]};if(isForced("RegExp",BASE_FORCED)){for(var RegExpWrapper=function(W,X){var V=isPrototypeOf$1(RegExpPrototype$6,this),Z=isRegExp$4(W),re=X===void 0,se=[],ue=W,H,ye,Ie,Ee,Fe,je;if(!V&&Z&&re&&W.constructor===RegExpWrapper)return W;if((Z||isPrototypeOf$1(RegExpPrototype$6,W))&&(W=W.source,re&&(X=getRegExpFlags$4(ue))),W=W===void 0?"":toString$r(W),X=X===void 0?"":toString$r(X),ue=W,UNSUPPORTED_DOT_ALL$2&&"dotAll"in re1&&(ye=!!X&&stringIndexOf$3(X,"s")>-1,ye&&(X=replace$7(X,/s/g,""))),H=X,MISSED_STICKY$1&&"sticky"in re1&&(Ie=!!X&&stringIndexOf$3(X,"y")>-1,Ie&&UNSUPPORTED_Y$2&&(X=replace$7(X,/y/g,""))),UNSUPPORTED_NCG$1&&(Ee=handleNCG(W),W=Ee[0],se=Ee[1]),Fe=inheritIfRequired$2(NativeRegExp(W,X),V?this:RegExpPrototype$6,RegExpWrapper),(ye||Ie||se.length)&&(je=enforceInternalState$2(Fe),ye&&(je.dotAll=!0,je.raw=RegExpWrapper(handleDotAll(W),H)),Ie&&(je.sticky=!0),se.length&&(je.groups=se)),W!==ue)try{createNonEnumerableProperty$5(Fe,"source",ue===""?"(?:)":ue)}catch{}return Fe},keys$1=getOwnPropertyNames$1(NativeRegExp),index=0;keys$1.length>index;)proxyAccessor(RegExpWrapper,NativeRegExp,keys$1[index++]);RegExpPrototype$6.constructor=RegExpWrapper,RegExpWrapper.prototype=RegExpPrototype$6,defineBuiltIn$8(global$o,"RegExp",RegExpWrapper,{constructor:!0})}setSpecies$1("RegExp");var DESCRIPTORS$a=descriptors,UNSUPPORTED_DOT_ALL$1=regexpUnsupportedDotAll,classof$8=classofRaw$2,defineBuiltInAccessor$8=defineBuiltInAccessor$i,getInternalState$6=internalState.get,RegExpPrototype$5=RegExp.prototype,$TypeError$7=TypeError;DESCRIPTORS$a&&UNSUPPORTED_DOT_ALL$1&&defineBuiltInAccessor$8(RegExpPrototype$5,"dotAll",{configurable:!0,get:function(){if(this!==RegExpPrototype$5){if(classof$8(this)==="RegExp")return!!getInternalState$6(this).dotAll;throw new $TypeError$7("Incompatible receiver, RegExp required")}}});var call$j=functionCall,uncurryThis$B=functionUncurryThis,toString$q=toString$E,regexpFlags=regexpFlags$1,stickyHelpers$1=regexpStickyHelpers,shared=shared$7,create$5=objectCreate,getInternalState$5=internalState.get,UNSUPPORTED_DOT_ALL=regexpUnsupportedDotAll,UNSUPPORTED_NCG=regexpUnsupportedNcg,nativeReplace=shared("native-string-replace",String.prototype.replace),nativeExec=RegExp.prototype.exec,patchedExec=nativeExec,charAt$b=uncurryThis$B("".charAt),indexOf$2=uncurryThis$B("".indexOf),replace$6=uncurryThis$B("".replace),stringSlice$a=uncurryThis$B("".slice),UPDATES_LAST_INDEX_WRONG=function(){var G=/a/,W=/b*/g;return call$j(nativeExec,G,"a"),call$j(nativeExec,W,"a"),G.lastIndex!==0||W.lastIndex!==0}(),UNSUPPORTED_Y$1=stickyHelpers$1.BROKEN_CARET,NPCG_INCLUDED=/()??/.exec("")[1]!==void 0,PATCH=UPDATES_LAST_INDEX_WRONG||NPCG_INCLUDED||UNSUPPORTED_Y$1||UNSUPPORTED_DOT_ALL||UNSUPPORTED_NCG;PATCH&&(patchedExec=function(W){var X=this,V=getInternalState$5(X),Z=toString$q(W),re=V.raw,se,ue,H,ye,Ie,Ee,Fe;if(re)return re.lastIndex=X.lastIndex,se=call$j(patchedExec,re,Z),X.lastIndex=re.lastIndex,se;var je=V.groups,mt=UNSUPPORTED_Y$1&&X.sticky,wt=call$j(regexpFlags,X),Ot=X.source,$t=0,jt=Z;if(mt&&(wt=replace$6(wt,"y",""),indexOf$2(wt,"g")===-1&&(wt+="g"),jt=stringSlice$a(Z,X.lastIndex),X.lastIndex>0&&(!X.multiline||X.multiline&&charAt$b(Z,X.lastIndex-1)!==`
`)&&(Ot="(?: "+Ot+")",jt=" "+jt,$t++),ue=new RegExp("^(?:"+Ot+")",wt)),NPCG_INCLUDED&&(ue=new RegExp("^"+Ot+"$(?!\\s)",wt)),UPDATES_LAST_INDEX_WRONG&&(H=X.lastIndex),ye=call$j(nativeExec,mt?ue:X,jt),mt?ye?(ye.input=stringSlice$a(ye.input,$t),ye[0]=stringSlice$a(ye[0],$t),ye.index=X.lastIndex,X.lastIndex+=ye[0].length):X.lastIndex=0:UPDATES_LAST_INDEX_WRONG&&ye&&(X.lastIndex=X.global?ye.index+ye[0].length:H),NPCG_INCLUDED&&ye&&ye.length>1&&call$j(nativeReplace,ye[0],ue,function(){for(Ie=1;Ie<arguments.length-2;Ie++)arguments[Ie]===void 0&&(ye[Ie]=void 0)}),ye&&je)for(ye.groups=Ee=create$5(null),Ie=0;Ie<je.length;Ie++)Fe=je[Ie],Ee[Fe[0]]=ye[Fe[1]];return ye});var regexpExec$2=patchedExec,$$Q=_export,exec$4=regexpExec$2;$$Q({target:"RegExp",proto:!0,forced:/./.exec!==exec$4},{exec:exec$4});var global$n=global$10,DESCRIPTORS$9=descriptors,defineBuiltInAccessor$7=defineBuiltInAccessor$i,regExpFlags=regexpFlags$1,fails$o=fails$1p,RegExp$2=global$n.RegExp,RegExpPrototype$4=RegExp$2.prototype,FORCED$5=DESCRIPTORS$9&&fails$o(function(){var G=!0;try{RegExp$2(".","d")}catch{G=!1}var W={},X="",V=G?"dgimsy":"gimsy",Z=function(H,ye){Object.defineProperty(W,H,{get:function(){return X+=ye,!0}})},re={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};G&&(re.hasIndices="d");for(var se in re)Z(se,re[se]);var ue=Object.getOwnPropertyDescriptor(RegExpPrototype$4,"flags").get.call(W);return ue!==V||X!==V});FORCED$5&&defineBuiltInAccessor$7(RegExpPrototype$4,"flags",{configurable:!0,get:regExpFlags});var DESCRIPTORS$8=descriptors,MISSED_STICKY=regexpStickyHelpers.MISSED_STICKY,classof$7=classofRaw$2,defineBuiltInAccessor$6=defineBuiltInAccessor$i,getInternalState$4=internalState.get,RegExpPrototype$3=RegExp.prototype,$TypeError$6=TypeError;DESCRIPTORS$8&&MISSED_STICKY&&defineBuiltInAccessor$6(RegExpPrototype$3,"sticky",{configurable:!0,get:function(){if(this!==RegExpPrototype$3){if(classof$7(this)==="RegExp")return!!getInternalState$4(this).sticky;throw new $TypeError$6("Incompatible receiver, RegExp required")}}});var $$P=_export,call$i=functionCall,isCallable$6=isCallable$y,anObject$b=anObject$D,toString$p=toString$E,DELEGATES_TO_EXEC=function(){var G=!1,W=/[ac]/;return W.exec=function(){return G=!0,/./.exec.apply(this,arguments)},W.test("abc")===!0&&G}(),nativeTest=/./.test;$$P({target:"RegExp",proto:!0,forced:!DELEGATES_TO_EXEC},{test:function(G){var W=anObject$b(this),X=toString$p(G),V=W.exec;if(!isCallable$6(V))return call$i(nativeTest,W,X);var Z=call$i(V,W,X);return Z===null?!1:(anObject$b(Z),!0)}});var PROPER_FUNCTION_NAME$1=functionName.PROPER,defineBuiltIn$7=defineBuiltIn$o,anObject$a=anObject$D,$toString$2=toString$E,fails$n=fails$1p,getRegExpFlags$3=regexpGetFlags,TO_STRING="toString",RegExpPrototype$2=RegExp.prototype,nativeToString=RegExpPrototype$2[TO_STRING],NOT_GENERIC=fails$n(function(){return nativeToString.call({source:"a",flags:"b"})!=="/a/b"}),INCORRECT_NAME=PROPER_FUNCTION_NAME$1&&nativeToString.name!==TO_STRING;(NOT_GENERIC||INCORRECT_NAME)&&defineBuiltIn$7(RegExpPrototype$2,TO_STRING,function(){var W=anObject$a(this),X=$toString$2(W.source),V=$toString$2(getRegExpFlags$3(W));return"/"+X+"/"+V},{unsafe:!0});var collection$2=collection$4,collectionStrong=collectionStrong$2;collection$2("Set",function(G){return function(){return G(this,arguments.length?arguments[0]:void 0)}},collectionStrong);var $$O=_export,uncurryThis$A=functionUncurryThis,requireObjectCoercible$e=requireObjectCoercible$n,toIntegerOrInfinity$6=toIntegerOrInfinity$l,toString$o=toString$E,fails$m=fails$1p,charAt$a=uncurryThis$A("".charAt),FORCED$4=fails$m(function(){return"ð ®·".at(-2)!=="\uD842"});$$O({target:"String",proto:!0,forced:FORCED$4},{at:function(W){var X=toString$o(requireObjectCoercible$e(this)),V=X.length,Z=toIntegerOrInfinity$6(W),re=Z>=0?Z:V+Z;return re<0||re>=V?void 0:charAt$a(X,re)}});var uncurryThis$z=functionUncurryThis,toIntegerOrInfinity$5=toIntegerOrInfinity$l,toString$n=toString$E,requireObjectCoercible$d=requireObjectCoercible$n,charAt$9=uncurryThis$z("".charAt),charCodeAt$4=uncurryThis$z("".charCodeAt),stringSlice$9=uncurryThis$z("".slice),createMethod=function(G){return function(W,X){var V=toString$n(requireObjectCoercible$d(W)),Z=toIntegerOrInfinity$5(X),re=V.length,se,ue;return Z<0||Z>=re?G?"":void 0:(se=charCodeAt$4(V,Z),se<55296||se>56319||Z+1===re||(ue=charCodeAt$4(V,Z+1))<56320||ue>57343?G?charAt$9(V,Z):se:G?stringSlice$9(V,Z,Z+2):(se-55296<<10)+(ue-56320)+65536)}},stringMultibyte={codeAt:createMethod(!1),charAt:createMethod(!0)},$$N=_export,codeAt$1=stringMultibyte.codeAt;$$N({target:"String",proto:!0},{codePointAt:function(W){return codeAt$1(this,W)}});var isRegExp$3=isRegexp,$TypeError$5=TypeError,notARegexp=function(G){if(isRegExp$3(G))throw new $TypeError$5("The method doesn't accept regular expressions");return G},wellKnownSymbol$8=wellKnownSymbol$z,MATCH=wellKnownSymbol$8("match"),correctIsRegexpLogic=function(G){var W=/./;try{"/./"[G](W)}catch{try{return W[MATCH]=!1,"/./"[G](W)}catch{}}return!1},$$M=_export,uncurryThis$y=functionUncurryThisClause,getOwnPropertyDescriptor$1=objectGetOwnPropertyDescriptor.f,toLength$7=toLength$d,toString$m=toString$E,notARegExp$2=notARegexp,requireObjectCoercible$c=requireObjectCoercible$n,correctIsRegExpLogic$2=correctIsRegexpLogic,slice$1=uncurryThis$y("".slice),min$4=Math.min,CORRECT_IS_REGEXP_LOGIC$1=correctIsRegExpLogic$2("endsWith"),MDN_POLYFILL_BUG$1=!CORRECT_IS_REGEXP_LOGIC$1&&!!function(){var G=getOwnPropertyDescriptor$1(String.prototype,"endsWith");return G&&!G.writable}();$$M({target:"String",proto:!0,forced:!MDN_POLYFILL_BUG$1&&!CORRECT_IS_REGEXP_LOGIC$1},{endsWith:function(W){var X=toString$m(requireObjectCoercible$c(this));notARegExp$2(W);var V=arguments.length>1?arguments[1]:void 0,Z=X.length,re=V===void 0?Z:min$4(toLength$7(V),Z),se=toString$m(W);return slice$1(X,re-se.length,re)===se}});var $$L=_export,uncurryThis$x=functionUncurryThis,toAbsoluteIndex$1=toAbsoluteIndex$9,$RangeError$3=RangeError,fromCharCode$3=String.fromCharCode,$fromCodePoint=String.fromCodePoint,join$6=uncurryThis$x([].join),INCORRECT_LENGTH=!!$fromCodePoint&&$fromCodePoint.length!==1;$$L({target:"String",stat:!0,arity:1,forced:INCORRECT_LENGTH},{fromCodePoint:function(W){for(var X=[],V=arguments.length,Z=0,re;V>Z;){if(re=+arguments[Z++],toAbsoluteIndex$1(re,1114111)!==re)throw new $RangeError$3(re+" is not a valid code point");X[Z]=re<65536?fromCharCode$3(re):fromCharCode$3(((re-=65536)>>10)+55296,re%1024+56320)}return join$6(X,"")}});var $$K=_export,uncurryThis$w=functionUncurryThis,notARegExp$1=notARegexp,requireObjectCoercible$b=requireObjectCoercible$n,toString$l=toString$E,correctIsRegExpLogic$1=correctIsRegexpLogic,stringIndexOf$2=uncurryThis$w("".indexOf);$$K({target:"String",proto:!0,forced:!correctIsRegExpLogic$1("includes")},{includes:function(W){return!!~stringIndexOf$2(toString$l(requireObjectCoercible$b(this)),toString$l(notARegExp$1(W)),arguments.length>1?arguments[1]:void 0)}});var $$J=_export,uncurryThis$v=functionUncurryThis,requireObjectCoercible$a=requireObjectCoercible$n,toString$k=toString$E,charCodeAt$3=uncurryThis$v("".charCodeAt);$$J({target:"String",proto:!0},{isWellFormed:function(){for(var W=toString$k(requireObjectCoercible$a(this)),X=W.length,V=0;V<X;V++){var Z=charCodeAt$3(W,V);if((Z&63488)===55296&&(Z>=56320||++V>=X||(charCodeAt$3(W,V)&64512)!==56320))return!1}return!0}});var charAt$8=stringMultibyte.charAt,toString$j=toString$E,InternalStateModule$6=internalState,defineIterator=iteratorDefine,createIterResultObject$2=createIterResultObject$5,STRING_ITERATOR="String Iterator",setInternalState$6=InternalStateModule$6.set,getInternalState$3=InternalStateModule$6.getterFor(STRING_ITERATOR);defineIterator(String,"String",function(G){setInternalState$6(this,{type:STRING_ITERATOR,string:toString$j(G),index:0})},function(){var W=getInternalState$3(this),X=W.string,V=W.index,Z;return V>=X.length?createIterResultObject$2(void 0,!0):(Z=charAt$8(X,V),W.index+=Z.length,createIterResultObject$2(Z,!1))});var call$h=functionCall,defineBuiltIn$6=defineBuiltIn$o,regexpExec$1=regexpExec$2,fails$l=fails$1p,wellKnownSymbol$7=wellKnownSymbol$z,createNonEnumerableProperty$4=createNonEnumerableProperty$f,SPECIES=wellKnownSymbol$7("species"),RegExpPrototype$1=RegExp.prototype,fixRegexpWellKnownSymbolLogic=function(G,W,X,V){var Z=wellKnownSymbol$7(G),re=!fails$l(function(){var ye={};return ye[Z]=function(){return 7},""[G](ye)!==7}),se=re&&!fails$l(function(){var ye=!1,Ie=/a/;return G==="split"&&(Ie={},Ie.constructor={},Ie.constructor[SPECIES]=function(){return Ie},Ie.flags="",Ie[Z]=/./[Z]),Ie.exec=function(){return ye=!0,null},Ie[Z](""),!ye});if(!re||!se||X){var ue=/./[Z],H=W(Z,""[G],function(ye,Ie,Ee,Fe,je){var mt=Ie.exec;return mt===regexpExec$1||mt===RegExpPrototype$1.exec?re&&!je?{done:!0,value:call$h(ue,Ie,Ee,Fe)}:{done:!0,value:call$h(ye,Ee,Ie,Fe)}:{done:!1}});defineBuiltIn$6(String.prototype,G,H[0]),defineBuiltIn$6(RegExpPrototype$1,Z,H[1])}V&&createNonEnumerableProperty$4(RegExpPrototype$1[Z],"sham",!0)},charAt$7=stringMultibyte.charAt,advanceStringIndex$4=function(G,W,X){return W+(X?charAt$7(G,W).length:1)},call$g=functionCall,anObject$9=anObject$D,isCallable$5=isCallable$y,classof$6=classofRaw$2,regexpExec=regexpExec$2,$TypeError$4=TypeError,regexpExecAbstract=function(G,W){var X=G.exec;if(isCallable$5(X)){var V=call$g(X,G,W);return V!==null&&anObject$9(V),V}if(classof$6(G)==="RegExp")return call$g(regexpExec,G,W);throw new $TypeError$4("RegExp#exec called on incompatible receiver")},call$f=functionCall,fixRegExpWellKnownSymbolLogic$3=fixRegexpWellKnownSymbolLogic,anObject$8=anObject$D,isNullOrUndefined$8=isNullOrUndefined$f,toLength$6=toLength$d,toString$i=toString$E,requireObjectCoercible$9=requireObjectCoercible$n,getMethod$5=getMethod$9,advanceStringIndex$3=advanceStringIndex$4,regExpExec$4=regexpExecAbstract;fixRegExpWellKnownSymbolLogic$3("match",function(G,W,X){return[function(Z){var re=requireObjectCoercible$9(this),se=isNullOrUndefined$8(Z)?void 0:getMethod$5(Z,G);return se?call$f(se,Z,re):new RegExp(Z)[G](toString$i(re))},function(V){var Z=anObject$8(this),re=toString$i(V),se=X(W,Z,re);if(se.done)return se.value;if(!Z.global)return regExpExec$4(Z,re);var ue=Z.unicode;Z.lastIndex=0;for(var H=[],ye=0,Ie;(Ie=regExpExec$4(Z,re))!==null;){var Ee=toString$i(Ie[0]);H[ye]=Ee,Ee===""&&(Z.lastIndex=advanceStringIndex$3(re,toLength$6(Z.lastIndex),ue)),ye++}return ye===0?null:H}]});var $$I=_export,call$e=functionCall,uncurryThis$u=functionUncurryThisClause,createIteratorConstructor$1=iteratorCreateConstructor,createIterResultObject$1=createIterResultObject$5,requireObjectCoercible$8=requireObjectCoercible$n,toLength$5=toLength$d,toString$h=toString$E,anObject$7=anObject$D,isNullOrUndefined$7=isNullOrUndefined$f,classof$5=classofRaw$2,isRegExp$2=isRegexp,getRegExpFlags$2=regexpGetFlags,getMethod$4=getMethod$9,defineBuiltIn$5=defineBuiltIn$o,fails$k=fails$1p,wellKnownSymbol$6=wellKnownSymbol$z,speciesConstructor$2=speciesConstructor$6,advanceStringIndex$2=advanceStringIndex$4,regExpExec$3=regexpExecAbstract,InternalStateModule$5=internalState,IS_PURE$1=isPure,MATCH_ALL=wellKnownSymbol$6("matchAll"),REGEXP_STRING="RegExp String",REGEXP_STRING_ITERATOR=REGEXP_STRING+" Iterator",setInternalState$5=InternalStateModule$5.set,getInternalState$2=InternalStateModule$5.getterFor(REGEXP_STRING_ITERATOR),RegExpPrototype=RegExp.prototype,$TypeError$3=TypeError,stringIndexOf$1=uncurryThis$u("".indexOf),nativeMatchAll=uncurryThis$u("".matchAll),WORKS_WITH_NON_GLOBAL_REGEX=!!nativeMatchAll&&!fails$k(function(){nativeMatchAll("a",/./)}),$RegExpStringIterator=createIteratorConstructor$1(function(W,X,V,Z){setInternalState$5(this,{type:REGEXP_STRING_ITERATOR,regexp:W,string:X,global:V,unicode:Z,done:!1})},REGEXP_STRING,function(){var W=getInternalState$2(this);if(W.done)return createIterResultObject$1(void 0,!0);var X=W.regexp,V=W.string,Z=regExpExec$3(X,V);return Z===null?(W.done=!0,createIterResultObject$1(void 0,!0)):W.global?(toString$h(Z[0])===""&&(X.lastIndex=advanceStringIndex$2(V,toLength$5(X.lastIndex),W.unicode)),createIterResultObject$1(Z,!1)):(W.done=!0,createIterResultObject$1(Z,!1))}),$matchAll=function(G){var W=anObject$7(this),X=toString$h(G),V=speciesConstructor$2(W,RegExp),Z=toString$h(getRegExpFlags$2(W)),re,se,ue;return re=new V(V===RegExp?W.source:W,Z),se=!!~stringIndexOf$1(Z,"g"),ue=!!~stringIndexOf$1(Z,"u"),re.lastIndex=toLength$5(W.lastIndex),new $RegExpStringIterator(re,X,se,ue)};$$I({target:"String",proto:!0,forced:WORKS_WITH_NON_GLOBAL_REGEX},{matchAll:function(W){var X=requireObjectCoercible$8(this),V,Z,re,se;if(isNullOrUndefined$7(W)){if(WORKS_WITH_NON_GLOBAL_REGEX)return nativeMatchAll(X,W)}else{if(isRegExp$2(W)&&(V=toString$h(requireObjectCoercible$8(getRegExpFlags$2(W))),!~stringIndexOf$1(V,"g")))throw new $TypeError$3("`.matchAll` does not allow non-global regexes");if(WORKS_WITH_NON_GLOBAL_REGEX)return nativeMatchAll(X,W);if(re=getMethod$4(W,MATCH_ALL),re===void 0&&IS_PURE$1&&classof$5(W)==="RegExp"&&(re=$matchAll),re)return call$e(re,W,X)}return Z=toString$h(X),se=new RegExp(W,"g"),se[MATCH_ALL](Z)}});MATCH_ALL in RegExpPrototype||defineBuiltIn$5(RegExpPrototype,MATCH_ALL,$matchAll);var userAgent=engineUserAgent,stringPadWebkitBug=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(userAgent),$$H=_export,$padEnd=stringPad.end,WEBKIT_BUG$1=stringPadWebkitBug;$$H({target:"String",proto:!0,forced:WEBKIT_BUG$1},{padEnd:function(W){return $padEnd(this,W,arguments.length>1?arguments[1]:void 0)}});var $$G=_export,$padStart=stringPad.start,WEBKIT_BUG=stringPadWebkitBug;$$G({target:"String",proto:!0,forced:WEBKIT_BUG},{padStart:function(W){return $padStart(this,W,arguments.length>1?arguments[1]:void 0)}});var $$F=_export,uncurryThis$t=functionUncurryThis,toIndexedObject$1=toIndexedObject$j,toObject$2=toObject$t,toString$g=toString$E,lengthOfArrayLike$4=lengthOfArrayLike$s,push$7=uncurryThis$t([].push),join$5=uncurryThis$t([].join);$$F({target:"String",stat:!0},{raw:function(W){var X=toIndexedObject$1(toObject$2(W).raw),V=lengthOfArrayLike$4(X);if(!V)return"";for(var Z=arguments.length,re=[],se=0;;){if(push$7(re,toString$g(X[se++])),se===V)return join$5(re,"");se<Z&&push$7(re,toString$g(arguments[se]))}}});var $$E=_export,repeat=stringRepeat;$$E({target:"String",proto:!0},{repeat});var uncurryThis$s=functionUncurryThis,toObject$1=toObject$t,floor$3=Math.floor,charAt$6=uncurryThis$s("".charAt),replace$5=uncurryThis$s("".replace),stringSlice$8=uncurryThis$s("".slice),SUBSTITUTION_SYMBOLS=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,SUBSTITUTION_SYMBOLS_NO_NAMED=/\$([$&'`]|\d{1,2})/g,getSubstitution$2=function(G,W,X,V,Z,re){var se=X+G.length,ue=V.length,H=SUBSTITUTION_SYMBOLS_NO_NAMED;return Z!==void 0&&(Z=toObject$1(Z),H=SUBSTITUTION_SYMBOLS),replace$5(re,H,function(ye,Ie){var Ee;switch(charAt$6(Ie,0)){case"$":return"$";case"&":return G;case"`":return stringSlice$8(W,0,X);case"'":return stringSlice$8(W,se);case"<":Ee=Z[stringSlice$8(Ie,1,-1)];break;default:var Fe=+Ie;if(Fe===0)return ye;if(Fe>ue){var je=floor$3(Fe/10);return je===0?ye:je<=ue?V[je-1]===void 0?charAt$6(Ie,1):V[je-1]+charAt$6(Ie,1):ye}Ee=V[Fe-1]}return Ee===void 0?"":Ee})},apply$5=functionApply$1,call$d=functionCall,uncurryThis$r=functionUncurryThis,fixRegExpWellKnownSymbolLogic$2=fixRegexpWellKnownSymbolLogic,fails$j=fails$1p,anObject$6=anObject$D,isCallable$4=isCallable$y,isNullOrUndefined$6=isNullOrUndefined$f,toIntegerOrInfinity$4=toIntegerOrInfinity$l,toLength$4=toLength$d,toString$f=toString$E,requireObjectCoercible$7=requireObjectCoercible$n,advanceStringIndex$1=advanceStringIndex$4,getMethod$3=getMethod$9,getSubstitution$1=getSubstitution$2,regExpExec$2=regexpExecAbstract,wellKnownSymbol$5=wellKnownSymbol$z,REPLACE$1=wellKnownSymbol$5("replace"),max$2=Math.max,min$3=Math.min,concat=uncurryThis$r([].concat),push$6=uncurryThis$r([].push),stringIndexOf=uncurryThis$r("".indexOf),stringSlice$7=uncurryThis$r("".slice),maybeToString=function(G){return G===void 0?G:String(G)},REPLACE_KEEPS_$0=function(){return"a".replace(/./,"$0")==="$0"}(),REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE=function(){return/./[REPLACE$1]?/./[REPLACE$1]("a","$0")==="":!1}(),REPLACE_SUPPORTS_NAMED_GROUPS=!fails$j(function(){var G=/./;return G.exec=function(){var W=[];return W.groups={a:"7"},W},"".replace(G,"$<a>")!=="7"});fixRegExpWellKnownSymbolLogic$2("replace",function(G,W,X){var V=REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE?"$":"$0";return[function(re,se){var ue=requireObjectCoercible$7(this),H=isNullOrUndefined$6(re)?void 0:getMethod$3(re,REPLACE$1);return H?call$d(H,re,ue,se):call$d(W,toString$f(ue),re,se)},function(Z,re){var se=anObject$6(this),ue=toString$f(Z);if(typeof re=="string"&&stringIndexOf(re,V)===-1&&stringIndexOf(re,"$<")===-1){var H=X(W,se,ue,re);if(H.done)return H.value}var ye=isCallable$4(re);ye||(re=toString$f(re));var Ie=se.global,Ee;Ie&&(Ee=se.unicode,se.lastIndex=0);for(var Fe=[],je;je=regExpExec$2(se,ue),!(je===null||(push$6(Fe,je),!Ie));){var mt=toString$f(je[0]);mt===""&&(se.lastIndex=advanceStringIndex$1(ue,toLength$4(se.lastIndex),Ee))}for(var wt="",Ot=0,$t=0;$t<Fe.length;$t++){je=Fe[$t];for(var jt=toString$f(je[0]),nr=max$2(min$3(toIntegerOrInfinity$4(je.index),ue.length),0),sr=[],gr,hr=1;hr<je.length;hr++)push$6(sr,maybeToString(je[hr]));var Ir=je.groups;if(ye){var br=concat([jt],sr,nr,ue);Ir!==void 0&&push$6(br,Ir),gr=toString$f(apply$5(re,void 0,br))}else gr=getSubstitution$1(jt,ue,nr,sr,Ir,re);nr>=Ot&&(wt+=stringSlice$7(ue,Ot,nr)+gr,Ot=nr+jt.length)}return wt+stringSlice$7(ue,Ot)}]},!REPLACE_SUPPORTS_NAMED_GROUPS||!REPLACE_KEEPS_$0||REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE);var $$D=_export,call$c=functionCall,uncurryThis$q=functionUncurryThis,requireObjectCoercible$6=requireObjectCoercible$n,isCallable$3=isCallable$y,isNullOrUndefined$5=isNullOrUndefined$f,isRegExp$1=isRegexp,toString$e=toString$E,getMethod$2=getMethod$9,getRegExpFlags$1=regexpGetFlags,getSubstitution=getSubstitution$2,wellKnownSymbol$4=wellKnownSymbol$z,REPLACE=wellKnownSymbol$4("replace"),$TypeError$2=TypeError,indexOf$1=uncurryThis$q("".indexOf);uncurryThis$q("".replace);var stringSlice$6=uncurryThis$q("".slice),max$1=Math.max;$$D({target:"String",proto:!0},{replaceAll:function(W,X){var V=requireObjectCoercible$6(this),Z,re,se,ue,H,ye,Ie,Ee,Fe,je=0,mt=0,wt="";if(!isNullOrUndefined$5(W)){if(Z=isRegExp$1(W),Z&&(re=toString$e(requireObjectCoercible$6(getRegExpFlags$1(W))),!~indexOf$1(re,"g")))throw new $TypeError$2("`.replaceAll` does not allow non-global regexes");if(se=getMethod$2(W,REPLACE),se)return call$c(se,W,V,X)}for(ue=toString$e(V),H=toString$e(W),ye=isCallable$3(X),ye||(X=toString$e(X)),Ie=H.length,Ee=max$1(1,Ie),je=indexOf$1(ue,H);je!==-1;)Fe=ye?toString$e(X(H,je,ue)):getSubstitution(H,ue,je,[],void 0,X),wt+=stringSlice$6(ue,mt,je)+Fe,mt=je+Ie,je=je+Ee>ue.length?-1:indexOf$1(ue,H,je+Ee);return mt<ue.length&&(wt+=stringSlice$6(ue,mt)),wt}});var call$b=functionCall,fixRegExpWellKnownSymbolLogic$1=fixRegexpWellKnownSymbolLogic,anObject$5=anObject$D,isNullOrUndefined$4=isNullOrUndefined$f,requireObjectCoercible$5=requireObjectCoercible$n,sameValue=sameValue$1,toString$d=toString$E,getMethod$1=getMethod$9,regExpExec$1=regexpExecAbstract;fixRegExpWellKnownSymbolLogic$1("search",function(G,W,X){return[function(Z){var re=requireObjectCoercible$5(this),se=isNullOrUndefined$4(Z)?void 0:getMethod$1(Z,G);return se?call$b(se,Z,re):new RegExp(Z)[G](toString$d(re))},function(V){var Z=anObject$5(this),re=toString$d(V),se=X(W,Z,re);if(se.done)return se.value;var ue=Z.lastIndex;sameValue(ue,0)||(Z.lastIndex=0);var H=regExpExec$1(Z,re);return sameValue(Z.lastIndex,ue)||(Z.lastIndex=ue),H===null?-1:H.index}]});var call$a=functionCall,uncurryThis$p=functionUncurryThis,fixRegExpWellKnownSymbolLogic=fixRegexpWellKnownSymbolLogic,anObject$4=anObject$D,isNullOrUndefined$3=isNullOrUndefined$f,requireObjectCoercible$4=requireObjectCoercible$n,speciesConstructor$1=speciesConstructor$6,advanceStringIndex=advanceStringIndex$4,toLength$3=toLength$d,toString$c=toString$E,getMethod=getMethod$9,regExpExec=regexpExecAbstract,stickyHelpers=regexpStickyHelpers,fails$i=fails$1p,UNSUPPORTED_Y=stickyHelpers.UNSUPPORTED_Y,MAX_UINT32=4294967295,min$2=Math.min,push$5=uncurryThis$p([].push),stringSlice$5=uncurryThis$p("".slice),SPLIT_WORKS_WITH_OVERWRITTEN_EXEC=!fails$i(function(){var G=/(?:)/,W=G.exec;G.exec=function(){return W.apply(this,arguments)};var X="ab".split(G);return X.length!==2||X[0]!=="a"||X[1]!=="b"}),BUGGY="abbc".split(/(b)*/)[1]==="c"||"test".split(/(?:)/,-1).length!==4||"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||".".split(/()()/).length>1||"".split(/.?/).length;fixRegExpWellKnownSymbolLogic("split",function(G,W,X){var V="0".split(void 0,0).length?function(Z,re){return Z===void 0&&re===0?[]:call$a(W,this,Z,re)}:W;return[function(re,se){var ue=requireObjectCoercible$4(this),H=isNullOrUndefined$3(re)?void 0:getMethod(re,G);return H?call$a(H,re,ue,se):call$a(V,toString$c(ue),re,se)},function(Z,re){var se=anObject$4(this),ue=toString$c(Z);if(!BUGGY){var H=X(V,se,ue,re,V!==W);if(H.done)return H.value}var ye=speciesConstructor$1(se,RegExp),Ie=se.unicode,Ee=(se.ignoreCase?"i":"")+(se.multiline?"m":"")+(se.unicode?"u":"")+(UNSUPPORTED_Y?"g":"y"),Fe=new ye(UNSUPPORTED_Y?"^(?:"+se.source+")":se,Ee),je=re===void 0?MAX_UINT32:re>>>0;if(je===0)return[];if(ue.length===0)return regExpExec(Fe,ue)===null?[ue]:[];for(var mt=0,wt=0,Ot=[];wt<ue.length;){Fe.lastIndex=UNSUPPORTED_Y?0:wt;var $t=regExpExec(Fe,UNSUPPORTED_Y?stringSlice$5(ue,wt):ue),jt;if($t===null||(jt=min$2(toLength$3(Fe.lastIndex+(UNSUPPORTED_Y?wt:0)),ue.length))===mt)wt=advanceStringIndex(ue,wt,Ie);else{if(push$5(Ot,stringSlice$5(ue,mt,wt)),Ot.length===je)return Ot;for(var nr=1;nr<=$t.length-1;nr++)if(push$5(Ot,$t[nr]),Ot.length===je)return Ot;wt=mt=jt}}return push$5(Ot,stringSlice$5(ue,mt)),Ot}]},BUGGY||!SPLIT_WORKS_WITH_OVERWRITTEN_EXEC,UNSUPPORTED_Y);var $$C=_export,uncurryThis$o=functionUncurryThisClause,getOwnPropertyDescriptor=objectGetOwnPropertyDescriptor.f,toLength$2=toLength$d,toString$b=toString$E,notARegExp=notARegexp,requireObjectCoercible$3=requireObjectCoercible$n,correctIsRegExpLogic=correctIsRegexpLogic,stringSlice$4=uncurryThis$o("".slice),min$1=Math.min,CORRECT_IS_REGEXP_LOGIC=correctIsRegExpLogic("startsWith"),MDN_POLYFILL_BUG=!CORRECT_IS_REGEXP_LOGIC&&!!function(){var G=getOwnPropertyDescriptor(String.prototype,"startsWith");return G&&!G.writable}();$$C({target:"String",proto:!0,forced:!MDN_POLYFILL_BUG&&!CORRECT_IS_REGEXP_LOGIC},{startsWith:function(W){var X=toString$b(requireObjectCoercible$3(this));notARegExp(W);var V=toLength$2(min$1(arguments.length>1?arguments[1]:void 0,X.length)),Z=toString$b(W);return stringSlice$4(X,V,V+Z.length)===Z}});var $$B=_export,uncurryThis$n=functionUncurryThis,requireObjectCoercible$2=requireObjectCoercible$n,toIntegerOrInfinity$3=toIntegerOrInfinity$l,toString$a=toString$E,stringSlice$3=uncurryThis$n("".slice),max=Math.max,min=Math.min,FORCED$3=!"".substr||"ab".substr(-1)!=="b";$$B({target:"String",proto:!0,forced:FORCED$3},{substr:function(W,X){var V=toString$a(requireObjectCoercible$2(this)),Z=V.length,re=toIntegerOrInfinity$3(W),se,ue;return re===1/0&&(re=0),re<0&&(re=max(Z+re,0)),se=X===void 0?Z:toIntegerOrInfinity$3(X),se<=0||se===1/0?"":(ue=min(re+se,Z),re>=ue?"":stringSlice$3(V,re,ue))}});var $$A=_export,call$9=functionCall,uncurryThis$m=functionUncurryThis,requireObjectCoercible$1=requireObjectCoercible$n,toString$9=toString$E,fails$h=fails$1p,$Array=Array,charAt$5=uncurryThis$m("".charAt),charCodeAt$2=uncurryThis$m("".charCodeAt),join$4=uncurryThis$m([].join),$toWellFormed="".toWellFormed,REPLACEMENT_CHARACTER="ï¿½",TO_STRING_CONVERSION_BUG=$toWellFormed&&fails$h(function(){return call$9($toWellFormed,1)!=="1"});$$A({target:"String",proto:!0,forced:TO_STRING_CONVERSION_BUG},{toWellFormed:function(){var W=toString$9(requireObjectCoercible$1(this));if(TO_STRING_CONVERSION_BUG)return call$9($toWellFormed,W);for(var X=W.length,V=$Array(X),Z=0;Z<X;Z++){var re=charCodeAt$2(W,Z);(re&63488)!==55296?V[Z]=charAt$5(W,Z):re>=56320||Z+1>=X||(charCodeAt$2(W,Z+1)&64512)!==56320?V[Z]=REPLACEMENT_CHARACTER:(V[Z]=charAt$5(W,Z),V[++Z]=charAt$5(W,Z))}return join$4(V,"")}});var PROPER_FUNCTION_NAME=functionName.PROPER,fails$g=fails$1p,whitespaces$1=whitespaces$5,non="âÂá ",stringTrimForced=function(G){return fails$g(function(){return!!whitespaces$1[G]()||non[G]()!==non||PROPER_FUNCTION_NAME&&whitespaces$1[G].name!==G})},$$z=_export,$trim=stringTrim.trim,forcedStringTrimMethod$2=stringTrimForced;$$z({target:"String",proto:!0,forced:forcedStringTrimMethod$2("trim")},{trim:function(){return $trim(this)}});var $trimEnd=stringTrim.end,forcedStringTrimMethod$1=stringTrimForced,stringTrimEnd=forcedStringTrimMethod$1("trimEnd")?function(){return $trimEnd(this)}:"".trimEnd,$$y=_export,trimEnd$1=stringTrimEnd;$$y({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==trimEnd$1},{trimRight:trimEnd$1});var $$x=_export,trimEnd=stringTrimEnd;$$x({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==trimEnd},{trimEnd});var $trimStart=stringTrim.start,forcedStringTrimMethod=stringTrimForced,stringTrimStart=forcedStringTrimMethod("trimStart")?function(){return $trimStart(this)}:"".trimStart,$$w=_export,trimStart$1=stringTrimStart;$$w({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==trimStart$1},{trimLeft:trimStart$1});var $$v=_export,trimStart=stringTrimStart;$$v({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==trimStart},{trimStart});var uncurryThis$l=functionUncurryThis,requireObjectCoercible=requireObjectCoercible$n,toString$8=toString$E,quot=/"/g,replace$4=uncurryThis$l("".replace),createHtml=function(G,W,X,V){var Z=toString$8(requireObjectCoercible(G)),re="<"+W;return X!==""&&(re+=" "+X+'="'+replace$4(toString$8(V),quot,"&quot;")+'"'),re+">"+Z+"</"+W+">"},fails$f=fails$1p,stringHtmlForced=function(G){return fails$f(function(){var W=""[G]('"');return W!==W.toLowerCase()||W.split('"').length>3})},$$u=_export,createHTML$c=createHtml,forcedStringHTMLMethod$c=stringHtmlForced;$$u({target:"String",proto:!0,forced:forcedStringHTMLMethod$c("anchor")},{anchor:function(W){return createHTML$c(this,"a","name",W)}});var $$t=_export,createHTML$b=createHtml,forcedStringHTMLMethod$b=stringHtmlForced;$$t({target:"String",proto:!0,forced:forcedStringHTMLMethod$b("big")},{big:function(){return createHTML$b(this,"big","","")}});var $$s=_export,createHTML$a=createHtml,forcedStringHTMLMethod$a=stringHtmlForced;$$s({target:"String",proto:!0,forced:forcedStringHTMLMethod$a("blink")},{blink:function(){return createHTML$a(this,"blink","","")}});var $$r=_export,createHTML$9=createHtml,forcedStringHTMLMethod$9=stringHtmlForced;$$r({target:"String",proto:!0,forced:forcedStringHTMLMethod$9("bold")},{bold:function(){return createHTML$9(this,"b","","")}});var $$q=_export,createHTML$8=createHtml,forcedStringHTMLMethod$8=stringHtmlForced;$$q({target:"String",proto:!0,forced:forcedStringHTMLMethod$8("fixed")},{fixed:function(){return createHTML$8(this,"tt","","")}});var $$p=_export,createHTML$7=createHtml,forcedStringHTMLMethod$7=stringHtmlForced;$$p({target:"String",proto:!0,forced:forcedStringHTMLMethod$7("fontcolor")},{fontcolor:function(W){return createHTML$7(this,"font","color",W)}});var $$o=_export,createHTML$6=createHtml,forcedStringHTMLMethod$6=stringHtmlForced;$$o({target:"String",proto:!0,forced:forcedStringHTMLMethod$6("fontsize")},{fontsize:function(W){return createHTML$6(this,"font","size",W)}});var $$n=_export,createHTML$5=createHtml,forcedStringHTMLMethod$5=stringHtmlForced;$$n({target:"String",proto:!0,forced:forcedStringHTMLMethod$5("italics")},{italics:function(){return createHTML$5(this,"i","","")}});var $$m=_export,createHTML$4=createHtml,forcedStringHTMLMethod$4=stringHtmlForced;$$m({target:"String",proto:!0,forced:forcedStringHTMLMethod$4("link")},{link:function(W){return createHTML$4(this,"a","href",W)}});var $$l=_export,createHTML$3=createHtml,forcedStringHTMLMethod$3=stringHtmlForced;$$l({target:"String",proto:!0,forced:forcedStringHTMLMethod$3("small")},{small:function(){return createHTML$3(this,"small","","")}});var $$k=_export,createHTML$2=createHtml,forcedStringHTMLMethod$2=stringHtmlForced;$$k({target:"String",proto:!0,forced:forcedStringHTMLMethod$2("strike")},{strike:function(){return createHTML$2(this,"strike","","")}});var $$j=_export,createHTML$1=createHtml,forcedStringHTMLMethod$1=stringHtmlForced;$$j({target:"String",proto:!0,forced:forcedStringHTMLMethod$1("sub")},{sub:function(){return createHTML$1(this,"sub","","")}});var $$i=_export,createHTML=createHtml,forcedStringHTMLMethod=stringHtmlForced;$$i({target:"String",proto:!0,forced:forcedStringHTMLMethod("sup")},{sup:function(){return createHTML(this,"sup","","")}});var typedArrayConstructor={exports:{}},global$m=global$10,fails$e=fails$1p,checkCorrectnessOfIteration=checkCorrectnessOfIteration$4,NATIVE_ARRAY_BUFFER_VIEWS$1=arrayBufferViewCore.NATIVE_ARRAY_BUFFER_VIEWS,ArrayBuffer$2=global$m.ArrayBuffer,Int8Array$3=global$m.Int8Array,typedArrayConstructorsRequireWrappers=!NATIVE_ARRAY_BUFFER_VIEWS$1||!fails$e(function(){Int8Array$3(1)})||!fails$e(function(){new Int8Array$3(-1)})||!checkCorrectnessOfIteration(function(G){new Int8Array$3,new Int8Array$3(null),new Int8Array$3(1.5),new Int8Array$3(G)},!0)||fails$e(function(){return new Int8Array$3(new ArrayBuffer$2(2),1,void 0).length!==1}),toIntegerOrInfinity$2=toIntegerOrInfinity$l,$RangeError$2=RangeError,toPositiveInteger$1=function(G){var W=toIntegerOrInfinity$2(G);if(W<0)throw new $RangeError$2("The argument can't be less than 0");return W},toPositiveInteger=toPositiveInteger$1,$RangeError$1=RangeError,toOffset$2=function(G,W){var X=toPositiveInteger(G);if(X%W)throw new $RangeError$1("Wrong offset");return X},round=Math.round,toUint8Clamped$1=function(G){var W=round(G);return W<0?0:W>255?255:W&255},classof$4=classof$n,isBigIntArray$2=function(G){var W=classof$4(G);return W==="BigInt64Array"||W==="BigUint64Array"},toPrimitive=toPrimitive$4,$TypeError$1=TypeError,toBigInt$3=function(G){var W=toPrimitive(G,"number");if(typeof W=="number")throw new $TypeError$1("Can't convert number to bigint");return BigInt(W)},bind$2=functionBindContext,call$8=functionCall,aConstructor=aConstructor$3,toObject=toObject$t,lengthOfArrayLike$3=lengthOfArrayLike$s,getIterator$1=getIterator$4,getIteratorMethod$1=getIteratorMethod$5,isArrayIteratorMethod=isArrayIteratorMethod$3,isBigIntArray$1=isBigIntArray$2,aTypedArrayConstructor$2=arrayBufferViewCore.aTypedArrayConstructor,toBigInt$2=toBigInt$3,typedArrayFrom$2=function(W){var X=aConstructor(this),V=toObject(W),Z=arguments.length,re=Z>1?arguments[1]:void 0,se=re!==void 0,ue=getIteratorMethod$1(V),H,ye,Ie,Ee,Fe,je,mt,wt;if(ue&&!isArrayIteratorMethod(ue))for(mt=getIterator$1(V,ue),wt=mt.next,V=[];!(je=call$8(wt,mt)).done;)V.push(je.value);for(se&&Z>2&&(re=bind$2(re,arguments[2])),ye=lengthOfArrayLike$3(V),Ie=new(aTypedArrayConstructor$2(X))(ye),Ee=isBigIntArray$1(Ie),H=0;ye>H;H++)Fe=se?re(V[H],H):V[H],Ie[H]=Ee?toBigInt$2(Fe):+Fe;return Ie},$$h=_export,global$l=global$10,call$7=functionCall,DESCRIPTORS$7=descriptors,TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS$2=typedArrayConstructorsRequireWrappers,ArrayBufferViewCore$u=arrayBufferViewCore,ArrayBufferModule=arrayBuffer,anInstance$5=anInstance$a,createPropertyDescriptor$3=createPropertyDescriptor$c,createNonEnumerableProperty$3=createNonEnumerableProperty$f,isIntegralNumber=isIntegralNumber$3,toLength$1=toLength$d,toIndex=toIndex$3,toOffset$1=toOffset$2,toUint8Clamped=toUint8Clamped$1,toPropertyKey=toPropertyKey$8,hasOwn$7=hasOwnProperty_1,classof$3=classof$n,isObject$a=isObject$G,isSymbol$7=isSymbol$d,create$4=objectCreate,isPrototypeOf=objectIsPrototypeOf,setPrototypeOf=objectSetPrototypeOf$1,getOwnPropertyNames=objectGetOwnPropertyNames.f,typedArrayFrom$1=typedArrayFrom$2,forEach$4=arrayIteration.forEach,setSpecies=setSpecies$6,defineBuiltInAccessor$5=defineBuiltInAccessor$i,definePropertyModule=objectDefineProperty,getOwnPropertyDescriptorModule=objectGetOwnPropertyDescriptor,arrayFromConstructorAndList$2=arrayFromConstructorAndList$4,InternalStateModule$4=internalState,inheritIfRequired$1=inheritIfRequired$7,getInternalState$1=InternalStateModule$4.get,setInternalState$4=InternalStateModule$4.set,enforceInternalState$1=InternalStateModule$4.enforce,nativeDefineProperty=definePropertyModule.f,nativeGetOwnPropertyDescriptor=getOwnPropertyDescriptorModule.f,RangeError$2=global$l.RangeError,ArrayBuffer$1=ArrayBufferModule.ArrayBuffer,ArrayBufferPrototype=ArrayBuffer$1.prototype,DataView$1=ArrayBufferModule.DataView,NATIVE_ARRAY_BUFFER_VIEWS=ArrayBufferViewCore$u.NATIVE_ARRAY_BUFFER_VIEWS,TYPED_ARRAY_TAG=ArrayBufferViewCore$u.TYPED_ARRAY_TAG,TypedArray=ArrayBufferViewCore$u.TypedArray,TypedArrayPrototype$1=ArrayBufferViewCore$u.TypedArrayPrototype,isTypedArray=ArrayBufferViewCore$u.isTypedArray,BYTES_PER_ELEMENT="BYTES_PER_ELEMENT",WRONG_LENGTH="Wrong length",addGetter=function(G,W){defineBuiltInAccessor$5(G,W,{configurable:!0,get:function(){return getInternalState$1(this)[W]}})},isArrayBuffer=function(G){var W;return isPrototypeOf(ArrayBufferPrototype,G)||(W=classof$3(G))==="ArrayBuffer"||W==="SharedArrayBuffer"},isTypedArrayIndex=function(G,W){return isTypedArray(G)&&!isSymbol$7(W)&&W in G&&isIntegralNumber(+W)&&W>=0},wrappedGetOwnPropertyDescriptor=function(W,X){return X=toPropertyKey(X),isTypedArrayIndex(W,X)?createPropertyDescriptor$3(2,W[X]):nativeGetOwnPropertyDescriptor(W,X)},wrappedDefineProperty=function(W,X,V){return X=toPropertyKey(X),isTypedArrayIndex(W,X)&&isObject$a(V)&&hasOwn$7(V,"value")&&!hasOwn$7(V,"get")&&!hasOwn$7(V,"set")&&!V.configurable&&(!hasOwn$7(V,"writable")||V.writable)&&(!hasOwn$7(V,"enumerable")||V.enumerable)?(W[X]=V.value,W):nativeDefineProperty(W,X,V)};DESCRIPTORS$7?(NATIVE_ARRAY_BUFFER_VIEWS||(getOwnPropertyDescriptorModule.f=wrappedGetOwnPropertyDescriptor,definePropertyModule.f=wrappedDefineProperty,addGetter(TypedArrayPrototype$1,"buffer"),addGetter(TypedArrayPrototype$1,"byteOffset"),addGetter(TypedArrayPrototype$1,"byteLength"),addGetter(TypedArrayPrototype$1,"length")),$$h({target:"Object",stat:!0,forced:!NATIVE_ARRAY_BUFFER_VIEWS},{getOwnPropertyDescriptor:wrappedGetOwnPropertyDescriptor,defineProperty:wrappedDefineProperty}),typedArrayConstructor.exports=function(G,W,X){var V=G.match(/\d+/)[0]/8,Z=G+(X?"Clamped":"")+"Array",re="get"+G,se="set"+G,ue=global$l[Z],H=ue,ye=H&&H.prototype,Ie={},Ee=function(wt,Ot){var $t=getInternalState$1(wt);return $t.view[re](Ot*V+$t.byteOffset,!0)},Fe=function(wt,Ot,$t){var jt=getInternalState$1(wt);jt.view[se](Ot*V+jt.byteOffset,X?toUint8Clamped($t):$t,!0)},je=function(wt,Ot){nativeDefineProperty(wt,Ot,{get:function(){return Ee(this,Ot)},set:function($t){return Fe(this,Ot,$t)},enumerable:!0})};NATIVE_ARRAY_BUFFER_VIEWS?TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS$2&&(H=W(function(wt,Ot,$t,jt){return anInstance$5(wt,ye),inheritIfRequired$1(function(){return isObject$a(Ot)?isArrayBuffer(Ot)?jt!==void 0?new ue(Ot,toOffset$1($t,V),jt):$t!==void 0?new ue(Ot,toOffset$1($t,V)):new ue(Ot):isTypedArray(Ot)?arrayFromConstructorAndList$2(H,Ot):call$7(typedArrayFrom$1,H,Ot):new ue(toIndex(Ot))}(),wt,H)}),setPrototypeOf&&setPrototypeOf(H,TypedArray),forEach$4(getOwnPropertyNames(ue),function(wt){wt in H||createNonEnumerableProperty$3(H,wt,ue[wt])}),H.prototype=ye):(H=W(function(wt,Ot,$t,jt){anInstance$5(wt,ye);var nr=0,sr=0,gr,hr,Ir;if(!isObject$a(Ot))Ir=toIndex(Ot),hr=Ir*V,gr=new ArrayBuffer$1(hr);else if(isArrayBuffer(Ot)){gr=Ot,sr=toOffset$1($t,V);var br=Ot.byteLength;if(jt===void 0){if(br%V)throw new RangeError$2(WRONG_LENGTH);if(hr=br-sr,hr<0)throw new RangeError$2(WRONG_LENGTH)}else if(hr=toLength$1(jt)*V,hr+sr>br)throw new RangeError$2(WRONG_LENGTH);Ir=hr/V}else return isTypedArray(Ot)?arrayFromConstructorAndList$2(H,Ot):call$7(typedArrayFrom$1,H,Ot);for(setInternalState$4(wt,{buffer:gr,byteOffset:sr,byteLength:hr,length:Ir,view:new DataView$1(gr)});nr<Ir;)je(wt,nr++)}),setPrototypeOf&&setPrototypeOf(H,TypedArray),ye=H.prototype=create$4(TypedArrayPrototype$1)),ye.constructor!==H&&createNonEnumerableProperty$3(ye,"constructor",H),enforceInternalState$1(ye).TypedArrayConstructor=H,TYPED_ARRAY_TAG&&createNonEnumerableProperty$3(ye,TYPED_ARRAY_TAG,Z);var mt=H!==ue;Ie[Z]=H,$$h({global:!0,constructor:!0,forced:mt,sham:!NATIVE_ARRAY_BUFFER_VIEWS},Ie),BYTES_PER_ELEMENT in H||createNonEnumerableProperty$3(H,BYTES_PER_ELEMENT,V),BYTES_PER_ELEMENT in ye||createNonEnumerableProperty$3(ye,BYTES_PER_ELEMENT,V),setSpecies(Z)}):typedArrayConstructor.exports=function(){};var typedArrayConstructorExports=typedArrayConstructor.exports,createTypedArrayConstructor$8=typedArrayConstructorExports;createTypedArrayConstructor$8("Float32",function(G){return function(X,V,Z){return G(this,X,V,Z)}});var createTypedArrayConstructor$7=typedArrayConstructorExports;createTypedArrayConstructor$7("Float64",function(G){return function(X,V,Z){return G(this,X,V,Z)}});var createTypedArrayConstructor$6=typedArrayConstructorExports;createTypedArrayConstructor$6("Int8",function(G){return function(X,V,Z){return G(this,X,V,Z)}});var createTypedArrayConstructor$5=typedArrayConstructorExports;createTypedArrayConstructor$5("Int16",function(G){return function(X,V,Z){return G(this,X,V,Z)}});var createTypedArrayConstructor$4=typedArrayConstructorExports;createTypedArrayConstructor$4("Int32",function(G){return function(X,V,Z){return G(this,X,V,Z)}});var createTypedArrayConstructor$3=typedArrayConstructorExports;createTypedArrayConstructor$3("Uint8",function(G){return function(X,V,Z){return G(this,X,V,Z)}});var createTypedArrayConstructor$2=typedArrayConstructorExports;createTypedArrayConstructor$2("Uint8",function(G){return function(X,V,Z){return G(this,X,V,Z)}},!0);var createTypedArrayConstructor$1=typedArrayConstructorExports;createTypedArrayConstructor$1("Uint16",function(G){return function(X,V,Z){return G(this,X,V,Z)}});var createTypedArrayConstructor=typedArrayConstructorExports;createTypedArrayConstructor("Uint32",function(G){return function(X,V,Z){return G(this,X,V,Z)}});var ArrayBufferViewCore$t=arrayBufferViewCore,lengthOfArrayLike$2=lengthOfArrayLike$s,toIntegerOrInfinity$1=toIntegerOrInfinity$l,aTypedArray$r=ArrayBufferViewCore$t.aTypedArray,exportTypedArrayMethod$s=ArrayBufferViewCore$t.exportTypedArrayMethod;exportTypedArrayMethod$s("at",function(W){var X=aTypedArray$r(this),V=lengthOfArrayLike$2(X),Z=toIntegerOrInfinity$1(W),re=Z>=0?Z:V+Z;return re<0||re>=V?void 0:X[re]});var uncurryThis$k=functionUncurryThis,ArrayBufferViewCore$s=arrayBufferViewCore,$ArrayCopyWithin=arrayCopyWithin,u$ArrayCopyWithin=uncurryThis$k($ArrayCopyWithin),aTypedArray$q=ArrayBufferViewCore$s.aTypedArray,exportTypedArrayMethod$r=ArrayBufferViewCore$s.exportTypedArrayMethod;exportTypedArrayMethod$r("copyWithin",function(W,X){return u$ArrayCopyWithin(aTypedArray$q(this),W,X,arguments.length>2?arguments[2]:void 0)});var ArrayBufferViewCore$r=arrayBufferViewCore,$every=arrayIteration.every,aTypedArray$p=ArrayBufferViewCore$r.aTypedArray,exportTypedArrayMethod$q=ArrayBufferViewCore$r.exportTypedArrayMethod;exportTypedArrayMethod$q("every",function(W){return $every(aTypedArray$p(this),W,arguments.length>1?arguments[1]:void 0)});var ArrayBufferViewCore$q=arrayBufferViewCore,$fill=arrayFill$1,toBigInt$1=toBigInt$3,classof$2=classof$n,call$6=functionCall,uncurryThis$j=functionUncurryThis,fails$d=fails$1p,aTypedArray$o=ArrayBufferViewCore$q.aTypedArray,exportTypedArrayMethod$p=ArrayBufferViewCore$q.exportTypedArrayMethod,slice=uncurryThis$j("".slice),CONVERSION_BUG=fails$d(function(){var G=0;return new Int8Array(2).fill({valueOf:function(){return G++}}),G!==1});exportTypedArrayMethod$p("fill",function(W){var X=arguments.length;aTypedArray$o(this);var V=slice(classof$2(this),0,3)==="Big"?toBigInt$1(W):+W;return call$6($fill,this,V,X>1?arguments[1]:void 0,X>2?arguments[2]:void 0)},CONVERSION_BUG);var ArrayBufferViewCore$p=arrayBufferViewCore,speciesConstructor=speciesConstructor$6,aTypedArrayConstructor$1=ArrayBufferViewCore$p.aTypedArrayConstructor,getTypedArrayConstructor$3=ArrayBufferViewCore$p.getTypedArrayConstructor,typedArraySpeciesConstructor$4=function(G){return aTypedArrayConstructor$1(speciesConstructor(G,getTypedArrayConstructor$3(G)))},arrayFromConstructorAndList$1=arrayFromConstructorAndList$4,typedArraySpeciesConstructor$3=typedArraySpeciesConstructor$4,typedArrayFromSpeciesAndList=function(G,W){return arrayFromConstructorAndList$1(typedArraySpeciesConstructor$3(G),W)},ArrayBufferViewCore$o=arrayBufferViewCore,$filter=arrayIteration.filter,fromSpeciesAndList=typedArrayFromSpeciesAndList,aTypedArray$n=ArrayBufferViewCore$o.aTypedArray,exportTypedArrayMethod$o=ArrayBufferViewCore$o.exportTypedArrayMethod;exportTypedArrayMethod$o("filter",function(W){var X=$filter(aTypedArray$n(this),W,arguments.length>1?arguments[1]:void 0);return fromSpeciesAndList(this,X)});var ArrayBufferViewCore$n=arrayBufferViewCore,$find=arrayIteration.find,aTypedArray$m=ArrayBufferViewCore$n.aTypedArray,exportTypedArrayMethod$n=ArrayBufferViewCore$n.exportTypedArrayMethod;exportTypedArrayMethod$n("find",function(W){return $find(aTypedArray$m(this),W,arguments.length>1?arguments[1]:void 0)});var ArrayBufferViewCore$m=arrayBufferViewCore,$findIndex=arrayIteration.findIndex,aTypedArray$l=ArrayBufferViewCore$m.aTypedArray,exportTypedArrayMethod$m=ArrayBufferViewCore$m.exportTypedArrayMethod;exportTypedArrayMethod$m("findIndex",function(W){return $findIndex(aTypedArray$l(this),W,arguments.length>1?arguments[1]:void 0)});var ArrayBufferViewCore$l=arrayBufferViewCore,$findLast=arrayIterationFromLast.findLast,aTypedArray$k=ArrayBufferViewCore$l.aTypedArray,exportTypedArrayMethod$l=ArrayBufferViewCore$l.exportTypedArrayMethod;exportTypedArrayMethod$l("findLast",function(W){return $findLast(aTypedArray$k(this),W,arguments.length>1?arguments[1]:void 0)});var ArrayBufferViewCore$k=arrayBufferViewCore,$findLastIndex=arrayIterationFromLast.findLastIndex,aTypedArray$j=ArrayBufferViewCore$k.aTypedArray,exportTypedArrayMethod$k=ArrayBufferViewCore$k.exportTypedArrayMethod;exportTypedArrayMethod$k("findLastIndex",function(W){return $findLastIndex(aTypedArray$j(this),W,arguments.length>1?arguments[1]:void 0)});var ArrayBufferViewCore$j=arrayBufferViewCore,$forEach=arrayIteration.forEach,aTypedArray$i=ArrayBufferViewCore$j.aTypedArray,exportTypedArrayMethod$j=ArrayBufferViewCore$j.exportTypedArrayMethod;exportTypedArrayMethod$j("forEach",function(W){$forEach(aTypedArray$i(this),W,arguments.length>1?arguments[1]:void 0)});var TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS$1=typedArrayConstructorsRequireWrappers,exportTypedArrayStaticMethod$1=arrayBufferViewCore.exportTypedArrayStaticMethod,typedArrayFrom=typedArrayFrom$2;exportTypedArrayStaticMethod$1("from",typedArrayFrom,TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS$1);var ArrayBufferViewCore$i=arrayBufferViewCore,$includes=arrayIncludes.includes,aTypedArray$h=ArrayBufferViewCore$i.aTypedArray,exportTypedArrayMethod$i=ArrayBufferViewCore$i.exportTypedArrayMethod;exportTypedArrayMethod$i("includes",function(W){return $includes(aTypedArray$h(this),W,arguments.length>1?arguments[1]:void 0)});var ArrayBufferViewCore$h=arrayBufferViewCore,$indexOf=arrayIncludes.indexOf,aTypedArray$g=ArrayBufferViewCore$h.aTypedArray,exportTypedArrayMethod$h=ArrayBufferViewCore$h.exportTypedArrayMethod;exportTypedArrayMethod$h("indexOf",function(W){return $indexOf(aTypedArray$g(this),W,arguments.length>1?arguments[1]:void 0)});var global$k=global$10,fails$c=fails$1p,uncurryThis$i=functionUncurryThis,ArrayBufferViewCore$g=arrayBufferViewCore,ArrayIterators=es_array_iterator,wellKnownSymbol$3=wellKnownSymbol$z,ITERATOR$3=wellKnownSymbol$3("iterator"),Uint8Array$2=global$k.Uint8Array,arrayValues=uncurryThis$i(ArrayIterators.values),arrayKeys=uncurryThis$i(ArrayIterators.keys),arrayEntries=uncurryThis$i(ArrayIterators.entries),aTypedArray$f=ArrayBufferViewCore$g.aTypedArray,exportTypedArrayMethod$g=ArrayBufferViewCore$g.exportTypedArrayMethod,TypedArrayPrototype=Uint8Array$2&&Uint8Array$2.prototype,GENERIC=!fails$c(function(){TypedArrayPrototype[ITERATOR$3].call([1])}),ITERATOR_IS_VALUES=!!TypedArrayPrototype&&TypedArrayPrototype.values&&TypedArrayPrototype[ITERATOR$3]===TypedArrayPrototype.values&&TypedArrayPrototype.values.name==="values",typedArrayValues=function(){return arrayValues(aTypedArray$f(this))};exportTypedArrayMethod$g("entries",function(){return arrayEntries(aTypedArray$f(this))},GENERIC);exportTypedArrayMethod$g("keys",function(){return arrayKeys(aTypedArray$f(this))},GENERIC);exportTypedArrayMethod$g("values",typedArrayValues,GENERIC||!ITERATOR_IS_VALUES,{name:"values"});exportTypedArrayMethod$g(ITERATOR$3,typedArrayValues,GENERIC||!ITERATOR_IS_VALUES,{name:"values"});var ArrayBufferViewCore$f=arrayBufferViewCore,uncurryThis$h=functionUncurryThis,aTypedArray$e=ArrayBufferViewCore$f.aTypedArray,exportTypedArrayMethod$f=ArrayBufferViewCore$f.exportTypedArrayMethod,$join$1=uncurryThis$h([].join);exportTypedArrayMethod$f("join",function(W){return $join$1(aTypedArray$e(this),W)});var ArrayBufferViewCore$e=arrayBufferViewCore,apply$4=functionApply$1,$lastIndexOf=arrayLastIndexOf,aTypedArray$d=ArrayBufferViewCore$e.aTypedArray,exportTypedArrayMethod$e=ArrayBufferViewCore$e.exportTypedArrayMethod;exportTypedArrayMethod$e("lastIndexOf",function(W){var X=arguments.length;return apply$4($lastIndexOf,aTypedArray$d(this),X>1?[W,arguments[1]]:[W])});var ArrayBufferViewCore$d=arrayBufferViewCore,$map=arrayIteration.map,typedArraySpeciesConstructor$2=typedArraySpeciesConstructor$4,aTypedArray$c=ArrayBufferViewCore$d.aTypedArray,exportTypedArrayMethod$d=ArrayBufferViewCore$d.exportTypedArrayMethod;exportTypedArrayMethod$d("map",function(W){return $map(aTypedArray$c(this),W,arguments.length>1?arguments[1]:void 0,function(X,V){return new(typedArraySpeciesConstructor$2(X))(V)})});var ArrayBufferViewCore$c=arrayBufferViewCore,TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS=typedArrayConstructorsRequireWrappers,aTypedArrayConstructor=ArrayBufferViewCore$c.aTypedArrayConstructor,exportTypedArrayStaticMethod=ArrayBufferViewCore$c.exportTypedArrayStaticMethod;exportTypedArrayStaticMethod("of",function(){for(var W=0,X=arguments.length,V=new(aTypedArrayConstructor(this))(X);X>W;)V[W]=arguments[W++];return V},TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS);var ArrayBufferViewCore$b=arrayBufferViewCore,$reduce=arrayReduce.left,aTypedArray$b=ArrayBufferViewCore$b.aTypedArray,exportTypedArrayMethod$c=ArrayBufferViewCore$b.exportTypedArrayMethod;exportTypedArrayMethod$c("reduce",function(W){var X=arguments.length;return $reduce(aTypedArray$b(this),W,X,X>1?arguments[1]:void 0)});var ArrayBufferViewCore$a=arrayBufferViewCore,$reduceRight=arrayReduce.right,aTypedArray$a=ArrayBufferViewCore$a.aTypedArray,exportTypedArrayMethod$b=ArrayBufferViewCore$a.exportTypedArrayMethod;exportTypedArrayMethod$b("reduceRight",function(W){var X=arguments.length;return $reduceRight(aTypedArray$a(this),W,X,X>1?arguments[1]:void 0)});var ArrayBufferViewCore$9=arrayBufferViewCore,aTypedArray$9=ArrayBufferViewCore$9.aTypedArray,exportTypedArrayMethod$a=ArrayBufferViewCore$9.exportTypedArrayMethod,floor$2=Math.floor;exportTypedArrayMethod$a("reverse",function(){for(var W=this,X=aTypedArray$9(W).length,V=floor$2(X/2),Z=0,re;Z<V;)re=W[Z],W[Z++]=W[--X],W[X]=re;return W});var global$j=global$10,call$5=functionCall,ArrayBufferViewCore$8=arrayBufferViewCore,lengthOfArrayLike$1=lengthOfArrayLike$s,toOffset=toOffset$2,toIndexedObject=toObject$t,fails$b=fails$1p,RangeError$1=global$j.RangeError,Int8Array$2=global$j.Int8Array,Int8ArrayPrototype=Int8Array$2&&Int8Array$2.prototype,$set=Int8ArrayPrototype&&Int8ArrayPrototype.set,aTypedArray$8=ArrayBufferViewCore$8.aTypedArray,exportTypedArrayMethod$9=ArrayBufferViewCore$8.exportTypedArrayMethod,WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS=!fails$b(function(){var G=new Uint8ClampedArray(2);return call$5($set,G,{length:1,0:3},1),G[1]!==3}),TO_OBJECT_BUG=WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS&&ArrayBufferViewCore$8.NATIVE_ARRAY_BUFFER_VIEWS&&fails$b(function(){var G=new Int8Array$2(2);return G.set(1),G.set("2",1),G[0]!==0||G[1]!==2});exportTypedArrayMethod$9("set",function(W){aTypedArray$8(this);var X=toOffset(arguments.length>1?arguments[1]:void 0,1),V=toIndexedObject(W);if(WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS)return call$5($set,this,V,X);var Z=this.length,re=lengthOfArrayLike$1(V),se=0;if(re+X>Z)throw new RangeError$1("Wrong length");for(;se<re;)this[X+se]=V[se++]},!WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS||TO_OBJECT_BUG);var ArrayBufferViewCore$7=arrayBufferViewCore,typedArraySpeciesConstructor$1=typedArraySpeciesConstructor$4,fails$a=fails$1p,arraySlice$3=arraySlice$a,aTypedArray$7=ArrayBufferViewCore$7.aTypedArray,exportTypedArrayMethod$8=ArrayBufferViewCore$7.exportTypedArrayMethod,FORCED$2=fails$a(function(){new Int8Array(1).slice()});exportTypedArrayMethod$8("slice",function(W,X){for(var V=arraySlice$3(aTypedArray$7(this),W,X),Z=typedArraySpeciesConstructor$1(this),re=0,se=V.length,ue=new Z(se);se>re;)ue[re]=V[re++];return ue},FORCED$2);var ArrayBufferViewCore$6=arrayBufferViewCore,$some=arrayIteration.some,aTypedArray$6=ArrayBufferViewCore$6.aTypedArray,exportTypedArrayMethod$7=ArrayBufferViewCore$6.exportTypedArrayMethod;exportTypedArrayMethod$7("some",function(W){return $some(aTypedArray$6(this),W,arguments.length>1?arguments[1]:void 0)});var global$i=global$10,uncurryThis$g=functionUncurryThisClause,fails$9=fails$1p,aCallable$2=aCallable$n,internalSort=arraySort$1,ArrayBufferViewCore$5=arrayBufferViewCore,FF=engineFfVersion,IE_OR_EDGE=engineIsIeOrEdge,V8=engineV8Version,WEBKIT=engineWebkitVersion,aTypedArray$5=ArrayBufferViewCore$5.aTypedArray,exportTypedArrayMethod$6=ArrayBufferViewCore$5.exportTypedArrayMethod,Uint16Array$1=global$i.Uint16Array,nativeSort=Uint16Array$1&&uncurryThis$g(Uint16Array$1.prototype.sort),ACCEPT_INCORRECT_ARGUMENTS=!!nativeSort&&!(fails$9(function(){nativeSort(new Uint16Array$1(2),null)})&&fails$9(function(){nativeSort(new Uint16Array$1(2),{})})),STABLE_SORT=!!nativeSort&&!fails$9(function(){if(V8)return V8<74;if(FF)return FF<67;if(IE_OR_EDGE)return!0;if(WEBKIT)return WEBKIT<602;var G=new Uint16Array$1(516),W=Array(516),X,V;for(X=0;X<516;X++)V=X%4,G[X]=515-X,W[X]=X-2*V+3;for(nativeSort(G,function(Z,re){return(Z/4|0)-(re/4|0)}),X=0;X<516;X++)if(G[X]!==W[X])return!0}),getSortCompare=function(G){return function(W,X){return G!==void 0?+G(W,X)||0:X!==X?-1:W!==W?1:W===0&&X===0?1/W>0&&1/X<0?1:-1:W>X}};exportTypedArrayMethod$6("sort",function(W){return W!==void 0&&aCallable$2(W),STABLE_SORT?nativeSort(this,W):internalSort(aTypedArray$5(this),getSortCompare(W))},!STABLE_SORT||ACCEPT_INCORRECT_ARGUMENTS);var ArrayBufferViewCore$4=arrayBufferViewCore,toLength=toLength$d,toAbsoluteIndex=toAbsoluteIndex$9,typedArraySpeciesConstructor=typedArraySpeciesConstructor$4,aTypedArray$4=ArrayBufferViewCore$4.aTypedArray,exportTypedArrayMethod$5=ArrayBufferViewCore$4.exportTypedArrayMethod;exportTypedArrayMethod$5("subarray",function(W,X){var V=aTypedArray$4(this),Z=V.length,re=toAbsoluteIndex(W,Z),se=typedArraySpeciesConstructor(V);return new se(V.buffer,V.byteOffset+re*V.BYTES_PER_ELEMENT,toLength((X===void 0?Z:toAbsoluteIndex(X,Z))-re))});var global$h=global$10,apply$3=functionApply$1,ArrayBufferViewCore$3=arrayBufferViewCore,fails$8=fails$1p,arraySlice$2=arraySlice$a,Int8Array$1=global$h.Int8Array,aTypedArray$3=ArrayBufferViewCore$3.aTypedArray,exportTypedArrayMethod$4=ArrayBufferViewCore$3.exportTypedArrayMethod,$toLocaleString=[].toLocaleString,TO_LOCALE_STRING_BUG=!!Int8Array$1&&fails$8(function(){$toLocaleString.call(new Int8Array$1(1))}),FORCED$1=fails$8(function(){return[1,2].toLocaleString()!==new Int8Array$1([1,2]).toLocaleString()})||!fails$8(function(){Int8Array$1.prototype.toLocaleString.call([1,2])});exportTypedArrayMethod$4("toLocaleString",function(){return apply$3($toLocaleString,TO_LOCALE_STRING_BUG?arraySlice$2(aTypedArray$3(this)):aTypedArray$3(this),arraySlice$2(arguments))},FORCED$1);var arrayToReversed=arrayToReversed$2,ArrayBufferViewCore$2=arrayBufferViewCore,aTypedArray$2=ArrayBufferViewCore$2.aTypedArray,exportTypedArrayMethod$3=ArrayBufferViewCore$2.exportTypedArrayMethod,getTypedArrayConstructor$2=ArrayBufferViewCore$2.getTypedArrayConstructor;exportTypedArrayMethod$3("toReversed",function(){return arrayToReversed(aTypedArray$2(this),getTypedArrayConstructor$2(this))});var ArrayBufferViewCore$1=arrayBufferViewCore,uncurryThis$f=functionUncurryThis,aCallable$1=aCallable$n,arrayFromConstructorAndList=arrayFromConstructorAndList$4,aTypedArray$1=ArrayBufferViewCore$1.aTypedArray,getTypedArrayConstructor$1=ArrayBufferViewCore$1.getTypedArrayConstructor,exportTypedArrayMethod$2=ArrayBufferViewCore$1.exportTypedArrayMethod,sort=uncurryThis$f(ArrayBufferViewCore$1.TypedArrayPrototype.sort);exportTypedArrayMethod$2("toSorted",function(W){W!==void 0&&aCallable$1(W);var X=aTypedArray$1(this),V=arrayFromConstructorAndList(getTypedArrayConstructor$1(X),X);return sort(V,W)});var exportTypedArrayMethod$1=arrayBufferViewCore.exportTypedArrayMethod,fails$7=fails$1p,global$g=global$10,uncurryThis$e=functionUncurryThis,Uint8Array$1=global$g.Uint8Array,Uint8ArrayPrototype=Uint8Array$1&&Uint8Array$1.prototype||{},arrayToString=[].toString,join$3=uncurryThis$e([].join);fails$7(function(){arrayToString.call({})})&&(arrayToString=function(){return join$3(this)});var IS_NOT_ARRAY_METHOD=Uint8ArrayPrototype.toString!==arrayToString;exportTypedArrayMethod$1("toString",arrayToString,IS_NOT_ARRAY_METHOD);var arrayWith=arrayWith$2,ArrayBufferViewCore=arrayBufferViewCore,isBigIntArray=isBigIntArray$2,toIntegerOrInfinity=toIntegerOrInfinity$l,toBigInt=toBigInt$3,aTypedArray=ArrayBufferViewCore.aTypedArray,getTypedArrayConstructor=ArrayBufferViewCore.getTypedArrayConstructor,exportTypedArrayMethod=ArrayBufferViewCore.exportTypedArrayMethod,PROPER_ORDER=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(G){return G===8}}();exportTypedArrayMethod("with",function(G,W){var X=aTypedArray(this),V=toIntegerOrInfinity(G),Z=isBigIntArray(X)?toBigInt(W):+W;return arrayWith(X,getTypedArrayConstructor(X),V,Z)},!PROPER_ORDER);var $$g=_export,uncurryThis$d=functionUncurryThis,toString$7=toString$E,fromCharCode$2=String.fromCharCode,charAt$4=uncurryThis$d("".charAt),exec$3=uncurryThis$d(/./.exec),stringSlice$2=uncurryThis$d("".slice),hex2=/^[\da-f]{2}$/i,hex4=/^[\da-f]{4}$/i;$$g({global:!0},{unescape:function(W){for(var X=toString$7(W),V="",Z=X.length,re=0,se,ue;re<Z;){if(se=charAt$4(X,re++),se==="%"){if(charAt$4(X,re)==="u"){if(ue=stringSlice$2(X,re+1,re+5),exec$3(hex4,ue)){V+=fromCharCode$2(parseInt(ue,16)),re+=5;continue}}else if(ue=stringSlice$2(X,re,re+2),exec$3(hex2,ue)){V+=fromCharCode$2(parseInt(ue,16)),re+=2;continue}}V+=se}return V}});var uncurryThis$c=functionUncurryThis,defineBuiltIns$2=defineBuiltIns$5,getWeakData=internalMetadataExports.getWeakData,anInstance$4=anInstance$a,anObject$3=anObject$D,isNullOrUndefined$2=isNullOrUndefined$f,isObject$9=isObject$G,iterate$1=iterate$c,ArrayIterationModule=arrayIteration,hasOwn$6=hasOwnProperty_1,InternalStateModule$3=internalState,setInternalState$3=InternalStateModule$3.set,internalStateGetterFor=InternalStateModule$3.getterFor,find$1=ArrayIterationModule.find,findIndex=ArrayIterationModule.findIndex,splice$2=uncurryThis$c([].splice),id=0,uncaughtFrozenStore=function(G){return G.frozen||(G.frozen=new UncaughtFrozenStore)},UncaughtFrozenStore=function(){this.entries=[]},findUncaughtFrozen=function(G,W){return find$1(G.entries,function(X){return X[0]===W})};UncaughtFrozenStore.prototype={get:function(G){var W=findUncaughtFrozen(this,G);if(W)return W[1]},has:function(G){return!!findUncaughtFrozen(this,G)},set:function(G,W){var X=findUncaughtFrozen(this,G);X?X[1]=W:this.entries.push([G,W])},delete:function(G){var W=findIndex(this.entries,function(X){return X[0]===G});return~W&&splice$2(this.entries,W,1),!!~W}};var collectionWeak$2={getConstructor:function(G,W,X,V){var Z=G(function(H,ye){anInstance$4(H,re),setInternalState$3(H,{type:W,id:id++,frozen:void 0}),isNullOrUndefined$2(ye)||iterate$1(ye,H[V],{that:H,AS_ENTRIES:X})}),re=Z.prototype,se=internalStateGetterFor(W),ue=function(H,ye,Ie){var Ee=se(H),Fe=getWeakData(anObject$3(ye),!0);return Fe===!0?uncaughtFrozenStore(Ee).set(ye,Ie):Fe[Ee.id]=Ie,H};return defineBuiltIns$2(re,{delete:function(H){var ye=se(this);if(!isObject$9(H))return!1;var Ie=getWeakData(H);return Ie===!0?uncaughtFrozenStore(ye).delete(H):Ie&&hasOwn$6(Ie,ye.id)&&delete Ie[ye.id]},has:function(ye){var Ie=se(this);if(!isObject$9(ye))return!1;var Ee=getWeakData(ye);return Ee===!0?uncaughtFrozenStore(Ie).has(ye):Ee&&hasOwn$6(Ee,Ie.id)}}),defineBuiltIns$2(re,X?{get:function(ye){var Ie=se(this);if(isObject$9(ye)){var Ee=getWeakData(ye);return Ee===!0?uncaughtFrozenStore(Ie).get(ye):Ee?Ee[Ie.id]:void 0}},set:function(ye,Ie){return ue(this,ye,Ie)}}:{add:function(ye){return ue(this,ye,!0)}}),Z}},FREEZING=freezing,global$f=global$10,uncurryThis$b=functionUncurryThis,defineBuiltIns$1=defineBuiltIns$5,InternalMetadataModule=internalMetadataExports,collection$1=collection$4,collectionWeak$1=collectionWeak$2,isObject$8=isObject$G,enforceInternalState=internalState.enforce,fails$6=fails$1p,NATIVE_WEAK_MAP=weakMapBasicDetection,$Object=Object,isArray$7=Array.isArray,isExtensible=$Object.isExtensible,isFrozen=$Object.isFrozen,isSealed=$Object.isSealed,freeze=$Object.freeze,seal=$Object.seal,IS_IE11=!global$f.ActiveXObject&&"ActiveXObject"in global$f,InternalWeakMap,wrapper=function(G){return function(){return G(this,arguments.length?arguments[0]:void 0)}},$WeakMap=collection$1("WeakMap",wrapper,collectionWeak$1),WeakMapPrototype=$WeakMap.prototype,nativeSet=uncurryThis$b(WeakMapPrototype.set),hasMSEdgeFreezingBug=function(){return FREEZING&&fails$6(function(){var G=freeze([]);return nativeSet(new $WeakMap,G,1),!isFrozen(G)})};if(NATIVE_WEAK_MAP)if(IS_IE11){InternalWeakMap=collectionWeak$1.getConstructor(wrapper,"WeakMap",!0),InternalMetadataModule.enable();var nativeDelete=uncurryThis$b(WeakMapPrototype.delete),nativeHas=uncurryThis$b(WeakMapPrototype.has),nativeGet=uncurryThis$b(WeakMapPrototype.get);defineBuiltIns$1(WeakMapPrototype,{delete:function(G){if(isObject$8(G)&&!isExtensible(G)){var W=enforceInternalState(this);return W.frozen||(W.frozen=new InternalWeakMap),nativeDelete(this,G)||W.frozen.delete(G)}return nativeDelete(this,G)},has:function(W){if(isObject$8(W)&&!isExtensible(W)){var X=enforceInternalState(this);return X.frozen||(X.frozen=new InternalWeakMap),nativeHas(this,W)||X.frozen.has(W)}return nativeHas(this,W)},get:function(W){if(isObject$8(W)&&!isExtensible(W)){var X=enforceInternalState(this);return X.frozen||(X.frozen=new InternalWeakMap),nativeHas(this,W)?nativeGet(this,W):X.frozen.get(W)}return nativeGet(this,W)},set:function(W,X){if(isObject$8(W)&&!isExtensible(W)){var V=enforceInternalState(this);V.frozen||(V.frozen=new InternalWeakMap),nativeHas(this,W)?nativeSet(this,W,X):V.frozen.set(W,X)}else nativeSet(this,W,X);return this}})}else hasMSEdgeFreezingBug()&&defineBuiltIns$1(WeakMapPrototype,{set:function(W,X){var V;return isArray$7(W)&&(isFrozen(W)?V=freeze:isSealed(W)&&(V=seal)),nativeSet(this,W,X),V&&V(W),this}});var collection=collection$4,collectionWeak=collectionWeak$2;collection("WeakSet",function(G){return function(){return G(this,arguments.length?arguments[0]:void 0)}},collectionWeak);var commonAlphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",base64Alphabet=commonAlphabet+"+/",base64UrlAlphabet=commonAlphabet+"-_",inverse=function(G){for(var W={},X=0;X<64;X++)W[G.charAt(X)]=X;return W},base64Map={i2c:base64Alphabet,c2i:inverse(base64Alphabet),i2cUrl:base64UrlAlphabet,c2iUrl:inverse(base64UrlAlphabet)},$$f=_export,global$e=global$10,getBuiltIn$6=getBuiltIn$p,uncurryThis$a=functionUncurryThis,call$4=functionCall,fails$5=fails$1p,toString$6=toString$E,validateArgumentsLength$9=validateArgumentsLength$b,c2i=base64Map.c2i,disallowed=/[^\d+/a-z]/i,whitespaces=/[\t\n\f\r ]+/g,finalEq=/[=]{1,2}$/,$atob=getBuiltIn$6("atob"),fromCharCode$1=String.fromCharCode,charAt$3=uncurryThis$a("".charAt),replace$3=uncurryThis$a("".replace),exec$2=uncurryThis$a(disallowed.exec),BASIC$1=!!$atob&&!fails$5(function(){return $atob("aGk=")!=="hi"}),NO_SPACES_IGNORE=BASIC$1&&fails$5(function(){return $atob(" ")!==""}),NO_ENCODING_CHECK=BASIC$1&&!fails$5(function(){$atob("a")}),NO_ARG_RECEIVING_CHECK$1=BASIC$1&&!fails$5(function(){$atob()}),WRONG_ARITY$1=BASIC$1&&$atob.length!==1,FORCED=!BASIC$1||NO_SPACES_IGNORE||NO_ENCODING_CHECK||NO_ARG_RECEIVING_CHECK$1||WRONG_ARITY$1;$$f({global:!0,bind:!0,enumerable:!0,forced:FORCED},{atob:function(W){if(validateArgumentsLength$9(arguments.length,1),BASIC$1&&!NO_SPACES_IGNORE&&!NO_ENCODING_CHECK)return call$4($atob,global$e,W);var X=replace$3(toString$6(W),whitespaces,""),V="",Z=0,re=0,se,ue,H;if(X.length%4===0&&(X=replace$3(X,finalEq,"")),se=X.length,se%4===1||exec$2(disallowed,X))throw new(getBuiltIn$6("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;Z<se;)ue=charAt$3(X,Z++),H=re%4?H*64+c2i[ue]:c2i[ue],re++%4&&(V+=fromCharCode$1(255&H>>(-2*re&6)));return V}});var $$e=_export,global$d=global$10,getBuiltIn$5=getBuiltIn$p,uncurryThis$9=functionUncurryThis,call$3=functionCall,fails$4=fails$1p,toString$5=toString$E,validateArgumentsLength$8=validateArgumentsLength$b,i2c=base64Map.i2c,$btoa=getBuiltIn$5("btoa"),charAt$2=uncurryThis$9("".charAt),charCodeAt$1=uncurryThis$9("".charCodeAt),BASIC=!!$btoa&&!fails$4(function(){return $btoa("hi")!=="aGk="}),NO_ARG_RECEIVING_CHECK=BASIC&&!fails$4(function(){$btoa()}),WRONG_ARG_CONVERSION=BASIC&&fails$4(function(){return $btoa(null)!=="bnVsbA=="}),WRONG_ARITY=BASIC&&$btoa.length!==1;$$e({global:!0,bind:!0,enumerable:!0,forced:!BASIC||NO_ARG_RECEIVING_CHECK||WRONG_ARG_CONVERSION||WRONG_ARITY},{btoa:function(W){if(validateArgumentsLength$8(arguments.length,1),BASIC)return call$3($btoa,global$d,toString$5(W));for(var X=toString$5(W),V="",Z=0,re=i2c,se,ue;charAt$2(X,Z)||(re="=",Z%1);){if(ue=charCodeAt$1(X,Z+=3/4),ue>255)throw new(getBuiltIn$5("DOMException"))("The string contains characters outside of the Latin1 range","InvalidCharacterError");se=se<<8|ue,V+=charAt$2(re,63&se>>8-Z%1*8)}return V}});var domIterables={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},documentCreateElement=documentCreateElement$2,classList=documentCreateElement("span").classList,DOMTokenListPrototype$2=classList&&classList.constructor&&classList.constructor.prototype,domTokenListPrototype=DOMTokenListPrototype$2===Object.prototype?void 0:DOMTokenListPrototype$2,global$c=global$10,DOMIterables$1=domIterables,DOMTokenListPrototype$1=domTokenListPrototype,forEach$3=arrayForEach,createNonEnumerableProperty$2=createNonEnumerableProperty$f,handlePrototype$1=function(G){if(G&&G.forEach!==forEach$3)try{createNonEnumerableProperty$2(G,"forEach",forEach$3)}catch{G.forEach=forEach$3}};for(var COLLECTION_NAME$1 in DOMIterables$1)DOMIterables$1[COLLECTION_NAME$1]&&handlePrototype$1(global$c[COLLECTION_NAME$1]&&global$c[COLLECTION_NAME$1].prototype);handlePrototype$1(DOMTokenListPrototype$1);var global$b=global$10,DOMIterables=domIterables,DOMTokenListPrototype=domTokenListPrototype,ArrayIteratorMethods=es_array_iterator,createNonEnumerableProperty$1=createNonEnumerableProperty$f,setToStringTag$3=setToStringTag$e,wellKnownSymbol$2=wellKnownSymbol$z,ITERATOR$2=wellKnownSymbol$2("iterator"),ArrayValues=ArrayIteratorMethods.values,handlePrototype=function(G,W){if(G){if(G[ITERATOR$2]!==ArrayValues)try{createNonEnumerableProperty$1(G,ITERATOR$2,ArrayValues)}catch{G[ITERATOR$2]=ArrayValues}if(setToStringTag$3(G,W,!0),DOMIterables[W]){for(var X in ArrayIteratorMethods)if(G[X]!==ArrayIteratorMethods[X])try{createNonEnumerableProperty$1(G,X,ArrayIteratorMethods[X])}catch{G[X]=ArrayIteratorMethods[X]}}}};for(var COLLECTION_NAME in DOMIterables)handlePrototype(global$b[COLLECTION_NAME]&&global$b[COLLECTION_NAME].prototype,COLLECTION_NAME);handlePrototype(DOMTokenListPrototype,"DOMTokenList");var domExceptionConstants={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}},$$d=_export,tryNodeRequire=tryNodeRequire$2,getBuiltIn$4=getBuiltIn$p,fails$3=fails$1p,create$3=objectCreate,createPropertyDescriptor$2=createPropertyDescriptor$c,defineProperty$5=objectDefineProperty.f,defineBuiltIn$4=defineBuiltIn$o,defineBuiltInAccessor$4=defineBuiltInAccessor$i,hasOwn$5=hasOwnProperty_1,anInstance$3=anInstance$a,anObject$2=anObject$D,errorToString=errorToString$2,normalizeStringArgument$1=normalizeStringArgument$5,DOMExceptionConstants$1=domExceptionConstants,clearErrorStack$1=errorStackClear,InternalStateModule$2=internalState,DESCRIPTORS$6=descriptors,DOM_EXCEPTION$2="DOMException",DATA_CLONE_ERR="DATA_CLONE_ERR",Error$3=getBuiltIn$4("Error"),NativeDOMException$1=getBuiltIn$4(DOM_EXCEPTION$2)||function(){try{var G=getBuiltIn$4("MessageChannel")||tryNodeRequire("worker_threads").MessageChannel;new G().port1.postMessage(new WeakMap)}catch(W){if(W.name===DATA_CLONE_ERR&&W.code===25)return W.constructor}}(),NativeDOMExceptionPrototype=NativeDOMException$1&&NativeDOMException$1.prototype,ErrorPrototype=Error$3.prototype,setInternalState$2=InternalStateModule$2.set,getInternalState=InternalStateModule$2.getterFor(DOM_EXCEPTION$2),HAS_STACK="stack"in new Error$3(DOM_EXCEPTION$2),codeFor=function(G){return hasOwn$5(DOMExceptionConstants$1,G)&&DOMExceptionConstants$1[G].m?DOMExceptionConstants$1[G].c:0},$DOMException$1=function(){anInstance$3(this,DOMExceptionPrototype$1);var W=arguments.length,X=normalizeStringArgument$1(W<1?void 0:arguments[0]),V=normalizeStringArgument$1(W<2?void 0:arguments[1],"Error"),Z=codeFor(V);if(setInternalState$2(this,{type:DOM_EXCEPTION$2,name:V,message:X,code:Z}),DESCRIPTORS$6||(this.name=V,this.message=X,this.code=Z),HAS_STACK){var re=new Error$3(X);re.name=DOM_EXCEPTION$2,defineProperty$5(this,"stack",createPropertyDescriptor$2(1,clearErrorStack$1(re.stack,1)))}},DOMExceptionPrototype$1=$DOMException$1.prototype=create$3(ErrorPrototype),createGetterDescriptor=function(G){return{enumerable:!0,configurable:!0,get:G}},getterFor=function(G){return createGetterDescriptor(function(){return getInternalState(this)[G]})};DESCRIPTORS$6&&(defineBuiltInAccessor$4(DOMExceptionPrototype$1,"code",getterFor("code")),defineBuiltInAccessor$4(DOMExceptionPrototype$1,"message",getterFor("message")),defineBuiltInAccessor$4(DOMExceptionPrototype$1,"name",getterFor("name")));defineProperty$5(DOMExceptionPrototype$1,"constructor",createPropertyDescriptor$2(1,$DOMException$1));var INCORRECT_CONSTRUCTOR=fails$3(function(){return!(new NativeDOMException$1 instanceof Error$3)}),INCORRECT_TO_STRING=INCORRECT_CONSTRUCTOR||fails$3(function(){return ErrorPrototype.toString!==errorToString||String(new NativeDOMException$1(1,2))!=="2: 1"}),INCORRECT_CODE=INCORRECT_CONSTRUCTOR||fails$3(function(){return new NativeDOMException$1(1,"DataCloneError").code!==25});INCORRECT_CONSTRUCTOR||NativeDOMException$1[DATA_CLONE_ERR]!==25||NativeDOMExceptionPrototype[DATA_CLONE_ERR];var FORCED_CONSTRUCTOR$1=INCORRECT_CONSTRUCTOR;$$d({global:!0,constructor:!0,forced:FORCED_CONSTRUCTOR$1},{DOMException:FORCED_CONSTRUCTOR$1?$DOMException$1:NativeDOMException$1});var PolyfilledDOMException$1=getBuiltIn$4(DOM_EXCEPTION$2),PolyfilledDOMExceptionPrototype$1=PolyfilledDOMException$1.prototype;INCORRECT_TO_STRING&&NativeDOMException$1===PolyfilledDOMException$1&&defineBuiltIn$4(PolyfilledDOMExceptionPrototype$1,"toString",errorToString);INCORRECT_CODE&&DESCRIPTORS$6&&NativeDOMException$1===PolyfilledDOMException$1&&defineBuiltInAccessor$4(PolyfilledDOMExceptionPrototype$1,"code",createGetterDescriptor(function(){return codeFor(anObject$2(this).name)}));for(var key$1 in DOMExceptionConstants$1)if(hasOwn$5(DOMExceptionConstants$1,key$1)){var constant$3=DOMExceptionConstants$1[key$1],constantName$1=constant$3.s,descriptor$2=createPropertyDescriptor$2(6,constant$3.c);hasOwn$5(PolyfilledDOMException$1,constantName$1)||defineProperty$5(PolyfilledDOMException$1,constantName$1,descriptor$2),hasOwn$5(PolyfilledDOMExceptionPrototype$1,constantName$1)||defineProperty$5(PolyfilledDOMExceptionPrototype$1,constantName$1,descriptor$2)}var $$c=_export,global$a=global$10,getBuiltIn$3=getBuiltIn$p,createPropertyDescriptor$1=createPropertyDescriptor$c,defineProperty$4=objectDefineProperty.f,hasOwn$4=hasOwnProperty_1,anInstance$2=anInstance$a,inheritIfRequired=inheritIfRequired$7,normalizeStringArgument=normalizeStringArgument$5,DOMExceptionConstants=domExceptionConstants,clearErrorStack=errorStackClear,DESCRIPTORS$5=descriptors,DOM_EXCEPTION$1="DOMException",Error$2=getBuiltIn$3("Error"),NativeDOMException=getBuiltIn$3(DOM_EXCEPTION$1),$DOMException=function(){anInstance$2(this,DOMExceptionPrototype);var W=arguments.length,X=normalizeStringArgument(W<1?void 0:arguments[0]),V=normalizeStringArgument(W<2?void 0:arguments[1],"Error"),Z=new NativeDOMException(X,V),re=new Error$2(X);return re.name=DOM_EXCEPTION$1,defineProperty$4(Z,"stack",createPropertyDescriptor$1(1,clearErrorStack(re.stack,1))),inheritIfRequired(Z,this,$DOMException),Z},DOMExceptionPrototype=$DOMException.prototype=NativeDOMException.prototype,ERROR_HAS_STACK="stack"in new Error$2(DOM_EXCEPTION$1),DOM_EXCEPTION_HAS_STACK="stack"in new NativeDOMException(1,2),descriptor$1=NativeDOMException&&DESCRIPTORS$5&&Object.getOwnPropertyDescriptor(global$a,DOM_EXCEPTION$1),BUGGY_DESCRIPTOR=!!descriptor$1&&!(descriptor$1.writable&&descriptor$1.configurable),FORCED_CONSTRUCTOR=ERROR_HAS_STACK&&!BUGGY_DESCRIPTOR&&!DOM_EXCEPTION_HAS_STACK;$$c({global:!0,constructor:!0,forced:FORCED_CONSTRUCTOR},{DOMException:FORCED_CONSTRUCTOR?$DOMException:NativeDOMException});var PolyfilledDOMException=getBuiltIn$3(DOM_EXCEPTION$1),PolyfilledDOMExceptionPrototype=PolyfilledDOMException.prototype;if(PolyfilledDOMExceptionPrototype.constructor!==PolyfilledDOMException){defineProperty$4(PolyfilledDOMExceptionPrototype,"constructor",createPropertyDescriptor$1(1,PolyfilledDOMException));for(var key in DOMExceptionConstants)if(hasOwn$4(DOMExceptionConstants,key)){var constant$2=DOMExceptionConstants[key],constantName=constant$2.s;hasOwn$4(PolyfilledDOMException,constantName)||defineProperty$4(PolyfilledDOMException,constantName,createPropertyDescriptor$1(6,constant$2.c))}}var getBuiltIn$2=getBuiltIn$p,setToStringTag$2=setToStringTag$e,DOM_EXCEPTION="DOMException";setToStringTag$2(getBuiltIn$2(DOM_EXCEPTION),DOM_EXCEPTION);var $$b=_export,global$9=global$10,clearImmediate=task$1.clear;$$b({global:!0,bind:!0,enumerable:!0,forced:global$9.clearImmediate!==clearImmediate},{clearImmediate});var engineIsBun=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",global$8=global$10,apply$2=functionApply$1,isCallable$2=isCallable$y,ENGINE_IS_BUN=engineIsBun,USER_AGENT=engineUserAgent,arraySlice$1=arraySlice$a,validateArgumentsLength$7=validateArgumentsLength$b,Function$1=global$8.Function,WRAP=/MSIE .\./.test(USER_AGENT)||ENGINE_IS_BUN&&function(){var G=global$8.Bun.version.split(".");return G.length<3||G[0]==="0"&&(G[1]<3||G[1]==="3"&&G[2]==="0")}(),schedulersFix$3=function(G,W){var X=W?2:1;return WRAP?function(V,Z){var re=validateArgumentsLength$7(arguments.length,1)>X,se=isCallable$2(V)?V:Function$1(V),ue=re?arraySlice$1(arguments,X):[],H=re?function(){apply$2(se,this,ue)}:se;return W?G(H,Z):G(H)}:G},$$a=_export,global$7=global$10,setTask=task$1.set,schedulersFix$2=schedulersFix$3,setImmediate=global$7.setImmediate?schedulersFix$2(setTask,!1):setTask;$$a({global:!0,bind:!0,enumerable:!0,forced:global$7.setImmediate!==setImmediate},{setImmediate});var $$9=_export,microtask=microtask_1,aCallable=aCallable$n,validateArgumentsLength$6=validateArgumentsLength$b;$$9({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(W){validateArgumentsLength$6(arguments.length,1),microtask(aCallable(W))}});var $$8=_export,global$6=global$10,defineBuiltInAccessor$3=defineBuiltInAccessor$i,DESCRIPTORS$4=descriptors,$TypeError=TypeError,defineProperty$3=Object.defineProperty,INCORRECT_VALUE=global$6.self!==global$6;try{if(DESCRIPTORS$4){var descriptor=Object.getOwnPropertyDescriptor(global$6,"self");(INCORRECT_VALUE||!descriptor||!descriptor.get||!descriptor.enumerable)&&defineBuiltInAccessor$3(global$6,"self",{get:function(){return global$6},set:function(W){if(this!==global$6)throw new $TypeError("Illegal invocation");defineProperty$3(global$6,"self",{value:W,writable:!0,configurable:!0,enumerable:!0})},configurable:!0,enumerable:!0})}else $$8({global:!0,simple:!0,forced:INCORRECT_VALUE},{self:global$6})}catch{}var uncurryThis$8=functionUncurryThis,SetPrototype$1=Set.prototype,setHelpers={Set,add:uncurryThis$8(SetPrototype$1.add),has:uncurryThis$8(SetPrototype$1.has),remove:uncurryThis$8(SetPrototype$1.delete),proto:SetPrototype$1},call$2=functionCall,iterateSimple$1=function(G,W,X){for(var V=X?G:G.iterator,Z=G.next,re,se;!(re=call$2(Z,V)).done;)if(se=W(re.value),se!==void 0)return se},uncurryThis$7=functionUncurryThis,iterateSimple=iterateSimple$1,SetHelpers$1=setHelpers,Set$2=SetHelpers$1.Set,SetPrototype=SetHelpers$1.proto,forEach$2=uncurryThis$7(SetPrototype.forEach),keys=uncurryThis$7(SetPrototype.keys),next=keys(new Set$2).next,setIterate$1=function(G,W,X){return X?iterateSimple({iterator:keys(G),next},W):forEach$2(G,W)},$$7=_export,global$5=global$10,getBuiltIn$1=getBuiltIn$p,uncurryThis$6=functionUncurryThis,fails$2=fails$1p,uid=uid$6,isCallable$1=isCallable$y,isConstructor=isConstructor$6,isNullOrUndefined$1=isNullOrUndefined$f,isObject$7=isObject$G,isSymbol$6=isSymbol$d,iterate=iterate$c,anObject$1=anObject$D,classof$1=classof$n,hasOwn$3=hasOwnProperty_1,createProperty=createProperty$8,createNonEnumerableProperty=createNonEnumerableProperty$f,lengthOfArrayLike=lengthOfArrayLike$s,validateArgumentsLength$5=validateArgumentsLength$b,getRegExpFlags=regexpGetFlags,MapHelpers=mapHelpers,SetHelpers=setHelpers,setIterate=setIterate$1,detachTransferable=detachTransferable$2,ERROR_STACK_INSTALLABLE=errorStackInstallable,PROPER_STRUCTURED_CLONE_TRANSFER=structuredCloneProperTransfer,Object$1=global$5.Object,Array$1=global$5.Array,Date$1=global$5.Date,Error$1=global$5.Error,TypeError$3=global$5.TypeError,PerformanceMark=global$5.PerformanceMark,DOMException=getBuiltIn$1("DOMException"),Map$3=MapHelpers.Map,mapHas=MapHelpers.has,mapGet=MapHelpers.get,mapSet=MapHelpers.set,Set$1=SetHelpers.Set,setAdd=SetHelpers.add,setHas=SetHelpers.has,objectKeys=getBuiltIn$1("Object","keys"),push$4=uncurryThis$6([].push),thisBooleanValue=uncurryThis$6((!0).valueOf),thisNumberValue=uncurryThis$6(1 .valueOf),thisStringValue=uncurryThis$6("".valueOf),thisTimeValue=uncurryThis$6(Date$1.prototype.getTime),PERFORMANCE_MARK=uid("structuredClone"),DATA_CLONE_ERROR="DataCloneError",TRANSFERRING="Transferring",checkBasicSemantic=function(G){return!fails$2(function(){var W=new global$5.Set([7]),X=G(W),V=G(Object$1(7));return X===W||!X.has(7)||!isObject$7(V)||+V!=7})&&G},checkErrorsCloning=function(G,W){return!fails$2(function(){var X=new W,V=G({a:X,b:X});return!(V&&V.a===V.b&&V.a instanceof W&&V.a.stack===X.stack)})},checkNewErrorsCloningSemantic=function(G){return!fails$2(function(){var W=G(new global$5.AggregateError([1],PERFORMANCE_MARK,{cause:3}));return W.name!=="AggregateError"||W.errors[0]!==1||W.message!==PERFORMANCE_MARK||W.cause!==3})},nativeStructuredClone=global$5.structuredClone,FORCED_REPLACEMENT=!checkErrorsCloning(nativeStructuredClone,Error$1)||!checkErrorsCloning(nativeStructuredClone,DOMException)||!checkNewErrorsCloningSemantic(nativeStructuredClone),structuredCloneFromMark=!nativeStructuredClone&&checkBasicSemantic(function(G){return new PerformanceMark(PERFORMANCE_MARK,{detail:G}).detail}),nativeRestrictedStructuredClone=checkBasicSemantic(nativeStructuredClone)||structuredCloneFromMark,throwUncloneable=function(G){throw new DOMException("Uncloneable type: "+G,DATA_CLONE_ERROR)},throwUnpolyfillable=function(G,W){throw new DOMException((W||"Cloning")+" of "+G+" cannot be properly polyfilled in this engine",DATA_CLONE_ERROR)},tryNativeRestrictedStructuredClone=function(G,W){return nativeRestrictedStructuredClone||throwUnpolyfillable(W),nativeRestrictedStructuredClone(G)},createDataTransfer=function(){var G;try{G=new global$5.DataTransfer}catch{try{G=new global$5.ClipboardEvent("").clipboardData}catch{}}return G&&G.items&&G.files?G:null},cloneBuffer=function(G,W,X){if(mapHas(W,G))return mapGet(W,G);var V=X||classof$1(G),Z,re,se,ue,H,ye;if(V==="SharedArrayBuffer")nativeRestrictedStructuredClone?Z=nativeRestrictedStructuredClone(G):Z=G;else{var Ie=global$5.DataView;!Ie&&!isCallable$1(G.slice)&&throwUnpolyfillable("ArrayBuffer");try{if(isCallable$1(G.slice)&&!G.resizable)Z=G.slice(0);else for(re=G.byteLength,se=("maxByteLength"in G)?{maxByteLength:G.maxByteLength}:void 0,Z=new ArrayBuffer(re,se),ue=new Ie(G),H=new Ie(Z),ye=0;ye<re;ye++)H.setUint8(ye,ue.getUint8(ye))}catch{throw new DOMException("ArrayBuffer is detached",DATA_CLONE_ERROR)}}return mapSet(W,G,Z),Z},cloneView=function(G,W,X,V,Z){var re=global$5[W];return isObject$7(re)||throwUnpolyfillable(W),new re(cloneBuffer(G.buffer,Z),X,V)},structuredCloneInternal=function(G,W){if(isSymbol$6(G)&&throwUncloneable("Symbol"),!isObject$7(G))return G;if(W){if(mapHas(W,G))return mapGet(W,G)}else W=new Map$3;var X=classof$1(G),V,Z,re,se,ue,H,ye,Ie;switch(X){case"Array":re=Array$1(lengthOfArrayLike(G));break;case"Object":re={};break;case"Map":re=new Map$3;break;case"Set":re=new Set$1;break;case"RegExp":re=new RegExp(G.source,getRegExpFlags(G));break;case"Error":switch(Z=G.name,Z){case"AggregateError":re=new(getBuiltIn$1(Z))([]);break;case"EvalError":case"RangeError":case"ReferenceError":case"SuppressedError":case"SyntaxError":case"TypeError":case"URIError":re=new(getBuiltIn$1(Z));break;case"CompileError":case"LinkError":case"RuntimeError":re=new(getBuiltIn$1("WebAssembly",Z));break;default:re=new Error$1}break;case"DOMException":re=new DOMException(G.message,G.name);break;case"ArrayBuffer":case"SharedArrayBuffer":re=cloneBuffer(G,W,X);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":H=X==="DataView"?G.byteLength:G.length,re=cloneView(G,X,G.byteOffset,H,W);break;case"DOMQuad":try{re=new DOMQuad(structuredCloneInternal(G.p1,W),structuredCloneInternal(G.p2,W),structuredCloneInternal(G.p3,W),structuredCloneInternal(G.p4,W))}catch{re=tryNativeRestrictedStructuredClone(G,X)}break;case"File":if(nativeRestrictedStructuredClone)try{re=nativeRestrictedStructuredClone(G),classof$1(re)!==X&&(re=void 0)}catch{}if(!re)try{re=new File([G],G.name,G)}catch{}re||throwUnpolyfillable(X);break;case"FileList":if(se=createDataTransfer(),se){for(ue=0,H=lengthOfArrayLike(G);ue<H;ue++)se.items.add(structuredCloneInternal(G[ue],W));re=se.files}else re=tryNativeRestrictedStructuredClone(G,X);break;case"ImageData":try{re=new ImageData(structuredCloneInternal(G.data,W),G.width,G.height,{colorSpace:G.colorSpace})}catch{re=tryNativeRestrictedStructuredClone(G,X)}break;default:if(nativeRestrictedStructuredClone)re=nativeRestrictedStructuredClone(G);else switch(X){case"BigInt":re=Object$1(G.valueOf());break;case"Boolean":re=Object$1(thisBooleanValue(G));break;case"Number":re=Object$1(thisNumberValue(G));break;case"String":re=Object$1(thisStringValue(G));break;case"Date":re=new Date$1(thisTimeValue(G));break;case"Blob":try{re=G.slice(0,G.size,G.type)}catch{throwUnpolyfillable(X)}break;case"DOMPoint":case"DOMPointReadOnly":V=global$5[X];try{re=V.fromPoint?V.fromPoint(G):new V(G.x,G.y,G.z,G.w)}catch{throwUnpolyfillable(X)}break;case"DOMRect":case"DOMRectReadOnly":V=global$5[X];try{re=V.fromRect?V.fromRect(G):new V(G.x,G.y,G.width,G.height)}catch{throwUnpolyfillable(X)}break;case"DOMMatrix":case"DOMMatrixReadOnly":V=global$5[X];try{re=V.fromMatrix?V.fromMatrix(G):new V(G)}catch{throwUnpolyfillable(X)}break;case"AudioData":case"VideoFrame":isCallable$1(G.clone)||throwUnpolyfillable(X);try{re=G.clone()}catch{throwUncloneable(X)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":throwUnpolyfillable(X);default:throwUncloneable(X)}}switch(mapSet(W,G,re),X){case"Array":case"Object":for(ye=objectKeys(G),ue=0,H=lengthOfArrayLike(ye);ue<H;ue++)Ie=ye[ue],createProperty(re,Ie,structuredCloneInternal(G[Ie],W));break;case"Map":G.forEach(function(Ee,Fe){mapSet(re,structuredCloneInternal(Fe,W),structuredCloneInternal(Ee,W))});break;case"Set":G.forEach(function(Ee){setAdd(re,structuredCloneInternal(Ee,W))});break;case"Error":createNonEnumerableProperty(re,"message",structuredCloneInternal(G.message,W)),hasOwn$3(G,"cause")&&createNonEnumerableProperty(re,"cause",structuredCloneInternal(G.cause,W)),Z==="AggregateError"?re.errors=structuredCloneInternal(G.errors,W):Z==="SuppressedError"&&(re.error=structuredCloneInternal(G.error,W),re.suppressed=structuredCloneInternal(G.suppressed,W));case"DOMException":ERROR_STACK_INSTALLABLE&&createNonEnumerableProperty(re,"stack",structuredCloneInternal(G.stack,W))}return re},tryToTransfer=function(G,W){if(!isObject$7(G))throw new TypeError$3("Transfer option cannot be converted to a sequence");var X=[];iterate(G,function(Fe){push$4(X,anObject$1(Fe))});for(var V=0,Z=lengthOfArrayLike(X),re=new Set$1,se,ue,H,ye,Ie,Ee;V<Z;){if(se=X[V++],ue=classof$1(se),ue==="ArrayBuffer"?setHas(re,se):mapHas(W,se))throw new DOMException("Duplicate transferable",DATA_CLONE_ERROR);if(ue==="ArrayBuffer"){setAdd(re,se);continue}if(PROPER_STRUCTURED_CLONE_TRANSFER)ye=nativeStructuredClone(se,{transfer:[se]});else switch(ue){case"ImageBitmap":H=global$5.OffscreenCanvas,isConstructor(H)||throwUnpolyfillable(ue,TRANSFERRING);try{Ie=new H(se.width,se.height),Ee=Ie.getContext("bitmaprenderer"),Ee.transferFromImageBitmap(se),ye=Ie.transferToImageBitmap()}catch{}break;case"AudioData":case"VideoFrame":(!isCallable$1(se.clone)||!isCallable$1(se.close))&&throwUnpolyfillable(ue,TRANSFERRING);try{ye=se.clone(),se.close()}catch{}break;case"MediaSourceHandle":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":throwUnpolyfillable(ue,TRANSFERRING)}if(ye===void 0)throw new DOMException("This object cannot be transferred: "+ue,DATA_CLONE_ERROR);mapSet(W,se,ye)}return re},detachBuffers=function(G){setIterate(G,function(W){PROPER_STRUCTURED_CLONE_TRANSFER?nativeRestrictedStructuredClone(W,{transfer:[W]}):isCallable$1(W.transfer)?W.transfer():detachTransferable?detachTransferable(W):throwUnpolyfillable("ArrayBuffer",TRANSFERRING)})};$$7({global:!0,enumerable:!0,sham:!PROPER_STRUCTURED_CLONE_TRANSFER,forced:FORCED_REPLACEMENT},{structuredClone:function(W){var X=validateArgumentsLength$5(arguments.length,1)>1&&!isNullOrUndefined$1(arguments[1])?anObject$1(arguments[1]):void 0,V=X?X.transfer:void 0,Z,re;V!==void 0&&(Z=new Map$3,re=tryToTransfer(V,Z));var se=structuredCloneInternal(W,Z);return re&&detachBuffers(re),se}});var $$6=_export,global$4=global$10,schedulersFix$1=schedulersFix$3,setInterval=schedulersFix$1(global$4.setInterval,!0);$$6({global:!0,bind:!0,forced:global$4.setInterval!==setInterval},{setInterval});var $$5=_export,global$3=global$10,schedulersFix=schedulersFix$3,setTimeout$1=schedulersFix(global$3.setTimeout,!0);$$5({global:!0,bind:!0,forced:global$3.setTimeout!==setTimeout$1},{setTimeout:setTimeout$1});var fails$1=fails$1p,wellKnownSymbol$1=wellKnownSymbol$z,DESCRIPTORS$3=descriptors,IS_PURE=isPure,ITERATOR$1=wellKnownSymbol$1("iterator"),urlConstructorDetection=!fails$1(function(){var G=new URL("b?a=1&b=2&c=3","http://a"),W=G.searchParams,X=new URLSearchParams("a=1&a=2&b=3"),V="";return G.pathname="c%20d",W.forEach(function(Z,re){W.delete("b"),V+=re+Z}),X.delete("a",2),X.delete("b",void 0),IS_PURE&&(!G.toJSON||!X.has("a",1)||X.has("a",2)||!X.has("a",void 0)||X.has("b"))||!W.size&&(IS_PURE||!DESCRIPTORS$3)||!W.sort||G.href!=="http://a/c%20d?a=1&c=3"||W.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!W[ITERATOR$1]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://ÑÐµÑÑ").host!=="xn--e1aybc"||new URL("http://a#Ð±").hash!=="#%D0%B1"||V!=="a1c3"||new URL("http://x",void 0).host!=="x"}),uncurryThis$5=functionUncurryThis,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexNonASCII=/[^\0-\u007E]/,regexSeparators=/[.\u3002\uFF0E\uFF61]/g,OVERFLOW_ERROR="Overflow: input needs wider integers to process",baseMinusTMin=base-tMin,$RangeError=RangeError,exec$1=uncurryThis$5(regexSeparators.exec),floor$1=Math.floor,fromCharCode=String.fromCharCode,charCodeAt=uncurryThis$5("".charCodeAt),join$2=uncurryThis$5([].join),push$3=uncurryThis$5([].push),replace$2=uncurryThis$5("".replace),split$2=uncurryThis$5("".split),toLowerCase$1=uncurryThis$5("".toLowerCase),ucs2decode=function(G){for(var W=[],X=0,V=G.length;X<V;){var Z=charCodeAt(G,X++);if(Z>=55296&&Z<=56319&&X<V){var re=charCodeAt(G,X++);(re&64512)===56320?push$3(W,((Z&1023)<<10)+(re&1023)+65536):(push$3(W,Z),X--)}else push$3(W,Z)}return W},digitToBasic=function(G){return G+22+75*(G<26)},adapt=function(G,W,X){var V=0;for(G=X?floor$1(G/damp):G>>1,G+=floor$1(G/W);G>baseMinusTMin*tMax>>1;)G=floor$1(G/baseMinusTMin),V+=base;return floor$1(V+(baseMinusTMin+1)*G/(G+skew))},encode$1=function(G){var W=[];G=ucs2decode(G);var X=G.length,V=initialN,Z=0,re=initialBias,se,ue;for(se=0;se<G.length;se++)ue=G[se],ue<128&&push$3(W,fromCharCode(ue));var H=W.length,ye=H;for(H&&push$3(W,delimiter);ye<X;){var Ie=maxInt;for(se=0;se<G.length;se++)ue=G[se],ue>=V&&ue<Ie&&(Ie=ue);var Ee=ye+1;if(Ie-V>floor$1((maxInt-Z)/Ee))throw new $RangeError(OVERFLOW_ERROR);for(Z+=(Ie-V)*Ee,V=Ie,se=0;se<G.length;se++){if(ue=G[se],ue<V&&++Z>maxInt)throw new $RangeError(OVERFLOW_ERROR);if(ue===V){for(var Fe=Z,je=base;;){var mt=je<=re?tMin:je>=re+tMax?tMax:je-re;if(Fe<mt)break;var wt=Fe-mt,Ot=base-mt;push$3(W,fromCharCode(digitToBasic(mt+wt%Ot))),Fe=floor$1(wt/Ot),je+=base}push$3(W,fromCharCode(digitToBasic(Fe))),re=adapt(Z,Ee,ye===H),Z=0,ye++}}Z++,V++}return join$2(W,"")},stringPunycodeToAscii=function(G){var W=[],X=split$2(replace$2(toLowerCase$1(G),regexSeparators,"."),"."),V,Z;for(V=0;V<X.length;V++)Z=X[V],push$3(W,exec$1(regexNonASCII,Z)?"xn--"+encode$1(Z):Z);return join$2(W,".")},$$4=_export,global$2=global$10,safeGetBuiltIn=safeGetBuiltIn$2,call$1=functionCall,uncurryThis$4=functionUncurryThis,DESCRIPTORS$2=descriptors,USE_NATIVE_URL$2=urlConstructorDetection,defineBuiltIn$3=defineBuiltIn$o,defineBuiltInAccessor$2=defineBuiltInAccessor$i,defineBuiltIns=defineBuiltIns$5,setToStringTag$1=setToStringTag$e,createIteratorConstructor=iteratorCreateConstructor,InternalStateModule$1=internalState,anInstance$1=anInstance$a,isCallable=isCallable$y,hasOwn$2=hasOwnProperty_1,bind$1=functionBindContext,classof=classof$n,anObject=anObject$D,isObject$6=isObject$G,$toString$1=toString$E,create$2=objectCreate,createPropertyDescriptor=createPropertyDescriptor$c,getIterator=getIterator$4,getIteratorMethod=getIteratorMethod$5,createIterResultObject=createIterResultObject$5,validateArgumentsLength$4=validateArgumentsLength$b,wellKnownSymbol=wellKnownSymbol$z,arraySort=arraySort$1,ITERATOR=wellKnownSymbol("iterator"),URL_SEARCH_PARAMS="URLSearchParams",URL_SEARCH_PARAMS_ITERATOR=URL_SEARCH_PARAMS+"Iterator",setInternalState$1=InternalStateModule$1.set,getInternalParamsState=InternalStateModule$1.getterFor(URL_SEARCH_PARAMS),getInternalIteratorState=InternalStateModule$1.getterFor(URL_SEARCH_PARAMS_ITERATOR),nativeFetch=safeGetBuiltIn("fetch"),NativeRequest=safeGetBuiltIn("Request"),Headers=safeGetBuiltIn("Headers"),RequestPrototype=NativeRequest&&NativeRequest.prototype,HeadersPrototype=Headers&&Headers.prototype,RegExp$1=global$2.RegExp,TypeError$2=global$2.TypeError,decodeURIComponent$1=global$2.decodeURIComponent,encodeURIComponent$1=global$2.encodeURIComponent,charAt$1=uncurryThis$4("".charAt),join$1=uncurryThis$4([].join),push$2=uncurryThis$4([].push),replace$1=uncurryThis$4("".replace),shift$1=uncurryThis$4([].shift),splice$1=uncurryThis$4([].splice),split$1=uncurryThis$4("".split),stringSlice$1=uncurryThis$4("".slice),plus=/\+/g,sequences=Array(4),percentSequence=function(G){return sequences[G-1]||(sequences[G-1]=RegExp$1("((?:%[\\da-f]{2}){"+G+"})","gi"))},percentDecode=function(G){try{return decodeURIComponent$1(G)}catch{return G}},deserialize=function(G){var W=replace$1(G,plus," "),X=4;try{return decodeURIComponent$1(W)}catch{for(;X;)W=replace$1(W,percentSequence(X--),percentDecode);return W}},find=/[!'()~]|%20/g,replacements={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},replacer=function(G){return replacements[G]},serialize=function(G){return replace$1(encodeURIComponent$1(G),find,replacer)},URLSearchParamsIterator=createIteratorConstructor(function(W,X){setInternalState$1(this,{type:URL_SEARCH_PARAMS_ITERATOR,target:getInternalParamsState(W).entries,index:0,kind:X})},URL_SEARCH_PARAMS,function(){var W=getInternalIteratorState(this),X=W.target,V=W.index++;if(!X||V>=X.length)return W.target=void 0,createIterResultObject(void 0,!0);var Z=X[V];switch(W.kind){case"keys":return createIterResultObject(Z.key,!1);case"values":return createIterResultObject(Z.value,!1)}return createIterResultObject([Z.key,Z.value],!1)},!0),URLSearchParamsState=function(G){this.entries=[],this.url=null,G!==void 0&&(isObject$6(G)?this.parseObject(G):this.parseQuery(typeof G=="string"?charAt$1(G,0)==="?"?stringSlice$1(G,1):G:$toString$1(G)))};URLSearchParamsState.prototype={type:URL_SEARCH_PARAMS,bindURL:function(G){this.url=G,this.update()},parseObject:function(G){var W=this.entries,X=getIteratorMethod(G),V,Z,re,se,ue,H,ye;if(X)for(V=getIterator(G,X),Z=V.next;!(re=call$1(Z,V)).done;){if(se=getIterator(anObject(re.value)),ue=se.next,(H=call$1(ue,se)).done||(ye=call$1(ue,se)).done||!call$1(ue,se).done)throw new TypeError$2("Expected sequence with length 2");push$2(W,{key:$toString$1(H.value),value:$toString$1(ye.value)})}else for(var Ie in G)hasOwn$2(G,Ie)&&push$2(W,{key:Ie,value:$toString$1(G[Ie])})},parseQuery:function(G){if(G)for(var W=this.entries,X=split$1(G,"&"),V=0,Z,re;V<X.length;)Z=X[V++],Z.length&&(re=split$1(Z,"="),push$2(W,{key:deserialize(shift$1(re)),value:deserialize(join$1(re,"="))}))},serialize:function(){for(var G=this.entries,W=[],X=0,V;X<G.length;)V=G[X++],push$2(W,serialize(V.key)+"="+serialize(V.value));return join$1(W,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var URLSearchParamsConstructor=function(){anInstance$1(this,URLSearchParamsPrototype$3);var W=arguments.length>0?arguments[0]:void 0,X=setInternalState$1(this,new URLSearchParamsState(W));DESCRIPTORS$2||(this.size=X.entries.length)},URLSearchParamsPrototype$3=URLSearchParamsConstructor.prototype;defineBuiltIns(URLSearchParamsPrototype$3,{append:function(W,X){var V=getInternalParamsState(this);validateArgumentsLength$4(arguments.length,2),push$2(V.entries,{key:$toString$1(W),value:$toString$1(X)}),DESCRIPTORS$2||this.length++,V.updateURL()},delete:function(G){for(var W=getInternalParamsState(this),X=validateArgumentsLength$4(arguments.length,1),V=W.entries,Z=$toString$1(G),re=X<2?void 0:arguments[1],se=re===void 0?re:$toString$1(re),ue=0;ue<V.length;){var H=V[ue];if(H.key===Z&&(se===void 0||H.value===se)){if(splice$1(V,ue,1),se!==void 0)break}else ue++}DESCRIPTORS$2||(this.size=V.length),W.updateURL()},get:function(W){var X=getInternalParamsState(this).entries;validateArgumentsLength$4(arguments.length,1);for(var V=$toString$1(W),Z=0;Z<X.length;Z++)if(X[Z].key===V)return X[Z].value;return null},getAll:function(W){var X=getInternalParamsState(this).entries;validateArgumentsLength$4(arguments.length,1);for(var V=$toString$1(W),Z=[],re=0;re<X.length;re++)X[re].key===V&&push$2(Z,X[re].value);return Z},has:function(W){for(var X=getInternalParamsState(this).entries,V=validateArgumentsLength$4(arguments.length,1),Z=$toString$1(W),re=V<2?void 0:arguments[1],se=re===void 0?re:$toString$1(re),ue=0;ue<X.length;){var H=X[ue++];if(H.key===Z&&(se===void 0||H.value===se))return!0}return!1},set:function(W,X){var V=getInternalParamsState(this);validateArgumentsLength$4(arguments.length,1);for(var Z=V.entries,re=!1,se=$toString$1(W),ue=$toString$1(X),H=0,ye;H<Z.length;H++)ye=Z[H],ye.key===se&&(re?splice$1(Z,H--,1):(re=!0,ye.value=ue));re||push$2(Z,{key:se,value:ue}),DESCRIPTORS$2||(this.size=Z.length),V.updateURL()},sort:function(){var W=getInternalParamsState(this);arraySort(W.entries,function(X,V){return X.key>V.key?1:-1}),W.updateURL()},forEach:function(W){for(var X=getInternalParamsState(this).entries,V=bind$1(W,arguments.length>1?arguments[1]:void 0),Z=0,re;Z<X.length;)re=X[Z++],V(re.value,re.key,this)},keys:function(){return new URLSearchParamsIterator(this,"keys")},values:function(){return new URLSearchParamsIterator(this,"values")},entries:function(){return new URLSearchParamsIterator(this,"entries")}},{enumerable:!0});defineBuiltIn$3(URLSearchParamsPrototype$3,ITERATOR,URLSearchParamsPrototype$3.entries,{name:"entries"});defineBuiltIn$3(URLSearchParamsPrototype$3,"toString",function(){return getInternalParamsState(this).serialize()},{enumerable:!0});DESCRIPTORS$2&&defineBuiltInAccessor$2(URLSearchParamsPrototype$3,"size",{get:function(){return getInternalParamsState(this).entries.length},configurable:!0,enumerable:!0});setToStringTag$1(URLSearchParamsConstructor,URL_SEARCH_PARAMS);$$4({global:!0,constructor:!0,forced:!USE_NATIVE_URL$2},{URLSearchParams:URLSearchParamsConstructor});if(!USE_NATIVE_URL$2&&isCallable(Headers)){var headersHas=uncurryThis$4(HeadersPrototype.has),headersSet=uncurryThis$4(HeadersPrototype.set),wrapRequestOptions=function(G){if(isObject$6(G)){var W=G.body,X;if(classof(W)===URL_SEARCH_PARAMS)return X=G.headers?new Headers(G.headers):new Headers,headersHas(X,"content-type")||headersSet(X,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),create$2(G,{body:createPropertyDescriptor(0,$toString$1(W)),headers:createPropertyDescriptor(0,X)})}return G};if(isCallable(nativeFetch)&&$$4({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(W){return nativeFetch(W,arguments.length>1?wrapRequestOptions(arguments[1]):{})}}),isCallable(NativeRequest)){var RequestConstructor=function(W){return anInstance$1(this,RequestPrototype),new NativeRequest(W,arguments.length>1?wrapRequestOptions(arguments[1]):{})};RequestPrototype.constructor=RequestConstructor,RequestConstructor.prototype=RequestPrototype,$$4({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:RequestConstructor})}}var web_urlSearchParams_constructor={URLSearchParams:URLSearchParamsConstructor,getState:getInternalParamsState},$$3=_export,DESCRIPTORS$1=descriptors,USE_NATIVE_URL$1=urlConstructorDetection,global$1=global$10,bind=functionBindContext,uncurryThis$3=functionUncurryThis,defineBuiltIn$2=defineBuiltIn$o,defineBuiltInAccessor$1=defineBuiltInAccessor$i,anInstance=anInstance$a,hasOwn$1=hasOwnProperty_1,assign=objectAssign,arrayFrom=arrayFrom$1,arraySlice=arraySlice$a,codeAt=stringMultibyte.codeAt,toASCII=stringPunycodeToAscii,$toString=toString$E,setToStringTag=setToStringTag$e,validateArgumentsLength$3=validateArgumentsLength$b,URLSearchParamsModule=web_urlSearchParams_constructor,InternalStateModule=internalState,setInternalState=InternalStateModule.set,getInternalURLState=InternalStateModule.getterFor("URL"),URLSearchParams$1=URLSearchParamsModule.URLSearchParams,getInternalSearchParamsState=URLSearchParamsModule.getState,NativeURL=global$1.URL,TypeError$1=global$1.TypeError,parseInt$1=global$1.parseInt,floor=Math.floor,pow=Math.pow,charAt=uncurryThis$3("".charAt),exec=uncurryThis$3(/./.exec),join=uncurryThis$3([].join),numberToString=uncurryThis$3(1 .toString),pop=uncurryThis$3([].pop),push$1=uncurryThis$3([].push),replace=uncurryThis$3("".replace),shift=uncurryThis$3([].shift),split=uncurryThis$3("".split),stringSlice=uncurryThis$3("".slice),toLowerCase=uncurryThis$3("".toLowerCase),unshift=uncurryThis$3([].unshift),INVALID_AUTHORITY="Invalid authority",INVALID_SCHEME="Invalid scheme",INVALID_HOST="Invalid host",INVALID_PORT="Invalid port",ALPHA=/[a-z]/i,ALPHANUMERIC=/[\d+-.a-z]/i,DIGIT=/\d/,HEX_START=/^0x/i,OCT=/^[0-7]+$/,DEC=/^\d+$/,HEX=/^[\da-f]+$/i,FORBIDDEN_HOST_CODE_POINT=/[\0\t\n\r #%/:<>?@[\\\]^|]/,FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT=/[\0\t\n\r #/:<>?@[\\\]^|]/,LEADING_C0_CONTROL_OR_SPACE=/^[\u0000-\u0020]+/,TRAILING_C0_CONTROL_OR_SPACE=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,TAB_AND_NEW_LINE=/[\t\n\r]/g,EOF,parseIPv4=function(G){var W=split(G,"."),X,V,Z,re,se,ue,H;if(W.length&&W[W.length-1]===""&&W.length--,X=W.length,X>4)return G;for(V=[],Z=0;Z<X;Z++){if(re=W[Z],re==="")return G;if(se=10,re.length>1&&charAt(re,0)==="0"&&(se=exec(HEX_START,re)?16:8,re=stringSlice(re,se===8?1:2)),re==="")ue=0;else{if(!exec(se===10?DEC:se===8?OCT:HEX,re))return G;ue=parseInt$1(re,se)}push$1(V,ue)}for(Z=0;Z<X;Z++)if(ue=V[Z],Z===X-1){if(ue>=pow(256,5-X))return null}else if(ue>255)return null;for(H=pop(V),Z=0;Z<V.length;Z++)H+=V[Z]*pow(256,3-Z);return H},parseIPv6=function(G){var W=[0,0,0,0,0,0,0,0],X=0,V=null,Z=0,re,se,ue,H,ye,Ie,Ee,Fe=function(){return charAt(G,Z)};if(Fe()===":"){if(charAt(G,1)!==":")return;Z+=2,X++,V=X}for(;Fe();){if(X===8)return;if(Fe()===":"){if(V!==null)return;Z++,X++,V=X;continue}for(re=se=0;se<4&&exec(HEX,Fe());)re=re*16+parseInt$1(Fe(),16),Z++,se++;if(Fe()==="."){if(se===0||(Z-=se,X>6))return;for(ue=0;Fe();){if(H=null,ue>0)if(Fe()==="."&&ue<4)Z++;else return;if(!exec(DIGIT,Fe()))return;for(;exec(DIGIT,Fe());){if(ye=parseInt$1(Fe(),10),H===null)H=ye;else{if(H===0)return;H=H*10+ye}if(H>255)return;Z++}W[X]=W[X]*256+H,ue++,(ue===2||ue===4)&&X++}if(ue!==4)return;break}else if(Fe()===":"){if(Z++,!Fe())return}else if(Fe())return;W[X++]=re}if(V!==null)for(Ie=X-V,X=7;X!==0&&Ie>0;)Ee=W[X],W[X--]=W[V+Ie-1],W[V+--Ie]=Ee;else if(X!==8)return;return W},findLongestZeroSequence=function(G){for(var W=null,X=1,V=null,Z=0,re=0;re<8;re++)G[re]!==0?(Z>X&&(W=V,X=Z),V=null,Z=0):(V===null&&(V=re),++Z);return Z>X&&(W=V,X=Z),W},serializeHost=function(G){var W,X,V,Z;if(typeof G=="number"){for(W=[],X=0;X<4;X++)unshift(W,G%256),G=floor(G/256);return join(W,".")}else if(typeof G=="object"){for(W="",V=findLongestZeroSequence(G),X=0;X<8;X++)Z&&G[X]===0||(Z&&(Z=!1),V===X?(W+=X?":":"::",Z=!0):(W+=numberToString(G[X],16),X<7&&(W+=":")));return"["+W+"]"}return G},C0ControlPercentEncodeSet={},fragmentPercentEncodeSet=assign({},C0ControlPercentEncodeSet,{" ":1,'"':1,"<":1,">":1,"`":1}),pathPercentEncodeSet=assign({},fragmentPercentEncodeSet,{"#":1,"?":1,"{":1,"}":1}),userinfoPercentEncodeSet=assign({},pathPercentEncodeSet,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),percentEncode=function(G,W){var X=codeAt(G,0);return X>32&&X<127&&!hasOwn$1(W,G)?G:encodeURIComponent(G)},specialSchemes={ftp:21,file:null,http:80,https:443,ws:80,wss:443},isWindowsDriveLetter=function(G,W){var X;return G.length===2&&exec(ALPHA,charAt(G,0))&&((X=charAt(G,1))===":"||!W&&X==="|")},startsWithWindowsDriveLetter=function(G){var W;return G.length>1&&isWindowsDriveLetter(stringSlice(G,0,2))&&(G.length===2||(W=charAt(G,2))==="/"||W==="\\"||W==="?"||W==="#")},isSingleDot=function(G){return G==="."||toLowerCase(G)==="%2e"},isDoubleDot=function(G){return G=toLowerCase(G),G===".."||G==="%2e."||G===".%2e"||G==="%2e%2e"},SCHEME_START={},SCHEME={},NO_SCHEME={},SPECIAL_RELATIVE_OR_AUTHORITY={},PATH_OR_AUTHORITY={},RELATIVE={},RELATIVE_SLASH={},SPECIAL_AUTHORITY_SLASHES={},SPECIAL_AUTHORITY_IGNORE_SLASHES={},AUTHORITY={},HOST={},HOSTNAME={},PORT={},FILE={},FILE_SLASH={},FILE_HOST={},PATH_START={},PATH={},CANNOT_BE_A_BASE_URL_PATH={},QUERY={},FRAGMENT={},URLState=function(G,W,X){var V=$toString(G),Z,re,se;if(W){if(re=this.parse(V),re)throw new TypeError$1(re);this.searchParams=null}else{if(X!==void 0&&(Z=new URLState(X,!0)),re=this.parse(V,null,Z),re)throw new TypeError$1(re);se=getInternalSearchParamsState(new URLSearchParams$1),se.bindURL(this),this.searchParams=se}};URLState.prototype={type:"URL",parse:function(G,W,X){var V=this,Z=W||SCHEME_START,re=0,se="",ue=!1,H=!1,ye=!1,Ie,Ee,Fe,je;for(G=$toString(G),W||(V.scheme="",V.username="",V.password="",V.host=null,V.port=null,V.path=[],V.query=null,V.fragment=null,V.cannotBeABaseURL=!1,G=replace(G,LEADING_C0_CONTROL_OR_SPACE,""),G=replace(G,TRAILING_C0_CONTROL_OR_SPACE,"$1")),G=replace(G,TAB_AND_NEW_LINE,""),Ie=arrayFrom(G);re<=Ie.length;){switch(Ee=Ie[re],Z){case SCHEME_START:if(Ee&&exec(ALPHA,Ee))se+=toLowerCase(Ee),Z=SCHEME;else{if(W)return INVALID_SCHEME;Z=NO_SCHEME;continue}break;case SCHEME:if(Ee&&(exec(ALPHANUMERIC,Ee)||Ee==="+"||Ee==="-"||Ee==="."))se+=toLowerCase(Ee);else if(Ee===":"){if(W&&(V.isSpecial()!==hasOwn$1(specialSchemes,se)||se==="file"&&(V.includesCredentials()||V.port!==null)||V.scheme==="file"&&!V.host))return;if(V.scheme=se,W){V.isSpecial()&&specialSchemes[V.scheme]===V.port&&(V.port=null);return}se="",V.scheme==="file"?Z=FILE:V.isSpecial()&&X&&X.scheme===V.scheme?Z=SPECIAL_RELATIVE_OR_AUTHORITY:V.isSpecial()?Z=SPECIAL_AUTHORITY_SLASHES:Ie[re+1]==="/"?(Z=PATH_OR_AUTHORITY,re++):(V.cannotBeABaseURL=!0,push$1(V.path,""),Z=CANNOT_BE_A_BASE_URL_PATH)}else{if(W)return INVALID_SCHEME;se="",Z=NO_SCHEME,re=0;continue}break;case NO_SCHEME:if(!X||X.cannotBeABaseURL&&Ee!=="#")return INVALID_SCHEME;if(X.cannotBeABaseURL&&Ee==="#"){V.scheme=X.scheme,V.path=arraySlice(X.path),V.query=X.query,V.fragment="",V.cannotBeABaseURL=!0,Z=FRAGMENT;break}Z=X.scheme==="file"?FILE:RELATIVE;continue;case SPECIAL_RELATIVE_OR_AUTHORITY:if(Ee==="/"&&Ie[re+1]==="/")Z=SPECIAL_AUTHORITY_IGNORE_SLASHES,re++;else{Z=RELATIVE;continue}break;case PATH_OR_AUTHORITY:if(Ee==="/"){Z=AUTHORITY;break}else{Z=PATH;continue}case RELATIVE:if(V.scheme=X.scheme,Ee===EOF)V.username=X.username,V.password=X.password,V.host=X.host,V.port=X.port,V.path=arraySlice(X.path),V.query=X.query;else if(Ee==="/"||Ee==="\\"&&V.isSpecial())Z=RELATIVE_SLASH;else if(Ee==="?")V.username=X.username,V.password=X.password,V.host=X.host,V.port=X.port,V.path=arraySlice(X.path),V.query="",Z=QUERY;else if(Ee==="#")V.username=X.username,V.password=X.password,V.host=X.host,V.port=X.port,V.path=arraySlice(X.path),V.query=X.query,V.fragment="",Z=FRAGMENT;else{V.username=X.username,V.password=X.password,V.host=X.host,V.port=X.port,V.path=arraySlice(X.path),V.path.length--,Z=PATH;continue}break;case RELATIVE_SLASH:if(V.isSpecial()&&(Ee==="/"||Ee==="\\"))Z=SPECIAL_AUTHORITY_IGNORE_SLASHES;else if(Ee==="/")Z=AUTHORITY;else{V.username=X.username,V.password=X.password,V.host=X.host,V.port=X.port,Z=PATH;continue}break;case SPECIAL_AUTHORITY_SLASHES:if(Z=SPECIAL_AUTHORITY_IGNORE_SLASHES,Ee!=="/"||charAt(se,re+1)!=="/")continue;re++;break;case SPECIAL_AUTHORITY_IGNORE_SLASHES:if(Ee!=="/"&&Ee!=="\\"){Z=AUTHORITY;continue}break;case AUTHORITY:if(Ee==="@"){ue&&(se="%40"+se),ue=!0,Fe=arrayFrom(se);for(var mt=0;mt<Fe.length;mt++){var wt=Fe[mt];if(wt===":"&&!ye){ye=!0;continue}var Ot=percentEncode(wt,userinfoPercentEncodeSet);ye?V.password+=Ot:V.username+=Ot}se=""}else if(Ee===EOF||Ee==="/"||Ee==="?"||Ee==="#"||Ee==="\\"&&V.isSpecial()){if(ue&&se==="")return INVALID_AUTHORITY;re-=arrayFrom(se).length+1,se="",Z=HOST}else se+=Ee;break;case HOST:case HOSTNAME:if(W&&V.scheme==="file"){Z=FILE_HOST;continue}else if(Ee===":"&&!H){if(se==="")return INVALID_HOST;if(je=V.parseHost(se),je)return je;if(se="",Z=PORT,W===HOSTNAME)return}else if(Ee===EOF||Ee==="/"||Ee==="?"||Ee==="#"||Ee==="\\"&&V.isSpecial()){if(V.isSpecial()&&se==="")return INVALID_HOST;if(W&&se===""&&(V.includesCredentials()||V.port!==null))return;if(je=V.parseHost(se),je)return je;if(se="",Z=PATH_START,W)return;continue}else Ee==="["?H=!0:Ee==="]"&&(H=!1),se+=Ee;break;case PORT:if(exec(DIGIT,Ee))se+=Ee;else if(Ee===EOF||Ee==="/"||Ee==="?"||Ee==="#"||Ee==="\\"&&V.isSpecial()||W){if(se!==""){var $t=parseInt$1(se,10);if($t>65535)return INVALID_PORT;V.port=V.isSpecial()&&$t===specialSchemes[V.scheme]?null:$t,se=""}if(W)return;Z=PATH_START;continue}else return INVALID_PORT;break;case FILE:if(V.scheme="file",Ee==="/"||Ee==="\\")Z=FILE_SLASH;else if(X&&X.scheme==="file")switch(Ee){case EOF:V.host=X.host,V.path=arraySlice(X.path),V.query=X.query;break;case"?":V.host=X.host,V.path=arraySlice(X.path),V.query="",Z=QUERY;break;case"#":V.host=X.host,V.path=arraySlice(X.path),V.query=X.query,V.fragment="",Z=FRAGMENT;break;default:startsWithWindowsDriveLetter(join(arraySlice(Ie,re),""))||(V.host=X.host,V.path=arraySlice(X.path),V.shortenPath()),Z=PATH;continue}else{Z=PATH;continue}break;case FILE_SLASH:if(Ee==="/"||Ee==="\\"){Z=FILE_HOST;break}X&&X.scheme==="file"&&!startsWithWindowsDriveLetter(join(arraySlice(Ie,re),""))&&(isWindowsDriveLetter(X.path[0],!0)?push$1(V.path,X.path[0]):V.host=X.host),Z=PATH;continue;case FILE_HOST:if(Ee===EOF||Ee==="/"||Ee==="\\"||Ee==="?"||Ee==="#"){if(!W&&isWindowsDriveLetter(se))Z=PATH;else if(se===""){if(V.host="",W)return;Z=PATH_START}else{if(je=V.parseHost(se),je)return je;if(V.host==="localhost"&&(V.host=""),W)return;se="",Z=PATH_START}continue}else se+=Ee;break;case PATH_START:if(V.isSpecial()){if(Z=PATH,Ee!=="/"&&Ee!=="\\")continue}else if(!W&&Ee==="?")V.query="",Z=QUERY;else if(!W&&Ee==="#")V.fragment="",Z=FRAGMENT;else if(Ee!==EOF&&(Z=PATH,Ee!=="/"))continue;break;case PATH:if(Ee===EOF||Ee==="/"||Ee==="\\"&&V.isSpecial()||!W&&(Ee==="?"||Ee==="#")){if(isDoubleDot(se)?(V.shortenPath(),Ee!=="/"&&!(Ee==="\\"&&V.isSpecial())&&push$1(V.path,"")):isSingleDot(se)?Ee!=="/"&&!(Ee==="\\"&&V.isSpecial())&&push$1(V.path,""):(V.scheme==="file"&&!V.path.length&&isWindowsDriveLetter(se)&&(V.host&&(V.host=""),se=charAt(se,0)+":"),push$1(V.path,se)),se="",V.scheme==="file"&&(Ee===EOF||Ee==="?"||Ee==="#"))for(;V.path.length>1&&V.path[0]==="";)shift(V.path);Ee==="?"?(V.query="",Z=QUERY):Ee==="#"&&(V.fragment="",Z=FRAGMENT)}else se+=percentEncode(Ee,pathPercentEncodeSet);break;case CANNOT_BE_A_BASE_URL_PATH:Ee==="?"?(V.query="",Z=QUERY):Ee==="#"?(V.fragment="",Z=FRAGMENT):Ee!==EOF&&(V.path[0]+=percentEncode(Ee,C0ControlPercentEncodeSet));break;case QUERY:!W&&Ee==="#"?(V.fragment="",Z=FRAGMENT):Ee!==EOF&&(Ee==="'"&&V.isSpecial()?V.query+="%27":Ee==="#"?V.query+="%23":V.query+=percentEncode(Ee,C0ControlPercentEncodeSet));break;case FRAGMENT:Ee!==EOF&&(V.fragment+=percentEncode(Ee,fragmentPercentEncodeSet));break}re++}},parseHost:function(G){var W,X,V;if(charAt(G,0)==="["){if(charAt(G,G.length-1)!=="]"||(W=parseIPv6(stringSlice(G,1,-1)),!W))return INVALID_HOST;this.host=W}else if(this.isSpecial()){if(G=toASCII(G),exec(FORBIDDEN_HOST_CODE_POINT,G)||(W=parseIPv4(G),W===null))return INVALID_HOST;this.host=W}else{if(exec(FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT,G))return INVALID_HOST;for(W="",X=arrayFrom(G),V=0;V<X.length;V++)W+=percentEncode(X[V],C0ControlPercentEncodeSet);this.host=W}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return hasOwn$1(specialSchemes,this.scheme)},shortenPath:function(){var G=this.path,W=G.length;W&&(this.scheme!=="file"||W!==1||!isWindowsDriveLetter(G[0],!0))&&G.length--},serialize:function(){var G=this,W=G.scheme,X=G.username,V=G.password,Z=G.host,re=G.port,se=G.path,ue=G.query,H=G.fragment,ye=W+":";return Z!==null?(ye+="//",G.includesCredentials()&&(ye+=X+(V?":"+V:"")+"@"),ye+=serializeHost(Z),re!==null&&(ye+=":"+re)):W==="file"&&(ye+="//"),ye+=G.cannotBeABaseURL?se[0]:se.length?"/"+join(se,"/"):"",ue!==null&&(ye+="?"+ue),H!==null&&(ye+="#"+H),ye},setHref:function(G){var W=this.parse(G);if(W)throw new TypeError$1(W);this.searchParams.update()},getOrigin:function(){var G=this.scheme,W=this.port;if(G==="blob")try{return new URLConstructor(G.path[0]).origin}catch{return"null"}return G==="file"||!this.isSpecial()?"null":G+"://"+serializeHost(this.host)+(W!==null?":"+W:"")},getProtocol:function(){return this.scheme+":"},setProtocol:function(G){this.parse($toString(G)+":",SCHEME_START)},getUsername:function(){return this.username},setUsername:function(G){var W=arrayFrom($toString(G));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var X=0;X<W.length;X++)this.username+=percentEncode(W[X],userinfoPercentEncodeSet)}},getPassword:function(){return this.password},setPassword:function(G){var W=arrayFrom($toString(G));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var X=0;X<W.length;X++)this.password+=percentEncode(W[X],userinfoPercentEncodeSet)}},getHost:function(){var G=this.host,W=this.port;return G===null?"":W===null?serializeHost(G):serializeHost(G)+":"+W},setHost:function(G){this.cannotBeABaseURL||this.parse(G,HOST)},getHostname:function(){var G=this.host;return G===null?"":serializeHost(G)},setHostname:function(G){this.cannotBeABaseURL||this.parse(G,HOSTNAME)},getPort:function(){var G=this.port;return G===null?"":$toString(G)},setPort:function(G){this.cannotHaveUsernamePasswordPort()||(G=$toString(G),G===""?this.port=null:this.parse(G,PORT))},getPathname:function(){var G=this.path;return this.cannotBeABaseURL?G[0]:G.length?"/"+join(G,"/"):""},setPathname:function(G){this.cannotBeABaseURL||(this.path=[],this.parse(G,PATH_START))},getSearch:function(){var G=this.query;return G?"?"+G:""},setSearch:function(G){G=$toString(G),G===""?this.query=null:(charAt(G,0)==="?"&&(G=stringSlice(G,1)),this.query="",this.parse(G,QUERY)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var G=this.fragment;return G?"#"+G:""},setHash:function(G){if(G=$toString(G),G===""){this.fragment=null;return}charAt(G,0)==="#"&&(G=stringSlice(G,1)),this.fragment="",this.parse(G,FRAGMENT)},update:function(){this.query=this.searchParams.serialize()||null}};var URLConstructor=function(W){var X=anInstance(this,URLPrototype),V=validateArgumentsLength$3(arguments.length,1)>1?arguments[1]:void 0,Z=setInternalState(X,new URLState(W,!1,V));DESCRIPTORS$1||(X.href=Z.serialize(),X.origin=Z.getOrigin(),X.protocol=Z.getProtocol(),X.username=Z.getUsername(),X.password=Z.getPassword(),X.host=Z.getHost(),X.hostname=Z.getHostname(),X.port=Z.getPort(),X.pathname=Z.getPathname(),X.search=Z.getSearch(),X.searchParams=Z.getSearchParams(),X.hash=Z.getHash())},URLPrototype=URLConstructor.prototype,accessorDescriptor=function(G,W){return{get:function(){return getInternalURLState(this)[G]()},set:W&&function(X){return getInternalURLState(this)[W](X)},configurable:!0,enumerable:!0}};DESCRIPTORS$1&&(defineBuiltInAccessor$1(URLPrototype,"href",accessorDescriptor("serialize","setHref")),defineBuiltInAccessor$1(URLPrototype,"origin",accessorDescriptor("getOrigin")),defineBuiltInAccessor$1(URLPrototype,"protocol",accessorDescriptor("getProtocol","setProtocol")),defineBuiltInAccessor$1(URLPrototype,"username",accessorDescriptor("getUsername","setUsername")),defineBuiltInAccessor$1(URLPrototype,"password",accessorDescriptor("getPassword","setPassword")),defineBuiltInAccessor$1(URLPrototype,"host",accessorDescriptor("getHost","setHost")),defineBuiltInAccessor$1(URLPrototype,"hostname",accessorDescriptor("getHostname","setHostname")),defineBuiltInAccessor$1(URLPrototype,"port",accessorDescriptor("getPort","setPort")),defineBuiltInAccessor$1(URLPrototype,"pathname",accessorDescriptor("getPathname","setPathname")),defineBuiltInAccessor$1(URLPrototype,"search",accessorDescriptor("getSearch","setSearch")),defineBuiltInAccessor$1(URLPrototype,"searchParams",accessorDescriptor("getSearchParams")),defineBuiltInAccessor$1(URLPrototype,"hash",accessorDescriptor("getHash","setHash")));defineBuiltIn$2(URLPrototype,"toJSON",function(){return getInternalURLState(this).serialize()},{enumerable:!0});defineBuiltIn$2(URLPrototype,"toString",function(){return getInternalURLState(this).serialize()},{enumerable:!0});if(NativeURL){var nativeCreateObjectURL=NativeURL.createObjectURL,nativeRevokeObjectURL=NativeURL.revokeObjectURL;nativeCreateObjectURL&&defineBuiltIn$2(URLConstructor,"createObjectURL",bind(nativeCreateObjectURL,NativeURL)),nativeRevokeObjectURL&&defineBuiltIn$2(URLConstructor,"revokeObjectURL",bind(nativeRevokeObjectURL,NativeURL))}setToStringTag(URLConstructor,"URL");$$3({global:!0,constructor:!0,forced:!USE_NATIVE_URL$1,sham:!DESCRIPTORS$1},{URL:URLConstructor});var $$2=_export,getBuiltIn=getBuiltIn$p,fails=fails$1p,validateArgumentsLength$2=validateArgumentsLength$b,toString$4=toString$E,USE_NATIVE_URL=urlConstructorDetection,URL$1=getBuiltIn("URL"),THROWS_WITHOUT_ARGUMENTS=USE_NATIVE_URL&&fails(function(){URL$1.canParse()});$$2({target:"URL",stat:!0,forced:!THROWS_WITHOUT_ARGUMENTS},{canParse:function(W){var X=validateArgumentsLength$2(arguments.length,1),V=toString$4(W),Z=X<2||arguments[1]===void 0?void 0:toString$4(arguments[1]);try{return!!new URL$1(V,Z)}catch{return!1}}});var $$1=_export,call=functionCall;$$1({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return call(URL.prototype.toString,this)}});var defineBuiltIn$1=defineBuiltIn$o,uncurryThis$2=functionUncurryThis,toString$3=toString$E,validateArgumentsLength$1=validateArgumentsLength$b,$URLSearchParams$1=URLSearchParams,URLSearchParamsPrototype$2=$URLSearchParams$1.prototype,append=uncurryThis$2(URLSearchParamsPrototype$2.append),$delete=uncurryThis$2(URLSearchParamsPrototype$2.delete),forEach$1=uncurryThis$2(URLSearchParamsPrototype$2.forEach),push=uncurryThis$2([].push),params$1=new $URLSearchParams$1("a=1&a=2&b=3");params$1.delete("a",1);params$1.delete("b",void 0);params$1+""!="a=2"&&defineBuiltIn$1(URLSearchParamsPrototype$2,"delete",function(G){var W=arguments.length,X=W<2?void 0:arguments[1];if(W&&X===void 0)return $delete(this,G);var V=[];forEach$1(this,function(Ee,Fe){push(V,{key:Fe,value:Ee})}),validateArgumentsLength$1(W,1);for(var Z=toString$3(G),re=toString$3(X),se=0,ue=0,H=!1,ye=V.length,Ie;se<ye;)Ie=V[se++],H||Ie.key===Z?(H=!0,$delete(this,Ie.key)):ue++;for(;ue<ye;)Ie=V[ue++],Ie.key===Z&&Ie.value===re||append(this,Ie.key,Ie.value)},{enumerable:!0,unsafe:!0});var defineBuiltIn=defineBuiltIn$o,uncurryThis$1=functionUncurryThis,toString$2=toString$E,validateArgumentsLength=validateArgumentsLength$b,$URLSearchParams=URLSearchParams,URLSearchParamsPrototype$1=$URLSearchParams.prototype,getAll=uncurryThis$1(URLSearchParamsPrototype$1.getAll),$has=uncurryThis$1(URLSearchParamsPrototype$1.has),params=new $URLSearchParams("a=1");(params.has("a",2)||!params.has("a",void 0))&&defineBuiltIn(URLSearchParamsPrototype$1,"has",function(W){var X=arguments.length,V=X<2?void 0:arguments[1];if(X&&V===void 0)return $has(this,W);var Z=getAll(this,W);validateArgumentsLength(X,1);for(var re=toString$2(V),se=0;se<Z.length;)if(Z[se++]===re)return!0;return!1},{enumerable:!0,unsafe:!0});var DESCRIPTORS=descriptors,uncurryThis=functionUncurryThis,defineBuiltInAccessor=defineBuiltInAccessor$i,URLSearchParamsPrototype=URLSearchParams.prototype,forEach=uncurryThis(URLSearchParamsPrototype.forEach);DESCRIPTORS&&!("size"in URLSearchParamsPrototype)&&defineBuiltInAccessor(URLSearchParamsPrototype,"size",{get:function(){var W=0;return forEach(this,function(){W++}),W},configurable:!0,enumerable:!0});var runtime={exports:{}};(function(G){var W=function(X){var V=Object.prototype,Z=V.hasOwnProperty,re=Object.defineProperty||function(ht,Rt,It){ht[Rt]=It.value},se,ue=typeof Symbol=="function"?Symbol:{},H=ue.iterator||"@@iterator",ye=ue.asyncIterator||"@@asyncIterator",Ie=ue.toStringTag||"@@toStringTag";function Ee(ht,Rt,It){return Object.defineProperty(ht,Rt,{value:It,enumerable:!0,configurable:!0,writable:!0}),ht[Rt]}try{Ee({},"")}catch{Ee=function(Rt,It,Ht){return Rt[It]=Ht}}function Fe(ht,Rt,It,Ht){var ar=Rt&&Rt.prototype instanceof nr?Rt:nr,mr=Object.create(ar.prototype),Fr=new qi(Ht||[]);return re(mr,"_invoke",{value:Ti(ht,It,Fr)}),mr}X.wrap=Fe;function je(ht,Rt,It){try{return{type:"normal",arg:ht.call(Rt,It)}}catch(Ht){return{type:"throw",arg:Ht}}}var mt="suspendedStart",wt="suspendedYield",Ot="executing",$t="completed",jt={};function nr(){}function sr(){}function gr(){}var hr={};Ee(hr,H,function(){return this});var Ir=Object.getPrototypeOf,br=Ir&&Ir(Ir(xt([])));br&&br!==V&&Z.call(br,H)&&(hr=br);var yr=gr.prototype=nr.prototype=Object.create(hr);sr.prototype=gr,re(yr,"constructor",{value:gr,configurable:!0}),re(gr,"constructor",{value:sr,configurable:!0}),sr.displayName=Ee(gr,Ie,"GeneratorFunction");function zt(ht){["next","throw","return"].forEach(function(Rt){Ee(ht,Rt,function(It){return this._invoke(Rt,It)})})}X.isGeneratorFunction=function(ht){var Rt=typeof ht=="function"&&ht.constructor;return Rt?Rt===sr||(Rt.displayName||Rt.name)==="GeneratorFunction":!1},X.mark=function(ht){return Object.setPrototypeOf?Object.setPrototypeOf(ht,gr):(ht.__proto__=gr,Ee(ht,Ie,"GeneratorFunction")),ht.prototype=Object.create(yr),ht},X.awrap=function(ht){return{__await:ht}};function gi(ht,Rt){function It(mr,Fr,si,xi){var Xr=je(ht[mr],ht,Fr);if(Xr.type==="throw")xi(Xr.arg);else{var wn=Xr.arg,Yi=wn.value;return Yi&&typeof Yi=="object"&&Z.call(Yi,"__await")?Rt.resolve(Yi.__await).then(function(Ji){It("next",Ji,si,xi)},function(Ji){It("throw",Ji,si,xi)}):Rt.resolve(Yi).then(function(Ji){wn.value=Ji,si(wn)},function(Ji){return It("throw",Ji,si,xi)})}}var Ht;function ar(mr,Fr){function si(){return new Rt(function(xi,Xr){It(mr,Fr,xi,Xr)})}return Ht=Ht?Ht.then(si,si):si()}re(this,"_invoke",{value:ar})}zt(gi.prototype),Ee(gi.prototype,ye,function(){return this}),X.AsyncIterator=gi,X.async=function(ht,Rt,It,Ht,ar){ar===void 0&&(ar=Promise);var mr=new gi(Fe(ht,Rt,It,Ht),ar);return X.isGeneratorFunction(Rt)?mr:mr.next().then(function(Fr){return Fr.done?Fr.value:mr.next()})};function Ti(ht,Rt,It){var Ht=mt;return function(mr,Fr){if(Ht===Ot)throw new Error("Generator is already running");if(Ht===$t){if(mr==="throw")throw Fr;return Zt()}for(It.method=mr,It.arg=Fr;;){var si=It.delegate;if(si){var xi=dr(si,It);if(xi){if(xi===jt)continue;return xi}}if(It.method==="next")It.sent=It._sent=It.arg;else if(It.method==="throw"){if(Ht===mt)throw Ht=$t,It.arg;It.dispatchException(It.arg)}else It.method==="return"&&It.abrupt("return",It.arg);Ht=Ot;var Xr=je(ht,Rt,It);if(Xr.type==="normal"){if(Ht=It.done?$t:wt,Xr.arg===jt)continue;return{value:Xr.arg,done:It.done}}else Xr.type==="throw"&&(Ht=$t,It.method="throw",It.arg=Xr.arg)}}}function dr(ht,Rt){var It=Rt.method,Ht=ht.iterator[It];if(Ht===se)return Rt.delegate=null,It==="throw"&&ht.iterator.return&&(Rt.method="return",Rt.arg=se,dr(ht,Rt),Rt.method==="throw")||It!=="return"&&(Rt.method="throw",Rt.arg=new TypeError("The iterator does not provide a '"+It+"' method")),jt;var ar=je(Ht,ht.iterator,Rt.arg);if(ar.type==="throw")return Rt.method="throw",Rt.arg=ar.arg,Rt.delegate=null,jt;var mr=ar.arg;if(!mr)return Rt.method="throw",Rt.arg=new TypeError("iterator result is not an object"),Rt.delegate=null,jt;if(mr.done)Rt[ht.resultName]=mr.value,Rt.next=ht.nextLoc,Rt.method!=="return"&&(Rt.method="next",Rt.arg=se);else return mr;return Rt.delegate=null,jt}zt(yr),Ee(yr,Ie,"Generator"),Ee(yr,H,function(){return this}),Ee(yr,"toString",function(){return"[object Generator]"});function kr(ht){var Rt={tryLoc:ht[0]};1 in ht&&(Rt.catchLoc=ht[1]),2 in ht&&(Rt.finallyLoc=ht[2],Rt.afterLoc=ht[3]),this.tryEntries.push(Rt)}function un(ht){var Rt=ht.completion||{};Rt.type="normal",delete Rt.arg,ht.completion=Rt}function qi(ht){this.tryEntries=[{tryLoc:"root"}],ht.forEach(kr,this),this.reset(!0)}X.keys=function(ht){var Rt=Object(ht),It=[];for(var Ht in Rt)It.push(Ht);return It.reverse(),function ar(){for(;It.length;){var mr=It.pop();if(mr in Rt)return ar.value=mr,ar.done=!1,ar}return ar.done=!0,ar}};function xt(ht){if(ht!=null){var Rt=ht[H];if(Rt)return Rt.call(ht);if(typeof ht.next=="function")return ht;if(!isNaN(ht.length)){var It=-1,Ht=function ar(){for(;++It<ht.length;)if(Z.call(ht,It))return ar.value=ht[It],ar.done=!1,ar;return ar.value=se,ar.done=!0,ar};return Ht.next=Ht}}throw new TypeError(typeof ht+" is not iterable")}X.values=xt;function Zt(){return{value:se,done:!0}}return qi.prototype={constructor:qi,reset:function(ht){if(this.prev=0,this.next=0,this.sent=this._sent=se,this.done=!1,this.delegate=null,this.method="next",this.arg=se,this.tryEntries.forEach(un),!ht)for(var Rt in this)Rt.charAt(0)==="t"&&Z.call(this,Rt)&&!isNaN(+Rt.slice(1))&&(this[Rt]=se)},stop:function(){this.done=!0;var ht=this.tryEntries[0],Rt=ht.completion;if(Rt.type==="throw")throw Rt.arg;return this.rval},dispatchException:function(ht){if(this.done)throw ht;var Rt=this;function It(xi,Xr){return mr.type="throw",mr.arg=ht,Rt.next=xi,Xr&&(Rt.method="next",Rt.arg=se),!!Xr}for(var Ht=this.tryEntries.length-1;Ht>=0;--Ht){var ar=this.tryEntries[Ht],mr=ar.completion;if(ar.tryLoc==="root")return It("end");if(ar.tryLoc<=this.prev){var Fr=Z.call(ar,"catchLoc"),si=Z.call(ar,"finallyLoc");if(Fr&&si){if(this.prev<ar.catchLoc)return It(ar.catchLoc,!0);if(this.prev<ar.finallyLoc)return It(ar.finallyLoc)}else if(Fr){if(this.prev<ar.catchLoc)return It(ar.catchLoc,!0)}else if(si){if(this.prev<ar.finallyLoc)return It(ar.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(ht,Rt){for(var It=this.tryEntries.length-1;It>=0;--It){var Ht=this.tryEntries[It];if(Ht.tryLoc<=this.prev&&Z.call(Ht,"finallyLoc")&&this.prev<Ht.finallyLoc){var ar=Ht;break}}ar&&(ht==="break"||ht==="continue")&&ar.tryLoc<=Rt&&Rt<=ar.finallyLoc&&(ar=null);var mr=ar?ar.completion:{};return mr.type=ht,mr.arg=Rt,ar?(this.method="next",this.next=ar.finallyLoc,jt):this.complete(mr)},complete:function(ht,Rt){if(ht.type==="throw")throw ht.arg;return ht.type==="break"||ht.type==="continue"?this.next=ht.arg:ht.type==="return"?(this.rval=this.arg=ht.arg,this.method="return",this.next="end"):ht.type==="normal"&&Rt&&(this.next=Rt),jt},finish:function(ht){for(var Rt=this.tryEntries.length-1;Rt>=0;--Rt){var It=this.tryEntries[Rt];if(It.finallyLoc===ht)return this.complete(It.completion,It.afterLoc),un(It),jt}},catch:function(ht){for(var Rt=this.tryEntries.length-1;Rt>=0;--Rt){var It=this.tryEntries[Rt];if(It.tryLoc===ht){var Ht=It.completion;if(Ht.type==="throw"){var ar=Ht.arg;un(It)}return ar}}throw new Error("illegal catch attempt")},delegateYield:function(ht,Rt,It){return this.delegate={iterator:xt(ht),resultName:Rt,nextLoc:It},this.method==="next"&&(this.arg=se),jt}},X}(G.exports);try{regeneratorRuntime=W}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=W:Function("r","regeneratorRuntime = r")(W)}})(runtime);var events={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function(W,X,V){return Function.prototype.apply.call(W,X,V)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(W){return Object.getOwnPropertyNames(W).concat(Object.getOwnPropertySymbols(W))}:ReflectOwnKeys=function(W){return Object.getOwnPropertyNames(W)};function ProcessEmitWarning(G){console&&console.warn&&console.warn(G)}var NumberIsNaN=Number.isNaN||function(W){return W!==W};function EventEmitter$2(){EventEmitter$2.init.call(this)}events.exports=EventEmitter$2;events.exports.once=once;EventEmitter$2.EventEmitter=EventEmitter$2;EventEmitter$2.prototype._events=void 0;EventEmitter$2.prototype._eventsCount=0;EventEmitter$2.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(G){if(typeof G!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof G)}Object.defineProperty(EventEmitter$2,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(G){if(typeof G!="number"||G<0||NumberIsNaN(G))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+G+".");defaultMaxListeners=G}});EventEmitter$2.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$2.prototype.setMaxListeners=function(W){if(typeof W!="number"||W<0||NumberIsNaN(W))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+W+".");return this._maxListeners=W,this};function _getMaxListeners(G){return G._maxListeners===void 0?EventEmitter$2.defaultMaxListeners:G._maxListeners}EventEmitter$2.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter$2.prototype.emit=function(W){for(var X=[],V=1;V<arguments.length;V++)X.push(arguments[V]);var Z=W==="error",re=this._events;if(re!==void 0)Z=Z&&re.error===void 0;else if(!Z)return!1;if(Z){var se;if(X.length>0&&(se=X[0]),se instanceof Error)throw se;var ue=new Error("Unhandled error."+(se?" ("+se.message+")":""));throw ue.context=se,ue}var H=re[W];if(H===void 0)return!1;if(typeof H=="function")ReflectApply(H,this,X);else for(var ye=H.length,Ie=arrayClone(H,ye),V=0;V<ye;++V)ReflectApply(Ie[V],this,X);return!0};function _addListener(G,W,X,V){var Z,re,se;if(checkListener(X),re=G._events,re===void 0?(re=G._events=Object.create(null),G._eventsCount=0):(re.newListener!==void 0&&(G.emit("newListener",W,X.listener?X.listener:X),re=G._events),se=re[W]),se===void 0)se=re[W]=X,++G._eventsCount;else if(typeof se=="function"?se=re[W]=V?[X,se]:[se,X]:V?se.unshift(X):se.push(X),Z=_getMaxListeners(G),Z>0&&se.length>Z&&!se.warned){se.warned=!0;var ue=new Error("Possible EventEmitter memory leak detected. "+se.length+" "+String(W)+" listeners added. Use emitter.setMaxListeners() to increase limit");ue.name="MaxListenersExceededWarning",ue.emitter=G,ue.type=W,ue.count=se.length,ProcessEmitWarning(ue)}return G}EventEmitter$2.prototype.addListener=function(W,X){return _addListener(this,W,X,!1)};EventEmitter$2.prototype.on=EventEmitter$2.prototype.addListener;EventEmitter$2.prototype.prependListener=function(W,X){return _addListener(this,W,X,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(G,W,X){var V={fired:!1,wrapFn:void 0,target:G,type:W,listener:X},Z=onceWrapper.bind(V);return Z.listener=X,V.wrapFn=Z,Z}EventEmitter$2.prototype.once=function(W,X){return checkListener(X),this.on(W,_onceWrap(this,W,X)),this};EventEmitter$2.prototype.prependOnceListener=function(W,X){return checkListener(X),this.prependListener(W,_onceWrap(this,W,X)),this};EventEmitter$2.prototype.removeListener=function(W,X){var V,Z,re,se,ue;if(checkListener(X),Z=this._events,Z===void 0)return this;if(V=Z[W],V===void 0)return this;if(V===X||V.listener===X)--this._eventsCount===0?this._events=Object.create(null):(delete Z[W],Z.removeListener&&this.emit("removeListener",W,V.listener||X));else if(typeof V!="function"){for(re=-1,se=V.length-1;se>=0;se--)if(V[se]===X||V[se].listener===X){ue=V[se].listener,re=se;break}if(re<0)return this;re===0?V.shift():spliceOne(V,re),V.length===1&&(Z[W]=V[0]),Z.removeListener!==void 0&&this.emit("removeListener",W,ue||X)}return this};EventEmitter$2.prototype.off=EventEmitter$2.prototype.removeListener;EventEmitter$2.prototype.removeAllListeners=function(W){var X,V,Z;if(V=this._events,V===void 0)return this;if(V.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):V[W]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete V[W]),this;if(arguments.length===0){var re=Object.keys(V),se;for(Z=0;Z<re.length;++Z)se=re[Z],se!=="removeListener"&&this.removeAllListeners(se);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(X=V[W],typeof X=="function")this.removeListener(W,X);else if(X!==void 0)for(Z=X.length-1;Z>=0;Z--)this.removeListener(W,X[Z]);return this};function _listeners(G,W,X){var V=G._events;if(V===void 0)return[];var Z=V[W];return Z===void 0?[]:typeof Z=="function"?X?[Z.listener||Z]:[Z]:X?unwrapListeners(Z):arrayClone(Z,Z.length)}EventEmitter$2.prototype.listeners=function(W){return _listeners(this,W,!0)};EventEmitter$2.prototype.rawListeners=function(W){return _listeners(this,W,!1)};EventEmitter$2.listenerCount=function(G,W){return typeof G.listenerCount=="function"?G.listenerCount(W):listenerCount.call(G,W)};EventEmitter$2.prototype.listenerCount=listenerCount;function listenerCount(G){var W=this._events;if(W!==void 0){var X=W[G];if(typeof X=="function")return 1;if(X!==void 0)return X.length}return 0}EventEmitter$2.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(G,W){for(var X=new Array(W),V=0;V<W;++V)X[V]=G[V];return X}function spliceOne(G,W){for(;W+1<G.length;W++)G[W]=G[W+1];G.pop()}function unwrapListeners(G){for(var W=new Array(G.length),X=0;X<W.length;++X)W[X]=G[X].listener||G[X];return W}function once(G,W){return new Promise(function(X,V){function Z(se){G.removeListener(W,re),V(se)}function re(){typeof G.removeListener=="function"&&G.removeListener("error",Z),X([].slice.call(arguments))}eventTargetAgnosticAddListener(G,W,re,{once:!0}),W!=="error"&&addErrorHandlerIfEventEmitter(G,Z,{once:!0})})}function addErrorHandlerIfEventEmitter(G,W,X){typeof G.on=="function"&&eventTargetAgnosticAddListener(G,"error",W,X)}function eventTargetAgnosticAddListener(G,W,X,V){if(typeof G.on=="function")V.once?G.once(W,X):G.on(W,X);else if(typeof G.addEventListener=="function")G.addEventListener(W,function Z(re){V.once&&G.removeEventListener(W,Z),X(re)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof G)}var eventsExports=events.exports;const EventEmitter$3=getDefaultExportFromCjs(eventsExports);var n,l,u$1,i$1,o,r,f$1,c={},s$1=[],a=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,h$1=Array.isArray;function v(G,W){for(var X in W)G[X]=W[X];return G}function p(G){var W=G.parentNode;W&&W.removeChild(G)}function y$1(G,W,X){var V,Z,re,se={};for(re in W)re=="key"?V=W[re]:re=="ref"?Z=W[re]:se[re]=W[re];if(arguments.length>2&&(se.children=arguments.length>3?n.call(arguments,2):X),typeof G=="function"&&G.defaultProps!=null)for(re in G.defaultProps)se[re]===void 0&&(se[re]=G.defaultProps[re]);return d$1(G,se,V,Z,null)}function d$1(G,W,X,V,Z){var re={type:G,props:W,key:X,ref:V,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:Z??++u$1,__i:-1,__u:0};return Z==null&&l.vnode!=null&&l.vnode(re),re}function _(){return{current:null}}function g(G){return G.children}function b(G,W){this.props=G,this.context=W}function m$1(G,W){if(W==null)return G.__?m$1(G.__,G.__i+1):null;for(var X;W<G.__k.length;W++)if((X=G.__k[W])!=null&&X.__e!=null)return X.__e;return typeof G.type=="function"?m$1(G):null}function w$1(G,W,X){var V,Z=G.__v,re=Z.__e,se=G.__P;if(se)return(V=v({},Z)).__v=Z.__v+1,l.vnode&&l.vnode(V),M(se,V,Z,G.__n,se.ownerSVGElement!==void 0,32&Z.__u?[re]:null,W,re??m$1(Z),!!(32&Z.__u),X),V.__v=Z.__v,V.__.__k[V.__i]=V,V.__d=void 0,V.__e!=re&&k(V),V}function k(G){var W,X;if((G=G.__)!=null&&G.__c!=null){for(G.__e=G.__c.base=null,W=0;W<G.__k.length;W++)if((X=G.__k[W])!=null&&X.__e!=null){G.__e=G.__c.base=X.__e;break}return k(G)}}function x(G){(!G.__d&&(G.__d=!0)&&i$1.push(G)&&!C.__r++||o!==l.debounceRendering)&&((o=l.debounceRendering)||r)(C)}function C(){var G,W,X,V=[],Z=[];for(i$1.sort(f$1);G=i$1.shift();)G.__d&&(X=i$1.length,W=w$1(G,V,Z)||W,X===0||i$1.length>X?(j(V,W,Z),Z.length=V.length=0,W=void 0,i$1.sort(f$1)):W&&l.__c&&l.__c(W,s$1));W&&j(V,W,Z),C.__r=0}function P(G,W,X,V,Z,re,se,ue,H,ye,Ie){var Ee,Fe,je,mt,wt,Ot=V&&V.__k||s$1,$t=W.length;for(X.__d=H,S(X,W,Ot),H=X.__d,Ee=0;Ee<$t;Ee++)(je=X.__k[Ee])!=null&&typeof je!="boolean"&&typeof je!="function"&&(Fe=je.__i===-1?c:Ot[je.__i]||c,je.__i=Ee,M(G,je,Fe,Z,re,se,ue,H,ye,Ie),mt=je.__e,je.ref&&Fe.ref!=je.ref&&(Fe.ref&&N(Fe.ref,null,je),Ie.push(je.ref,je.__c||mt,je)),wt==null&&mt!=null&&(wt=mt),65536&je.__u||Fe.__k===je.__k?H=$(je,H,G):typeof je.type=="function"&&je.__d!==void 0?H=je.__d:mt&&(H=mt.nextSibling),je.__d=void 0,je.__u&=-196609);X.__d=H,X.__e=wt}function S(G,W,X){var V,Z,re,se,ue,H=W.length,ye=X.length,Ie=ye,Ee=0;for(G.__k=[],V=0;V<H;V++)se=V+Ee,(Z=G.__k[V]=(Z=W[V])==null||typeof Z=="boolean"||typeof Z=="function"?null:typeof Z=="string"||typeof Z=="number"||typeof Z=="bigint"||Z.constructor==String?d$1(null,Z,null,null,null):h$1(Z)?d$1(g,{children:Z},null,null,null):Z.constructor===void 0&&Z.__b>0?d$1(Z.type,Z.props,Z.key,Z.ref?Z.ref:null,Z.__v):Z)!=null?(Z.__=G,Z.__b=G.__b+1,ue=I(Z,X,se,Ie),Z.__i=ue,re=null,ue!==-1&&(Ie--,(re=X[ue])&&(re.__u|=131072)),re==null||re.__v===null?(ue==-1&&Ee--,typeof Z.type!="function"&&(Z.__u|=65536)):ue!==se&&(ue===se+1?Ee++:ue>se?Ie>H-se?Ee+=ue-se:Ee--:ue<se?ue==se-1&&(Ee=ue-se):Ee=0,ue!==V+Ee&&(Z.__u|=65536))):(re=X[se])&&re.key==null&&re.__e&&!(131072&re.__u)&&(re.__e==G.__d&&(G.__d=m$1(re)),O(re,re,!1),X[se]=null,Ie--);if(Ie)for(V=0;V<ye;V++)(re=X[V])!=null&&!(131072&re.__u)&&(re.__e==G.__d&&(G.__d=m$1(re)),O(re,re))}function $(G,W,X){var V,Z;if(typeof G.type=="function"){for(V=G.__k,Z=0;V&&Z<V.length;Z++)V[Z]&&(V[Z].__=G,W=$(V[Z],W,X));return W}G.__e!=W&&(X.insertBefore(G.__e,W||null),W=G.__e);do W=W&&W.nextSibling;while(W!=null&&W.nodeType===8);return W}function I(G,W,X,V){var Z=G.key,re=G.type,se=X-1,ue=X+1,H=W[X];if(H===null||H&&Z==H.key&&re===H.type&&!(131072&H.__u))return X;if(V>(H!=null&&!(131072&H.__u)?1:0))for(;se>=0||ue<W.length;){if(se>=0){if((H=W[se])&&!(131072&H.__u)&&Z==H.key&&re===H.type)return se;se--}if(ue<W.length){if((H=W[ue])&&!(131072&H.__u)&&Z==H.key&&re===H.type)return ue;ue++}}return-1}function T(G,W,X){W[0]==="-"?G.setProperty(W,X??""):G[W]=X==null?"":typeof X!="number"||a.test(W)?X:X+"px"}function A(G,W,X,V,Z){var re;e:if(W==="style")if(typeof X=="string")G.style.cssText=X;else{if(typeof V=="string"&&(G.style.cssText=V=""),V)for(W in V)X&&W in X||T(G.style,W,"");if(X)for(W in X)V&&X[W]===V[W]||T(G.style,W,X[W])}else if(W[0]==="o"&&W[1]==="n")re=W!==(W=W.replace(/(PointerCapture)$|Capture$/i,"$1")),W=W.toLowerCase()in G?W.toLowerCase().slice(2):W.slice(2),G.l||(G.l={}),G.l[W+re]=X,X?V?X.u=V.u:(X.u=Date.now(),G.addEventListener(W,re?L:D,re)):G.removeEventListener(W,re?L:D,re);else{if(Z)W=W.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(W!=="width"&&W!=="height"&&W!=="href"&&W!=="list"&&W!=="form"&&W!=="tabIndex"&&W!=="download"&&W!=="rowSpan"&&W!=="colSpan"&&W!=="role"&&W in G)try{G[W]=X??"";break e}catch{}typeof X=="function"||(X==null||X===!1&&W[4]!=="-"?G.removeAttribute(W):G.setAttribute(W,X))}}function D(G){if(this.l){var W=this.l[G.type+!1];if(G.t){if(G.t<=W.u)return}else G.t=Date.now();return W(l.event?l.event(G):G)}}function L(G){if(this.l)return this.l[G.type+!0](l.event?l.event(G):G)}function M(G,W,X,V,Z,re,se,ue,H,ye){var Ie,Ee,Fe,je,mt,wt,Ot,$t,jt,nr,sr,gr,hr,Ir,br,yr=W.type;if(W.constructor!==void 0)return null;128&X.__u&&(H=!!(32&X.__u),re=[ue=W.__e=X.__e]),(Ie=l.__b)&&Ie(W);e:if(typeof yr=="function")try{if($t=W.props,jt=(Ie=yr.contextType)&&V[Ie.__c],nr=Ie?jt?jt.props.value:Ie.__:V,X.__c?Ot=(Ee=W.__c=X.__c).__=Ee.__E:("prototype"in yr&&yr.prototype.render?W.__c=Ee=new yr($t,nr):(W.__c=Ee=new b($t,nr),Ee.constructor=yr,Ee.render=q),jt&&jt.sub(Ee),Ee.props=$t,Ee.state||(Ee.state={}),Ee.context=nr,Ee.__n=V,Fe=Ee.__d=!0,Ee.__h=[],Ee._sb=[]),Ee.__s==null&&(Ee.__s=Ee.state),yr.getDerivedStateFromProps!=null&&(Ee.__s==Ee.state&&(Ee.__s=v({},Ee.__s)),v(Ee.__s,yr.getDerivedStateFromProps($t,Ee.__s))),je=Ee.props,mt=Ee.state,Ee.__v=W,Fe)yr.getDerivedStateFromProps==null&&Ee.componentWillMount!=null&&Ee.componentWillMount(),Ee.componentDidMount!=null&&Ee.__h.push(Ee.componentDidMount);else{if(yr.getDerivedStateFromProps==null&&$t!==je&&Ee.componentWillReceiveProps!=null&&Ee.componentWillReceiveProps($t,nr),!Ee.__e&&(Ee.shouldComponentUpdate!=null&&Ee.shouldComponentUpdate($t,Ee.__s,nr)===!1||W.__v===X.__v)){for(W.__v!==X.__v&&(Ee.props=$t,Ee.state=Ee.__s,Ee.__d=!1),W.__e=X.__e,W.__k=X.__k,W.__k.forEach(function(zt){zt&&(zt.__=W)}),sr=0;sr<Ee._sb.length;sr++)Ee.__h.push(Ee._sb[sr]);Ee._sb=[],Ee.__h.length&&se.push(Ee);break e}Ee.componentWillUpdate!=null&&Ee.componentWillUpdate($t,Ee.__s,nr),Ee.componentDidUpdate!=null&&Ee.__h.push(function(){Ee.componentDidUpdate(je,mt,wt)})}if(Ee.context=nr,Ee.props=$t,Ee.__P=G,Ee.__e=!1,gr=l.__r,hr=0,"prototype"in yr&&yr.prototype.render){for(Ee.state=Ee.__s,Ee.__d=!1,gr&&gr(W),Ie=Ee.render(Ee.props,Ee.state,Ee.context),Ir=0;Ir<Ee._sb.length;Ir++)Ee.__h.push(Ee._sb[Ir]);Ee._sb=[]}else do Ee.__d=!1,gr&&gr(W),Ie=Ee.render(Ee.props,Ee.state,Ee.context),Ee.state=Ee.__s;while(Ee.__d&&++hr<25);Ee.state=Ee.__s,Ee.getChildContext!=null&&(V=v(v({},V),Ee.getChildContext())),Fe||Ee.getSnapshotBeforeUpdate==null||(wt=Ee.getSnapshotBeforeUpdate(je,mt)),P(G,h$1(br=Ie!=null&&Ie.type===g&&Ie.key==null?Ie.props.children:Ie)?br:[br],W,X,V,Z,re,se,ue,H,ye),Ee.base=W.__e,W.__u&=-161,Ee.__h.length&&se.push(Ee),Ot&&(Ee.__E=Ee.__=null)}catch(zt){W.__v=null,H||re!=null?(W.__e=ue,W.__u|=H?160:32,re[re.indexOf(ue)]=null):(W.__e=X.__e,W.__k=X.__k),l.__e(zt,W,X)}else re==null&&W.__v===X.__v?(W.__k=X.__k,W.__e=X.__e):W.__e=z(X.__e,W,X,V,Z,re,se,H,ye);(Ie=l.diffed)&&Ie(W)}function j(G,W,X){for(var V=0;V<X.length;V++)N(X[V],X[++V],X[++V]);l.__c&&l.__c(W,G),G.some(function(Z){try{G=Z.__h,Z.__h=[],G.some(function(re){re.call(Z)})}catch(re){l.__e(re,Z.__v)}})}function z(G,W,X,V,Z,re,se,ue,H){var ye,Ie,Ee,Fe,je,mt,wt,Ot=X.props,$t=W.props,jt=W.type;if(jt==="svg"&&(Z=!0),re!=null){for(ye=0;ye<re.length;ye++)if((je=re[ye])&&"setAttribute"in je==!!jt&&(jt?je.localName===jt:je.nodeType===3)){G=je,re[ye]=null;break}}if(G==null){if(jt===null)return document.createTextNode($t);G=Z?document.createElementNS("http://www.w3.org/2000/svg",jt):document.createElement(jt,$t.is&&$t),re=null,ue=!1}if(jt===null)Ot===$t||ue&&G.data===$t||(G.data=$t);else{if(re=re&&n.call(G.childNodes),Ot=X.props||c,!ue&&re!=null)for(Ot={},ye=0;ye<G.attributes.length;ye++)Ot[(je=G.attributes[ye]).name]=je.value;for(ye in Ot)je=Ot[ye],ye=="children"||(ye=="dangerouslySetInnerHTML"?Ee=je:ye==="key"||ye in $t||A(G,ye,null,je,Z));for(ye in $t)je=$t[ye],ye=="children"?Fe=je:ye=="dangerouslySetInnerHTML"?Ie=je:ye=="value"?mt=je:ye=="checked"?wt=je:ye==="key"||ue&&typeof je!="function"||Ot[ye]===je||A(G,ye,je,Ot[ye],Z);if(Ie)ue||Ee&&(Ie.__html===Ee.__html||Ie.__html===G.innerHTML)||(G.innerHTML=Ie.__html),W.__k=[];else if(Ee&&(G.innerHTML=""),P(G,h$1(Fe)?Fe:[Fe],W,X,V,Z&&jt!=="foreignObject",re,se,re?re[0]:X.__k&&m$1(X,0),ue,H),re!=null)for(ye=re.length;ye--;)re[ye]!=null&&p(re[ye]);ue||(ye="value",mt!==void 0&&(mt!==G[ye]||jt==="progress"&&!mt||jt==="option"&&mt!==Ot[ye])&&A(G,ye,mt,Ot[ye],!1),ye="checked",wt!==void 0&&wt!==G[ye]&&A(G,ye,wt,Ot[ye],!1))}return G}function N(G,W,X){try{typeof G=="function"?G(W):G.current=W}catch(V){l.__e(V,X)}}function O(G,W,X){var V,Z;if(l.unmount&&l.unmount(G),(V=G.ref)&&(V.current&&V.current!==G.__e||N(V,null,W)),(V=G.__c)!=null){if(V.componentWillUnmount)try{V.componentWillUnmount()}catch(re){l.__e(re,W)}V.base=V.__P=null,G.__c=void 0}if(V=G.__k)for(Z=0;Z<V.length;Z++)V[Z]&&O(V[Z],W,X||typeof G.type!="function");X||G.__e==null||p(G.__e),G.__=G.__e=G.__d=void 0}function q(G,W,X){return this.constructor(G,X)}function B(G,W,X){var V,Z,re,se;l.__&&l.__(G,W),Z=(V=typeof X=="function")?null:X&&X.__k||W.__k,re=[],se=[],M(W,G=(!V&&X||W).__k=y$1(g,null,[G]),Z||c,c,W.ownerSVGElement!==void 0,!V&&X?[X]:Z?null:W.firstChild?n.call(W.childNodes):null,re,!V&&X?X:Z?Z.__e:W.firstChild,V,se),G.__d=void 0,j(re,G,se)}n=s$1.slice,l={__e:function(G,W,X,V){for(var Z,re,se;W=W.__;)if((Z=W.__c)&&!Z.__)try{if((re=Z.constructor)&&re.getDerivedStateFromError!=null&&(Z.setState(re.getDerivedStateFromError(G)),se=Z.__d),Z.componentDidCatch!=null&&(Z.componentDidCatch(G,V||{}),se=Z.__d),se)return Z.__E=Z}catch(ue){G=ue}throw G}},u$1=0,b.prototype.setState=function(G,W){var X;X=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=v({},this.state),typeof G=="function"&&(G=G(v({},X),this.props)),G&&v(X,G),G!=null&&this.__v&&(W&&this._sb.push(W),x(this))},b.prototype.forceUpdate=function(G){this.__v&&(this.__e=!0,G&&this.__h.push(G),x(this))},b.prototype.render=g,i$1=[],r=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,f$1=function(G,W){return G.__v.__b-W.__v.__b},C.__r=0;const viewStore=(G,W)=>{G.view="log",W.on("view:set",X=>{X!==G.view&&(G.view=X,W.emit(W.STATE_CHANGE))})};function isObject$5(G){var W=typeof G;return G!=null&&(W=="object"||W=="function")}var isObject_1=isObject$5,freeGlobal$1=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root$4=freeGlobal||freeSelf||Function("return this")(),_root=root$4,root$3=_root,now$1=function(){return root$3.Date.now()},now_1=now$1,reWhitespace=/\s/;function trimmedEndIndex$1(G){for(var W=G.length;W--&&reWhitespace.test(G.charAt(W)););return W}var _trimmedEndIndex=trimmedEndIndex$1,trimmedEndIndex=_trimmedEndIndex,reTrimStart=/^\s+/;function baseTrim$1(G){return G&&G.slice(0,trimmedEndIndex(G)+1).replace(reTrimStart,"")}var _baseTrim=baseTrim$1,root$2=_root,Symbol$5=root$2.Symbol,_Symbol=Symbol$5,Symbol$4=_Symbol,objectProto$6=Object.prototype,hasOwnProperty$5=objectProto$6.hasOwnProperty,nativeObjectToString$1=objectProto$6.toString,symToStringTag$1=Symbol$4?Symbol$4.toStringTag:void 0;function getRawTag$1(G){var W=hasOwnProperty$5.call(G,symToStringTag$1),X=G[symToStringTag$1];try{G[symToStringTag$1]=void 0;var V=!0}catch{}var Z=nativeObjectToString$1.call(G);return V&&(W?G[symToStringTag$1]=X:delete G[symToStringTag$1]),Z}var _getRawTag=getRawTag$1,objectProto$5=Object.prototype,nativeObjectToString=objectProto$5.toString;function objectToString$2(G){return nativeObjectToString.call(G)}var _objectToString=objectToString$2,Symbol$3=_Symbol,getRawTag=_getRawTag,objectToString$1=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$3?Symbol$3.toStringTag:void 0;function baseGetTag$3(G){return G==null?G===void 0?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(G)?getRawTag(G):objectToString$1(G)}var _baseGetTag=baseGetTag$3;function isObjectLike$3(G){return G!=null&&typeof G=="object"}var isObjectLike_1=isObjectLike$3,baseGetTag$2=_baseGetTag,isObjectLike$2=isObjectLike_1,symbolTag="[object Symbol]";function isSymbol$5(G){return typeof G=="symbol"||isObjectLike$2(G)&&baseGetTag$2(G)==symbolTag}var isSymbol_1=isSymbol$5,baseTrim=_baseTrim,isObject$4=isObject_1,isSymbol$4=isSymbol_1,NAN=NaN,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber$1(G){if(typeof G=="number")return G;if(isSymbol$4(G))return NAN;if(isObject$4(G)){var W=typeof G.valueOf=="function"?G.valueOf():G;G=isObject$4(W)?W+"":W}if(typeof G!="string")return G===0?G:+G;G=baseTrim(G);var X=reIsBinary.test(G);return X||reIsOctal.test(G)?freeParseInt(G.slice(2),X?2:8):reIsBadHex.test(G)?NAN:+G}var toNumber_1=toNumber$1,isObject$3=isObject_1,now=now_1,toNumber=toNumber_1,FUNC_ERROR_TEXT$1="Expected a function",nativeMax$1=Math.max,nativeMin=Math.min;function debounce(G,W,X){var V,Z,re,se,ue,H,ye=0,Ie=!1,Ee=!1,Fe=!0;if(typeof G!="function")throw new TypeError(FUNC_ERROR_TEXT$1);W=toNumber(W)||0,isObject$3(X)&&(Ie=!!X.leading,Ee="maxWait"in X,re=Ee?nativeMax$1(toNumber(X.maxWait)||0,W):re,Fe="trailing"in X?!!X.trailing:Fe);function je(hr){var Ir=V,br=Z;return V=Z=void 0,ye=hr,se=G.apply(br,Ir),se}function mt(hr){return ye=hr,ue=setTimeout($t,W),Ie?je(hr):se}function wt(hr){var Ir=hr-H,br=hr-ye,yr=W-Ir;return Ee?nativeMin(yr,re-br):yr}function Ot(hr){var Ir=hr-H,br=hr-ye;return H===void 0||Ir>=W||Ir<0||Ee&&br>=re}function $t(){var hr=now();if(Ot(hr))return jt(hr);ue=setTimeout($t,wt(hr))}function jt(hr){return ue=void 0,Fe&&V?je(hr):(V=Z=void 0,se)}function nr(){ue!==void 0&&clearTimeout(ue),ye=0,V=H=Z=ue=void 0}function sr(){return ue===void 0?se:jt(now())}function gr(){var hr=now(),Ir=Ot(hr);if(V=arguments,Z=this,H=hr,Ir){if(ue===void 0)return mt(H);if(Ee)return clearTimeout(ue),ue=setTimeout($t,W),je(H)}return ue===void 0&&(ue=setTimeout($t,W)),se}return gr.cancel=nr,gr.flush=sr,gr}var debounce_1=debounce;const debounce$1=getDefaultExportFromCjs(debounce_1);/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var PARAM_REGEXP=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,QESC_REGEXP=/\\([\u000b\u0020-\u00ff])/g,TYPE_REGEXP=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,parse_1=parse$2;function parse$2(G){if(!G)throw new TypeError("argument string is required");var W=typeof G=="object"?getcontenttype(G):G;if(typeof W!="string")throw new TypeError("argument string is required to be a string");var X=W.indexOf(";"),V=X!==-1?W.slice(0,X).trim():W.trim();if(!TYPE_REGEXP.test(V))throw new TypeError("invalid media type");var Z=new ContentType(V.toLowerCase());if(X!==-1){var re,se,ue;for(PARAM_REGEXP.lastIndex=X;se=PARAM_REGEXP.exec(W);){if(se.index!==X)throw new TypeError("invalid parameter format");X+=se[0].length,re=se[1].toLowerCase(),ue=se[2],ue.charCodeAt(0)===34&&(ue=ue.slice(1,-1),ue.indexOf("\\")!==-1&&(ue=ue.replace(QESC_REGEXP,"$1"))),Z.parameters[re]=ue}if(X!==W.length)throw new TypeError("invalid parameter format")}return Z}function getcontenttype(G){var W;if(typeof G.getHeader=="function"?W=G.getHeader("content-type"):typeof G.headers=="object"&&(W=G.headers&&G.headers["content-type"]),typeof W!="string")throw new TypeError("content-type header is missing from object");return W}function ContentType(G){this.parameters=Object.create(null),this.type=G}var buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup[45]=62;revLookup[95]=63;function getLens(G){var W=G.length;if(W%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var X=G.indexOf("=");X===-1&&(X=W);var V=X===W?0:4-X%4;return[X,V]}function byteLength(G){var W=getLens(G),X=W[0],V=W[1];return(X+V)*3/4-V}function _byteLength(G,W,X){return(W+X)*3/4-X}function toByteArray(G){var W,X=getLens(G),V=X[0],Z=X[1],re=new Arr(_byteLength(G,V,Z)),se=0,ue=Z>0?V-4:V,H;for(H=0;H<ue;H+=4)W=revLookup[G.charCodeAt(H)]<<18|revLookup[G.charCodeAt(H+1)]<<12|revLookup[G.charCodeAt(H+2)]<<6|revLookup[G.charCodeAt(H+3)],re[se++]=W>>16&255,re[se++]=W>>8&255,re[se++]=W&255;return Z===2&&(W=revLookup[G.charCodeAt(H)]<<2|revLookup[G.charCodeAt(H+1)]>>4,re[se++]=W&255),Z===1&&(W=revLookup[G.charCodeAt(H)]<<10|revLookup[G.charCodeAt(H+1)]<<4|revLookup[G.charCodeAt(H+2)]>>2,re[se++]=W>>8&255,re[se++]=W&255),re}function tripletToBase64(G){return lookup[G>>18&63]+lookup[G>>12&63]+lookup[G>>6&63]+lookup[G&63]}function encodeChunk(G,W,X){for(var V,Z=[],re=W;re<X;re+=3)V=(G[re]<<16&16711680)+(G[re+1]<<8&65280)+(G[re+2]&255),Z.push(tripletToBase64(V));return Z.join("")}function fromByteArray(G){for(var W,X=G.length,V=X%3,Z=[],re=16383,se=0,ue=X-V;se<ue;se+=re)Z.push(encodeChunk(G,se,se+re>ue?ue:se+re));return V===1?(W=G[X-1],Z.push(lookup[W>>2]+lookup[W<<4&63]+"==")):V===2&&(W=(G[X-2]<<8)+G[X-1],Z.push(lookup[W>>10]+lookup[W>>4&63]+lookup[W<<2&63]+"=")),Z.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(G,W,X,V,Z){var re,se,ue=Z*8-V-1,H=(1<<ue)-1,ye=H>>1,Ie=-7,Ee=X?Z-1:0,Fe=X?-1:1,je=G[W+Ee];for(Ee+=Fe,re=je&(1<<-Ie)-1,je>>=-Ie,Ie+=ue;Ie>0;re=re*256+G[W+Ee],Ee+=Fe,Ie-=8);for(se=re&(1<<-Ie)-1,re>>=-Ie,Ie+=V;Ie>0;se=se*256+G[W+Ee],Ee+=Fe,Ie-=8);if(re===0)re=1-ye;else{if(re===H)return se?NaN:(je?-1:1)*(1/0);se=se+Math.pow(2,V),re=re-ye}return(je?-1:1)*se*Math.pow(2,re-V)};ieee754.write=function(G,W,X,V,Z,re){var se,ue,H,ye=re*8-Z-1,Ie=(1<<ye)-1,Ee=Ie>>1,Fe=Z===23?Math.pow(2,-24)-Math.pow(2,-77):0,je=V?0:re-1,mt=V?1:-1,wt=W<0||W===0&&1/W<0?1:0;for(W=Math.abs(W),isNaN(W)||W===1/0?(ue=isNaN(W)?1:0,se=Ie):(se=Math.floor(Math.log(W)/Math.LN2),W*(H=Math.pow(2,-se))<1&&(se--,H*=2),se+Ee>=1?W+=Fe/H:W+=Fe*Math.pow(2,1-Ee),W*H>=2&&(se++,H/=2),se+Ee>=Ie?(ue=0,se=Ie):se+Ee>=1?(ue=(W*H-1)*Math.pow(2,Z),se=se+Ee):(ue=W*Math.pow(2,Ee-1)*Math.pow(2,Z),se=0));Z>=8;G[X+je]=ue&255,je+=mt,ue/=256,Z-=8);for(se=se<<Z|ue,ye+=Z;ye>0;G[X+je]=se&255,je+=mt,se/=256,ye-=8);G[X+je-mt]|=wt*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(G){const W=base64Js,X=ieee754,V=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;G.Buffer=ue,G.SlowBuffer=jt,G.INSPECT_MAX_BYTES=50;const Z=2147483647;G.kMaxLength=Z,ue.TYPED_ARRAY_SUPPORT=re(),!ue.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function re(){try{const Me=new Uint8Array(1),$e={foo:function(){return 42}};return Object.setPrototypeOf($e,Uint8Array.prototype),Object.setPrototypeOf(Me,$e),Me.foo()===42}catch{return!1}}Object.defineProperty(ue.prototype,"parent",{enumerable:!0,get:function(){if(ue.isBuffer(this))return this.buffer}}),Object.defineProperty(ue.prototype,"offset",{enumerable:!0,get:function(){if(ue.isBuffer(this))return this.byteOffset}});function se(Me){if(Me>Z)throw new RangeError('The value "'+Me+'" is invalid for option "size"');const $e=new Uint8Array(Me);return Object.setPrototypeOf($e,ue.prototype),$e}function ue(Me,$e,be){if(typeof Me=="number"){if(typeof $e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Ee(Me)}return H(Me,$e,be)}ue.poolSize=8192;function H(Me,$e,be){if(typeof Me=="string")return Fe(Me,$e);if(ArrayBuffer.isView(Me))return mt(Me);if(Me==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Me);if(Hi(Me,ArrayBuffer)||Me&&Hi(Me.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Hi(Me,SharedArrayBuffer)||Me&&Hi(Me.buffer,SharedArrayBuffer)))return wt(Me,$e,be);if(typeof Me=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const We=Me.valueOf&&Me.valueOf();if(We!=null&&We!==Me)return ue.from(We,$e,be);const ot=Ot(Me);if(ot)return ot;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Me[Symbol.toPrimitive]=="function")return ue.from(Me[Symbol.toPrimitive]("string"),$e,be);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Me)}ue.from=function(Me,$e,be){return H(Me,$e,be)},Object.setPrototypeOf(ue.prototype,Uint8Array.prototype),Object.setPrototypeOf(ue,Uint8Array);function ye(Me){if(typeof Me!="number")throw new TypeError('"size" argument must be of type number');if(Me<0)throw new RangeError('The value "'+Me+'" is invalid for option "size"')}function Ie(Me,$e,be){return ye(Me),Me<=0?se(Me):$e!==void 0?typeof be=="string"?se(Me).fill($e,be):se(Me).fill($e):se(Me)}ue.alloc=function(Me,$e,be){return Ie(Me,$e,be)};function Ee(Me){return ye(Me),se(Me<0?0:$t(Me)|0)}ue.allocUnsafe=function(Me){return Ee(Me)},ue.allocUnsafeSlow=function(Me){return Ee(Me)};function Fe(Me,$e){if((typeof $e!="string"||$e==="")&&($e="utf8"),!ue.isEncoding($e))throw new TypeError("Unknown encoding: "+$e);const be=nr(Me,$e)|0;let We=se(be);const ot=We.write(Me,$e);return ot!==be&&(We=We.slice(0,ot)),We}function je(Me){const $e=Me.length<0?0:$t(Me.length)|0,be=se($e);for(let We=0;We<$e;We+=1)be[We]=Me[We]&255;return be}function mt(Me){if(Hi(Me,Uint8Array)){const $e=new Uint8Array(Me);return wt($e.buffer,$e.byteOffset,$e.byteLength)}return je(Me)}function wt(Me,$e,be){if($e<0||Me.byteLength<$e)throw new RangeError('"offset" is outside of buffer bounds');if(Me.byteLength<$e+(be||0))throw new RangeError('"length" is outside of buffer bounds');let We;return $e===void 0&&be===void 0?We=new Uint8Array(Me):be===void 0?We=new Uint8Array(Me,$e):We=new Uint8Array(Me,$e,be),Object.setPrototypeOf(We,ue.prototype),We}function Ot(Me){if(ue.isBuffer(Me)){const $e=$t(Me.length)|0,be=se($e);return be.length===0||Me.copy(be,0,0,$e),be}if(Me.length!==void 0)return typeof Me.length!="number"||Qn(Me.length)?se(0):je(Me);if(Me.type==="Buffer"&&Array.isArray(Me.data))return je(Me.data)}function $t(Me){if(Me>=Z)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Z.toString(16)+" bytes");return Me|0}function jt(Me){return+Me!=Me&&(Me=0),ue.alloc(+Me)}ue.isBuffer=function($e){return $e!=null&&$e._isBuffer===!0&&$e!==ue.prototype},ue.compare=function($e,be){if(Hi($e,Uint8Array)&&($e=ue.from($e,$e.offset,$e.byteLength)),Hi(be,Uint8Array)&&(be=ue.from(be,be.offset,be.byteLength)),!ue.isBuffer($e)||!ue.isBuffer(be))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if($e===be)return 0;let We=$e.length,ot=be.length;for(let vt=0,Dt=Math.min(We,ot);vt<Dt;++vt)if($e[vt]!==be[vt]){We=$e[vt],ot=be[vt];break}return We<ot?-1:ot<We?1:0},ue.isEncoding=function($e){switch(String($e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},ue.concat=function($e,be){if(!Array.isArray($e))throw new TypeError('"list" argument must be an Array of Buffers');if($e.length===0)return ue.alloc(0);let We;if(be===void 0)for(be=0,We=0;We<$e.length;++We)be+=$e[We].length;const ot=ue.allocUnsafe(be);let vt=0;for(We=0;We<$e.length;++We){let Dt=$e[We];if(Hi(Dt,Uint8Array))vt+Dt.length>ot.length?(ue.isBuffer(Dt)||(Dt=ue.from(Dt)),Dt.copy(ot,vt)):Uint8Array.prototype.set.call(ot,Dt,vt);else if(ue.isBuffer(Dt))Dt.copy(ot,vt);else throw new TypeError('"list" argument must be an Array of Buffers');vt+=Dt.length}return ot};function nr(Me,$e){if(ue.isBuffer(Me))return Me.length;if(ArrayBuffer.isView(Me)||Hi(Me,ArrayBuffer))return Me.byteLength;if(typeof Me!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Me);const be=Me.length,We=arguments.length>2&&arguments[2]===!0;if(!We&&be===0)return 0;let ot=!1;for(;;)switch($e){case"ascii":case"latin1":case"binary":return be;case"utf8":case"utf-8":return Qi(Me).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return be*2;case"hex":return be>>>1;case"base64":return en(Me).length;default:if(ot)return We?-1:Qi(Me).length;$e=(""+$e).toLowerCase(),ot=!0}}ue.byteLength=nr;function sr(Me,$e,be){let We=!1;if(($e===void 0||$e<0)&&($e=0),$e>this.length||((be===void 0||be>this.length)&&(be=this.length),be<=0)||(be>>>=0,$e>>>=0,be<=$e))return"";for(Me||(Me="utf8");;)switch(Me){case"hex":return ht(this,$e,be);case"utf8":case"utf-8":return kr(this,$e,be);case"ascii":return xt(this,$e,be);case"latin1":case"binary":return Zt(this,$e,be);case"base64":return dr(this,$e,be);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Rt(this,$e,be);default:if(We)throw new TypeError("Unknown encoding: "+Me);Me=(Me+"").toLowerCase(),We=!0}}ue.prototype._isBuffer=!0;function gr(Me,$e,be){const We=Me[$e];Me[$e]=Me[be],Me[be]=We}ue.prototype.swap16=function(){const $e=this.length;if($e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let be=0;be<$e;be+=2)gr(this,be,be+1);return this},ue.prototype.swap32=function(){const $e=this.length;if($e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let be=0;be<$e;be+=4)gr(this,be,be+3),gr(this,be+1,be+2);return this},ue.prototype.swap64=function(){const $e=this.length;if($e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let be=0;be<$e;be+=8)gr(this,be,be+7),gr(this,be+1,be+6),gr(this,be+2,be+5),gr(this,be+3,be+4);return this},ue.prototype.toString=function(){const $e=this.length;return $e===0?"":arguments.length===0?kr(this,0,$e):sr.apply(this,arguments)},ue.prototype.toLocaleString=ue.prototype.toString,ue.prototype.equals=function($e){if(!ue.isBuffer($e))throw new TypeError("Argument must be a Buffer");return this===$e?!0:ue.compare(this,$e)===0},ue.prototype.inspect=function(){let $e="";const be=G.INSPECT_MAX_BYTES;return $e=this.toString("hex",0,be).replace(/(.{2})/g,"$1 ").trim(),this.length>be&&($e+=" ... "),"<Buffer "+$e+">"},V&&(ue.prototype[V]=ue.prototype.inspect),ue.prototype.compare=function($e,be,We,ot,vt){if(Hi($e,Uint8Array)&&($e=ue.from($e,$e.offset,$e.byteLength)),!ue.isBuffer($e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof $e);if(be===void 0&&(be=0),We===void 0&&(We=$e?$e.length:0),ot===void 0&&(ot=0),vt===void 0&&(vt=this.length),be<0||We>$e.length||ot<0||vt>this.length)throw new RangeError("out of range index");if(ot>=vt&&be>=We)return 0;if(ot>=vt)return-1;if(be>=We)return 1;if(be>>>=0,We>>>=0,ot>>>=0,vt>>>=0,this===$e)return 0;let Dt=vt-ot,Ar=We-be;const Yr=Math.min(Dt,Ar),Zr=this.slice(ot,vt),Jr=$e.slice(be,We);for(let Wr=0;Wr<Yr;++Wr)if(Zr[Wr]!==Jr[Wr]){Dt=Zr[Wr],Ar=Jr[Wr];break}return Dt<Ar?-1:Ar<Dt?1:0};function hr(Me,$e,be,We,ot){if(Me.length===0)return-1;if(typeof be=="string"?(We=be,be=0):be>2147483647?be=2147483647:be<-2147483648&&(be=-2147483648),be=+be,Qn(be)&&(be=ot?0:Me.length-1),be<0&&(be=Me.length+be),be>=Me.length){if(ot)return-1;be=Me.length-1}else if(be<0)if(ot)be=0;else return-1;if(typeof $e=="string"&&($e=ue.from($e,We)),ue.isBuffer($e))return $e.length===0?-1:Ir(Me,$e,be,We,ot);if(typeof $e=="number")return $e=$e&255,typeof Uint8Array.prototype.indexOf=="function"?ot?Uint8Array.prototype.indexOf.call(Me,$e,be):Uint8Array.prototype.lastIndexOf.call(Me,$e,be):Ir(Me,[$e],be,We,ot);throw new TypeError("val must be string, number or Buffer")}function Ir(Me,$e,be,We,ot){let vt=1,Dt=Me.length,Ar=$e.length;if(We!==void 0&&(We=String(We).toLowerCase(),We==="ucs2"||We==="ucs-2"||We==="utf16le"||We==="utf-16le")){if(Me.length<2||$e.length<2)return-1;vt=2,Dt/=2,Ar/=2,be/=2}function Yr(Jr,Wr){return vt===1?Jr[Wr]:Jr.readUInt16BE(Wr*vt)}let Zr;if(ot){let Jr=-1;for(Zr=be;Zr<Dt;Zr++)if(Yr(Me,Zr)===Yr($e,Jr===-1?0:Zr-Jr)){if(Jr===-1&&(Jr=Zr),Zr-Jr+1===Ar)return Jr*vt}else Jr!==-1&&(Zr-=Zr-Jr),Jr=-1}else for(be+Ar>Dt&&(be=Dt-Ar),Zr=be;Zr>=0;Zr--){let Jr=!0;for(let Wr=0;Wr<Ar;Wr++)if(Yr(Me,Zr+Wr)!==Yr($e,Wr)){Jr=!1;break}if(Jr)return Zr}return-1}ue.prototype.includes=function($e,be,We){return this.indexOf($e,be,We)!==-1},ue.prototype.indexOf=function($e,be,We){return hr(this,$e,be,We,!0)},ue.prototype.lastIndexOf=function($e,be,We){return hr(this,$e,be,We,!1)};function br(Me,$e,be,We){be=Number(be)||0;const ot=Me.length-be;We?(We=Number(We),We>ot&&(We=ot)):We=ot;const vt=$e.length;We>vt/2&&(We=vt/2);let Dt;for(Dt=0;Dt<We;++Dt){const Ar=parseInt($e.substr(Dt*2,2),16);if(Qn(Ar))return Dt;Me[be+Dt]=Ar}return Dt}function yr(Me,$e,be,We){return zn(Qi($e,Me.length-be),Me,be,We)}function zt(Me,$e,be,We){return zn(Yo($e),Me,be,We)}function gi(Me,$e,be,We){return zn(en($e),Me,be,We)}function Ti(Me,$e,be,We){return zn(Mn($e,Me.length-be),Me,be,We)}ue.prototype.write=function($e,be,We,ot){if(be===void 0)ot="utf8",We=this.length,be=0;else if(We===void 0&&typeof be=="string")ot=be,We=this.length,be=0;else if(isFinite(be))be=be>>>0,isFinite(We)?(We=We>>>0,ot===void 0&&(ot="utf8")):(ot=We,We=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const vt=this.length-be;if((We===void 0||We>vt)&&(We=vt),$e.length>0&&(We<0||be<0)||be>this.length)throw new RangeError("Attempt to write outside buffer bounds");ot||(ot="utf8");let Dt=!1;for(;;)switch(ot){case"hex":return br(this,$e,be,We);case"utf8":case"utf-8":return yr(this,$e,be,We);case"ascii":case"latin1":case"binary":return zt(this,$e,be,We);case"base64":return gi(this,$e,be,We);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ti(this,$e,be,We);default:if(Dt)throw new TypeError("Unknown encoding: "+ot);ot=(""+ot).toLowerCase(),Dt=!0}},ue.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function dr(Me,$e,be){return $e===0&&be===Me.length?W.fromByteArray(Me):W.fromByteArray(Me.slice($e,be))}function kr(Me,$e,be){be=Math.min(Me.length,be);const We=[];let ot=$e;for(;ot<be;){const vt=Me[ot];let Dt=null,Ar=vt>239?4:vt>223?3:vt>191?2:1;if(ot+Ar<=be){let Yr,Zr,Jr,Wr;switch(Ar){case 1:vt<128&&(Dt=vt);break;case 2:Yr=Me[ot+1],(Yr&192)===128&&(Wr=(vt&31)<<6|Yr&63,Wr>127&&(Dt=Wr));break;case 3:Yr=Me[ot+1],Zr=Me[ot+2],(Yr&192)===128&&(Zr&192)===128&&(Wr=(vt&15)<<12|(Yr&63)<<6|Zr&63,Wr>2047&&(Wr<55296||Wr>57343)&&(Dt=Wr));break;case 4:Yr=Me[ot+1],Zr=Me[ot+2],Jr=Me[ot+3],(Yr&192)===128&&(Zr&192)===128&&(Jr&192)===128&&(Wr=(vt&15)<<18|(Yr&63)<<12|(Zr&63)<<6|Jr&63,Wr>65535&&Wr<1114112&&(Dt=Wr))}}Dt===null?(Dt=65533,Ar=1):Dt>65535&&(Dt-=65536,We.push(Dt>>>10&1023|55296),Dt=56320|Dt&1023),We.push(Dt),ot+=Ar}return qi(We)}const un=4096;function qi(Me){const $e=Me.length;if($e<=un)return String.fromCharCode.apply(String,Me);let be="",We=0;for(;We<$e;)be+=String.fromCharCode.apply(String,Me.slice(We,We+=un));return be}function xt(Me,$e,be){let We="";be=Math.min(Me.length,be);for(let ot=$e;ot<be;++ot)We+=String.fromCharCode(Me[ot]&127);return We}function Zt(Me,$e,be){let We="";be=Math.min(Me.length,be);for(let ot=$e;ot<be;++ot)We+=String.fromCharCode(Me[ot]);return We}function ht(Me,$e,be){const We=Me.length;(!$e||$e<0)&&($e=0),(!be||be<0||be>We)&&(be=We);let ot="";for(let vt=$e;vt<be;++vt)ot+=Un[Me[vt]];return ot}function Rt(Me,$e,be){const We=Me.slice($e,be);let ot="";for(let vt=0;vt<We.length-1;vt+=2)ot+=String.fromCharCode(We[vt]+We[vt+1]*256);return ot}ue.prototype.slice=function($e,be){const We=this.length;$e=~~$e,be=be===void 0?We:~~be,$e<0?($e+=We,$e<0&&($e=0)):$e>We&&($e=We),be<0?(be+=We,be<0&&(be=0)):be>We&&(be=We),be<$e&&(be=$e);const ot=this.subarray($e,be);return Object.setPrototypeOf(ot,ue.prototype),ot};function It(Me,$e,be){if(Me%1!==0||Me<0)throw new RangeError("offset is not uint");if(Me+$e>be)throw new RangeError("Trying to access beyond buffer length")}ue.prototype.readUintLE=ue.prototype.readUIntLE=function($e,be,We){$e=$e>>>0,be=be>>>0,We||It($e,be,this.length);let ot=this[$e],vt=1,Dt=0;for(;++Dt<be&&(vt*=256);)ot+=this[$e+Dt]*vt;return ot},ue.prototype.readUintBE=ue.prototype.readUIntBE=function($e,be,We){$e=$e>>>0,be=be>>>0,We||It($e,be,this.length);let ot=this[$e+--be],vt=1;for(;be>0&&(vt*=256);)ot+=this[$e+--be]*vt;return ot},ue.prototype.readUint8=ue.prototype.readUInt8=function($e,be){return $e=$e>>>0,be||It($e,1,this.length),this[$e]},ue.prototype.readUint16LE=ue.prototype.readUInt16LE=function($e,be){return $e=$e>>>0,be||It($e,2,this.length),this[$e]|this[$e+1]<<8},ue.prototype.readUint16BE=ue.prototype.readUInt16BE=function($e,be){return $e=$e>>>0,be||It($e,2,this.length),this[$e]<<8|this[$e+1]},ue.prototype.readUint32LE=ue.prototype.readUInt32LE=function($e,be){return $e=$e>>>0,be||It($e,4,this.length),(this[$e]|this[$e+1]<<8|this[$e+2]<<16)+this[$e+3]*16777216},ue.prototype.readUint32BE=ue.prototype.readUInt32BE=function($e,be){return $e=$e>>>0,be||It($e,4,this.length),this[$e]*16777216+(this[$e+1]<<16|this[$e+2]<<8|this[$e+3])},ue.prototype.readBigUInt64LE=sn(function($e){$e=$e>>>0,vn($e,"offset");const be=this[$e],We=this[$e+7];(be===void 0||We===void 0)&&Fi($e,this.length-8);const ot=be+this[++$e]*2**8+this[++$e]*2**16+this[++$e]*2**24,vt=this[++$e]+this[++$e]*2**8+this[++$e]*2**16+We*2**24;return BigInt(ot)+(BigInt(vt)<<BigInt(32))}),ue.prototype.readBigUInt64BE=sn(function($e){$e=$e>>>0,vn($e,"offset");const be=this[$e],We=this[$e+7];(be===void 0||We===void 0)&&Fi($e,this.length-8);const ot=be*2**24+this[++$e]*2**16+this[++$e]*2**8+this[++$e],vt=this[++$e]*2**24+this[++$e]*2**16+this[++$e]*2**8+We;return(BigInt(ot)<<BigInt(32))+BigInt(vt)}),ue.prototype.readIntLE=function($e,be,We){$e=$e>>>0,be=be>>>0,We||It($e,be,this.length);let ot=this[$e],vt=1,Dt=0;for(;++Dt<be&&(vt*=256);)ot+=this[$e+Dt]*vt;return vt*=128,ot>=vt&&(ot-=Math.pow(2,8*be)),ot},ue.prototype.readIntBE=function($e,be,We){$e=$e>>>0,be=be>>>0,We||It($e,be,this.length);let ot=be,vt=1,Dt=this[$e+--ot];for(;ot>0&&(vt*=256);)Dt+=this[$e+--ot]*vt;return vt*=128,Dt>=vt&&(Dt-=Math.pow(2,8*be)),Dt},ue.prototype.readInt8=function($e,be){return $e=$e>>>0,be||It($e,1,this.length),this[$e]&128?(255-this[$e]+1)*-1:this[$e]},ue.prototype.readInt16LE=function($e,be){$e=$e>>>0,be||It($e,2,this.length);const We=this[$e]|this[$e+1]<<8;return We&32768?We|4294901760:We},ue.prototype.readInt16BE=function($e,be){$e=$e>>>0,be||It($e,2,this.length);const We=this[$e+1]|this[$e]<<8;return We&32768?We|4294901760:We},ue.prototype.readInt32LE=function($e,be){return $e=$e>>>0,be||It($e,4,this.length),this[$e]|this[$e+1]<<8|this[$e+2]<<16|this[$e+3]<<24},ue.prototype.readInt32BE=function($e,be){return $e=$e>>>0,be||It($e,4,this.length),this[$e]<<24|this[$e+1]<<16|this[$e+2]<<8|this[$e+3]},ue.prototype.readBigInt64LE=sn(function($e){$e=$e>>>0,vn($e,"offset");const be=this[$e],We=this[$e+7];(be===void 0||We===void 0)&&Fi($e,this.length-8);const ot=this[$e+4]+this[$e+5]*2**8+this[$e+6]*2**16+(We<<24);return(BigInt(ot)<<BigInt(32))+BigInt(be+this[++$e]*2**8+this[++$e]*2**16+this[++$e]*2**24)}),ue.prototype.readBigInt64BE=sn(function($e){$e=$e>>>0,vn($e,"offset");const be=this[$e],We=this[$e+7];(be===void 0||We===void 0)&&Fi($e,this.length-8);const ot=(be<<24)+this[++$e]*2**16+this[++$e]*2**8+this[++$e];return(BigInt(ot)<<BigInt(32))+BigInt(this[++$e]*2**24+this[++$e]*2**16+this[++$e]*2**8+We)}),ue.prototype.readFloatLE=function($e,be){return $e=$e>>>0,be||It($e,4,this.length),X.read(this,$e,!0,23,4)},ue.prototype.readFloatBE=function($e,be){return $e=$e>>>0,be||It($e,4,this.length),X.read(this,$e,!1,23,4)},ue.prototype.readDoubleLE=function($e,be){return $e=$e>>>0,be||It($e,8,this.length),X.read(this,$e,!0,52,8)},ue.prototype.readDoubleBE=function($e,be){return $e=$e>>>0,be||It($e,8,this.length),X.read(this,$e,!1,52,8)};function Ht(Me,$e,be,We,ot,vt){if(!ue.isBuffer(Me))throw new TypeError('"buffer" argument must be a Buffer instance');if($e>ot||$e<vt)throw new RangeError('"value" argument is out of bounds');if(be+We>Me.length)throw new RangeError("Index out of range")}ue.prototype.writeUintLE=ue.prototype.writeUIntLE=function($e,be,We,ot){if($e=+$e,be=be>>>0,We=We>>>0,!ot){const Ar=Math.pow(2,8*We)-1;Ht(this,$e,be,We,Ar,0)}let vt=1,Dt=0;for(this[be]=$e&255;++Dt<We&&(vt*=256);)this[be+Dt]=$e/vt&255;return be+We},ue.prototype.writeUintBE=ue.prototype.writeUIntBE=function($e,be,We,ot){if($e=+$e,be=be>>>0,We=We>>>0,!ot){const Ar=Math.pow(2,8*We)-1;Ht(this,$e,be,We,Ar,0)}let vt=We-1,Dt=1;for(this[be+vt]=$e&255;--vt>=0&&(Dt*=256);)this[be+vt]=$e/Dt&255;return be+We},ue.prototype.writeUint8=ue.prototype.writeUInt8=function($e,be,We){return $e=+$e,be=be>>>0,We||Ht(this,$e,be,1,255,0),this[be]=$e&255,be+1},ue.prototype.writeUint16LE=ue.prototype.writeUInt16LE=function($e,be,We){return $e=+$e,be=be>>>0,We||Ht(this,$e,be,2,65535,0),this[be]=$e&255,this[be+1]=$e>>>8,be+2},ue.prototype.writeUint16BE=ue.prototype.writeUInt16BE=function($e,be,We){return $e=+$e,be=be>>>0,We||Ht(this,$e,be,2,65535,0),this[be]=$e>>>8,this[be+1]=$e&255,be+2},ue.prototype.writeUint32LE=ue.prototype.writeUInt32LE=function($e,be,We){return $e=+$e,be=be>>>0,We||Ht(this,$e,be,4,4294967295,0),this[be+3]=$e>>>24,this[be+2]=$e>>>16,this[be+1]=$e>>>8,this[be]=$e&255,be+4},ue.prototype.writeUint32BE=ue.prototype.writeUInt32BE=function($e,be,We){return $e=+$e,be=be>>>0,We||Ht(this,$e,be,4,4294967295,0),this[be]=$e>>>24,this[be+1]=$e>>>16,this[be+2]=$e>>>8,this[be+3]=$e&255,be+4};function ar(Me,$e,be,We,ot){Rr($e,We,ot,Me,be,7);let vt=Number($e&BigInt(4294967295));Me[be++]=vt,vt=vt>>8,Me[be++]=vt,vt=vt>>8,Me[be++]=vt,vt=vt>>8,Me[be++]=vt;let Dt=Number($e>>BigInt(32)&BigInt(4294967295));return Me[be++]=Dt,Dt=Dt>>8,Me[be++]=Dt,Dt=Dt>>8,Me[be++]=Dt,Dt=Dt>>8,Me[be++]=Dt,be}function mr(Me,$e,be,We,ot){Rr($e,We,ot,Me,be,7);let vt=Number($e&BigInt(4294967295));Me[be+7]=vt,vt=vt>>8,Me[be+6]=vt,vt=vt>>8,Me[be+5]=vt,vt=vt>>8,Me[be+4]=vt;let Dt=Number($e>>BigInt(32)&BigInt(4294967295));return Me[be+3]=Dt,Dt=Dt>>8,Me[be+2]=Dt,Dt=Dt>>8,Me[be+1]=Dt,Dt=Dt>>8,Me[be]=Dt,be+8}ue.prototype.writeBigUInt64LE=sn(function($e,be=0){return ar(this,$e,be,BigInt(0),BigInt("0xffffffffffffffff"))}),ue.prototype.writeBigUInt64BE=sn(function($e,be=0){return mr(this,$e,be,BigInt(0),BigInt("0xffffffffffffffff"))}),ue.prototype.writeIntLE=function($e,be,We,ot){if($e=+$e,be=be>>>0,!ot){const Yr=Math.pow(2,8*We-1);Ht(this,$e,be,We,Yr-1,-Yr)}let vt=0,Dt=1,Ar=0;for(this[be]=$e&255;++vt<We&&(Dt*=256);)$e<0&&Ar===0&&this[be+vt-1]!==0&&(Ar=1),this[be+vt]=($e/Dt>>0)-Ar&255;return be+We},ue.prototype.writeIntBE=function($e,be,We,ot){if($e=+$e,be=be>>>0,!ot){const Yr=Math.pow(2,8*We-1);Ht(this,$e,be,We,Yr-1,-Yr)}let vt=We-1,Dt=1,Ar=0;for(this[be+vt]=$e&255;--vt>=0&&(Dt*=256);)$e<0&&Ar===0&&this[be+vt+1]!==0&&(Ar=1),this[be+vt]=($e/Dt>>0)-Ar&255;return be+We},ue.prototype.writeInt8=function($e,be,We){return $e=+$e,be=be>>>0,We||Ht(this,$e,be,1,127,-128),$e<0&&($e=255+$e+1),this[be]=$e&255,be+1},ue.prototype.writeInt16LE=function($e,be,We){return $e=+$e,be=be>>>0,We||Ht(this,$e,be,2,32767,-32768),this[be]=$e&255,this[be+1]=$e>>>8,be+2},ue.prototype.writeInt16BE=function($e,be,We){return $e=+$e,be=be>>>0,We||Ht(this,$e,be,2,32767,-32768),this[be]=$e>>>8,this[be+1]=$e&255,be+2},ue.prototype.writeInt32LE=function($e,be,We){return $e=+$e,be=be>>>0,We||Ht(this,$e,be,4,2147483647,-2147483648),this[be]=$e&255,this[be+1]=$e>>>8,this[be+2]=$e>>>16,this[be+3]=$e>>>24,be+4},ue.prototype.writeInt32BE=function($e,be,We){return $e=+$e,be=be>>>0,We||Ht(this,$e,be,4,2147483647,-2147483648),$e<0&&($e=4294967295+$e+1),this[be]=$e>>>24,this[be+1]=$e>>>16,this[be+2]=$e>>>8,this[be+3]=$e&255,be+4},ue.prototype.writeBigInt64LE=sn(function($e,be=0){return ar(this,$e,be,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),ue.prototype.writeBigInt64BE=sn(function($e,be=0){return mr(this,$e,be,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Fr(Me,$e,be,We,ot,vt){if(be+We>Me.length)throw new RangeError("Index out of range");if(be<0)throw new RangeError("Index out of range")}function si(Me,$e,be,We,ot){return $e=+$e,be=be>>>0,ot||Fr(Me,$e,be,4),X.write(Me,$e,be,We,23,4),be+4}ue.prototype.writeFloatLE=function($e,be,We){return si(this,$e,be,!0,We)},ue.prototype.writeFloatBE=function($e,be,We){return si(this,$e,be,!1,We)};function xi(Me,$e,be,We,ot){return $e=+$e,be=be>>>0,ot||Fr(Me,$e,be,8),X.write(Me,$e,be,We,52,8),be+8}ue.prototype.writeDoubleLE=function($e,be,We){return xi(this,$e,be,!0,We)},ue.prototype.writeDoubleBE=function($e,be,We){return xi(this,$e,be,!1,We)},ue.prototype.copy=function($e,be,We,ot){if(!ue.isBuffer($e))throw new TypeError("argument should be a Buffer");if(We||(We=0),!ot&&ot!==0&&(ot=this.length),be>=$e.length&&(be=$e.length),be||(be=0),ot>0&&ot<We&&(ot=We),ot===We||$e.length===0||this.length===0)return 0;if(be<0)throw new RangeError("targetStart out of bounds");if(We<0||We>=this.length)throw new RangeError("Index out of range");if(ot<0)throw new RangeError("sourceEnd out of bounds");ot>this.length&&(ot=this.length),$e.length-be<ot-We&&(ot=$e.length-be+We);const vt=ot-We;return this===$e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(be,We,ot):Uint8Array.prototype.set.call($e,this.subarray(We,ot),be),vt},ue.prototype.fill=function($e,be,We,ot){if(typeof $e=="string"){if(typeof be=="string"?(ot=be,be=0,We=this.length):typeof We=="string"&&(ot=We,We=this.length),ot!==void 0&&typeof ot!="string")throw new TypeError("encoding must be a string");if(typeof ot=="string"&&!ue.isEncoding(ot))throw new TypeError("Unknown encoding: "+ot);if($e.length===1){const Dt=$e.charCodeAt(0);(ot==="utf8"&&Dt<128||ot==="latin1")&&($e=Dt)}}else typeof $e=="number"?$e=$e&255:typeof $e=="boolean"&&($e=Number($e));if(be<0||this.length<be||this.length<We)throw new RangeError("Out of range index");if(We<=be)return this;be=be>>>0,We=We===void 0?this.length:We>>>0,$e||($e=0);let vt;if(typeof $e=="number")for(vt=be;vt<We;++vt)this[vt]=$e;else{const Dt=ue.isBuffer($e)?$e:ue.from($e,ot),Ar=Dt.length;if(Ar===0)throw new TypeError('The value "'+$e+'" is invalid for argument "value"');for(vt=0;vt<We-be;++vt)this[vt+be]=Dt[vt%Ar]}return this};const Xr={};function wn(Me,$e,be){Xr[Me]=class extends be{constructor(){super(),Object.defineProperty(this,"message",{value:$e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Me}]`,this.stack,delete this.name}get code(){return Me}set code(ot){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:ot,writable:!0})}toString(){return`${this.name} [${Me}]: ${this.message}`}}}wn("ERR_BUFFER_OUT_OF_BOUNDS",function(Me){return Me?`${Me} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),wn("ERR_INVALID_ARG_TYPE",function(Me,$e){return`The "${Me}" argument must be of type number. Received type ${typeof $e}`},TypeError),wn("ERR_OUT_OF_RANGE",function(Me,$e,be){let We=`The value of "${Me}" is out of range.`,ot=be;return Number.isInteger(be)&&Math.abs(be)>2**32?ot=Yi(String(be)):typeof be=="bigint"&&(ot=String(be),(be>BigInt(2)**BigInt(32)||be<-(BigInt(2)**BigInt(32)))&&(ot=Yi(ot)),ot+="n"),We+=` It must be ${$e}. Received ${ot}`,We},RangeError);function Yi(Me){let $e="",be=Me.length;const We=Me[0]==="-"?1:0;for(;be>=We+4;be-=3)$e=`_${Me.slice(be-3,be)}${$e}`;return`${Me.slice(0,be)}${$e}`}function Ji(Me,$e,be){vn($e,"offset"),(Me[$e]===void 0||Me[$e+be]===void 0)&&Fi($e,Me.length-(be+1))}function Rr(Me,$e,be,We,ot,vt){if(Me>be||Me<$e){const Dt=typeof $e=="bigint"?"n":"";let Ar;throw vt>3?$e===0||$e===BigInt(0)?Ar=`>= 0${Dt} and < 2${Dt} ** ${(vt+1)*8}${Dt}`:Ar=`>= -(2${Dt} ** ${(vt+1)*8-1}${Dt}) and < 2 ** ${(vt+1)*8-1}${Dt}`:Ar=`>= ${$e}${Dt} and <= ${be}${Dt}`,new Xr.ERR_OUT_OF_RANGE("value",Ar,Me)}Ji(We,ot,vt)}function vn(Me,$e){if(typeof Me!="number")throw new Xr.ERR_INVALID_ARG_TYPE($e,"number",Me)}function Fi(Me,$e,be){throw Math.floor(Me)!==Me?(vn(Me,be),new Xr.ERR_OUT_OF_RANGE(be||"offset","an integer",Me)):$e<0?new Xr.ERR_BUFFER_OUT_OF_BOUNDS:new Xr.ERR_OUT_OF_RANGE(be||"offset",`>= ${be?1:0} and <= ${$e}`,Me)}const Ro=/[^+/0-9A-Za-z-_]/g;function di(Me){if(Me=Me.split("=")[0],Me=Me.trim().replace(Ro,""),Me.length<2)return"";for(;Me.length%4!==0;)Me=Me+"=";return Me}function Qi(Me,$e){$e=$e||1/0;let be;const We=Me.length;let ot=null;const vt=[];for(let Dt=0;Dt<We;++Dt){if(be=Me.charCodeAt(Dt),be>55295&&be<57344){if(!ot){if(be>56319){($e-=3)>-1&&vt.push(239,191,189);continue}else if(Dt+1===We){($e-=3)>-1&&vt.push(239,191,189);continue}ot=be;continue}if(be<56320){($e-=3)>-1&&vt.push(239,191,189),ot=be;continue}be=(ot-55296<<10|be-56320)+65536}else ot&&($e-=3)>-1&&vt.push(239,191,189);if(ot=null,be<128){if(($e-=1)<0)break;vt.push(be)}else if(be<2048){if(($e-=2)<0)break;vt.push(be>>6|192,be&63|128)}else if(be<65536){if(($e-=3)<0)break;vt.push(be>>12|224,be>>6&63|128,be&63|128)}else if(be<1114112){if(($e-=4)<0)break;vt.push(be>>18|240,be>>12&63|128,be>>6&63|128,be&63|128)}else throw new Error("Invalid code point")}return vt}function Yo(Me){const $e=[];for(let be=0;be<Me.length;++be)$e.push(Me.charCodeAt(be)&255);return $e}function Mn(Me,$e){let be,We,ot;const vt=[];for(let Dt=0;Dt<Me.length&&!(($e-=2)<0);++Dt)be=Me.charCodeAt(Dt),We=be>>8,ot=be%256,vt.push(ot),vt.push(We);return vt}function en(Me){return W.toByteArray(di(Me))}function zn(Me,$e,be,We){let ot;for(ot=0;ot<We&&!(ot+be>=$e.length||ot>=Me.length);++ot)$e[ot+be]=Me[ot];return ot}function Hi(Me,$e){return Me instanceof $e||Me!=null&&Me.constructor!=null&&Me.constructor.name!=null&&Me.constructor.name===$e.name}function Qn(Me){return Me!==Me}const Un=function(){const Me="0123456789abcdef",$e=new Array(256);for(let be=0;be<16;++be){const We=be*16;for(let ot=0;ot<16;++ot)$e[We+ot]=Me[be]+Me[ot]}return $e}();function sn(Me){return typeof BigInt>"u"?Jo:Me}function Jo(){throw new Error("BigInt not supported")}})(buffer);var indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(G,W){for(var X=new Array(arguments.length-1),V=0,Z=2,re=!0;Z<arguments.length;)X[V++]=arguments[Z++];return new Promise(function(ue,H){X[V]=function(Ie){if(re)if(re=!1,Ie)H(Ie);else{for(var Ee=new Array(arguments.length-1),Fe=0;Fe<Ee.length;)Ee[Fe++]=arguments[Fe];ue.apply(null,Ee)}};try{G.apply(W||null,X)}catch(ye){re&&(re=!1,H(ye))}})}var base64$1={};(function(G){var W=G;W.length=function(ue){var H=ue.length;if(!H)return 0;for(var ye=0;--H%4>1&&ue.charAt(H)==="=";)++ye;return Math.ceil(ue.length*3)/4-ye};for(var X=new Array(64),V=new Array(123),Z=0;Z<64;)V[X[Z]=Z<26?Z+65:Z<52?Z+71:Z<62?Z-4:Z-59|43]=Z++;W.encode=function(ue,H,ye){for(var Ie=null,Ee=[],Fe=0,je=0,mt;H<ye;){var wt=ue[H++];switch(je){case 0:Ee[Fe++]=X[wt>>2],mt=(wt&3)<<4,je=1;break;case 1:Ee[Fe++]=X[mt|wt>>4],mt=(wt&15)<<2,je=2;break;case 2:Ee[Fe++]=X[mt|wt>>6],Ee[Fe++]=X[wt&63],je=0;break}Fe>8191&&((Ie||(Ie=[])).push(String.fromCharCode.apply(String,Ee)),Fe=0)}return je&&(Ee[Fe++]=X[mt],Ee[Fe++]=61,je===1&&(Ee[Fe++]=61)),Ie?(Fe&&Ie.push(String.fromCharCode.apply(String,Ee.slice(0,Fe))),Ie.join("")):String.fromCharCode.apply(String,Ee.slice(0,Fe))};var re="invalid encoding";W.decode=function(ue,H,ye){for(var Ie=ye,Ee=0,Fe,je=0;je<ue.length;){var mt=ue.charCodeAt(je++);if(mt===61&&Ee>1)break;if((mt=V[mt])===void 0)throw Error(re);switch(Ee){case 0:Fe=mt,Ee=1;break;case 1:H[ye++]=Fe<<2|(mt&48)>>4,Fe=mt,Ee=2;break;case 2:H[ye++]=(Fe&15)<<4|(mt&60)>>2,Fe=mt,Ee=3;break;case 3:H[ye++]=(Fe&3)<<6|mt,Ee=0;break}}if(Ee===1)throw Error(re);return ye-Ie},W.test=function(ue){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(ue)}})(base64$1);var eventemitter=EventEmitter$1;function EventEmitter$1(){this._listeners={}}EventEmitter$1.prototype.on=function(W,X,V){return(this._listeners[W]||(this._listeners[W]=[])).push({fn:X,ctx:V||this}),this};EventEmitter$1.prototype.off=function(W,X){if(W===void 0)this._listeners={};else if(X===void 0)this._listeners[W]=[];else for(var V=this._listeners[W],Z=0;Z<V.length;)V[Z].fn===X?V.splice(Z,1):++Z;return this};EventEmitter$1.prototype.emit=function(W){var X=this._listeners[W];if(X){for(var V=[],Z=1;Z<arguments.length;)V.push(arguments[Z++]);for(Z=0;Z<X.length;)X[Z].fn.apply(X[Z++].ctx,V)}return this};var float=factory(factory);function factory(G){return typeof Float32Array<"u"?function(){var W=new Float32Array([-0]),X=new Uint8Array(W.buffer),V=X[3]===128;function Z(H,ye,Ie){W[0]=H,ye[Ie]=X[0],ye[Ie+1]=X[1],ye[Ie+2]=X[2],ye[Ie+3]=X[3]}function re(H,ye,Ie){W[0]=H,ye[Ie]=X[3],ye[Ie+1]=X[2],ye[Ie+2]=X[1],ye[Ie+3]=X[0]}G.writeFloatLE=V?Z:re,G.writeFloatBE=V?re:Z;function se(H,ye){return X[0]=H[ye],X[1]=H[ye+1],X[2]=H[ye+2],X[3]=H[ye+3],W[0]}function ue(H,ye){return X[3]=H[ye],X[2]=H[ye+1],X[1]=H[ye+2],X[0]=H[ye+3],W[0]}G.readFloatLE=V?se:ue,G.readFloatBE=V?ue:se}():function(){function W(V,Z,re,se){var ue=Z<0?1:0;if(ue&&(Z=-Z),Z===0)V(1/Z>0?0:2147483648,re,se);else if(isNaN(Z))V(2143289344,re,se);else if(Z>34028234663852886e22)V((ue<<31|2139095040)>>>0,re,se);else if(Z<11754943508222875e-54)V((ue<<31|Math.round(Z/1401298464324817e-60))>>>0,re,se);else{var H=Math.floor(Math.log(Z)/Math.LN2),ye=Math.round(Z*Math.pow(2,-H)*8388608)&8388607;V((ue<<31|H+127<<23|ye)>>>0,re,se)}}G.writeFloatLE=W.bind(null,writeUintLE),G.writeFloatBE=W.bind(null,writeUintBE);function X(V,Z,re){var se=V(Z,re),ue=(se>>31)*2+1,H=se>>>23&255,ye=se&8388607;return H===255?ye?NaN:ue*(1/0):H===0?ue*1401298464324817e-60*ye:ue*Math.pow(2,H-150)*(ye+8388608)}G.readFloatLE=X.bind(null,readUintLE),G.readFloatBE=X.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var W=new Float64Array([-0]),X=new Uint8Array(W.buffer),V=X[7]===128;function Z(H,ye,Ie){W[0]=H,ye[Ie]=X[0],ye[Ie+1]=X[1],ye[Ie+2]=X[2],ye[Ie+3]=X[3],ye[Ie+4]=X[4],ye[Ie+5]=X[5],ye[Ie+6]=X[6],ye[Ie+7]=X[7]}function re(H,ye,Ie){W[0]=H,ye[Ie]=X[7],ye[Ie+1]=X[6],ye[Ie+2]=X[5],ye[Ie+3]=X[4],ye[Ie+4]=X[3],ye[Ie+5]=X[2],ye[Ie+6]=X[1],ye[Ie+7]=X[0]}G.writeDoubleLE=V?Z:re,G.writeDoubleBE=V?re:Z;function se(H,ye){return X[0]=H[ye],X[1]=H[ye+1],X[2]=H[ye+2],X[3]=H[ye+3],X[4]=H[ye+4],X[5]=H[ye+5],X[6]=H[ye+6],X[7]=H[ye+7],W[0]}function ue(H,ye){return X[7]=H[ye],X[6]=H[ye+1],X[5]=H[ye+2],X[4]=H[ye+3],X[3]=H[ye+4],X[2]=H[ye+5],X[1]=H[ye+6],X[0]=H[ye+7],W[0]}G.readDoubleLE=V?se:ue,G.readDoubleBE=V?ue:se}():function(){function W(V,Z,re,se,ue,H){var ye=se<0?1:0;if(ye&&(se=-se),se===0)V(0,ue,H+Z),V(1/se>0?0:2147483648,ue,H+re);else if(isNaN(se))V(0,ue,H+Z),V(2146959360,ue,H+re);else if(se>17976931348623157e292)V(0,ue,H+Z),V((ye<<31|2146435072)>>>0,ue,H+re);else{var Ie;if(se<22250738585072014e-324)Ie=se/5e-324,V(Ie>>>0,ue,H+Z),V((ye<<31|Ie/4294967296)>>>0,ue,H+re);else{var Ee=Math.floor(Math.log(se)/Math.LN2);Ee===1024&&(Ee=1023),Ie=se*Math.pow(2,-Ee),V(Ie*4503599627370496>>>0,ue,H+Z),V((ye<<31|Ee+1023<<20|Ie*1048576&1048575)>>>0,ue,H+re)}}}G.writeDoubleLE=W.bind(null,writeUintLE,0,4),G.writeDoubleBE=W.bind(null,writeUintBE,4,0);function X(V,Z,re,se,ue){var H=V(se,ue+Z),ye=V(se,ue+re),Ie=(ye>>31)*2+1,Ee=ye>>>20&2047,Fe=4294967296*(ye&1048575)+H;return Ee===2047?Fe?NaN:Ie*(1/0):Ee===0?Ie*5e-324*Fe:Ie*Math.pow(2,Ee-1075)*(Fe+4503599627370496)}G.readDoubleLE=X.bind(null,readUintLE,0,4),G.readDoubleBE=X.bind(null,readUintBE,4,0)}(),G}function writeUintLE(G,W,X){W[X]=G&255,W[X+1]=G>>>8&255,W[X+2]=G>>>16&255,W[X+3]=G>>>24}function writeUintBE(G,W,X){W[X]=G>>>24,W[X+1]=G>>>16&255,W[X+2]=G>>>8&255,W[X+3]=G&255}function readUintLE(G,W){return(G[W]|G[W+1]<<8|G[W+2]<<16|G[W+3]<<24)>>>0}function readUintBE(G,W){return(G[W]<<24|G[W+1]<<16|G[W+2]<<8|G[W+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(G){}return null}var utf8$2={};(function(G){var W=G;W.length=function(V){for(var Z=0,re=0,se=0;se<V.length;++se)re=V.charCodeAt(se),re<128?Z+=1:re<2048?Z+=2:(re&64512)===55296&&(V.charCodeAt(se+1)&64512)===56320?(++se,Z+=4):Z+=3;return Z},W.read=function(V,Z,re){var se=re-Z;if(se<1)return"";for(var ue=null,H=[],ye=0,Ie;Z<re;)Ie=V[Z++],Ie<128?H[ye++]=Ie:Ie>191&&Ie<224?H[ye++]=(Ie&31)<<6|V[Z++]&63:Ie>239&&Ie<365?(Ie=((Ie&7)<<18|(V[Z++]&63)<<12|(V[Z++]&63)<<6|V[Z++]&63)-65536,H[ye++]=55296+(Ie>>10),H[ye++]=56320+(Ie&1023)):H[ye++]=(Ie&15)<<12|(V[Z++]&63)<<6|V[Z++]&63,ye>8191&&((ue||(ue=[])).push(String.fromCharCode.apply(String,H)),ye=0);return ue?(ye&&ue.push(String.fromCharCode.apply(String,H.slice(0,ye))),ue.join("")):String.fromCharCode.apply(String,H.slice(0,ye))},W.write=function(V,Z,re){for(var se=re,ue,H,ye=0;ye<V.length;++ye)ue=V.charCodeAt(ye),ue<128?Z[re++]=ue:ue<2048?(Z[re++]=ue>>6|192,Z[re++]=ue&63|128):(ue&64512)===55296&&((H=V.charCodeAt(ye+1))&64512)===56320?(ue=65536+((ue&1023)<<10)+(H&1023),++ye,Z[re++]=ue>>18|240,Z[re++]=ue>>12&63|128,Z[re++]=ue>>6&63|128,Z[re++]=ue&63|128):(Z[re++]=ue>>12|224,Z[re++]=ue>>6&63|128,Z[re++]=ue&63|128);return re-se}})(utf8$2);var pool_1=pool;function pool(G,W,X){var V=X||8192,Z=V>>>1,re=null,se=V;return function(H){if(H<1||H>Z)return G(H);se+H>V&&(re=G(V),se=0);var ye=W.call(re,se,se+=H);return se&7&&(se=(se|7)+1),ye}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=W;var G=requireMinimal();function W(re,se){this.lo=re>>>0,this.hi=se>>>0}var X=W.zero=new W(0,0);X.toNumber=function(){return 0},X.zzEncode=X.zzDecode=function(){return this},X.length=function(){return 1};var V=W.zeroHash="\0\0\0\0\0\0\0\0";W.fromNumber=function(se){if(se===0)return X;var ue=se<0;ue&&(se=-se);var H=se>>>0,ye=(se-H)/4294967296>>>0;return ue&&(ye=~ye>>>0,H=~H>>>0,++H>4294967295&&(H=0,++ye>4294967295&&(ye=0))),new W(H,ye)},W.from=function(se){if(typeof se=="number")return W.fromNumber(se);if(G.isString(se))if(G.Long)se=G.Long.fromString(se);else return W.fromNumber(parseInt(se,10));return se.low||se.high?new W(se.low>>>0,se.high>>>0):X},W.prototype.toNumber=function(se){if(!se&&this.hi>>>31){var ue=~this.lo+1>>>0,H=~this.hi>>>0;return ue||(H=H+1>>>0),-(ue+H*4294967296)}return this.lo+this.hi*4294967296},W.prototype.toLong=function(se){return G.Long?new G.Long(this.lo|0,this.hi|0,!!se):{low:this.lo|0,high:this.hi|0,unsigned:!!se}};var Z=String.prototype.charCodeAt;return W.fromHash=function(se){return se===V?X:new W((Z.call(se,0)|Z.call(se,1)<<8|Z.call(se,2)<<16|Z.call(se,3)<<24)>>>0,(Z.call(se,4)|Z.call(se,5)<<8|Z.call(se,6)<<16|Z.call(se,7)<<24)>>>0)},W.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},W.prototype.zzEncode=function(){var se=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^se)>>>0,this.lo=(this.lo<<1^se)>>>0,this},W.prototype.zzDecode=function(){var se=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^se)>>>0,this.hi=(this.hi>>>1^se)>>>0,this},W.prototype.length=function(){var se=this.lo,ue=(this.lo>>>28|this.hi<<4)>>>0,H=this.hi>>>24;return H===0?ue===0?se<16384?se<128?1:2:se<2097152?3:4:ue<16384?ue<128?5:6:ue<2097152?7:8:H<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(G){var W=G;W.asPromise=aspromise,W.base64=base64$1,W.EventEmitter=eventemitter,W.float=float,W.inquire=inquire_1,W.utf8=utf8$2,W.pool=pool_1,W.LongBits=requireLongbits(),W.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),W.global=W.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,W.emptyArray=Object.freeze?Object.freeze([]):[],W.emptyObject=Object.freeze?Object.freeze({}):{},W.isInteger=Number.isInteger||function(re){return typeof re=="number"&&isFinite(re)&&Math.floor(re)===re},W.isString=function(re){return typeof re=="string"||re instanceof String},W.isObject=function(re){return re&&typeof re=="object"},W.isset=W.isSet=function(re,se){var ue=re[se];return ue!=null&&re.hasOwnProperty(se)?typeof ue!="object"||(Array.isArray(ue)?ue.length:Object.keys(ue).length)>0:!1},W.Buffer=function(){try{var Z=W.inquire("buffer").Buffer;return Z.prototype.utf8Write?Z:null}catch{return null}}(),W._Buffer_from=null,W._Buffer_allocUnsafe=null,W.newBuffer=function(re){return typeof re=="number"?W.Buffer?W._Buffer_allocUnsafe(re):new W.Array(re):W.Buffer?W._Buffer_from(re):typeof Uint8Array>"u"?re:new Uint8Array(re)},W.Array=typeof Uint8Array<"u"?Uint8Array:Array,W.Long=W.global.dcodeIO&&W.global.dcodeIO.Long||W.global.Long||W.inquire("long"),W.key2Re=/^true|false|0|1$/,W.key32Re=/^-?(?:0|[1-9][0-9]*)$/,W.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,W.longToHash=function(re){return re?W.LongBits.from(re).toHash():W.LongBits.zeroHash},W.longFromHash=function(re,se){var ue=W.LongBits.fromHash(re);return W.Long?W.Long.fromBits(ue.lo,ue.hi,se):ue.toNumber(!!se)};function X(Z,re,se){for(var ue=Object.keys(re),H=0;H<ue.length;++H)(Z[ue[H]]===void 0||!se)&&(Z[ue[H]]=re[ue[H]]);return Z}W.merge=X,W.lcFirst=function(re){return re.charAt(0).toLowerCase()+re.substring(1)};function V(Z){function re(se,ue){if(!(this instanceof re))return new re(se,ue);Object.defineProperty(this,"message",{get:function(){return se}}),Error.captureStackTrace?Error.captureStackTrace(this,re):Object.defineProperty(this,"stack",{value:new Error().stack||""}),ue&&X(this,ue)}return re.prototype=Object.create(Error.prototype,{constructor:{value:re,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return Z},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),re}W.newError=V,W.ProtocolError=V("ProtocolError"),W.oneOfGetter=function(re){for(var se={},ue=0;ue<re.length;++ue)se[re[ue]]=1;return function(){for(var H=Object.keys(this),ye=H.length-1;ye>-1;--ye)if(se[H[ye]]===1&&this[H[ye]]!==void 0&&this[H[ye]]!==null)return H[ye]}},W.oneOfSetter=function(re){return function(se){for(var ue=0;ue<re.length;++ue)re[ue]!==se&&delete this[re[ue]]}},W.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},W._configure=function(){var Z=W.Buffer;if(!Z){W._Buffer_from=W._Buffer_allocUnsafe=null;return}W._Buffer_from=Z.from!==Uint8Array.from&&Z.from||function(se,ue){return new Z(se,ue)},W._Buffer_allocUnsafe=Z.allocUnsafe||function(se){return new Z(se)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(G,W,X){this.fn=G,this.len=W,this.next=void 0,this.val=X}function noop(){}function State(G){this.head=G.head,this.tail=G.tail,this.len=G.len,this.next=G.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function G(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function G(W){return new util$4.Array(W)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function G(W,X,V){return this.tail=this.tail.next=new Op(W,X,V),this.len+=X,this};function writeByte(G,W,X){W[X]=G&255}function writeVarint32(G,W,X){for(;G>127;)W[X++]=G&127|128,G>>>=7;W[X]=G}function VarintOp(G,W){this.len=G,this.next=void 0,this.val=W}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function G(W){return this.len+=(this.tail=this.tail.next=new VarintOp((W=W>>>0)<128?1:W<16384?2:W<2097152?3:W<268435456?4:5,W)).len,this};Writer$1.prototype.int32=function G(W){return W<0?this._push(writeVarint64,10,LongBits$1.fromNumber(W)):this.uint32(W)};Writer$1.prototype.sint32=function G(W){return this.uint32((W<<1^W>>31)>>>0)};function writeVarint64(G,W,X){for(;G.hi;)W[X++]=G.lo&127|128,G.lo=(G.lo>>>7|G.hi<<25)>>>0,G.hi>>>=7;for(;G.lo>127;)W[X++]=G.lo&127|128,G.lo=G.lo>>>7;W[X++]=G.lo}Writer$1.prototype.uint64=function G(W){var X=LongBits$1.from(W);return this._push(writeVarint64,X.length(),X)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function G(W){var X=LongBits$1.from(W).zzEncode();return this._push(writeVarint64,X.length(),X)};Writer$1.prototype.bool=function G(W){return this._push(writeByte,1,W?1:0)};function writeFixed32(G,W,X){W[X]=G&255,W[X+1]=G>>>8&255,W[X+2]=G>>>16&255,W[X+3]=G>>>24}Writer$1.prototype.fixed32=function G(W){return this._push(writeFixed32,4,W>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function G(W){var X=LongBits$1.from(W);return this._push(writeFixed32,4,X.lo)._push(writeFixed32,4,X.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function G(W){return this._push(util$4.float.writeFloatLE,4,W)};Writer$1.prototype.double=function G(W){return this._push(util$4.float.writeDoubleLE,8,W)};var writeBytes=util$4.Array.prototype.set?function G(W,X,V){X.set(W,V)}:function G(W,X,V){for(var Z=0;Z<W.length;++Z)X[V+Z]=W[Z]};Writer$1.prototype.bytes=function G(W){var X=W.length>>>0;if(!X)return this._push(writeByte,1,0);if(util$4.isString(W)){var V=Writer$1.alloc(X=base64.length(W));base64.decode(W,V,0),W=V}return this.uint32(X)._push(writeBytes,X,W)};Writer$1.prototype.string=function G(W){var X=utf8$1.length(W);return X?this.uint32(X)._push(utf8$1.write,X,W):this._push(writeByte,1,0)};Writer$1.prototype.fork=function G(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function G(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function G(){var W=this.head,X=this.tail,V=this.len;return this.reset().uint32(V),V&&(this.tail.next=W.next,this.tail=X,this.len+=V),this};Writer$1.prototype.finish=function G(){for(var W=this.head.next,X=this.constructor.alloc(this.len),V=0;W;)W.fn(W.val,X,V),V+=W.len,W=W.next;return X};Writer$1._configure=function(G){BufferWriter$1=G,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(W,X,V){X.set(W,V)}:function(W,X,V){if(W.copy)W.copy(X,V,0,W.length);else for(var Z=0;Z<W.length;)X[V++]=W[Z++]}};BufferWriter.prototype.bytes=function G(W){util$3.isString(W)&&(W=util$3._Buffer_from(W,"base64"));var X=W.length>>>0;return this.uint32(X),X&&this._push(BufferWriter.writeBytesBuffer,X,W),this};function writeStringBuffer(G,W,X){G.length<40?util$3.utf8.write(G,W,X):W.utf8Write?W.utf8Write(G,X):W.write(G,X)}BufferWriter.prototype.string=function G(W){var X=util$3.Buffer.byteLength(W);return this.uint32(X),X&&this._push(writeStringBuffer,X,W),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(G,W){return RangeError("index out of range: "+G.pos+" + "+(W||1)+" > "+G.len)}function Reader$1(G){this.buf=G,this.pos=0,this.len=G.length}var create_array=typeof Uint8Array<"u"?function G(W){if(W instanceof Uint8Array||Array.isArray(W))return new Reader$1(W);throw Error("illegal buffer")}:function G(W){if(Array.isArray(W))return new Reader$1(W);throw Error("illegal buffer")},create=function G(){return util$2.Buffer?function(X){return(Reader$1.create=function(Z){return util$2.Buffer.isBuffer(Z)?new BufferReader$1(Z):create_array(Z)})(X)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function G(){var W=4294967295;return function(){if(W=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(W=(W|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(W=(W|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(W=(W|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(W=(W|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return W;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return W}}();Reader$1.prototype.int32=function G(){return this.uint32()|0};Reader$1.prototype.sint32=function G(){var W=this.uint32();return W>>>1^-(W&1)|0};function readLongVarint(){var G=new LongBits(0,0),W=0;if(this.len-this.pos>4){for(;W<4;++W)if(G.lo=(G.lo|(this.buf[this.pos]&127)<<W*7)>>>0,this.buf[this.pos++]<128)return G;if(G.lo=(G.lo|(this.buf[this.pos]&127)<<28)>>>0,G.hi=(G.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return G;W=0}else{for(;W<3;++W){if(this.pos>=this.len)throw indexOutOfRange(this);if(G.lo=(G.lo|(this.buf[this.pos]&127)<<W*7)>>>0,this.buf[this.pos++]<128)return G}return G.lo=(G.lo|(this.buf[this.pos++]&127)<<W*7)>>>0,G}if(this.len-this.pos>4){for(;W<5;++W)if(G.hi=(G.hi|(this.buf[this.pos]&127)<<W*7+3)>>>0,this.buf[this.pos++]<128)return G}else for(;W<5;++W){if(this.pos>=this.len)throw indexOutOfRange(this);if(G.hi=(G.hi|(this.buf[this.pos]&127)<<W*7+3)>>>0,this.buf[this.pos++]<128)return G}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function G(){return this.uint32()!==0};function readFixed32_end(G,W){return(G[W-4]|G[W-3]<<8|G[W-2]<<16|G[W-1]<<24)>>>0}Reader$1.prototype.fixed32=function G(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function G(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function G(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var W=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,W};Reader$1.prototype.double=function G(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var W=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,W};Reader$1.prototype.bytes=function G(){var W=this.uint32(),X=this.pos,V=this.pos+W;if(V>this.len)throw indexOutOfRange(this,W);if(this.pos+=W,Array.isArray(this.buf))return this.buf.slice(X,V);if(X===V){var Z=util$2.Buffer;return Z?Z.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,X,V)};Reader$1.prototype.string=function G(){var W=this.bytes();return utf8.read(W,0,W.length)};Reader$1.prototype.skip=function G(W){if(typeof W=="number"){if(this.pos+W>this.len)throw indexOutOfRange(this,W);this.pos+=W}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(G){switch(G){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(G=this.uint32()&7)!==4;)this.skipType(G);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+G+" at offset "+this.pos)}return this};Reader$1._configure=function(G){BufferReader$1=G,Reader$1.create=create(),BufferReader$1._configure();var W=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[W](!1)},uint64:function(){return readLongVarint.call(this)[W](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[W](!1)},fixed64:function(){return readFixed64.call(this)[W](!0)},sfixed64:function(){return readFixed64.call(this)[W](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(G){Reader.call(this,G)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function G(){var W=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+W,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+W,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(G,W,X){if(typeof G!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=G,this.requestDelimited=!!W,this.responseDelimited=!!X}Service.prototype.rpcCall=function G(W,X,V,Z,re){if(!Z)throw TypeError("request must be specified");var se=this;if(!re)return util.asPromise(G,se,W,X,V,Z);if(!se.rpcImpl){setTimeout(function(){re(Error("already ended"))},0);return}try{return se.rpcImpl(W,X[se.requestDelimited?"encodeDelimited":"encode"](Z).finish(),function(H,ye){if(H)return se.emit("error",H,W),re(H);if(ye===null){se.end(!0);return}if(!(ye instanceof V))try{ye=V[se.responseDelimited?"decodeDelimited":"decode"](ye)}catch(Ie){return se.emit("error",Ie,W),re(Ie)}return se.emit("data",ye,W),re(null,ye)})}catch(ue){se.emit("error",ue,W),setTimeout(function(){re(ue)},0);return}};Service.prototype.end=function G(W){return this.rpcImpl&&(W||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(G){var W=G;W.Service=service})(rpc);var roots={};(function(G){var W=G;W.build="minimal",W.Writer=writer,W.BufferWriter=writer_buffer,W.Reader=reader,W.BufferReader=reader_buffer,W.util=requireMinimal(),W.rpc=rpc,W.roots=roots,W.configure=X;function X(){W.util._configure(),W.Writer._configure(W.BufferWriter),W.Reader._configure(W.BufferReader)}X()})(indexMinimal);var minimal=indexMinimal,$protobuf=minimal,$Reader=$protobuf.Reader,$Writer=$protobuf.Writer,$util=$protobuf.util,$root=$protobuf.roots.default||($protobuf.roots.default={});$root.transit_realtime=function(){var G={};return G.FeedMessage=function(){function W(X){if(this.entity=[],X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.header=null,W.prototype.entity=$util.emptyArray,W.create=function(V){return new W(V)},W.encode=function(V,Z){if(Z||(Z=$Writer.create()),$root.transit_realtime.FeedHeader.encode(V.header,Z.uint32(10).fork()).ldelim(),V.entity!=null&&V.entity.length)for(var re=0;re<V.entity.length;++re)$root.transit_realtime.FeedEntity.encode(V.entity[re],Z.uint32(18).fork()).ldelim();return Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.FeedMessage;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.header=$root.transit_realtime.FeedHeader.decode(V,V.uint32());break}case 2:{se.entity&&se.entity.length||(se.entity=[]),se.entity.push($root.transit_realtime.FeedEntity.decode(V,V.uint32()));break}default:V.skipType(ue&7);break}}if(!se.hasOwnProperty("header"))throw $util.ProtocolError("missing required 'header'",{instance:se});return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){if(typeof V!="object"||V===null)return"object expected";{var Z=$root.transit_realtime.FeedHeader.verify(V.header);if(Z)return"header."+Z}if(V.entity!=null&&V.hasOwnProperty("entity")){if(!Array.isArray(V.entity))return"entity: array expected";for(var re=0;re<V.entity.length;++re){var Z=$root.transit_realtime.FeedEntity.verify(V.entity[re]);if(Z)return"entity."+Z}}return null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.FeedMessage)return V;var Z=new $root.transit_realtime.FeedMessage;if(V.header!=null){if(typeof V.header!="object")throw TypeError(".transit_realtime.FeedMessage.header: object expected");Z.header=$root.transit_realtime.FeedHeader.fromObject(V.header)}if(V.entity){if(!Array.isArray(V.entity))throw TypeError(".transit_realtime.FeedMessage.entity: array expected");Z.entity=[];for(var re=0;re<V.entity.length;++re){if(typeof V.entity[re]!="object")throw TypeError(".transit_realtime.FeedMessage.entity: object expected");Z.entity[re]=$root.transit_realtime.FeedEntity.fromObject(V.entity[re])}}return Z},W.toObject=function(V,Z){Z||(Z={});var re={};if((Z.arrays||Z.defaults)&&(re.entity=[]),Z.defaults&&(re.header=null),V.header!=null&&V.hasOwnProperty("header")&&(re.header=$root.transit_realtime.FeedHeader.toObject(V.header,Z)),V.entity&&V.entity.length){re.entity=[];for(var se=0;se<V.entity.length;++se)re.entity[se]=$root.transit_realtime.FeedEntity.toObject(V.entity[se],Z)}return re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.FeedMessage"},W}(),G.FeedHeader=function(){function W(X){if(X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.gtfs_realtime_version="",W.prototype.incrementality=0,W.prototype.timestamp=$util.Long?$util.Long.fromBits(0,0,!0):0,W.create=function(V){return new W(V)},W.encode=function(V,Z){return Z||(Z=$Writer.create()),Z.uint32(10).string(V.gtfs_realtime_version),V.incrementality!=null&&Object.hasOwnProperty.call(V,"incrementality")&&Z.uint32(16).int32(V.incrementality),V.timestamp!=null&&Object.hasOwnProperty.call(V,"timestamp")&&Z.uint32(24).uint64(V.timestamp),Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.FeedHeader;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.gtfs_realtime_version=V.string();break}case 2:{se.incrementality=V.int32();break}case 3:{se.timestamp=V.uint64();break}default:V.skipType(ue&7);break}}if(!se.hasOwnProperty("gtfs_realtime_version"))throw $util.ProtocolError("missing required 'gtfs_realtime_version'",{instance:se});return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){if(typeof V!="object"||V===null)return"object expected";if(!$util.isString(V.gtfs_realtime_version))return"gtfs_realtime_version: string expected";if(V.incrementality!=null&&V.hasOwnProperty("incrementality"))switch(V.incrementality){default:return"incrementality: enum value expected";case 0:case 1:break}return V.timestamp!=null&&V.hasOwnProperty("timestamp")&&!$util.isInteger(V.timestamp)&&!(V.timestamp&&$util.isInteger(V.timestamp.low)&&$util.isInteger(V.timestamp.high))?"timestamp: integer|Long expected":null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.FeedHeader)return V;var Z=new $root.transit_realtime.FeedHeader;switch(V.gtfs_realtime_version!=null&&(Z.gtfs_realtime_version=String(V.gtfs_realtime_version)),V.incrementality){default:if(typeof V.incrementality=="number"){Z.incrementality=V.incrementality;break}break;case"FULL_DATASET":case 0:Z.incrementality=0;break;case"DIFFERENTIAL":case 1:Z.incrementality=1;break}return V.timestamp!=null&&($util.Long?(Z.timestamp=$util.Long.fromValue(V.timestamp)).unsigned=!0:typeof V.timestamp=="string"?Z.timestamp=parseInt(V.timestamp,10):typeof V.timestamp=="number"?Z.timestamp=V.timestamp:typeof V.timestamp=="object"&&(Z.timestamp=new $util.LongBits(V.timestamp.low>>>0,V.timestamp.high>>>0).toNumber(!0))),Z},W.toObject=function(V,Z){Z||(Z={});var re={};if(Z.defaults)if(re.gtfs_realtime_version="",re.incrementality=Z.enums===String?"FULL_DATASET":0,$util.Long){var se=new $util.Long(0,0,!0);re.timestamp=Z.longs===String?se.toString():Z.longs===Number?se.toNumber():se}else re.timestamp=Z.longs===String?"0":0;return V.gtfs_realtime_version!=null&&V.hasOwnProperty("gtfs_realtime_version")&&(re.gtfs_realtime_version=V.gtfs_realtime_version),V.incrementality!=null&&V.hasOwnProperty("incrementality")&&(re.incrementality=Z.enums===String?$root.transit_realtime.FeedHeader.Incrementality[V.incrementality]===void 0?V.incrementality:$root.transit_realtime.FeedHeader.Incrementality[V.incrementality]:V.incrementality),V.timestamp!=null&&V.hasOwnProperty("timestamp")&&(typeof V.timestamp=="number"?re.timestamp=Z.longs===String?String(V.timestamp):V.timestamp:re.timestamp=Z.longs===String?$util.Long.prototype.toString.call(V.timestamp):Z.longs===Number?new $util.LongBits(V.timestamp.low>>>0,V.timestamp.high>>>0).toNumber(!0):V.timestamp),re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.FeedHeader"},W.Incrementality=function(){var X={},V=Object.create(X);return V[X[0]="FULL_DATASET"]=0,V[X[1]="DIFFERENTIAL"]=1,V}(),W}(),G.FeedEntity=function(){function W(X){if(X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.id="",W.prototype.is_deleted=!1,W.prototype.trip_update=null,W.prototype.vehicle=null,W.prototype.alert=null,W.prototype.shape=null,W.create=function(V){return new W(V)},W.encode=function(V,Z){return Z||(Z=$Writer.create()),Z.uint32(10).string(V.id),V.is_deleted!=null&&Object.hasOwnProperty.call(V,"is_deleted")&&Z.uint32(16).bool(V.is_deleted),V.trip_update!=null&&Object.hasOwnProperty.call(V,"trip_update")&&$root.transit_realtime.TripUpdate.encode(V.trip_update,Z.uint32(26).fork()).ldelim(),V.vehicle!=null&&Object.hasOwnProperty.call(V,"vehicle")&&$root.transit_realtime.VehiclePosition.encode(V.vehicle,Z.uint32(34).fork()).ldelim(),V.alert!=null&&Object.hasOwnProperty.call(V,"alert")&&$root.transit_realtime.Alert.encode(V.alert,Z.uint32(42).fork()).ldelim(),V.shape!=null&&Object.hasOwnProperty.call(V,"shape")&&$root.transit_realtime.Shape.encode(V.shape,Z.uint32(50).fork()).ldelim(),Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.FeedEntity;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.id=V.string();break}case 2:{se.is_deleted=V.bool();break}case 3:{se.trip_update=$root.transit_realtime.TripUpdate.decode(V,V.uint32());break}case 4:{se.vehicle=$root.transit_realtime.VehiclePosition.decode(V,V.uint32());break}case 5:{se.alert=$root.transit_realtime.Alert.decode(V,V.uint32());break}case 6:{se.shape=$root.transit_realtime.Shape.decode(V,V.uint32());break}default:V.skipType(ue&7);break}}if(!se.hasOwnProperty("id"))throw $util.ProtocolError("missing required 'id'",{instance:se});return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){if(typeof V!="object"||V===null)return"object expected";if(!$util.isString(V.id))return"id: string expected";if(V.is_deleted!=null&&V.hasOwnProperty("is_deleted")&&typeof V.is_deleted!="boolean")return"is_deleted: boolean expected";if(V.trip_update!=null&&V.hasOwnProperty("trip_update")){var Z=$root.transit_realtime.TripUpdate.verify(V.trip_update);if(Z)return"trip_update."+Z}if(V.vehicle!=null&&V.hasOwnProperty("vehicle")){var Z=$root.transit_realtime.VehiclePosition.verify(V.vehicle);if(Z)return"vehicle."+Z}if(V.alert!=null&&V.hasOwnProperty("alert")){var Z=$root.transit_realtime.Alert.verify(V.alert);if(Z)return"alert."+Z}if(V.shape!=null&&V.hasOwnProperty("shape")){var Z=$root.transit_realtime.Shape.verify(V.shape);if(Z)return"shape."+Z}return null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.FeedEntity)return V;var Z=new $root.transit_realtime.FeedEntity;if(V.id!=null&&(Z.id=String(V.id)),V.is_deleted!=null&&(Z.is_deleted=!!V.is_deleted),V.trip_update!=null){if(typeof V.trip_update!="object")throw TypeError(".transit_realtime.FeedEntity.trip_update: object expected");Z.trip_update=$root.transit_realtime.TripUpdate.fromObject(V.trip_update)}if(V.vehicle!=null){if(typeof V.vehicle!="object")throw TypeError(".transit_realtime.FeedEntity.vehicle: object expected");Z.vehicle=$root.transit_realtime.VehiclePosition.fromObject(V.vehicle)}if(V.alert!=null){if(typeof V.alert!="object")throw TypeError(".transit_realtime.FeedEntity.alert: object expected");Z.alert=$root.transit_realtime.Alert.fromObject(V.alert)}if(V.shape!=null){if(typeof V.shape!="object")throw TypeError(".transit_realtime.FeedEntity.shape: object expected");Z.shape=$root.transit_realtime.Shape.fromObject(V.shape)}return Z},W.toObject=function(V,Z){Z||(Z={});var re={};return Z.defaults&&(re.id="",re.is_deleted=!1,re.trip_update=null,re.vehicle=null,re.alert=null,re.shape=null),V.id!=null&&V.hasOwnProperty("id")&&(re.id=V.id),V.is_deleted!=null&&V.hasOwnProperty("is_deleted")&&(re.is_deleted=V.is_deleted),V.trip_update!=null&&V.hasOwnProperty("trip_update")&&(re.trip_update=$root.transit_realtime.TripUpdate.toObject(V.trip_update,Z)),V.vehicle!=null&&V.hasOwnProperty("vehicle")&&(re.vehicle=$root.transit_realtime.VehiclePosition.toObject(V.vehicle,Z)),V.alert!=null&&V.hasOwnProperty("alert")&&(re.alert=$root.transit_realtime.Alert.toObject(V.alert,Z)),V.shape!=null&&V.hasOwnProperty("shape")&&(re.shape=$root.transit_realtime.Shape.toObject(V.shape,Z)),re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.FeedEntity"},W}(),G.TripUpdate=function(){function W(X){if(this.stop_time_update=[],X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.trip=null,W.prototype.vehicle=null,W.prototype.stop_time_update=$util.emptyArray,W.prototype.timestamp=$util.Long?$util.Long.fromBits(0,0,!0):0,W.prototype.delay=0,W.prototype.trip_properties=null,W.create=function(V){return new W(V)},W.encode=function(V,Z){if(Z||(Z=$Writer.create()),$root.transit_realtime.TripDescriptor.encode(V.trip,Z.uint32(10).fork()).ldelim(),V.stop_time_update!=null&&V.stop_time_update.length)for(var re=0;re<V.stop_time_update.length;++re)$root.transit_realtime.TripUpdate.StopTimeUpdate.encode(V.stop_time_update[re],Z.uint32(18).fork()).ldelim();return V.vehicle!=null&&Object.hasOwnProperty.call(V,"vehicle")&&$root.transit_realtime.VehicleDescriptor.encode(V.vehicle,Z.uint32(26).fork()).ldelim(),V.timestamp!=null&&Object.hasOwnProperty.call(V,"timestamp")&&Z.uint32(32).uint64(V.timestamp),V.delay!=null&&Object.hasOwnProperty.call(V,"delay")&&Z.uint32(40).int32(V.delay),V.trip_properties!=null&&Object.hasOwnProperty.call(V,"trip_properties")&&$root.transit_realtime.TripUpdate.TripProperties.encode(V.trip_properties,Z.uint32(50).fork()).ldelim(),Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.TripUpdate;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.trip=$root.transit_realtime.TripDescriptor.decode(V,V.uint32());break}case 3:{se.vehicle=$root.transit_realtime.VehicleDescriptor.decode(V,V.uint32());break}case 2:{se.stop_time_update&&se.stop_time_update.length||(se.stop_time_update=[]),se.stop_time_update.push($root.transit_realtime.TripUpdate.StopTimeUpdate.decode(V,V.uint32()));break}case 4:{se.timestamp=V.uint64();break}case 5:{se.delay=V.int32();break}case 6:{se.trip_properties=$root.transit_realtime.TripUpdate.TripProperties.decode(V,V.uint32());break}default:V.skipType(ue&7);break}}if(!se.hasOwnProperty("trip"))throw $util.ProtocolError("missing required 'trip'",{instance:se});return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){if(typeof V!="object"||V===null)return"object expected";{var Z=$root.transit_realtime.TripDescriptor.verify(V.trip);if(Z)return"trip."+Z}if(V.vehicle!=null&&V.hasOwnProperty("vehicle")){var Z=$root.transit_realtime.VehicleDescriptor.verify(V.vehicle);if(Z)return"vehicle."+Z}if(V.stop_time_update!=null&&V.hasOwnProperty("stop_time_update")){if(!Array.isArray(V.stop_time_update))return"stop_time_update: array expected";for(var re=0;re<V.stop_time_update.length;++re){var Z=$root.transit_realtime.TripUpdate.StopTimeUpdate.verify(V.stop_time_update[re]);if(Z)return"stop_time_update."+Z}}if(V.timestamp!=null&&V.hasOwnProperty("timestamp")&&!$util.isInteger(V.timestamp)&&!(V.timestamp&&$util.isInteger(V.timestamp.low)&&$util.isInteger(V.timestamp.high)))return"timestamp: integer|Long expected";if(V.delay!=null&&V.hasOwnProperty("delay")&&!$util.isInteger(V.delay))return"delay: integer expected";if(V.trip_properties!=null&&V.hasOwnProperty("trip_properties")){var Z=$root.transit_realtime.TripUpdate.TripProperties.verify(V.trip_properties);if(Z)return"trip_properties."+Z}return null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.TripUpdate)return V;var Z=new $root.transit_realtime.TripUpdate;if(V.trip!=null){if(typeof V.trip!="object")throw TypeError(".transit_realtime.TripUpdate.trip: object expected");Z.trip=$root.transit_realtime.TripDescriptor.fromObject(V.trip)}if(V.vehicle!=null){if(typeof V.vehicle!="object")throw TypeError(".transit_realtime.TripUpdate.vehicle: object expected");Z.vehicle=$root.transit_realtime.VehicleDescriptor.fromObject(V.vehicle)}if(V.stop_time_update){if(!Array.isArray(V.stop_time_update))throw TypeError(".transit_realtime.TripUpdate.stop_time_update: array expected");Z.stop_time_update=[];for(var re=0;re<V.stop_time_update.length;++re){if(typeof V.stop_time_update[re]!="object")throw TypeError(".transit_realtime.TripUpdate.stop_time_update: object expected");Z.stop_time_update[re]=$root.transit_realtime.TripUpdate.StopTimeUpdate.fromObject(V.stop_time_update[re])}}if(V.timestamp!=null&&($util.Long?(Z.timestamp=$util.Long.fromValue(V.timestamp)).unsigned=!0:typeof V.timestamp=="string"?Z.timestamp=parseInt(V.timestamp,10):typeof V.timestamp=="number"?Z.timestamp=V.timestamp:typeof V.timestamp=="object"&&(Z.timestamp=new $util.LongBits(V.timestamp.low>>>0,V.timestamp.high>>>0).toNumber(!0))),V.delay!=null&&(Z.delay=V.delay|0),V.trip_properties!=null){if(typeof V.trip_properties!="object")throw TypeError(".transit_realtime.TripUpdate.trip_properties: object expected");Z.trip_properties=$root.transit_realtime.TripUpdate.TripProperties.fromObject(V.trip_properties)}return Z},W.toObject=function(V,Z){Z||(Z={});var re={};if((Z.arrays||Z.defaults)&&(re.stop_time_update=[]),Z.defaults){if(re.trip=null,re.vehicle=null,$util.Long){var se=new $util.Long(0,0,!0);re.timestamp=Z.longs===String?se.toString():Z.longs===Number?se.toNumber():se}else re.timestamp=Z.longs===String?"0":0;re.delay=0,re.trip_properties=null}if(V.trip!=null&&V.hasOwnProperty("trip")&&(re.trip=$root.transit_realtime.TripDescriptor.toObject(V.trip,Z)),V.stop_time_update&&V.stop_time_update.length){re.stop_time_update=[];for(var ue=0;ue<V.stop_time_update.length;++ue)re.stop_time_update[ue]=$root.transit_realtime.TripUpdate.StopTimeUpdate.toObject(V.stop_time_update[ue],Z)}return V.vehicle!=null&&V.hasOwnProperty("vehicle")&&(re.vehicle=$root.transit_realtime.VehicleDescriptor.toObject(V.vehicle,Z)),V.timestamp!=null&&V.hasOwnProperty("timestamp")&&(typeof V.timestamp=="number"?re.timestamp=Z.longs===String?String(V.timestamp):V.timestamp:re.timestamp=Z.longs===String?$util.Long.prototype.toString.call(V.timestamp):Z.longs===Number?new $util.LongBits(V.timestamp.low>>>0,V.timestamp.high>>>0).toNumber(!0):V.timestamp),V.delay!=null&&V.hasOwnProperty("delay")&&(re.delay=V.delay),V.trip_properties!=null&&V.hasOwnProperty("trip_properties")&&(re.trip_properties=$root.transit_realtime.TripUpdate.TripProperties.toObject(V.trip_properties,Z)),re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.TripUpdate"},W.StopTimeEvent=function(){function X(V){if(V)for(var Z=Object.keys(V),re=0;re<Z.length;++re)V[Z[re]]!=null&&(this[Z[re]]=V[Z[re]])}return X.prototype.delay=0,X.prototype.time=$util.Long?$util.Long.fromBits(0,0,!1):0,X.prototype.uncertainty=0,X.create=function(Z){return new X(Z)},X.encode=function(Z,re){return re||(re=$Writer.create()),Z.delay!=null&&Object.hasOwnProperty.call(Z,"delay")&&re.uint32(8).int32(Z.delay),Z.time!=null&&Object.hasOwnProperty.call(Z,"time")&&re.uint32(16).int64(Z.time),Z.uncertainty!=null&&Object.hasOwnProperty.call(Z,"uncertainty")&&re.uint32(24).int32(Z.uncertainty),re},X.encodeDelimited=function(Z,re){return this.encode(Z,re).ldelim()},X.decode=function(Z,re){Z instanceof $Reader||(Z=$Reader.create(Z));for(var se=re===void 0?Z.len:Z.pos+re,ue=new $root.transit_realtime.TripUpdate.StopTimeEvent;Z.pos<se;){var H=Z.uint32();switch(H>>>3){case 1:{ue.delay=Z.int32();break}case 2:{ue.time=Z.int64();break}case 3:{ue.uncertainty=Z.int32();break}default:Z.skipType(H&7);break}}return ue},X.decodeDelimited=function(Z){return Z instanceof $Reader||(Z=new $Reader(Z)),this.decode(Z,Z.uint32())},X.verify=function(Z){return typeof Z!="object"||Z===null?"object expected":Z.delay!=null&&Z.hasOwnProperty("delay")&&!$util.isInteger(Z.delay)?"delay: integer expected":Z.time!=null&&Z.hasOwnProperty("time")&&!$util.isInteger(Z.time)&&!(Z.time&&$util.isInteger(Z.time.low)&&$util.isInteger(Z.time.high))?"time: integer|Long expected":Z.uncertainty!=null&&Z.hasOwnProperty("uncertainty")&&!$util.isInteger(Z.uncertainty)?"uncertainty: integer expected":null},X.fromObject=function(Z){if(Z instanceof $root.transit_realtime.TripUpdate.StopTimeEvent)return Z;var re=new $root.transit_realtime.TripUpdate.StopTimeEvent;return Z.delay!=null&&(re.delay=Z.delay|0),Z.time!=null&&($util.Long?(re.time=$util.Long.fromValue(Z.time)).unsigned=!1:typeof Z.time=="string"?re.time=parseInt(Z.time,10):typeof Z.time=="number"?re.time=Z.time:typeof Z.time=="object"&&(re.time=new $util.LongBits(Z.time.low>>>0,Z.time.high>>>0).toNumber())),Z.uncertainty!=null&&(re.uncertainty=Z.uncertainty|0),re},X.toObject=function(Z,re){re||(re={});var se={};if(re.defaults){if(se.delay=0,$util.Long){var ue=new $util.Long(0,0,!1);se.time=re.longs===String?ue.toString():re.longs===Number?ue.toNumber():ue}else se.time=re.longs===String?"0":0;se.uncertainty=0}return Z.delay!=null&&Z.hasOwnProperty("delay")&&(se.delay=Z.delay),Z.time!=null&&Z.hasOwnProperty("time")&&(typeof Z.time=="number"?se.time=re.longs===String?String(Z.time):Z.time:se.time=re.longs===String?$util.Long.prototype.toString.call(Z.time):re.longs===Number?new $util.LongBits(Z.time.low>>>0,Z.time.high>>>0).toNumber():Z.time),Z.uncertainty!=null&&Z.hasOwnProperty("uncertainty")&&(se.uncertainty=Z.uncertainty),se},X.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},X.getTypeUrl=function(Z){return Z===void 0&&(Z="type.googleapis.com"),Z+"/transit_realtime.TripUpdate.StopTimeEvent"},X}(),W.StopTimeUpdate=function(){function X(V){if(V)for(var Z=Object.keys(V),re=0;re<Z.length;++re)V[Z[re]]!=null&&(this[Z[re]]=V[Z[re]])}return X.prototype.stop_sequence=0,X.prototype.stop_id="",X.prototype.arrival=null,X.prototype.departure=null,X.prototype.departure_occupancy_status=0,X.prototype.schedule_relationship=0,X.prototype.stop_time_properties=null,X.create=function(Z){return new X(Z)},X.encode=function(Z,re){return re||(re=$Writer.create()),Z.stop_sequence!=null&&Object.hasOwnProperty.call(Z,"stop_sequence")&&re.uint32(8).uint32(Z.stop_sequence),Z.arrival!=null&&Object.hasOwnProperty.call(Z,"arrival")&&$root.transit_realtime.TripUpdate.StopTimeEvent.encode(Z.arrival,re.uint32(18).fork()).ldelim(),Z.departure!=null&&Object.hasOwnProperty.call(Z,"departure")&&$root.transit_realtime.TripUpdate.StopTimeEvent.encode(Z.departure,re.uint32(26).fork()).ldelim(),Z.stop_id!=null&&Object.hasOwnProperty.call(Z,"stop_id")&&re.uint32(34).string(Z.stop_id),Z.schedule_relationship!=null&&Object.hasOwnProperty.call(Z,"schedule_relationship")&&re.uint32(40).int32(Z.schedule_relationship),Z.stop_time_properties!=null&&Object.hasOwnProperty.call(Z,"stop_time_properties")&&$root.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.encode(Z.stop_time_properties,re.uint32(50).fork()).ldelim(),Z.departure_occupancy_status!=null&&Object.hasOwnProperty.call(Z,"departure_occupancy_status")&&re.uint32(56).int32(Z.departure_occupancy_status),re},X.encodeDelimited=function(Z,re){return this.encode(Z,re).ldelim()},X.decode=function(Z,re){Z instanceof $Reader||(Z=$Reader.create(Z));for(var se=re===void 0?Z.len:Z.pos+re,ue=new $root.transit_realtime.TripUpdate.StopTimeUpdate;Z.pos<se;){var H=Z.uint32();switch(H>>>3){case 1:{ue.stop_sequence=Z.uint32();break}case 4:{ue.stop_id=Z.string();break}case 2:{ue.arrival=$root.transit_realtime.TripUpdate.StopTimeEvent.decode(Z,Z.uint32());break}case 3:{ue.departure=$root.transit_realtime.TripUpdate.StopTimeEvent.decode(Z,Z.uint32());break}case 7:{ue.departure_occupancy_status=Z.int32();break}case 5:{ue.schedule_relationship=Z.int32();break}case 6:{ue.stop_time_properties=$root.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.decode(Z,Z.uint32());break}default:Z.skipType(H&7);break}}return ue},X.decodeDelimited=function(Z){return Z instanceof $Reader||(Z=new $Reader(Z)),this.decode(Z,Z.uint32())},X.verify=function(Z){if(typeof Z!="object"||Z===null)return"object expected";if(Z.stop_sequence!=null&&Z.hasOwnProperty("stop_sequence")&&!$util.isInteger(Z.stop_sequence))return"stop_sequence: integer expected";if(Z.stop_id!=null&&Z.hasOwnProperty("stop_id")&&!$util.isString(Z.stop_id))return"stop_id: string expected";if(Z.arrival!=null&&Z.hasOwnProperty("arrival")){var re=$root.transit_realtime.TripUpdate.StopTimeEvent.verify(Z.arrival);if(re)return"arrival."+re}if(Z.departure!=null&&Z.hasOwnProperty("departure")){var re=$root.transit_realtime.TripUpdate.StopTimeEvent.verify(Z.departure);if(re)return"departure."+re}if(Z.departure_occupancy_status!=null&&Z.hasOwnProperty("departure_occupancy_status"))switch(Z.departure_occupancy_status){default:return"departure_occupancy_status: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:break}if(Z.schedule_relationship!=null&&Z.hasOwnProperty("schedule_relationship"))switch(Z.schedule_relationship){default:return"schedule_relationship: enum value expected";case 0:case 1:case 2:case 3:break}if(Z.stop_time_properties!=null&&Z.hasOwnProperty("stop_time_properties")){var re=$root.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.verify(Z.stop_time_properties);if(re)return"stop_time_properties."+re}return null},X.fromObject=function(Z){if(Z instanceof $root.transit_realtime.TripUpdate.StopTimeUpdate)return Z;var re=new $root.transit_realtime.TripUpdate.StopTimeUpdate;if(Z.stop_sequence!=null&&(re.stop_sequence=Z.stop_sequence>>>0),Z.stop_id!=null&&(re.stop_id=String(Z.stop_id)),Z.arrival!=null){if(typeof Z.arrival!="object")throw TypeError(".transit_realtime.TripUpdate.StopTimeUpdate.arrival: object expected");re.arrival=$root.transit_realtime.TripUpdate.StopTimeEvent.fromObject(Z.arrival)}if(Z.departure!=null){if(typeof Z.departure!="object")throw TypeError(".transit_realtime.TripUpdate.StopTimeUpdate.departure: object expected");re.departure=$root.transit_realtime.TripUpdate.StopTimeEvent.fromObject(Z.departure)}switch(Z.departure_occupancy_status){default:if(typeof Z.departure_occupancy_status=="number"){re.departure_occupancy_status=Z.departure_occupancy_status;break}break;case"EMPTY":case 0:re.departure_occupancy_status=0;break;case"MANY_SEATS_AVAILABLE":case 1:re.departure_occupancy_status=1;break;case"FEW_SEATS_AVAILABLE":case 2:re.departure_occupancy_status=2;break;case"STANDING_ROOM_ONLY":case 3:re.departure_occupancy_status=3;break;case"CRUSHED_STANDING_ROOM_ONLY":case 4:re.departure_occupancy_status=4;break;case"FULL":case 5:re.departure_occupancy_status=5;break;case"NOT_ACCEPTING_PASSENGERS":case 6:re.departure_occupancy_status=6;break;case"NO_DATA_AVAILABLE":case 7:re.departure_occupancy_status=7;break;case"NOT_BOARDABLE":case 8:re.departure_occupancy_status=8;break}switch(Z.schedule_relationship){default:if(typeof Z.schedule_relationship=="number"){re.schedule_relationship=Z.schedule_relationship;break}break;case"SCHEDULED":case 0:re.schedule_relationship=0;break;case"SKIPPED":case 1:re.schedule_relationship=1;break;case"NO_DATA":case 2:re.schedule_relationship=2;break;case"UNSCHEDULED":case 3:re.schedule_relationship=3;break}if(Z.stop_time_properties!=null){if(typeof Z.stop_time_properties!="object")throw TypeError(".transit_realtime.TripUpdate.StopTimeUpdate.stop_time_properties: object expected");re.stop_time_properties=$root.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.fromObject(Z.stop_time_properties)}return re},X.toObject=function(Z,re){re||(re={});var se={};return re.defaults&&(se.stop_sequence=0,se.arrival=null,se.departure=null,se.stop_id="",se.schedule_relationship=re.enums===String?"SCHEDULED":0,se.stop_time_properties=null,se.departure_occupancy_status=re.enums===String?"EMPTY":0),Z.stop_sequence!=null&&Z.hasOwnProperty("stop_sequence")&&(se.stop_sequence=Z.stop_sequence),Z.arrival!=null&&Z.hasOwnProperty("arrival")&&(se.arrival=$root.transit_realtime.TripUpdate.StopTimeEvent.toObject(Z.arrival,re)),Z.departure!=null&&Z.hasOwnProperty("departure")&&(se.departure=$root.transit_realtime.TripUpdate.StopTimeEvent.toObject(Z.departure,re)),Z.stop_id!=null&&Z.hasOwnProperty("stop_id")&&(se.stop_id=Z.stop_id),Z.schedule_relationship!=null&&Z.hasOwnProperty("schedule_relationship")&&(se.schedule_relationship=re.enums===String?$root.transit_realtime.TripUpdate.StopTimeUpdate.ScheduleRelationship[Z.schedule_relationship]===void 0?Z.schedule_relationship:$root.transit_realtime.TripUpdate.StopTimeUpdate.ScheduleRelationship[Z.schedule_relationship]:Z.schedule_relationship),Z.stop_time_properties!=null&&Z.hasOwnProperty("stop_time_properties")&&(se.stop_time_properties=$root.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.toObject(Z.stop_time_properties,re)),Z.departure_occupancy_status!=null&&Z.hasOwnProperty("departure_occupancy_status")&&(se.departure_occupancy_status=re.enums===String?$root.transit_realtime.VehiclePosition.OccupancyStatus[Z.departure_occupancy_status]===void 0?Z.departure_occupancy_status:$root.transit_realtime.VehiclePosition.OccupancyStatus[Z.departure_occupancy_status]:Z.departure_occupancy_status),se},X.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},X.getTypeUrl=function(Z){return Z===void 0&&(Z="type.googleapis.com"),Z+"/transit_realtime.TripUpdate.StopTimeUpdate"},X.ScheduleRelationship=function(){var V={},Z=Object.create(V);return Z[V[0]="SCHEDULED"]=0,Z[V[1]="SKIPPED"]=1,Z[V[2]="NO_DATA"]=2,Z[V[3]="UNSCHEDULED"]=3,Z}(),X.StopTimeProperties=function(){function V(Z){if(Z)for(var re=Object.keys(Z),se=0;se<re.length;++se)Z[re[se]]!=null&&(this[re[se]]=Z[re[se]])}return V.prototype.assigned_stop_id="",V.create=function(re){return new V(re)},V.encode=function(re,se){return se||(se=$Writer.create()),re.assigned_stop_id!=null&&Object.hasOwnProperty.call(re,"assigned_stop_id")&&se.uint32(10).string(re.assigned_stop_id),se},V.encodeDelimited=function(re,se){return this.encode(re,se).ldelim()},V.decode=function(re,se){re instanceof $Reader||(re=$Reader.create(re));for(var ue=se===void 0?re.len:re.pos+se,H=new $root.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties;re.pos<ue;){var ye=re.uint32();switch(ye>>>3){case 1:{H.assigned_stop_id=re.string();break}default:re.skipType(ye&7);break}}return H},V.decodeDelimited=function(re){return re instanceof $Reader||(re=new $Reader(re)),this.decode(re,re.uint32())},V.verify=function(re){return typeof re!="object"||re===null?"object expected":re.assigned_stop_id!=null&&re.hasOwnProperty("assigned_stop_id")&&!$util.isString(re.assigned_stop_id)?"assigned_stop_id: string expected":null},V.fromObject=function(re){if(re instanceof $root.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties)return re;var se=new $root.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties;return re.assigned_stop_id!=null&&(se.assigned_stop_id=String(re.assigned_stop_id)),se},V.toObject=function(re,se){se||(se={});var ue={};return se.defaults&&(ue.assigned_stop_id=""),re.assigned_stop_id!=null&&re.hasOwnProperty("assigned_stop_id")&&(ue.assigned_stop_id=re.assigned_stop_id),ue},V.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},V.getTypeUrl=function(re){return re===void 0&&(re="type.googleapis.com"),re+"/transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties"},V}(),X}(),W.TripProperties=function(){function X(V){if(V)for(var Z=Object.keys(V),re=0;re<Z.length;++re)V[Z[re]]!=null&&(this[Z[re]]=V[Z[re]])}return X.prototype.trip_id="",X.prototype.start_date="",X.prototype.start_time="",X.prototype.shape_id="",X.create=function(Z){return new X(Z)},X.encode=function(Z,re){return re||(re=$Writer.create()),Z.trip_id!=null&&Object.hasOwnProperty.call(Z,"trip_id")&&re.uint32(10).string(Z.trip_id),Z.start_date!=null&&Object.hasOwnProperty.call(Z,"start_date")&&re.uint32(18).string(Z.start_date),Z.start_time!=null&&Object.hasOwnProperty.call(Z,"start_time")&&re.uint32(26).string(Z.start_time),Z.shape_id!=null&&Object.hasOwnProperty.call(Z,"shape_id")&&re.uint32(34).string(Z.shape_id),re},X.encodeDelimited=function(Z,re){return this.encode(Z,re).ldelim()},X.decode=function(Z,re){Z instanceof $Reader||(Z=$Reader.create(Z));for(var se=re===void 0?Z.len:Z.pos+re,ue=new $root.transit_realtime.TripUpdate.TripProperties;Z.pos<se;){var H=Z.uint32();switch(H>>>3){case 1:{ue.trip_id=Z.string();break}case 2:{ue.start_date=Z.string();break}case 3:{ue.start_time=Z.string();break}case 4:{ue.shape_id=Z.string();break}default:Z.skipType(H&7);break}}return ue},X.decodeDelimited=function(Z){return Z instanceof $Reader||(Z=new $Reader(Z)),this.decode(Z,Z.uint32())},X.verify=function(Z){return typeof Z!="object"||Z===null?"object expected":Z.trip_id!=null&&Z.hasOwnProperty("trip_id")&&!$util.isString(Z.trip_id)?"trip_id: string expected":Z.start_date!=null&&Z.hasOwnProperty("start_date")&&!$util.isString(Z.start_date)?"start_date: string expected":Z.start_time!=null&&Z.hasOwnProperty("start_time")&&!$util.isString(Z.start_time)?"start_time: string expected":Z.shape_id!=null&&Z.hasOwnProperty("shape_id")&&!$util.isString(Z.shape_id)?"shape_id: string expected":null},X.fromObject=function(Z){if(Z instanceof $root.transit_realtime.TripUpdate.TripProperties)return Z;var re=new $root.transit_realtime.TripUpdate.TripProperties;return Z.trip_id!=null&&(re.trip_id=String(Z.trip_id)),Z.start_date!=null&&(re.start_date=String(Z.start_date)),Z.start_time!=null&&(re.start_time=String(Z.start_time)),Z.shape_id!=null&&(re.shape_id=String(Z.shape_id)),re},X.toObject=function(Z,re){re||(re={});var se={};return re.defaults&&(se.trip_id="",se.start_date="",se.start_time="",se.shape_id=""),Z.trip_id!=null&&Z.hasOwnProperty("trip_id")&&(se.trip_id=Z.trip_id),Z.start_date!=null&&Z.hasOwnProperty("start_date")&&(se.start_date=Z.start_date),Z.start_time!=null&&Z.hasOwnProperty("start_time")&&(se.start_time=Z.start_time),Z.shape_id!=null&&Z.hasOwnProperty("shape_id")&&(se.shape_id=Z.shape_id),se},X.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},X.getTypeUrl=function(Z){return Z===void 0&&(Z="type.googleapis.com"),Z+"/transit_realtime.TripUpdate.TripProperties"},X}(),W}(),G.VehiclePosition=function(){function W(X){if(this.multi_carriage_details=[],X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.trip=null,W.prototype.vehicle=null,W.prototype.position=null,W.prototype.current_stop_sequence=0,W.prototype.stop_id="",W.prototype.current_status=2,W.prototype.timestamp=$util.Long?$util.Long.fromBits(0,0,!0):0,W.prototype.congestion_level=0,W.prototype.occupancy_status=0,W.prototype.occupancy_percentage=0,W.prototype.multi_carriage_details=$util.emptyArray,W.create=function(V){return new W(V)},W.encode=function(V,Z){if(Z||(Z=$Writer.create()),V.trip!=null&&Object.hasOwnProperty.call(V,"trip")&&$root.transit_realtime.TripDescriptor.encode(V.trip,Z.uint32(10).fork()).ldelim(),V.position!=null&&Object.hasOwnProperty.call(V,"position")&&$root.transit_realtime.Position.encode(V.position,Z.uint32(18).fork()).ldelim(),V.current_stop_sequence!=null&&Object.hasOwnProperty.call(V,"current_stop_sequence")&&Z.uint32(24).uint32(V.current_stop_sequence),V.current_status!=null&&Object.hasOwnProperty.call(V,"current_status")&&Z.uint32(32).int32(V.current_status),V.timestamp!=null&&Object.hasOwnProperty.call(V,"timestamp")&&Z.uint32(40).uint64(V.timestamp),V.congestion_level!=null&&Object.hasOwnProperty.call(V,"congestion_level")&&Z.uint32(48).int32(V.congestion_level),V.stop_id!=null&&Object.hasOwnProperty.call(V,"stop_id")&&Z.uint32(58).string(V.stop_id),V.vehicle!=null&&Object.hasOwnProperty.call(V,"vehicle")&&$root.transit_realtime.VehicleDescriptor.encode(V.vehicle,Z.uint32(66).fork()).ldelim(),V.occupancy_status!=null&&Object.hasOwnProperty.call(V,"occupancy_status")&&Z.uint32(72).int32(V.occupancy_status),V.occupancy_percentage!=null&&Object.hasOwnProperty.call(V,"occupancy_percentage")&&Z.uint32(80).uint32(V.occupancy_percentage),V.multi_carriage_details!=null&&V.multi_carriage_details.length)for(var re=0;re<V.multi_carriage_details.length;++re)$root.transit_realtime.VehiclePosition.CarriageDetails.encode(V.multi_carriage_details[re],Z.uint32(90).fork()).ldelim();return Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.VehiclePosition;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.trip=$root.transit_realtime.TripDescriptor.decode(V,V.uint32());break}case 8:{se.vehicle=$root.transit_realtime.VehicleDescriptor.decode(V,V.uint32());break}case 2:{se.position=$root.transit_realtime.Position.decode(V,V.uint32());break}case 3:{se.current_stop_sequence=V.uint32();break}case 7:{se.stop_id=V.string();break}case 4:{se.current_status=V.int32();break}case 5:{se.timestamp=V.uint64();break}case 6:{se.congestion_level=V.int32();break}case 9:{se.occupancy_status=V.int32();break}case 10:{se.occupancy_percentage=V.uint32();break}case 11:{se.multi_carriage_details&&se.multi_carriage_details.length||(se.multi_carriage_details=[]),se.multi_carriage_details.push($root.transit_realtime.VehiclePosition.CarriageDetails.decode(V,V.uint32()));break}default:V.skipType(ue&7);break}}return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){if(typeof V!="object"||V===null)return"object expected";if(V.trip!=null&&V.hasOwnProperty("trip")){var Z=$root.transit_realtime.TripDescriptor.verify(V.trip);if(Z)return"trip."+Z}if(V.vehicle!=null&&V.hasOwnProperty("vehicle")){var Z=$root.transit_realtime.VehicleDescriptor.verify(V.vehicle);if(Z)return"vehicle."+Z}if(V.position!=null&&V.hasOwnProperty("position")){var Z=$root.transit_realtime.Position.verify(V.position);if(Z)return"position."+Z}if(V.current_stop_sequence!=null&&V.hasOwnProperty("current_stop_sequence")&&!$util.isInteger(V.current_stop_sequence))return"current_stop_sequence: integer expected";if(V.stop_id!=null&&V.hasOwnProperty("stop_id")&&!$util.isString(V.stop_id))return"stop_id: string expected";if(V.current_status!=null&&V.hasOwnProperty("current_status"))switch(V.current_status){default:return"current_status: enum value expected";case 0:case 1:case 2:break}if(V.timestamp!=null&&V.hasOwnProperty("timestamp")&&!$util.isInteger(V.timestamp)&&!(V.timestamp&&$util.isInteger(V.timestamp.low)&&$util.isInteger(V.timestamp.high)))return"timestamp: integer|Long expected";if(V.congestion_level!=null&&V.hasOwnProperty("congestion_level"))switch(V.congestion_level){default:return"congestion_level: enum value expected";case 0:case 1:case 2:case 3:case 4:break}if(V.occupancy_status!=null&&V.hasOwnProperty("occupancy_status"))switch(V.occupancy_status){default:return"occupancy_status: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:break}if(V.occupancy_percentage!=null&&V.hasOwnProperty("occupancy_percentage")&&!$util.isInteger(V.occupancy_percentage))return"occupancy_percentage: integer expected";if(V.multi_carriage_details!=null&&V.hasOwnProperty("multi_carriage_details")){if(!Array.isArray(V.multi_carriage_details))return"multi_carriage_details: array expected";for(var re=0;re<V.multi_carriage_details.length;++re){var Z=$root.transit_realtime.VehiclePosition.CarriageDetails.verify(V.multi_carriage_details[re]);if(Z)return"multi_carriage_details."+Z}}return null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.VehiclePosition)return V;var Z=new $root.transit_realtime.VehiclePosition;if(V.trip!=null){if(typeof V.trip!="object")throw TypeError(".transit_realtime.VehiclePosition.trip: object expected");Z.trip=$root.transit_realtime.TripDescriptor.fromObject(V.trip)}if(V.vehicle!=null){if(typeof V.vehicle!="object")throw TypeError(".transit_realtime.VehiclePosition.vehicle: object expected");Z.vehicle=$root.transit_realtime.VehicleDescriptor.fromObject(V.vehicle)}if(V.position!=null){if(typeof V.position!="object")throw TypeError(".transit_realtime.VehiclePosition.position: object expected");Z.position=$root.transit_realtime.Position.fromObject(V.position)}switch(V.current_stop_sequence!=null&&(Z.current_stop_sequence=V.current_stop_sequence>>>0),V.stop_id!=null&&(Z.stop_id=String(V.stop_id)),V.current_status){case"INCOMING_AT":case 0:Z.current_status=0;break;case"STOPPED_AT":case 1:Z.current_status=1;break;default:if(typeof V.current_status=="number"){Z.current_status=V.current_status;break}break;case"IN_TRANSIT_TO":case 2:Z.current_status=2;break}switch(V.timestamp!=null&&($util.Long?(Z.timestamp=$util.Long.fromValue(V.timestamp)).unsigned=!0:typeof V.timestamp=="string"?Z.timestamp=parseInt(V.timestamp,10):typeof V.timestamp=="number"?Z.timestamp=V.timestamp:typeof V.timestamp=="object"&&(Z.timestamp=new $util.LongBits(V.timestamp.low>>>0,V.timestamp.high>>>0).toNumber(!0))),V.congestion_level){default:if(typeof V.congestion_level=="number"){Z.congestion_level=V.congestion_level;break}break;case"UNKNOWN_CONGESTION_LEVEL":case 0:Z.congestion_level=0;break;case"RUNNING_SMOOTHLY":case 1:Z.congestion_level=1;break;case"STOP_AND_GO":case 2:Z.congestion_level=2;break;case"CONGESTION":case 3:Z.congestion_level=3;break;case"SEVERE_CONGESTION":case 4:Z.congestion_level=4;break}switch(V.occupancy_status){default:if(typeof V.occupancy_status=="number"){Z.occupancy_status=V.occupancy_status;break}break;case"EMPTY":case 0:Z.occupancy_status=0;break;case"MANY_SEATS_AVAILABLE":case 1:Z.occupancy_status=1;break;case"FEW_SEATS_AVAILABLE":case 2:Z.occupancy_status=2;break;case"STANDING_ROOM_ONLY":case 3:Z.occupancy_status=3;break;case"CRUSHED_STANDING_ROOM_ONLY":case 4:Z.occupancy_status=4;break;case"FULL":case 5:Z.occupancy_status=5;break;case"NOT_ACCEPTING_PASSENGERS":case 6:Z.occupancy_status=6;break;case"NO_DATA_AVAILABLE":case 7:Z.occupancy_status=7;break;case"NOT_BOARDABLE":case 8:Z.occupancy_status=8;break}if(V.occupancy_percentage!=null&&(Z.occupancy_percentage=V.occupancy_percentage>>>0),V.multi_carriage_details){if(!Array.isArray(V.multi_carriage_details))throw TypeError(".transit_realtime.VehiclePosition.multi_carriage_details: array expected");Z.multi_carriage_details=[];for(var re=0;re<V.multi_carriage_details.length;++re){if(typeof V.multi_carriage_details[re]!="object")throw TypeError(".transit_realtime.VehiclePosition.multi_carriage_details: object expected");Z.multi_carriage_details[re]=$root.transit_realtime.VehiclePosition.CarriageDetails.fromObject(V.multi_carriage_details[re])}}return Z},W.toObject=function(V,Z){Z||(Z={});var re={};if((Z.arrays||Z.defaults)&&(re.multi_carriage_details=[]),Z.defaults){if(re.trip=null,re.position=null,re.current_stop_sequence=0,re.current_status=Z.enums===String?"IN_TRANSIT_TO":2,$util.Long){var se=new $util.Long(0,0,!0);re.timestamp=Z.longs===String?se.toString():Z.longs===Number?se.toNumber():se}else re.timestamp=Z.longs===String?"0":0;re.congestion_level=Z.enums===String?"UNKNOWN_CONGESTION_LEVEL":0,re.stop_id="",re.vehicle=null,re.occupancy_status=Z.enums===String?"EMPTY":0,re.occupancy_percentage=0}if(V.trip!=null&&V.hasOwnProperty("trip")&&(re.trip=$root.transit_realtime.TripDescriptor.toObject(V.trip,Z)),V.position!=null&&V.hasOwnProperty("position")&&(re.position=$root.transit_realtime.Position.toObject(V.position,Z)),V.current_stop_sequence!=null&&V.hasOwnProperty("current_stop_sequence")&&(re.current_stop_sequence=V.current_stop_sequence),V.current_status!=null&&V.hasOwnProperty("current_status")&&(re.current_status=Z.enums===String?$root.transit_realtime.VehiclePosition.VehicleStopStatus[V.current_status]===void 0?V.current_status:$root.transit_realtime.VehiclePosition.VehicleStopStatus[V.current_status]:V.current_status),V.timestamp!=null&&V.hasOwnProperty("timestamp")&&(typeof V.timestamp=="number"?re.timestamp=Z.longs===String?String(V.timestamp):V.timestamp:re.timestamp=Z.longs===String?$util.Long.prototype.toString.call(V.timestamp):Z.longs===Number?new $util.LongBits(V.timestamp.low>>>0,V.timestamp.high>>>0).toNumber(!0):V.timestamp),V.congestion_level!=null&&V.hasOwnProperty("congestion_level")&&(re.congestion_level=Z.enums===String?$root.transit_realtime.VehiclePosition.CongestionLevel[V.congestion_level]===void 0?V.congestion_level:$root.transit_realtime.VehiclePosition.CongestionLevel[V.congestion_level]:V.congestion_level),V.stop_id!=null&&V.hasOwnProperty("stop_id")&&(re.stop_id=V.stop_id),V.vehicle!=null&&V.hasOwnProperty("vehicle")&&(re.vehicle=$root.transit_realtime.VehicleDescriptor.toObject(V.vehicle,Z)),V.occupancy_status!=null&&V.hasOwnProperty("occupancy_status")&&(re.occupancy_status=Z.enums===String?$root.transit_realtime.VehiclePosition.OccupancyStatus[V.occupancy_status]===void 0?V.occupancy_status:$root.transit_realtime.VehiclePosition.OccupancyStatus[V.occupancy_status]:V.occupancy_status),V.occupancy_percentage!=null&&V.hasOwnProperty("occupancy_percentage")&&(re.occupancy_percentage=V.occupancy_percentage),V.multi_carriage_details&&V.multi_carriage_details.length){re.multi_carriage_details=[];for(var ue=0;ue<V.multi_carriage_details.length;++ue)re.multi_carriage_details[ue]=$root.transit_realtime.VehiclePosition.CarriageDetails.toObject(V.multi_carriage_details[ue],Z)}return re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.VehiclePosition"},W.VehicleStopStatus=function(){var X={},V=Object.create(X);return V[X[0]="INCOMING_AT"]=0,V[X[1]="STOPPED_AT"]=1,V[X[2]="IN_TRANSIT_TO"]=2,V}(),W.CongestionLevel=function(){var X={},V=Object.create(X);return V[X[0]="UNKNOWN_CONGESTION_LEVEL"]=0,V[X[1]="RUNNING_SMOOTHLY"]=1,V[X[2]="STOP_AND_GO"]=2,V[X[3]="CONGESTION"]=3,V[X[4]="SEVERE_CONGESTION"]=4,V}(),W.OccupancyStatus=function(){var X={},V=Object.create(X);return V[X[0]="EMPTY"]=0,V[X[1]="MANY_SEATS_AVAILABLE"]=1,V[X[2]="FEW_SEATS_AVAILABLE"]=2,V[X[3]="STANDING_ROOM_ONLY"]=3,V[X[4]="CRUSHED_STANDING_ROOM_ONLY"]=4,V[X[5]="FULL"]=5,V[X[6]="NOT_ACCEPTING_PASSENGERS"]=6,V[X[7]="NO_DATA_AVAILABLE"]=7,V[X[8]="NOT_BOARDABLE"]=8,V}(),W.CarriageDetails=function(){function X(V){if(V)for(var Z=Object.keys(V),re=0;re<Z.length;++re)V[Z[re]]!=null&&(this[Z[re]]=V[Z[re]])}return X.prototype.id="",X.prototype.label="",X.prototype.occupancy_status=7,X.prototype.occupancy_percentage=-1,X.prototype.carriage_sequence=0,X.create=function(Z){return new X(Z)},X.encode=function(Z,re){return re||(re=$Writer.create()),Z.id!=null&&Object.hasOwnProperty.call(Z,"id")&&re.uint32(10).string(Z.id),Z.label!=null&&Object.hasOwnProperty.call(Z,"label")&&re.uint32(18).string(Z.label),Z.occupancy_status!=null&&Object.hasOwnProperty.call(Z,"occupancy_status")&&re.uint32(24).int32(Z.occupancy_status),Z.occupancy_percentage!=null&&Object.hasOwnProperty.call(Z,"occupancy_percentage")&&re.uint32(32).int32(Z.occupancy_percentage),Z.carriage_sequence!=null&&Object.hasOwnProperty.call(Z,"carriage_sequence")&&re.uint32(40).uint32(Z.carriage_sequence),re},X.encodeDelimited=function(Z,re){return this.encode(Z,re).ldelim()},X.decode=function(Z,re){Z instanceof $Reader||(Z=$Reader.create(Z));for(var se=re===void 0?Z.len:Z.pos+re,ue=new $root.transit_realtime.VehiclePosition.CarriageDetails;Z.pos<se;){var H=Z.uint32();switch(H>>>3){case 1:{ue.id=Z.string();break}case 2:{ue.label=Z.string();break}case 3:{ue.occupancy_status=Z.int32();break}case 4:{ue.occupancy_percentage=Z.int32();break}case 5:{ue.carriage_sequence=Z.uint32();break}default:Z.skipType(H&7);break}}return ue},X.decodeDelimited=function(Z){return Z instanceof $Reader||(Z=new $Reader(Z)),this.decode(Z,Z.uint32())},X.verify=function(Z){if(typeof Z!="object"||Z===null)return"object expected";if(Z.id!=null&&Z.hasOwnProperty("id")&&!$util.isString(Z.id))return"id: string expected";if(Z.label!=null&&Z.hasOwnProperty("label")&&!$util.isString(Z.label))return"label: string expected";if(Z.occupancy_status!=null&&Z.hasOwnProperty("occupancy_status"))switch(Z.occupancy_status){default:return"occupancy_status: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:break}return Z.occupancy_percentage!=null&&Z.hasOwnProperty("occupancy_percentage")&&!$util.isInteger(Z.occupancy_percentage)?"occupancy_percentage: integer expected":Z.carriage_sequence!=null&&Z.hasOwnProperty("carriage_sequence")&&!$util.isInteger(Z.carriage_sequence)?"carriage_sequence: integer expected":null},X.fromObject=function(Z){if(Z instanceof $root.transit_realtime.VehiclePosition.CarriageDetails)return Z;var re=new $root.transit_realtime.VehiclePosition.CarriageDetails;switch(Z.id!=null&&(re.id=String(Z.id)),Z.label!=null&&(re.label=String(Z.label)),Z.occupancy_status){case"EMPTY":case 0:re.occupancy_status=0;break;case"MANY_SEATS_AVAILABLE":case 1:re.occupancy_status=1;break;case"FEW_SEATS_AVAILABLE":case 2:re.occupancy_status=2;break;case"STANDING_ROOM_ONLY":case 3:re.occupancy_status=3;break;case"CRUSHED_STANDING_ROOM_ONLY":case 4:re.occupancy_status=4;break;case"FULL":case 5:re.occupancy_status=5;break;case"NOT_ACCEPTING_PASSENGERS":case 6:re.occupancy_status=6;break;default:if(typeof Z.occupancy_status=="number"){re.occupancy_status=Z.occupancy_status;break}break;case"NO_DATA_AVAILABLE":case 7:re.occupancy_status=7;break;case"NOT_BOARDABLE":case 8:re.occupancy_status=8;break}return Z.occupancy_percentage!=null&&(re.occupancy_percentage=Z.occupancy_percentage|0),Z.carriage_sequence!=null&&(re.carriage_sequence=Z.carriage_sequence>>>0),re},X.toObject=function(Z,re){re||(re={});var se={};return re.defaults&&(se.id="",se.label="",se.occupancy_status=re.enums===String?"NO_DATA_AVAILABLE":7,se.occupancy_percentage=-1,se.carriage_sequence=0),Z.id!=null&&Z.hasOwnProperty("id")&&(se.id=Z.id),Z.label!=null&&Z.hasOwnProperty("label")&&(se.label=Z.label),Z.occupancy_status!=null&&Z.hasOwnProperty("occupancy_status")&&(se.occupancy_status=re.enums===String?$root.transit_realtime.VehiclePosition.OccupancyStatus[Z.occupancy_status]===void 0?Z.occupancy_status:$root.transit_realtime.VehiclePosition.OccupancyStatus[Z.occupancy_status]:Z.occupancy_status),Z.occupancy_percentage!=null&&Z.hasOwnProperty("occupancy_percentage")&&(se.occupancy_percentage=Z.occupancy_percentage),Z.carriage_sequence!=null&&Z.hasOwnProperty("carriage_sequence")&&(se.carriage_sequence=Z.carriage_sequence),se},X.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},X.getTypeUrl=function(Z){return Z===void 0&&(Z="type.googleapis.com"),Z+"/transit_realtime.VehiclePosition.CarriageDetails"},X}(),W}(),G.Alert=function(){function W(X){if(this.active_period=[],this.informed_entity=[],X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.active_period=$util.emptyArray,W.prototype.informed_entity=$util.emptyArray,W.prototype.cause=1,W.prototype.effect=8,W.prototype.url=null,W.prototype.header_text=null,W.prototype.description_text=null,W.prototype.tts_header_text=null,W.prototype.tts_description_text=null,W.prototype.severity_level=1,W.prototype.image=null,W.prototype.image_alternative_text=null,W.prototype.cause_detail=null,W.prototype.effect_detail=null,W.create=function(V){return new W(V)},W.encode=function(V,Z){if(Z||(Z=$Writer.create()),V.active_period!=null&&V.active_period.length)for(var re=0;re<V.active_period.length;++re)$root.transit_realtime.TimeRange.encode(V.active_period[re],Z.uint32(10).fork()).ldelim();if(V.informed_entity!=null&&V.informed_entity.length)for(var re=0;re<V.informed_entity.length;++re)$root.transit_realtime.EntitySelector.encode(V.informed_entity[re],Z.uint32(42).fork()).ldelim();return V.cause!=null&&Object.hasOwnProperty.call(V,"cause")&&Z.uint32(48).int32(V.cause),V.effect!=null&&Object.hasOwnProperty.call(V,"effect")&&Z.uint32(56).int32(V.effect),V.url!=null&&Object.hasOwnProperty.call(V,"url")&&$root.transit_realtime.TranslatedString.encode(V.url,Z.uint32(66).fork()).ldelim(),V.header_text!=null&&Object.hasOwnProperty.call(V,"header_text")&&$root.transit_realtime.TranslatedString.encode(V.header_text,Z.uint32(82).fork()).ldelim(),V.description_text!=null&&Object.hasOwnProperty.call(V,"description_text")&&$root.transit_realtime.TranslatedString.encode(V.description_text,Z.uint32(90).fork()).ldelim(),V.tts_header_text!=null&&Object.hasOwnProperty.call(V,"tts_header_text")&&$root.transit_realtime.TranslatedString.encode(V.tts_header_text,Z.uint32(98).fork()).ldelim(),V.tts_description_text!=null&&Object.hasOwnProperty.call(V,"tts_description_text")&&$root.transit_realtime.TranslatedString.encode(V.tts_description_text,Z.uint32(106).fork()).ldelim(),V.severity_level!=null&&Object.hasOwnProperty.call(V,"severity_level")&&Z.uint32(112).int32(V.severity_level),V.image!=null&&Object.hasOwnProperty.call(V,"image")&&$root.transit_realtime.TranslatedImage.encode(V.image,Z.uint32(122).fork()).ldelim(),V.image_alternative_text!=null&&Object.hasOwnProperty.call(V,"image_alternative_text")&&$root.transit_realtime.TranslatedString.encode(V.image_alternative_text,Z.uint32(130).fork()).ldelim(),V.cause_detail!=null&&Object.hasOwnProperty.call(V,"cause_detail")&&$root.transit_realtime.TranslatedString.encode(V.cause_detail,Z.uint32(138).fork()).ldelim(),V.effect_detail!=null&&Object.hasOwnProperty.call(V,"effect_detail")&&$root.transit_realtime.TranslatedString.encode(V.effect_detail,Z.uint32(146).fork()).ldelim(),Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.Alert;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.active_period&&se.active_period.length||(se.active_period=[]),se.active_period.push($root.transit_realtime.TimeRange.decode(V,V.uint32()));break}case 5:{se.informed_entity&&se.informed_entity.length||(se.informed_entity=[]),se.informed_entity.push($root.transit_realtime.EntitySelector.decode(V,V.uint32()));break}case 6:{se.cause=V.int32();break}case 7:{se.effect=V.int32();break}case 8:{se.url=$root.transit_realtime.TranslatedString.decode(V,V.uint32());break}case 10:{se.header_text=$root.transit_realtime.TranslatedString.decode(V,V.uint32());break}case 11:{se.description_text=$root.transit_realtime.TranslatedString.decode(V,V.uint32());break}case 12:{se.tts_header_text=$root.transit_realtime.TranslatedString.decode(V,V.uint32());break}case 13:{se.tts_description_text=$root.transit_realtime.TranslatedString.decode(V,V.uint32());break}case 14:{se.severity_level=V.int32();break}case 15:{se.image=$root.transit_realtime.TranslatedImage.decode(V,V.uint32());break}case 16:{se.image_alternative_text=$root.transit_realtime.TranslatedString.decode(V,V.uint32());break}case 17:{se.cause_detail=$root.transit_realtime.TranslatedString.decode(V,V.uint32());break}case 18:{se.effect_detail=$root.transit_realtime.TranslatedString.decode(V,V.uint32());break}default:V.skipType(ue&7);break}}return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){if(typeof V!="object"||V===null)return"object expected";if(V.active_period!=null&&V.hasOwnProperty("active_period")){if(!Array.isArray(V.active_period))return"active_period: array expected";for(var Z=0;Z<V.active_period.length;++Z){var re=$root.transit_realtime.TimeRange.verify(V.active_period[Z]);if(re)return"active_period."+re}}if(V.informed_entity!=null&&V.hasOwnProperty("informed_entity")){if(!Array.isArray(V.informed_entity))return"informed_entity: array expected";for(var Z=0;Z<V.informed_entity.length;++Z){var re=$root.transit_realtime.EntitySelector.verify(V.informed_entity[Z]);if(re)return"informed_entity."+re}}if(V.cause!=null&&V.hasOwnProperty("cause"))switch(V.cause){default:return"cause: enum value expected";case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:break}if(V.effect!=null&&V.hasOwnProperty("effect"))switch(V.effect){default:return"effect: enum value expected";case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:break}if(V.url!=null&&V.hasOwnProperty("url")){var re=$root.transit_realtime.TranslatedString.verify(V.url);if(re)return"url."+re}if(V.header_text!=null&&V.hasOwnProperty("header_text")){var re=$root.transit_realtime.TranslatedString.verify(V.header_text);if(re)return"header_text."+re}if(V.description_text!=null&&V.hasOwnProperty("description_text")){var re=$root.transit_realtime.TranslatedString.verify(V.description_text);if(re)return"description_text."+re}if(V.tts_header_text!=null&&V.hasOwnProperty("tts_header_text")){var re=$root.transit_realtime.TranslatedString.verify(V.tts_header_text);if(re)return"tts_header_text."+re}if(V.tts_description_text!=null&&V.hasOwnProperty("tts_description_text")){var re=$root.transit_realtime.TranslatedString.verify(V.tts_description_text);if(re)return"tts_description_text."+re}if(V.severity_level!=null&&V.hasOwnProperty("severity_level"))switch(V.severity_level){default:return"severity_level: enum value expected";case 1:case 2:case 3:case 4:break}if(V.image!=null&&V.hasOwnProperty("image")){var re=$root.transit_realtime.TranslatedImage.verify(V.image);if(re)return"image."+re}if(V.image_alternative_text!=null&&V.hasOwnProperty("image_alternative_text")){var re=$root.transit_realtime.TranslatedString.verify(V.image_alternative_text);if(re)return"image_alternative_text."+re}if(V.cause_detail!=null&&V.hasOwnProperty("cause_detail")){var re=$root.transit_realtime.TranslatedString.verify(V.cause_detail);if(re)return"cause_detail."+re}if(V.effect_detail!=null&&V.hasOwnProperty("effect_detail")){var re=$root.transit_realtime.TranslatedString.verify(V.effect_detail);if(re)return"effect_detail."+re}return null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.Alert)return V;var Z=new $root.transit_realtime.Alert;if(V.active_period){if(!Array.isArray(V.active_period))throw TypeError(".transit_realtime.Alert.active_period: array expected");Z.active_period=[];for(var re=0;re<V.active_period.length;++re){if(typeof V.active_period[re]!="object")throw TypeError(".transit_realtime.Alert.active_period: object expected");Z.active_period[re]=$root.transit_realtime.TimeRange.fromObject(V.active_period[re])}}if(V.informed_entity){if(!Array.isArray(V.informed_entity))throw TypeError(".transit_realtime.Alert.informed_entity: array expected");Z.informed_entity=[];for(var re=0;re<V.informed_entity.length;++re){if(typeof V.informed_entity[re]!="object")throw TypeError(".transit_realtime.Alert.informed_entity: object expected");Z.informed_entity[re]=$root.transit_realtime.EntitySelector.fromObject(V.informed_entity[re])}}switch(V.cause){default:if(typeof V.cause=="number"){Z.cause=V.cause;break}break;case"UNKNOWN_CAUSE":case 1:Z.cause=1;break;case"OTHER_CAUSE":case 2:Z.cause=2;break;case"TECHNICAL_PROBLEM":case 3:Z.cause=3;break;case"STRIKE":case 4:Z.cause=4;break;case"DEMONSTRATION":case 5:Z.cause=5;break;case"ACCIDENT":case 6:Z.cause=6;break;case"HOLIDAY":case 7:Z.cause=7;break;case"WEATHER":case 8:Z.cause=8;break;case"MAINTENANCE":case 9:Z.cause=9;break;case"CONSTRUCTION":case 10:Z.cause=10;break;case"POLICE_ACTIVITY":case 11:Z.cause=11;break;case"MEDICAL_EMERGENCY":case 12:Z.cause=12;break}switch(V.effect){case"NO_SERVICE":case 1:Z.effect=1;break;case"REDUCED_SERVICE":case 2:Z.effect=2;break;case"SIGNIFICANT_DELAYS":case 3:Z.effect=3;break;case"DETOUR":case 4:Z.effect=4;break;case"ADDITIONAL_SERVICE":case 5:Z.effect=5;break;case"MODIFIED_SERVICE":case 6:Z.effect=6;break;case"OTHER_EFFECT":case 7:Z.effect=7;break;default:if(typeof V.effect=="number"){Z.effect=V.effect;break}break;case"UNKNOWN_EFFECT":case 8:Z.effect=8;break;case"STOP_MOVED":case 9:Z.effect=9;break;case"NO_EFFECT":case 10:Z.effect=10;break;case"ACCESSIBILITY_ISSUE":case 11:Z.effect=11;break}if(V.url!=null){if(typeof V.url!="object")throw TypeError(".transit_realtime.Alert.url: object expected");Z.url=$root.transit_realtime.TranslatedString.fromObject(V.url)}if(V.header_text!=null){if(typeof V.header_text!="object")throw TypeError(".transit_realtime.Alert.header_text: object expected");Z.header_text=$root.transit_realtime.TranslatedString.fromObject(V.header_text)}if(V.description_text!=null){if(typeof V.description_text!="object")throw TypeError(".transit_realtime.Alert.description_text: object expected");Z.description_text=$root.transit_realtime.TranslatedString.fromObject(V.description_text)}if(V.tts_header_text!=null){if(typeof V.tts_header_text!="object")throw TypeError(".transit_realtime.Alert.tts_header_text: object expected");Z.tts_header_text=$root.transit_realtime.TranslatedString.fromObject(V.tts_header_text)}if(V.tts_description_text!=null){if(typeof V.tts_description_text!="object")throw TypeError(".transit_realtime.Alert.tts_description_text: object expected");Z.tts_description_text=$root.transit_realtime.TranslatedString.fromObject(V.tts_description_text)}switch(V.severity_level){default:if(typeof V.severity_level=="number"){Z.severity_level=V.severity_level;break}break;case"UNKNOWN_SEVERITY":case 1:Z.severity_level=1;break;case"INFO":case 2:Z.severity_level=2;break;case"WARNING":case 3:Z.severity_level=3;break;case"SEVERE":case 4:Z.severity_level=4;break}if(V.image!=null){if(typeof V.image!="object")throw TypeError(".transit_realtime.Alert.image: object expected");Z.image=$root.transit_realtime.TranslatedImage.fromObject(V.image)}if(V.image_alternative_text!=null){if(typeof V.image_alternative_text!="object")throw TypeError(".transit_realtime.Alert.image_alternative_text: object expected");Z.image_alternative_text=$root.transit_realtime.TranslatedString.fromObject(V.image_alternative_text)}if(V.cause_detail!=null){if(typeof V.cause_detail!="object")throw TypeError(".transit_realtime.Alert.cause_detail: object expected");Z.cause_detail=$root.transit_realtime.TranslatedString.fromObject(V.cause_detail)}if(V.effect_detail!=null){if(typeof V.effect_detail!="object")throw TypeError(".transit_realtime.Alert.effect_detail: object expected");Z.effect_detail=$root.transit_realtime.TranslatedString.fromObject(V.effect_detail)}return Z},W.toObject=function(V,Z){Z||(Z={});var re={};if((Z.arrays||Z.defaults)&&(re.active_period=[],re.informed_entity=[]),Z.defaults&&(re.cause=Z.enums===String?"UNKNOWN_CAUSE":1,re.effect=Z.enums===String?"UNKNOWN_EFFECT":8,re.url=null,re.header_text=null,re.description_text=null,re.tts_header_text=null,re.tts_description_text=null,re.severity_level=Z.enums===String?"UNKNOWN_SEVERITY":1,re.image=null,re.image_alternative_text=null,re.cause_detail=null,re.effect_detail=null),V.active_period&&V.active_period.length){re.active_period=[];for(var se=0;se<V.active_period.length;++se)re.active_period[se]=$root.transit_realtime.TimeRange.toObject(V.active_period[se],Z)}if(V.informed_entity&&V.informed_entity.length){re.informed_entity=[];for(var se=0;se<V.informed_entity.length;++se)re.informed_entity[se]=$root.transit_realtime.EntitySelector.toObject(V.informed_entity[se],Z)}return V.cause!=null&&V.hasOwnProperty("cause")&&(re.cause=Z.enums===String?$root.transit_realtime.Alert.Cause[V.cause]===void 0?V.cause:$root.transit_realtime.Alert.Cause[V.cause]:V.cause),V.effect!=null&&V.hasOwnProperty("effect")&&(re.effect=Z.enums===String?$root.transit_realtime.Alert.Effect[V.effect]===void 0?V.effect:$root.transit_realtime.Alert.Effect[V.effect]:V.effect),V.url!=null&&V.hasOwnProperty("url")&&(re.url=$root.transit_realtime.TranslatedString.toObject(V.url,Z)),V.header_text!=null&&V.hasOwnProperty("header_text")&&(re.header_text=$root.transit_realtime.TranslatedString.toObject(V.header_text,Z)),V.description_text!=null&&V.hasOwnProperty("description_text")&&(re.description_text=$root.transit_realtime.TranslatedString.toObject(V.description_text,Z)),V.tts_header_text!=null&&V.hasOwnProperty("tts_header_text")&&(re.tts_header_text=$root.transit_realtime.TranslatedString.toObject(V.tts_header_text,Z)),V.tts_description_text!=null&&V.hasOwnProperty("tts_description_text")&&(re.tts_description_text=$root.transit_realtime.TranslatedString.toObject(V.tts_description_text,Z)),V.severity_level!=null&&V.hasOwnProperty("severity_level")&&(re.severity_level=Z.enums===String?$root.transit_realtime.Alert.SeverityLevel[V.severity_level]===void 0?V.severity_level:$root.transit_realtime.Alert.SeverityLevel[V.severity_level]:V.severity_level),V.image!=null&&V.hasOwnProperty("image")&&(re.image=$root.transit_realtime.TranslatedImage.toObject(V.image,Z)),V.image_alternative_text!=null&&V.hasOwnProperty("image_alternative_text")&&(re.image_alternative_text=$root.transit_realtime.TranslatedString.toObject(V.image_alternative_text,Z)),V.cause_detail!=null&&V.hasOwnProperty("cause_detail")&&(re.cause_detail=$root.transit_realtime.TranslatedString.toObject(V.cause_detail,Z)),V.effect_detail!=null&&V.hasOwnProperty("effect_detail")&&(re.effect_detail=$root.transit_realtime.TranslatedString.toObject(V.effect_detail,Z)),re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.Alert"},W.Cause=function(){var X={},V=Object.create(X);return V[X[1]="UNKNOWN_CAUSE"]=1,V[X[2]="OTHER_CAUSE"]=2,V[X[3]="TECHNICAL_PROBLEM"]=3,V[X[4]="STRIKE"]=4,V[X[5]="DEMONSTRATION"]=5,V[X[6]="ACCIDENT"]=6,V[X[7]="HOLIDAY"]=7,V[X[8]="WEATHER"]=8,V[X[9]="MAINTENANCE"]=9,V[X[10]="CONSTRUCTION"]=10,V[X[11]="POLICE_ACTIVITY"]=11,V[X[12]="MEDICAL_EMERGENCY"]=12,V}(),W.Effect=function(){var X={},V=Object.create(X);return V[X[1]="NO_SERVICE"]=1,V[X[2]="REDUCED_SERVICE"]=2,V[X[3]="SIGNIFICANT_DELAYS"]=3,V[X[4]="DETOUR"]=4,V[X[5]="ADDITIONAL_SERVICE"]=5,V[X[6]="MODIFIED_SERVICE"]=6,V[X[7]="OTHER_EFFECT"]=7,V[X[8]="UNKNOWN_EFFECT"]=8,V[X[9]="STOP_MOVED"]=9,V[X[10]="NO_EFFECT"]=10,V[X[11]="ACCESSIBILITY_ISSUE"]=11,V}(),W.SeverityLevel=function(){var X={},V=Object.create(X);return V[X[1]="UNKNOWN_SEVERITY"]=1,V[X[2]="INFO"]=2,V[X[3]="WARNING"]=3,V[X[4]="SEVERE"]=4,V}(),W}(),G.TimeRange=function(){function W(X){if(X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.start=$util.Long?$util.Long.fromBits(0,0,!0):0,W.prototype.end=$util.Long?$util.Long.fromBits(0,0,!0):0,W.create=function(V){return new W(V)},W.encode=function(V,Z){return Z||(Z=$Writer.create()),V.start!=null&&Object.hasOwnProperty.call(V,"start")&&Z.uint32(8).uint64(V.start),V.end!=null&&Object.hasOwnProperty.call(V,"end")&&Z.uint32(16).uint64(V.end),Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.TimeRange;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.start=V.uint64();break}case 2:{se.end=V.uint64();break}default:V.skipType(ue&7);break}}return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){return typeof V!="object"||V===null?"object expected":V.start!=null&&V.hasOwnProperty("start")&&!$util.isInteger(V.start)&&!(V.start&&$util.isInteger(V.start.low)&&$util.isInteger(V.start.high))?"start: integer|Long expected":V.end!=null&&V.hasOwnProperty("end")&&!$util.isInteger(V.end)&&!(V.end&&$util.isInteger(V.end.low)&&$util.isInteger(V.end.high))?"end: integer|Long expected":null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.TimeRange)return V;var Z=new $root.transit_realtime.TimeRange;return V.start!=null&&($util.Long?(Z.start=$util.Long.fromValue(V.start)).unsigned=!0:typeof V.start=="string"?Z.start=parseInt(V.start,10):typeof V.start=="number"?Z.start=V.start:typeof V.start=="object"&&(Z.start=new $util.LongBits(V.start.low>>>0,V.start.high>>>0).toNumber(!0))),V.end!=null&&($util.Long?(Z.end=$util.Long.fromValue(V.end)).unsigned=!0:typeof V.end=="string"?Z.end=parseInt(V.end,10):typeof V.end=="number"?Z.end=V.end:typeof V.end=="object"&&(Z.end=new $util.LongBits(V.end.low>>>0,V.end.high>>>0).toNumber(!0))),Z},W.toObject=function(V,Z){Z||(Z={});var re={};if(Z.defaults){if($util.Long){var se=new $util.Long(0,0,!0);re.start=Z.longs===String?se.toString():Z.longs===Number?se.toNumber():se}else re.start=Z.longs===String?"0":0;if($util.Long){var se=new $util.Long(0,0,!0);re.end=Z.longs===String?se.toString():Z.longs===Number?se.toNumber():se}else re.end=Z.longs===String?"0":0}return V.start!=null&&V.hasOwnProperty("start")&&(typeof V.start=="number"?re.start=Z.longs===String?String(V.start):V.start:re.start=Z.longs===String?$util.Long.prototype.toString.call(V.start):Z.longs===Number?new $util.LongBits(V.start.low>>>0,V.start.high>>>0).toNumber(!0):V.start),V.end!=null&&V.hasOwnProperty("end")&&(typeof V.end=="number"?re.end=Z.longs===String?String(V.end):V.end:re.end=Z.longs===String?$util.Long.prototype.toString.call(V.end):Z.longs===Number?new $util.LongBits(V.end.low>>>0,V.end.high>>>0).toNumber(!0):V.end),re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.TimeRange"},W}(),G.Position=function(){function W(X){if(X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.latitude=0,W.prototype.longitude=0,W.prototype.bearing=0,W.prototype.odometer=0,W.prototype.speed=0,W.create=function(V){return new W(V)},W.encode=function(V,Z){return Z||(Z=$Writer.create()),Z.uint32(13).float(V.latitude),Z.uint32(21).float(V.longitude),V.bearing!=null&&Object.hasOwnProperty.call(V,"bearing")&&Z.uint32(29).float(V.bearing),V.odometer!=null&&Object.hasOwnProperty.call(V,"odometer")&&Z.uint32(33).double(V.odometer),V.speed!=null&&Object.hasOwnProperty.call(V,"speed")&&Z.uint32(45).float(V.speed),Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.Position;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.latitude=V.float();break}case 2:{se.longitude=V.float();break}case 3:{se.bearing=V.float();break}case 4:{se.odometer=V.double();break}case 5:{se.speed=V.float();break}default:V.skipType(ue&7);break}}if(!se.hasOwnProperty("latitude"))throw $util.ProtocolError("missing required 'latitude'",{instance:se});if(!se.hasOwnProperty("longitude"))throw $util.ProtocolError("missing required 'longitude'",{instance:se});return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){return typeof V!="object"||V===null?"object expected":typeof V.latitude!="number"?"latitude: number expected":typeof V.longitude!="number"?"longitude: number expected":V.bearing!=null&&V.hasOwnProperty("bearing")&&typeof V.bearing!="number"?"bearing: number expected":V.odometer!=null&&V.hasOwnProperty("odometer")&&typeof V.odometer!="number"?"odometer: number expected":V.speed!=null&&V.hasOwnProperty("speed")&&typeof V.speed!="number"?"speed: number expected":null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.Position)return V;var Z=new $root.transit_realtime.Position;return V.latitude!=null&&(Z.latitude=Number(V.latitude)),V.longitude!=null&&(Z.longitude=Number(V.longitude)),V.bearing!=null&&(Z.bearing=Number(V.bearing)),V.odometer!=null&&(Z.odometer=Number(V.odometer)),V.speed!=null&&(Z.speed=Number(V.speed)),Z},W.toObject=function(V,Z){Z||(Z={});var re={};return Z.defaults&&(re.latitude=0,re.longitude=0,re.bearing=0,re.odometer=0,re.speed=0),V.latitude!=null&&V.hasOwnProperty("latitude")&&(re.latitude=Z.json&&!isFinite(V.latitude)?String(V.latitude):V.latitude),V.longitude!=null&&V.hasOwnProperty("longitude")&&(re.longitude=Z.json&&!isFinite(V.longitude)?String(V.longitude):V.longitude),V.bearing!=null&&V.hasOwnProperty("bearing")&&(re.bearing=Z.json&&!isFinite(V.bearing)?String(V.bearing):V.bearing),V.odometer!=null&&V.hasOwnProperty("odometer")&&(re.odometer=Z.json&&!isFinite(V.odometer)?String(V.odometer):V.odometer),V.speed!=null&&V.hasOwnProperty("speed")&&(re.speed=Z.json&&!isFinite(V.speed)?String(V.speed):V.speed),re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.Position"},W}(),G.TripDescriptor=function(){function W(X){if(X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.trip_id="",W.prototype.route_id="",W.prototype.direction_id=0,W.prototype.start_time="",W.prototype.start_date="",W.prototype.schedule_relationship=0,W.create=function(V){return new W(V)},W.encode=function(V,Z){return Z||(Z=$Writer.create()),V.trip_id!=null&&Object.hasOwnProperty.call(V,"trip_id")&&Z.uint32(10).string(V.trip_id),V.start_time!=null&&Object.hasOwnProperty.call(V,"start_time")&&Z.uint32(18).string(V.start_time),V.start_date!=null&&Object.hasOwnProperty.call(V,"start_date")&&Z.uint32(26).string(V.start_date),V.schedule_relationship!=null&&Object.hasOwnProperty.call(V,"schedule_relationship")&&Z.uint32(32).int32(V.schedule_relationship),V.route_id!=null&&Object.hasOwnProperty.call(V,"route_id")&&Z.uint32(42).string(V.route_id),V.direction_id!=null&&Object.hasOwnProperty.call(V,"direction_id")&&Z.uint32(48).uint32(V.direction_id),Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.TripDescriptor;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.trip_id=V.string();break}case 5:{se.route_id=V.string();break}case 6:{se.direction_id=V.uint32();break}case 2:{se.start_time=V.string();break}case 3:{se.start_date=V.string();break}case 4:{se.schedule_relationship=V.int32();break}default:V.skipType(ue&7);break}}return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){if(typeof V!="object"||V===null)return"object expected";if(V.trip_id!=null&&V.hasOwnProperty("trip_id")&&!$util.isString(V.trip_id))return"trip_id: string expected";if(V.route_id!=null&&V.hasOwnProperty("route_id")&&!$util.isString(V.route_id))return"route_id: string expected";if(V.direction_id!=null&&V.hasOwnProperty("direction_id")&&!$util.isInteger(V.direction_id))return"direction_id: integer expected";if(V.start_time!=null&&V.hasOwnProperty("start_time")&&!$util.isString(V.start_time))return"start_time: string expected";if(V.start_date!=null&&V.hasOwnProperty("start_date")&&!$util.isString(V.start_date))return"start_date: string expected";if(V.schedule_relationship!=null&&V.hasOwnProperty("schedule_relationship"))switch(V.schedule_relationship){default:return"schedule_relationship: enum value expected";case 0:case 1:case 2:case 3:case 5:case 6:case 7:break}return null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.TripDescriptor)return V;var Z=new $root.transit_realtime.TripDescriptor;switch(V.trip_id!=null&&(Z.trip_id=String(V.trip_id)),V.route_id!=null&&(Z.route_id=String(V.route_id)),V.direction_id!=null&&(Z.direction_id=V.direction_id>>>0),V.start_time!=null&&(Z.start_time=String(V.start_time)),V.start_date!=null&&(Z.start_date=String(V.start_date)),V.schedule_relationship){default:if(typeof V.schedule_relationship=="number"){Z.schedule_relationship=V.schedule_relationship;break}break;case"SCHEDULED":case 0:Z.schedule_relationship=0;break;case"ADDED":case 1:Z.schedule_relationship=1;break;case"UNSCHEDULED":case 2:Z.schedule_relationship=2;break;case"CANCELED":case 3:Z.schedule_relationship=3;break;case"REPLACEMENT":case 5:Z.schedule_relationship=5;break;case"DUPLICATED":case 6:Z.schedule_relationship=6;break;case"DELETED":case 7:Z.schedule_relationship=7;break}return Z},W.toObject=function(V,Z){Z||(Z={});var re={};return Z.defaults&&(re.trip_id="",re.start_time="",re.start_date="",re.schedule_relationship=Z.enums===String?"SCHEDULED":0,re.route_id="",re.direction_id=0),V.trip_id!=null&&V.hasOwnProperty("trip_id")&&(re.trip_id=V.trip_id),V.start_time!=null&&V.hasOwnProperty("start_time")&&(re.start_time=V.start_time),V.start_date!=null&&V.hasOwnProperty("start_date")&&(re.start_date=V.start_date),V.schedule_relationship!=null&&V.hasOwnProperty("schedule_relationship")&&(re.schedule_relationship=Z.enums===String?$root.transit_realtime.TripDescriptor.ScheduleRelationship[V.schedule_relationship]===void 0?V.schedule_relationship:$root.transit_realtime.TripDescriptor.ScheduleRelationship[V.schedule_relationship]:V.schedule_relationship),V.route_id!=null&&V.hasOwnProperty("route_id")&&(re.route_id=V.route_id),V.direction_id!=null&&V.hasOwnProperty("direction_id")&&(re.direction_id=V.direction_id),re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.TripDescriptor"},W.ScheduleRelationship=function(){var X={},V=Object.create(X);return V[X[0]="SCHEDULED"]=0,V[X[1]="ADDED"]=1,V[X[2]="UNSCHEDULED"]=2,V[X[3]="CANCELED"]=3,V[X[5]="REPLACEMENT"]=5,V[X[6]="DUPLICATED"]=6,V[X[7]="DELETED"]=7,V}(),W}(),G.VehicleDescriptor=function(){function W(X){if(X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.id="",W.prototype.label="",W.prototype.license_plate="",W.prototype.wheelchair_accessible=0,W.create=function(V){return new W(V)},W.encode=function(V,Z){return Z||(Z=$Writer.create()),V.id!=null&&Object.hasOwnProperty.call(V,"id")&&Z.uint32(10).string(V.id),V.label!=null&&Object.hasOwnProperty.call(V,"label")&&Z.uint32(18).string(V.label),V.license_plate!=null&&Object.hasOwnProperty.call(V,"license_plate")&&Z.uint32(26).string(V.license_plate),V.wheelchair_accessible!=null&&Object.hasOwnProperty.call(V,"wheelchair_accessible")&&Z.uint32(32).int32(V.wheelchair_accessible),Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.VehicleDescriptor;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.id=V.string();break}case 2:{se.label=V.string();break}case 3:{se.license_plate=V.string();break}case 4:{se.wheelchair_accessible=V.int32();break}default:V.skipType(ue&7);break}}return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){if(typeof V!="object"||V===null)return"object expected";if(V.id!=null&&V.hasOwnProperty("id")&&!$util.isString(V.id))return"id: string expected";if(V.label!=null&&V.hasOwnProperty("label")&&!$util.isString(V.label))return"label: string expected";if(V.license_plate!=null&&V.hasOwnProperty("license_plate")&&!$util.isString(V.license_plate))return"license_plate: string expected";if(V.wheelchair_accessible!=null&&V.hasOwnProperty("wheelchair_accessible"))switch(V.wheelchair_accessible){default:return"wheelchair_accessible: enum value expected";case 0:case 1:case 2:case 3:break}return null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.VehicleDescriptor)return V;var Z=new $root.transit_realtime.VehicleDescriptor;switch(V.id!=null&&(Z.id=String(V.id)),V.label!=null&&(Z.label=String(V.label)),V.license_plate!=null&&(Z.license_plate=String(V.license_plate)),V.wheelchair_accessible){default:if(typeof V.wheelchair_accessible=="number"){Z.wheelchair_accessible=V.wheelchair_accessible;break}break;case"NO_VALUE":case 0:Z.wheelchair_accessible=0;break;case"UNKNOWN":case 1:Z.wheelchair_accessible=1;break;case"WHEELCHAIR_ACCESSIBLE":case 2:Z.wheelchair_accessible=2;break;case"WHEELCHAIR_INACCESSIBLE":case 3:Z.wheelchair_accessible=3;break}return Z},W.toObject=function(V,Z){Z||(Z={});var re={};return Z.defaults&&(re.id="",re.label="",re.license_plate="",re.wheelchair_accessible=Z.enums===String?"NO_VALUE":0),V.id!=null&&V.hasOwnProperty("id")&&(re.id=V.id),V.label!=null&&V.hasOwnProperty("label")&&(re.label=V.label),V.license_plate!=null&&V.hasOwnProperty("license_plate")&&(re.license_plate=V.license_plate),V.wheelchair_accessible!=null&&V.hasOwnProperty("wheelchair_accessible")&&(re.wheelchair_accessible=Z.enums===String?$root.transit_realtime.VehicleDescriptor.WheelchairAccessible[V.wheelchair_accessible]===void 0?V.wheelchair_accessible:$root.transit_realtime.VehicleDescriptor.WheelchairAccessible[V.wheelchair_accessible]:V.wheelchair_accessible),re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.VehicleDescriptor"},W.WheelchairAccessible=function(){var X={},V=Object.create(X);return V[X[0]="NO_VALUE"]=0,V[X[1]="UNKNOWN"]=1,V[X[2]="WHEELCHAIR_ACCESSIBLE"]=2,V[X[3]="WHEELCHAIR_INACCESSIBLE"]=3,V}(),W}(),G.EntitySelector=function(){function W(X){if(X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.agency_id="",W.prototype.route_id="",W.prototype.route_type=0,W.prototype.trip=null,W.prototype.stop_id="",W.prototype.direction_id=0,W.create=function(V){return new W(V)},W.encode=function(V,Z){return Z||(Z=$Writer.create()),V.agency_id!=null&&Object.hasOwnProperty.call(V,"agency_id")&&Z.uint32(10).string(V.agency_id),V.route_id!=null&&Object.hasOwnProperty.call(V,"route_id")&&Z.uint32(18).string(V.route_id),V.route_type!=null&&Object.hasOwnProperty.call(V,"route_type")&&Z.uint32(24).int32(V.route_type),V.trip!=null&&Object.hasOwnProperty.call(V,"trip")&&$root.transit_realtime.TripDescriptor.encode(V.trip,Z.uint32(34).fork()).ldelim(),V.stop_id!=null&&Object.hasOwnProperty.call(V,"stop_id")&&Z.uint32(42).string(V.stop_id),V.direction_id!=null&&Object.hasOwnProperty.call(V,"direction_id")&&Z.uint32(48).uint32(V.direction_id),Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.EntitySelector;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.agency_id=V.string();break}case 2:{se.route_id=V.string();break}case 3:{se.route_type=V.int32();break}case 4:{se.trip=$root.transit_realtime.TripDescriptor.decode(V,V.uint32());break}case 5:{se.stop_id=V.string();break}case 6:{se.direction_id=V.uint32();break}default:V.skipType(ue&7);break}}return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){if(typeof V!="object"||V===null)return"object expected";if(V.agency_id!=null&&V.hasOwnProperty("agency_id")&&!$util.isString(V.agency_id))return"agency_id: string expected";if(V.route_id!=null&&V.hasOwnProperty("route_id")&&!$util.isString(V.route_id))return"route_id: string expected";if(V.route_type!=null&&V.hasOwnProperty("route_type")&&!$util.isInteger(V.route_type))return"route_type: integer expected";if(V.trip!=null&&V.hasOwnProperty("trip")){var Z=$root.transit_realtime.TripDescriptor.verify(V.trip);if(Z)return"trip."+Z}return V.stop_id!=null&&V.hasOwnProperty("stop_id")&&!$util.isString(V.stop_id)?"stop_id: string expected":V.direction_id!=null&&V.hasOwnProperty("direction_id")&&!$util.isInteger(V.direction_id)?"direction_id: integer expected":null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.EntitySelector)return V;var Z=new $root.transit_realtime.EntitySelector;if(V.agency_id!=null&&(Z.agency_id=String(V.agency_id)),V.route_id!=null&&(Z.route_id=String(V.route_id)),V.route_type!=null&&(Z.route_type=V.route_type|0),V.trip!=null){if(typeof V.trip!="object")throw TypeError(".transit_realtime.EntitySelector.trip: object expected");Z.trip=$root.transit_realtime.TripDescriptor.fromObject(V.trip)}return V.stop_id!=null&&(Z.stop_id=String(V.stop_id)),V.direction_id!=null&&(Z.direction_id=V.direction_id>>>0),Z},W.toObject=function(V,Z){Z||(Z={});var re={};return Z.defaults&&(re.agency_id="",re.route_id="",re.route_type=0,re.trip=null,re.stop_id="",re.direction_id=0),V.agency_id!=null&&V.hasOwnProperty("agency_id")&&(re.agency_id=V.agency_id),V.route_id!=null&&V.hasOwnProperty("route_id")&&(re.route_id=V.route_id),V.route_type!=null&&V.hasOwnProperty("route_type")&&(re.route_type=V.route_type),V.trip!=null&&V.hasOwnProperty("trip")&&(re.trip=$root.transit_realtime.TripDescriptor.toObject(V.trip,Z)),V.stop_id!=null&&V.hasOwnProperty("stop_id")&&(re.stop_id=V.stop_id),V.direction_id!=null&&V.hasOwnProperty("direction_id")&&(re.direction_id=V.direction_id),re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.EntitySelector"},W}(),G.TranslatedString=function(){function W(X){if(this.translation=[],X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.translation=$util.emptyArray,W.create=function(V){return new W(V)},W.encode=function(V,Z){if(Z||(Z=$Writer.create()),V.translation!=null&&V.translation.length)for(var re=0;re<V.translation.length;++re)$root.transit_realtime.TranslatedString.Translation.encode(V.translation[re],Z.uint32(10).fork()).ldelim();return Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.TranslatedString;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.translation&&se.translation.length||(se.translation=[]),se.translation.push($root.transit_realtime.TranslatedString.Translation.decode(V,V.uint32()));break}default:V.skipType(ue&7);break}}return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){if(typeof V!="object"||V===null)return"object expected";if(V.translation!=null&&V.hasOwnProperty("translation")){if(!Array.isArray(V.translation))return"translation: array expected";for(var Z=0;Z<V.translation.length;++Z){var re=$root.transit_realtime.TranslatedString.Translation.verify(V.translation[Z]);if(re)return"translation."+re}}return null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.TranslatedString)return V;var Z=new $root.transit_realtime.TranslatedString;if(V.translation){if(!Array.isArray(V.translation))throw TypeError(".transit_realtime.TranslatedString.translation: array expected");Z.translation=[];for(var re=0;re<V.translation.length;++re){if(typeof V.translation[re]!="object")throw TypeError(".transit_realtime.TranslatedString.translation: object expected");Z.translation[re]=$root.transit_realtime.TranslatedString.Translation.fromObject(V.translation[re])}}return Z},W.toObject=function(V,Z){Z||(Z={});var re={};if((Z.arrays||Z.defaults)&&(re.translation=[]),V.translation&&V.translation.length){re.translation=[];for(var se=0;se<V.translation.length;++se)re.translation[se]=$root.transit_realtime.TranslatedString.Translation.toObject(V.translation[se],Z)}return re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.TranslatedString"},W.Translation=function(){function X(V){if(V)for(var Z=Object.keys(V),re=0;re<Z.length;++re)V[Z[re]]!=null&&(this[Z[re]]=V[Z[re]])}return X.prototype.text="",X.prototype.language="",X.create=function(Z){return new X(Z)},X.encode=function(Z,re){return re||(re=$Writer.create()),re.uint32(10).string(Z.text),Z.language!=null&&Object.hasOwnProperty.call(Z,"language")&&re.uint32(18).string(Z.language),re},X.encodeDelimited=function(Z,re){return this.encode(Z,re).ldelim()},X.decode=function(Z,re){Z instanceof $Reader||(Z=$Reader.create(Z));for(var se=re===void 0?Z.len:Z.pos+re,ue=new $root.transit_realtime.TranslatedString.Translation;Z.pos<se;){var H=Z.uint32();switch(H>>>3){case 1:{ue.text=Z.string();break}case 2:{ue.language=Z.string();break}default:Z.skipType(H&7);break}}if(!ue.hasOwnProperty("text"))throw $util.ProtocolError("missing required 'text'",{instance:ue});return ue},X.decodeDelimited=function(Z){return Z instanceof $Reader||(Z=new $Reader(Z)),this.decode(Z,Z.uint32())},X.verify=function(Z){return typeof Z!="object"||Z===null?"object expected":$util.isString(Z.text)?Z.language!=null&&Z.hasOwnProperty("language")&&!$util.isString(Z.language)?"language: string expected":null:"text: string expected"},X.fromObject=function(Z){if(Z instanceof $root.transit_realtime.TranslatedString.Translation)return Z;var re=new $root.transit_realtime.TranslatedString.Translation;return Z.text!=null&&(re.text=String(Z.text)),Z.language!=null&&(re.language=String(Z.language)),re},X.toObject=function(Z,re){re||(re={});var se={};return re.defaults&&(se.text="",se.language=""),Z.text!=null&&Z.hasOwnProperty("text")&&(se.text=Z.text),Z.language!=null&&Z.hasOwnProperty("language")&&(se.language=Z.language),se},X.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},X.getTypeUrl=function(Z){return Z===void 0&&(Z="type.googleapis.com"),Z+"/transit_realtime.TranslatedString.Translation"},X}(),W}(),G.TranslatedImage=function(){function W(X){if(this.localized_image=[],X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.localized_image=$util.emptyArray,W.create=function(V){return new W(V)},W.encode=function(V,Z){if(Z||(Z=$Writer.create()),V.localized_image!=null&&V.localized_image.length)for(var re=0;re<V.localized_image.length;++re)$root.transit_realtime.TranslatedImage.LocalizedImage.encode(V.localized_image[re],Z.uint32(10).fork()).ldelim();return Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.TranslatedImage;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.localized_image&&se.localized_image.length||(se.localized_image=[]),se.localized_image.push($root.transit_realtime.TranslatedImage.LocalizedImage.decode(V,V.uint32()));break}default:V.skipType(ue&7);break}}return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){if(typeof V!="object"||V===null)return"object expected";if(V.localized_image!=null&&V.hasOwnProperty("localized_image")){if(!Array.isArray(V.localized_image))return"localized_image: array expected";for(var Z=0;Z<V.localized_image.length;++Z){var re=$root.transit_realtime.TranslatedImage.LocalizedImage.verify(V.localized_image[Z]);if(re)return"localized_image."+re}}return null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.TranslatedImage)return V;var Z=new $root.transit_realtime.TranslatedImage;if(V.localized_image){if(!Array.isArray(V.localized_image))throw TypeError(".transit_realtime.TranslatedImage.localized_image: array expected");Z.localized_image=[];for(var re=0;re<V.localized_image.length;++re){if(typeof V.localized_image[re]!="object")throw TypeError(".transit_realtime.TranslatedImage.localized_image: object expected");Z.localized_image[re]=$root.transit_realtime.TranslatedImage.LocalizedImage.fromObject(V.localized_image[re])}}return Z},W.toObject=function(V,Z){Z||(Z={});var re={};if((Z.arrays||Z.defaults)&&(re.localized_image=[]),V.localized_image&&V.localized_image.length){re.localized_image=[];for(var se=0;se<V.localized_image.length;++se)re.localized_image[se]=$root.transit_realtime.TranslatedImage.LocalizedImage.toObject(V.localized_image[se],Z)}return re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.TranslatedImage"},W.LocalizedImage=function(){function X(V){if(V)for(var Z=Object.keys(V),re=0;re<Z.length;++re)V[Z[re]]!=null&&(this[Z[re]]=V[Z[re]])}return X.prototype.url="",X.prototype.media_type="",X.prototype.language="",X.create=function(Z){return new X(Z)},X.encode=function(Z,re){return re||(re=$Writer.create()),re.uint32(10).string(Z.url),re.uint32(18).string(Z.media_type),Z.language!=null&&Object.hasOwnProperty.call(Z,"language")&&re.uint32(26).string(Z.language),re},X.encodeDelimited=function(Z,re){return this.encode(Z,re).ldelim()},X.decode=function(Z,re){Z instanceof $Reader||(Z=$Reader.create(Z));for(var se=re===void 0?Z.len:Z.pos+re,ue=new $root.transit_realtime.TranslatedImage.LocalizedImage;Z.pos<se;){var H=Z.uint32();switch(H>>>3){case 1:{ue.url=Z.string();break}case 2:{ue.media_type=Z.string();break}case 3:{ue.language=Z.string();break}default:Z.skipType(H&7);break}}if(!ue.hasOwnProperty("url"))throw $util.ProtocolError("missing required 'url'",{instance:ue});if(!ue.hasOwnProperty("media_type"))throw $util.ProtocolError("missing required 'media_type'",{instance:ue});return ue},X.decodeDelimited=function(Z){return Z instanceof $Reader||(Z=new $Reader(Z)),this.decode(Z,Z.uint32())},X.verify=function(Z){return typeof Z!="object"||Z===null?"object expected":$util.isString(Z.url)?$util.isString(Z.media_type)?Z.language!=null&&Z.hasOwnProperty("language")&&!$util.isString(Z.language)?"language: string expected":null:"media_type: string expected":"url: string expected"},X.fromObject=function(Z){if(Z instanceof $root.transit_realtime.TranslatedImage.LocalizedImage)return Z;var re=new $root.transit_realtime.TranslatedImage.LocalizedImage;return Z.url!=null&&(re.url=String(Z.url)),Z.media_type!=null&&(re.media_type=String(Z.media_type)),Z.language!=null&&(re.language=String(Z.language)),re},X.toObject=function(Z,re){re||(re={});var se={};return re.defaults&&(se.url="",se.media_type="",se.language=""),Z.url!=null&&Z.hasOwnProperty("url")&&(se.url=Z.url),Z.media_type!=null&&Z.hasOwnProperty("media_type")&&(se.media_type=Z.media_type),Z.language!=null&&Z.hasOwnProperty("language")&&(se.language=Z.language),se},X.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},X.getTypeUrl=function(Z){return Z===void 0&&(Z="type.googleapis.com"),Z+"/transit_realtime.TranslatedImage.LocalizedImage"},X}(),W}(),G.Shape=function(){function W(X){if(X)for(var V=Object.keys(X),Z=0;Z<V.length;++Z)X[V[Z]]!=null&&(this[V[Z]]=X[V[Z]])}return W.prototype.shape_id="",W.prototype.encoded_polyline="",W.create=function(V){return new W(V)},W.encode=function(V,Z){return Z||(Z=$Writer.create()),V.shape_id!=null&&Object.hasOwnProperty.call(V,"shape_id")&&Z.uint32(10).string(V.shape_id),V.encoded_polyline!=null&&Object.hasOwnProperty.call(V,"encoded_polyline")&&Z.uint32(18).string(V.encoded_polyline),Z},W.encodeDelimited=function(V,Z){return this.encode(V,Z).ldelim()},W.decode=function(V,Z){V instanceof $Reader||(V=$Reader.create(V));for(var re=Z===void 0?V.len:V.pos+Z,se=new $root.transit_realtime.Shape;V.pos<re;){var ue=V.uint32();switch(ue>>>3){case 1:{se.shape_id=V.string();break}case 2:{se.encoded_polyline=V.string();break}default:V.skipType(ue&7);break}}return se},W.decodeDelimited=function(V){return V instanceof $Reader||(V=new $Reader(V)),this.decode(V,V.uint32())},W.verify=function(V){return typeof V!="object"||V===null?"object expected":V.shape_id!=null&&V.hasOwnProperty("shape_id")&&!$util.isString(V.shape_id)?"shape_id: string expected":V.encoded_polyline!=null&&V.hasOwnProperty("encoded_polyline")&&!$util.isString(V.encoded_polyline)?"encoded_polyline: string expected":null},W.fromObject=function(V){if(V instanceof $root.transit_realtime.Shape)return V;var Z=new $root.transit_realtime.Shape;return V.shape_id!=null&&(Z.shape_id=String(V.shape_id)),V.encoded_polyline!=null&&(Z.encoded_polyline=String(V.encoded_polyline)),Z},W.toObject=function(V,Z){Z||(Z={});var re={};return Z.defaults&&(re.shape_id="",re.encoded_polyline=""),V.shape_id!=null&&V.hasOwnProperty("shape_id")&&(re.shape_id=V.shape_id),V.encoded_polyline!=null&&V.hasOwnProperty("encoded_polyline")&&(re.encoded_polyline=V.encoded_polyline),re},W.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},W.getTypeUrl=function(V){return V===void 0&&(V="type.googleapis.com"),V+"/transit_realtime.Shape"},W}(),G}();var gtfsRealtime_pbf=$root;const{transit_realtime}=gtfsRealtime_pbf;var gtfsRtBindings=transit_realtime,fetchBrowser={exports:{}};(function(G,W){(function(X){function V(Z){var re=Z&&Z.Promise||X.Promise,se=Z&&Z.XMLHttpRequest||X.XMLHttpRequest;return function(){var ue=Object.create(X,{fetch:{value:void 0,writable:!0}});return function(H,ye){ye(W)}(this,function(H){var ye=typeof ue<"u"&&ue||typeof self<"u"&&self||typeof ye<"u"&&ye,Ie={searchParams:"URLSearchParams"in ye,iterable:"Symbol"in ye&&"iterator"in Symbol,blob:"FileReader"in ye&&"Blob"in ye&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in ye,arrayBuffer:"ArrayBuffer"in ye};function Ee(xt){return xt&&DataView.prototype.isPrototypeOf(xt)}if(Ie.arrayBuffer)var Fe=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],je=ArrayBuffer.isView||function(xt){return xt&&Fe.indexOf(Object.prototype.toString.call(xt))>-1};function mt(xt){if(typeof xt!="string"&&(xt=String(xt)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(xt)||xt==="")throw new TypeError("Invalid character in header field name");return xt.toLowerCase()}function wt(xt){return typeof xt!="string"&&(xt=String(xt)),xt}function Ot(xt){var Zt={next:function(){var ht=xt.shift();return{done:ht===void 0,value:ht}}};return Ie.iterable&&(Zt[Symbol.iterator]=function(){return Zt}),Zt}function $t(xt){this.map={},xt instanceof $t?xt.forEach(function(Zt,ht){this.append(ht,Zt)},this):Array.isArray(xt)?xt.forEach(function(Zt){this.append(Zt[0],Zt[1])},this):xt&&Object.getOwnPropertyNames(xt).forEach(function(Zt){this.append(Zt,xt[Zt])},this)}$t.prototype.append=function(xt,Zt){xt=mt(xt),Zt=wt(Zt);var ht=this.map[xt];this.map[xt]=ht?ht+", "+Zt:Zt},$t.prototype.delete=function(xt){delete this.map[mt(xt)]},$t.prototype.get=function(xt){return xt=mt(xt),this.has(xt)?this.map[xt]:null},$t.prototype.has=function(xt){return this.map.hasOwnProperty(mt(xt))},$t.prototype.set=function(xt,Zt){this.map[mt(xt)]=wt(Zt)},$t.prototype.forEach=function(xt,Zt){for(var ht in this.map)this.map.hasOwnProperty(ht)&&xt.call(Zt,this.map[ht],ht,this)},$t.prototype.keys=function(){var xt=[];return this.forEach(function(Zt,ht){xt.push(ht)}),Ot(xt)},$t.prototype.values=function(){var xt=[];return this.forEach(function(Zt){xt.push(Zt)}),Ot(xt)},$t.prototype.entries=function(){var xt=[];return this.forEach(function(Zt,ht){xt.push([ht,Zt])}),Ot(xt)},Ie.iterable&&($t.prototype[Symbol.iterator]=$t.prototype.entries);function jt(xt){if(xt.bodyUsed)return re.reject(new TypeError("Already read"));xt.bodyUsed=!0}function nr(xt){return new re(function(Zt,ht){xt.onload=function(){Zt(xt.result)},xt.onerror=function(){ht(xt.error)}})}function sr(xt){var Zt=new FileReader,ht=nr(Zt);return Zt.readAsArrayBuffer(xt),ht}function gr(xt){var Zt=new FileReader,ht=nr(Zt);return Zt.readAsText(xt),ht}function hr(xt){for(var Zt=new Uint8Array(xt),ht=new Array(Zt.length),Rt=0;Rt<Zt.length;Rt++)ht[Rt]=String.fromCharCode(Zt[Rt]);return ht.join("")}function Ir(xt){if(xt.slice)return xt.slice(0);var Zt=new Uint8Array(xt.byteLength);return Zt.set(new Uint8Array(xt)),Zt.buffer}function br(){return this.bodyUsed=!1,this._initBody=function(xt){this.bodyUsed=this.bodyUsed,this._bodyInit=xt,xt?typeof xt=="string"?this._bodyText=xt:Ie.blob&&Blob.prototype.isPrototypeOf(xt)?this._bodyBlob=xt:Ie.formData&&FormData.prototype.isPrototypeOf(xt)?this._bodyFormData=xt:Ie.searchParams&&URLSearchParams.prototype.isPrototypeOf(xt)?this._bodyText=xt.toString():Ie.arrayBuffer&&Ie.blob&&Ee(xt)?(this._bodyArrayBuffer=Ir(xt.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Ie.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(xt)||je(xt))?this._bodyArrayBuffer=Ir(xt):this._bodyText=xt=Object.prototype.toString.call(xt):this._bodyText="",this.headers.get("content-type")||(typeof xt=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Ie.searchParams&&URLSearchParams.prototype.isPrototypeOf(xt)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Ie.blob&&(this.blob=function(){var xt=jt(this);if(xt)return xt;if(this._bodyBlob)return re.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return re.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return re.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var xt=jt(this);return xt||(ArrayBuffer.isView(this._bodyArrayBuffer)?re.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):re.resolve(this._bodyArrayBuffer))}else return this.blob().then(sr)}),this.text=function(){var xt=jt(this);if(xt)return xt;if(this._bodyBlob)return gr(this._bodyBlob);if(this._bodyArrayBuffer)return re.resolve(hr(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return re.resolve(this._bodyText)},Ie.formData&&(this.formData=function(){return this.text().then(Ti)}),this.json=function(){return this.text().then(JSON.parse)},this}var yr=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function zt(xt){var Zt=xt.toUpperCase();return yr.indexOf(Zt)>-1?Zt:xt}function gi(xt,Zt){if(!(this instanceof gi))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');Zt=Zt||{};var ht=Zt.body;if(xt instanceof gi){if(xt.bodyUsed)throw new TypeError("Already read");this.url=xt.url,this.credentials=xt.credentials,Zt.headers||(this.headers=new $t(xt.headers)),this.method=xt.method,this.mode=xt.mode,this.signal=xt.signal,!ht&&xt._bodyInit!=null&&(ht=xt._bodyInit,xt.bodyUsed=!0)}else this.url=String(xt);if(this.credentials=Zt.credentials||this.credentials||"same-origin",(Zt.headers||!this.headers)&&(this.headers=new $t(Zt.headers)),this.method=zt(Zt.method||this.method||"GET"),this.mode=Zt.mode||this.mode||null,this.signal=Zt.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&ht)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(ht),(this.method==="GET"||this.method==="HEAD")&&(Zt.cache==="no-store"||Zt.cache==="no-cache")){var Rt=/([?&])_=[^&]*/;if(Rt.test(this.url))this.url=this.url.replace(Rt,"$1_="+new Date().getTime());else{var It=/\?/;this.url+=(It.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}gi.prototype.clone=function(){return new gi(this,{body:this._bodyInit})};function Ti(xt){var Zt=new FormData;return xt.trim().split("&").forEach(function(ht){if(ht){var Rt=ht.split("="),It=Rt.shift().replace(/\+/g," "),Ht=Rt.join("=").replace(/\+/g," ");Zt.append(decodeURIComponent(It),decodeURIComponent(Ht))}}),Zt}function dr(xt){var Zt=new $t,ht=xt.replace(/\r?\n[\t ]+/g," ");return ht.split("\r").map(function(Rt){return Rt.indexOf(`
`)===0?Rt.substr(1,Rt.length):Rt}).forEach(function(Rt){var It=Rt.split(":"),Ht=It.shift().trim();if(Ht){var ar=It.join(":").trim();Zt.append(Ht,ar)}}),Zt}br.call(gi.prototype);function kr(xt,Zt){if(!(this instanceof kr))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');Zt||(Zt={}),this.type="default",this.status=Zt.status===void 0?200:Zt.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in Zt?Zt.statusText:"",this.headers=new $t(Zt.headers),this.url=Zt.url||"",this._initBody(xt)}br.call(kr.prototype),kr.prototype.clone=function(){return new kr(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new $t(this.headers),url:this.url})},kr.error=function(){var xt=new kr(null,{status:0,statusText:""});return xt.type="error",xt};var un=[301,302,303,307,308];kr.redirect=function(xt,Zt){if(un.indexOf(Zt)===-1)throw new RangeError("Invalid status code");return new kr(null,{status:Zt,headers:{location:xt}})},H.DOMException=ye.DOMException;try{new H.DOMException}catch{H.DOMException=function(Zt,ht){this.message=Zt,this.name=ht;var Rt=Error(Zt);this.stack=Rt.stack},H.DOMException.prototype=Object.create(Error.prototype),H.DOMException.prototype.constructor=H.DOMException}function qi(xt,Zt){return new re(function(ht,Rt){var It=new gi(xt,Zt);if(It.signal&&It.signal.aborted)return Rt(new H.DOMException("Aborted","AbortError"));var Ht=new se;function ar(){Ht.abort()}Ht.onload=function(){var Fr={status:Ht.status,statusText:Ht.statusText,headers:dr(Ht.getAllResponseHeaders()||"")};Fr.url="responseURL"in Ht?Ht.responseURL:Fr.headers.get("X-Request-URL");var si="response"in Ht?Ht.response:Ht.responseText;setTimeout(function(){ht(new kr(si,Fr))},0)},Ht.onerror=function(){setTimeout(function(){Rt(new TypeError("Network request failed"))},0)},Ht.ontimeout=function(){setTimeout(function(){Rt(new TypeError("Network request failed"))},0)},Ht.onabort=function(){setTimeout(function(){Rt(new H.DOMException("Aborted","AbortError"))},0)};function mr(Fr){try{return Fr===""&&ye.location.href?ye.location.href:Fr}catch{return Fr}}Ht.open(It.method,mr(It.url),!0),It.credentials==="include"?Ht.withCredentials=!0:It.credentials==="omit"&&(Ht.withCredentials=!1),"responseType"in Ht&&(Ie.blob?Ht.responseType="blob":Ie.arrayBuffer&&It.headers.get("Content-Type")&&It.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(Ht.responseType="arraybuffer")),Zt&&typeof Zt.headers=="object"&&!(Zt.headers instanceof $t)?Object.getOwnPropertyNames(Zt.headers).forEach(function(Fr){Ht.setRequestHeader(Fr,wt(Zt.headers[Fr]))}):It.headers.forEach(function(Fr,si){Ht.setRequestHeader(si,Fr)}),It.signal&&(It.signal.addEventListener("abort",ar),Ht.onreadystatechange=function(){Ht.readyState===4&&It.signal.removeEventListener("abort",ar)}),Ht.send(typeof It._bodyInit>"u"?null:It._bodyInit)})}qi.polyfill=!0,ye.fetch||(ye.fetch=qi,ye.Headers=$t,ye.Request=gi,ye.Response=kr),H.Headers=$t,H.Request=gi,H.Response=kr,H.fetch=qi,Object.defineProperty(H,"__esModule",{value:!0})}),{fetch:ue.fetch,Headers:ue.Headers,Request:ue.Request,Response:ue.Response,DOMException:ue.DOMException}}()}G.exports=V})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:commonjsGlobal)})(fetchBrowser,fetchBrowser.exports);var fetchBrowserExports=fetchBrowser.exports;const createFetch=getDefaultExportFromCjs(fetchBrowserExports),{EventEmitter}=eventsExports,{fetch:_fetch}=fetchBrowserExports(),syncViaPeriodicFetch=(G,W={})=>{const{interval:X,respectDataSaving:V,respectPageVisibility:Z,fetchOpts:re,setTimer:se,clearTimer:ue}={interval:3e4,respectDataSaving:!0,respectPageVisibility:!0,fetchOpts:{},setTimer:setTimeout,clearTimer:clearTimeout,...W},H="minInterval"in W?W.minInterval:X*3,ye=new EventEmitter;let Ie=null,Ee=null;const Fe=async()=>{const br={};Ie!==null?br["if-none-match"]=Ie:Ee!==null&&(br["if-modified-since"]=Ee);const yr=await _fetch(G,{...re,headers:{...re.headers,...br}});if(!yr.ok&&yr.status!==304){const dr=new Error(yr.statusText);throw dr.response=yr,dr}let zt=!0;yr.status===304&&(zt=!1);const gi=yr.headers.get("etag");gi&&(gi===Ie&&(zt=!1),Ie=gi);let Ti=yr.headers.get("last-modified")||null;return Ti=Ti&&+new Date(Ti),Number.isInteger(Ti)||(Ti=null),Ti!==null&&Ee!==null&&(Ti<=Ee&&(zt=!1),Ee=Ti),{changed:zt,response:yr}};let je=null;const mt=()=>(je!==null||(ye.emit("fetch"),je=Fe().then(({changed:br,response:yr})=>(je=null,ye.emit("fetch-done"),br&&ye.emit("change",yr),yr),br=>{throw je=null,ye.emit("fetch-done"),ye.emit("error",br),br})),je),wt=globalThis.document,Ot=()=>!Z||!wt?!1:typeof wt.hidden=="boolean"?wt.hidden:!1,$t=globalThis.navigator&&globalThis.navigator.connection,jt=()=>V&&$t?$t.saveData:!1;let nr=!1,sr=null;const gr=()=>{mt().catch(()=>{}).then(()=>{if(!nr)return;const br=Ot()||jt()?H:X;sr=se(gr,br)})},hr=()=>{nr||(nr=!0,gr(),ye.emit("start"))},Ir=()=>{nr&&(sr===null&&(ue(sr),sr=null),nr=!1,ye.emit("stop"))};return hr(),ye.url=()=>G,ye.start=hr,ye.stop=Ir,ye.isActive=()=>!!nr,ye.refetch=mt,ye.isFetching=()=>!!je,ye};var fetchPeriodicSync=syncViaPeriodicFetch;const syncViaPeriodicFetch$1=getDefaultExportFromCjs(fetchPeriodicSync),MAX_FEED_SIZE=5*1024*1024,CONTENT_TYPES=["application/octet-stream","application/x-protobuf","application/grtfeed"],feedStore=(G,W)=>{G.feedUrl=null,G.feedSyncStopped=!1,G.feedSyncInterval=30,G.feedSyncing=!1,G.feedError=null,G.feedRawData=null,G.feedData=null;let X=null;const V=async se=>{const ue=se.headers.get("content-type"),H=ue?parse_1(ue):{};if(H.type&&!CONTENT_TYPES.includes(H.type)){const Fe=new Error(`invalid content-type \`${H.type}\`, only ${CONTENT_TYPES.join(", ")} are supported`);throw Fe.response=se,Fe}const ye=se.headers.get("content-length");if(ye&&parseInt(ye)>MAX_FEED_SIZE){const Fe=new Error("response is too large");throw Fe.response=se,Fe}const Ie=buffer.Buffer.from(await se.arrayBuffer()),Ee=gtfsRtBindings.FeedMessage.decode(Ie);if(!Ee||!Ee.header||!Array.isArray(Ee.entity)){const Fe=new Error("couldn't parse feed");throw Fe.rawFeed=Ie,Fe.response=se,Fe}G.feedError=null,G.feedRawData=Ie,G.feedData=Ee,W.emit("feed:data-change"),W.emit(W.STATE_CHANGE)},Z=se=>{G.feedSyncing=se,W.emit(W.STATE_CHANGE)},re=debounce$1(()=>{X=syncViaPeriodicFetch$1(G.feedUrl,{interval:G.feedSyncInterval*1e3}),X.on("fetch",()=>Z(!0)),X.on("fetch-done",()=>Z(!1)),X.on("change",se=>{V(se).catch(ue=>{G.feedError=ue,W.emit(W.STATE_CHANGE)})}),X.on("error",se=>{G.feedError=se,W.emit(W.STATE_CHANGE)}),G.feedSyncStopped&&X.stop()},300);W.on("feed:set-url",se=>{se!==G.feedUrl&&(X&&(X.stop(),X=null),G.feedUrl=se,G.feedSyncing=!1,G.feedRawData=null,G.feedData=null,se!==null&&re(),W.emit("feed:data-change"),W.emit(W.STATE_CHANGE))}),W.on("feed:sync",()=>{X&&X.refetch()}),W.on("feed:stop-sync",()=>{G.feedSyncStopped=!0,X&&X.stop(),W.emit(W.STATE_CHANGE)}),W.on("feed:start-sync",()=>{G.feedSyncStopped=!1,X&&X.start(),W.emit(W.STATE_CHANGE)}),W.on("feed:set-sync-interval",se=>{se=Math.max(se,1),se!==G.feedSyncInterval&&(X&&(X.stop(),X=null),G.feedSyncInterval=se,G.feedUrl!==null&&re(),W.emit(W.STATE_CHANGE))})},feedLogStore=(G,W)=>{G.feedLog=[],W.on("feed:data-change",()=>{if(!G.feedData){G.feedLog=[];return}const X=Date.now()/1e3|0,V=G.feedData.header||{},Z=(G.feedData.entity||[]).filter(re=>!!re.trip_update).flatMap(re=>(re.trip_update.stop_time_update||[]).map(se=>({entityId:re.id,timestamp:re.trip_update.timestamp||V.timestamp||null,routeId:re.trip_update.trip.route_id,directionId:re.trip_update.trip.direction_id,tripId:re.trip_update.trip.trip_id,vehicleId:re.trip_update.vehicle.id,vehicleLabel:re.trip_update.vehicle.label,stopId:se.stop_id,tArrival:se.arrival.time,delay:se.arrival.delay}))).filter(({tArrival:re})=>re&&re>=X).sort((re,se)=>{const ue=re.tArrival-X,H=se.tArrival-X,ye=typeof re.delay=="number"?re.delay:0,Ie=typeof se.delay=="number"?se.delay:0;return ue/30===H/30?Math.abs(Ie)-Math.abs(ye):ue-H});G.feedLog=Z})};var browser={exports:{}};const{AbortController,AbortSignal}=typeof self<"u"?self:typeof window<"u"?window:void 0;browser.exports=AbortController;browser.exports.AbortSignal=AbortSignal;browser.exports.default=AbortController;var browserExports=browser.exports;const AbortController$1=getDefaultExportFromCjs(browserExports);function encodeReserved(G){return G.split(/(%[0-9A-Fa-f]{2})/g).map(function(W){return/%[0-9A-Fa-f]/.test(W)||(W=encodeURI(W).replace(/%5B/g,"[").replace(/%5D/g,"]")),W}).join("")}function encodeUnreserved(G){return encodeURIComponent(G).replace(/[!'()*]/g,function(W){return"%"+W.charCodeAt(0).toString(16).toUpperCase()})}function encodeValue(G,W,X){return W=G==="+"||G==="#"?encodeReserved(W):encodeUnreserved(W),X?encodeUnreserved(X)+"="+W:W}function isDefined(G){return G!=null}function isKeyOperator(G){return G===";"||G==="&"||G==="?"}function getValues(G,W,X,V){var Z=G[X],re=[];if(isDefined(Z)&&Z!=="")if(typeof Z=="string"||typeof Z=="number"||typeof Z=="boolean")Z=Z.toString(),V&&V!=="*"&&(Z=Z.substring(0,parseInt(V,10))),re.push(encodeValue(W,Z,isKeyOperator(W)?X:null));else if(V==="*")Array.isArray(Z)?Z.filter(isDefined).forEach(function(ue){re.push(encodeValue(W,ue,isKeyOperator(W)?X:null))}):Object.keys(Z).forEach(function(ue){isDefined(Z[ue])&&re.push(encodeValue(W,Z[ue],ue))});else{var se=[];Array.isArray(Z)?Z.filter(isDefined).forEach(function(ue){se.push(encodeValue(W,ue))}):Object.keys(Z).forEach(function(ue){isDefined(Z[ue])&&(se.push(encodeUnreserved(ue)),se.push(encodeValue(W,Z[ue].toString())))}),isKeyOperator(W)?re.push(encodeUnreserved(X)+"="+se.join(",")):se.length!==0&&re.push(se.join(","))}else W===";"?isDefined(Z)&&re.push(encodeUnreserved(X)):Z===""&&(W==="&"||W==="?")?re.push(encodeUnreserved(X)+"="):Z===""&&re.push("");return re}function parseTemplate(G){var W=["+","#",".","/",";","?","&"];return{expand:function(X){return G.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(V,Z,re){if(Z){var se=null,ue=[];if(W.indexOf(Z.charAt(0))!==-1&&(se=Z.charAt(0),Z=Z.substr(1)),Z.split(/,/g).forEach(function(ye){var Ie=/([^:\*]*)(?::(\d+)|(\*))?/.exec(ye);ue.push.apply(ue,getValues(X,se,Ie[1],Ie[2]||Ie[3]))}),se&&se!=="+"){var H=",";return se==="?"?H="&":se!=="#"&&(H=se),(ue.length!==0?se:"")+ue.join(H)}else return ue.join(",")}else return encodeReserved(re)})}}}const{Request,fetch:fetch$1}=createFetch(),hasProp=(G,W)=>Object.prototype.hasOwnProperty.call(G,W),checkIfFeedContainsFocusedVehicleId=(G,W)=>{const X=G==null?void 0:G.entity;return Array.isArray(X)?X.some(V=>{var Z,re;return((re=(Z=V.vehicle)==null?void 0:Z.vehicle)==null?void 0:re.id)===W}):!1},checkIfFeedContainsFocusedTripId=(G,W)=>{const X=G==null?void 0:G.entity;if(Array.isArray(X))return X.some(V=>{var Z,re,se,ue;return((re=(Z=V.vehicle)==null?void 0:Z.trip)==null?void 0:re.trip_id)===W||((ue=(se=V.trip_update)==null?void 0:se.trip)==null?void 0:ue.trip_id)===W})},focusStore=(G,W)=>{const X=async(je,mt={})=>{const wt=new Request(je,{mode:"cors",redirect:"follow",headers:{accept:"application/json"},...mt}),Ot=await fetch$1(wt);if(!Ot.ok){const $t=new Error(`${Ot.url}: ${Ot.status} ${Ot.statusText}`);throw $t.req=wt,$t.res=Ot,$t}return await Ot.json()};G.shapeIdsByTripIdUrl="/shape-ids-by-trip-id.json",W.on("shape-ids-by-trip-id-url:set",je=>{G.shapeIdsByTripIdUrl!==je&&(G.shapeIdsByTripIdUrl=je,se(),W.emit(W.STATE_CHANGE))});let V=new AbortController$1;const Z=async()=>(V=new AbortController$1,console.debug(`fetching shape IDs from ${G.shapeIdsByTripIdUrl}`),await X(G.shapeIdsByTripIdUrl,{signal:V.signal}));let re={};const se=()=>{V.abort(),Z().then(je=>{re=je,Fe()}).catch(je=>{console.error("failed to fetch shape IDs",je)})};G.shapeUrl="/shapes/{shape_id}.geo.json";let ue=parseTemplate(G.shapeUrl);W.on("shape-url:set",je=>{G.shapeUrl!==je&&(G.shapeUrl=je,ue=parseTemplate(G.shapeUrl),Fe(),W.emit(W.STATE_CHANGE))}),G.focusedVehicleId=null,G.focusedVehiclePosition=null;const H=()=>{var mt;if(G.focusedVehicleId===null)return;if(checkIfFeedContainsFocusedVehicleId(G.feedData,G.focusedVehicleId)){const wt=G.focusedVehicleId,$t=(((mt=G.feedData)==null?void 0:mt.entity)||[]).find(jt=>{var nr,sr;return((sr=(nr=jt.vehicle)==null?void 0:nr.vehicle)==null?void 0:sr.id)===wt});$t?G.focusedVehiclePosition={type:"Feature",properties:{vehicleId:wt},geometry:{type:"Point",coordinates:[$t.vehicle.position.longitude,$t.vehicle.position.latitude]}}:G.focusedVehiclePosition=null,W.emit(W.STATE_CHANGE)}};W.on("feed:data-change",H),W.on("focus-vehicle-id",je=>{je!==G.focusedVehicleId&&(G.focusedVehicleId=je,G.focusedVehiclePosition=null,H(),W.emit(W.STATE_CHANGE))}),G.focusedTripId=null,G.focusedTripShape=null;const ye=()=>{G.focusedTripId!==null&&checkIfFeedContainsFocusedTripId(G.feedData,G.focusedTripId)};W.on("feed:data-change",ye);let Ie=new AbortController$1;const Ee=async(je,mt)=>{Ie=new AbortController$1;const wt=ue.expand({shape_id:je});console.debug(`fetching shape ${je} for trip ${mt} from ${wt}`);const Ot=Date.now(),$t=await X(wt,{signal:Ie.signal});return console.debug(`fetched shape ${je} in ${Date.now()-Ot}ms`),$t},Fe=()=>{const je=G.focusedTripId;if(je!==null&&(Ie.abort(),je!==null&&hasProp(re,je))){const mt=re[je];Ee(mt,je).then(wt=>{G.focusedTripShape=wt,W.emit(W.STATE_CHANGE)}).catch(wt=>{console.error(`failed to fetch shape ${mt} for trip ${je}`,wt)})}};W.on("focus-trip-id",je=>{je!==G.focusedTripId&&(G.focusedTripId=je,G.focusedTripShape=null,ye(),Fe(),W.emit(W.STATE_CHANGE))})};var baseGetTag$1=_baseGetTag,isObject$2=isObject_1,asyncTag="[object AsyncFunction]",funcTag="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$1(G){if(!isObject$2(G))return!1;var W=baseGetTag$1(G);return W==funcTag||W==genTag||W==asyncTag||W==proxyTag}var isFunction_1=isFunction$1,root$1=_root,coreJsData$1=root$1["__core-js_shared__"],_coreJsData=coreJsData$1,coreJsData=_coreJsData,maskSrcKey=function(){var G=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return G?"Symbol(src)_1."+G:""}();function isMasked$1(G){return!!maskSrcKey&&maskSrcKey in G}var _isMasked=isMasked$1,funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString;function toSource$1(G){if(G!=null){try{return funcToString$1.call(G)}catch{}try{return G+""}catch{}}return""}var _toSource=toSource$1,isFunction=isFunction_1,isMasked=_isMasked,isObject$1=isObject_1,toSource=_toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$4=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$4=objectProto$4.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$4).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$1(G){if(!isObject$1(G)||isMasked(G))return!1;var W=isFunction(G)?reIsNative:reIsHostCtor;return W.test(toSource(G))}var _baseIsNative=baseIsNative$1;function getValue$1(G,W){return G==null?void 0:G[W]}var _getValue=getValue$1,baseIsNative=_baseIsNative,getValue=_getValue;function getNative$3(G,W){var X=getValue(G,W);return baseIsNative(X)?X:void 0}var _getNative=getNative$3,getNative$2=_getNative,nativeCreate$4=getNative$2(Object,"create"),_nativeCreate=nativeCreate$4,nativeCreate$3=_nativeCreate;function hashClear$1(){this.__data__=nativeCreate$3?nativeCreate$3(null):{},this.size=0}var _hashClear=hashClear$1;function hashDelete$1(G){var W=this.has(G)&&delete this.__data__[G];return this.size-=W?1:0,W}var _hashDelete=hashDelete$1,nativeCreate$2=_nativeCreate,HASH_UNDEFINED$1="__lodash_hash_undefined__",objectProto$3=Object.prototype,hasOwnProperty$3=objectProto$3.hasOwnProperty;function hashGet$1(G){var W=this.__data__;if(nativeCreate$2){var X=W[G];return X===HASH_UNDEFINED$1?void 0:X}return hasOwnProperty$3.call(W,G)?W[G]:void 0}var _hashGet=hashGet$1,nativeCreate$1=_nativeCreate,objectProto$2=Object.prototype,hasOwnProperty$2=objectProto$2.hasOwnProperty;function hashHas$1(G){var W=this.__data__;return nativeCreate$1?W[G]!==void 0:hasOwnProperty$2.call(W,G)}var _hashHas=hashHas$1,nativeCreate=_nativeCreate,HASH_UNDEFINED="__lodash_hash_undefined__";function hashSet$1(G,W){var X=this.__data__;return this.size+=this.has(G)?0:1,X[G]=nativeCreate&&W===void 0?HASH_UNDEFINED:W,this}var _hashSet=hashSet$1,hashClear=_hashClear,hashDelete=_hashDelete,hashGet=_hashGet,hashHas=_hashHas,hashSet=_hashSet;function Hash$1(G){var W=-1,X=G==null?0:G.length;for(this.clear();++W<X;){var V=G[W];this.set(V[0],V[1])}}Hash$1.prototype.clear=hashClear;Hash$1.prototype.delete=hashDelete;Hash$1.prototype.get=hashGet;Hash$1.prototype.has=hashHas;Hash$1.prototype.set=hashSet;var _Hash=Hash$1;function listCacheClear$1(){this.__data__=[],this.size=0}var _listCacheClear=listCacheClear$1;function eq$2(G,W){return G===W||G!==G&&W!==W}var eq_1=eq$2,eq$1=eq_1;function assocIndexOf$4(G,W){for(var X=G.length;X--;)if(eq$1(G[X][0],W))return X;return-1}var _assocIndexOf=assocIndexOf$4,assocIndexOf$3=_assocIndexOf,arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete$1(G){var W=this.__data__,X=assocIndexOf$3(W,G);if(X<0)return!1;var V=W.length-1;return X==V?W.pop():splice.call(W,X,1),--this.size,!0}var _listCacheDelete=listCacheDelete$1,assocIndexOf$2=_assocIndexOf;function listCacheGet$1(G){var W=this.__data__,X=assocIndexOf$2(W,G);return X<0?void 0:W[X][1]}var _listCacheGet=listCacheGet$1,assocIndexOf$1=_assocIndexOf;function listCacheHas$1(G){return assocIndexOf$1(this.__data__,G)>-1}var _listCacheHas=listCacheHas$1,assocIndexOf=_assocIndexOf;function listCacheSet$1(G,W){var X=this.__data__,V=assocIndexOf(X,G);return V<0?(++this.size,X.push([G,W])):X[V][1]=W,this}var _listCacheSet=listCacheSet$1,listCacheClear=_listCacheClear,listCacheDelete=_listCacheDelete,listCacheGet=_listCacheGet,listCacheHas=_listCacheHas,listCacheSet=_listCacheSet;function ListCache$1(G){var W=-1,X=G==null?0:G.length;for(this.clear();++W<X;){var V=G[W];this.set(V[0],V[1])}}ListCache$1.prototype.clear=listCacheClear;ListCache$1.prototype.delete=listCacheDelete;ListCache$1.prototype.get=listCacheGet;ListCache$1.prototype.has=listCacheHas;ListCache$1.prototype.set=listCacheSet;var _ListCache=ListCache$1,getNative$1=_getNative,root=_root,Map$2=getNative$1(root,"Map"),_Map=Map$2,Hash=_Hash,ListCache=_ListCache,Map$1=_Map;function mapCacheClear$1(){this.size=0,this.__data__={hash:new Hash,map:new(Map$1||ListCache),string:new Hash}}var _mapCacheClear=mapCacheClear$1;function isKeyable$1(G){var W=typeof G;return W=="string"||W=="number"||W=="symbol"||W=="boolean"?G!=="__proto__":G===null}var _isKeyable=isKeyable$1,isKeyable=_isKeyable;function getMapData$4(G,W){var X=G.__data__;return isKeyable(W)?X[typeof W=="string"?"string":"hash"]:X.map}var _getMapData=getMapData$4,getMapData$3=_getMapData;function mapCacheDelete$1(G){var W=getMapData$3(this,G).delete(G);return this.size-=W?1:0,W}var _mapCacheDelete=mapCacheDelete$1,getMapData$2=_getMapData;function mapCacheGet$1(G){return getMapData$2(this,G).get(G)}var _mapCacheGet=mapCacheGet$1,getMapData$1=_getMapData;function mapCacheHas$1(G){return getMapData$1(this,G).has(G)}var _mapCacheHas=mapCacheHas$1,getMapData=_getMapData;function mapCacheSet$1(G,W){var X=getMapData(this,G),V=X.size;return X.set(G,W),this.size+=X.size==V?0:1,this}var _mapCacheSet=mapCacheSet$1,mapCacheClear=_mapCacheClear,mapCacheDelete=_mapCacheDelete,mapCacheGet=_mapCacheGet,mapCacheHas=_mapCacheHas,mapCacheSet=_mapCacheSet;function MapCache$1(G){var W=-1,X=G==null?0:G.length;for(this.clear();++W<X;){var V=G[W];this.set(V[0],V[1])}}MapCache$1.prototype.clear=mapCacheClear;MapCache$1.prototype.delete=mapCacheDelete;MapCache$1.prototype.get=mapCacheGet;MapCache$1.prototype.has=mapCacheHas;MapCache$1.prototype.set=mapCacheSet;var _MapCache=MapCache$1,MapCache=_MapCache,FUNC_ERROR_TEXT="Expected a function";function memoize$1(G,W){if(typeof G!="function"||W!=null&&typeof W!="function")throw new TypeError(FUNC_ERROR_TEXT);var X=function(){var V=arguments,Z=W?W.apply(this,V):V[0],re=X.cache;if(re.has(Z))return re.get(Z);var se=G.apply(this,V);return X.cache=re.set(Z,se)||re,se};return X.cache=new(memoize$1.Cache||MapCache),X}memoize$1.Cache=MapCache;var memoize_1=memoize$1;const memoize$2=getDefaultExportFromCjs(memoize_1);var isArray$6=Array.isArray,isArray_1=isArray$6,isArray$5=isArray_1,isSymbol$3=isSymbol_1,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey$1(G,W){if(isArray$5(G))return!1;var X=typeof G;return X=="number"||X=="symbol"||X=="boolean"||G==null||isSymbol$3(G)?!0:reIsPlainProp.test(G)||!reIsDeepProp.test(G)||W!=null&&G in Object(W)}var _isKey=isKey$1,memoize=memoize_1,MAX_MEMOIZE_SIZE=500;function memoizeCapped$1(G){var W=memoize(G,function(V){return X.size===MAX_MEMOIZE_SIZE&&X.clear(),V}),X=W.cache;return W}var _memoizeCapped=memoizeCapped$1,memoizeCapped=_memoizeCapped,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath$1=memoizeCapped(function(G){var W=[];return G.charCodeAt(0)===46&&W.push(""),G.replace(rePropName,function(X,V,Z,re){W.push(Z?re.replace(reEscapeChar,"$1"):V||X)}),W}),_stringToPath=stringToPath$1;function arrayMap$1(G,W){for(var X=-1,V=G==null?0:G.length,Z=Array(V);++X<V;)Z[X]=W(G[X],X,G);return Z}var _arrayMap=arrayMap$1,Symbol$2=_Symbol,arrayMap=_arrayMap,isArray$4=isArray_1,isSymbol$2=isSymbol_1,INFINITY$1=1/0,symbolProto=Symbol$2?Symbol$2.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function baseToString$1(G){if(typeof G=="string")return G;if(isArray$4(G))return arrayMap(G,baseToString$1)+"";if(isSymbol$2(G))return symbolToString?symbolToString.call(G):"";var W=G+"";return W=="0"&&1/G==-INFINITY$1?"-0":W}var _baseToString=baseToString$1,baseToString=_baseToString;function toString$1(G){return G==null?"":baseToString(G)}var toString_1=toString$1,isArray$3=isArray_1,isKey=_isKey,stringToPath=_stringToPath,toString=toString_1;function castPath$4(G,W){return isArray$3(G)?G:isKey(G,W)?[G]:stringToPath(toString(G))}var _castPath=castPath$4,isSymbol$1=isSymbol_1,INFINITY=1/0;function toKey$3(G){if(typeof G=="string"||isSymbol$1(G))return G;var W=G+"";return W=="0"&&1/G==-INFINITY?"-0":W}var _toKey=toKey$3,castPath$3=_castPath,toKey$2=_toKey;function baseGet$1(G,W){W=castPath$3(W,G);for(var X=0,V=W.length;G!=null&&X<V;)G=G[toKey$2(W[X++])];return X&&X==V?G:void 0}var _baseGet=baseGet$1,getNative=_getNative,defineProperty$2=function(){try{var G=getNative(Object,"defineProperty");return G({},"",{}),G}catch{}}(),_defineProperty=defineProperty$2,defineProperty$1=_defineProperty;function baseAssignValue$1(G,W,X){W=="__proto__"&&defineProperty$1?defineProperty$1(G,W,{configurable:!0,enumerable:!0,value:X,writable:!0}):G[W]=X}var _baseAssignValue=baseAssignValue$1,baseAssignValue=_baseAssignValue,eq=eq_1,objectProto$1=Object.prototype,hasOwnProperty$1=objectProto$1.hasOwnProperty;function assignValue$1(G,W,X){var V=G[W];(!(hasOwnProperty$1.call(G,W)&&eq(V,X))||X===void 0&&!(W in G))&&baseAssignValue(G,W,X)}var _assignValue=assignValue$1,MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex$2(G,W){var X=typeof G;return W=W??MAX_SAFE_INTEGER$1,!!W&&(X=="number"||X!="symbol"&&reIsUint.test(G))&&G>-1&&G%1==0&&G<W}var _isIndex=isIndex$2,assignValue=_assignValue,castPath$2=_castPath,isIndex$1=_isIndex,isObject=isObject_1,toKey$1=_toKey;function baseSet$1(G,W,X,V){if(!isObject(G))return G;W=castPath$2(W,G);for(var Z=-1,re=W.length,se=re-1,ue=G;ue!=null&&++Z<re;){var H=toKey$1(W[Z]),ye=X;if(H==="__proto__"||H==="constructor"||H==="prototype")return G;if(Z!=se){var Ie=ue[H];ye=V?V(Ie,H,ue):void 0,ye===void 0&&(ye=isObject(Ie)?Ie:isIndex$1(W[Z+1])?[]:{})}assignValue(ue,H,ye),ue=ue[H]}return G}var _baseSet=baseSet$1,baseGet=_baseGet,baseSet=_baseSet,castPath$1=_castPath;function basePickBy$1(G,W,X){for(var V=-1,Z=W.length,re={};++V<Z;){var se=W[V],ue=baseGet(G,se);X(ue,se)&&baseSet(re,castPath$1(se,G),ue)}return re}var _basePickBy=basePickBy$1;function baseHasIn$1(G,W){return G!=null&&W in Object(G)}var _baseHasIn=baseHasIn$1,baseGetTag=_baseGetTag,isObjectLike$1=isObjectLike_1,argsTag="[object Arguments]";function baseIsArguments$1(G){return isObjectLike$1(G)&&baseGetTag(G)==argsTag}var _baseIsArguments=baseIsArguments$1,baseIsArguments=_baseIsArguments,isObjectLike=isObjectLike_1,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,propertyIsEnumerable=objectProto.propertyIsEnumerable,isArguments$2=baseIsArguments(function(){return arguments}())?baseIsArguments:function(G){return isObjectLike(G)&&hasOwnProperty.call(G,"callee")&&!propertyIsEnumerable.call(G,"callee")},isArguments_1=isArguments$2,MAX_SAFE_INTEGER=9007199254740991;function isLength$1(G){return typeof G=="number"&&G>-1&&G%1==0&&G<=MAX_SAFE_INTEGER}var isLength_1=isLength$1,castPath=_castPath,isArguments$1=isArguments_1,isArray$2=isArray_1,isIndex=_isIndex,isLength=isLength_1,toKey=_toKey;function hasPath$1(G,W,X){W=castPath(W,G);for(var V=-1,Z=W.length,re=!1;++V<Z;){var se=toKey(W[V]);if(!(re=G!=null&&X(G,se)))break;G=G[se]}return re||++V!=Z?re:(Z=G==null?0:G.length,!!Z&&isLength(Z)&&isIndex(se,Z)&&(isArray$2(G)||isArguments$1(G)))}var _hasPath=hasPath$1,baseHasIn=_baseHasIn,hasPath=_hasPath;function hasIn$1(G,W){return G!=null&&hasPath(G,W,baseHasIn)}var hasIn_1=hasIn$1,basePickBy=_basePickBy,hasIn=hasIn_1;function basePick$1(G,W){return basePickBy(G,W,function(X,V){return hasIn(G,V)})}var _basePick=basePick$1;function arrayPush$1(G,W){for(var X=-1,V=W.length,Z=G.length;++X<V;)G[Z+X]=W[X];return G}var _arrayPush=arrayPush$1,Symbol$1=_Symbol,isArguments=isArguments_1,isArray$1=isArray_1,spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable$1(G){return isArray$1(G)||isArguments(G)||!!(spreadableSymbol&&G&&G[spreadableSymbol])}var _isFlattenable=isFlattenable$1,arrayPush=_arrayPush,isFlattenable=_isFlattenable;function baseFlatten$1(G,W,X,V,Z){var re=-1,se=G.length;for(X||(X=isFlattenable),Z||(Z=[]);++re<se;){var ue=G[re];W>0&&X(ue)?W>1?baseFlatten$1(ue,W-1,X,V,Z):arrayPush(Z,ue):V||(Z[Z.length]=ue)}return Z}var _baseFlatten=baseFlatten$1,baseFlatten=_baseFlatten;function flatten$1(G){var W=G==null?0:G.length;return W?baseFlatten(G,1):[]}var flatten_1=flatten$1;function apply$1(G,W,X){switch(X.length){case 0:return G.call(W);case 1:return G.call(W,X[0]);case 2:return G.call(W,X[0],X[1]);case 3:return G.call(W,X[0],X[1],X[2])}return G.apply(W,X)}var _apply=apply$1,apply=_apply,nativeMax=Math.max;function overRest$1(G,W,X){return W=nativeMax(W===void 0?G.length-1:W,0),function(){for(var V=arguments,Z=-1,re=nativeMax(V.length-W,0),se=Array(re);++Z<re;)se[Z]=V[W+Z];Z=-1;for(var ue=Array(W+1);++Z<W;)ue[Z]=V[Z];return ue[W]=X(se),apply(G,this,ue)}}var _overRest=overRest$1;function constant$1(G){return function(){return G}}var constant_1=constant$1;function identity$1(G){return G}var identity_1=identity$1,constant=constant_1,defineProperty=_defineProperty,identity=identity_1,baseSetToString$1=defineProperty?function(G,W){return defineProperty(G,"toString",{configurable:!0,enumerable:!1,value:constant(W),writable:!0})}:identity,_baseSetToString=baseSetToString$1,HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut$1(G){var W=0,X=0;return function(){var V=nativeNow(),Z=HOT_SPAN-(V-X);if(X=V,Z>0){if(++W>=HOT_COUNT)return arguments[0]}else W=0;return G.apply(void 0,arguments)}}var _shortOut=shortOut$1,baseSetToString=_baseSetToString,shortOut=_shortOut,setToString$1=shortOut(baseSetToString),_setToString=setToString$1,flatten=flatten_1,overRest=_overRest,setToString=_setToString;function flatRest$1(G){return setToString(overRest(G,void 0,flatten),G+"")}var _flatRest=flatRest$1,basePick=_basePick,flatRest=_flatRest,pick$1=flatRest(function(G,W){return G==null?{}:basePick(G,W)}),pick_1=pick$1;const pick$2=getDefaultExportFromCjs(pick_1),token="%[a-f0-9]{2}",singleMatcher=new RegExp("("+token+")|([^%]+?)","gi"),multiMatcher=new RegExp("("+token+")+","gi");function decodeComponents(G,W){try{return[decodeURIComponent(G.join(""))]}catch{}if(G.length===1)return G;W=W||1;const X=G.slice(0,W),V=G.slice(W);return Array.prototype.concat.call([],decodeComponents(X),decodeComponents(V))}function decode$1(G){try{return decodeURIComponent(G)}catch{let W=G.match(singleMatcher)||[];for(let X=1;X<W.length;X++)G=decodeComponents(W,X).join(""),W=G.match(singleMatcher)||[];return G}}function customDecodeURIComponent(G){const W={"%FE%FF":"ï¿½ï¿½","%FF%FE":"ï¿½ï¿½"};let X=multiMatcher.exec(G);for(;X;){try{W[X[0]]=decodeURIComponent(X[0])}catch{const Z=decode$1(X[0]);Z!==X[0]&&(W[X[0]]=Z)}X=multiMatcher.exec(G)}W["%C2"]="ï¿½";const V=Object.keys(W);for(const Z of V)G=G.replace(new RegExp(Z,"g"),W[Z]);return G}function decodeUriComponent(G){if(typeof G!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof G+"`");try{return decodeURIComponent(G)}catch{return customDecodeURIComponent(G)}}function splitOnFirst(G,W){if(!(typeof G=="string"&&typeof W=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(G===""||W==="")return[];const X=G.indexOf(W);return X===-1?[]:[G.slice(0,X),G.slice(X+W.length)]}function includeKeys(G,W){const X={};if(Array.isArray(W))for(const V of W){const Z=Object.getOwnPropertyDescriptor(G,V);Z!=null&&Z.enumerable&&Object.defineProperty(X,V,Z)}else for(const V of Reflect.ownKeys(G)){const Z=Object.getOwnPropertyDescriptor(G,V);if(Z.enumerable){const re=G[V];W(V,re,G)&&Object.defineProperty(X,V,Z)}}return X}const isNullOrUndefined=G=>G==null,strictUriEncode=G=>encodeURIComponent(G).replace(/[!'()*]/g,W=>`%${W.charCodeAt(0).toString(16).toUpperCase()}`),encodeFragmentIdentifier=Symbol("encodeFragmentIdentifier");function encoderForArrayFormat(G){switch(G.arrayFormat){case"index":return W=>(X,V)=>{const Z=X.length;return V===void 0||G.skipNull&&V===null||G.skipEmptyString&&V===""?X:V===null?[...X,[encode(W,G),"[",Z,"]"].join("")]:[...X,[encode(W,G),"[",encode(Z,G),"]=",encode(V,G)].join("")]};case"bracket":return W=>(X,V)=>V===void 0||G.skipNull&&V===null||G.skipEmptyString&&V===""?X:V===null?[...X,[encode(W,G),"[]"].join("")]:[...X,[encode(W,G),"[]=",encode(V,G)].join("")];case"colon-list-separator":return W=>(X,V)=>V===void 0||G.skipNull&&V===null||G.skipEmptyString&&V===""?X:V===null?[...X,[encode(W,G),":list="].join("")]:[...X,[encode(W,G),":list=",encode(V,G)].join("")];case"comma":case"separator":case"bracket-separator":{const W=G.arrayFormat==="bracket-separator"?"[]=":"=";return X=>(V,Z)=>Z===void 0||G.skipNull&&Z===null||G.skipEmptyString&&Z===""?V:(Z=Z===null?"":Z,V.length===0?[[encode(X,G),W,encode(Z,G)].join("")]:[[V,encode(Z,G)].join(G.arrayFormatSeparator)])}default:return W=>(X,V)=>V===void 0||G.skipNull&&V===null||G.skipEmptyString&&V===""?X:V===null?[...X,encode(W,G)]:[...X,[encode(W,G),"=",encode(V,G)].join("")]}}function parserForArrayFormat(G){let W;switch(G.arrayFormat){case"index":return(X,V,Z)=>{if(W=/\[(\d*)]$/.exec(X),X=X.replace(/\[\d*]$/,""),!W){Z[X]=V;return}Z[X]===void 0&&(Z[X]={}),Z[X][W[1]]=V};case"bracket":return(X,V,Z)=>{if(W=/(\[])$/.exec(X),X=X.replace(/\[]$/,""),!W){Z[X]=V;return}if(Z[X]===void 0){Z[X]=[V];return}Z[X]=[...Z[X],V]};case"colon-list-separator":return(X,V,Z)=>{if(W=/(:list)$/.exec(X),X=X.replace(/:list$/,""),!W){Z[X]=V;return}if(Z[X]===void 0){Z[X]=[V];return}Z[X]=[...Z[X],V]};case"comma":case"separator":return(X,V,Z)=>{const re=typeof V=="string"&&V.includes(G.arrayFormatSeparator),se=typeof V=="string"&&!re&&decode(V,G).includes(G.arrayFormatSeparator);V=se?decode(V,G):V;const ue=re||se?V.split(G.arrayFormatSeparator).map(H=>decode(H,G)):V===null?V:decode(V,G);Z[X]=ue};case"bracket-separator":return(X,V,Z)=>{const re=/(\[])$/.test(X);if(X=X.replace(/\[]$/,""),!re){Z[X]=V&&decode(V,G);return}const se=V===null?[]:V.split(G.arrayFormatSeparator).map(ue=>decode(ue,G));if(Z[X]===void 0){Z[X]=se;return}Z[X]=[...Z[X],...se]};default:return(X,V,Z)=>{if(Z[X]===void 0){Z[X]=V;return}Z[X]=[...[Z[X]].flat(),V]}}}function validateArrayFormatSeparator(G){if(typeof G!="string"||G.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function encode(G,W){return W.encode?W.strict?strictUriEncode(G):encodeURIComponent(G):G}function decode(G,W){return W.decode?decodeUriComponent(G):G}function keysSorter(G){return Array.isArray(G)?G.sort():typeof G=="object"?keysSorter(Object.keys(G)).sort((W,X)=>Number(W)-Number(X)).map(W=>G[W]):G}function removeHash(G){const W=G.indexOf("#");return W!==-1&&(G=G.slice(0,W)),G}function getHash(G){let W="";const X=G.indexOf("#");return X!==-1&&(W=G.slice(X)),W}function parseValue(G,W){return W.parseNumbers&&!Number.isNaN(Number(G))&&typeof G=="string"&&G.trim()!==""?G=Number(G):W.parseBooleans&&G!==null&&(G.toLowerCase()==="true"||G.toLowerCase()==="false")&&(G=G.toLowerCase()==="true"),G}function extract(G){G=removeHash(G);const W=G.indexOf("?");return W===-1?"":G.slice(W+1)}function parse$1(G,W){W={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,...W},validateArrayFormatSeparator(W.arrayFormatSeparator);const X=parserForArrayFormat(W),V=Object.create(null);if(typeof G!="string"||(G=G.trim().replace(/^[?#&]/,""),!G))return V;for(const Z of G.split("&")){if(Z==="")continue;const re=W.decode?Z.replace(/\+/g," "):Z;let[se,ue]=splitOnFirst(re,"=");se===void 0&&(se=re),ue=ue===void 0?null:["comma","separator","bracket-separator"].includes(W.arrayFormat)?ue:decode(ue,W),X(decode(se,W),ue,V)}for(const[Z,re]of Object.entries(V))if(typeof re=="object"&&re!==null)for(const[se,ue]of Object.entries(re))re[se]=parseValue(ue,W);else V[Z]=parseValue(re,W);return W.sort===!1?V:(W.sort===!0?Object.keys(V).sort():Object.keys(V).sort(W.sort)).reduce((Z,re)=>{const se=V[re];return Z[re]=se&&typeof se=="object"&&!Array.isArray(se)?keysSorter(se):se,Z},Object.create(null))}function stringify(G,W){if(!G)return"";W={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...W},validateArrayFormatSeparator(W.arrayFormatSeparator);const X=se=>W.skipNull&&isNullOrUndefined(G[se])||W.skipEmptyString&&G[se]==="",V=encoderForArrayFormat(W),Z={};for(const[se,ue]of Object.entries(G))X(se)||(Z[se]=ue);const re=Object.keys(Z);return W.sort!==!1&&re.sort(W.sort),re.map(se=>{const ue=G[se];return ue===void 0?"":ue===null?encode(se,W):Array.isArray(ue)?ue.length===0&&W.arrayFormat==="bracket-separator"?encode(se,W)+"[]":ue.reduce(V(se),[]).join("&"):encode(se,W)+"="+encode(ue,W)}).filter(se=>se.length>0).join("&")}function parseUrl(G,W){var Z;W={decode:!0,...W};let[X,V]=splitOnFirst(G,"#");return X===void 0&&(X=G),{url:((Z=X==null?void 0:X.split("?"))==null?void 0:Z[0])??"",query:parse$1(extract(G),W),...W&&W.parseFragmentIdentifier&&V?{fragmentIdentifier:decode(V,W)}:{}}}function stringifyUrl(G,W){W={encode:!0,strict:!0,[encodeFragmentIdentifier]:!0,...W};const X=removeHash(G.url).split("?")[0]||"",V=extract(G.url),Z={...parse$1(V,{sort:!1}),...G.query};let re=stringify(Z,W);re&&(re=`?${re}`);let se=getHash(G.url);if(G.fragmentIdentifier){const ue=new URL(X);ue.hash=G.fragmentIdentifier,se=W[encodeFragmentIdentifier]?ue.hash:`#${G.fragmentIdentifier}`}return`${X}${re}${se}`}function pick(G,W,X){X={parseFragmentIdentifier:!0,[encodeFragmentIdentifier]:!1,...X};const{url:V,query:Z,fragmentIdentifier:re}=parseUrl(G,X);return stringifyUrl({url:V,query:includeKeys(Z,W),fragmentIdentifier:re},X)}function exclude(G,W,X){const V=Array.isArray(W)?Z=>!W.includes(Z):(Z,re)=>!W(Z,re);return pick(G,V,X)}const queryString=Object.freeze(Object.defineProperty({__proto__:null,exclude,extract,parse:parse$1,parseUrl,pick,stringify,stringifyUrl},Symbol.toStringTag,{value:"Module"})),{parse:_qsParse,stringify:qsStringify}=queryString,qsParse=memoize$2(_qsParse),decodeString=G=>G,decodeBoolean=G=>G==="true",decodeInteger=G=>parseInt(G),PERSISTED_STATE_FIELDS={feedUrl:{decode:decodeString,apply:(G,W)=>W.emit("feed:set-url",G)},feedSyncStopped:{decode:decodeBoolean,apply:(G,W)=>{W.emit(`feed:${G?"stop":"start"}-sync`)}},feedSyncInterval:{decode:decodeInteger,apply:(G,W)=>{W.emit("feed:set-sync-interval",G)}},view:{decode:decodeString,apply:(G,W)=>W.emit("view:set",G)},shapeIdsByTripIdUrl:{decode:decodeString,apply:(G,W)=>W.emit("shape-ids-by-trip-id-url:set",G)},shapeUrl:{decode:decodeString,apply:(G,W)=>W.emit("shape-url:set",G)},focusedTripId:{decode:decodeString,apply:(G,W)=>W.emit("focus-trip-id",G)},focusedVehicleId:{decode:decodeString,apply:(G,W)=>W.emit("focus-vehicle-id",G)}},pluckState=G=>pick$2(G,Object.keys(PERSISTED_STATE_FIELDS)),urlStore=(G,W)=>{const X=re=>{for(const[se,ue]of Object.entries(re)){const{decode:H,apply:ye}=PERSISTED_STATE_FIELDS[se];ye(H(ue),W)}W.emit(W.STATE_CHANGE)};window.addEventListener("popstate",re=>{const se=pluckState(re.state||{});X(se)});const V=debounce$1(()=>{const re=pluckState(G),se={...qsParse(location.search.slice(1)),...re},ue="?"+qsStringify(se);ue!==location.search&&history.replaceState(re,"_",ue)},500,{leading:!0});W.on(W.STATE_CHANGE,V);const Z=pluckState(qsParse(location.search.slice(1)));setTimeout(X,1,Z)},name$1="gtfs-rt-inspector",description="Web app to inspect & analyze any GTFS Realtime feed.",version="1.0.0",keywords=["gtfs","realtime","gtfs-rt","public transport","transit"],author="Jannis R <mail@jannisr.de>",homepage="https://github.com/derhuerst/gtfs-rt-inspector",repository="derhuerst/gtfs-rt-inspector",bugs="https://github.com/derhuerst/gtfs-rt-inspector/issues",license="ISC",type="module",engines={node:">=18"},scripts={lint:"eslint --ignore-path .gitignore .",build:"vite build",dev:"vite"},dependencies={"abort-controller":"^3.0.0",buffer:"^6.0.3","content-type":"^1.0.4","core-js":"^3.17.2",events:"^3.2.0","fetch-periodic-sync":"^1.1.2","fetch-ponyfill":"^7.1.0","gtfs-rt-bindings":"^4.0.1",lodash:"^4.17.20","mapbox-gl":"^2.1.1",ms:"^2.1.3","object-inspect":"^1.11.0",preact:"^10.19.6","query-string":"^8.2.0","regenerator-runtime":"^0.14.1","url-template":"^3.1.0"},devDependencies={"@preact/preset-vite":"^2.8.2",eslint:"^8.12.0",vite:"^5.2.8"},browserslist=["defaults"],pkg={private:!0,name:name$1,description,version,keywords,author,homepage,repository,bugs,license,type,engines,scripts,dependencies,devDependencies,browserslist};var f=0;function u(G,W,X,V,Z,re){var se,ue,H={};for(ue in W)ue=="ref"?se=W[ue]:H[ue]=W[ue];var ye={type:G,props:H,key:X,ref:se,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--f,__i:-1,__u:0,__source:Z,__self:re};if(typeof G=="function"&&(se=G.defaultProps))for(ue in se)H[ue]===void 0&&(H[ue]=se[ue]);return l.vnode&&l.vnode(ye),ye}const barView=({state:G,emit:W})=>{const X=(ye,Ie)=>{const Ee=Fe=>{Fe.metaKey||Fe.ctrlKey||(Fe.preventDefault(),W("view:set",ye))};return u("li",{class:Ie?"active":null,children:u("a",{href:"?view="+ye,onClick:Ee,children:ye})})},V=u("ul",{class:"nav",children:[X("log",G.view==="log"),X("inspector",G.view==="inspector"),X("map",G.view==="map"),u("li",{children:u("a",{href:pkg.homepage,target:"_parent",title:name+" homepage",children:"?"})})]}),Z=ye=>{W("feed:set-url",ye.target.value)},re=()=>{W("feed:sync")},se=()=>{G.feedSyncStopped?W("feed:start-sync"):W("feed:stop-sync")},ue=ye=>{const Ie=parseInt(ye.target.value);W("feed:set-sync-interval",Ie)},H=u("div",{class:"feed",children:[u("input",{onInput:Z,value:G.feedUrl}),u("input",{class:"interval",type:"number",min:"1",step:"10",onChange:ue,value:G.feedSyncInterval}),u("button",{class:G.feedSyncing?"sync syncing":"sync",onClick:re,disabled:!G.feedUrl||!!G.feedSyncing,children:u("span",{children:"â»"})}),u("button",{onClick:se,disabled:!G.feedUrl,children:G.feedSyncStopped?"â¶ï¸":"â¸"})]});return u("div",{class:"bar",children:[u("div",{class:"logo",children:"ðð"}),V,H]})};var s=1e3,m=s*60,h=m*60,d=h*24,w=d*7,y=d*365.25,ms=function(G,W){W=W||{};var X=typeof G;if(X==="string"&&G.length>0)return parse(G);if(X==="number"&&isFinite(G))return W.long?fmtLong(G):fmtShort(G);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(G))};function parse(G){if(G=String(G),!(G.length>100)){var W=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(G);if(W){var X=parseFloat(W[1]),V=(W[2]||"ms").toLowerCase();switch(V){case"years":case"year":case"yrs":case"yr":case"y":return X*y;case"weeks":case"week":case"w":return X*w;case"days":case"day":case"d":return X*d;case"hours":case"hour":case"hrs":case"hr":case"h":return X*h;case"minutes":case"minute":case"mins":case"min":case"m":return X*m;case"seconds":case"second":case"secs":case"sec":case"s":return X*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return X;default:return}}}}function fmtShort(G){var W=Math.abs(G);return W>=d?Math.round(G/d)+"d":W>=h?Math.round(G/h)+"h":W>=m?Math.round(G/m)+"m":W>=s?Math.round(G/s)+"s":G+"ms"}function fmtLong(G){var W=Math.abs(G);return W>=d?plural(G,W,d,"day"):W>=h?plural(G,W,h,"hour"):W>=m?plural(G,W,m,"minute"):W>=s?plural(G,W,s,"second"):G+" ms"}function plural(G,W,X,V){var Z=W>=X*1.5;return Math.round(G/X)+" "+V+(Z?"s":"")}const ms$1=getDefaultExportFromCjs(ms),renderDelay=G=>typeof G!="number"?"?":G===0?"0s":ms$1(G*1e3),renderTimestamp=G=>new Date(G*1e3).toISOString(),renderFeedLogEntry=G=>{const{entityId:W,timestamp:X,routeId:V,directionId:Z,tripId:re,vehicleId:se,vehicleLabel:ue,stopId:H,tArrival:ye,delay:Ie}=G;return u("tr",{id:"entity-"+W,children:[u("td",{children:u("code",{children:W})}),u("td",{children:renderTimestamp(X)}),u("td",{children:u("code",{children:V})}),u("td",{children:u("code",{children:Z})}),u("td",{children:u("code",{children:re})}),u("td",{children:u("code",{children:se})}),u("td",{children:u("code",{children:ue})}),u("td",{children:u("code",{children:H})}),u("td",{children:renderTimestamp(ye)}),u("td",{children:renderDelay(Ie)})]})},logView=({state:G,emit:W})=>{const X=G.feedLog.length,V=G.feedLog.slice(0,1e3);return u("div",{class:"log",children:[u("p",{children:["Showing ",V.length,X>V.length?" out of "+X:null," ",u("code",{children:"StopTimeUpdate"}),"s."]}),u("table",{children:[u("thead",{children:[u("tr",{children:[u("th",{rowspan:"2",children:u("code",{children:u("abbr",{title:"entity.id",children:"e_id"})})}),u("th",{rowspan:"2",children:u("abbr",{title:"stop_time_update[].timestamp or feed timestamp",children:u("code",{children:"t"})})}),u("th",{colspan:"2",children:u("code",{children:"trip"})}),u("th",{colspan:"3",children:u("code",{children:"vehicle"})}),u("th",{colspan:"3",children:u("code",{children:"stop_time_update"})})]}),u("tr",{children:[u("th",{children:u("code",{children:"route_id"})}),u("th",{children:u("code",{children:u("abbr",{title:"trip.direction_id",children:"dir_id"})})}),u("th",{children:u("code",{children:"trip_id"})}),u("th",{children:u("code",{children:"id"})}),u("th",{children:u("code",{children:"label"})}),u("th",{children:u("code",{children:"stop_id"})}),u("th",{children:u("code",{children:u("abbr",{title:"stop_time_update[].arrival.time",children:"arr"})})}),u("th",{children:u("code",{children:u("abbr",{title:"stop_time_update[].arrival.delay",children:"delay"})})})]})]}),u("tbody",{children:V.map(renderFeedLogEntry)})]})]})},renderStartDate=G=>typeof G!="string"||!G?"?":u("code",{children:u("abbr",{title:G,children:[G.slice(4,6),"-",G.slice(6,8)]})}),renderStartTime=G=>typeof G!="string"||!G?"?":u("code",{children:G}),{SCHEDULED,SKIPPED,NO_DATA}=gtfsRtBindings.TripUpdate.StopTimeUpdate.ScheduleRelationship,renderScheduleRelationship=G=>G===SCHEDULED?u("code",{children:u("abbr",{title:"SCHEDULED",children:"SCHED"})}):G===SKIPPED?u("code",{children:u("abbr",{title:"SKIPPED",children:"SKIP"})}):G===NO_DATA?u("code",{children:u("abbr",{title:"NO_DATA",children:"NO_DATA"})}):"?",{INCOMING_AT,STOPPED_AT,IN_TRANSIT_TO}=gtfsRtBindings.VehiclePosition.VehicleStopStatus,renderVehicleStopStatus=G=>G===INCOMING_AT?u("code",{children:u("abbr",{title:"INCOMING_AT",children:"INC_AT"})}):G===STOPPED_AT?u("code",{children:u("abbr",{title:"STOPPED_AT",children:"STOP_AT"})}):G===IN_TRANSIT_TO?u("code",{children:u("abbr",{title:"IN_TRANSIT_TO",children:"IN_TR_TO"})}):"?",renderPosition=G=>{if(!G)return"?";const W=[typeof G.latitude=="number"?G.latitude:"?",typeof G.longitude=="number"?G.longitude:"?"].join(" | "),X=typeof G.latitude=="number"?u("code",{children:G.latitude.toFixed(3)}):"?",V=typeof G.longitude=="number"?u("code",{children:G.longitude.toFixed(3)}):"?";return u("abbr",{title:W,children:[X," ",V]})};gtfsRtBindings.VehiclePosition.CongestionLevel;const renderCongestionLevel=G=>G===1?u("code",{children:u("abbr",{title:"RUNNING_SMOOTHLY",children:"SMOOTH"})}):G===2?u("code",{children:u("abbr",{title:"STOP_AND_GO",children:"STOP_GO"})}):G===3?u("code",{children:u("abbr",{title:"CONGESTION",children:"CONG"})}):G===4?u("code",{children:u("abbr",{title:"SEVERE_CONGESTION",children:"SEV_CONG"})}):"?";gtfsRtBindings.VehiclePosition.OccupancyStatus;const renderOccupancyStatus=G=>G===0?u("code",{children:u("abbr",{title:"EMPTY",children:"EMPTY"})}):G===1?u("code",{children:u("abbr",{title:"MANY_SEATS_AVAILABLE",children:"MANY_SEATS"})}):G===2?u("code",{children:u("abbr",{title:"FEW_SEATS_AVAILABLE",children:"FEW_SEATS"})}):G===3?u("code",{children:u("abbr",{title:"STANDING_ROOM_ONLY",children:"STANDING"})}):G===4?u("code",{children:u("abbr",{title:"CRUSHED_STANDING_ROOM_ONLY",children:"CRUSHED"})}):G===5?u("code",{children:u("abbr",{title:"FULL",children:"FULL"})}):G===6?u("code",{children:u("abbr",{title:"NOT_ACCEPTING_PASSENGERS",children:"NOT_ACCEPT"})}):"?",renderVehicleId=(G,W,X)=>u("a",{href:"#",onClick:Z=>{X("focus-vehicle-id",G),X("focus-trip-id",W.trip.trip_id),X("view:set","map"),Z.preventDefault()},alt:"show vehicle on the map",children:u("code",{children:G})}),renderTripUpdate=(G,W)=>{const X=G.trip_update.trip||{},V=G.trip_update.vehicle||{};return u("tr",{id:"entity-"+G.id,children:[u("td",{children:u("code",{children:G.id})}),u("td",{children:u("code",{children:X.route_id})}),u("td",{children:u("code",{children:X.direction_id})}),u("td",{children:u("code",{children:X.trip_id})}),u("td",{children:renderStartDate(X.start_date)}),u("td",{children:renderStartTime(X.start_time)}),u("td",{children:renderScheduleRelationship(X.schedule_relationship)}),u("td",{children:u("code",{children:V.id})}),u("td",{children:u("code",{children:V.label})}),u("td",{children:u("code",{children:V.license_plate})}),u("td",{children:renderDelay(G.trip_update.delay)})]})},renderTripUpdates=(G,W)=>{const X=G.entity.filter(V=>!!V.trip_update);return u("div",{children:[u("h2",{children:[u("code",{children:"TripUpdate"}),"s (",X.length,")"]}),u("table",{class:"trip-updates",children:[u("thead",{children:[u("tr",{children:[u("th",{rowspan:"2",children:u("code",{children:u("abbr",{title:"entity_id",children:"e_id"})})}),u("th",{colspan:"5",children:u("code",{children:"trip"})}),u("th",{rowspan:"2",children:u("code",{children:u("abbr",{title:"schedule_relationship",children:"s_rel"})})}),u("th",{colspan:"3",children:u("code",{children:"vehicle"})}),u("th",{rowspan:"2",children:u("code",{children:"delay"})})]}),u("tr",{children:[u("th",{children:u("code",{children:"route_id"})}),u("th",{children:u("code",{children:u("abbr",{title:"direction_id",children:"dir_id"})})}),u("th",{children:u("code",{children:"trip_id"})}),u("th",{children:u("code",{children:u("abbr",{title:"start_date",children:"st_date"})})}),u("th",{children:u("code",{children:u("abbr",{title:"start_time",children:"st_time"})})}),u("th",{children:u("code",{children:"id"})}),u("th",{children:u("code",{children:"label"})}),u("th",{children:u("abbr",{title:"license_plate",children:u("code",{children:"lic_pl"})})})]})]}),u("tbody",{children:X.map(renderTripUpdate)})]})]})},renderVehiclePosition=(G,W)=>{const X=G.vehicle.trip||{},V=G.vehicle.vehicle||{};return u("tr",{id:"entity-"+G.id,children:[u("td",{children:u("code",{children:G.id})}),u("td",{children:u("code",{children:X.route_id})}),u("td",{children:u("code",{children:X.direction_id})}),u("td",{children:u("code",{children:X.trip_id})}),u("td",{children:renderStartDate(X.start_date)}),u("td",{children:renderStartTime(X.start_time)}),u("td",{children:renderVehicleId(V.id,G.vehicle,W)}),u("td",{children:u("code",{children:V.label})}),u("td",{children:u("code",{children:V.license_plate})}),u("td",{children:u("code",{children:G.vehicle.current_stop_sequence})}),u("td",{children:u("code",{children:G.vehicle.stop_id})}),u("td",{children:renderVehicleStopStatus(G.vehicle.current_status)}),u("td",{children:renderPosition(G.vehicle.position)}),u("td",{children:renderCongestionLevel(G.vehicle.congestion_level)}),u("td",{children:renderOccupancyStatus(G.vehicle.occupancy_status)})]})},renderVehiclePositions=(G,W)=>{const X=G.entity.filter(V=>!!V.vehicle);return u("div",{children:[u("h2",{children:[u("code",{children:"VehiclePosition"}),"s (",X.length,")"]}),u("table",{class:"vehicle-positions",children:[u("thead",{children:[u("tr",{children:[u("th",{rowspan:"2",children:u("code",{children:u("abbr",{title:"entity_id",children:"e_id"})})}),u("th",{colspan:"5",children:u("code",{children:"trip"})}),u("th",{colspan:"3",children:u("code",{children:"vehicle"})}),u("th",{rowspan:"2",children:u("code",{children:u("abbr",{title:"current_stop_sequence",children:"st_seq"})})}),u("th",{rowspan:"2",children:u("code",{children:"stop_id"})}),u("th",{rowspan:"2",children:u("code",{children:u("abbr",{title:"current_status",children:"status"})})}),u("th",{rowspan:"2",children:u("code",{children:"position"})}),u("th",{rowspan:"2",children:u("code",{children:u("abbr",{title:"congestion_level",children:"cong_lvl"})})}),u("th",{rowspan:"2",children:u("code",{children:u("abbr",{title:"occupancy_status",children:"occu"})})})]}),u("tr",{children:[u("th",{children:u("code",{children:"route_id"})}),u("th",{children:u("code",{children:u("abbr",{title:"direction_id",children:"dir_id"})})}),u("th",{children:u("code",{children:"trip_id"})}),u("th",{children:u("code",{children:u("abbr",{title:"start_date",children:"st_date"})})}),u("th",{children:u("code",{children:u("abbr",{title:"start_time",children:"st_time"})})}),u("th",{children:u("code",{children:"id"})}),u("th",{children:u("code",{children:"label"})}),u("th",{children:u("abbr",{title:"license_plate",children:u("code",{children:"lic_plate"})})})]})]}),u("tbody",{children:X.map(V=>renderVehiclePosition(V,W))})]})]})},inspectorView=({state:G,emit:W})=>{const X=G.feedData;return!Array.isArray(X.entity)||X.entity.length===0?u("p",{children:["The feed has no ",u("code",{children:"FeedEntity"}),"s."]}):u("div",{class:"inspector",children:[renderTripUpdates(X),renderVehiclePositions(X,W)]})};var mapboxGl={exports:{}};(function(G,W){var X={};(function(V,Z){G.exports=Z()})(commonjsGlobal,function(){var V,Z,re;function se(H,ye){if(!V)V=ye;else if(!Z)Z=ye;else{var Ie="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+V+")(sharedChunk); ("+Z+")(sharedChunk); self.onerror = null;",Ee={};V(Ee),re=ye(Ee),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(re.workerUrl=window.URL.createObjectURL(new Blob([Ie],{type:"text/javascript"})))}}se(["exports"],function(H){var ye=typeof self<"u"?self:{},Ie="2.15.0";let Ee;const Fe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Ee==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ee=X.API_URL_REGEX!=null?new RegExp(X.API_URL_REGEX):t}catch{Ee=t}}return Ee},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Fe.API_URL)return null;try{const t=new URL(Fe.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},je={supported:!1,testSupport:function(t){!Ot&&wt&&($t?jt(t):mt=t)}};let mt,wt,Ot=!1,$t=!1;function jt(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,wt),t.isContextLost())return;je.supported=!0}catch{}t.deleteTexture(e),Ot=!0}ye.document&&(wt=ye.document.createElement("img"),wt.onload=function(){mt&&jt(mt),mt=null,$t=!0},wt.onerror=function(){Ot=!0,mt=null},wt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const nr="01";function sr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var gr=hr;function hr(t,e,F,K){this.cx=3*t,this.bx=3*(F-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(K-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=F,this.p2y=K}hr.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var F=t,K=0;K<8;K++){var J=this.sampleCurveX(F)-t;if(Math.abs(J)<e)return F;var ee=this.sampleCurveDerivativeX(F);if(Math.abs(ee)<1e-6)break;F-=J/ee}var ie=0,oe=1;for(F=t,K=0;K<20&&(J=this.sampleCurveX(F),!(Math.abs(J-t)<e));K++)t>J?ie=F:oe=F,F=.5*(oe-ie)+ie;return F},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Ir=sr(gr),br=yr;function yr(t,e){this.x=t,this.y=e}yr.prototype={clone:function(){return new yr(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,F=t.y-this.y;return e*e+F*F},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),F=Math.sin(t),K=F*this.x+e*this.y;return this.x=e*this.x-F*this.y,this.y=K,this},_rotateAround:function(t,e){var F=Math.cos(t),K=Math.sin(t),J=e.y+K*(this.x-e.x)+F*(this.y-e.y);return this.x=e.x+F*(this.x-e.x)-K*(this.y-e.y),this.y=J,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yr.convert=function(t){return t instanceof yr?t:Array.isArray(t)?new yr(t[0],t[1]):t};var zt=sr(br);const gi=Math.PI/180,Ti=180/Math.PI;function dr(t){return t*gi}function kr(t){return t*Ti}const un=[[0,0],[1,0],[1,1],[0,1]];function qi(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,F=e*t;return 4*(t<.5?F:3*(t-e)+F-.75)}function xt(t,e,F,K){const J=new Ir(t,e,F,K);return function(ee){return J.solve(ee)}}const Zt=xt(.25,.1,.25,1);function ht(t,e,F){return Math.min(F,Math.max(e,t))}function Rt(t,e,F){return(F=ht((F-t)/(e-t),0,1))*F*(3-2*F)}function It(t,e,F){const K=F-e,J=((t-e)%K+K)%K+e;return J===e?F:J}function Ht(t,e,F){if(!t.length)return F(null,[]);let K=t.length;const J=new Array(t.length);let ee=null;t.forEach((ie,oe)=>{e(ie,(le,ce)=>{le&&(ee=le),J[oe]=ce,--K==0&&F(ee,J)})})}function ar(t){const e=[];for(const F in t)e.push(t[F]);return e}function mr(t,...e){for(const F of e)for(const K in F)t[K]=F[K];return t}let Fr=1;function si(){return Fr++}function xi(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Xr(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function wn(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Yi(t,e){t.forEach(F=>{e[F]&&(e[F]=e[F].bind(e))})}function Ji(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Rr(t,e,F){const K={};for(const J in t)K[J]=e.call(F||this,t[J],J,t);return K}function vn(t,e,F){const K={};for(const J in t)e.call(F||this,t[J],J,t)&&(K[J]=t[J]);return K}function Fi(t){return Array.isArray(t)?t.map(Fi):typeof t=="object"&&t?Rr(t,Fi):t}const Ro={};function di(t){Ro[t]||(typeof console<"u"&&console.warn(t),Ro[t]=!0)}function Qi(t,e,F){return(F.y-t.y)*(e.x-t.x)>(e.y-t.y)*(F.x-t.x)}function Yo(t){let e=0;for(let F,K,J=0,ee=t.length,ie=ee-1;J<ee;ie=J++)F=t[J],K=t[ie],e+=(K.x-F.x)*(F.y+K.y);return e}function Mn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function en(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(F,K,J,ee)=>{const ie=J||ee;return e[K]=!ie||ie.toLowerCase(),""}),e["max-age"]){const F=parseInt(e["max-age"],10);isNaN(F)?delete e["max-age"]:e["max-age"]=F}return e}let zn=null;function Hi(t){if(zn==null){const e=t.navigator?t.navigator.userAgent:null;zn=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return zn}function Qn(t){try{const e=ye[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Un(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const sn="mapbox-tiles";let Jo=500,Me=50,$e,be;function We(){try{return ye.caches}catch{}}function ot(){We()&&!$e&&($e=ye.caches.open(sn))}function vt(t){const e=t.indexOf("?");if(e<0)return t;const F=function(J){const ee=J.indexOf("?");return ee>0?J.slice(ee+1).split("&"):[]}(t),K=F.filter(J=>{const ee=J.split("=");return ee[0]==="language"||ee[0]==="worldview"});return K.length?`${t.slice(0,e)}?${K.join("&")}`:t.slice(0,e)}let Dt=1/0;const Ar={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ar);class Yr extends Error{constructor(e,F,K){F===401&&lt(K)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=F,this.url=K}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Zr=Mn()?()=>self.worker&&self.worker.referrer:()=>(ye.location.protocol==="blob:"?ye.parent:ye).location.href,Jr=function(t,e){if(!(/^file:/.test(F=t.url)||/^file:/.test(Zr())&&!/^\w+:/.test(F))){if(ye.fetch&&ye.Request&&ye.AbortController&&ye.Request.prototype.hasOwnProperty("signal"))return function(K,J){const ee=new ye.AbortController,ie=new ye.Request(K.url,{method:K.method||"GET",body:K.body,credentials:K.credentials,headers:K.headers,referrer:Zr(),referrerPolicy:K.referrerPolicy,signal:ee.signal});let oe=!1,le=!1;const ce=(pe=ie.url).indexOf("sku=")>0&&lt(pe);var pe;K.type==="json"&&ie.headers.set("Accept","application/json");const me=(xe,we,Ae)=>{if(le)return;if(xe&&xe.message!=="SecurityError"&&di(xe.toString()),we&&Ae)return _e(we);const Re=Date.now();ye.fetch(ie).then(ze=>{if(ze.ok){const Ze=ce?ze.clone():null;return _e(ze,Ze,Re)}return J(new Yr(ze.statusText,ze.status,K.url))}).catch(ze=>{ze.name!=="AbortError"&&J(new Error(`${ze.message} ${K.url}`))})},_e=(xe,we,Ae)=>{(K.type==="arrayBuffer"?xe.arrayBuffer():K.type==="json"?xe.json():xe.text()).then(Re=>{le||(we&&Ae&&function(ze,Ze,Ue){if(ot(),!$e)return;const He={status:Ze.status,statusText:Ze.statusText,headers:new ye.Headers};Ze.headers.forEach((dt,ut)=>He.headers.set(ut,dt));const Ye=en(Ze.headers.get("Cache-Control")||"");if(Ye["no-store"])return;Ye["max-age"]&&He.headers.set("Expires",new Date(Ue+1e3*Ye["max-age"]).toUTCString());const Xe=He.headers.get("Expires");Xe&&(new Date(Xe).getTime()-Ue<42e4||function(dt,ut){if(be===void 0)try{new Response(new ReadableStream),be=!0}catch{be=!1}be?ut(dt.body):dt.blob().then(ut)}(Ze,dt=>{const ut=new ye.Response(dt,He);ot(),$e&&$e.then(Tt=>Tt.put(vt(ze.url),ut)).catch(Tt=>di(Tt.message))}))}(ie,we,Ae),oe=!0,J(null,Re,xe.headers.get("Cache-Control"),xe.headers.get("Expires")))}).catch(Re=>{le||J(new Error(Re.message))})};return ce?function(xe,we){if(ot(),!$e)return we(null);const Ae=vt(xe.url);$e.then(Re=>{Re.match(Ae).then(ze=>{const Ze=function(Ue){if(!Ue)return!1;const He=new Date(Ue.headers.get("Expires")||0),Ye=en(Ue.headers.get("Cache-Control")||"");return He>Date.now()&&!Ye["no-cache"]}(ze);Re.delete(Ae),Ze&&Re.put(Ae,ze.clone()),we(null,ze,Ze)}).catch(we)}).catch(we)}(ie,me):me(null,null),{cancel:()=>{le=!0,oe||ee.abort()}}}(t,e);if(Mn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var F;return function(K,J){const ee=new ye.XMLHttpRequest;ee.open(K.method||"GET",K.url,!0),K.type==="arrayBuffer"&&(ee.responseType="arraybuffer");for(const ie in K.headers)ee.setRequestHeader(ie,K.headers[ie]);return K.type==="json"&&(ee.responseType="text",ee.setRequestHeader("Accept","application/json")),ee.withCredentials=K.credentials==="include",ee.onerror=()=>{J(new Error(ee.statusText))},ee.onload=()=>{if((ee.status>=200&&ee.status<300||ee.status===0)&&ee.response!==null){let ie=ee.response;if(K.type==="json")try{ie=JSON.parse(ee.response)}catch(oe){return J(oe)}J(null,ie,ee.getResponseHeader("Cache-Control"),ee.getResponseHeader("Expires"))}else J(new Yr(ee.statusText,ee.status,K.url))},ee.send(K.body),{cancel:()=>ee.abort()}}(t,e)},Wr=function(t,e){return Jr(mr(t,{type:"arrayBuffer"}),e)};function gs(t){const e=ye.document.createElement("a");return e.href=t,e.protocol===ye.document.location.protocol&&e.host===ye.document.location.host}const Ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Oe,Ce;Oe=[],Ce=0;const qe=function(t,e){if(je.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ce>=Fe.MAX_PARALLEL_IMAGE_REQUESTS){const ee={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Oe.push(ee),ee}Ce++;let F=!1;const K=()=>{if(!F)for(F=!0,Ce--;Oe.length&&Ce<Fe.MAX_PARALLEL_IMAGE_REQUESTS;){const ee=Oe.shift(),{requestParameters:ie,callback:oe,cancelled:le}=ee;le||(ee.cancel=qe(ie,oe).cancel)}},J=Wr(t,(ee,ie,oe,le)=>{K(),ee?e(ee):ie&&(ye.createImageBitmap?function(ce,pe){const me=new ye.Blob([new Uint8Array(ce)],{type:"image/png"});ye.createImageBitmap(me).then(_e=>{pe(null,_e)}).catch(_e=>{pe(new Error(`Could not load image because of ${_e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(ie,(ce,pe)=>e(ce,pe,oe,le)):function(ce,pe){const me=new ye.Image,_e=ye.URL;me.onload=()=>{pe(null,me),_e.revokeObjectURL(me.src),me.onload=null,ye.requestAnimationFrame(()=>{me.src=Ke})},me.onerror=()=>pe(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const xe=new ye.Blob([new Uint8Array(ce)],{type:"image/png"});me.src=ce.byteLength?_e.createObjectURL(xe):Ke}(ie,(ce,pe)=>e(ce,pe,oe,le)))});return{cancel:()=>{J.cancel(),K()}}},Je="NO_ACCESS_TOKEN";function it(t){return t.indexOf("mapbox:")===0}function lt(t){return Fe.API_URL_REGEX.test(t)}function st(t){return Fe.API_CDN_URL_REGEX.test(t)}function rt(t){return Fe.API_STYLE_REGEX.test(t)&&!gt(t)}function gt(t){return Fe.API_SPRITE_REGEX.test(t)}const qt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Kt(t){const e=t.match(qt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Vt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const wr="mapbox.eventData";function Or(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(ye.atob(e[1]).split("").map(F=>"%"+("00"+F.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Er{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const F=Or(Fe.ACCESS_TOKEN);let K="";return K=F&&F.u?ye.btoa(encodeURIComponent(F.u).replace(/%([0-9A-F]{2})/g,(J,ee)=>String.fromCharCode(+("0x"+ee)))):Fe.ACCESS_TOKEN||"",e?`${wr}.${e}:${K}`:`${wr}:${K}`}fetchEventData(){const e=Qn("localStorage"),F=this.getStorageKey(),K=this.getStorageKey("uuid");if(e)try{const J=ye.localStorage.getItem(F);J&&(this.eventData=JSON.parse(J));const ee=ye.localStorage.getItem(K);ee&&(this.anonId=ee)}catch{di("Unable to read from LocalStorage")}}saveEventData(){const e=Qn("localStorage"),F=this.getStorageKey(),K=this.getStorageKey("uuid");if(e)try{ye.localStorage.setItem(K,this.anonId),Object.keys(this.eventData).length>=1&&ye.localStorage.setItem(F,JSON.stringify(this.eventData))}catch{di("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,F,K,J){if(!Fe.EVENTS_URL)return;const ee=Kt(Fe.EVENTS_URL);ee.params.push(`access_token=${J||Fe.ACCESS_TOKEN||""}`);const ie={event:this.type,created:new Date(e).toISOString()},oe=F?mr(ie,F):ie,le={url:Vt(ee),headers:{"Content-Type":"text/plain"},body:JSON.stringify([oe])};this.pendingRequest=function(ce,pe){return Jr(mr(ce,{method:"POST"}),pe)}(le,ce=>{this.pendingRequest=null,K(ce),this.saveEventData(),this.processRequests(J)})}queueRequest(e,F){this.queue.push(e),this.processRequests(F)}}const Cr=new class extends Er{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Fe.EVENTS_URL&&Fe.ACCESS_TOKEN&&Array.isArray(t)&&t.some(F=>it(F)||lt(F))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Or(Fe.ACCESS_TOKEN),F=e?e.u:Fe.ACCESS_TOKEN;let K=F!==this.eventData.tokenU;wn(this.anonId)||(this.anonId=xi(),K=!0);const J=this.queue.shift();if(this.eventData.lastSuccess){const ee=new Date(this.eventData.lastSuccess),ie=new Date(J),oe=(J-this.eventData.lastSuccess)/864e5;K=K||oe>=1||oe<-1||ee.getDate()!==ie.getDate()}else K=!0;K?this.postEvent(J,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ie,skuId:nr,"enabled.telemetry":!1,userId:this.anonId},ee=>{ee||(this.eventData.lastSuccess=J,this.eventData.tokenU=F)},t):this.processRequests()}},Nr=Cr.postTurnstileEvent.bind(Cr),vi=new class extends Er{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,F,K){this.skuToken=e,this.errorCb=K,Fe.EVENTS_URL&&(F||Fe.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},F):this.errorCb(new Error(Je)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:F}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),wn(this.anonId)||(this.anonId=xi()),this.postEvent(F,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ie,skuId:nr,skuToken:this.skuToken,userId:this.anonId},K=>{K?this.errorCb(K):e&&(this.success[e]=!0)},t))}},Ai=vi.postMapLoadEvent.bind(vi),tn=new class extends Er{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Fe.EVENTS_URL&&(t||Fe.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:F}=this.queue.shift(),K=function(J){const ee=ye.performance.getEntriesByType("resource"),ie=ye.performance.getEntriesByType("mark"),oe=function(_e){const xe={};if(_e){for(const we in _e)if(we!=="other")for(const Ae of _e[we]){const Re=`${we}ResolveRangeMin`,ze=`${we}ResolveRangeMax`,Ze=`${we}RequestCount`,Ue=`${we}RequestCachedCount`;xe[Re]=Math.min(xe[Re]||1/0,Ae.startTime),xe[ze]=Math.max(xe[ze]||-1/0,Ae.responseEnd);const He=Ye=>{xe[Ye]===void 0&&(xe[Ye]=0),++xe[Ye]};Ae.transferSize!==void 0&&Ae.transferSize===0&&He(Ue),He(Ze)}}return xe}(function(_e,xe){const we={};if(_e)for(const Ae of _e){const Re=xe(Ae);we[Re]===void 0&&(we[Re]=[]),we[Re].push(Ae)}return we}(ee,Hc)),le=ye.devicePixelRatio,ce=ye.navigator.connection||ye.navigator.mozConnection||ye.navigator.webkitConnection,pe={counters:[],metadata:[],attributes:[]},me=(_e,xe,we)=>{we!=null&&_e.push({name:xe,value:we.toString()})};for(const _e in oe)me(pe.counters,_e,oe[_e]);if(J.interactionRange[0]!==1/0&&J.interactionRange[1]!==-1/0&&(me(pe.counters,"interactionRangeMin",J.interactionRange[0]),me(pe.counters,"interactionRangeMax",J.interactionRange[1])),ie)for(const _e of Object.keys(Qo)){const xe=Qo[_e],we=ie.find(Ae=>Ae.name===xe);we&&me(pe.counters,xe,we.startTime)}return me(pe.counters,"visibilityHidden",J.visibilityHidden),me(pe.attributes,"style",function(_e){if(_e)for(const xe of _e){const we=xe.name.split("?")[0];if(rt(we)){const Ae=we.split("/").slice(-2);if(Ae.length===2)return`mapbox://styles/${Ae[0]}/${Ae[1]}`}}}(ee)),me(pe.attributes,"terrainEnabled",J.terrainEnabled?"true":"false"),me(pe.attributes,"fogEnabled",J.fogEnabled?"true":"false"),me(pe.attributes,"projection",J.projection),me(pe.attributes,"zoom",J.zoom),me(pe.metadata,"devicePixelRatio",le),me(pe.metadata,"connectionEffectiveType",ce?ce.effectiveType:void 0),me(pe.metadata,"navigatorUserAgent",ye.navigator.userAgent),me(pe.metadata,"screenWidth",ye.screen.width),me(pe.metadata,"screenHeight",ye.screen.height),me(pe.metadata,"windowWidth",ye.innerWidth),me(pe.metadata,"windowHeight",ye.innerHeight),me(pe.metadata,"mapWidth",J.width/le),me(pe.metadata,"mapHeight",J.height/le),me(pe.metadata,"webglRenderer",J.renderer),me(pe.metadata,"webglVendor",J.vendor),me(pe.metadata,"sdkVersion",Ie),me(pe.metadata,"sdkIdentifier","mapbox-gl-js"),pe}(F);for(const J of K.metadata);for(const J of K.counters);for(const J of K.attributes);this.postEvent(e,K,()=>{},t)}},ki=tn.postPerformanceEvent.bind(tn),jn=new class extends Er{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,F,K){if(!Fe.API_URL||!Fe.SESSION_PATH)return;const J=Kt(Fe.API_URL+Fe.SESSION_PATH);J.params.push(`sku=${e||""}`),J.params.push(`access_token=${K||Fe.ACCESS_TOKEN||""}`);const ee={url:Vt(J),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(ie,oe){return Jr(mr(ie,{method:"GET"}),oe)}(ee,ie=>{this.pendingRequest=null,F(ie),this.saveEventData(),this.processRequests(K)})}getSessionAPI(t,e,F,K){this.skuToken=e,this.errorCb=K,Fe.SESSION_PATH&&Fe.API_URL&&(F||Fe.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},F):this.errorCb(new Error(Je)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:F}=this.queue.shift();e&&this.success[e]||this.getSession(F,this.skuToken,K=>{K?this.errorCb(K):e&&(this.success[e]=!0)},t)}},zi=jn.getSessionAPI.bind(jn),ln=new Set,Qo={create:"create",load:"load",fullLoad:"fullLoad"},gh={mark(t){ye.performance.mark(t)},measure(t,e,F){ye.performance.measure(t,e,F)}};function Hc(t){const e=t.name.split("?")[0];return st(e)&&e.includes("mapbox-gl.js")?"javascript":st(e)&&e.includes("mapbox-gl.css")?"css":function(F){return Fe.API_FONTS_REGEX.test(F)}(e)?"fontRange":gt(e)?"sprite":rt(e)?"style":function(F){return Fe.API_TILEJSON_REGEX.test(F)}(e)?"tilejson":"other"}const qr=ye.performance;function yl(t){const e=t?t.url.toString():void 0;return qr.getEntriesByName(e)}let Oa,_l,vs,Vn;const eo={now:()=>vs!==void 0?vs:ye.performance.now(),setNow(t){vs=t},restoreNow(){vs=void 0},frame(t){const e=ye.requestAnimationFrame(t);return{cancel:()=>ye.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:F,height:K}=t;Vn||(Vn=ye.document.createElement("canvas"));const J=Vn.getContext("2d",{willReadFrequently:!0});if(!J)throw new Error("failed to create canvas 2d context");return(F>Vn.width||K>Vn.height)&&(Vn.width=F,Vn.height=K),J.clearRect(-e,-e,F+2*e,K+2*e),J.drawImage(t,0,0,F,K),J.getImageData(-e,-e,F+2*e,K+2*e)},resolveURL:t=>(Oa||(Oa=ye.document.createElement("a")),Oa.href=t,Oa.href),get devicePixelRatio(){return ye.devicePixelRatio},get prefersReducedMotion(){return!!ye.matchMedia&&(_l==null&&(_l=ye.matchMedia("(prefers-reduced-motion: reduce)")),_l.matches)}};function gl(t,e,F){F[t]&&F[t].indexOf(e)!==-1||(F[t]=F[t]||[],F[t].push(e))}function vl(t,e,F){if(F&&F[t]){const K=F[t].indexOf(e);K!==-1&&F[t].splice(K,1)}}class Mo{constructor(e,F={}){mr(this,F),this.type=e}}class to extends Mo{constructor(e,F={}){super("error",mr({error:e},F))}}class Ca{on(e,F){return this._listeners=this._listeners||{},gl(e,F,this._listeners),this}off(e,F){return vl(e,F,this._listeners),vl(e,F,this._oneTimeListeners),this}once(e,F){return F?(this._oneTimeListeners=this._oneTimeListeners||{},gl(e,F,this._oneTimeListeners),this):new Promise(K=>this.once(e,K))}fire(e,F){typeof e=="string"&&(e=new Mo(e,F||{}));const K=e.type;if(this.listens(K)){e.target=this;const J=this._listeners&&this._listeners[K]?this._listeners[K].slice():[];for(const oe of J)oe.call(this,e);const ee=this._oneTimeListeners&&this._oneTimeListeners[K]?this._oneTimeListeners[K].slice():[];for(const oe of ee)vl(K,oe,this._oneTimeListeners),oe.call(this,e);const ie=this._eventedParent;ie&&(mr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),ie.fire(e))}else e instanceof to&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,F){return this._eventedParent=e,this._eventedParentData=F,this}}var Et=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ro(t,...e){for(const F of e)for(const K in F)t[K]=F[K];return t}function Oi(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ui(t){if(Array.isArray(t))return t.map(Ui);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const F in t)e[F]=Ui(t[F]);return e}return Oi(t)}class Kc extends Error{constructor(e,F){super(F),this.message=F,this.key=e}}var Gn=Kc;class $l{constructor(e,F=[]){this.parent=e,this.bindings={};for(const[K,J]of F)this.bindings[K]=J}concat(e){return new $l(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Zc=$l;const ea={kind:"null"},Qt={kind:"number"},Br={kind:"string"},Mr={kind:"boolean"},$n={kind:"color"},Dn={kind:"object"},Dr={kind:"value"},xn={kind:"collator"},Pa={kind:"formatted"},Do={kind:"resolvedImage"};function En(t,e){return{kind:"array",itemType:t,N:e}}function yi(t){if(t.kind==="array"){const e=yi(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Xc=[ea,Qt,Br,Mr,$n,Pa,Dn,En(Dr),Do];function io(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!io(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const F of Xc)if(!io(F,e))return null}}return`Expected ${yi(t)} but found ${yi(e)} instead.`}function Ra(t,e){return e.some(F=>F.kind===t.kind)}function Ma(t,e){return e.some(F=>F==="null"?t===null:F==="array"?Array.isArray(t):F==="object"?t&&!Array.isArray(t)&&typeof t=="object":F===typeof t)}var xl,Yc={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Da(t){return(t=Math.round(t))<0?0:t>255?255:t}function La(t){return Da(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function $s(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function ta(t,e,F){return F<0?F+=1:F>1&&(F-=1),6*F<1?t+(e-t)*F*6:2*F<1?e:3*F<2?t+(e-t)*(2/3-F)*6:t}try{xl={}.parseCSSColor=function(t){var e,F=t.replace(/ /g,"").toLowerCase();if(F in Yc)return Yc[F].slice();if(F[0]==="#")return F.length===4?(e=parseInt(F.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:F.length===7&&(e=parseInt(F.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var K=F.indexOf("("),J=F.indexOf(")");if(K!==-1&&J+1===F.length){var ee=F.substr(0,K),ie=F.substr(K+1,J-(K+1)).split(","),oe=1;switch(ee){case"rgba":if(ie.length!==4)return null;oe=$s(ie.pop());case"rgb":return ie.length!==3?null:[La(ie[0]),La(ie[1]),La(ie[2]),oe];case"hsla":if(ie.length!==4)return null;oe=$s(ie.pop());case"hsl":if(ie.length!==3)return null;var le=(parseFloat(ie[0])%360+360)%360/360,ce=$s(ie[1]),pe=$s(ie[2]),me=pe<=.5?pe*(ce+1):pe+ce-pe*ce,_e=2*pe-me;return[Da(255*ta(_e,me,le+1/3)),Da(255*ta(_e,me,le)),Da(255*ta(_e,me,le-1/3)),oe];default:return null}}return null}}catch{}class hn{constructor(e,F,K,J=1){this.r=e,this.g=F,this.b=K,this.a=J}static parse(e){if(!e)return;if(e instanceof hn)return e;if(typeof e!="string")return;const F=xl(e);return F?new hn(F[0]/255*F[3],F[1]/255*F[3],F[2]/255*F[3],F[3]):void 0}toString(){const[e,F,K,J]=this.toArray();return`rgba(${Math.round(e)},${Math.round(F)},${Math.round(K)},${J})`}toArray(){const{r:e,g:F,b:K,a:J}=this;return J===0?[0,0,0,0]:[255*e/J,255*F/J,255*K/J,J]}toArray01(){const{r:e,g:F,b:K,a:J}=this;return J===0?[0,0,0,0]:[e/J,F/J,K/J,J]}toArray01PremultipliedAlpha(){const{r:e,g:F,b:K,a:J}=this;return[e,F,K,J]}}hn.black=new hn(0,0,0,1),hn.white=new hn(1,1,1,1),hn.transparent=new hn(0,0,0,0),hn.red=new hn(1,0,0,1),hn.blue=new hn(0,0,1,1);var Si=hn;class bl{constructor(e,F,K){this.sensitivity=e?F?"variant":"case":F?"accent":"base",this.locale=K,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,F){return this.collator.compare(e,F)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class wl{constructor(e,F,K,J,ee){this.text=e.normalize?e.normalize():e,this.image=F,this.scale=K,this.fontStack=J,this.textColor=ee}}class fn{constructor(e){this.sections=e}static fromString(e){return new fn([new wl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof fn?e:fn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const F of this.sections){if(F.image){e.push(["image",F.image.name]);continue}e.push(F.text);const K={};F.fontStack&&(K["text-font"]=["literal",F.fontStack.split(",")]),F.scale&&(K["font-scale"]=F.scale),F.textColor&&(K["text-color"]=["rgba"].concat(F.textColor.toArray())),e.push(K)}return e}}class Tn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Tn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Jc(t,e,F,K){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof F=="number"&&F>=0&&F<=255?K===void 0||typeof K=="number"&&K>=0&&K<=1?null:`Invalid rgba value [${[t,e,F,K].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof K=="number"?[t,e,F,K]:[t,e,F]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ba(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Si||t instanceof bl||t instanceof fn||t instanceof Tn)return!0;if(Array.isArray(t)){for(const e of t)if(!Ba(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Ba(t[e]))return!1;return!0}return!1}function wi(t){if(t===null)return ea;if(typeof t=="string")return Br;if(typeof t=="boolean")return Mr;if(typeof t=="number")return Qt;if(t instanceof Si)return $n;if(t instanceof bl)return xn;if(t instanceof fn)return Pa;if(t instanceof Tn)return Do;if(Array.isArray(t)){const e=t.length;let F;for(const K of t){const J=wi(K);if(F){if(F===J)continue;F=Dr;break}F=J}return En(F||Dr,e)}return Dn}function ka(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Si||t instanceof fn||t instanceof Tn?t.toString():JSON.stringify(t)}class El{constructor(e,F){this.type=e,this.value=F}static parse(e,F){if(e.length!==2)return F.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ba(e[1]))return F.error("invalid value");const K=e[1];let J=wi(K);const ee=F.expectedType;return J.kind!=="array"||J.N!==0||!ee||ee.kind!=="array"||typeof ee.N=="number"&&ee.N!==0||(J=ee),new El(J,K)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Si?["rgba"].concat(this.value.toArray()):this.value instanceof fn?this.value.serialize():this.value}}var Lo=El,Ki=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Tl={string:Br,number:Qt,boolean:Mr,object:Dn};class Sl{constructor(e,F){this.type=e,this.args=F}static parse(e,F){if(e.length<2)return F.error("Expected at least one argument.");let K,J=1;const ee=e[0];if(ee==="array"){let oe,le;if(e.length>2){const ce=e[1];if(typeof ce!="string"||!(ce in Tl)||ce==="object")return F.error('The item type argument of "array" must be one of string, number, boolean',1);oe=Tl[ce],J++}else oe=Dr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return F.error('The length argument to "array" must be a positive integer literal',2);le=e[2],J++}K=En(oe,le)}else K=Tl[ee];const ie=[];for(;J<e.length;J++){const oe=F.parse(e[J],J,Dr);if(!oe)return null;ie.push(oe)}return new Sl(K,ie)}evaluate(e){for(let F=0;F<this.args.length;F++){const K=this.args[F].evaluate(e);if(!io(this.type,wi(K)))return K;if(F===this.args.length-1)throw new Ki(`Expected value to be of type ${yi(this.type)}, but found ${yi(wi(K))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,F=[e.kind];if(e.kind==="array"){const K=e.itemType;if(K.kind==="string"||K.kind==="number"||K.kind==="boolean"){F.push(K.kind);const J=e.N;(typeof J=="number"||this.args.length>1)&&F.push(J)}}return F.concat(this.args.map(K=>K.serialize()))}}var no=Sl;class xo{constructor(e){this.type=Pa,this.sections=e}static parse(e,F){if(e.length<2)return F.error("Expected at least one argument.");const K=e[1];if(!Array.isArray(K)&&typeof K=="object")return F.error("First argument must be an image or text section.");const J=[];let ee=!1;for(let ie=1;ie<=e.length-1;++ie){const oe=e[ie];if(ee&&typeof oe=="object"&&!Array.isArray(oe)){ee=!1;let le=null;if(oe["font-scale"]&&(le=F.parse(oe["font-scale"],1,Qt),!le))return null;let ce=null;if(oe["text-font"]&&(ce=F.parse(oe["text-font"],1,En(Br)),!ce))return null;let pe=null;if(oe["text-color"]&&(pe=F.parse(oe["text-color"],1,$n),!pe))return null;const me=J[J.length-1];me.scale=le,me.font=ce,me.textColor=pe}else{const le=F.parse(e[ie],1,Dr);if(!le)return null;const ce=le.type.kind;if(ce!=="string"&&ce!=="value"&&ce!=="null"&&ce!=="resolvedImage")return F.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");ee=!0,J.push({content:le,scale:null,font:null,textColor:null})}}return new xo(J)}evaluate(e){return new fn(this.sections.map(F=>{const K=F.content.evaluate(e);return wi(K)===Do?new wl("",K,null,null,null):new wl(ka(K),null,F.scale?F.scale.evaluate(e):null,F.font?F.font.evaluate(e).join(","):null,F.textColor?F.textColor.evaluate(e):null)}))}eachChild(e){for(const F of this.sections)e(F.content),F.scale&&e(F.scale),F.font&&e(F.font),F.textColor&&e(F.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const F of this.sections){e.push(F.content.serialize());const K={};F.scale&&(K["font-scale"]=F.scale.serialize()),F.font&&(K["text-font"]=F.font.serialize()),F.textColor&&(K["text-color"]=F.textColor.serialize()),e.push(K)}return e}}class xs{constructor(e){this.type=Do,this.input=e}static parse(e,F){if(e.length!==2)return F.error("Expected two arguments.");const K=F.parse(e[1],1,Br);return K?new xs(K):F.error("No image name provided.")}evaluate(e){const F=this.input.evaluate(e),K=Tn.fromString(F);return K&&e.availableImages&&(K.available=e.availableImages.indexOf(F)>-1),K}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const vh={"to-boolean":Mr,"to-color":$n,"to-number":Qt,"to-string":Br};class Il{constructor(e,F){this.type=e,this.args=F}static parse(e,F){if(e.length<2)return F.error("Expected at least one argument.");const K=e[0];if((K==="to-boolean"||K==="to-string")&&e.length!==2)return F.error("Expected one argument.");const J=vh[K],ee=[];for(let ie=1;ie<e.length;ie++){const oe=F.parse(e[ie],ie,Dr);if(!oe)return null;ee.push(oe)}return new Il(J,ee)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let F,K;for(const J of this.args){if(F=J.evaluate(e),K=null,F instanceof Si)return F;if(typeof F=="string"){const ee=e.parseColor(F);if(ee)return ee}else if(Array.isArray(F)&&(K=F.length<3||F.length>4?`Invalid rbga value ${JSON.stringify(F)}: expected an array containing either three or four numeric values.`:Jc(F[0],F[1],F[2],F[3]),!K))return new Si(F[0]/255,F[1]/255,F[2]/255,F[3])}throw new Ki(K||`Could not parse color from value '${typeof F=="string"?F:String(JSON.stringify(F))}'`)}if(this.type.kind==="number"){let F=null;for(const K of this.args){if(F=K.evaluate(e),F===null)return 0;const J=Number(F);if(!isNaN(J))return J}throw new Ki(`Could not convert ${JSON.stringify(F)} to number.`)}return this.type.kind==="formatted"?fn.fromString(ka(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Tn.fromString(ka(this.args[0].evaluate(e))):ka(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new xo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new xs(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(F=>{e.push(F.serialize())}),e}}var ra=Il;const Wn=["Unknown","Point","LineString","Polygon"];var Al=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Wn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:F,y:K}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(F*e-t[0])+this.featureDistanceData.bearing[1]*(K*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Si.parse(t)),e}};class Bo{constructor(e,F,K,J){this.name=e,this.type=F,this._evaluate=K,this.args=J}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,F){const K=e[0],J=Bo.definitions[K];if(!J)return F.error(`Unknown expression "${K}". If you wanted a literal array, use ["literal", [...]].`,0);const ee=Array.isArray(J)?J[0]:J.type,ie=Array.isArray(J)?[[J[1],J[2]]]:J.overloads,oe=ie.filter(([ce])=>!Array.isArray(ce)||ce.length===e.length-1);let le=null;for(const[ce,pe]of oe){le=new Dl(F.registry,F.path,null,F.scope);const me=[];let _e=!1;for(let xe=1;xe<e.length;xe++){const we=e[xe],Ae=Array.isArray(ce)?ce[xe-1]:ce.type,Re=le.parse(we,1+me.length,Ae);if(!Re){_e=!0;break}me.push(Re)}if(!_e)if(Array.isArray(ce)&&ce.length!==me.length)le.error(`Expected ${ce.length} arguments, but found ${me.length} instead.`);else{for(let xe=0;xe<me.length;xe++){const we=Array.isArray(ce)?ce[xe]:ce.type,Ae=me[xe];le.concat(xe+1).checkSubtype(we,Ae.type)}if(le.errors.length===0)return new Bo(K,ee,pe,me)}}if(oe.length===1)F.errors.push(...le.errors);else{const ce=(oe.length?oe:ie).map(([me])=>{return _e=me,Array.isArray(_e)?`(${_e.map(yi).join(", ")})`:`(${yi(_e.type)}...)`;var _e}).join(" | "),pe=[];for(let me=1;me<e.length;me++){const _e=F.parse(e[me],1+pe.length);if(!_e)return null;pe.push(yi(_e.type))}F.error(`Expected arguments of type ${ce}, but found (${pe.join(", ")}) instead.`)}return null}static register(e,F){Bo.definitions=F;for(const K in F)e[K]=Bo}}var oo=Bo;class Na{constructor(e,F,K){this.type=xn,this.locale=K,this.caseSensitive=e,this.diacriticSensitive=F}static parse(e,F){if(e.length!==2)return F.error("Expected one argument.");const K=e[1];if(typeof K!="object"||Array.isArray(K))return F.error("Collator options argument must be an object.");const J=F.parse(K["case-sensitive"]!==void 0&&K["case-sensitive"],1,Mr);if(!J)return null;const ee=F.parse(K["diacritic-sensitive"]!==void 0&&K["diacritic-sensitive"],1,Mr);if(!ee)return null;let ie=null;return K.locale&&(ie=F.parse(K.locale,1,Br),!ie)?null:new Na(J,ee,ie)}evaluate(e){return new bl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ao=8192;function bs(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ia(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Fa(t,e){const F=(180+t[0])/360,K=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,J=Math.pow(2,e.z);return[Math.round(F*J*ao),Math.round(K*J*ao)]}function Qc(t,e,F){const K=t[0]-e[0],J=t[1]-e[1],ee=t[0]-F[0],ie=t[1]-F[1];return K*ie-ee*J==0&&K*ee<=0&&J*ie<=0}function ws(t,e){let F=!1;for(let ie=0,oe=e.length;ie<oe;ie++){const le=e[ie];for(let ce=0,pe=le.length;ce<pe-1;ce++){if(Qc(t,le[ce],le[ce+1]))return!1;(J=le[ce])[1]>(K=t)[1]!=(ee=le[ce+1])[1]>K[1]&&K[0]<(ee[0]-J[0])*(K[1]-J[1])/(ee[1]-J[1])+J[0]&&(F=!F)}}var K,J,ee;return F}function Ol(t,e){for(let F=0;F<e.length;F++)if(ws(t,e[F]))return!0;return!1}function Cl(t,e,F,K){const J=K[0]-F[0],ee=K[1]-F[1],ie=(t[0]-F[0])*ee-J*(t[1]-F[1]),oe=(e[0]-F[0])*ee-J*(e[1]-F[1]);return ie>0&&oe<0||ie<0&&oe>0}function na(t,e,F){for(const ce of F)for(let pe=0;pe<ce.length-1;++pe)if((oe=[(ie=ce[pe+1])[0]-(ee=ce[pe])[0],ie[1]-ee[1]])[0]*(le=[(J=e)[0]-(K=t)[0],J[1]-K[1]])[1]-oe[1]*le[0]!=0&&Cl(K,J,ee,ie)&&Cl(ee,ie,K,J))return!0;var K,J,ee,ie,oe,le;return!1}function Hr(t,e){for(let F=0;F<t.length;++F)if(!ws(t[F],e))return!1;for(let F=0;F<t.length-1;++F)if(na(t[F],t[F+1],e))return!1;return!0}function $h(t,e){for(let F=0;F<e.length;F++)if(Hr(t,e[F]))return!0;return!1}function Pl(t,e,F){const K=[];for(let J=0;J<t.length;J++){const ee=[];for(let ie=0;ie<t[J].length;ie++){const oe=Fa(t[J][ie],F);bs(e,oe),ee.push(oe)}K.push(ee)}return K}function eu(t,e,F){const K=[];for(let J=0;J<t.length;J++){const ee=Pl(t[J],e,F);K.push(ee)}return K}function Rl(t,e,F,K){if(t[0]<F[0]||t[0]>F[2]){const J=.5*K;let ee=t[0]-F[0]>J?-K:F[0]-t[0]>J?K:0;ee===0&&(ee=t[0]-F[2]>J?-K:F[2]-t[0]>J?K:0),t[0]+=ee}bs(e,t)}function tu(t,e,F,K){const J=Math.pow(2,K.z)*ao,ee=[K.x*ao,K.y*ao],ie=[];if(!t)return ie;for(const oe of t)for(const le of oe){const ce=[le.x+ee[0],le.y+ee[1]];Rl(ce,e,F,J),ie.push(ce)}return ie}function Ml(t,e,F,K){const J=Math.pow(2,K.z)*ao,ee=[K.x*ao,K.y*ao],ie=[];if(!t)return ie;for(const le of t){const ce=[];for(const pe of le){const me=[pe.x+ee[0],pe.y+ee[1]];bs(e,me),ce.push(me)}ie.push(ce)}if(e[2]-e[0]<=J/2){(oe=e)[0]=oe[1]=1/0,oe[2]=oe[3]=-1/0;for(const le of ie)for(const ce of le)Rl(ce,e,F,J)}var oe;return ie}class oa{constructor(e,F){this.type=Mr,this.geojson=e,this.geometries=F}static parse(e,F){if(e.length!==2)return F.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ba(e[1])){const K=e[1];if(K.type==="FeatureCollection")for(let J=0;J<K.features.length;++J){const ee=K.features[J].geometry.type;if(ee==="Polygon"||ee==="MultiPolygon")return new oa(K,K.features[J].geometry)}else if(K.type==="Feature"){const J=K.geometry.type;if(J==="Polygon"||J==="MultiPolygon")return new oa(K,K.geometry)}else if(K.type==="Polygon"||K.type==="MultiPolygon")return new oa(K,K)}return F.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(F,K){const J=[1/0,1/0,-1/0,-1/0],ee=[1/0,1/0,-1/0,-1/0],ie=F.canonicalID();if(!ie)return!1;if(K.type==="Polygon"){const oe=Pl(K.coordinates,ee,ie),le=tu(F.geometry(),J,ee,ie);if(!ia(J,ee))return!1;for(const ce of le)if(!ws(ce,oe))return!1}if(K.type==="MultiPolygon"){const oe=eu(K.coordinates,ee,ie),le=tu(F.geometry(),J,ee,ie);if(!ia(J,ee))return!1;for(const ce of le)if(!Ol(ce,oe))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(F,K){const J=[1/0,1/0,-1/0,-1/0],ee=[1/0,1/0,-1/0,-1/0],ie=F.canonicalID();if(!ie)return!1;if(K.type==="Polygon"){const oe=Pl(K.coordinates,ee,ie),le=Ml(F.geometry(),J,ee,ie);if(!ia(J,ee))return!1;for(const ce of le)if(!Hr(ce,oe))return!1}if(K.type==="MultiPolygon"){const oe=eu(K.coordinates,ee,ie),le=Ml(F.geometry(),J,ee,ie);if(!ia(J,ee))return!1;for(const ce of le)if(!$h(ce,oe))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Es=oa;function aa(t){if(t instanceof oo&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Es)return!1;let e=!0;return t.eachChild(F=>{e&&!aa(F)&&(e=!1)}),e}function so(t){if(t instanceof oo&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(F=>{e&&!so(F)&&(e=!1)}),e}function ko(t,e){if(t instanceof oo&&e.indexOf(t.name)>=0)return!1;let F=!0;return t.eachChild(K=>{F&&!ko(K,e)&&(F=!1)}),F}class Ts{constructor(e,F){this.type=F.type,this.name=e,this.boundExpression=F}static parse(e,F){if(e.length!==2||typeof e[1]!="string")return F.error("'var' expression requires exactly one string literal argument.");const K=e[1];return F.scope.has(K)?new Ts(K,F.scope.get(K)):F.error(`Unknown variable "${K}". Make sure "${K}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ru=Ts;class za{constructor(e,F=[],K,J=new Zc,ee=[]){this.registry=e,this.path=F,this.key=F.map(ie=>`[${ie}]`).join(""),this.scope=J,this.errors=ee,this.expectedType=K}parse(e,F,K,J,ee={}){return F?this.concat(F,K,J)._parse(e,ee):this._parse(e,ee)}_parse(e,F){function K(J,ee,ie){return ie==="assert"?new no(ee,[J]):ie==="coerce"?new ra(ee,[J]):J}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const J=e[0];if(typeof J!="string")return this.error(`Expression name must be a string, but found ${typeof J} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const ee=this.registry[J];if(ee){let ie=ee.parse(e,this);if(!ie)return null;if(this.expectedType){const oe=this.expectedType,le=ie.type;if(oe.kind!=="string"&&oe.kind!=="number"&&oe.kind!=="boolean"&&oe.kind!=="object"&&oe.kind!=="array"||le.kind!=="value")if(oe.kind!=="color"&&oe.kind!=="formatted"&&oe.kind!=="resolvedImage"||le.kind!=="value"&&le.kind!=="string"){if(this.checkSubtype(oe,le))return null}else ie=K(ie,oe,F.typeAnnotation||"coerce");else ie=K(ie,oe,F.typeAnnotation||"assert")}if(!(ie instanceof Lo)&&ie.type.kind!=="resolvedImage"&&Ll(ie)){const oe=new Al;try{ie=new Lo(ie.type,ie.evaluate(oe))}catch(le){return this.error(le.message),null}}return ie}return this.error(`Unknown expression "${J}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,F,K){const J=typeof e=="number"?this.path.concat(e):this.path,ee=K?this.scope.concat(K):this.scope;return new za(this.registry,J,F||null,ee,this.errors)}error(e,...F){const K=`${this.key}${F.map(J=>`[${J}]`).join("")}`;this.errors.push(new Gn(K,e))}checkSubtype(e,F){const K=io(e,F);return K&&this.error(K),K}}var Dl=za;function Ll(t){if(t instanceof ru)return Ll(t.boundExpression);if(t instanceof oo&&t.name==="error"||t instanceof Na||t instanceof Es)return!1;const e=t instanceof ra||t instanceof no;let F=!0;return t.eachChild(K=>{F=e?F&&Ll(K):F&&K instanceof Lo}),!!F&&aa(t)&&ko(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ss(t,e){const F=t.length-1;let K,J,ee=0,ie=F,oe=0;for(;ee<=ie;)if(oe=Math.floor((ee+ie)/2),K=t[oe],J=t[oe+1],K<=e){if(oe===F||e<J)return oe;ee=oe+1}else{if(!(K>e))throw new Ki("Input is not a number.");ie=oe-1}return 0}class Is{constructor(e,F,K){this.type=e,this.input=F,this.labels=[],this.outputs=[];for(const[J,ee]of K)this.labels.push(J),this.outputs.push(ee)}static parse(e,F){if(e.length-1<4)return F.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return F.error("Expected an even number of arguments.");const K=F.parse(e[1],1,Qt);if(!K)return null;const J=[];let ee=null;F.expectedType&&F.expectedType.kind!=="value"&&(ee=F.expectedType);for(let ie=1;ie<e.length;ie+=2){const oe=ie===1?-1/0:e[ie],le=e[ie+1],ce=ie,pe=ie+1;if(typeof oe!="number")return F.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ce);if(J.length&&J[J.length-1][0]>=oe)return F.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ce);const me=F.parse(le,pe,ee);if(!me)return null;ee=ee||me.type,J.push([oe,me])}return new Is(ee,K,J)}evaluate(e){const F=this.labels,K=this.outputs;if(F.length===1)return K[0].evaluate(e);const J=this.input.evaluate(e);if(J<=F[0])return K[0].evaluate(e);const ee=F.length;return J>=F[ee-1]?K[ee-1].evaluate(e):K[Ss(F,J)].evaluate(e)}eachChild(e){e(this.input);for(const F of this.outputs)e(F)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let F=0;F<this.labels.length;F++)F>0&&e.push(this.labels[F]),e.push(this.outputs[F].serialize());return e}}var Bl=Is;function zr(t,e,F){return t*(1-F)+e*F}var Ua=Object.freeze({__proto__:null,array:function(t,e,F){return t.map((K,J)=>zr(K,e[J],F))},color:function(t,e,F){return new Si(zr(t.r,e.r,F),zr(t.g,e.g,F),zr(t.b,e.b,F),zr(t.a,e.a,F))},number:zr});const iu=.95047,kl=1.08883,nu=4/29,No=6/29,Nl=3*No*No,xh=No*No*No,bh=Math.PI/180,wh=180/Math.PI;function Fl(t){return t>xh?Math.pow(t,1/3):t/Nl+nu}function zl(t){return t>No?t*t*t:Nl*(t-nu)}function Ul(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function As(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ou(t){const e=As(t.r),F=As(t.g),K=As(t.b),J=Fl((.4124564*e+.3575761*F+.1804375*K)/iu),ee=Fl((.2126729*e+.7151522*F+.072175*K)/1);return{l:116*ee-16,a:500*(J-ee),b:200*(ee-Fl((.0193339*e+.119192*F+.9503041*K)/kl)),alpha:t.a}}function au(t){let e=(t.l+16)/116,F=isNaN(t.a)?e:e+t.a/500,K=isNaN(t.b)?e:e-t.b/200;return e=1*zl(e),F=iu*zl(F),K=kl*zl(K),new Si(Ul(3.2404542*F-1.5371385*e-.4985314*K),Ul(-.969266*F+1.8760108*e+.041556*K),Ul(.0556434*F-.2040259*e+1.0572252*K),t.alpha)}function Eh(t,e,F){const K=e-t;return t+F*(K>180||K<-180?K-360*Math.round(K/360):K)}const ja={forward:ou,reverse:au,interpolate:function(t,e,F){return{l:zr(t.l,e.l,F),a:zr(t.a,e.a,F),b:zr(t.b,e.b,F),alpha:zr(t.alpha,e.alpha,F)}}},sa={forward:function(t){const{l:e,a:F,b:K}=ou(t),J=Math.atan2(K,F)*wh;return{h:J<0?J+360:J,c:Math.sqrt(F*F+K*K),l:e,alpha:t.a}},reverse:function(t){const e=t.h*bh,F=t.c;return au({l:t.l,a:Math.cos(e)*F,b:Math.sin(e)*F,alpha:t.alpha})},interpolate:function(t,e,F){return{h:Eh(t.h,e.h,F),c:zr(t.c,e.c,F),l:zr(t.l,e.l,F),alpha:zr(t.alpha,e.alpha,F)}}};var jl=Object.freeze({__proto__:null,hcl:sa,lab:ja});class Va{constructor(e,F,K,J,ee){this.type=e,this.operator=F,this.interpolation=K,this.input=J,this.labels=[],this.outputs=[];for(const[ie,oe]of ee)this.labels.push(ie),this.outputs.push(oe)}static interpolationFactor(e,F,K,J){let ee=0;if(e.name==="exponential")ee=Vl(F,e.base,K,J);else if(e.name==="linear")ee=Vl(F,1,K,J);else if(e.name==="cubic-bezier"){const ie=e.controlPoints;ee=new Ir(ie[0],ie[1],ie[2],ie[3]).solve(Vl(F,1,K,J))}return ee}static parse(e,F){let[K,J,ee,...ie]=e;if(!Array.isArray(J)||J.length===0)return F.error("Expected an interpolation type expression.",1);if(J[0]==="linear")J={name:"linear"};else if(J[0]==="exponential"){const ce=J[1];if(typeof ce!="number")return F.error("Exponential interpolation requires a numeric base.",1,1);J={name:"exponential",base:ce}}else{if(J[0]!=="cubic-bezier")return F.error(`Unknown interpolation type ${String(J[0])}`,1,0);{const ce=J.slice(1);if(ce.length!==4||ce.some(pe=>typeof pe!="number"||pe<0||pe>1))return F.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);J={name:"cubic-bezier",controlPoints:ce}}}if(e.length-1<4)return F.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return F.error("Expected an even number of arguments.");if(ee=F.parse(ee,2,Qt),!ee)return null;const oe=[];let le=null;K==="interpolate-hcl"||K==="interpolate-lab"?le=$n:F.expectedType&&F.expectedType.kind!=="value"&&(le=F.expectedType);for(let ce=0;ce<ie.length;ce+=2){const pe=ie[ce],me=ie[ce+1],_e=ce+3,xe=ce+4;if(typeof pe!="number")return F.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_e);if(oe.length&&oe[oe.length-1][0]>=pe)return F.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',_e);const we=F.parse(me,xe,le);if(!we)return null;le=le||we.type,oe.push([pe,we])}return le.kind==="number"||le.kind==="color"||le.kind==="array"&&le.itemType.kind==="number"&&typeof le.N=="number"?new Va(le,K,J,ee,oe):F.error(`Type ${yi(le)} is not interpolatable.`)}evaluate(e){const F=this.labels,K=this.outputs;if(F.length===1)return K[0].evaluate(e);const J=this.input.evaluate(e);if(J<=F[0])return K[0].evaluate(e);const ee=F.length;if(J>=F[ee-1])return K[ee-1].evaluate(e);const ie=Ss(F,J),oe=Va.interpolationFactor(this.interpolation,J,F[ie],F[ie+1]),le=K[ie].evaluate(e),ce=K[ie+1].evaluate(e);return this.operator==="interpolate"?Ua[this.type.kind.toLowerCase()](le,ce,oe):this.operator==="interpolate-hcl"?sa.reverse(sa.interpolate(sa.forward(le),sa.forward(ce),oe)):ja.reverse(ja.interpolate(ja.forward(le),ja.forward(ce),oe))}eachChild(e){e(this.input);for(const F of this.outputs)e(F)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const F=[this.operator,e,this.input.serialize()];for(let K=0;K<this.labels.length;K++)F.push(this.labels[K],this.outputs[K].serialize());return F}}function Vl(t,e,F,K){const J=K-F,ee=t-F;return J===0?0:e===1?ee/J:(Math.pow(e,ee)-1)/(Math.pow(e,J)-1)}var qn=Va;class Os{constructor(e,F){this.type=e,this.args=F}static parse(e,F){if(e.length<2)return F.error("Expectected at least one argument.");let K=null;const J=F.expectedType;J&&J.kind!=="value"&&(K=J);const ee=[];for(const oe of e.slice(1)){const le=F.parse(oe,1+ee.length,K,void 0,{typeAnnotation:"omit"});if(!le)return null;K=K||le.type,ee.push(le)}const ie=J&&ee.some(oe=>io(J,oe.type));return new Os(ie?Dr:K,ee)}evaluate(e){let F,K=null,J=0;for(const ee of this.args){if(J++,K=ee.evaluate(e),K&&K instanceof Tn&&!K.available&&(F||(F=K),K=null,J===this.args.length))return F;if(K!==null)break}return K}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(F=>{e.push(F.serialize())}),e}}var Gl=Os;class Cs{constructor(e,F){this.type=F.type,this.bindings=[].concat(e),this.result=F}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const F of this.bindings)e(F[1]);e(this.result)}static parse(e,F){if(e.length<4)return F.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const K=[];for(let ee=1;ee<e.length-1;ee+=2){const ie=e[ee];if(typeof ie!="string")return F.error(`Expected string, but found ${typeof ie} instead.`,ee);if(/[^a-zA-Z0-9_]/.test(ie))return F.error("Variable names must contain only alphanumeric characters or '_'.",ee);const oe=F.parse(e[ee+1],ee+1);if(!oe)return null;K.push([ie,oe])}const J=F.parse(e[e.length-1],e.length-1,F.expectedType,K);return J?new Cs(K,J):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[F,K]of this.bindings)e.push(F,K.serialize());return e.push(this.result.serialize()),e}}var su=Cs;class Wl{constructor(e,F,K){this.type=e,this.index=F,this.input=K}static parse(e,F){if(e.length!==3)return F.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const K=F.parse(e[1],1,Qt),J=F.parse(e[2],2,En(F.expectedType||Dr));return K&&J?new Wl(J.type.itemType,K,J):null}evaluate(e){const F=this.index.evaluate(e),K=this.input.evaluate(e);if(F<0)throw new Ki(`Array index out of bounds: ${F} < 0.`);if(F>=K.length)throw new Ki(`Array index out of bounds: ${F} > ${K.length-1}.`);if(F!==Math.floor(F))throw new Ki(`Array index must be an integer, but found ${F} instead.`);return K[F]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Th=Wl;class ql{constructor(e,F){this.type=Mr,this.needle=e,this.haystack=F}static parse(e,F){if(e.length!==3)return F.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const K=F.parse(e[1],1,Dr),J=F.parse(e[2],2,Dr);return K&&J?Ra(K.type,[Mr,Br,Qt,ea,Dr])?new ql(K,J):F.error(`Expected first argument to be of type boolean, string, number or null, but found ${yi(K.type)} instead`):null}evaluate(e){const F=this.needle.evaluate(e),K=this.haystack.evaluate(e);if(K==null)return!1;if(!Ma(F,["boolean","string","number","null"]))throw new Ki(`Expected first argument to be of type boolean, string, number or null, but found ${yi(wi(F))} instead.`);if(!Ma(K,["string","array"]))throw new Ki(`Expected second argument to be of type array or string, but found ${yi(wi(K))} instead.`);return K.indexOf(F)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ps=ql;class Ga{constructor(e,F,K){this.type=Qt,this.needle=e,this.haystack=F,this.fromIndex=K}static parse(e,F){if(e.length<=2||e.length>=5)return F.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const K=F.parse(e[1],1,Dr),J=F.parse(e[2],2,Dr);if(!K||!J)return null;if(!Ra(K.type,[Mr,Br,Qt,ea,Dr]))return F.error(`Expected first argument to be of type boolean, string, number or null, but found ${yi(K.type)} instead`);if(e.length===4){const ee=F.parse(e[3],3,Qt);return ee?new Ga(K,J,ee):null}return new Ga(K,J)}evaluate(e){const F=this.needle.evaluate(e),K=this.haystack.evaluate(e);if(!Ma(F,["boolean","string","number","null"]))throw new Ki(`Expected first argument to be of type boolean, string, number or null, but found ${yi(wi(F))} instead.`);if(!Ma(K,["string","array"]))throw new Ki(`Expected second argument to be of type array or string, but found ${yi(wi(K))} instead.`);if(this.fromIndex){const J=this.fromIndex.evaluate(e);return K.indexOf(F,J)}return K.indexOf(F)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var lu=Ga;class Hl{constructor(e,F,K,J,ee,ie){this.inputType=e,this.type=F,this.input=K,this.cases=J,this.outputs=ee,this.otherwise=ie}static parse(e,F){if(e.length<5)return F.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return F.error("Expected an even number of arguments.");let K,J;F.expectedType&&F.expectedType.kind!=="value"&&(J=F.expectedType);const ee={},ie=[];for(let ce=2;ce<e.length-1;ce+=2){let pe=e[ce];const me=e[ce+1];Array.isArray(pe)||(pe=[pe]);const _e=F.concat(ce);if(pe.length===0)return _e.error("Expected at least one branch label.");for(const we of pe){if(typeof we!="number"&&typeof we!="string")return _e.error("Branch labels must be numbers or strings.");if(typeof we=="number"&&Math.abs(we)>Number.MAX_SAFE_INTEGER)return _e.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof we=="number"&&Math.floor(we)!==we)return _e.error("Numeric branch labels must be integer values.");if(K){if(_e.checkSubtype(K,wi(we)))return null}else K=wi(we);if(ee[String(we)]!==void 0)return _e.error("Branch labels must be unique.");ee[String(we)]=ie.length}const xe=F.parse(me,ce,J);if(!xe)return null;J=J||xe.type,ie.push(xe)}const oe=F.parse(e[1],1,Dr);if(!oe)return null;const le=F.parse(e[e.length-1],e.length-1,J);return le?oe.type.kind!=="value"&&F.concat(1).checkSubtype(K,oe.type)?null:new Hl(K,J,oe,ee,ie,le):null}evaluate(e){const F=this.input.evaluate(e);return(wi(F)===this.inputType&&this.outputs[this.cases[F]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],F=Object.keys(this.cases).sort(),K=[],J={};for(const ie of F){const oe=J[this.cases[ie]];oe===void 0?(J[this.cases[ie]]=K.length,K.push([this.cases[ie],[ie]])):K[oe][1].push(ie)}const ee=ie=>this.inputType.kind==="number"?Number(ie):ie;for(const[ie,oe]of K)e.push(oe.length===1?ee(oe[0]):oe.map(ee)),e.push(this.outputs[ie].serialize());return e.push(this.otherwise.serialize()),e}}var Sh=Hl;class Kl{constructor(e,F,K){this.type=e,this.branches=F,this.otherwise=K}static parse(e,F){if(e.length<4)return F.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return F.error("Expected an odd number of arguments.");let K;F.expectedType&&F.expectedType.kind!=="value"&&(K=F.expectedType);const J=[];for(let ie=1;ie<e.length-1;ie+=2){const oe=F.parse(e[ie],ie,Mr);if(!oe)return null;const le=F.parse(e[ie+1],ie+1,K);if(!le)return null;J.push([oe,le]),K=K||le.type}const ee=F.parse(e[e.length-1],e.length-1,K);return ee?new Kl(K,J,ee):null}evaluate(e){for(const[F,K]of this.branches)if(F.evaluate(e))return K.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[F,K]of this.branches)e(F),e(K);e(this.otherwise)}outputDefined(){return this.branches.every(([e,F])=>F.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(F=>{e.push(F.serialize())}),e}}var cu=Kl;class Wa{constructor(e,F,K,J){this.type=e,this.input=F,this.beginIndex=K,this.endIndex=J}static parse(e,F){if(e.length<=2||e.length>=5)return F.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const K=F.parse(e[1],1,Dr),J=F.parse(e[2],2,Qt);if(!K||!J)return null;if(!Ra(K.type,[En(Dr),Br,Dr]))return F.error(`Expected first argument to be of type array or string, but found ${yi(K.type)} instead`);if(e.length===4){const ee=F.parse(e[3],3,Qt);return ee?new Wa(K.type,K,J,ee):null}return new Wa(K.type,K,J)}evaluate(e){const F=this.input.evaluate(e),K=this.beginIndex.evaluate(e);if(!Ma(F,["string","array"]))throw new Ki(`Expected first argument to be of type array or string, but found ${yi(wi(F))} instead.`);if(this.endIndex){const J=this.endIndex.evaluate(e);return F.slice(K,J)}return F.slice(K)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var uu=Wa;function Rs(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function hu(t,e,F,K){return K.compare(e,F)===0}function la(t,e,F){const K=t!=="=="&&t!=="!=";return class Cm{constructor(ee,ie,oe){this.type=Mr,this.lhs=ee,this.rhs=ie,this.collator=oe,this.hasUntypedArgument=ee.type.kind==="value"||ie.type.kind==="value"}static parse(ee,ie){if(ee.length!==3&&ee.length!==4)return ie.error("Expected two or three arguments.");const oe=ee[0];let le=ie.parse(ee[1],1,Dr);if(!le)return null;if(!Rs(oe,le.type))return ie.concat(1).error(`"${oe}" comparisons are not supported for type '${yi(le.type)}'.`);let ce=ie.parse(ee[2],2,Dr);if(!ce)return null;if(!Rs(oe,ce.type))return ie.concat(2).error(`"${oe}" comparisons are not supported for type '${yi(ce.type)}'.`);if(le.type.kind!==ce.type.kind&&le.type.kind!=="value"&&ce.type.kind!=="value")return ie.error(`Cannot compare types '${yi(le.type)}' and '${yi(ce.type)}'.`);K&&(le.type.kind==="value"&&ce.type.kind!=="value"?le=new no(ce.type,[le]):le.type.kind!=="value"&&ce.type.kind==="value"&&(ce=new no(le.type,[ce])));let pe=null;if(ee.length===4){if(le.type.kind!=="string"&&ce.type.kind!=="string"&&le.type.kind!=="value"&&ce.type.kind!=="value")return ie.error("Cannot use collator to compare non-string types.");if(pe=ie.parse(ee[3],3,xn),!pe)return null}return new Cm(le,ce,pe)}evaluate(ee){const ie=this.lhs.evaluate(ee),oe=this.rhs.evaluate(ee);if(K&&this.hasUntypedArgument){const le=wi(ie),ce=wi(oe);if(le.kind!==ce.kind||le.kind!=="string"&&le.kind!=="number")throw new Ki(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${le.kind}, ${ce.kind}) instead.`)}if(this.collator&&!K&&this.hasUntypedArgument){const le=wi(ie),ce=wi(oe);if(le.kind!=="string"||ce.kind!=="string")return e(ee,ie,oe)}return this.collator?F(ee,ie,oe,this.collator.evaluate(ee)):e(ee,ie,oe)}eachChild(ee){ee(this.lhs),ee(this.rhs),this.collator&&ee(this.collator)}outputDefined(){return!0}serialize(){const ee=[t];return this.eachChild(ie=>{ee.push(ie.serialize())}),ee}}}const Ih=la("==",function(t,e,F){return e===F},hu),Ah=la("!=",function(t,e,F){return e!==F},function(t,e,F,K){return!hu(0,e,F,K)}),Oh=la("<",function(t,e,F){return e<F},function(t,e,F,K){return K.compare(e,F)<0}),Ch=la(">",function(t,e,F){return e>F},function(t,e,F,K){return K.compare(e,F)>0}),Ph=la("<=",function(t,e,F){return e<=F},function(t,e,F,K){return K.compare(e,F)<=0}),fu=la(">=",function(t,e,F){return e>=F},function(t,e,F,K){return K.compare(e,F)>=0});class Ms{constructor(e,F,K,J,ee,ie){this.type=Br,this.number=e,this.locale=F,this.currency=K,this.unit=J,this.minFractionDigits=ee,this.maxFractionDigits=ie}static parse(e,F){if(e.length!==3)return F.error("Expected two arguments.");const K=F.parse(e[1],1,Qt);if(!K)return null;const J=e[2];if(typeof J!="object"||Array.isArray(J))return F.error("NumberFormat options argument must be an object.");let ee=null;if(J.locale&&(ee=F.parse(J.locale,1,Br),!ee))return null;let ie=null;if(J.currency&&(ie=F.parse(J.currency,1,Br),!ie))return null;let oe=null;if(J.unit&&(oe=F.parse(J.unit,1,Br),!oe))return null;let le=null;if(J["min-fraction-digits"]&&(le=F.parse(J["min-fraction-digits"],1,Qt),!le))return null;let ce=null;return J["max-fraction-digits"]&&(ce=F.parse(J["max-fraction-digits"],1,Qt),!ce)?null:new Ms(K,ee,ie,oe,le,ce)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ca{constructor(e){this.type=Qt,this.input=e}static parse(e,F){if(e.length!==2)return F.error(`Expected 1 argument, but found ${e.length-1} instead.`);const K=F.parse(e[1],1);return K?K.type.kind!=="array"&&K.type.kind!=="string"&&K.type.kind!=="value"?F.error(`Expected argument of type string or array, but found ${yi(K.type)} instead.`):new ca(K):null}evaluate(e){const F=this.input.evaluate(e);if(typeof F=="string"||Array.isArray(F))return F.length;throw new Ki(`Expected value to be of type string or array, but found ${yi(wi(F))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(F=>{e.push(F.serialize())}),e}}const pu={"==":Ih,"!=":Ah,">":Ch,"<":Oh,">=":fu,"<=":Ph,array:no,at:Th,boolean:no,case:cu,coalesce:Gl,collator:Na,format:xo,image:xs,in:Ps,"index-of":lu,interpolate:qn,"interpolate-hcl":qn,"interpolate-lab":qn,length:ca,let:su,literal:Lo,match:Sh,number:no,"number-format":Ms,object:no,slice:uu,step:Bl,string:no,"to-boolean":ra,"to-color":ra,"to-number":ra,"to-string":ra,var:ru,within:Es};function du(t,[e,F,K,J]){e=e.evaluate(t),F=F.evaluate(t),K=K.evaluate(t);const ee=J?J.evaluate(t):1,ie=Jc(e,F,K,ee);if(ie)throw new Ki(ie);return new Si(e/255*ee,F/255*ee,K/255*ee,ee)}function lo(t,e){return t in e}function Ds(t,e){const F=e[t];return F===void 0?null:F}function Sn(t){return{type:t}}oo.register(pu,{error:[{kind:"error"},[Br],(t,[e])=>{throw new Ki(e.evaluate(t))}],typeof:[Br,[Dr],(t,[e])=>yi(wi(e.evaluate(t)))],"to-rgba":[En(Qt,4),[$n],(t,[e])=>e.evaluate(t).toArray()],rgb:[$n,[Qt,Qt,Qt],du],rgba:[$n,[Qt,Qt,Qt,Qt],du],has:{type:Mr,overloads:[[[Br],(t,[e])=>lo(e.evaluate(t),t.properties())],[[Br,Dn],(t,[e,F])=>lo(e.evaluate(t),F.evaluate(t))]]},get:{type:Dr,overloads:[[[Br],(t,[e])=>Ds(e.evaluate(t),t.properties())],[[Br,Dn],(t,[e,F])=>Ds(e.evaluate(t),F.evaluate(t))]]},"feature-state":[Dr,[Br],(t,[e])=>Ds(e.evaluate(t),t.featureState||{})],properties:[Dn,[],t=>t.properties()],"geometry-type":[Br,[],t=>t.geometryType()],id:[Dr,[],t=>t.id()],zoom:[Qt,[],t=>t.globals.zoom],pitch:[Qt,[],t=>t.globals.pitch||0],"distance-from-center":[Qt,[],t=>t.distanceFromCenter()],"heatmap-density":[Qt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Qt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Qt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Dr,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Qt,Sn(Qt),(t,e)=>{let F=0;for(const K of e)F+=K.evaluate(t);return F}],"*":[Qt,Sn(Qt),(t,e)=>{let F=1;for(const K of e)F*=K.evaluate(t);return F}],"-":{type:Qt,overloads:[[[Qt,Qt],(t,[e,F])=>e.evaluate(t)-F.evaluate(t)],[[Qt],(t,[e])=>-e.evaluate(t)]]},"/":[Qt,[Qt,Qt],(t,[e,F])=>e.evaluate(t)/F.evaluate(t)],"%":[Qt,[Qt,Qt],(t,[e,F])=>e.evaluate(t)%F.evaluate(t)],ln2:[Qt,[],()=>Math.LN2],pi:[Qt,[],()=>Math.PI],e:[Qt,[],()=>Math.E],"^":[Qt,[Qt,Qt],(t,[e,F])=>Math.pow(e.evaluate(t),F.evaluate(t))],sqrt:[Qt,[Qt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Qt,[Qt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Qt,[Qt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Qt,[Qt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Qt,[Qt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Qt,[Qt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Qt,[Qt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Qt,[Qt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Qt,[Qt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Qt,[Qt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Qt,Sn(Qt),(t,e)=>Math.min(...e.map(F=>F.evaluate(t)))],max:[Qt,Sn(Qt),(t,e)=>Math.max(...e.map(F=>F.evaluate(t)))],abs:[Qt,[Qt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Qt,[Qt],(t,[e])=>{const F=e.evaluate(t);return F<0?-Math.round(-F):Math.round(F)}],floor:[Qt,[Qt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Qt,[Qt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Mr,[Br,Dr],(t,[e,F])=>t.properties()[e.value]===F.value],"filter-id-==":[Mr,[Dr],(t,[e])=>t.id()===e.value],"filter-type-==":[Mr,[Br],(t,[e])=>t.geometryType()===e.value],"filter-<":[Mr,[Br,Dr],(t,[e,F])=>{const K=t.properties()[e.value],J=F.value;return typeof K==typeof J&&K<J}],"filter-id-<":[Mr,[Dr],(t,[e])=>{const F=t.id(),K=e.value;return typeof F==typeof K&&F<K}],"filter->":[Mr,[Br,Dr],(t,[e,F])=>{const K=t.properties()[e.value],J=F.value;return typeof K==typeof J&&K>J}],"filter-id->":[Mr,[Dr],(t,[e])=>{const F=t.id(),K=e.value;return typeof F==typeof K&&F>K}],"filter-<=":[Mr,[Br,Dr],(t,[e,F])=>{const K=t.properties()[e.value],J=F.value;return typeof K==typeof J&&K<=J}],"filter-id-<=":[Mr,[Dr],(t,[e])=>{const F=t.id(),K=e.value;return typeof F==typeof K&&F<=K}],"filter->=":[Mr,[Br,Dr],(t,[e,F])=>{const K=t.properties()[e.value],J=F.value;return typeof K==typeof J&&K>=J}],"filter-id->=":[Mr,[Dr],(t,[e])=>{const F=t.id(),K=e.value;return typeof F==typeof K&&F>=K}],"filter-has":[Mr,[Dr],(t,[e])=>e.value in t.properties()],"filter-has-id":[Mr,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Mr,[En(Br)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Mr,[En(Dr)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Mr,[Br,En(Dr)],(t,[e,F])=>F.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Mr,[Br,En(Dr)],(t,[e,F])=>function(K,J,ee,ie){for(;ee<=ie;){const oe=ee+ie>>1;if(J[oe]===K)return!0;J[oe]>K?ie=oe-1:ee=oe+1}return!1}(t.properties()[e.value],F.value,0,F.value.length-1)],all:{type:Mr,overloads:[[[Mr,Mr],(t,[e,F])=>e.evaluate(t)&&F.evaluate(t)],[Sn(Mr),(t,e)=>{for(const F of e)if(!F.evaluate(t))return!1;return!0}]]},any:{type:Mr,overloads:[[[Mr,Mr],(t,[e,F])=>e.evaluate(t)||F.evaluate(t)],[Sn(Mr),(t,e)=>{for(const F of e)if(F.evaluate(t))return!0;return!1}]]},"!":[Mr,[Mr],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Mr,[Br],(t,[e])=>{const F=t.globals&&t.globals.isSupportedScript;return!F||F(e.evaluate(t))}],upcase:[Br,[Br],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Br,[Br],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Br,Sn(Dr),(t,e)=>e.map(F=>ka(F.evaluate(t))).join("")],"resolved-locale":[Br,[xn],(t,[e])=>e.evaluate(t).resolvedLocale()]});var qa=pu;function mu(t){return{result:"success",value:t}}function Fo(t){return{result:"error",value:t}}function ua(t){return t["property-type"]==="data-driven"}function Ls(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Bs(t){return!!t.expression&&t.expression.interpolated}function Ur(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Ha(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function yu(t){return t}function ks(t,e){const F=e.type==="color",K=t.stops&&typeof t.stops[0][0]=="object",J=K||!(K||t.property!==void 0),ee=t.type||(Bs(e)?"exponential":"interval");if(F&&((t=ro({},t)).stops&&(t.stops=t.stops.map(ce=>[ce[0],Si.parse(ce[1])])),t.default=Si.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!jl[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let ie,oe,le;if(ee==="exponential")ie=co;else if(ee==="interval")ie=Ns;else if(ee==="categorical"){ie=_u,oe=Object.create(null);for(const ce of t.stops)oe[ce[0]]=ce[1];le=typeof t.stops[0][0]}else{if(ee!=="identity")throw new Error(`Unknown function type "${ee}"`);ie=gu}if(K){const ce={},pe=[];for(let xe=0;xe<t.stops.length;xe++){const we=t.stops[xe],Ae=we[0].zoom;ce[Ae]===void 0&&(ce[Ae]={zoom:Ae,type:t.type,property:t.property,default:t.default,stops:[]},pe.push(Ae)),ce[Ae].stops.push([we[0].value,we[1]])}const me=[];for(const xe of pe)me.push([ce[xe].zoom,ks(ce[xe],e)]);const _e={name:"linear"};return{kind:"composite",interpolationType:_e,interpolationFactor:qn.interpolationFactor.bind(void 0,_e),zoomStops:me.map(xe=>xe[0]),evaluate:({zoom:xe},we)=>co({stops:me,base:t.base},e,xe).evaluate(xe,we)}}if(J){const ce=ee==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:ce,interpolationFactor:qn.interpolationFactor.bind(void 0,ce),zoomStops:t.stops.map(pe=>pe[0]),evaluate:({zoom:pe})=>ie(t,e,pe,oe,le)}}return{kind:"source",evaluate(ce,pe){const me=pe&&pe.properties?pe.properties[t.property]:void 0;return me===void 0?ha(t.default,e.default):ie(t,e,me,oe,le)}}}function ha(t,e,F){return t!==void 0?t:e!==void 0?e:F!==void 0?F:void 0}function _u(t,e,F,K,J){return ha(typeof F===J?K[F]:void 0,t.default,e.default)}function Ns(t,e,F){if(Ur(F)!=="number")return ha(t.default,e.default);const K=t.stops.length;if(K===1||F<=t.stops[0][0])return t.stops[0][1];if(F>=t.stops[K-1][0])return t.stops[K-1][1];const J=Ss(t.stops.map(ee=>ee[0]),F);return t.stops[J][1]}function co(t,e,F){const K=t.base!==void 0?t.base:1;if(Ur(F)!=="number")return ha(t.default,e.default);const J=t.stops.length;if(J===1||F<=t.stops[0][0])return t.stops[0][1];if(F>=t.stops[J-1][0])return t.stops[J-1][1];const ee=Ss(t.stops.map(pe=>pe[0]),F),ie=function(pe,me,_e,xe){const we=xe-_e,Ae=pe-_e;return we===0?0:me===1?Ae/we:(Math.pow(me,Ae)-1)/(Math.pow(me,we)-1)}(F,K,t.stops[ee][0],t.stops[ee+1][0]),oe=t.stops[ee][1],le=t.stops[ee+1][1];let ce=Ua[e.type]||yu;if(t.colorSpace&&t.colorSpace!=="rgb"){const pe=jl[t.colorSpace];ce=(me,_e)=>pe.reverse(pe.interpolate(pe.forward(me),pe.forward(_e),ie))}return typeof oe.evaluate=="function"?{evaluate(...pe){const me=oe.evaluate.apply(void 0,pe),_e=le.evaluate.apply(void 0,pe);if(me!==void 0&&_e!==void 0)return ce(me,_e,ie)}}:ce(oe,le,ie)}function gu(t,e,F){return e.type==="color"?F=Si.parse(F):e.type==="formatted"?F=fn.fromString(F.toString()):e.type==="resolvedImage"?F=Tn.fromString(F.toString()):Ur(F)===e.type||e.type==="enum"&&e.values[F]||(F=void 0),ha(F,t.default,e.default)}class Fs{constructor(e,F){this.expression=e,this._warningHistory={},this._evaluator=new Al,this._defaultValue=F?function(K){return K.type==="color"&&(Ha(K.default)||Array.isArray(K.default))?new Si(0,0,0,0):K.type==="color"?Si.parse(K.default)||null:K.default===void 0?null:K.default}(F):null,this._enumValues=F&&F.type==="enum"?F.values:null}evaluateWithoutErrorHandling(e,F,K,J,ee,ie,oe,le){return this._evaluator.globals=e,this._evaluator.feature=F,this._evaluator.featureState=K,this._evaluator.canonical=J||null,this._evaluator.availableImages=ee||null,this._evaluator.formattedSection=ie,this._evaluator.featureTileCoord=oe||null,this._evaluator.featureDistanceData=le||null,this.expression.evaluate(this._evaluator)}evaluate(e,F,K,J,ee,ie,oe,le){this._evaluator.globals=e,this._evaluator.feature=F||null,this._evaluator.featureState=K||null,this._evaluator.canonical=J||null,this._evaluator.availableImages=ee||null,this._evaluator.formattedSection=ie||null,this._evaluator.featureTileCoord=oe||null,this._evaluator.featureDistanceData=le||null;try{const ce=this.expression.evaluate(this._evaluator);if(ce==null||typeof ce=="number"&&ce!=ce)return this._defaultValue;if(this._enumValues&&!(ce in this._enumValues))throw new Ki(`Expected value to be one of ${Object.keys(this._enumValues).map(pe=>JSON.stringify(pe)).join(", ")}, but found ${JSON.stringify(ce)} instead.`);return ce}catch(ce){return this._warningHistory[ce.message]||(this._warningHistory[ce.message]=!0,typeof console<"u"&&console.warn(ce.message)),this._defaultValue}}}function fa(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in qa}function pa(t,e){const F=new Dl(qa,[],e?function(J){const ee={color:$n,string:Br,number:Qt,enum:Br,boolean:Mr,formatted:Pa,resolvedImage:Do};return J.type==="array"?En(ee[J.value]||Dr,J.length):ee[J.type]}(e):void 0),K=F.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return K?mu(new Fs(K,e)):Fo(F.errors)}class Zl{constructor(e,F){this.kind=e,this._styleExpression=F,this.isStateDependent=e!=="constant"&&!so(F.expression)}evaluateWithoutErrorHandling(e,F,K,J,ee,ie){return this._styleExpression.evaluateWithoutErrorHandling(e,F,K,J,ee,ie)}evaluate(e,F,K,J,ee,ie){return this._styleExpression.evaluate(e,F,K,J,ee,ie)}}class Ka{constructor(e,F,K,J){this.kind=e,this.zoomStops=K,this._styleExpression=F,this.isStateDependent=e!=="camera"&&!so(F.expression),this.interpolationType=J}evaluateWithoutErrorHandling(e,F,K,J,ee,ie){return this._styleExpression.evaluateWithoutErrorHandling(e,F,K,J,ee,ie)}evaluate(e,F,K,J,ee,ie){return this._styleExpression.evaluate(e,F,K,J,ee,ie)}interpolationFactor(e,F,K){return this.interpolationType?qn.interpolationFactor(this.interpolationType,e,F,K):0}}function Za(t,e){if((t=pa(t,e)).result==="error")return t;const F=t.value.expression,K=aa(F);if(!K&&!ua(e))return Fo([new Gn("","data expressions not supported")]);const J=ko(F,["zoom","pitch","distance-from-center"]);if(!J&&!Ls(e))return Fo([new Gn("","zoom expressions not supported")]);const ee=Us(F);return ee||J?ee instanceof Gn?Fo([ee]):ee instanceof qn&&!Bs(e)?Fo([new Gn("",'"interpolate" expressions cannot be used with this property')]):mu(ee?new Ka(K?"camera":"composite",t.value,ee.labels,ee instanceof qn?ee.interpolation:void 0):new Zl(K?"constant":"source",t.value)):Fo([new Gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class zs{constructor(e,F){this._parameters=e,this._specification=F,ro(this,ks(this._parameters,this._specification))}static deserialize(e){return new zs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Us(t){let e=null;if(t instanceof su)e=Us(t.result);else if(t instanceof Gl){for(const F of t.args)if(e=Us(F),e)break}else(t instanceof Bl||t instanceof qn)&&t.input instanceof oo&&t.input.name==="zoom"&&(e=t);return e instanceof Gn||t.eachChild(F=>{const K=Us(F);K instanceof Gn?e=K:!e&&K?e=new Gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&K&&e!==K&&(e=new Gn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class er{constructor(e,F,K,J){this.message=(e?`${e}: `:"")+K,J&&(this.identifier=J),F!=null&&F.__line__&&(this.line=F.__line__)}}function Ln(t){const e=t.key,F=t.value,K=t.valueSpec||{},J=t.objectElementValidators||{},ee=t.style,ie=t.styleSpec;let oe=[];const le=Ur(F);if(le!=="object")return[new er(e,F,`object expected, ${le} found`)];for(const ce in F){const pe=ce.split(".")[0];let me;J[pe]?me=J[pe]:K[pe]?me=rn:J["*"]?me=J["*"]:K["*"]&&(me=rn),me?oe=oe.concat(me({key:(e&&`${e}.`)+ce,value:F[ce],valueSpec:K[pe]||K["*"],style:ee,styleSpec:ie,object:F,objectKey:ce},F)):oe.push(new er(e,F[ce],`unknown property "${ce}"`))}for(const ce in K)J[ce]||K[ce].required&&K[ce].default===void 0&&F[ce]===void 0&&oe.push(new er(e,F,`missing required property "${ce}"`));return oe}function vu(t){const e=t.value,F=t.valueSpec,K=t.style,J=t.styleSpec,ee=t.key,ie=t.arrayElementValidator||rn;if(Ur(e)!=="array")return[new er(ee,e,`array expected, ${Ur(e)} found`)];if(F.length&&e.length!==F.length)return[new er(ee,e,`array length ${F.length} expected, length ${e.length} found`)];if(F["min-length"]&&e.length<F["min-length"])return[new er(ee,e,`array length at least ${F["min-length"]} expected, length ${e.length} found`)];let oe={type:F.value,values:F.values,minimum:F.minimum,maximum:F.maximum,function:void 0};J.$version<7&&(oe.function=F.function),Ur(F.value)==="object"&&(oe=F.value);let le=[];for(let ce=0;ce<e.length;ce++)le=le.concat(ie({array:e,arrayIndex:ce,value:e[ce],valueSpec:oe,style:K,styleSpec:J,key:`${ee}[${ce}]`}));return le}function Xa(t){const e=t.key,F=t.value,K=t.valueSpec;let J=Ur(F);if(J==="number"&&F!=F&&(J="NaN"),J!=="number")return[new er(e,F,`number expected, ${J} found`)];if("minimum"in K){let ee=K.minimum;if(Ur(K.minimum)==="array"&&(ee=K.minimum[t.arrayIndex]),F<ee)return[new er(e,F,`${F} is less than the minimum value ${ee}`)]}if("maximum"in K){let ee=K.maximum;if(Ur(K.maximum)==="array"&&(ee=K.maximum[t.arrayIndex]),F>ee)return[new er(e,F,`${F} is greater than the maximum value ${ee}`)]}return[]}function Ya(t){const e=t.valueSpec,F=Oi(t.value.type);let K,J,ee,ie={};const oe=F!=="categorical"&&t.value.property===void 0,le=!oe,ce=Ur(t.value.stops)==="array"&&Ur(t.value.stops[0])==="array"&&Ur(t.value.stops[0][0])==="object",pe=Ln({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(xe){if(F==="identity")return[new er(xe.key,xe.value,'identity function may not have a "stops" property')];let we=[];const Ae=xe.value;return we=we.concat(vu({key:xe.key,value:Ae,valueSpec:xe.valueSpec,style:xe.style,styleSpec:xe.styleSpec,arrayElementValidator:me})),Ur(Ae)==="array"&&Ae.length===0&&we.push(new er(xe.key,Ae,"array must have at least one stop")),we},default:function(xe){return rn({key:xe.key,value:xe.value,valueSpec:e,style:xe.style,styleSpec:xe.styleSpec})}}});return F==="identity"&&oe&&pe.push(new er(t.key,t.value,'missing required property "property"')),F==="identity"||t.value.stops||pe.push(new er(t.key,t.value,'missing required property "stops"')),F==="exponential"&&t.valueSpec.expression&&!Bs(t.valueSpec)&&pe.push(new er(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(le&&!ua(t.valueSpec)?pe.push(new er(t.key,t.value,"property functions not supported")):oe&&!Ls(t.valueSpec)&&pe.push(new er(t.key,t.value,"zoom functions not supported"))),F!=="categorical"&&!ce||t.value.property!==void 0||pe.push(new er(t.key,t.value,'"property" property is required')),pe;function me(xe){let we=[];const Ae=xe.value,Re=xe.key;if(Ur(Ae)!=="array")return[new er(Re,Ae,`array expected, ${Ur(Ae)} found`)];if(Ae.length!==2)return[new er(Re,Ae,`array length 2 expected, length ${Ae.length} found`)];if(ce){if(Ur(Ae[0])!=="object")return[new er(Re,Ae,`object expected, ${Ur(Ae[0])} found`)];if(Ae[0].zoom===void 0)return[new er(Re,Ae,"object stop key must have zoom")];if(Ae[0].value===void 0)return[new er(Re,Ae,"object stop key must have value")];const ze=Oi(Ae[0].zoom);if(typeof ze!="number")return[new er(Re,Ae[0].zoom,"stop zoom values must be numbers")];if(ee&&ee>ze)return[new er(Re,Ae[0].zoom,"stop zoom values must appear in ascending order")];ze!==ee&&(ee=ze,J=void 0,ie={}),we=we.concat(Ln({key:`${Re}[0]`,value:Ae[0],valueSpec:{zoom:{}},style:xe.style,styleSpec:xe.styleSpec,objectElementValidators:{zoom:Xa,value:_e}}))}else we=we.concat(_e({key:`${Re}[0]`,value:Ae[0],valueSpec:{},style:xe.style,styleSpec:xe.styleSpec},Ae));return fa(Ui(Ae[1]))?we.concat([new er(`${Re}[1]`,Ae[1],"expressions are not allowed in function stops.")]):we.concat(rn({key:`${Re}[1]`,value:Ae[1],valueSpec:e,style:xe.style,styleSpec:xe.styleSpec}))}function _e(xe,we){const Ae=Ur(xe.value),Re=Oi(xe.value),ze=xe.value!==null?xe.value:we;if(K){if(Ae!==K)return[new er(xe.key,ze,`${Ae} stop domain type must match previous stop domain type ${K}`)]}else K=Ae;if(Ae!=="number"&&Ae!=="string"&&Ae!=="boolean"&&typeof Re!="number"&&typeof Re!="string"&&typeof Re!="boolean")return[new er(xe.key,ze,"stop domain value must be a number, string, or boolean")];if(Ae!=="number"&&F!=="categorical"){let Ze=`number expected, ${Ae} found`;return ua(e)&&F===void 0&&(Ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new er(xe.key,ze,Ze)]}return F!=="categorical"||Ae!=="number"||typeof Re=="number"&&isFinite(Re)&&Math.floor(Re)===Re?F!=="categorical"&&Ae==="number"&&typeof Re=="number"&&typeof J=="number"&&J!==void 0&&Re<J?[new er(xe.key,ze,"stop domain values must appear in ascending order")]:(J=Re,F==="categorical"&&Re in ie?[new er(xe.key,ze,"stop domain values must be unique")]:(ie[Re]=!0,[])):[new er(xe.key,ze,`integer expected, found ${String(Re)}`)]}}function ji(t){const e=(t.expressionContext==="property"?Za:pa)(Ui(t.value),t.valueSpec);if(e.result==="error")return e.value.map(K=>new er(`${t.key}${K.key}`,t.value,K.message));const F=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!F.outputDefined())return[new er(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!so(F))return[new er(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return Ja(F,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ko(F,["zoom","feature-state"]))return[new er(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!aa(F))return[new er(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ja(t,e){const F=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const J of e.valueSpec.expression.parameters)F.delete(J);if(F.size===0)return[];const K=[];return t instanceof oo&&F.has(t.name)?[new er(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(J=>{K.push(...Ja(J,e))}),K)}function js(t){const e=t.key,F=t.value,K=t.valueSpec,J=[];return Array.isArray(K.values)?K.values.indexOf(Oi(F))===-1&&J.push(new er(e,F,`expected one of [${K.values.join(", ")}], ${JSON.stringify(F)} found`)):Object.keys(K.values).indexOf(Oi(F))===-1&&J.push(new er(e,F,`expected one of [${Object.keys(K.values).join(", ")}], ${JSON.stringify(F)} found`)),J}function Xl(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Xl(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Vs(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Xl(t)||(t=ma(t));const F=t;let K=!0;try{K=function(ce){if(!da(ce))return ce;let pe=Ui(ce);return Gs(pe),pe=$u(pe),pe}(F)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(F,null,2)}
        `)}const J=Et[`filter_${e}`],ee=pa(K,J);let ie=null;if(ee.result==="error")throw new Error(ee.value.map(ce=>`${ce.key}: ${ce.message}`).join(", "));ie=(ce,pe,me)=>ee.value.evaluate(ce,pe,{},me);let oe=null,le=null;if(K!==F){const ce=pa(F,J);if(ce.result==="error")throw new Error(ce.value.map(pe=>`${pe.key}: ${pe.message}`).join(", "));oe=(pe,me,_e,xe,we)=>ce.value.evaluate(pe,me,{},_e,void 0,void 0,xe,we),le=!aa(ce.value.expression)}return{filter:ie,dynamicFilter:oe||void 0,needGeometry:xu(K),needFeature:!!le}}function $u(t){if(!Array.isArray(t))return t;const e=function(F){if(Yl.has(F[0])){for(let K=1;K<F.length;K++)if(da(F[K]))return!0}return F}(t);return e===!0?e:e.map(F=>$u(F))}function Gs(t){let e=!1;const F=[];if(t[0]==="case"){for(let K=1;K<t.length-1;K+=2)e=e||da(t[K]),F.push(t[K+1]);F.push(t[t.length-1])}else if(t[0]==="match"){e=e||da(t[1]);for(let K=2;K<t.length-1;K+=2)F.push(t[K+1]);F.push(t[t.length-1])}else if(t[0]==="step"){e=e||da(t[1]);for(let K=1;K<t.length-1;K+=2)F.push(t[K+1])}e&&(t.length=0,t.push("any",...F));for(let K=1;K<t.length;K++)Gs(t[K])}function da(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let F=1;F<t.length;F++)if(da(t[F]))return!0;return!1}const Yl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Rh(t,e){return t<e?-1:t>e?1:0}function xu(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(xu(t[e]))return!0;return!1}function ma(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Jl(t[1],t[2],"=="):e==="!="?Ws(Jl(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Jl(t[1],t[2],e):e==="any"?(F=t.slice(1),["any"].concat(F.map(ma))):e==="all"?["all"].concat(t.slice(1).map(ma)):e==="none"?["all"].concat(t.slice(1).map(ma).map(Ws)):e==="in"?Ql(t[1],t.slice(2)):e==="!in"?Ws(Ql(t[1],t.slice(2))):e==="has"?ec(t[1]):e==="!has"?Ws(ec(t[1])):e!=="within"||t;var F}function Jl(t,e,F){switch(t){case"$type":return[`filter-type-${F}`,e];case"$id":return[`filter-id-${F}`,e];default:return[`filter-${F}`,t,e]}}function Ql(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(F=>typeof F!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Rh)]]:["filter-in-small",t,["literal",e]]}}function ec(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ws(t){return["!",t]}function Qa(t){return Xl(Ui(t.value))?ji(ro({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):es(t)}function es(t){const e=t.value,F=t.key;if(Ur(e)!=="array")return[new er(F,e,`array expected, ${Ur(e)} found`)];const K=t.styleSpec;let J,ee=[];if(e.length<1)return[new er(F,e,"filter array must have at least 1 element")];switch(ee=ee.concat(js({key:`${F}[0]`,value:e[0],valueSpec:K.filter_operator,style:t.style,styleSpec:t.styleSpec})),Oi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Oi(e[1])==="$type"&&ee.push(new er(F,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&ee.push(new er(F,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(J=Ur(e[1]),J!=="string"&&ee.push(new er(`${F}[1]`,e[1],`string expected, ${J} found`)));for(let ie=2;ie<e.length;ie++)J=Ur(e[ie]),Oi(e[1])==="$type"?ee=ee.concat(js({key:`${F}[${ie}]`,value:e[ie],valueSpec:K.geometry_type,style:t.style,styleSpec:t.styleSpec})):J!=="string"&&J!=="number"&&J!=="boolean"&&ee.push(new er(`${F}[${ie}]`,e[ie],`string, number, or boolean expected, ${J} found`));break;case"any":case"all":case"none":for(let ie=1;ie<e.length;ie++)ee=ee.concat(es({key:`${F}[${ie}]`,value:e[ie],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":J=Ur(e[1]),e.length!==2?ee.push(new er(F,e,`filter array for "${e[0]}" operator must have 2 elements`)):J!=="string"&&ee.push(new er(`${F}[1]`,e[1],`string expected, ${J} found`));break;case"within":J=Ur(e[1]),e.length!==2?ee.push(new er(F,e,`filter array for "${e[0]}" operator must have 2 elements`)):J!=="object"&&ee.push(new er(`${F}[1]`,e[1],`object expected, ${J} found`))}return ee}function tc(t,e){const F=t.key,K=t.style,J=t.styleSpec,ee=t.value,ie=t.objectKey,oe=J[`${e}_${t.layerType}`];if(!oe)return[];const le=ie.match(/^(.*)-transition$/);if(e==="paint"&&le&&oe[le[1]]&&oe[le[1]].transition)return rn({key:F,value:ee,valueSpec:J.transition,style:K,styleSpec:J});const ce=t.valueSpec||oe[ie];if(!ce)return[new er(F,ee,`unknown property "${ie}"`)];let pe;if(Ur(ee)==="string"&&ua(ce)&&!ce.tokens&&(pe=/^{([^}]+)}$/.exec(ee))){const _e=`\`{ "type": "identity", "property": ${pe?JSON.stringify(pe[1]):'"_"'} }\``;return[new er(F,ee,`"${ie}" does not support interpolation syntax
Use an identity property function instead: ${_e}.`)]}const me=[];return t.layerType==="symbol"&&(ie==="text-field"&&K&&!K.glyphs&&me.push(new er(F,ee,'use of "text-field" requires a style "glyphs" property')),ie==="text-font"&&Ha(Ui(ee))&&Oi(ee.type)==="identity"&&me.push(new er(F,ee,'"text-font" does not support identity functions'))),me.concat(rn({key:t.key,value:ee,valueSpec:ce,style:K,styleSpec:J,expressionContext:"property",propertyType:e,propertyKey:ie}))}function bu(t){return tc(t,"paint")}function rc(t){return tc(t,"layout")}function wu(t){let e=[];const F=t.value,K=t.key,J=t.style,ee=t.styleSpec;F.type||F.ref||e.push(new er(K,F,'either "type" or "ref" is required'));let ie=Oi(F.type);const oe=Oi(F.ref);if(F.id){const le=Oi(F.id);for(let ce=0;ce<t.arrayIndex;ce++){const pe=J.layers[ce];Oi(pe.id)===le&&e.push(new er(K,F.id,`duplicate layer id "${F.id}", previously used at line ${pe.id.__line__}`))}}if("ref"in F){let le;["type","source","source-layer","filter","layout"].forEach(ce=>{ce in F&&e.push(new er(K,F[ce],`"${ce}" is prohibited for ref layers`))}),J.layers.forEach(ce=>{Oi(ce.id)===oe&&(le=ce)}),le?le.ref?e.push(new er(K,F.ref,"ref cannot reference another ref layer")):ie=Oi(le.type):typeof oe=="string"&&e.push(new er(K,F.ref,`ref layer "${oe}" not found`))}else if(ie!=="background"&&ie!=="sky")if(F.source){const le=J.sources&&J.sources[F.source],ce=le&&Oi(le.type);le?ce==="vector"&&ie==="raster"?e.push(new er(K,F.source,`layer "${F.id}" requires a raster source`)):ce==="raster"&&ie!=="raster"?e.push(new er(K,F.source,`layer "${F.id}" requires a vector source`)):ce!=="vector"||F["source-layer"]?ce==="raster-dem"&&ie!=="hillshade"?e.push(new er(K,F.source,"raster-dem source can only be used with layer type 'hillshade'.")):ie!=="line"||!F.paint||!F.paint["line-gradient"]&&!F.paint["line-trim-offset"]||ce==="geojson"&&le.lineMetrics||e.push(new er(K,F,`layer "${F.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new er(K,F,`layer "${F.id}" must specify a "source-layer"`)):e.push(new er(K,F.source,`source "${F.source}" not found`))}else e.push(new er(K,F,'missing required property "source"'));return e=e.concat(Ln({key:K,value:F,valueSpec:ee.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>rn({key:`${K}.type`,value:F.type,valueSpec:ee.layer.type,style:t.style,styleSpec:t.styleSpec,object:F,objectKey:"type"}),filter:le=>Qa(ro({layerType:ie},le)),layout:le=>Ln({layer:F,key:le.key,value:le.value,valueSpec:{},style:le.style,styleSpec:le.styleSpec,objectElementValidators:{"*":ce=>rc(ro({layerType:ie},ce))}}),paint:le=>Ln({layer:F,key:le.key,value:le.value,valueSpec:{},style:le.style,styleSpec:le.styleSpec,objectElementValidators:{"*":ce=>bu(ro({layerType:ie},ce))}})}})),e}function bo(t){const e=t.value,F=t.key,K=Ur(e);return K!=="string"?[new er(F,e,`string expected, ${K} found`)]:[]}const Eu={promoteId:function({key:t,value:e}){if(Ur(e)==="string")return bo({key:t,value:e});{const F=[];for(const K in e)F.push(...bo({key:`${t}.${K}`,value:e[K]}));return F}}};function Tu(t){const e=t.value,F=t.key,K=t.styleSpec,J=t.style;if(!e.type)return[new er(F,e,'"type" is required')];const ee=Oi(e.type);let ie;switch(ee){case"vector":case"raster":case"raster-dem":return ie=Ln({key:F,value:e,valueSpec:K[`source_${ee.replace("-","_")}`],style:t.style,styleSpec:K,objectElementValidators:Eu}),ie;case"geojson":if(ie=Ln({key:F,value:e,valueSpec:K.source_geojson,style:J,styleSpec:K,objectElementValidators:Eu}),e.cluster)for(const oe in e.clusterProperties){const[le,ce]=e.clusterProperties[oe],pe=typeof le=="string"?[le,["accumulated"],["get",oe]]:le;ie.push(...ji({key:`${F}.${oe}.map`,value:ce,expressionContext:"cluster-map"})),ie.push(...ji({key:`${F}.${oe}.reduce`,value:pe,expressionContext:"cluster-reduce"}))}return ie;case"video":return Ln({key:F,value:e,valueSpec:K.source_video,style:J,styleSpec:K});case"image":return Ln({key:F,value:e,valueSpec:K.source_image,style:J,styleSpec:K});case"canvas":return[new er(F,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return js({key:`${F}.type`,value:e.type,valueSpec:{values:Mh(K)},style:J,styleSpec:K})}}function Mh(t){return t.source.reduce((e,F)=>{const K=t[F];return K.type.type==="enum"&&(e=e.concat(Object.keys(K.type.values))),e},[])}function Su(t){const e=t.value,F=t.styleSpec,K=F.light,J=t.style;let ee=[];const ie=Ur(e);if(e===void 0)return ee;if(ie!=="object")return ee=ee.concat([new er("light",e,`object expected, ${ie} found`)]),ee;for(const oe in e){const le=oe.match(/^(.*)-transition$/);ee=ee.concat(le&&K[le[1]]&&K[le[1]].transition?rn({key:oe,value:e[oe],valueSpec:F.transition,style:J,styleSpec:F}):K[oe]?rn({key:oe,value:e[oe],valueSpec:K[oe],style:J,styleSpec:F}):[new er(oe,e[oe],`unknown property "${oe}"`)])}return ee}function ic(t){const e=t.value,F=t.key,K=t.style,J=t.styleSpec,ee=J.terrain;let ie=[];const oe=Ur(e);if(e===void 0)return ie;if(oe!=="object")return ie=ie.concat([new er("terrain",e,`object expected, ${oe} found`)]),ie;for(const le in e){const ce=le.match(/^(.*)-transition$/);ie=ie.concat(ce&&ee[ce[1]]&&ee[ce[1]].transition?rn({key:le,value:e[le],valueSpec:J.transition,style:K,styleSpec:J}):ee[le]?rn({key:le,value:e[le],valueSpec:ee[le],style:K,styleSpec:J}):[new er(le,e[le],`unknown property "${le}"`)])}if(e.source){const le=K.sources&&K.sources[e.source],ce=le&&Oi(le.type);le?ce!=="raster-dem"&&ie.push(new er(F,e.source,`terrain cannot be used with a source of type ${String(ce)}, it only be used with a "raster-dem" source type`)):ie.push(new er(F,e.source,`source "${e.source}" not found`))}else ie.push(new er(F,e,'terrain is missing required property "source"'));return ie}function Iu(t){const e=t.value,F=t.style,K=t.styleSpec,J=K.fog;let ee=[];const ie=Ur(e);if(e===void 0)return ee;if(ie!=="object")return ee=ee.concat([new er("fog",e,`object expected, ${ie} found`)]),ee;for(const oe in e){const le=oe.match(/^(.*)-transition$/);ee=ee.concat(le&&J[le[1]]&&J[le[1]].transition?rn({key:oe,value:e[oe],valueSpec:K.transition,style:F,styleSpec:K}):J[oe]?rn({key:oe,value:e[oe],valueSpec:J[oe],style:F,styleSpec:K}):[new er(oe,e[oe],`unknown property "${oe}"`)])}return ee}const Au={"*":()=>[],array:vu,boolean:function(t){const e=t.value,F=t.key,K=Ur(e);return K!=="boolean"?[new er(F,e,`boolean expected, ${K} found`)]:[]},number:Xa,color:function(t){const e=t.key,F=t.value,K=Ur(F);return K!=="string"?[new er(e,F,`color expected, ${K} found`)]:xl(F)===null?[new er(e,F,`color expected, "${F}" found`)]:[]},enum:js,filter:Qa,function:Ya,layer:wu,object:Ln,source:Tu,light:Su,terrain:ic,fog:Iu,string:bo,formatted:function(t){return bo(t).length===0?[]:ji(t)},resolvedImage:function(t){return bo(t).length===0?[]:ji(t)},projection:function(t){const e=t.value,F=t.styleSpec,K=F.projection,J=t.style;let ee=[];const ie=Ur(e);if(ie==="object")for(const oe in e)ee=ee.concat(rn({key:oe,value:e[oe],valueSpec:K[oe],style:J,styleSpec:F}));else ie!=="string"&&(ee=ee.concat([new er("projection",e,`object or string expected, ${ie} found`)]));return ee}};function rn(t){const e=t.value,F=t.valueSpec,K=t.styleSpec;return F.expression&&Ha(Oi(e))?Ya(t):F.expression&&fa(Ui(e))?ji(t):F.type&&Au[F.type]?Au[F.type](t):Ln(ro({},t,{valueSpec:F.type?K[F.type]:F}))}function Dh(t){const e=t.value,F=t.key,K=bo(t);return K.length||(e.indexOf("{fontstack}")===-1&&K.push(new er(F,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&K.push(new er(F,e,'"glyphs" url must include a "{range}" token'))),K}function Ou(t,e=Et){return In(rn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Dh,"*":()=>[]}}))}const Lh=t=>In(bu(t)),Bh=t=>In(rc(t));function In(t){return t.slice().sort((e,F)=>e.line&&F.line?e.line-F.line:0)}function Cu(t,e){let F=!1;if(e&&e.length)for(const K of e)t.fire(new to(new Error(K.message))),F=!0;return F}var kh=Hn,Bn=3;function Hn(t,e,F){var K=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var J=new Int32Array(this.arrayBuffer);t=J[0],this.d=(e=J[1])+2*(F=J[2]);for(var ee=0;ee<this.d*this.d;ee++){var ie=J[Bn+ee],oe=J[Bn+ee+1];K.push(ie===oe?null:J.subarray(ie,oe))}var le=J[Bn+K.length+1];this.keys=J.subarray(J[Bn+K.length],le),this.bboxes=J.subarray(le),this.insert=this._insertReadonly}else{this.d=e+2*F;for(var ce=0;ce<this.d*this.d;ce++)K.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=F,this.scale=e/t,this.uid=0;var pe=F/e*t;this.min=-pe,this.max=t+pe}Hn.prototype.insert=function(t,e,F,K,J){this._forEachCell(e,F,K,J,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(F),this.bboxes.push(K),this.bboxes.push(J)},Hn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Hn.prototype._insertCell=function(t,e,F,K,J,ee){this.cells[J].push(ee)},Hn.prototype.query=function(t,e,F,K,J){var ee=this.min,ie=this.max;if(t<=ee&&e<=ee&&ie<=F&&ie<=K&&!J)return Array.prototype.slice.call(this.keys);var oe=[];return this._forEachCell(t,e,F,K,this._queryCell,oe,{},J),oe},Hn.prototype._queryCell=function(t,e,F,K,J,ee,ie,oe){var le=this.cells[J];if(le!==null)for(var ce=this.keys,pe=this.bboxes,me=0;me<le.length;me++){var _e=le[me];if(ie[_e]===void 0){var xe=4*_e;(oe?oe(pe[xe+0],pe[xe+1],pe[xe+2],pe[xe+3]):t<=pe[xe+2]&&e<=pe[xe+3]&&F>=pe[xe+0]&&K>=pe[xe+1])?(ie[_e]=!0,ee.push(ce[_e])):ie[_e]=!1}}},Hn.prototype._forEachCell=function(t,e,F,K,J,ee,ie,oe){for(var le=this._convertToCellCoord(t),ce=this._convertToCellCoord(e),pe=this._convertToCellCoord(F),me=this._convertToCellCoord(K),_e=le;_e<=pe;_e++)for(var xe=ce;xe<=me;xe++){var we=this.d*xe+_e;if((!oe||oe(this._convertFromCellCoord(_e),this._convertFromCellCoord(xe),this._convertFromCellCoord(_e+1),this._convertFromCellCoord(xe+1)))&&J.call(this,t,e,F,K,we,ee,ie,oe))return}},Hn.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Hn.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Hn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Bn+this.cells.length+1+1,F=0,K=0;K<this.cells.length;K++)F+=this.cells[K].length;var J=new Int32Array(e+F+this.keys.length+this.bboxes.length);J[0]=this.extent,J[1]=this.n,J[2]=this.padding;for(var ee=e,ie=0;ie<t.length;ie++){var oe=t[ie];J[Bn+ie]=ee,J.set(oe,ee),ee+=oe.length}return J[Bn+t.length]=ee,J.set(this.keys,ee),J[Bn+t.length+1]=ee+=this.keys.length,J.set(this.bboxes,ee),ee+=this.bboxes.length,J.buffer};var zo=sr(kh);const qs={};function tr(t,e,F={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),qs[e]={klass:t,omit:F.omit||[]}}tr(Object,"Object"),zo.serialize=function(t,e){const F=t.toArrayBuffer();return e&&e.push(F),{buffer:F}},zo.deserialize=function(t){return new zo(t.buffer)},Object.defineProperty(zo,"name",{value:"Grid"}),tr(zo,"Grid"),tr(Si,"Color"),tr(Error,"Error"),tr(Yr,"AJAXError"),tr(Tn,"ResolvedImage"),tr(zs,"StylePropertyFunction"),tr(Fs,"StyleExpression",{omit:["_evaluator"]}),tr(Ka,"ZoomDependentExpression"),tr(Zl,"ZoomConstantExpression"),tr(oo,"CompoundExpression",{omit:["_evaluate"]});for(const t in qa)qs[qa[t]._classRegistryKey]||tr(qa[t],`Expression${t}`);function nc(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function oc(t){return ye.ImageBitmap&&t instanceof ye.ImageBitmap}function ya(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(nc(t)||oc(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const F=t;return e&&e.push(F.buffer),F}if(t instanceof ye.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const F=[];for(const K of t)F.push(ya(K,e));return F}if(typeof t=="object"){const F=t.constructor,K=F._classRegistryKey;if(!K)throw new Error(`can't serialize object of unregistered class ${K}`);const J=F.serialize?F.serialize(t,e):{};if(!F.serialize){for(const ee in t)t.hasOwnProperty(ee)&&(qs[K].omit.indexOf(ee)>=0||(J[ee]=ya(t[ee],e)));t instanceof Error&&(J.message=t.message)}if(J.$name)throw new Error("$name property is reserved for worker serialization logic.");return K!=="Object"&&(J.$name=K),J}throw new Error("can't serialize object of type "+typeof t)}function Uo(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||nc(t)||oc(t)||ArrayBuffer.isView(t)||t instanceof ye.ImageData)return t;if(Array.isArray(t))return t.map(Uo);if(typeof t=="object"){const e=t.$name||"Object",{klass:F}=qs[e];if(!F)throw new Error(`can't deserialize unregistered class ${e}`);if(F.deserialize)return F.deserialize(t);const K=Object.create(F.prototype);for(const J of Object.keys(t))J!=="$name"&&(K[J]=Uo(t[J]));return K}throw new Error("can't deserialize object of type "+typeof t)}const Jt={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function ac(t){for(const e of t)if(sc(e.charCodeAt(0)))return!0;return!1}function Nh(t){for(const e of t)if(!Pu(e.charCodeAt(0)))return!1;return!0}function Pu(t){return!(Jt.Arabic(t)||Jt["Arabic Supplement"](t)||Jt["Arabic Extended-A"](t)||Jt["Arabic Presentation Forms-A"](t)||Jt["Arabic Presentation Forms-B"](t))}function sc(t){return!(t!==746&&t!==747&&(t<4352||!(Jt["Bopomofo Extended"](t)||Jt.Bopomofo(t)||Jt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Jt["CJK Compatibility Ideographs"](t)||Jt["CJK Compatibility"](t)||Jt["CJK Radicals Supplement"](t)||Jt["CJK Strokes"](t)||!(!Jt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Jt["CJK Unified Ideographs Extension A"](t)||Jt["CJK Unified Ideographs"](t)||Jt["Enclosed CJK Letters and Months"](t)||Jt["Hangul Compatibility Jamo"](t)||Jt["Hangul Jamo Extended-A"](t)||Jt["Hangul Jamo Extended-B"](t)||Jt["Hangul Jamo"](t)||Jt["Hangul Syllables"](t)||Jt.Hiragana(t)||Jt["Ideographic Description Characters"](t)||Jt.Kanbun(t)||Jt["Kangxi Radicals"](t)||Jt["Katakana Phonetic Extensions"](t)||Jt.Katakana(t)&&t!==12540||!(!Jt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Jt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Jt["Unified Canadian Aboriginal Syllabics"](t)||Jt["Unified Canadian Aboriginal Syllabics Extended"](t)||Jt["Vertical Forms"](t)||Jt["Yijing Hexagram Symbols"](t)||Jt["Yi Syllables"](t)||Jt["Yi Radicals"](t))))}function Ru(t){return!(sc(t)||function(e){return!!(Jt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Jt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Jt["Letterlike Symbols"](e)||Jt["Number Forms"](e)||Jt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Jt["Control Pictures"](e)&&e!==9251||Jt["Optical Character Recognition"](e)||Jt["Enclosed Alphanumerics"](e)||Jt["Geometric Shapes"](e)||Jt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Jt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Jt["CJK Symbols and Punctuation"](e)||Jt.Katakana(e)||Jt["Private Use Area"](e)||Jt["CJK Compatibility Forms"](e)||Jt["Small Form Variants"](e)||Jt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Mu(t){return t>=1424&&t<=2303||Jt["Arabic Presentation Forms-A"](t)||Jt["Arabic Presentation Forms-B"](t)}function Fh(t,e){return!(!e&&Mu(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Jt.Khmer(t))}function zh(t){for(const e of t)if(Mu(e.charCodeAt(0)))return!0;return!1}const lc="deferred",cc="loading",uc="loaded";let _a=null,Q="unavailable",U=null;const Y=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Q="error"),_a&&_a(t)};function te(){ne.fire(new Mo("pluginStateChange",{pluginStatus:Q,pluginURL:U}))}const ne=new Ca,ae=function(){return Q},he=function(){if(Q!==lc||!U)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Q=cc,te(),U&&Wr({url:U},t=>{t?Y(t):(Q=uc,te())})},fe={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Q===uc||fe.applyArabicShaping!=null,isLoading:()=>Q===cc,setState(t){Q=t.pluginStatus,U=t.pluginURL},isParsed:()=>fe.applyArabicShaping!=null&&fe.processBidirectionalText!=null&&fe.processStyledBidirectionalText!=null,getPluginURL:()=>U};class de{constructor(e,F){this.zoom=e,F?(this.now=F.now,this.fadeDuration=F.fadeDuration,this.transition=F.transition,this.pitch=F.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(F,K){for(const J of F)if(!Fh(J.charCodeAt(0),K))return!1;return!0}(e,fe.isLoaded())}}class ve{constructor(e,F){this.property=e,this.value=F,this.expression=function(K,J){if(Ha(K))return new zs(K,J);if(fa(K)){const ee=Za(K,J);if(ee.result==="error")throw new Error(ee.value.map(ie=>`${ie.key}: ${ie.message}`).join(", "));return ee.value}{let ee=K;return typeof K=="string"&&J.type==="color"&&(ee=Si.parse(K)),{kind:"constant",evaluate:()=>ee}}}(F===void 0?e.specification.default:F,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,F,K){return this.property.possiblyEvaluate(this,e,F,K)}}class ge{constructor(e){this.property=e,this.value=new ve(e,void 0)}transitioned(e,F){return new Pe(this.property,this.value,F,mr({},e.transition,this.transition),e.now)}untransitioned(){return new Pe(this.property,this.value,null,{},0)}}class Te{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Fi(this._values[e].value.value)}setValue(e,F){this._values.hasOwnProperty(e)||(this._values[e]=new ge(this._values[e].property)),this._values[e].value=new ve(this._values[e].property,F===null?void 0:Fi(F))}getTransition(e){return Fi(this._values[e].transition)}setTransition(e,F){this._values.hasOwnProperty(e)||(this._values[e]=new ge(this._values[e].property)),this._values[e].transition=Fi(F)||void 0}serialize(){const e={};for(const F of Object.keys(this._values)){const K=this.getValue(F);K!==void 0&&(e[F]=K);const J=this.getTransition(F);J!==void 0&&(e[`${F}-transition`]=J)}return e}transitioned(e,F){const K=new Le(this._properties);for(const J of Object.keys(this._values))K._values[J]=this._values[J].transitioned(e,F._values[J]);return K}untransitioned(){const e=new Le(this._properties);for(const F of Object.keys(this._values))e._values[F]=this._values[F].untransitioned();return e}}class Pe{constructor(e,F,K,J,ee){const ie=J.delay||0,oe=J.duration||0;ee=ee||0,this.property=e,this.value=F,this.begin=ee+ie,this.end=this.begin+oe,e.specification.transition&&(J.delay||J.duration)&&(this.prior=K)}possiblyEvaluate(e,F,K){const J=e.now||0,ee=this.value.possiblyEvaluate(e,F,K),ie=this.prior;if(ie){if(J>this.end)return this.prior=null,ee;if(this.value.isDataDriven())return this.prior=null,ee;if(J<this.begin)return ie.possiblyEvaluate(e,F,K);{const oe=(J-this.begin)/(this.end-this.begin);return this.property.interpolate(ie.possiblyEvaluate(e,F,K),ee,qi(oe))}}return ee}}class Le{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,F,K){const J=new Ne(this._properties);for(const ee of Object.keys(this._values))J._values[ee]=this._values[ee].possiblyEvaluate(e,F,K);return J}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ke{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Fi(this._values[e].value)}setValue(e,F){this._values[e]=new ve(this._values[e].property,F===null?void 0:Fi(F))}serialize(){const e={};for(const F of Object.keys(this._values)){const K=this.getValue(F);K!==void 0&&(e[F]=K)}return e}possiblyEvaluate(e,F,K){const J=new Ne(this._properties);for(const ee of Object.keys(this._values))J._values[ee]=this._values[ee].possiblyEvaluate(e,F,K);return J}}class Be{constructor(e,F,K){this.property=e,this.value=F,this.parameters=K}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,F,K,J){return this.property.evaluate(this.value,this.parameters,e,F,K,J)}}class Ne{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Se{constructor(e){this.specification=e}possiblyEvaluate(e,F){return e.expression.evaluate(F)}interpolate(e,F,K){const J=Ua[this.specification.type];return J?J(e,F,K):e}}class De{constructor(e,F){this.specification=e,this.overrides=F}possiblyEvaluate(e,F,K,J){return new Be(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(F,null,{},K,J)}:e.expression,F)}interpolate(e,F,K){if(e.value.kind!=="constant"||F.value.kind!=="constant")return e;if(e.value.value===void 0||F.value.value===void 0)return new Be(this,{kind:"constant",value:void 0},e.parameters);const J=Ua[this.specification.type];return J?new Be(this,{kind:"constant",value:J(e.value.value,F.value.value,K)},e.parameters):e}evaluate(e,F,K,J,ee,ie){return e.kind==="constant"?e.value:e.evaluate(F,K,J,ee,ie)}}class Ve{constructor(e){this.specification=e}possiblyEvaluate(e,F,K,J){return!!e.expression.evaluate(F,null,{},K,J)}interpolate(){return!1}}class Ge{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const F=new de(0,{});for(const K in e){const J=e[K];J.specification.overridable&&this.overridableProperties.push(K);const ee=this.defaultPropertyValues[K]=new ve(J,void 0),ie=this.defaultTransitionablePropertyValues[K]=new ge(J);this.defaultTransitioningPropertyValues[K]=ie.untransitioned(),this.defaultPossiblyEvaluatedValues[K]=ee.possiblyEvaluate(F)}}}function Qe(t,e){return 256*(t=ht(Math.floor(t),0,255))+ht(Math.floor(e),0,255)}tr(De,"DataDrivenProperty"),tr(Se,"DataConstantProperty"),tr(Ve,"ColorRampProperty");const tt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class et{constructor(e,F){this._structArray=e,this._pos1=F*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class at{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,F){return e._trim(),F&&(e.isTransferred=!0,F.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const F=Object.create(this.prototype);return F.arrayBuffer=e.arrayBuffer,F.length=e.length,F.capacity=e.arrayBuffer.byteLength/F.bytesPerElement,F._refreshViews(),F}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const F=this.uint8;this._refreshViews(),F&&this.uint8.set(F)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function nt(t,e=1){let F=0,K=0;return{members:t.map(J=>{const ee=tt[J.type].BYTES_PER_ELEMENT,ie=F=pt(F,Math.max(e,ee)),oe=J.components||1;return K=Math.max(K,ee),F+=ee*oe,{name:J.name,type:J.type,components:oe,offset:ie}}),size:pt(F,Math.max(K,e)),alignment:e}}function pt(t,e){return Math.ceil(t/e)*e}class kt extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,F){const K=this.length;return this.resize(K+1),this.emplace(K,e,F)}emplace(e,F,K){const J=2*e;return this.int16[J+0]=F,this.int16[J+1]=K,e}}kt.prototype.bytesPerElement=4,tr(kt,"StructArrayLayout2i4");class ct extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,F,K){const J=this.length;return this.resize(J+1),this.emplace(J,e,F,K)}emplace(e,F,K,J){const ee=3*e;return this.int16[ee+0]=F,this.int16[ee+1]=K,this.int16[ee+2]=J,e}}ct.prototype.bytesPerElement=6,tr(ct,"StructArrayLayout3i6");class At extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,F,K,J){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,F,K,J)}emplace(e,F,K,J,ee){const ie=4*e;return this.int16[ie+0]=F,this.int16[ie+1]=K,this.int16[ie+2]=J,this.int16[ie+3]=ee,e}}At.prototype.bytesPerElement=8,tr(At,"StructArrayLayout4i8");class yt extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,F,K,J,ee,ie,oe){const le=this.length;return this.resize(le+1),this.emplace(le,e,F,K,J,ee,ie,oe)}emplace(e,F,K,J,ee,ie,oe,le){const ce=6*e,pe=12*e,me=3*e;return this.int16[ce+0]=F,this.int16[ce+1]=K,this.uint8[pe+4]=J,this.uint8[pe+5]=ee,this.uint8[pe+6]=ie,this.uint8[pe+7]=oe,this.float32[me+2]=le,e}}yt.prototype.bytesPerElement=12,tr(yt,"StructArrayLayout2i4ub1f12");class Bt extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,F,K,J){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,F,K,J)}emplace(e,F,K,J,ee){const ie=4*e;return this.float32[ie+0]=F,this.float32[ie+1]=K,this.float32[ie+2]=J,this.float32[ie+3]=ee,e}}Bt.prototype.bytesPerElement=16,tr(Bt,"StructArrayLayout4f16");class ft extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,F,K,J,ee){const ie=this.length;return this.resize(ie+1),this.emplace(ie,e,F,K,J,ee)}emplace(e,F,K,J,ee,ie){const oe=6*e,le=3*e;return this.uint16[oe+0]=F,this.uint16[oe+1]=K,this.uint16[oe+2]=J,this.uint16[oe+3]=ee,this.float32[le+2]=ie,e}}ft.prototype.bytesPerElement=12,tr(ft,"StructArrayLayout4ui1f12");class St extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,F,K,J){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,F,K,J)}emplace(e,F,K,J,ee){const ie=4*e;return this.uint16[ie+0]=F,this.uint16[ie+1]=K,this.uint16[ie+2]=J,this.uint16[ie+3]=ee,e}}St.prototype.bytesPerElement=8,tr(St,"StructArrayLayout4ui8");class Ft extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,F,K,J,ee,ie){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,F,K,J,ee,ie)}emplace(e,F,K,J,ee,ie,oe){const le=6*e;return this.int16[le+0]=F,this.int16[le+1]=K,this.int16[le+2]=J,this.int16[le+3]=ee,this.int16[le+4]=ie,this.int16[le+5]=oe,e}}Ft.prototype.bytesPerElement=12,tr(Ft,"StructArrayLayout6i12");class Mt extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,F,K,J,ee,ie,oe,le,ce,pe,me,_e){const xe=this.length;return this.resize(xe+1),this.emplace(xe,e,F,K,J,ee,ie,oe,le,ce,pe,me,_e)}emplace(e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe){const we=12*e;return this.int16[we+0]=F,this.int16[we+1]=K,this.int16[we+2]=J,this.int16[we+3]=ee,this.uint16[we+4]=ie,this.uint16[we+5]=oe,this.uint16[we+6]=le,this.uint16[we+7]=ce,this.int16[we+8]=pe,this.int16[we+9]=me,this.int16[we+10]=_e,this.int16[we+11]=xe,e}}Mt.prototype.bytesPerElement=24,tr(Mt,"StructArrayLayout4i4ui4i24");class Ut extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,F,K,J,ee,ie){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,F,K,J,ee,ie)}emplace(e,F,K,J,ee,ie,oe){const le=10*e,ce=5*e;return this.int16[le+0]=F,this.int16[le+1]=K,this.int16[le+2]=J,this.float32[ce+2]=ee,this.float32[ce+3]=ie,this.float32[ce+4]=oe,e}}Ut.prototype.bytesPerElement=20,tr(Ut,"StructArrayLayout3i3f20");class lr extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const F=this.length;return this.resize(F+1),this.emplace(F,e)}emplace(e,F){return this.uint32[1*e+0]=F,e}}lr.prototype.bytesPerElement=4,tr(lr,"StructArrayLayout1ul4");class _r extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe){const we=this.length;return this.resize(we+1),this.emplace(we,e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe)}emplace(e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe,we){const Ae=20*e,Re=10*e;return this.int16[Ae+0]=F,this.int16[Ae+1]=K,this.int16[Ae+2]=J,this.int16[Ae+3]=ee,this.int16[Ae+4]=ie,this.float32[Re+3]=oe,this.float32[Re+4]=le,this.float32[Re+5]=ce,this.float32[Re+6]=pe,this.int16[Ae+14]=me,this.uint32[Re+8]=_e,this.uint16[Ae+18]=xe,this.uint16[Ae+19]=we,e}}_r.prototype.bytesPerElement=40,tr(_r,"StructArrayLayout5i4f1i1ul2ui40");class rr extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,F,K,J,ee,ie,oe){const le=this.length;return this.resize(le+1),this.emplace(le,e,F,K,J,ee,ie,oe)}emplace(e,F,K,J,ee,ie,oe,le){const ce=8*e;return this.int16[ce+0]=F,this.int16[ce+1]=K,this.int16[ce+2]=J,this.int16[ce+4]=ee,this.int16[ce+5]=ie,this.int16[ce+6]=oe,this.int16[ce+7]=le,e}}rr.prototype.bytesPerElement=16,tr(rr,"StructArrayLayout3i2i2i16");class fr extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,F,K,J,ee){const ie=this.length;return this.resize(ie+1),this.emplace(ie,e,F,K,J,ee)}emplace(e,F,K,J,ee,ie){const oe=4*e,le=8*e;return this.float32[oe+0]=F,this.float32[oe+1]=K,this.float32[oe+2]=J,this.int16[le+6]=ee,this.int16[le+7]=ie,e}}fr.prototype.bytesPerElement=16,tr(fr,"StructArrayLayout2f1f2i16");class Lr extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,F,K,J){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,F,K,J)}emplace(e,F,K,J,ee){const ie=12*e,oe=3*e;return this.uint8[ie+0]=F,this.uint8[ie+1]=K,this.float32[oe+1]=J,this.float32[oe+2]=ee,e}}Lr.prototype.bytesPerElement=12,tr(Lr,"StructArrayLayout2ub2f12");class Pr extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,F,K){const J=this.length;return this.resize(J+1),this.emplace(J,e,F,K)}emplace(e,F,K,J){const ee=3*e;return this.float32[ee+0]=F,this.float32[ee+1]=K,this.float32[ee+2]=J,e}}Pr.prototype.bytesPerElement=12,tr(Pr,"StructArrayLayout3f12");class or extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,F,K){const J=this.length;return this.resize(J+1),this.emplace(J,e,F,K)}emplace(e,F,K,J){const ee=3*e;return this.uint16[ee+0]=F,this.uint16[ee+1]=K,this.uint16[ee+2]=J,e}}or.prototype.bytesPerElement=6,tr(or,"StructArrayLayout3ui6");class Kr extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe,we,Ae,Re,ze,Ze,Ue,He,Ye){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe,we,Ae,Re,ze,Ze,Ue,He,Ye)}emplace(e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe,we,Ae,Re,ze,Ze,Ue,He,Ye,Xe){const dt=30*e,ut=15*e,Tt=60*e;return this.int16[dt+0]=F,this.int16[dt+1]=K,this.int16[dt+2]=J,this.float32[ut+2]=ee,this.float32[ut+3]=ie,this.uint16[dt+8]=oe,this.uint16[dt+9]=le,this.uint32[ut+5]=ce,this.uint32[ut+6]=pe,this.uint32[ut+7]=me,this.uint16[dt+16]=_e,this.uint16[dt+17]=xe,this.uint16[dt+18]=we,this.float32[ut+10]=Ae,this.float32[ut+11]=Re,this.uint8[Tt+48]=ze,this.uint8[Tt+49]=Ze,this.uint8[Tt+50]=Ue,this.uint32[ut+13]=He,this.int16[dt+28]=Ye,this.uint8[Tt+58]=Xe,e}}Kr.prototype.bytesPerElement=60,tr(Kr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Qr extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe,we,Ae,Re,ze,Ze,Ue,He,Ye,Xe,dt,ut,Tt,Nt,_t,Ct,Pt,Lt){const Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe,we,Ae,Re,ze,Ze,Ue,He,Ye,Xe,dt,ut,Tt,Nt,_t,Ct,Pt,Lt)}emplace(e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe,we,Ae,Re,ze,Ze,Ue,He,Ye,Xe,dt,ut,Tt,Nt,_t,Ct,Pt,Lt,Gt){const bt=38*e,Xt=19*e;return this.int16[bt+0]=F,this.int16[bt+1]=K,this.int16[bt+2]=J,this.float32[Xt+2]=ee,this.float32[Xt+3]=ie,this.int16[bt+8]=oe,this.int16[bt+9]=le,this.int16[bt+10]=ce,this.int16[bt+11]=pe,this.int16[bt+12]=me,this.int16[bt+13]=_e,this.uint16[bt+14]=xe,this.uint16[bt+15]=we,this.uint16[bt+16]=Ae,this.uint16[bt+17]=Re,this.uint16[bt+18]=ze,this.uint16[bt+19]=Ze,this.uint16[bt+20]=Ue,this.uint16[bt+21]=He,this.uint16[bt+22]=Ye,this.uint16[bt+23]=Xe,this.uint16[bt+24]=dt,this.uint16[bt+25]=ut,this.uint16[bt+26]=Tt,this.uint16[bt+27]=Nt,this.uint16[bt+28]=_t,this.uint32[Xt+15]=Ct,this.float32[Xt+16]=Pt,this.float32[Xt+17]=Lt,this.float32[Xt+18]=Gt,e}}Qr.prototype.bytesPerElement=76,tr(Qr,"StructArrayLayout3i2f6i15ui1ul3f76");class ei extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const F=this.length;return this.resize(F+1),this.emplace(F,e)}emplace(e,F){return this.float32[1*e+0]=F,e}}ei.prototype.bytesPerElement=4,tr(ei,"StructArrayLayout1f4");class ti extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,F,K,J,ee){const ie=this.length;return this.resize(ie+1),this.emplace(ie,e,F,K,J,ee)}emplace(e,F,K,J,ee,ie){const oe=5*e;return this.float32[oe+0]=F,this.float32[oe+1]=K,this.float32[oe+2]=J,this.float32[oe+3]=ee,this.float32[oe+4]=ie,e}}ti.prototype.bytesPerElement=20,tr(ti,"StructArrayLayout5f20");class nn extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,F,K,J){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,F,K,J)}emplace(e,F,K,J,ee){const ie=6*e;return this.uint32[3*e+0]=F,this.uint16[ie+2]=K,this.uint16[ie+3]=J,this.uint16[ie+4]=ee,e}}nn.prototype.bytesPerElement=12,tr(nn,"StructArrayLayout1ul3ui12");class Vi extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,F){const K=this.length;return this.resize(K+1),this.emplace(K,e,F)}emplace(e,F,K){const J=2*e;return this.uint16[J+0]=F,this.uint16[J+1]=K,e}}Vi.prototype.bytesPerElement=4,tr(Vi,"StructArrayLayout2ui4");class An extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const F=this.length;return this.resize(F+1),this.emplace(F,e)}emplace(e,F){return this.uint16[1*e+0]=F,e}}An.prototype.bytesPerElement=2,tr(An,"StructArrayLayout1ui2");class Kn extends at{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,F){const K=this.length;return this.resize(K+1),this.emplace(K,e,F)}emplace(e,F,K){const J=2*e;return this.float32[J+0]=F,this.float32[J+1]=K,e}}Kn.prototype.bytesPerElement=8,tr(Kn,"StructArrayLayout2f8");class _i extends et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}_i.prototype.size=40;class ri extends _r{get(e){return new _i(this,e)}}tr(ri,"CollisionBoxArray");class Vr extends et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Vr.prototype.size=60;class Ci extends Kr{get(e){return new Vr(this,e)}}tr(Ci,"PlacedSymbolArray");class cn extends et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}cn.prototype.size=76;class mi extends Qr{get(e){return new cn(this,e)}}tr(mi,"SymbolInstanceArray");class pn extends ei{getoffsetX(e){return this.float32[1*e+0]}}tr(pn,"GlyphOffsetArray");class Hs extends kt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}tr(Hs,"SymbolLineVertexArray");class jo extends et{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}jo.prototype.size=12;class ts extends nn{get(e){return new jo(this,e)}}tr(ts,"FeatureIndexArray");class uo extends Vi{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}tr(uo,"FillExtrusionCentroidArray");const wo=nt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Vo=nt([{name:"a_dash",components:4,type:"Uint16"}]);var Ks={exports:{}},rs={exports:{}};rs.exports=function(t,e){var F,K,J,ee,ie,oe,le,ce;for(K=t.length-(F=3&t.length),J=e,ie=3432918353,oe=461845907,ce=0;ce<K;)le=255&t.charCodeAt(ce)|(255&t.charCodeAt(++ce))<<8|(255&t.charCodeAt(++ce))<<16|(255&t.charCodeAt(++ce))<<24,++ce,J=27492+(65535&(ee=5*(65535&(J=(J^=le=(65535&(le=(le=(65535&le)*ie+(((le>>>16)*ie&65535)<<16)&4294967295)<<15|le>>>17))*oe+(((le>>>16)*oe&65535)<<16)&4294967295)<<13|J>>>19))+((5*(J>>>16)&65535)<<16)&4294967295))+((58964+(ee>>>16)&65535)<<16);switch(le=0,F){case 3:le^=(255&t.charCodeAt(ce+2))<<16;case 2:le^=(255&t.charCodeAt(ce+1))<<8;case 1:J^=le=(65535&(le=(le=(65535&(le^=255&t.charCodeAt(ce)))*ie+(((le>>>16)*ie&65535)<<16)&4294967295)<<15|le>>>17))*oe+(((le>>>16)*oe&65535)<<16)&4294967295}return J^=t.length,J=2246822507*(65535&(J^=J>>>16))+((2246822507*(J>>>16)&65535)<<16)&4294967295,J=3266489909*(65535&(J^=J>>>13))+((3266489909*(J>>>16)&65535)<<16)&4294967295,(J^=J>>>16)>>>0};var hc=rs.exports,Jf={exports:{}};Jf.exports=function(t,e){for(var F,K=t.length,J=e^K,ee=0;K>=4;)F=1540483477*(65535&(F=255&t.charCodeAt(ee)|(255&t.charCodeAt(++ee))<<8|(255&t.charCodeAt(++ee))<<16|(255&t.charCodeAt(++ee))<<24))+((1540483477*(F>>>16)&65535)<<16),J=1540483477*(65535&J)+((1540483477*(J>>>16)&65535)<<16)^(F=1540483477*(65535&(F^=F>>>24))+((1540483477*(F>>>16)&65535)<<16)),K-=4,++ee;switch(K){case 3:J^=(255&t.charCodeAt(ee+2))<<16;case 2:J^=(255&t.charCodeAt(ee+1))<<8;case 1:J=1540483477*(65535&(J^=255&t.charCodeAt(ee)))+((1540483477*(J>>>16)&65535)<<16)}return J=1540483477*(65535&(J^=J>>>13))+((1540483477*(J>>>16)&65535)<<16),(J^=J>>>15)>>>0};var Qf=hc,Pm=Jf.exports;Ks.exports=Qf,Ks.exports.murmur3=Qf,Ks.exports.murmur2=Pm;var Uh=sr(Ks.exports);class Du{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,F,K,J){this.ids.push(ep(e)),this.positions.push(F,K,J)}getPositions(e){const F=ep(e);let K=0,J=this.ids.length-1;for(;K<J;){const ie=K+J>>1;this.ids[ie]>=F?J=ie:K=ie+1}const ee=[];for(;this.ids[K]===F;)ee.push({index:this.positions[3*K],start:this.positions[3*K+1],end:this.positions[3*K+2]}),K++;return ee}static serialize(e,F){const K=new Float64Array(e.ids),J=new Uint32Array(e.positions);return jh(K,J,0,K.length-1),F&&F.push(K.buffer,J.buffer),{ids:K,positions:J}}static deserialize(e){const F=new Du;return F.ids=e.ids,F.positions=e.positions,F.indexed=!0,F}}function ep(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Uh(String(t))}function jh(t,e,F,K){for(;F<K;){const J=t[F+K>>1];let ee=F-1,ie=K+1;for(;;){do ee++;while(t[ee]<J);do ie--;while(t[ie]>J);if(ee>=ie)break;Lu(t,ee,ie),Lu(e,3*ee,3*ie),Lu(e,3*ee+1,3*ie+1),Lu(e,3*ee+2,3*ie+2)}ie-F<K-ie?(jh(t,e,F,ie),F=ie+1):(jh(t,e,ie+1,K),K=ie)}}function Lu(t,e,F){const K=t[e];t[e]=t[F],t[F]=K}tr(Du,"FeaturePositionMap");class Go{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,F){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,F),this.initialized=!0),!!this.location}}class Bu extends Go{constructor(e){super(e),this.current=0}set(e,F,K){this.fetchUniformLocation(e,F)&&this.current!==K&&(this.current=K,this.gl.uniform1f(this.location,K))}}class tp extends Go{constructor(e){super(e),this.current=[0,0,0,0]}set(e,F,K){this.fetchUniformLocation(e,F)&&(K[0]===this.current[0]&&K[1]===this.current[1]&&K[2]===this.current[2]&&K[3]===this.current[3]||(this.current=K,this.gl.uniform4f(this.location,K[0],K[1],K[2],K[3])))}}class rp extends Go{constructor(e){super(e),this.current=Si.transparent}set(e,F,K){this.fetchUniformLocation(e,F)&&(K.r===this.current.r&&K.g===this.current.g&&K.b===this.current.b&&K.a===this.current.a||(this.current=K,this.gl.uniform4f(this.location,K.r,K.g,K.b,K.a)))}}const Rm=new Float32Array(16),Mm=new Float32Array(9),Dm=new Float32Array(4);function Vh(t){return[Qe(255*t.r,255*t.g),Qe(255*t.b,255*t.a)]}class fc{constructor(e,F,K){this.value=e,this.uniformNames=F.map(J=>`u_${J}`),this.type=K}setUniform(e,F,K,J,ee){F.set(e,ee,J.constantOr(this.value))}getBinding(e,F){return this.type==="color"?new rp(e):new Bu(e)}}class Zs{constructor(e,F){this.uniformNames=F.map(K=>`u_${K}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,F,K,J,ee){const ie=ee==="u_pattern"||ee==="u_dash"?this.pattern:ee==="u_pixel_ratio"?this.pixelRatio:null;ie&&F.set(e,ee,ie)}getBinding(e,F){return F==="u_pattern"||F==="u_dash"?new tp(e):new Bu(e)}}class Wo{constructor(e,F,K,J){this.expression=e,this.type=K,this.maxValue=0,this.paintVertexAttributes=F.map(ee=>({name:`a_${ee}`,type:"Float32",components:K==="color"?2:1,offset:0})),this.paintVertexArray=new J}populatePaintArray(e,F,K,J,ee,ie){const oe=this.paintVertexArray.length,le=this.expression.evaluate(new de(0),F,{},ee,J,ie);this.paintVertexArray.resize(e),this._setPaintValue(oe,e,le)}updatePaintArray(e,F,K,J,ee){const ie=this.expression.evaluate({zoom:0},K,J,void 0,ee);this._setPaintValue(e,F,ie)}_setPaintValue(e,F,K){if(this.type==="color"){const J=Vh(K);for(let ee=e;ee<F;ee++)this.paintVertexArray.emplace(ee,J[0],J[1])}else{for(let J=e;J<F;J++)this.paintVertexArray.emplace(J,K);this.maxValue=Math.max(this.maxValue,Math.abs(K))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ho{constructor(e,F,K,J,ee,ie){this.expression=e,this.uniformNames=F.map(oe=>`u_${oe}_t`),this.type=K,this.useIntegerZoom=J,this.zoom=ee,this.maxValue=0,this.paintVertexAttributes=F.map(oe=>({name:`a_${oe}`,type:"Float32",components:K==="color"?4:2,offset:0})),this.paintVertexArray=new ie}populatePaintArray(e,F,K,J,ee,ie){const oe=this.expression.evaluate(new de(this.zoom),F,{},ee,J,ie),le=this.expression.evaluate(new de(this.zoom+1),F,{},ee,J,ie),ce=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(ce,e,oe,le)}updatePaintArray(e,F,K,J,ee){const ie=this.expression.evaluate({zoom:this.zoom},K,J,void 0,ee),oe=this.expression.evaluate({zoom:this.zoom+1},K,J,void 0,ee);this._setPaintValue(e,F,ie,oe)}_setPaintValue(e,F,K,J){if(this.type==="color"){const ee=Vh(K),ie=Vh(J);for(let oe=e;oe<F;oe++)this.paintVertexArray.emplace(oe,ee[0],ee[1],ie[0],ie[1])}else{for(let ee=e;ee<F;ee++)this.paintVertexArray.emplace(ee,K,J);this.maxValue=Math.max(this.maxValue,Math.abs(K),Math.abs(J))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,F,K,J,ee){const ie=this.useIntegerZoom?Math.floor(K.zoom):K.zoom,oe=ht(this.expression.interpolationFactor(ie,this.zoom,this.zoom+1),0,1);F.set(e,ee,oe)}getBinding(e,F){return new Bu(e)}}class ga{constructor(e,F,K,J,ee){this.expression=e,this.layerId=ee,this.paintVertexAttributes=(K==="array"?Vo:wo).members;for(let ie=0;ie<F.length;++ie);this.paintVertexArray=new J}populatePaintArray(e,F,K){const J=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(J,e,F.patterns&&F.patterns[this.layerId],K)}updatePaintArray(e,F,K,J,ee,ie){this._setPaintValues(e,F,K.patterns&&K.patterns[this.layerId],ie)}_setPaintValues(e,F,K,J){if(!J||!K)return;const ee=J[K];if(!ee)return;const{tl:ie,br:oe,pixelRatio:le}=ee;for(let ce=e;ce<F;ce++)this.paintVertexArray.emplace(ce,ie[0],ie[1],oe[0],oe[1],le)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class va{constructor(e,F,K=()=>!0){this.binders={},this._buffers=[];const J=[];for(const ee in e.paint._values){if(!K(ee))continue;const ie=e.paint.get(ee);if(!(ie instanceof Be&&ua(ie.property.specification)))continue;const oe=Bm(ee,e.type),le=ie.value,ce=ie.property.specification.type,pe=!!ie.property.useIntegerZoom,me=ee==="line-dasharray"||ee.endsWith("pattern"),_e=ee==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(le.kind!=="constant"||_e)if(le.kind==="source"||_e||me){const xe=ip(ee,ce,"source");this.binders[ee]=me?new ga(le,oe,ce,xe,e.id):new Wo(le,oe,ce,xe),J.push(`/a_${ee}`)}else{const xe=ip(ee,ce,"composite");this.binders[ee]=new ho(le,oe,ce,pe,F,xe),J.push(`/z_${ee}`)}else this.binders[ee]=me?new Zs(le.value,oe):new fc(le.value,oe,ce),J.push(`/u_${ee}`)}this.cacheKey=J.sort().join("")}getMaxValue(e){const F=this.binders[e];return F instanceof Wo||F instanceof ho?F.maxValue:0}populatePaintArrays(e,F,K,J,ee,ie){for(const oe in this.binders){const le=this.binders[oe];(le instanceof Wo||le instanceof ho||le instanceof ga)&&le.populatePaintArray(e,F,K,J,ee,ie)}}setConstantPatternPositions(e){for(const F in this.binders){const K=this.binders[F];K instanceof Zs&&K.setConstantPatternPositions(e)}}updatePaintArrays(e,F,K,J,ee,ie){let oe=!1;for(const le in e){const ce=F.getPositions(le);for(const pe of ce){const me=K.feature(pe.index);for(const _e in this.binders){const xe=this.binders[_e];if((xe instanceof Wo||xe instanceof ho||xe instanceof ga)&&xe.expression.isStateDependent===!0){const we=J.paint.get(_e);xe.expression=we.value,xe.updatePaintArray(pe.start,pe.end,me,e[le],ee,ie),oe=!0}}}}return oe}defines(){const e=[];for(const F in this.binders){const K=this.binders[F];(K instanceof fc||K instanceof Zs)&&e.push(...K.uniformNames.map(J=>`#define HAS_UNIFORM_${J}`))}return e}getBinderAttributes(){const e=[];for(const F in this.binders){const K=this.binders[F];if(K instanceof Wo||K instanceof ho||K instanceof ga)for(let J=0;J<K.paintVertexAttributes.length;J++)e.push(K.paintVertexAttributes[J].name)}return e}getBinderUniforms(){const e=[];for(const F in this.binders){const K=this.binders[F];if(K instanceof fc||K instanceof Zs||K instanceof ho)for(const J of K.uniformNames)e.push(J)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const F=[];for(const K in this.binders){const J=this.binders[K];if(J instanceof fc||J instanceof Zs||J instanceof ho)for(const ee of J.uniformNames)F.push({name:ee,property:K,binding:J.getBinding(e,ee)})}return F}setUniforms(e,F,K,J,ee){for(const{name:ie,property:oe,binding:le}of K)this.binders[oe].setUniform(e,le,ee,J.get(oe),ie)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const F=this.binders[e];(F instanceof Wo||F instanceof ho||F instanceof ga)&&F.paintVertexBuffer&&this._buffers.push(F.paintVertexBuffer)}}upload(e){for(const F in this.binders){const K=this.binders[F];(K instanceof Wo||K instanceof ho||K instanceof ga)&&K.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const F=this.binders[e];(F instanceof Wo||F instanceof ho||F instanceof ga)&&F.destroy()}}}class ns{constructor(e,F,K=()=>!0){this.programConfigurations={};for(const J of e)this.programConfigurations[J.id]=new va(J,F,K);this.needsUpload=!1,this._featureMap=new Du,this._bufferOffset=0}populatePaintArrays(e,F,K,J,ee,ie,oe){for(const le in this.programConfigurations)this.programConfigurations[le].populatePaintArrays(e,F,J,ee,ie,oe);F.id!==void 0&&this._featureMap.add(F.id,K,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,F,K,J,ee){for(const ie of K)this.needsUpload=this.programConfigurations[ie.id].updatePaintArrays(e,this._featureMap,F,ie,J,ee)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const F in this.programConfigurations)this.programConfigurations[F].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Lm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Bm(t,e){return Lm[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const km={"line-pattern":{source:ft,composite:ft},"fill-pattern":{source:ft,composite:ft},"fill-extrusion-pattern":{source:ft,composite:ft},"line-dasharray":{source:St,composite:St}},Nm={color:{source:Kn,composite:Bt},number:{source:ei,composite:Kn}};function ip(t,e,F){const K=km[t];return K&&K[F]||Nm[e][F]}tr(fc,"ConstantBinder"),tr(Zs,"PatternConstantBinder"),tr(Wo,"SourceExpressionBinder"),tr(ga,"PatternCompositeBinder"),tr(ho,"CompositeExpressionBinder"),tr(va,"ProgramConfiguration",{omit:["_buffers"]}),tr(ns,"ProgramConfigurationSet");const np="-transition";class fo extends Ca{constructor(e,F){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),F.layout&&(this._unevaluatedLayout=new ke(F.layout)),F.paint)){this._transitionablePaint=new Te(F.paint);for(const K in e.paint)this.setPaintProperty(K,e.paint[K],{validate:!1});for(const K in e.layout)this.setLayoutProperty(K,e.layout[K],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ne(F.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,F,K={}){F!=null&&this._validate(Bh,`layers.${this.id}.layout.${e}`,e,F,K)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,F):this.visibility=F)}getPaintProperty(e){return Ji(e,np)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,F,K={}){if(F!=null&&this._validate(Lh,`layers.${this.id}.paint.${e}`,e,F,K))return!1;if(Ji(e,np))return this._transitionablePaint.setTransition(e.slice(0,-11),F||void 0),!1;{const J=this._transitionablePaint._values[e],ee=J.value.isDataDriven(),ie=J.value;this._transitionablePaint.setValue(e,F),this._handleSpecialPaintPropertyUpdate(e);const oe=this._transitionablePaint._values[e].value,le=oe.isDataDriven(),ce=Ji(e,"pattern")||e==="line-dasharray";return le||ee||ce||this._handleOverridablePaintPropertyUpdate(e,ie,oe)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,F,K){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,F){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,F)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,F)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),vn(e,(F,K)=>!(F===void 0||K==="layout"&&!Object.keys(F).length||K==="paint"&&!Object.keys(F).length))}_validate(e,F,K,J,ee={}){return(!ee||ee.validate!==!1)&&Cu(this,e.call(Ou,{key:F,layerType:this.type,objectKey:K,value:J,styleSpec:Et,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const F=this.paint.get(e);if(F instanceof Be&&ua(F.property.specification)&&(F.value.kind==="source"||F.value.kind==="composite")&&F.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Vs(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Fm=nt([{name:"a_pos",components:2,type:"Int16"}],4),zm=nt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Pi{constructor(e=[]){this.segments=e}prepareSegment(e,F,K,J){let ee=this.segments[this.segments.length-1];return e>Pi.MAX_VERTEX_ARRAY_LENGTH&&di(`Max vertices per segment is ${Pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!ee||ee.vertexLength+e>Pi.MAX_VERTEX_ARRAY_LENGTH||ee.sortKey!==J)&&(ee={vertexOffset:F.length,primitiveOffset:K.length,vertexLength:0,primitiveLength:0},J!==void 0&&(ee.sortKey=J),this.segments.push(ee)),ee}get(){return this.segments}destroy(){for(const e of this.segments)for(const F in e.vaos)e.vaos[F].destroy()}static simpleSegment(e,F,K,J){return new Pi([{vertexOffset:e,primitiveOffset:F,vertexLength:K,primitiveLength:J,vaos:{},sortKey:0}])}}Pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tr(Pi,"SegmentVector");var ur=8192;class $a{constructor(e,F){e&&(F?this.setSouthWest(e).setNorthEast(F):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ii?new ii(e.lng,e.lat):ii.convert(e),this}setSouthWest(e){return this._sw=e instanceof ii?new ii(e.lng,e.lat):ii.convert(e),this}extend(e){const F=this._sw,K=this._ne;let J,ee;if(e instanceof ii)J=e,ee=e;else{if(!(e instanceof $a))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend($a.convert(e)):this.extend(ii.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ii.convert(e)):this;if(J=e._sw,ee=e._ne,!J||!ee)return this}return F||K?(F.lng=Math.min(J.lng,F.lng),F.lat=Math.min(J.lat,F.lat),K.lng=Math.max(ee.lng,K.lng),K.lat=Math.max(ee.lat,K.lat)):(this._sw=new ii(J.lng,J.lat),this._ne=new ii(ee.lng,ee.lat)),this}getCenter(){return new ii((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ii(this.getWest(),this.getNorth())}getSouthEast(){return new ii(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:F,lat:K}=ii.convert(e);let J=this._sw.lng<=F&&F<=this._ne.lng;return this._sw.lng>this._ne.lng&&(J=this._sw.lng>=F&&F>=this._ne.lng),this._sw.lat<=K&&K<=this._ne.lat&&J}static convert(e){return!e||e instanceof $a?e:new $a(e)}}var ku=1e-6,On=typeof Float32Array<"u"?Float32Array:Array;function op(){var t=new On(9);return On!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ap(t,e,F){var K=e[0],J=e[1],ee=e[2],ie=e[3],oe=e[4],le=e[5],ce=e[6],pe=e[7],me=e[8],_e=F[0],xe=F[1],we=F[2],Ae=F[3],Re=F[4],ze=F[5],Ze=F[6],Ue=F[7],He=F[8];return t[0]=_e*K+xe*ie+we*ce,t[1]=_e*J+xe*oe+we*pe,t[2]=_e*ee+xe*le+we*me,t[3]=Ae*K+Re*ie+ze*ce,t[4]=Ae*J+Re*oe+ze*pe,t[5]=Ae*ee+Re*le+ze*me,t[6]=Ze*K+Ue*ie+He*ce,t[7]=Ze*J+Ue*oe+He*pe,t[8]=Ze*ee+Ue*le+He*me,t}function po(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Gh(t,e){var F=e[0],K=e[1],J=e[2],ee=e[3],ie=e[4],oe=e[5],le=e[6],ce=e[7],pe=e[8],me=e[9],_e=e[10],xe=e[11],we=e[12],Ae=e[13],Re=e[14],ze=e[15],Ze=F*oe-K*ie,Ue=F*le-J*ie,He=F*ce-ee*ie,Ye=K*le-J*oe,Xe=K*ce-ee*oe,dt=J*ce-ee*le,ut=pe*Ae-me*we,Tt=pe*Re-_e*we,Nt=pe*ze-xe*we,_t=me*Re-_e*Ae,Ct=me*ze-xe*Ae,Pt=_e*ze-xe*Re,Lt=Ze*Pt-Ue*Ct+He*_t+Ye*Nt-Xe*Tt+dt*ut;return Lt?(t[0]=(oe*Pt-le*Ct+ce*_t)*(Lt=1/Lt),t[1]=(J*Ct-K*Pt-ee*_t)*Lt,t[2]=(Ae*dt-Re*Xe+ze*Ye)*Lt,t[3]=(_e*Xe-me*dt-xe*Ye)*Lt,t[4]=(le*Nt-ie*Pt-ce*Tt)*Lt,t[5]=(F*Pt-J*Nt+ee*Tt)*Lt,t[6]=(Re*He-we*dt-ze*Ue)*Lt,t[7]=(pe*dt-_e*He+xe*Ue)*Lt,t[8]=(ie*Ct-oe*Nt+ce*ut)*Lt,t[9]=(K*Nt-F*Ct-ee*ut)*Lt,t[10]=(we*Xe-Ae*He+ze*Ze)*Lt,t[11]=(me*He-pe*Xe-xe*Ze)*Lt,t[12]=(oe*Tt-ie*_t-le*ut)*Lt,t[13]=(F*_t-K*Tt+J*ut)*Lt,t[14]=(Ae*Ue-we*Ye-Re*Ze)*Lt,t[15]=(pe*Ye-me*Ue+_e*Ze)*Lt,t):null}function os(t,e,F){var K=e[0],J=e[1],ee=e[2],ie=e[3],oe=e[4],le=e[5],ce=e[6],pe=e[7],me=e[8],_e=e[9],xe=e[10],we=e[11],Ae=e[12],Re=e[13],ze=e[14],Ze=e[15],Ue=F[0],He=F[1],Ye=F[2],Xe=F[3];return t[0]=Ue*K+He*oe+Ye*me+Xe*Ae,t[1]=Ue*J+He*le+Ye*_e+Xe*Re,t[2]=Ue*ee+He*ce+Ye*xe+Xe*ze,t[3]=Ue*ie+He*pe+Ye*we+Xe*Ze,t[4]=(Ue=F[4])*K+(He=F[5])*oe+(Ye=F[6])*me+(Xe=F[7])*Ae,t[5]=Ue*J+He*le+Ye*_e+Xe*Re,t[6]=Ue*ee+He*ce+Ye*xe+Xe*ze,t[7]=Ue*ie+He*pe+Ye*we+Xe*Ze,t[8]=(Ue=F[8])*K+(He=F[9])*oe+(Ye=F[10])*me+(Xe=F[11])*Ae,t[9]=Ue*J+He*le+Ye*_e+Xe*Re,t[10]=Ue*ee+He*ce+Ye*xe+Xe*ze,t[11]=Ue*ie+He*pe+Ye*we+Xe*Ze,t[12]=(Ue=F[12])*K+(He=F[13])*oe+(Ye=F[14])*me+(Xe=F[15])*Ae,t[13]=Ue*J+He*le+Ye*_e+Xe*Re,t[14]=Ue*ee+He*ce+Ye*xe+Xe*ze,t[15]=Ue*ie+He*pe+Ye*we+Xe*Ze,t}function pc(t,e,F){var K,J,ee,ie,oe,le,ce,pe,me,_e,xe,we,Ae=F[0],Re=F[1],ze=F[2];return e===t?(t[12]=e[0]*Ae+e[4]*Re+e[8]*ze+e[12],t[13]=e[1]*Ae+e[5]*Re+e[9]*ze+e[13],t[14]=e[2]*Ae+e[6]*Re+e[10]*ze+e[14],t[15]=e[3]*Ae+e[7]*Re+e[11]*ze+e[15]):(J=e[1],ee=e[2],ie=e[3],oe=e[4],le=e[5],ce=e[6],pe=e[7],me=e[8],_e=e[9],xe=e[10],we=e[11],t[0]=K=e[0],t[1]=J,t[2]=ee,t[3]=ie,t[4]=oe,t[5]=le,t[6]=ce,t[7]=pe,t[8]=me,t[9]=_e,t[10]=xe,t[11]=we,t[12]=K*Ae+oe*Re+me*ze+e[12],t[13]=J*Ae+le*Re+_e*ze+e[13],t[14]=ee*Ae+ce*Re+xe*ze+e[14],t[15]=ie*Ae+pe*Re+we*ze+e[15]),t}function as(t,e,F){var K=F[0],J=F[1],ee=F[2];return t[0]=e[0]*K,t[1]=e[1]*K,t[2]=e[2]*K,t[3]=e[3]*K,t[4]=e[4]*J,t[5]=e[5]*J,t[6]=e[6]*J,t[7]=e[7]*J,t[8]=e[8]*ee,t[9]=e[9]*ee,t[10]=e[10]*ee,t[11]=e[11]*ee,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Wh(t,e,F){var K=Math.sin(F),J=Math.cos(F),ee=e[4],ie=e[5],oe=e[6],le=e[7],ce=e[8],pe=e[9],me=e[10],_e=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=ee*J+ce*K,t[5]=ie*J+pe*K,t[6]=oe*J+me*K,t[7]=le*J+_e*K,t[8]=ce*J-ee*K,t[9]=pe*J-ie*K,t[10]=me*J-oe*K,t[11]=_e*J-le*K,t}function Nu(t,e,F){var K=Math.sin(F),J=Math.cos(F),ee=e[0],ie=e[1],oe=e[2],le=e[3],ce=e[8],pe=e[9],me=e[10],_e=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=ee*J-ce*K,t[1]=ie*J-pe*K,t[2]=oe*J-me*K,t[3]=le*J-_e*K,t[8]=ee*K+ce*J,t[9]=ie*K+pe*J,t[10]=oe*K+me*J,t[11]=le*K+_e*J,t}function sp(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lp(t,e,F){var K,J,ee,ie=F[0],oe=F[1],le=F[2],ce=Math.hypot(ie,oe,le);return ce<ku?null:(ie*=ce=1/ce,oe*=ce,le*=ce,K=Math.sin(e),J=Math.cos(e),t[0]=ie*ie*(ee=1-J)+J,t[1]=oe*ie*ee+le*K,t[2]=le*ie*ee-oe*K,t[3]=0,t[4]=ie*oe*ee-le*K,t[5]=oe*oe*ee+J,t[6]=le*oe*ee+ie*K,t[7]=0,t[8]=ie*le*ee+oe*K,t[9]=oe*le*ee-ie*K,t[10]=le*le*ee+J,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Um=os;function qh(){var t=new On(3);return On!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function cp(t){var e=new On(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function dc(t){return Math.hypot(t[0],t[1],t[2])}function Xs(t,e,F){var K=new On(3);return K[0]=t,K[1]=e,K[2]=F,K}function qo(t,e,F){return t[0]=e[0]+F[0],t[1]=e[1]+F[1],t[2]=e[2]+F[2],t}function Hh(t,e,F){return t[0]=e[0]-F[0],t[1]=e[1]-F[1],t[2]=e[2]-F[2],t}function up(t,e,F){return t[0]=e[0]*F[0],t[1]=e[1]*F[1],t[2]=e[2]*F[2],t}function mc(t,e,F){return t[0]=Math.min(e[0],F[0]),t[1]=Math.min(e[1],F[1]),t[2]=Math.min(e[2],F[2]),t}function yc(t,e,F){return t[0]=Math.max(e[0],F[0]),t[1]=Math.max(e[1],F[1]),t[2]=Math.max(e[2],F[2]),t}function kn(t,e,F){return t[0]=e[0]*F,t[1]=e[1]*F,t[2]=e[2]*F,t}function _c(t,e,F,K){return t[0]=e[0]+F[0]*K,t[1]=e[1]+F[1]*K,t[2]=e[2]+F[2]*K,t}function dn(t,e){var F=e[0],K=e[1],J=e[2],ee=F*F+K*K+J*J;return ee>0&&(ee=1/Math.sqrt(ee)),t[0]=e[0]*ee,t[1]=e[1]*ee,t[2]=e[2]*ee,t}function Zn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Kh(t,e,F){var K=e[0],J=e[1],ee=e[2],ie=F[0],oe=F[1],le=F[2];return t[0]=J*le-ee*oe,t[1]=ee*ie-K*le,t[2]=K*oe-J*ie,t}function Ii(t,e,F){var K=e[0],J=e[1],ee=e[2],ie=F[3]*K+F[7]*J+F[11]*ee+F[15];return t[0]=(F[0]*K+F[4]*J+F[8]*ee+F[12])/(ie=ie||1),t[1]=(F[1]*K+F[5]*J+F[9]*ee+F[13])/ie,t[2]=(F[2]*K+F[6]*J+F[10]*ee+F[14])/ie,t}function hp(t,e,F){var K=F[0],J=F[1],ee=F[2],ie=e[0],oe=e[1],le=e[2],ce=J*le-ee*oe,pe=ee*ie-K*le,me=K*oe-J*ie,_e=J*me-ee*pe,xe=ee*ce-K*me,we=K*pe-J*ce,Ae=2*F[3];return pe*=Ae,me*=Ae,xe*=2,we*=2,t[0]=ie+(ce*=Ae)+(_e*=2),t[1]=oe+pe+xe,t[2]=le+me+we,t}var gc,mo=Hh,jm=up,Vm=dc;function fp(t,e,F){return t[0]=e[0]*F,t[1]=e[1]*F,t[2]=e[2]*F,t[3]=e[3]*F,t}function pp(t,e){var F=e[0],K=e[1],J=e[2],ee=e[3],ie=F*F+K*K+J*J+ee*ee;return ie>0&&(ie=1/Math.sqrt(ie)),t[0]=F*ie,t[1]=K*ie,t[2]=J*ie,t[3]=ee*ie,t}function ss(t,e,F){var K=e[0],J=e[1],ee=e[2],ie=e[3];return t[0]=F[0]*K+F[4]*J+F[8]*ee+F[12]*ie,t[1]=F[1]*K+F[5]*J+F[9]*ee+F[13]*ie,t[2]=F[2]*K+F[6]*J+F[10]*ee+F[14]*ie,t[3]=F[3]*K+F[7]*J+F[11]*ee+F[15]*ie,t}function dp(){var t=new On(4);return On!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function mp(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function yp(t,e,F){F*=.5;var K=e[0],J=e[1],ee=e[2],ie=e[3],oe=Math.sin(F),le=Math.cos(F);return t[0]=K*le+ie*oe,t[1]=J*le+ee*oe,t[2]=ee*le-J*oe,t[3]=ie*le-K*oe,t}function _p(t,e,F){F*=.5;var K=e[0],J=e[1],ee=e[2],ie=e[3],oe=Math.sin(F),le=Math.cos(F);return t[0]=K*le-ee*oe,t[1]=J*le+ie*oe,t[2]=ee*le+K*oe,t[3]=ie*le-J*oe,t}qh(),gc=new On(4),On!=Float32Array&&(gc[0]=0,gc[1]=0,gc[2]=0,gc[3]=0);var Gm=pp;qh(),Xs(1,0,0),Xs(0,1,0),dp(),dp(),op();const Wm=nt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:gp}=Wm,vp=nt([{name:"a_pos_3",components:3,type:"Int16"}]);var vc=nt([{name:"a_pos",type:"Int16",components:2}]);class Zh{constructor(e,F){this.pos=e,this.dir=F}intersectsPlane(e,F,K){const J=Zn(F,this.dir);if(Math.abs(J)<1e-6)return!1;const ee=((e[0]-this.pos[0])*F[0]+(e[1]-this.pos[1])*F[1]+(e[2]-this.pos[2])*F[2])/J;return K[0]=this.pos[0]+this.dir[0]*ee,K[1]=this.pos[1]+this.dir[1]*ee,K[2]=this.pos[2]+this.dir[2]*ee,!0}closestPointOnSphere(e,F,K){if(function(xe,we){var Ae=xe[0],Re=xe[1],ze=xe[2],Ze=we[0],Ue=we[1],He=we[2];return Math.abs(Ae-Ze)<=ku*Math.max(1,Math.abs(Ae),Math.abs(Ze))&&Math.abs(Re-Ue)<=ku*Math.max(1,Math.abs(Re),Math.abs(Ue))&&Math.abs(ze-He)<=ku*Math.max(1,Math.abs(ze),Math.abs(He))}(this.pos,e)||F===0)return K[0]=K[1]=K[2]=0,!1;const[J,ee,ie]=this.dir,oe=this.pos[0]-e[0],le=this.pos[1]-e[1],ce=this.pos[2]-e[2],pe=J*J+ee*ee+ie*ie,me=2*(oe*J+le*ee+ce*ie),_e=me*me-4*pe*(oe*oe+le*le+ce*ce-F*F);if(_e<0){const xe=Math.max(-me/2,0),we=oe+J*xe,Ae=le+ee*xe,Re=ce+ie*xe,ze=Math.hypot(we,Ae,Re);return K[0]=we*F/ze,K[1]=Ae*F/ze,K[2]=Re*F/ze,!1}{const xe=(-me-Math.sqrt(_e))/(2*pe);if(xe<0){const we=Math.hypot(oe,le,ce);return K[0]=oe*F/we,K[1]=le*F/we,K[2]=ce*F/we,!1}return K[0]=oe+J*xe,K[1]=le+ee*xe,K[2]=ce+ie*xe,!0}}}class Xh{constructor(e,F,K,J,ee){this.TL=e,this.TR=F,this.BR=K,this.BL=J,this.horizon=ee}static fromInvProjectionMatrix(e,F,K){const J=[-1,1,1],ee=[1,1,1],ie=[1,-1,1],oe=[-1,-1,1],le=Ii(J,J,e),ce=Ii(ee,ee,e),pe=Ii(ie,ie,e),me=Ii(oe,oe,e);return new Xh(le,ce,pe,me,F/K)}}class Yh{constructor(e,F){this.points=e,this.planes=F}static fromInvProjectionMatrix(e,F,K,J){const ee=Math.pow(2,K),ie=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(le=>{const ce=ss([],le,e),pe=1/ce[3]/F*ee;return function(me,_e,xe){return me[0]=_e[0]*xe[0],me[1]=_e[1]*xe[1],me[2]=_e[2]*xe[2],me[3]=_e[3]*xe[3],me}(ce,ce,[pe,pe,J?1/ce[3]:pe,pe])}),oe=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(le=>{const ce=dn([],Kh([],mo([],ie[le[0]],ie[le[1]]),mo([],ie[le[2]],ie[le[1]]))),pe=-Zn(ce,ie[le[1]]);return ce.concat(pe)});return new Yh(ie,oe)}}class mn{static fromPoints(e){const F=[1/0,1/0,1/0],K=[-1/0,-1/0,-1/0];for(const J of e)mc(F,F,J),yc(K,K,J);return new mn(F,K)}static applyTransform(e,F){const K=e.getCorners();for(let J=0;J<K.length;++J)Ii(K[J],K[J],F);return mn.fromPoints(K)}constructor(e,F){this.min=e,this.max=F,this.center=kn([],qo([],this.min,this.max),.5)}quadrant(e){const F=[e%2==0,e<2],K=cp(this.min),J=cp(this.max);for(let ee=0;ee<F.length;ee++)K[ee]=F[ee]?this.min[ee]:this.center[ee],J[ee]=F[ee]?this.center[ee]:this.max[ee];return J[2]=this.max[2],new mn(K,J)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,F=this.max;return[[e[0],e[1],e[2]],[F[0],e[1],e[2]],[F[0],F[1],e[2]],[e[0],F[1],e[2]],[e[0],e[1],F[2]],[F[0],e[1],F[2]],[F[0],F[1],F[2]],[e[0],F[1],F[2]]]}intersects(e){const F=this.getCorners();let K=!0;for(let J=0;J<e.planes.length;J++){const ee=e.planes[J];let ie=0;for(let oe=0;oe<F.length;oe++)ie+=Zn(ee,F[oe])+ee[3]>=0;if(ie===0)return 0;ie!==F.length&&(K=!1)}if(K)return 2;for(let J=0;J<3;J++){let ee=Number.MAX_VALUE,ie=-Number.MAX_VALUE;for(let oe=0;oe<e.points.length;oe++){const le=e.points[oe][J]-this.min[J];ee=Math.min(ee,le),ie=Math.max(ie,le)}if(ie<0||ee>this.max[J]-this.min[J])return 0}return 1}}const Jh=5,$p=6,Eo=ur/Math.PI/2,qm=16383,ls=64,$c=[ls,32,16],Xn=-Eo,Yn=Eo,Hm=[new mn([Xn,Xn,Xn],[Yn,Yn,Yn]),new mn([Xn,Xn,Xn],[0,0,Yn]),new mn([0,Xn,Xn],[Yn,0,Yn]),new mn([Xn,0,Xn],[0,Yn,Yn]),new mn([0,0,Xn],[Yn,Yn,Yn])];function Fu(t){return t*Eo/wc}function xp(t,e,F,K=!0){const J=kn([],t._camera.position,t.worldSize),ee=[e,F,1,1];ss(ee,ee,t.pixelMatrixInverse),fp(ee,ee,1/ee[3]);const ie=dn([],mo([],ee,J)),oe=t.globeMatrix,le=[oe[12],oe[13],oe[14]],ce=mo([],le,J),pe=dc(ce),me=dn([],ce),_e=t.worldSize/(2*Math.PI),xe=Zn(me,ie),we=Math.asin(_e/pe);if(we<Math.acos(xe)){if(!K)return null;const Nt=[],_t=[];kn(Nt,ie,pe/xe),dn(_t,mo(_t,Nt,ce)),dn(ie,qo(ie,ce,kn(ie,_t,Math.tan(we)*pe)))}const Ae=[];new Zh(J,ie).closestPointOnSphere(le,_e,Ae);const Re=dn([],Un(oe,0)),ze=dn([],Un(oe,1)),Ze=dn([],Un(oe,2)),Ue=Zn(Re,Ae),He=Zn(ze,Ae),Ye=Zn(Ze,Ae),Xe=kr(Math.asin(-He/_e));let dt=kr(Math.atan2(Ue,Ye));dt=t.center.lng+function(Nt,_t){const Ct=(_t-Nt+180)%360-180;return Ct<-180?Ct+360:Ct}(t.center.lng,dt);const ut=So(dt),Tt=ht(Io(Xe),0,1);return new el(ut,Tt)}class Km{constructor(e,F,K){this.a=mo([],e,K),this.b=mo([],F,K),this.center=K;const J=dn([],this.a),ee=dn([],this.b);this.angle=Math.acos(Zn(J,ee))}}function Qh(t,e){if(t.angle===0)return null;let F;return F=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),F<0||F>1?null:function(K,J,ee,ie){const oe=Math.sin(ee);return K*(Math.sin((1-ie)*ee)/oe)+J*(Math.sin(ie*ee)/oe)}(t.a[e],t.b[e],t.angle,ht(F,0,1))+t.center[e]}function To(t){if(t.z<=1)return Hm[t.z+2*t.y+t.x];const e=ef(zu(t));return mn.fromPoints(e)}function cs(t,e,F){return kn(t,t,1-F),_c(t,t,e,F)}function bp(t,e){const F=Qs(e.zoom);if(F===0)return To(t);const K=zu(t),J=ef(K),ee=So(K.getWest())*e.worldSize,ie=So(K.getEast())*e.worldSize,oe=Io(K.getNorth())*e.worldSize,le=Io(K.getSouth())*e.worldSize,ce=[ee,oe,0],pe=[ie,oe,0],me=[ee,le,0],_e=[ie,le,0],xe=Gh([],e.globeMatrix);return Ii(ce,ce,xe),Ii(pe,pe,xe),Ii(me,me,xe),Ii(_e,_e,xe),J[0]=cs(J[0],me,F),J[1]=cs(J[1],_e,F),J[2]=cs(J[2],pe,F),J[3]=cs(J[3],ce,F),mn.fromPoints(J)}function wp(t,e,F){for(const K of t)Ii(K,K,e),kn(K,K,F)}function Zm(t,e,F){const K=e/t.worldSize,J=t.globeMatrix;if(F.z<=1){const ut=To(F).getCorners();return wp(ut,J,K),mn.fromPoints(ut)}const ee=zu(F),ie=ef(ee);wp(ie,J,K);const oe=Number.MAX_VALUE,le=[-oe,-oe,-oe],ce=[oe,oe,oe];if(ee.contains(t.center)){for(const Nt of ie)mc(ce,ce,Nt),yc(le,le,Nt);le[2]=0;const ut=t.point,Tt=[ut.x*K,ut.y*K,0];return mc(ce,ce,Tt),yc(le,le,Tt),new mn(ce,le)}const pe=[J[12]*K,J[13]*K,J[14]*K],me=ee.getCenter(),_e=ht(t.center.lat,-an,an),xe=ht(me.lat,-an,an),we=So(t.center.lng),Ae=Io(_e);let Re=we-So(me.lng);const ze=Ae-Io(xe);Re>.5?Re-=1:Re<-.5&&(Re+=1);let Ze=0;Math.abs(Re)>Math.abs(ze)?Ze=Re>=0?1:3:(Ze=ze>=0?0:2,_c(pe,pe,[J[4]*K,J[5]*K,J[6]*K],-Math.sin(dr(ze>=0?ee.getSouth():ee.getNorth()))*Eo));const Ue=ie[Ze],He=ie[(Ze+1)%4],Ye=new Km(Ue,He,pe),Xe=[Qh(Ye,0)||Ue[0],Qh(Ye,1)||Ue[1],Qh(Ye,2)||Ue[2]],dt=Qs(t.zoom);if(dt>0){const ut=function({x:Nt,y:_t,z:Ct},Pt,Lt,Gt,bt){const Xt=1/(1<<Ct);let ir=Nt*Xt,Yt=ir+Xt,vr=_t*Xt,Wt=vr+Xt,cr=0;const $r=(ir+Yt)/2-Gt;return $r>.5?cr=-1:$r<-.5&&(cr=1),ir=((ir+cr)*Pt-(Gt*=Pt))*Lt+Gt,Yt=((Yt+cr)*Pt-Gt)*Lt+Gt,vr=(vr*Pt-(bt*=Pt))*Lt+bt,Wt=(Wt*Pt-bt)*Lt+bt,[[ir,Wt,0],[Yt,Wt,0],[Yt,vr,0],[ir,vr,0]]}(F,e,t._pixelsPerMercatorPixel,we,Ae);for(let Nt=0;Nt<ie.length;Nt++)cs(ie[Nt],ut[Nt],dt);const Tt=qo([],ut[Ze],ut[(Ze+1)%4]);kn(Tt,Tt,.5),cs(Xe,Tt,dt)}for(const ut of ie)mc(ce,ce,ut),yc(le,le,ut);return ce[2]=Math.min(Ue[2],He[2]),mc(ce,ce,Xe),yc(le,le,Xe),new mn(ce,le)}function zu({x:t,y:e,z:F}){const K=1/(1<<F),J=new ii(Nn(t*K),on((e+1)*K)),ee=new ii(Nn((t+1)*K),on(e*K));return new $a(J,ee)}function ef(t){const e=dr(t.getNorth()),F=dr(t.getSouth()),K=Math.cos(e),J=Math.cos(F),ee=Math.sin(e),ie=Math.sin(F),oe=t.getWest(),le=t.getEast();return[Ys(J,ie,oe),Ys(J,ie,le),Ys(K,ee,le),Ys(K,ee,oe)]}function Ys(t,e,F,K=Eo){return F=dr(F),[t*Math.sin(F)*K,-e*K,t*Math.cos(F)*K]}function Js(t,e,F){return Ys(Math.cos(dr(t)),Math.sin(dr(t)),e,F)}function xc(t,e,F,K){const J=1<<F.z,ee=(t/ur+F.x)/J;return Js(on((e/ur+F.y)/J),Nn(ee),K)}function Uu({min:t,max:e}){return qm/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Ep=new Float64Array(16);function bc(t){const e=Uu(t),F=sp(Ep,[e,e,e]);return pc(F,F,((K=[])[0]=-(J=t.min)[0],K[1]=-J[1],K[2]=-J[2],K));var K,J}function tf(t){const e=(K=t.min,(F=Ep)[0]=1,F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=1,F[6]=0,F[7]=0,F[8]=0,F[9]=0,F[10]=1,F[11]=0,F[12]=K[0],F[13]=K[1],F[14]=K[2],F[15]=1,F);var F,K;const J=1/Uu(t);return as(e,e,[J,J,J])}function Tp(t,e,F,K,J){const ee=function(le){const ce=ur/(2*Math.PI);return le/(2*Math.PI)/ce}(F),ie=[t,e,-F/(2*Math.PI)],oe=po(new Float64Array(16));return pc(oe,oe,ie),as(oe,oe,[ee,ee,ee]),Wh(oe,oe,dr(-J)),Nu(oe,oe,dr(-K)),oe}function Qs(t){return Rt(Jh,$p,t)}function Sp(t,e){const F=Js(e.lat,e.lng),K=function(we){const Ae=Js(we._center.lat,we._center.lng);let Re=Kh([],Xs(0,1,0),Ae);const ze=lp([],-we.angle,Ae);Re=Ii(Re,Re,ze),lp(ze,-we._pitch,Re);const Ze=dn([],Ae);return kn(Ze,Ze,Fu(we.cameraToCenterDistance/we.pixelsPerMeter)),Ii(Ze,Ze,ze),qo([],Ae,Ze)}(t);return ie=(J=Hh([],K,F))[0],oe=J[1],le=J[2],ce=(ee=F)[0],pe=ee[1],me=ee[2],xe=(_e=Math.sqrt(ie*ie+oe*oe+le*le)*Math.sqrt(ce*ce+pe*pe+me*me))&&Zn(J,ee)/_e,Math.acos(Math.min(Math.max(xe,-1),1));var J,ee,ie,oe,le,ce,pe,me,_e,xe}function rf(t,e){return Sp(t,e)>Math.PI/2*1.01}const Ip=dr(85),Xm=Math.cos(Ip),Ym=Math.sin(Ip),wc=63710088e-1,Ap=2*Math.PI*wc;class xa{constructor(e,F){if(isNaN(e)||isNaN(F))throw new Error(`Invalid LngLat object: (${e}, ${F})`);if(this.lng=+e,this.lat=+F,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xa(It(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const F=Math.PI/180,K=this.lat*F,J=e.lat*F,ee=Math.sin(K)*Math.sin(J)+Math.cos(K)*Math.cos(J)*Math.cos((e.lng-this.lng)*F);return wc*Math.acos(Math.min(ee,1))}toBounds(e=0){const F=360*e/40075017,K=F/Math.cos(Math.PI/180*this.lat);return new $a(new xa(this.lng-K,this.lat-F),new xa(this.lng+K,this.lat+F))}toEcef(e){const F=Fu(e);return Js(this.lat,this.lng,Eo+F)}static convert(e){if(e instanceof xa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new xa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new xa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var ii=xa;function nf(t){return Ap*Math.cos(t*Math.PI/180)}function So(t){return(180+t)/360}function Io(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function yo(t,e){return t/nf(e)}function Nn(t){return 360*t-180}function on(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Cp(t,e){return t*nf(on(e))}const an=85.051129;function Pp(t){return 1/Math.cos(t*Math.PI/180)}class el{constructor(e,F,K=0){this.x=+e,this.y=+F,this.z=+K}static fromLngLat(e,F=0){const K=ii.convert(e);return new el(So(K.lng),Io(K.lat),yo(F,K.lat))}toLngLat(){return new ii(Nn(this.x),on(this.y))}toAltitude(){return Cp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ap*Pp(on(this.y))}}function of(t,e,F,K,J,ee,ie,oe,le){const ce=(e+K)/2,pe=(F+J)/2,me=new zt(ce,pe);oe(me),function(_e,xe,we,Ae,Re,ze){const Ze=we-Re,Ue=Ae-ze;return Math.abs((Ae-xe)*Ze-(we-_e)*Ue)/Math.hypot(Ze,Ue)}(me.x,me.y,ee.x,ee.y,ie.x,ie.y)>=le?(of(t,e,F,ce,pe,ee,me,oe,le),of(t,ce,pe,K,J,me,ie,oe,le)):t.push(ie)}function Rp(t,e,F){let K=t[0],J=K.x,ee=K.y;e(K);const ie=[K];for(let oe=1;oe<t.length;oe++){const le=t[oe],{x:ce,y:pe}=le;e(le),of(ie,J,ee,ce,pe,K,le,e,F),J=ce,ee=pe,K=le}return ie}function af(t,e,F,K){if(K(e,F)){const J=e.add(F)._mult(.5);af(t,e,J,K),af(t,J,F,K)}else t.push(F)}function Jm(t,e){let F=t[0];const K=[F];for(let J=1;J<t.length;J++){const ee=t[J];af(K,F,ee,e),F=ee}return K}const sf=Math.pow(2,14)-1,Mp=-sf-1;function Qm(t,e){const F=Math.round(t.x*e),K=Math.round(t.y*e);return t.x=ht(F,Mp,sf),t.y=ht(K,Mp,sf),(F<t.x||F>t.x+1||K<t.y||K>t.y+1)&&di("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Ho(t,e,F){const K=t.loadGeometry(),J=t.extent,ee=ur/J;if(e&&F&&F.projection.isReprojectedInTileSpace){const ie=1<<e.z,{scale:oe,x:le,y:ce,projection:pe}=F,me=_e=>{const xe=Nn((e.x+_e.x/J)/ie),we=on((e.y+_e.y/J)/ie),Ae=pe.project(xe,we);_e.x=(Ae.x*oe-le)*J,_e.y=(Ae.y*oe-ce)*J};for(let _e=0;_e<K.length;_e++)if(t.type!==1)K[_e]=Rp(K[_e],me,1);else{const xe=[];for(const we of K[_e])we.x<0||we.x>=J||we.y<0||we.y>=J||(me(we),xe.push(we));K[_e]=xe}}for(const ie of K)for(const oe of ie)Qm(oe,ee);return K}function us(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ho(t):[]}}function ju(t,e,F,K,J){t.emplaceBack(2*e+(K+1)/2,2*F+(J+1)/2)}function Vu(t,e,F){t.emplaceBack(e.x,e.y,e.z,F[0]*16384,F[1]*16384,F[2]*16384)}class lf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(F=>F.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new kt,this.indexArray=new or,this.segments=new Pi,this.programConfigurations=new ns(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(F=>F.isStateDependent()).map(F=>F.id)}populate(e,F,K,J){const ee=this.layers[0],ie=[];let oe=null;ee.type==="circle"&&(oe=ee.layout.get("circle-sort-key"));for(const{feature:ce,id:pe,index:me,sourceLayerIndex:_e}of e){const xe=this.layers[0]._featureFilter.needGeometry,we=us(ce,xe);if(!this.layers[0]._featureFilter.filter(new de(this.zoom),we,K))continue;const Ae=oe?oe.evaluate(we,{},K):void 0,Re={id:pe,properties:ce.properties,type:ce.type,sourceLayerIndex:_e,index:me,geometry:xe?we.geometry:Ho(ce,K,J),patterns:{},sortKey:Ae};ie.push(Re)}oe&&ie.sort((ce,pe)=>ce.sortKey-pe.sortKey);let le=null;J.projection.name==="globe"&&(this.globeExtVertexArray=new Ft,le=J.projection);for(const ce of ie){const{geometry:pe,index:me,sourceLayerIndex:_e}=ce,xe=e[me].feature;this.addFeature(ce,pe,me,F.availableImages,K,le),F.featureIndex.insert(xe,pe,me,_e,this.index)}}update(e,F,K,J){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,F,this.stateDependentLayers,K,J)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,zm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,F,K,J,ee,ie){for(const oe of F)for(const le of oe){const ce=le.x,pe=le.y;if(ce<0||ce>=ur||pe<0||pe>=ur)continue;if(ie){const xe=ie.projectTilePoint(ce,pe,ee),we=ie.upVector(ee,ce,pe),Ae=this.globeExtVertexArray;Vu(Ae,xe,we),Vu(Ae,xe,we),Vu(Ae,xe,we),Vu(Ae,xe,we)}const me=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),_e=me.vertexLength;ju(this.layoutVertexArray,ce,pe,-1,-1),ju(this.layoutVertexArray,ce,pe,1,-1),ju(this.layoutVertexArray,ce,pe,1,1),ju(this.layoutVertexArray,ce,pe,-1,1),this.indexArray.emplaceBack(_e,_e+1,_e+2),this.indexArray.emplaceBack(_e,_e+2,_e+3),me.vertexLength+=4,me.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,K,{},J,ee)}}function Dp(t,e){for(let F=0;F<t.length;F++)if(hs(e,t[F]))return!0;for(let F=0;F<e.length;F++)if(hs(t,e[F]))return!0;return!!cf(t,e)}function ey(t,e,F){return!!hs(t,e)||!!uf(e,t,F)}function Lp(t,e){if(t.length===1)return kp(e,t[0]);for(let F=0;F<e.length;F++){const K=e[F];for(let J=0;J<K.length;J++)if(hs(t,K[J]))return!0}for(let F=0;F<t.length;F++)if(kp(e,t[F]))return!0;for(let F=0;F<e.length;F++)if(cf(t,e[F]))return!0;return!1}function ty(t,e,F){if(t.length>1){if(cf(t,e))return!0;for(let K=0;K<e.length;K++)if(uf(e[K],t,F))return!0}for(let K=0;K<t.length;K++)if(uf(t[K],e,F))return!0;return!1}function cf(t,e){if(t.length===0||e.length===0)return!1;for(let F=0;F<t.length-1;F++){const K=t[F],J=t[F+1];for(let ee=0;ee<e.length-1;ee++)if(ry(K,J,e[ee],e[ee+1]))return!0}return!1}function ry(t,e,F,K){return Qi(t,F,K)!==Qi(e,F,K)&&Qi(t,e,F)!==Qi(t,e,K)}function uf(t,e,F){const K=F*F;if(e.length===1)return t.distSqr(e[0])<K;for(let J=1;J<e.length;J++)if(Bp(t,e[J-1],e[J])<K)return!0;return!1}function Bp(t,e,F){const K=e.distSqr(F);if(K===0)return t.distSqr(e);const J=((t.x-e.x)*(F.x-e.x)+(t.y-e.y)*(F.y-e.y))/K;return t.distSqr(J<0?e:J>1?F:F.sub(e)._mult(J)._add(e))}function kp(t,e){let F,K,J,ee=!1;for(let ie=0;ie<t.length;ie++){F=t[ie];for(let oe=0,le=F.length-1;oe<F.length;le=oe++)K=F[oe],J=F[le],K.y>e.y!=J.y>e.y&&e.x<(J.x-K.x)*(e.y-K.y)/(J.y-K.y)+K.x&&(ee=!ee)}return ee}function hs(t,e){let F=!1;for(let K=0,J=t.length-1;K<t.length;J=K++){const ee=t[K],ie=t[J];ee.y>e.y!=ie.y>e.y&&e.x<(ie.x-ee.x)*(e.y-ee.y)/(ie.y-ee.y)+ee.x&&(F=!F)}return F}function Np(t,e,F,K,J){for(const ie of t)if(e<=ie.x&&F<=ie.y&&K>=ie.x&&J>=ie.y)return!0;const ee=[new zt(e,F),new zt(e,J),new zt(K,J),new zt(K,F)];if(t.length>2){for(const ie of ee)if(hs(t,ie))return!0}for(let ie=0;ie<t.length-1;ie++)if(iy(t[ie],t[ie+1],ee))return!0;return!1}function iy(t,e,F){const K=F[0],J=F[2];if(t.x<K.x&&e.x<K.x||t.x>J.x&&e.x>J.x||t.y<K.y&&e.y<K.y||t.y>J.y&&e.y>J.y)return!1;const ee=Qi(t,e,F[0]);return ee!==Qi(t,e,F[1])||ee!==Qi(t,e,F[2])||ee!==Qi(t,e,F[3])}function tl(t,e,F){const K=e.paint.get(t).value;return K.kind==="constant"?K.value:F.programConfigurations.get(e.id).getMaxValue(t)}function Gu(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Fp(t,e,F,K,J){if(!e[0]&&!e[1])return t;const ee=zt.convert(e)._mult(J);F==="viewport"&&ee._rotate(-K);const ie=[];for(let oe=0;oe<t.length;oe++)ie.push(t[oe].sub(ee));return ie}function zp(t,e,F,K){const J=zt.convert(t)._mult(K);return e==="viewport"&&J._rotate(-F),J}tr(lf,"CircleBucket",{omit:["layers"]});const ny=new Ge({"circle-sort-key":new De(Et.layout_circle["circle-sort-key"])});var oy={paint:new Ge({"circle-radius":new De(Et.paint_circle["circle-radius"]),"circle-color":new De(Et.paint_circle["circle-color"]),"circle-blur":new De(Et.paint_circle["circle-blur"]),"circle-opacity":new De(Et.paint_circle["circle-opacity"]),"circle-translate":new Se(Et.paint_circle["circle-translate"]),"circle-translate-anchor":new Se(Et.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Se(Et.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Se(Et.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new De(Et.paint_circle["circle-stroke-width"]),"circle-stroke-color":new De(Et.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new De(Et.paint_circle["circle-stroke-opacity"])}),layout:ny};function Up(t,e,F,K,J,ee,ie,oe,le){if(ee&&t.queryGeometry.isAboveHorizon)return!1;ee&&(le*=t.pixelToTileUnitsFactor);const ce=t.tileID.canonical,pe=F.projection.upVectorScale(ce,F.center.lat,F.worldSize).metersToTile;for(const me of e)for(const _e of me){const xe=_e.add(oe),we=J&&F.elevation?F.elevation.exaggeration()*J.getElevationAt(xe.x,xe.y,!0):0,Ae=F.projection.projectTilePoint(xe.x,xe.y,ce);if(we>0){const Ue=F.projection.upVector(ce,xe.x,xe.y);Ae.x+=Ue[0]*pe*we,Ae.y+=Ue[1]*pe*we,Ae.z+=Ue[2]*pe*we}const Re=ee?xe:ay(Ae.x,Ae.y,Ae.z,K),ze=ee?t.tilespaceRays.map(Ue=>ly(Ue,we)):t.queryGeometry.screenGeometry,Ze=ss([],[Ae.x,Ae.y,Ae.z,1],K);if(!ie&&ee?le*=Ze[3]/F.cameraToCenterDistance:ie&&!ee&&(le*=F.cameraToCenterDistance/Ze[3]),ee){const Ue=on((_e.y/ur+ce.y)/(1<<ce.z));le/=F.projection.pixelsPerMeter(Ue,1)/yo(1,Ue)}if(ey(ze,Re,le))return!0}return!1}function ay(t,e,F,K){const J=ss([],[t,e,F,1],K);return new zt(J[0]/J[3],J[1]/J[3])}const jp=Xs(0,0,0),sy=Xs(0,0,1);function ly(t,e){const F=qh();return jp[2]=e,t.intersectsPlane(jp,sy,F),new zt(F[0],F[1])}class Vp extends lf{}function Gp(t,{width:e,height:F},K,J){if(J){if(J instanceof Uint8ClampedArray)J=new Uint8Array(J.buffer);else if(J.length!==e*F*K)throw new RangeError("mismatched image size")}else J=new Uint8Array(e*F*K);return t.width=e,t.height=F,t.data=J,t}function Wp(t,e,F){const{width:K,height:J}=e;K===t.width&&J===t.height||(hf(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,K),height:Math.min(t.height,J)},F),t.width=K,t.height=J,t.data=e.data)}function hf(t,e,F,K,J,ee){if(J.width===0||J.height===0)return e;if(J.width>t.width||J.height>t.height||F.x>t.width-J.width||F.y>t.height-J.height)throw new RangeError("out of range source coordinates for image copy");if(J.width>e.width||J.height>e.height||K.x>e.width-J.width||K.y>e.height-J.height)throw new RangeError("out of range destination coordinates for image copy");const ie=t.data,oe=e.data;for(let le=0;le<J.height;le++){const ce=((F.y+le)*t.width+F.x)*ee,pe=((K.y+le)*e.width+K.x)*ee;for(let me=0;me<J.width*ee;me++)oe[pe+me]=ie[ce+me]}return e}tr(Vp,"HeatmapBucket",{omit:["layers"]});class Ko{constructor(e,F){Gp(this,e,1,F)}resize(e){Wp(this,new Ko(e),1)}clone(){return new Ko({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,F,K,J,ee){hf(e,F,K,J,ee,1)}}class Cn{constructor(e,F){Gp(this,e,4,F)}resize(e){Wp(this,new Cn(e),4)}replace(e,F){F?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Cn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,F,K,J,ee){hf(e,F,K,J,ee,4)}}tr(Ko,"AlphaImage"),tr(Cn,"RGBAImage");var cy={paint:new Ge({"heatmap-radius":new De(Et.paint_heatmap["heatmap-radius"]),"heatmap-weight":new De(Et.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Se(Et.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ve(Et.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Se(Et.paint_heatmap["heatmap-opacity"])})};function ff(t){const e={},F=t.resolution||256,K=t.clips?t.clips.length:1,J=t.image||new Cn({width:F,height:K}),ee=(ie,oe,le)=>{e[t.evaluationKey]=le;const ce=t.expression.evaluate(e);J.data[ie+oe+0]=Math.floor(255*ce.r/ce.a),J.data[ie+oe+1]=Math.floor(255*ce.g/ce.a),J.data[ie+oe+2]=Math.floor(255*ce.b/ce.a),J.data[ie+oe+3]=Math.floor(255*ce.a)};if(t.clips)for(let ie=0,oe=0;ie<K;++ie,oe+=4*F)for(let le=0,ce=0;le<F;le++,ce+=4){const pe=le/(F-1),{start:me,end:_e}=t.clips[ie];ee(oe,ce,me*(1-pe)+_e*pe)}else for(let ie=0,oe=0;ie<F;ie++,oe+=4)ee(0,oe,ie/(F-1));return J}var uy={paint:new Ge({"hillshade-illumination-direction":new Se(Et.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Se(Et.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Se(Et.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Se(Et.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Se(Et.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Se(Et.paint_hillshade["hillshade-accent-color"])})};const hy=nt([{name:"a_pos",components:2,type:"Int16"}],4),{members:fy}=hy;var pf={exports:{}};function Wu(t,e,F){F=F||2;var K,J,ee,ie,oe,le,ce,pe=e&&e.length,me=pe?e[0]*F:t.length,_e=qp(t,0,me,F,!0),xe=[];if(!_e||_e.next===_e.prev)return xe;if(pe&&(_e=function(Ae,Re,ze,Ze){var Ue,He,Ye,Xe=[];for(Ue=0,He=Re.length;Ue<He;Ue++)(Ye=qp(Ae,Re[Ue]*Ze,Ue<He-1?Re[Ue+1]*Ze:Ae.length,Ze,!1))===Ye.next&&(Ye.steiner=!0),Xe.push($y(Ye));for(Xe.sort(_y),Ue=0;Ue<Xe.length;Ue++)ze=gy(Xe[Ue],ze);return ze}(t,e,_e,F)),t.length>80*F){K=ee=t[0],J=ie=t[1];for(var we=F;we<me;we+=F)(oe=t[we])<K&&(K=oe),(le=t[we+1])<J&&(J=le),oe>ee&&(ee=oe),le>ie&&(ie=le);ce=(ce=Math.max(ee-K,ie-J))!==0?32767/ce:0}return Ec(_e,xe,F,K,J,ce,0),xe}function qp(t,e,F,K,J){var ee,ie;if(J===yf(t,e,F,K)>0)for(ee=e;ee<F;ee+=K)ie=Zp(ee,t[ee],t[ee+1],ie);else for(ee=F-K;ee>=e;ee-=K)ie=Zp(ee,t[ee],t[ee+1],ie);return ie&&qu(ie,ie.next)&&(Sc(ie),ie=ie.next),ie}function fs(t,e){if(!t)return t;e||(e=t);var F,K=t;do if(F=!1,K.steiner||!qu(K,K.next)&&Ri(K.prev,K,K.next)!==0)K=K.next;else{if(Sc(K),(K=e=K.prev)===K.next)break;F=!0}while(F||K!==e);return e}function Ec(t,e,F,K,J,ee,ie){if(t){!ie&&ee&&function(pe,me,_e,xe){var we=pe;do we.z===0&&(we.z=df(we.x,we.y,me,_e,xe)),we.prevZ=we.prev,we.nextZ=we.next,we=we.next;while(we!==pe);we.prevZ.nextZ=null,we.prevZ=null,function(Ae){var Re,ze,Ze,Ue,He,Ye,Xe,dt,ut=1;do{for(ze=Ae,Ae=null,He=null,Ye=0;ze;){for(Ye++,Ze=ze,Xe=0,Re=0;Re<ut&&(Xe++,Ze=Ze.nextZ);Re++);for(dt=ut;Xe>0||dt>0&&Ze;)Xe!==0&&(dt===0||!Ze||ze.z<=Ze.z)?(Ue=ze,ze=ze.nextZ,Xe--):(Ue=Ze,Ze=Ze.nextZ,dt--),He?He.nextZ=Ue:Ae=Ue,Ue.prevZ=He,He=Ue;ze=Ze}He.nextZ=null,ut*=2}while(Ye>1)}(we)}(t,K,J,ee);for(var oe,le,ce=t;t.prev!==t.next;)if(oe=t.prev,le=t.next,ee?dy(t,K,J,ee):py(t))e.push(oe.i/F|0),e.push(t.i/F|0),e.push(le.i/F|0),Sc(t),t=le.next,ce=le.next;else if((t=le)===ce){ie?ie===1?Ec(t=my(fs(t),e,F),e,F,K,J,ee,2):ie===2&&yy(t,e,F,K,J,ee):Ec(fs(t),e,F,K,J,ee,1);break}}}function py(t){var e=t.prev,F=t,K=t.next;if(Ri(e,F,K)>=0)return!1;for(var J=e.x,ee=F.x,ie=K.x,oe=e.y,le=F.y,ce=K.y,pe=J<ee?J<ie?J:ie:ee<ie?ee:ie,me=oe<le?oe<ce?oe:ce:le<ce?le:ce,_e=J>ee?J>ie?J:ie:ee>ie?ee:ie,xe=oe>le?oe>ce?oe:ce:le>ce?le:ce,we=K.next;we!==e;){if(we.x>=pe&&we.x<=_e&&we.y>=me&&we.y<=xe&&rl(J,oe,ee,le,ie,ce,we.x,we.y)&&Ri(we.prev,we,we.next)>=0)return!1;we=we.next}return!0}function dy(t,e,F,K){var J=t.prev,ee=t,ie=t.next;if(Ri(J,ee,ie)>=0)return!1;for(var oe=J.x,le=ee.x,ce=ie.x,pe=J.y,me=ee.y,_e=ie.y,xe=oe<le?oe<ce?oe:ce:le<ce?le:ce,we=pe<me?pe<_e?pe:_e:me<_e?me:_e,Ae=oe>le?oe>ce?oe:ce:le>ce?le:ce,Re=pe>me?pe>_e?pe:_e:me>_e?me:_e,ze=df(xe,we,e,F,K),Ze=df(Ae,Re,e,F,K),Ue=t.prevZ,He=t.nextZ;Ue&&Ue.z>=ze&&He&&He.z<=Ze;){if(Ue.x>=xe&&Ue.x<=Ae&&Ue.y>=we&&Ue.y<=Re&&Ue!==J&&Ue!==ie&&rl(oe,pe,le,me,ce,_e,Ue.x,Ue.y)&&Ri(Ue.prev,Ue,Ue.next)>=0||(Ue=Ue.prevZ,He.x>=xe&&He.x<=Ae&&He.y>=we&&He.y<=Re&&He!==J&&He!==ie&&rl(oe,pe,le,me,ce,_e,He.x,He.y)&&Ri(He.prev,He,He.next)>=0))return!1;He=He.nextZ}for(;Ue&&Ue.z>=ze;){if(Ue.x>=xe&&Ue.x<=Ae&&Ue.y>=we&&Ue.y<=Re&&Ue!==J&&Ue!==ie&&rl(oe,pe,le,me,ce,_e,Ue.x,Ue.y)&&Ri(Ue.prev,Ue,Ue.next)>=0)return!1;Ue=Ue.prevZ}for(;He&&He.z<=Ze;){if(He.x>=xe&&He.x<=Ae&&He.y>=we&&He.y<=Re&&He!==J&&He!==ie&&rl(oe,pe,le,me,ce,_e,He.x,He.y)&&Ri(He.prev,He,He.next)>=0)return!1;He=He.nextZ}return!0}function my(t,e,F){var K=t;do{var J=K.prev,ee=K.next.next;!qu(J,ee)&&Hp(J,K,K.next,ee)&&Tc(J,ee)&&Tc(ee,J)&&(e.push(J.i/F|0),e.push(K.i/F|0),e.push(ee.i/F|0),Sc(K),Sc(K.next),K=t=ee),K=K.next}while(K!==t);return fs(K)}function yy(t,e,F,K,J,ee){var ie=t;do{for(var oe=ie.next.next;oe!==ie.prev;){if(ie.i!==oe.i&&xy(ie,oe)){var le=Kp(ie,oe);return ie=fs(ie,ie.next),le=fs(le,le.next),Ec(ie,e,F,K,J,ee,0),void Ec(le,e,F,K,J,ee,0)}oe=oe.next}ie=ie.next}while(ie!==t)}function _y(t,e){return t.x-e.x}function gy(t,e){var F=function(J,ee){var ie,oe=ee,le=J.x,ce=J.y,pe=-1/0;do{if(ce<=oe.y&&ce>=oe.next.y&&oe.next.y!==oe.y){var me=oe.x+(ce-oe.y)*(oe.next.x-oe.x)/(oe.next.y-oe.y);if(me<=le&&me>pe&&(pe=me,ie=oe.x<oe.next.x?oe:oe.next,me===le))return ie}oe=oe.next}while(oe!==ee);if(!ie)return null;var _e,xe=ie,we=ie.x,Ae=ie.y,Re=1/0;oe=ie;do le>=oe.x&&oe.x>=we&&le!==oe.x&&rl(ce<Ae?le:pe,ce,we,Ae,ce<Ae?pe:le,ce,oe.x,oe.y)&&(_e=Math.abs(ce-oe.y)/(le-oe.x),Tc(oe,J)&&(_e<Re||_e===Re&&(oe.x>ie.x||oe.x===ie.x&&vy(ie,oe)))&&(ie=oe,Re=_e)),oe=oe.next;while(oe!==xe);return ie}(t,e);if(!F)return e;var K=Kp(F,t);return fs(K,K.next),fs(F,F.next)}function vy(t,e){return Ri(t.prev,t,e.prev)<0&&Ri(e.next,t,t.next)<0}function df(t,e,F,K,J){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-F)*J|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-K)*J|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $y(t){var e=t,F=t;do(e.x<F.x||e.x===F.x&&e.y<F.y)&&(F=e),e=e.next;while(e!==t);return F}function rl(t,e,F,K,J,ee,ie,oe){return(J-ie)*(e-oe)>=(t-ie)*(ee-oe)&&(t-ie)*(K-oe)>=(F-ie)*(e-oe)&&(F-ie)*(ee-oe)>=(J-ie)*(K-oe)}function xy(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(F,K){var J=F;do{if(J.i!==F.i&&J.next.i!==F.i&&J.i!==K.i&&J.next.i!==K.i&&Hp(J,J.next,F,K))return!0;J=J.next}while(J!==F);return!1}(t,e)&&(Tc(t,e)&&Tc(e,t)&&function(F,K){var J=F,ee=!1,ie=(F.x+K.x)/2,oe=(F.y+K.y)/2;do J.y>oe!=J.next.y>oe&&J.next.y!==J.y&&ie<(J.next.x-J.x)*(oe-J.y)/(J.next.y-J.y)+J.x&&(ee=!ee),J=J.next;while(J!==F);return ee}(t,e)&&(Ri(t.prev,t,e.prev)||Ri(t,e.prev,e))||qu(t,e)&&Ri(t.prev,t,t.next)>0&&Ri(e.prev,e,e.next)>0)}function Ri(t,e,F){return(e.y-t.y)*(F.x-e.x)-(e.x-t.x)*(F.y-e.y)}function qu(t,e){return t.x===e.x&&t.y===e.y}function Hp(t,e,F,K){var J=Ku(Ri(t,e,F)),ee=Ku(Ri(t,e,K)),ie=Ku(Ri(F,K,t)),oe=Ku(Ri(F,K,e));return J!==ee&&ie!==oe||!(J!==0||!Hu(t,F,e))||!(ee!==0||!Hu(t,K,e))||!(ie!==0||!Hu(F,t,K))||!(oe!==0||!Hu(F,e,K))}function Hu(t,e,F){return e.x<=Math.max(t.x,F.x)&&e.x>=Math.min(t.x,F.x)&&e.y<=Math.max(t.y,F.y)&&e.y>=Math.min(t.y,F.y)}function Ku(t){return t>0?1:t<0?-1:0}function Tc(t,e){return Ri(t.prev,t,t.next)<0?Ri(t,e,t.next)>=0&&Ri(t,t.prev,e)>=0:Ri(t,e,t.prev)<0||Ri(t,t.next,e)<0}function Kp(t,e){var F=new mf(t.i,t.x,t.y),K=new mf(e.i,e.x,e.y),J=t.next,ee=e.prev;return t.next=e,e.prev=t,F.next=J,J.prev=F,K.next=F,F.prev=K,ee.next=K,K.prev=ee,K}function Zp(t,e,F,K){var J=new mf(t,e,F);return K?(J.next=K.next,J.prev=K,K.next.prev=J,K.next=J):(J.prev=J,J.next=J),J}function Sc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function mf(t,e,F){this.i=t,this.x=e,this.y=F,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function yf(t,e,F,K){for(var J=0,ee=e,ie=F-K;ee<F;ee+=K)J+=(t[ie]-t[ee])*(t[ee+1]+t[ie+1]),ie=ee;return J}pf.exports=Wu,pf.exports.default=Wu,Wu.deviation=function(t,e,F,K){var J=e&&e.length,ee=Math.abs(yf(t,0,J?e[0]*F:t.length,F));if(J)for(var ie=0,oe=e.length;ie<oe;ie++)ee-=Math.abs(yf(t,e[ie]*F,ie<oe-1?e[ie+1]*F:t.length,F));var le=0;for(ie=0;ie<K.length;ie+=3){var ce=K[ie]*F,pe=K[ie+1]*F,me=K[ie+2]*F;le+=Math.abs((t[ce]-t[me])*(t[pe+1]-t[ce+1])-(t[ce]-t[pe])*(t[me+1]-t[ce+1]))}return ee===0&&le===0?0:Math.abs((le-ee)/ee)},Wu.flatten=function(t){for(var e=t[0][0].length,F={vertices:[],holes:[],dimensions:e},K=0,J=0;J<t.length;J++){for(var ee=0;ee<t[J].length;ee++)for(var ie=0;ie<e;ie++)F.vertices.push(t[J][ee][ie]);J>0&&F.holes.push(K+=t[J-1].length)}return F};var _f=sr(pf.exports);function by(t,e,F,K,J){Xp(t,e,F||0,K||t.length-1,J||wy)}function Xp(t,e,F,K,J){for(;K>F;){if(K-F>600){var ee=K-F+1,ie=e-F+1,oe=Math.log(ee),le=.5*Math.exp(2*oe/3),ce=.5*Math.sqrt(oe*le*(ee-le)/ee)*(ie-ee/2<0?-1:1);Xp(t,e,Math.max(F,Math.floor(e-ie*le/ee+ce)),Math.min(K,Math.floor(e+(ee-ie)*le/ee+ce)),J)}var pe=t[e],me=F,_e=K;for(Ic(t,F,e),J(t[K],pe)>0&&Ic(t,F,K);me<_e;){for(Ic(t,me,_e),me++,_e--;J(t[me],pe)<0;)me++;for(;J(t[_e],pe)>0;)_e--}J(t[F],pe)===0?Ic(t,F,_e):Ic(t,++_e,K),_e<=e&&(F=_e+1),e<=_e&&(K=_e-1)}}function Ic(t,e,F){var K=t[e];t[e]=t[F],t[F]=K}function wy(t,e){return t<e?-1:t>e?1:0}function gf(t,e){const F=t.length;if(F<=1)return[t];const K=[];let J,ee;for(let ie=0;ie<F;ie++){const oe=Yo(t[ie]);oe!==0&&(t[ie].area=Math.abs(oe),ee===void 0&&(ee=oe<0),ee===oe<0?(J&&K.push(J),J=[t[ie]]):J.push(t[ie]))}if(J&&K.push(J),e>1)for(let ie=0;ie<K.length;ie++)K[ie].length<=e||(by(K[ie],e,1,K[ie].length-1,Ey),K[ie]=K[ie].slice(0,e));return K}function Ey(t,e){return e.area-t.area}function vf(t,e,F){const K=F.patternDependencies;let J=!1;for(const ee of e){const ie=ee.paint.get(`${t}-pattern`);ie.isConstant()||(J=!0);const oe=ie.constantOr(null);oe&&(J=!0,K[oe]=!0)}return J}function $f(t,e,F,K,J){const ee=J.patternDependencies;for(const ie of e){const oe=ie.paint.get(`${t}-pattern`).value;if(oe.kind!=="constant"){let le=oe.evaluate({zoom:K},F,{},J.availableImages);le=le&&le.name?le.name:le,ee[le]=!0,F.patterns[ie.id]=le}}return F}class Zu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(F=>F.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new kt,this.indexArray=new or,this.indexArray2=new Vi,this.programConfigurations=new ns(e.layers,e.zoom),this.segments=new Pi,this.segments2=new Pi,this.stateDependentLayerIds=this.layers.filter(F=>F.isStateDependent()).map(F=>F.id),this.projection=e.projection}populate(e,F,K,J){this.hasPattern=vf("fill",this.layers,F);const ee=this.layers[0].layout.get("fill-sort-key"),ie=[];for(const{feature:oe,id:le,index:ce,sourceLayerIndex:pe}of e){const me=this.layers[0]._featureFilter.needGeometry,_e=us(oe,me);if(!this.layers[0]._featureFilter.filter(new de(this.zoom),_e,K))continue;const xe=ee?ee.evaluate(_e,{},K,F.availableImages):void 0,we={id:le,properties:oe.properties,type:oe.type,sourceLayerIndex:pe,index:ce,geometry:me?_e.geometry:Ho(oe,K,J),patterns:{},sortKey:xe};ie.push(we)}ee&&ie.sort((oe,le)=>oe.sortKey-le.sortKey);for(const oe of ie){const{geometry:le,index:ce,sourceLayerIndex:pe}=oe;if(this.hasPattern){const me=$f("fill",this.layers,oe,this.zoom,F);this.patternFeatures.push(me)}else this.addFeature(oe,le,ce,K,{},F.availableImages);F.featureIndex.insert(e[ce].feature,le,ce,pe,this.index)}}update(e,F,K,J){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,F,this.stateDependentLayers,K,J)}addFeatures(e,F,K,J,ee){for(const ie of this.patternFeatures)this.addFeature(ie,ie.geometry,ie.index,F,K,J)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fy),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,F,K,J,ee,ie=[]){for(const oe of gf(F,500)){let le=0;for(const we of oe)le+=we.length;const ce=this.segments.prepareSegment(le,this.layoutVertexArray,this.indexArray),pe=ce.vertexLength,me=[],_e=[];for(const we of oe){if(we.length===0)continue;we!==oe[0]&&_e.push(me.length/2);const Ae=this.segments2.prepareSegment(we.length,this.layoutVertexArray,this.indexArray2),Re=Ae.vertexLength;this.layoutVertexArray.emplaceBack(we[0].x,we[0].y),this.indexArray2.emplaceBack(Re+we.length-1,Re),me.push(we[0].x),me.push(we[0].y);for(let ze=1;ze<we.length;ze++)this.layoutVertexArray.emplaceBack(we[ze].x,we[ze].y),this.indexArray2.emplaceBack(Re+ze-1,Re+ze),me.push(we[ze].x),me.push(we[ze].y);Ae.vertexLength+=we.length,Ae.primitiveLength+=we.length}const xe=_f(me,_e);for(let we=0;we<xe.length;we+=3)this.indexArray.emplaceBack(pe+xe[we],pe+xe[we+1],pe+xe[we+2]);ce.vertexLength+=le,ce.primitiveLength+=xe.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,K,ee,ie,J)}}tr(Zu,"FillBucket",{omit:["layers","patternFeatures"]});const Ty=new Ge({"fill-sort-key":new De(Et.layout_fill["fill-sort-key"])});var Sy={paint:new Ge({"fill-antialias":new Se(Et.paint_fill["fill-antialias"]),"fill-opacity":new De(Et.paint_fill["fill-opacity"]),"fill-color":new De(Et.paint_fill["fill-color"]),"fill-outline-color":new De(Et.paint_fill["fill-outline-color"]),"fill-translate":new Se(Et.paint_fill["fill-translate"]),"fill-translate-anchor":new Se(Et.paint_fill["fill-translate-anchor"]),"fill-pattern":new De(Et.paint_fill["fill-pattern"])}),layout:Ty};const Iy=nt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ay=nt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Oy=nt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Cy}=Iy;var Xu={},Py=br,Yp=il;function il(t,e,F,K,J){this.properties={},this.extent=F,this.type=0,this._pbf=t,this._geometry=-1,this._keys=K,this._values=J,t.readFields(Ry,this,e)}function Ry(t,e,F){t==1?e.id=F.readVarint():t==2?function(K,J){for(var ee=K.readVarint()+K.pos;K.pos<ee;){var ie=J._keys[K.readVarint()],oe=J._values[K.readVarint()];J.properties[ie]=oe}}(F,e):t==3?e.type=F.readVarint():t==4&&(e._geometry=F.pos)}function My(t){for(var e,F,K=0,J=0,ee=t.length,ie=ee-1;J<ee;ie=J++)K+=((F=t[ie]).x-(e=t[J]).x)*(e.y+F.y);return K}il.types=["Unknown","Point","LineString","Polygon"],il.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,F=t.readVarint()+t.pos,K=1,J=0,ee=0,ie=0,oe=[];t.pos<F;){if(J<=0){var le=t.readVarint();K=7&le,J=le>>3}if(J--,K===1||K===2)ee+=t.readSVarint(),ie+=t.readSVarint(),K===1&&(e&&oe.push(e),e=[]),e.push(new Py(ee,ie));else{if(K!==7)throw new Error("unknown command "+K);e&&e.push(e[0].clone())}}return e&&oe.push(e),oe},il.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,F=1,K=0,J=0,ee=0,ie=1/0,oe=-1/0,le=1/0,ce=-1/0;t.pos<e;){if(K<=0){var pe=t.readVarint();F=7&pe,K=pe>>3}if(K--,F===1||F===2)(J+=t.readSVarint())<ie&&(ie=J),J>oe&&(oe=J),(ee+=t.readSVarint())<le&&(le=ee),ee>ce&&(ce=ee);else if(F!==7)throw new Error("unknown command "+F)}return[ie,le,oe,ce]},il.prototype.toGeoJSON=function(t,e,F){var K,J,ee=this.extent*Math.pow(2,F),ie=this.extent*t,oe=this.extent*e,le=this.loadGeometry(),ce=il.types[this.type];function pe(xe){for(var we=0;we<xe.length;we++){var Ae=xe[we];xe[we]=[360*(Ae.x+ie)/ee-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ae.y+oe)/ee)*Math.PI/180))-90]}}switch(this.type){case 1:var me=[];for(K=0;K<le.length;K++)me[K]=le[K][0];pe(le=me);break;case 2:for(K=0;K<le.length;K++)pe(le[K]);break;case 3:for(le=function(xe){var we=xe.length;if(we<=1)return[xe];for(var Ae,Re,ze=[],Ze=0;Ze<we;Ze++){var Ue=My(xe[Ze]);Ue!==0&&(Re===void 0&&(Re=Ue<0),Re===Ue<0?(Ae&&ze.push(Ae),Ae=[xe[Ze]]):Ae.push(xe[Ze]))}return Ae&&ze.push(Ae),ze}(le),K=0;K<le.length;K++)for(J=0;J<le[K].length;J++)pe(le[K][J])}le.length===1?le=le[0]:ce="Multi"+ce;var _e={type:"Feature",geometry:{type:ce,coordinates:le},properties:this.properties};return"id"in this&&(_e.id=this.id),_e};var Dy=Yp,Jp=Qp;function Qp(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ly,this,e),this.length=this._features.length}function Ly(t,e,F){t===15?e.version=F.readVarint():t===1?e.name=F.readString():t===5?e.extent=F.readVarint():t===2?e._features.push(F.pos):t===3?e._keys.push(F.readString()):t===4&&e._values.push(function(K){for(var J=null,ee=K.readVarint()+K.pos;K.pos<ee;){var ie=K.readVarint()>>3;J=ie===1?K.readString():ie===2?K.readFloat():ie===3?K.readDouble():ie===4?K.readVarint64():ie===5?K.readVarint():ie===6?K.readSVarint():ie===7?K.readBoolean():null}return J}(F))}Qp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Dy(this._pbf,e,this.extent,this._keys,this._values)};var By=Jp;function ky(t,e,F){if(t===3){var K=new By(F,F.readVarint()+F.pos);K.length&&(e[K.name]=K)}}var xf=Xu.VectorTile=function(t,e){this.layers=t.readFields(ky,{},e)},Yu=Xu.VectorTileFeature=Yp;function Ju(t,e,F,K){const J=[],ee=K===0?(ie,oe,le,ce,pe,me)=>{ie.push(new zt(me,le+(me-oe)/(ce-oe)*(pe-le)))}:(ie,oe,le,ce,pe,me)=>{ie.push(new zt(oe+(me-le)/(pe-le)*(ce-oe),me))};for(const ie of t){const oe=[];for(const le of ie){if(le.length<=2)continue;const ce=[];for(let _e=0;_e<le.length-1;_e++){const xe=le[_e].x,we=le[_e].y,Ae=le[_e+1].x,Re=le[_e+1].y,ze=K===0?xe:we,Ze=K===0?Ae:Re;ze<e?Ze>e&&ee(ce,xe,we,Ae,Re,e):ze>F?Ze<F&&ee(ce,xe,we,Ae,Re,F):ce.push(le[_e]),Ze<e&&ze>=e&&ee(ce,xe,we,Ae,Re,e),Ze>F&&ze<=F&&ee(ce,xe,we,Ae,Re,F)}let pe=le[le.length-1];const me=K===0?pe.x:pe.y;me>=e&&me<=F&&ce.push(pe),ce.length&&(pe=ce[ce.length-1],ce[0].x===pe.x&&ce[0].y===pe.y||ce.push(ce[0]),oe.push(ce))}oe.length&&J.push(oe)}return J}Xu.VectorTileLayer=Jp;const Ny=Yu.types,Fy=Math.pow(2,13);function Ac(t,e,F,K,J,ee,ie,oe){t.emplaceBack((e<<1)+ie,(F<<1)+ee,(Math.floor(K*Fy)<<1)+J,Math.round(oe))}function Oc(t,e,F){t.emplaceBack(e.x,e.y,e.z,F[0]*16384,F[1]*16384,F[2]*16384)}class ed{constructor(){this.acc=new zt(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new zt(e.x,e.y),this.max=new zt(e.x,e.y))}append(e,F){this.currentPolyCount.edges++,this.acc._add(e);const K=this.min,J=this.max;e.x<K.x?K.x=e.x:e.x>J.x&&(J.x=e.x),e.y<K.y?K.y=e.y:e.y>J.y&&(J.y=e.y),((e.x===0||e.x===ur)&&e.x===F.x)!=((e.y===0||e.y===ur)&&e.y===F.y)&&this.processBorderOverlap(e,F),F.x<0!=e.x<0&&this.addBorderIntersection(0,zr(F.y,e.y,(0-F.x)/(e.x-F.x))),F.x>ur!=e.x>ur&&this.addBorderIntersection(1,zr(F.y,e.y,(ur-F.x)/(e.x-F.x))),F.y<0!=e.y<0&&this.addBorderIntersection(2,zr(F.x,e.x,(0-F.y)/(e.y-F.y))),F.y>ur!=e.y>ur&&this.addBorderIntersection(3,zr(F.x,e.x,(ur-F.y)/(e.y-F.y)))}addBorderIntersection(e,F){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const K=this.borders[e];F<K[0]&&(K[0]=F),F>K[1]&&(K[1]=F)}processBorderOverlap(e,F){if(e.x===F.x){if(e.y===F.y)return;const K=e.x===0?0:1;this.addBorderIntersection(K,F.y),this.addBorderIntersection(K,e.y)}else{const K=e.y===0?2:3;this.addBorderIntersection(K,F.x),this.addBorderIntersection(K,e.x)}}centroid(){const e=this.polyCount.reduce((F,K)=>F+K.edges,0);return e!==0?this.acc.div(e)._round():new zt(0,0)}span(){return new zt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,F)=>e+ +(F[0]!==Number.MAX_VALUE),0)}}class Cc{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(F=>F.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new At,this.centroidVertexArray=new uo,this.indexArray=new or,this.programConfigurations=new ns(e.layers,e.zoom),this.segments=new Pi,this.stateDependentLayerIds=this.layers.filter(F=>F.isStateDependent()).map(F=>F.id),this.enableTerrain=e.enableTerrain}populate(e,F,K,J){this.features=[],this.hasPattern=vf("fill-extrusion",this.layers,F),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(ee){const ie=Math.exp(Math.PI*(1-ee.y/(1<<ee.z)*2));return 80150034*ie/(ie*ie+1)/ur/(1<<ee.z)}(K),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:ee,id:ie,index:oe,sourceLayerIndex:le}of e){const ce=this.layers[0]._featureFilter.needGeometry,pe=us(ee,ce);if(!this.layers[0]._featureFilter.filter(new de(this.zoom),pe,K))continue;const me={id:ie,sourceLayerIndex:le,index:oe,geometry:ce?pe.geometry:Ho(ee,K,J),properties:ee.properties,type:ee.type,patterns:{}},_e=this.layoutVertexArray.length;this.hasPattern?this.features.push($f("fill-extrusion",this.layers,me,this.zoom,F)):this.addFeature(me,me.geometry,oe,K,{},F.availableImages,J),F.featureIndex.insert(ee,me.geometry,oe,le,this.index,_e)}this.sortBorders()}addFeatures(e,F,K,J,ee){for(const ie of this.features){const{geometry:oe}=ie;this.addFeature(ie,oe,ie.index,F,K,J,ee)}this.sortBorders()}update(e,F,K,J){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,F,this.stateDependentLayers,K,J)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cy),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Oy.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ay.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,F,K,J,ee,ie,oe){const le=[new zt(0,0),new zt(ur,ur)],ce=oe.projection,pe=ce.name==="globe",me=this.enableTerrain&&!pe?new ed:null,_e=Ny[e.type]==="Polygon";pe&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ft);const xe=gf(F,500);for(let ze=xe.length-1;ze>=0;ze--){const Ze=xe[ze];(Ze.length===0||(we=Ze[0]).every(Ue=>Ue.x<=0)||we.every(Ue=>Ue.x>=ur)||we.every(Ue=>Ue.y<=0)||we.every(Ue=>Ue.y>=ur))&&xe.splice(ze,1)}var we;let Ae;if(pe)Ae=ld(xe,le,J);else{Ae=[];for(const ze of xe)Ae.push({polygon:ze,bounds:le})}const Re=_e?this.edgeRadius:0;for(const{polygon:ze,bounds:Ze}of Ae){let Ue=0,He=0;for(const Xe of ze)_e&&!Xe[0].equals(Xe[Xe.length-1])&&Xe.push(Xe[0]),He+=_e?Xe.length-1:Xe.length;const Ye=this.segments.prepareSegment((_e?5:4)*He,this.layoutVertexArray,this.indexArray);if(_e){const Xe=[],dt=[];Ue=Ye.vertexLength;for(const Tt of ze){let Nt,_t;Tt.length&&Tt!==ze[0]&&dt.push(Xe.length/2),Nt=Tt[1].sub(Tt[0])._perp()._unit();for(let Ct=1;Ct<Tt.length;Ct++){const Pt=Tt[Ct],Lt=Tt[Ct===Tt.length-1?1:Ct+1];let{x:Gt,y:bt}=Pt;if(Re){_t=Lt.sub(Pt)._perp()._unit();const Xt=Nt.add(_t)._unit(),ir=Re*Math.min(4,1/(Nt.x*Xt.x+Nt.y*Xt.y));Gt+=ir*Xt.x,bt+=ir*Xt.y,Nt=_t}Ac(this.layoutVertexArray,Gt,bt,0,0,1,1,0),Ye.vertexLength++,Xe.push(Pt.x,Pt.y),pe&&Oc(this.layoutVertexExtArray,ce.projectTilePoint(Gt,bt,J),ce.upVector(J,Gt,bt))}}const ut=_f(Xe,dt);for(let Tt=0;Tt<ut.length;Tt+=3)this.indexArray.emplaceBack(Ue+ut[Tt],Ue+ut[Tt+2],Ue+ut[Tt+1]),Ye.primitiveLength++}for(const Xe of ze){me&&Xe.length&&me.startRing(Xe[0]);let dt,ut,Tt,Nt=Xe.length>4&&od(Xe[Xe.length-2],Xe[0],Xe[1]),_t=Re?zy(Xe[Xe.length-2],Xe[0],Xe[1],Re):0;ut=Xe[1].sub(Xe[0])._perp()._unit();let Ct=!0;for(let Pt=1,Lt=0;Pt<Xe.length;Pt++){let Gt=Xe[Pt-1],bt=Xe[Pt];const Xt=Xe[Pt===Xe.length-1?1:Pt+1];if(me&&_e&&me.currentPolyCount.top++,nd(bt,Gt,Ze)){Re&&(ut=Xt.sub(bt)._perp()._unit(),Ct=!Ct);continue}me&&me.append(bt,Gt);const ir=bt.sub(Gt)._perp(),Yt=ir.x/(Math.abs(ir.x)+Math.abs(ir.y)),vr=ir.y>0?1:0,Wt=Gt.dist(bt);if(Lt+Wt>32768&&(Lt=0),Re){Tt=Xt.sub(bt)._perp()._unit();let xr=rd(Gt,bt,Xt,td(ut,Tt),Re);isNaN(xr)&&(xr=0);const pr=bt.sub(Gt)._unit();Gt=Gt.add(pr.mult(_t))._round(),bt=bt.add(pr.mult(-xr))._round(),_t=xr,ut=Tt}const cr=Ye.vertexLength,$r=Xe.length>4&&od(Gt,bt,Xt);let jr=ad(Lt,Nt,Ct);if(Ac(this.layoutVertexArray,Gt.x,Gt.y,Yt,vr,0,0,jr),Ac(this.layoutVertexArray,Gt.x,Gt.y,Yt,vr,0,1,jr),Lt+=Wt,jr=ad(Lt,$r,!Ct),Nt=$r,Ac(this.layoutVertexArray,bt.x,bt.y,Yt,vr,0,0,jr),Ac(this.layoutVertexArray,bt.x,bt.y,Yt,vr,0,1,jr),Ye.vertexLength+=4,this.indexArray.emplaceBack(cr+0,cr+1,cr+2),this.indexArray.emplaceBack(cr+1,cr+3,cr+2),Ye.primitiveLength+=2,Re){const xr=Ue+(Pt===1?Xe.length-2:Pt-2),pr=Pt===1?Ue:xr+1;if(this.indexArray.emplaceBack(cr+1,xr,cr+3),this.indexArray.emplaceBack(xr,pr,cr+3),Ye.primitiveLength+=2,dt===void 0&&(dt=cr),!nd(Xt,Xe[Pt],Ze)){const pi=Pt===Xe.length-1?dt:Ye.vertexLength;this.indexArray.emplaceBack(cr+2,cr+3,pi),this.indexArray.emplaceBack(cr+3,pi+1,pi),this.indexArray.emplaceBack(cr+3,pr,pi+1),Ye.primitiveLength+=3}Ct=!Ct}if(pe){const xr=this.layoutVertexExtArray,pr=ce.projectTilePoint(Gt.x,Gt.y,J),pi=ce.projectTilePoint(bt.x,bt.y,J),Tr=ce.upVector(J,Gt.x,Gt.y),Sr=ce.upVector(J,bt.x,bt.y);Oc(xr,pr,Tr),Oc(xr,pr,Tr),Oc(xr,pi,Sr),Oc(xr,pi,Sr)}}_e&&(Ue+=Xe.length-1)}}if(me&&me.polyCount.length>0){if(me.borders){me.vertexArrayOffset=this.centroidVertexArray.length;const ze=me.borders,Ze=this.featuresOnBorder.push(me)-1;for(let Ue=0;Ue<4;Ue++)ze[Ue][0]!==Number.MAX_VALUE&&this.borders[Ue].push(Ze)}this.encodeCentroid(me.borders?void 0:me.centroid(),me)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,K,ee,ie,J)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((F,K)=>this.featuresOnBorder[F].borders[e][0]-this.featuresOnBorder[K].borders[e][0])}encodeCentroid(e,F,K=!0){let J,ee;if(e)if(e.y!==0){const oe=F.span()._mult(this.tileToMeter);J=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(oe.x/10)),ee=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(oe.y/10))}else J=Math.ceil(7*(e.x+450)),ee=0;else J=0,ee=+K;let ie=K?this.centroidVertexArray.length:F.vertexArrayOffset;for(const oe of F.polyCount){K&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*oe.edges+oe.top);for(let le=0;le<oe.top;le++)this.centroidVertexArray.emplace(ie++,J,ee);for(let le=0;le<2*oe.edges;le++)this.centroidVertexArray.emplace(ie++,0,ee),this.centroidVertexArray.emplace(ie++,J,ee)}}}function td(t,e){const F=t.add(e)._unit();return t.x*F.x+t.y*F.y}function zy(t,e,F,K){const J=e.sub(t)._perp()._unit(),ee=F.sub(e)._perp()._unit();return rd(t,e,F,td(J,ee),K)}function rd(t,e,F,K,J){const ee=Math.sqrt(1-K*K);return Math.min(t.dist(e)/3,e.dist(F)/3,J*ee/K)}function nd(t,e,F){return t.x<F[0].x&&e.x<F[0].x||t.x>F[1].x&&e.x>F[1].x||t.y<F[0].y&&e.y<F[0].y||t.y>F[1].y&&e.y>F[1].y}function od(t,e,F){if(t.x<0||t.x>=ur||e.x<0||e.x>=ur||F.x<0||F.x>=ur)return!1;const K=F.sub(e),J=K.perp(),ee=t.sub(e);return(K.x*ee.x+K.y*ee.y)/Math.sqrt((K.x*K.x+K.y*K.y)*(ee.x*ee.x+ee.y*ee.y))>-.866&&J.x*ee.x+J.y*ee.y<0}function ad(t,e,F){const K=e?2|t:-3&t;return F?1|K:-2&K}function sd(){const t=Math.PI/32,e=Math.tan(t),F=wc;return F*Math.sqrt(1+2*e*e)-F}function ld(t,e,F){const K=1<<F.z,J=Nn(F.x/K),ee=Nn((F.x+1)/K),ie=on(F.y/K),oe=on((F.y+1)/K);return function(le,ce,pe,me,_e=0,xe){const we=[];if(!le.length||!pe||!me)return we;const Ae=(Xe,dt)=>{for(const ut of Xe)we.push({polygon:ut,bounds:dt})},Re=Math.ceil(Math.log2(pe)),ze=Math.ceil(Math.log2(me)),Ze=Re-ze,Ue=[];for(let Xe=0;Xe<Math.abs(Ze);Xe++)Ue.push(Ze>0?0:1);for(let Xe=0;Xe<Math.min(Re,ze);Xe++)Ue.push(0),Ue.push(1);let He=le;if(He=Ju(He,ce[0].y-_e,ce[1].y+_e,1),He=Ju(He,ce[0].x-_e,ce[1].x+_e,0),!He.length)return we;const Ye=[];for(Ue.length?Ye.push({polygons:He,bounds:ce,depth:0}):Ae(He,ce);Ye.length;){const Xe=Ye.pop(),dt=Xe.depth,ut=Ue[dt],Tt=Xe.bounds[0],Nt=Xe.bounds[1],_t=ut===0?Tt.x:Tt.y,Ct=ut===0?Nt.x:Nt.y,Pt=xe?xe(ut,_t,Ct):.5*(_t+Ct),Lt=Ju(Xe.polygons,_t-_e,Pt+_e,ut),Gt=Ju(Xe.polygons,Pt-_e,Ct+_e,ut);if(Lt.length){const bt=[Tt,new zt(ut===0?Pt:Nt.x,ut===1?Pt:Nt.y)];Ue.length>dt+1?Ye.push({polygons:Lt,bounds:bt,depth:dt+1}):Ae(Lt,bt)}if(Gt.length){const bt=[new zt(ut===0?Pt:Tt.x,ut===1?Pt:Tt.y),Nt];Ue.length>dt+1?Ye.push({polygons:Gt,bounds:bt,depth:dt+1}):Ae(Gt,bt)}}return we}(t,e,Math.ceil((ee-J)/11.25),Math.ceil((ie-oe)/11.25),1,(le,ce,pe)=>{if(le===0)return .5*(ce+pe);{const me=on((F.y+ce/ur)/K);return(Io(.5*(on((F.y+pe/ur)/K)+me))*K-F.y)*ur}})}tr(Cc,"FillExtrusionBucket",{omit:["layers","features"]}),tr(ed,"PartMetadata");const Uy=new Ge({"fill-extrusion-edge-radius":new Se(Et["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var jy={paint:new Ge({"fill-extrusion-opacity":new Se(Et["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new De(Et["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Se(Et["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Se(Et["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new De(Et["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new De(Et["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new De(Et["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Se(Et["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Se(Et["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Se(Et["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new Se(Et["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Uy};function cd(t,e,F){var K=2*Math.PI*6378137/256/Math.pow(2,F);return[t*K-2*Math.PI*6378137/2,e*K-2*Math.PI*6378137/2]}class Qu{constructor(e,F,K){this.z=e,this.x=F,this.y=K,this.key=Pc(0,e,e,F,K)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,F){const K=function(ee,ie,oe){var le=cd(256*ee,256*(ie=Math.pow(2,oe)-ie-1),oe),ce=cd(256*(ee+1),256*(ie+1),oe);return le[0]+","+le[1]+","+ce[0]+","+ce[1]}(this.x,this.y,this.z),J=function(ee,ie,oe){let le,ce="";for(let pe=ee;pe>0;pe--)le=1<<pe-1,ce+=(ie&le?1:0)+(oe&le?2:0);return ce}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(F==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",J).replace("{bbox-epsg-3857}",K)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ud{constructor(e,F){this.wrap=e,this.canonical=F,this.key=Pc(e,F.z,F.z,F.x,F.y)}}class yn{constructor(e,F,K,J,ee){this.overscaledZ=e,this.wrap=F,this.canonical=new Qu(K,+J,+ee),this.key=F===0&&e===K?this.canonical.key:Pc(F,e,K,J,ee)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const F=this.canonical.z-e;return e>this.canonical.z?new yn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yn(e,this.wrap,e,this.canonical.x>>F,this.canonical.y>>F)}calculateScaledKey(e,F=!0){if(this.overscaledZ===e&&F)return this.key;if(e>this.canonical.z)return Pc(this.wrap*+F,e,this.canonical.z,this.canonical.x,this.canonical.y);{const K=this.canonical.z-e;return Pc(this.wrap*+F,e,e,this.canonical.x>>K,this.canonical.y>>K)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const F=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>F&&e.canonical.y===this.canonical.y>>F}children(e){if(this.overscaledZ>=e)return[new yn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const F=this.canonical.z+1,K=2*this.canonical.x,J=2*this.canonical.y;return[new yn(F,this.wrap,F,K,J),new yn(F,this.wrap,F,K+1,J),new yn(F,this.wrap,F,K,J+1),new yn(F,this.wrap,F,K+1,J+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new yn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new yn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ud(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Pc(t,e,F,K,J){const ee=1<<Math.min(F,22);let ie=ee*(J%ee)+K%ee;return t&&F<22&&(ie+=ee*ee*((t<0?-2*t-1:2*t)%(1<<2*(22-F)))),16*(32*ie+F)+(e-F)}tr(Qu,"CanonicalTileID"),tr(yn,"OverscaledTileID",{omit:["projMatrix"]});class nl extends zt{constructor(e,F,K){super(e,F),this.z=K}}function Rc(t,e){return t.x*e.x+t.y*e.y}function hd(t,e){if(t.length===1){let F=0;const K=e[F++];let J;for(;!J||K.equals(J);)if(J=e[F++],!J)return 1/0;for(;F<e.length;F++){const ee=e[F],ie=t[0],oe=J.sub(K),le=ee.sub(K),ce=ie.sub(K),pe=Rc(oe,oe),me=Rc(oe,le),_e=Rc(le,le),xe=Rc(ce,oe),we=Rc(ce,le),Ae=pe*_e-me*me,Re=(_e*xe-me*we)/Ae,ze=(pe*we-me*xe)/Ae,Ze=K.z*(1-Re-ze)+J.z*Re+ee.z*ze;if(isFinite(Ze))return Ze}return 1/0}{let F=1/0;for(const K of e)F=Math.min(F,K.z);return F}}function fd(t,e,F,K,J,ee,ie,oe){const le=ie*J.getElevationAt(t,e,!0,!0),ce=ee[0]!==0,pe=ce?ee[1]===0?ie*(ee[0]/7-450):ie*function(me,_e,xe){const we=Math.floor(_e[0]/8),Ae=Math.floor(_e[1]/8),Re=10*(_e[0]-8*we),ze=10*(_e[1]-8*Ae),Ze=me.getElevationAt(we,Ae,!0,!0),Ue=me.getMeterToDEM(xe),He=Math.floor(.5*(Re*Ue-1)),Ye=Math.floor(.5*(ze*Ue-1)),Xe=me.tileCoordToPixel(we,Ae),dt=2*He+1,ut=2*Ye+1,Tt=function(Gt,bt,Xt,ir,Yt){return[Gt.getElevationAtPixel(bt,Xt,!0),Gt.getElevationAtPixel(bt+Yt,Xt,!0),Gt.getElevationAtPixel(bt,Xt+Yt,!0),Gt.getElevationAtPixel(bt+ir,Xt+Yt,!0)]}(me,Xe.x-He,Xe.y-Ye,dt,ut),Nt=Math.abs(Tt[0]-Tt[1]),_t=Math.abs(Tt[2]-Tt[3]),Ct=Math.abs(Tt[0]-Tt[2])+Math.abs(Tt[1]-Tt[3]),Pt=Math.min(.25,.5*Ue*(Nt+_t)/dt),Lt=Math.min(.25,.5*Ue*Ct/ut);return Ze+Math.max(Pt*Re,Lt*ze)}(J,ee,oe):le;return{base:le+(F===0)?-1:F,top:ce?Math.max(pe+K,le+F+2):le+K}}const Vy=nt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Gy}=Vy,Wy=nt([{name:"a_packed",components:4,type:"Float32"}]),{members:qy}=Wy,Hy=Yu.types,Ky=Math.cos(Math.PI/180*37.5);class eh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(F=>F.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(F=>{this.gradients[F.id]={}}),this.layoutVertexArray=new yt,this.layoutVertexArray2=new Bt,this.indexArray=new or,this.programConfigurations=new ns(e.layers,e.zoom),this.segments=new Pi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(F=>F.isStateDependent()).map(F=>F.id)}populate(e,F,K,J){this.hasPattern=vf("line",this.layers,F);const ee=this.layers[0].layout.get("line-sort-key"),ie=[];for(const{feature:pe,id:me,index:_e,sourceLayerIndex:xe}of e){const we=this.layers[0]._featureFilter.needGeometry,Ae=us(pe,we);if(!this.layers[0]._featureFilter.filter(new de(this.zoom),Ae,K))continue;const Re=ee?ee.evaluate(Ae,{},K):void 0,ze={id:me,properties:pe.properties,type:pe.type,sourceLayerIndex:xe,index:_e,geometry:we?Ae.geometry:Ho(pe,K,J),patterns:{},sortKey:Re};ie.push(ze)}ee&&ie.sort((pe,me)=>pe.sortKey-me.sortKey);const{lineAtlas:oe,featureIndex:le}=F,ce=this.addConstantDashes(oe);for(const pe of ie){const{geometry:me,index:_e,sourceLayerIndex:xe}=pe;if(ce&&this.addFeatureDashes(pe,oe),this.hasPattern){const we=$f("line",this.layers,pe,this.zoom,F);this.patternFeatures.push(we)}else this.addFeature(pe,me,_e,K,oe.positions,F.availableImages);le.insert(e[_e].feature,me,_e,xe,this.index)}}addConstantDashes(e){let F=!1;for(const K of this.layers){const J=K.paint.get("line-dasharray").value,ee=K.layout.get("line-cap").value;if(J.kind!=="constant"||ee.kind!=="constant")F=!0;else{const ie=ee.value,oe=J.value;if(!oe)continue;e.addDash(oe,ie)}}return F}addFeatureDashes(e,F){const K=this.zoom;for(const J of this.layers){const ee=J.paint.get("line-dasharray").value,ie=J.layout.get("line-cap").value;if(ee.kind==="constant"&&ie.kind==="constant")continue;let oe,le;if(ee.kind==="constant"){if(oe=ee.value,!oe)continue}else oe=ee.evaluate({zoom:K},e);le=ie.kind==="constant"?ie.value:ie.evaluate({zoom:K},e),F.addDash(oe,le),e.patterns[J.id]=F.getKey(oe,le)}}update(e,F,K,J){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,F,this.stateDependentLayers,K,J)}addFeatures(e,F,K,J,ee){for(const ie of this.patternFeatures)this.addFeature(ie,ie.geometry,ie.index,F,K,J)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,qy)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gy),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,F,K,J,ee,ie){const oe=this.layers[0].layout,le=oe.get("line-join").evaluate(e,{}),ce=oe.get("line-cap").evaluate(e,{}),pe=oe.get("line-miter-limit"),me=oe.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const _e of F)this.addLine(_e,e,le,ce,pe,me);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,K,ee,ie,J)}addLine(e,F,K,J,ee,ie){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ze=0;ze<e.length-1;ze++)this.totalDistance+=e[ze].dist(e[ze+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const oe=Hy[F.type]==="Polygon";let le=e.length;for(;le>=2&&e[le-1].equals(e[le-2]);)le--;let ce=0;for(;ce<le-1&&e[ce].equals(e[ce+1]);)ce++;if(le<(oe?3:2))return;K==="bevel"&&(ee=1.05);const pe=this.overscaling<=16?15*ur/(512*this.overscaling):0,me=this.segments.prepareSegment(10*le,this.layoutVertexArray,this.indexArray);let _e,xe,we,Ae,Re;this.e1=this.e2=-1,oe&&(_e=e[le-2],Re=e[ce].sub(_e)._unit()._perp());for(let ze=ce;ze<le;ze++){if(we=ze===le-1?oe?e[ce+1]:void 0:e[ze+1],we&&e[ze].equals(we))continue;Re&&(Ae=Re),_e&&(xe=_e),_e=e[ze],Re=we?we.sub(_e)._unit()._perp():Ae,Ae=Ae||Re;let Ze=Ae.add(Re);Ze.x===0&&Ze.y===0||Ze._unit();const Ue=Ae.x*Re.x+Ae.y*Re.y,He=Ze.x*Re.x+Ze.y*Re.y,Ye=He!==0?1/He:1/0,Xe=2*Math.sqrt(2-2*He),dt=He<Ky&&xe&&we,ut=Ae.x*Re.y-Ae.y*Re.x>0;if(dt&&ze>ce){const _t=_e.dist(xe);if(_t>2*pe){const Ct=_e.sub(_e.sub(xe)._mult(pe/_t)._round());this.updateDistance(xe,Ct),this.addCurrentVertex(Ct,Ae,0,0,me),xe=Ct}}const Tt=xe&&we;let Nt=Tt?K:oe?"butt":J;if(Tt&&Nt==="round"&&(Ye<ie?Nt="miter":Ye<=2&&(Nt="fakeround")),Nt==="miter"&&Ye>ee&&(Nt="bevel"),Nt==="bevel"&&(Ye>2&&(Nt="flipbevel"),Ye<ee&&(Nt="miter")),xe&&this.updateDistance(xe,_e),Nt==="miter")Ze._mult(Ye),this.addCurrentVertex(_e,Ze,0,0,me);else if(Nt==="flipbevel"){if(Ye>100)Ze=Re.mult(-1);else{const _t=Ye*Ae.add(Re).mag()/Ae.sub(Re).mag();Ze._perp()._mult(_t*(ut?-1:1))}this.addCurrentVertex(_e,Ze,0,0,me),this.addCurrentVertex(_e,Ze.mult(-1),0,0,me)}else if(Nt==="bevel"||Nt==="fakeround"){const _t=-Math.sqrt(Ye*Ye-1),Ct=ut?_t:0,Pt=ut?0:_t;if(xe&&this.addCurrentVertex(_e,Ae,Ct,Pt,me),Nt==="fakeround"){const Lt=Math.round(180*Xe/Math.PI/20);for(let Gt=1;Gt<Lt;Gt++){let bt=Gt/Lt;if(bt!==.5){const ir=bt-.5;bt+=bt*ir*(bt-1)*((1.0904+Ue*(Ue*(3.55645-1.43519*Ue)-3.2452))*ir*ir+(.848013+Ue*(.215638*Ue-1.06021)))}const Xt=Re.sub(Ae)._mult(bt)._add(Ae)._unit()._mult(ut?-1:1);this.addHalfVertex(_e,Xt.x,Xt.y,!1,ut,0,me)}}we&&this.addCurrentVertex(_e,Re,-Ct,-Pt,me)}else if(Nt==="butt")this.addCurrentVertex(_e,Ze,0,0,me);else if(Nt==="square"){const _t=xe?1:-1;xe||this.addCurrentVertex(_e,Ze,_t,_t,me),this.addCurrentVertex(_e,Ze,0,0,me),xe&&this.addCurrentVertex(_e,Ze,_t,_t,me)}else Nt==="round"&&(xe&&(this.addCurrentVertex(_e,Ae,0,0,me),this.addCurrentVertex(_e,Ae,1,1,me,!0)),we&&(this.addCurrentVertex(_e,Re,-1,-1,me,!0),this.addCurrentVertex(_e,Re,0,0,me)));if(dt&&ze<le-1){const _t=_e.dist(we);if(_t>2*pe){const Ct=_e.add(we.sub(_e)._mult(pe/_t)._round());this.updateDistance(_e,Ct),this.addCurrentVertex(Ct,Re,0,0,me),_e=Ct}}}}addCurrentVertex(e,F,K,J,ee,ie=!1){const oe=F.y*J-F.x,le=-F.y-F.x*J;this.addHalfVertex(e,F.x+F.y*K,F.y-F.x*K,ie,!1,K,ee),this.addHalfVertex(e,oe,le,ie,!0,-J,ee)}addHalfVertex({x:e,y:F},K,J,ee,ie,oe,le){this.layoutVertexArray.emplaceBack((e<<1)+(ee?1:0),(F<<1)+(ie?1:0),Math.round(63*K)+128,Math.round(63*J)+128,1+(oe===0?0:oe<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const ce=le.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,ce),le.primitiveLength++),ie?this.e2=ce:this.e1=ce}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,F){this.distance+=e.dist(F),this.updateScaledDistance()}}tr(eh,"LineBucket",{omit:["layers","patternFeatures"]});const Zy=new Ge({"line-cap":new De(Et.layout_line["line-cap"]),"line-join":new De(Et.layout_line["line-join"]),"line-miter-limit":new Se(Et.layout_line["line-miter-limit"]),"line-round-limit":new Se(Et.layout_line["line-round-limit"]),"line-sort-key":new De(Et.layout_line["line-sort-key"])});var pd={paint:new Ge({"line-opacity":new De(Et.paint_line["line-opacity"]),"line-color":new De(Et.paint_line["line-color"]),"line-translate":new Se(Et.paint_line["line-translate"]),"line-translate-anchor":new Se(Et.paint_line["line-translate-anchor"]),"line-width":new De(Et.paint_line["line-width"]),"line-gap-width":new De(Et.paint_line["line-gap-width"]),"line-offset":new De(Et.paint_line["line-offset"]),"line-blur":new De(Et.paint_line["line-blur"]),"line-dasharray":new De(Et.paint_line["line-dasharray"]),"line-pattern":new De(Et.paint_line["line-pattern"]),"line-gradient":new Ve(Et.paint_line["line-gradient"]),"line-trim-offset":new Se(Et.paint_line["line-trim-offset"])}),layout:Zy};const dd=new class extends De{possiblyEvaluate(t,e){return e=new de(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,F,K){return e=mr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,F,K)}}(pd.paint.properties["line-width"].specification);function md(t,e){return e>0?e+2*t:t}dd.useIntegerZoom=!0;const Xy=nt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Yy=nt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Jy=nt([{name:"a_projected_pos",components:4,type:"Float32"}],4);nt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Qy=nt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),e_=nt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);nt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yd=nt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),t_=nt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);nt([{name:"triangle",components:3,type:"Uint16"}]),nt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),nt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),nt([{type:"Float32",name:"offsetX"}]),nt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Zi=24;const _o=128;function bf(t,e){const{expression:F}=e;if(F.kind==="constant")return{kind:"constant",layoutSize:F.evaluate(new de(t+1))};if(F.kind==="source")return{kind:"source"};{const{zoomStops:K,interpolationType:J}=F;let ee=0;for(;ee<K.length&&K[ee]<=t;)ee++;ee=Math.max(0,ee-1);let ie=ee;for(;ie<K.length&&K[ie]<t+1;)ie++;ie=Math.min(K.length-1,ie);const oe=K[ee],le=K[ie];return F.kind==="composite"?{kind:"composite",minZoom:oe,maxZoom:le,interpolationType:J}:{kind:"camera",minZoom:oe,maxZoom:le,minSize:F.evaluate(new de(oe)),maxSize:F.evaluate(new de(le)),interpolationType:J}}}function th(t,{uSize:e,uSizeT:F},{lowerSize:K,upperSize:J}){return t.kind==="source"?K/_o:t.kind==="composite"?zr(K/_o,J/_o,F):e}function ol(t,e){let F=0,K=0;if(t.kind==="constant")K=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:J,minZoom:ee,maxZoom:ie}=t,oe=J?ht(qn.interpolationFactor(J,e,ee,ie),0,1):0;t.kind==="camera"?K=zr(t.minSize,t.maxSize,oe):F=oe}return{uSizeT:F,uSize:K}}var r_=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:_o,evaluateSizeForFeature:th,evaluateSizeForZoom:ol,getSizeData:bf});function i_(t,e,F){return t.sections.forEach(K=>{K.text=function(J,ee,ie){const oe=ee.layout.get("text-transform").evaluate(ie,{});return oe==="uppercase"?J=J.toLocaleUpperCase():oe==="lowercase"&&(J=J.toLocaleLowerCase()),fe.applyArabicShaping&&(J=fe.applyArabicShaping(J)),J}(K.text,e,F)}),t}const Mc={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹","â":"â","â":"â"};function n_(t){return t==="ï¸¶"||t==="ï¹"||t==="ï¸¸"||t==="ï¹"||t==="ï¹"||t==="ï¸¾"||t==="ï¸¼"||t==="ï¸º"||t==="ï¸"||t==="ï¹"||t==="ï¸"||t==="ï¸"||t==="ï¸"||t==="ï½"||t==="ï¿£"||t==="ï¸"||t==="ï¸"}function o_(t){return t==="ï¸µ"||t==="ï¹"||t==="ï¸·"||t==="ï¹"||t==="ï¹"||t==="ï¸½"||t==="ï¸»"||t==="ï¸¹"||t==="ï¸"||t==="ï¸¿"}var _d=li,gd=function(t,e,F,K,J){var ee,ie,oe=8*J-K-1,le=(1<<oe)-1,ce=le>>1,pe=-7,me=F?J-1:0,_e=F?-1:1,xe=t[e+me];for(me+=_e,ee=xe&(1<<-pe)-1,xe>>=-pe,pe+=oe;pe>0;ee=256*ee+t[e+me],me+=_e,pe-=8);for(ie=ee&(1<<-pe)-1,ee>>=-pe,pe+=K;pe>0;ie=256*ie+t[e+me],me+=_e,pe-=8);if(ee===0)ee=1-ce;else{if(ee===le)return ie?NaN:1/0*(xe?-1:1);ie+=Math.pow(2,K),ee-=ce}return(xe?-1:1)*ie*Math.pow(2,ee-K)},vd=function(t,e,F,K,J,ee){var ie,oe,le,ce=8*ee-J-1,pe=(1<<ce)-1,me=pe>>1,_e=J===23?Math.pow(2,-24)-Math.pow(2,-77):0,xe=K?0:ee-1,we=K?1:-1,Ae=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(oe=isNaN(e)?1:0,ie=pe):(ie=Math.floor(Math.log(e)/Math.LN2),e*(le=Math.pow(2,-ie))<1&&(ie--,le*=2),(e+=ie+me>=1?_e/le:_e*Math.pow(2,1-me))*le>=2&&(ie++,le/=2),ie+me>=pe?(oe=0,ie=pe):ie+me>=1?(oe=(e*le-1)*Math.pow(2,J),ie+=me):(oe=e*Math.pow(2,me-1)*Math.pow(2,J),ie=0));J>=8;t[F+xe]=255&oe,xe+=we,oe/=256,J-=8);for(ie=ie<<J|oe,ce+=J;ce>0;t[F+xe]=255&ie,xe+=we,ie/=256,ce-=8);t[F+xe-we]|=128*Ae};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function li(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}li.Varint=0,li.Fixed64=1,li.Bytes=2,li.Fixed32=5;var wf=4294967296,$d=1/wf,xd=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Zo(t){return t.type===li.Bytes?t.readVarint()+t.pos:t.pos+1}function al(t,e,F){return F?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function bd(t,e,F){var K=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));F.realloc(K);for(var J=F.pos-1;J>=t;J--)F.buf[J+K]=F.buf[J]}function a_(t,e){for(var F=0;F<t.length;F++)e.writeVarint(t[F])}function s_(t,e){for(var F=0;F<t.length;F++)e.writeSVarint(t[F])}function l_(t,e){for(var F=0;F<t.length;F++)e.writeFloat(t[F])}function c_(t,e){for(var F=0;F<t.length;F++)e.writeDouble(t[F])}function u_(t,e){for(var F=0;F<t.length;F++)e.writeBoolean(t[F])}function h_(t,e){for(var F=0;F<t.length;F++)e.writeFixed32(t[F])}function f_(t,e){for(var F=0;F<t.length;F++)e.writeSFixed32(t[F])}function p_(t,e){for(var F=0;F<t.length;F++)e.writeFixed64(t[F])}function d_(t,e){for(var F=0;F<t.length;F++)e.writeSFixed64(t[F])}function rh(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function sl(t,e,F){t[F]=e,t[F+1]=e>>>8,t[F+2]=e>>>16,t[F+3]=e>>>24}function wd(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}li.prototype={destroy:function(){this.buf=null},readFields:function(t,e,F){for(F=F||this.length;this.pos<F;){var K=this.readVarint(),J=K>>3,ee=this.pos;this.type=7&K,t(J,e,this),this.pos===ee&&this.skip(K)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=rh(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=wd(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=rh(this.buf,this.pos)+rh(this.buf,this.pos+4)*wf;return this.pos+=8,t},readSFixed64:function(){var t=rh(this.buf,this.pos)+wd(this.buf,this.pos+4)*wf;return this.pos+=8,t},readFloat:function(){var t=gd(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=gd(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,F,K=this.buf;return e=127&(F=K[this.pos++]),F<128?e:(e|=(127&(F=K[this.pos++]))<<7,F<128?e:(e|=(127&(F=K[this.pos++]))<<14,F<128?e:(e|=(127&(F=K[this.pos++]))<<21,F<128?e:function(J,ee,ie){var oe,le,ce=ie.buf;if(oe=(112&(le=ce[ie.pos++]))>>4,le<128||(oe|=(127&(le=ce[ie.pos++]))<<3,le<128)||(oe|=(127&(le=ce[ie.pos++]))<<10,le<128)||(oe|=(127&(le=ce[ie.pos++]))<<17,le<128)||(oe|=(127&(le=ce[ie.pos++]))<<24,le<128)||(oe|=(1&(le=ce[ie.pos++]))<<31,le<128))return al(J,oe,ee);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(F=K[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&xd?function(F,K,J){return xd.decode(F.subarray(K,J))}(this.buf,e,t):function(F,K,J){for(var ee="",ie=K;ie<J;){var oe,le,ce,pe=F[ie],me=null,_e=pe>239?4:pe>223?3:pe>191?2:1;if(ie+_e>J)break;_e===1?pe<128&&(me=pe):_e===2?(192&(oe=F[ie+1]))==128&&(me=(31&pe)<<6|63&oe)<=127&&(me=null):_e===3?(le=F[ie+2],(192&(oe=F[ie+1]))==128&&(192&le)==128&&((me=(15&pe)<<12|(63&oe)<<6|63&le)<=2047||me>=55296&&me<=57343)&&(me=null)):_e===4&&(le=F[ie+2],ce=F[ie+3],(192&(oe=F[ie+1]))==128&&(192&le)==128&&(192&ce)==128&&((me=(15&pe)<<18|(63&oe)<<12|(63&le)<<6|63&ce)<=65535||me>=1114112)&&(me=null)),me===null?(me=65533,_e=1):me>65535&&(me-=65536,ee+=String.fromCharCode(me>>>10&1023|55296),me=56320|1023&me),ee+=String.fromCharCode(me),ie+=_e}return ee}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==li.Bytes)return t.push(this.readVarint(e));var F=Zo(this);for(t=t||[];this.pos<F;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==li.Bytes)return t.push(this.readSVarint());var e=Zo(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==li.Bytes)return t.push(this.readBoolean());var e=Zo(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==li.Bytes)return t.push(this.readFloat());var e=Zo(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==li.Bytes)return t.push(this.readDouble());var e=Zo(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==li.Bytes)return t.push(this.readFixed32());var e=Zo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==li.Bytes)return t.push(this.readSFixed32());var e=Zo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==li.Bytes)return t.push(this.readFixed64());var e=Zo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==li.Bytes)return t.push(this.readSFixed64());var e=Zo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===li.Varint)for(;this.buf[this.pos++]>127;);else if(e===li.Bytes)this.pos=this.readVarint()+this.pos;else if(e===li.Fixed32)this.pos+=4;else{if(e!==li.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var F=new Uint8Array(e);F.set(this.buf),this.buf=F,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),sl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),sl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),sl(this.buf,-1&t,this.pos),sl(this.buf,Math.floor(t*$d),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),sl(this.buf,-1&t,this.pos),sl(this.buf,Math.floor(t*$d),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,F){var K,J;if(e>=0?(K=e%4294967296|0,J=e/4294967296|0):(J=~(-e/4294967296),4294967295^(K=~(-e%4294967296))?K=K+1|0:(K=0,J=J+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");F.realloc(10),function(ee,ie,oe){oe.buf[oe.pos++]=127&ee|128,ee>>>=7,oe.buf[oe.pos++]=127&ee|128,ee>>>=7,oe.buf[oe.pos++]=127&ee|128,ee>>>=7,oe.buf[oe.pos++]=127&ee|128,oe.buf[oe.pos]=127&(ee>>>=7)}(K,0,F),function(ee,ie){var oe=(7&ee)<<4;ie.buf[ie.pos++]|=oe|((ee>>>=3)?128:0),ee&&(ie.buf[ie.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ie.buf[ie.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ie.buf[ie.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ie.buf[ie.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ie.buf[ie.pos++]=127&ee)))))}(J,F)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(K,J,ee){for(var ie,oe,le=0;le<J.length;le++){if((ie=J.charCodeAt(le))>55295&&ie<57344){if(!oe){ie>56319||le+1===J.length?(K[ee++]=239,K[ee++]=191,K[ee++]=189):oe=ie;continue}if(ie<56320){K[ee++]=239,K[ee++]=191,K[ee++]=189,oe=ie;continue}ie=oe-55296<<10|ie-56320|65536,oe=null}else oe&&(K[ee++]=239,K[ee++]=191,K[ee++]=189,oe=null);ie<128?K[ee++]=ie:(ie<2048?K[ee++]=ie>>6|192:(ie<65536?K[ee++]=ie>>12|224:(K[ee++]=ie>>18|240,K[ee++]=ie>>12&63|128),K[ee++]=ie>>6&63|128),K[ee++]=63&ie|128)}return ee}(this.buf,t,this.pos);var F=this.pos-e;F>=128&&bd(e,F,this),this.pos=e-1,this.writeVarint(F),this.pos+=F},writeFloat:function(t){this.realloc(4),vd(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),vd(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var F=0;F<e;F++)this.buf[this.pos++]=t[F]},writeRawMessage:function(t,e){this.pos++;var F=this.pos;t(e,this);var K=this.pos-F;K>=128&&bd(F,K,this),this.pos=F-1,this.writeVarint(K),this.pos+=K},writeMessage:function(t,e,F){this.writeTag(t,li.Bytes),this.writeRawMessage(e,F)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,a_,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,s_,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,u_,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,l_,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,c_,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,h_,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,f_,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,p_,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,d_,e)},writeBytesField:function(t,e){this.writeTag(t,li.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,li.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,li.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,li.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,li.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,li.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,li.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,li.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,li.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,li.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var ih=sr(_d);const Ef=3;function m_(t,e,F){e.glyphs=[],t===1&&F.readMessage(y_,e)}function y_(t,e,F){if(t===3){const{id:K,bitmap:J,width:ee,height:ie,left:oe,top:le,advance:ce}=F.readMessage(__,{});e.glyphs.push({id:K,bitmap:new Ko({width:ee+2*Ef,height:ie+2*Ef},J),metrics:{width:ee,height:ie,left:oe,top:le,advance:ce}})}else t===4?e.ascender=F.readSVarint():t===5&&(e.descender=F.readSVarint())}function __(t,e,F){t===1?e.id=F.readVarint():t===2?e.bitmap=F.readBytes():t===3?e.width=F.readVarint():t===4?e.height=F.readVarint():t===5?e.left=F.readSVarint():t===6?e.top=F.readSVarint():t===7&&(e.advance=F.readVarint())}const Ed=Ef;function Tf(t){let e=0,F=0;for(const ie of t)e+=ie.w*ie.h,F=Math.max(F,ie.w);t.sort((ie,oe)=>oe.h-ie.h);const K=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),F),h:1/0}];let J=0,ee=0;for(const ie of t)for(let oe=K.length-1;oe>=0;oe--){const le=K[oe];if(!(ie.w>le.w||ie.h>le.h)){if(ie.x=le.x,ie.y=le.y,ee=Math.max(ee,ie.y+ie.h),J=Math.max(J,ie.x+ie.w),ie.w===le.w&&ie.h===le.h){const ce=K.pop();oe<K.length&&(K[oe]=ce)}else ie.h===le.h?(le.x+=ie.w,le.w-=ie.w):ie.w===le.w?(le.y+=ie.h,le.h-=ie.h):(K.push({x:le.x+ie.w,y:le.y,w:le.w-ie.w,h:ie.h}),le.y+=ie.h,le.h-=ie.h);break}}return{w:J,h:ee,fill:e/(J*ee)||0}}const bn=1;class Sf{constructor(e,{pixelRatio:F,version:K,stretchX:J,stretchY:ee,content:ie}){this.paddedRect=e,this.pixelRatio=F,this.stretchX=J,this.stretchY=ee,this.content=ie,this.version=K}get tl(){return[this.paddedRect.x+bn,this.paddedRect.y+bn]}get br(){return[this.paddedRect.x+this.paddedRect.w-bn,this.paddedRect.y+this.paddedRect.h-bn]}get displaySize(){return[(this.paddedRect.w-2*bn)/this.pixelRatio,(this.paddedRect.h-2*bn)/this.pixelRatio]}}class Td{constructor(e,F){const K={},J={};this.haveRenderCallbacks=[];const ee=[];this.addImages(e,K,ee),this.addImages(F,J,ee);const{w:ie,h:oe}=Tf(ee),le=new Cn({width:ie||1,height:oe||1});for(const ce in e){const pe=e[ce],me=K[ce].paddedRect;Cn.copy(pe.data,le,{x:0,y:0},{x:me.x+bn,y:me.y+bn},pe.data)}for(const ce in F){const pe=F[ce],me=J[ce].paddedRect,_e=me.x+bn,xe=me.y+bn,we=pe.data.width,Ae=pe.data.height;Cn.copy(pe.data,le,{x:0,y:0},{x:_e,y:xe},pe.data),Cn.copy(pe.data,le,{x:0,y:Ae-1},{x:_e,y:xe-1},{width:we,height:1}),Cn.copy(pe.data,le,{x:0,y:0},{x:_e,y:xe+Ae},{width:we,height:1}),Cn.copy(pe.data,le,{x:we-1,y:0},{x:_e-1,y:xe},{width:1,height:Ae}),Cn.copy(pe.data,le,{x:0,y:0},{x:_e+we,y:xe},{width:1,height:Ae})}this.image=le,this.iconPositions=K,this.patternPositions=J}addImages(e,F,K){for(const J in e){const ee=e[J],ie={x:0,y:0,w:ee.data.width+2*bn,h:ee.data.height+2*bn};K.push(ie),F[J]=new Sf(ie,ee),ee.hasRenderCallback&&this.haveRenderCallbacks.push(J)}}patchUpdatedImages(e,F){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(K=>e.hasImage(K)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const K in e.updatedImages)this.patchUpdatedImage(this.iconPositions[K],e.getImage(K),F),this.patchUpdatedImage(this.patternPositions[K],e.getImage(K),F)}patchUpdatedImage(e,F,K){if(!e||!F||e.version===F.version)return;e.version=F.version;const[J,ee]=e.tl;K.update(F.data,void 0,{x:J,y:ee})}}tr(Sf,"ImagePosition"),tr(Td,"ImageAtlas");const Fn={horizontal:1,vertical:2,horizontalOnly:3},Sd=-17;class Dc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,F){const K=new Dc;return K.scale=e||1,K.fontStack=F,K}static forImage(e){const F=new Dc;return F.imageName=e,F}}class ll{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,F){const K=new ll;for(let J=0;J<e.sections.length;J++){const ee=e.sections[J];ee.image?K.addImageSection(ee):K.addTextSection(ee,F)}return K}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(F,K){let J="";for(let ee=0;ee<F.length;ee++){const ie=F.charCodeAt(ee+1)||null,oe=F.charCodeAt(ee-1)||null;J+=!K&&(ie&&Ru(ie)&&!Mc[F[ee+1]]||oe&&Ru(oe)&&!Mc[F[ee-1]])||!Mc[F[ee]]?F[ee]:Mc[F[ee]]}return J}(this.text,e)}trim(){let e=0;for(let K=0;K<this.text.length&&nh[this.text.charCodeAt(K)];K++)e++;let F=this.text.length;for(let K=this.text.length-1;K>=0&&K>=e&&nh[this.text.charCodeAt(K)];K--)F--;this.text=this.text.substring(e,F),this.sectionIndex=this.sectionIndex.slice(e,F)}substring(e,F){const K=new ll;return K.text=this.text.substring(e,F),K.sectionIndex=this.sectionIndex.slice(e,F),K.sections=this.sections,K}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,F)=>Math.max(e,this.sections[F].scale),0)}addTextSection(e,F){this.text+=e.text,this.sections.push(Dc.forText(e.scale,e.fontStack||F));const K=this.sections.length-1;for(let J=0;J<e.text.length;++J)this.sectionIndex.push(K)}addImageSection(e){const F=e.image?e.image.name:"";if(F.length===0)return void di("Can't add FormattedSection with an empty image.");const K=this.getNextImageSectionCharCode();K?(this.text+=String.fromCharCode(K),this.sections.push(Dc.forImage(F)),this.sectionIndex.push(this.sections.length-1)):di("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function If(t,e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe,we){const Ae=ll.fromFeature(t,J);me===Fn.vertical&&Ae.verticalizePunctuation(_e);let Re=[];const ze=function(Xe,dt,ut,Tt,Nt,_t){if(!Xe)return[];const Ct=[],Pt=function(Xt,ir,Yt,vr,Wt,cr){let $r=0;for(let jr=0;jr<Xt.length();jr++){const xr=Xt.getSection(jr);$r+=Id(Xt.getCharCode(jr),xr,vr,Wt,ir,cr)}return $r/Math.max(1,Math.ceil($r/Yt))}(Xe,dt,ut,Tt,Nt,_t),Lt=Xe.text.indexOf("â")>=0;let Gt=0;for(let Xt=0;Xt<Xe.length();Xt++){const ir=Xe.getSection(Xt),Yt=Xe.getCharCode(Xt);if(nh[Yt]||(Gt+=Id(Yt,ir,Tt,Nt,dt,_t)),Xt<Xe.length()-1){const vr=!((bt=Yt)<11904||!(Jt["Bopomofo Extended"](bt)||Jt.Bopomofo(bt)||Jt["CJK Compatibility Forms"](bt)||Jt["CJK Compatibility Ideographs"](bt)||Jt["CJK Compatibility"](bt)||Jt["CJK Radicals Supplement"](bt)||Jt["CJK Strokes"](bt)||Jt["CJK Symbols and Punctuation"](bt)||Jt["CJK Unified Ideographs Extension A"](bt)||Jt["CJK Unified Ideographs"](bt)||Jt["Enclosed CJK Letters and Months"](bt)||Jt["Halfwidth and Fullwidth Forms"](bt)||Jt.Hiragana(bt)||Jt["Ideographic Description Characters"](bt)||Jt["Kangxi Radicals"](bt)||Jt["Katakana Phonetic Extensions"](bt)||Jt.Katakana(bt)||Jt["Vertical Forms"](bt)||Jt["Yi Radicals"](bt)||Jt["Yi Syllables"](bt)));(g_[Yt]||vr||ir.imageName)&&Ct.push(Od(Xt+1,Gt,Pt,Ct,v_(Yt,Xe.getCharCode(Xt+1),vr&&Lt),!1))}}var bt;return Cd(Od(Xe.length(),Gt,Pt,Ct,0,!0))}(Ae,ce,ee,e,K,xe),{processBidirectionalText:Ze,processStyledBidirectionalText:Ue}=fe;if(Ze&&Ae.sections.length===1){const Xe=Ze(Ae.toString(),ze);for(const dt of Xe){const ut=new ll;ut.text=dt,ut.sections=Ae.sections;for(let Tt=0;Tt<dt.length;Tt++)ut.sectionIndex.push(0);Re.push(ut)}}else if(Ue){const Xe=Ue(Ae.text,Ae.sectionIndex,ze);for(const dt of Xe){const ut=new ll;ut.text=dt[0],ut.sectionIndex=dt[1],ut.sections=Ae.sections,Re.push(ut)}}else Re=function(Xe,dt){const ut=[],Tt=Xe.text;let Nt=0;for(const _t of dt)ut.push(Xe.substring(Nt,_t)),Nt=_t;return Nt<Tt.length&&ut.push(Xe.substring(Nt,Tt.length)),ut}(Ae,ze);const He=[],Ye={positionedLines:He,text:Ae.toString(),top:pe[1],bottom:pe[1],left:pe[0],right:pe[0],writingMode:me,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Xe,dt,ut,Tt,Nt,_t,Ct,Pt,Lt,Gt,bt,Xt){let ir=0,Yt=0,vr=0;const Wt=Pt==="right"?1:Pt==="left"?0:.5;let cr=!1;for(const Tr of Nt){const Sr=Tr.getSections();for(const ni of Sr){if(ni.imageName)continue;const ci=dt[ni.fontStack];if(ci&&(cr=ci.ascender!==void 0&&ci.descender!==void 0,!cr))break}if(!cr)break}let $r=0;for(const Tr of Nt){Tr.trim();const Sr=Tr.getMaxScale(),ni=(Sr-1)*Zi,ci={positionedGlyphs:[],lineOffset:0};Xe.positionedLines[$r]=ci;const ui=ci.positionedGlyphs;let oi=0;if(!Tr.length()){Yt+=_t,++$r;continue}let $i=0,Ei=0;for(let ai=0;ai<Tr.length();ai++){const Ni=Tr.getSection(ai),Di=Tr.getSectionIndex(ai),bi=Tr.getCharCode(ai);let Gr=Ni.scale,Li=null,fi=null,_n=null,Bi=Zi,Xi=0;const Gi=!(Lt===Fn.horizontal||!bt&&!sc(bi)||bt&&(nh[bi]||(jr=bi,Jt.Arabic(jr)||Jt["Arabic Supplement"](jr)||Jt["Arabic Extended-A"](jr)||Jt["Arabic Presentation Forms-A"](jr)||Jt["Arabic Presentation Forms-B"](jr))));if(Ni.imageName){const gn=Tt[Ni.imageName];if(!gn)continue;_n=Ni.imageName,Xe.iconsInText=Xe.iconsInText||!0,fi=gn.paddedRect;const Wi=gn.displaySize;Gr=Gr*Zi/Xt,Li={width:Wi[0],height:Wi[1],left:bn,top:-Ed,advance:Gi?Wi[1]:Wi[0],localGlyph:!1},Xi=cr?-Li.height*Gr:Sd+Sr*Zi-Wi[1]*Gr,Bi=Li.advance;const $o=(Gi?Wi[0]:Wi[1])*Gr-Zi*Sr;$o>0&&$o>oi&&(oi=$o)}else{const gn=ut[Ni.fontStack];if(!gn)continue;gn[bi]&&(fi=gn[bi]);const Wi=dt[Ni.fontStack];if(!Wi)continue;const $o=Wi.glyphs[bi];if(!$o)continue;if(Li=$o.metrics,Bi=bi!==8203?Zi:0,cr){const ml=Wi.ascender!==void 0?Math.abs(Wi.ascender):0,Gc=Wi.descender!==void 0?Math.abs(Wi.descender):0,Wc=(ml+Gc)*Gr;$i<Wc&&($i=Wc,Ei=(ml-Gc)/2*Gr),Xi=-ml*Gr}else Xi=Sd+(Sr-Gr)*Zi}Gi?(Xe.verticalizable=!0,ui.push({glyph:bi,imageName:_n,x:ir,y:Yt+Xi,vertical:Gi,scale:Gr,localGlyph:Li.localGlyph,fontStack:Ni.fontStack,sectionIndex:Di,metrics:Li,rect:fi}),ir+=Bi*Gr+Gt):(ui.push({glyph:bi,imageName:_n,x:ir,y:Yt+Xi,vertical:Gi,scale:Gr,localGlyph:Li.localGlyph,fontStack:Ni.fontStack,sectionIndex:Di,metrics:Li,rect:fi}),ir+=Li.advance*Gr+Gt)}ui.length!==0&&(vr=Math.max(ir-Gt,vr),cr?Pd(ui,Wt,oi,Ei,_t*Sr/2):Pd(ui,Wt,oi,0,_t/2)),ir=0;const Mi=_t*Sr+oi;ci.lineOffset=Math.max(oi,ni),Yt+=Mi,++$r}var jr;const xr=Yt,{horizontalAlign:pr,verticalAlign:pi}=Af(Ct);(function(Tr,Sr,ni,ci,ui,oi){const $i=(Sr-ni)*ui,Ei=-oi*ci;for(const Mi of Tr)for(const ai of Mi.positionedGlyphs)ai.x+=$i,ai.y+=Ei})(Xe.positionedLines,Wt,pr,pi,vr,xr),Xe.top+=-pi*xr,Xe.bottom=Xe.top+xr,Xe.left+=-pr*vr,Xe.right=Xe.left+vr,Xe.hasBaseline=cr}(Ye,e,F,K,Re,ie,oe,le,me,ce,_e,we),!function(Xe){for(const dt of Xe)if(dt.positionedGlyphs.length!==0)return!1;return!0}(He)&&Ye}const nh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},g_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Id(t,e,F,K,J,ee){if(e.imageName){const ie=K[e.imageName];return ie?ie.displaySize[0]*e.scale*Zi/ee+J:0}{const ie=F[e.fontStack],oe=ie&&ie.glyphs[t];return oe?oe.metrics.advance*e.scale+J:0}}function Ad(t,e,F,K){const J=Math.pow(t-e,2);return K?t<e?J/2:2*J:J+Math.abs(F)*F}function v_(t,e,F){let K=0;return t===10&&(K-=1e4),F&&(K+=150),t!==40&&t!==65288||(K+=50),e!==41&&e!==65289||(K+=50),K}function Od(t,e,F,K,J,ee){let ie=null,oe=Ad(e,F,J,ee);for(const le of K){const ce=Ad(e-le.x,F,J,ee)+le.badness;ce<=oe&&(ie=le,oe=ce)}return{index:t,x:e,priorBreak:ie,badness:oe}}function Cd(t){return t?Cd(t.priorBreak).concat(t.index):[]}function Af(t){let e=.5,F=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":F=1;break;case"top":case"top-right":case"top-left":F=0}return{horizontalAlign:e,verticalAlign:F}}function Pd(t,e,F,K,J){if(!(e||F||K||J))return;const ee=t.length-1,ie=t[ee],oe=(ie.x+ie.metrics.advance*ie.scale)*e;for(let le=0;le<=ee;le++)t[le].x-=oe,t[le].y+=F+K+J}function $_(t,e,F){const{horizontalAlign:K,verticalAlign:J}=Af(F),ee=e[0]-t.displaySize[0]*K,ie=e[1]-t.displaySize[1]*J;return{image:t,top:ie,bottom:ie+t.displaySize[1],left:ee,right:ee+t.displaySize[0]}}function Rd(t,e,F,K,J,ee){const ie=t.image;let oe;if(ie.content){const Re=ie.content,ze=ie.pixelRatio||1;oe=[Re[0]/ze,Re[1]/ze,ie.displaySize[0]-Re[2]/ze,ie.displaySize[1]-Re[3]/ze]}const le=e.left*ee,ce=e.right*ee;let pe,me,_e,xe;F==="width"||F==="both"?(xe=J[0]+le-K[3],me=J[0]+ce+K[1]):(xe=J[0]+(le+ce-ie.displaySize[0])/2,me=xe+ie.displaySize[0]);const we=e.top*ee,Ae=e.bottom*ee;return F==="height"||F==="both"?(pe=J[1]+we-K[0],_e=J[1]+Ae+K[2]):(pe=J[1]+(we+Ae-ie.displaySize[1])/2,_e=pe+ie.displaySize[1]),{image:ie,top:pe,right:me,bottom:_e,left:xe,collisionPadding:oe}}class Xo extends zt{constructor(e,F,K,J,ee){super(e,F),this.angle=J,this.z=K,ee!==void 0&&(this.segment=ee)}clone(){return new Xo(this.x,this.y,this.z,this.angle,this.segment)}}function Md(t,e,F,K,J){if(e.segment===void 0)return!0;let ee=e,ie=e.segment+1,oe=0;for(;oe>-F/2;){if(ie--,ie<0)return!1;oe-=t[ie].dist(ee),ee=t[ie]}oe+=t[ie].dist(t[ie+1]),ie++;const le=[];let ce=0;for(;oe<F/2;){const pe=t[ie],me=t[ie+1];if(!me)return!1;let _e=t[ie-1].angleTo(pe)-pe.angleTo(me);for(_e=Math.abs((_e+3*Math.PI)%(2*Math.PI)-Math.PI),le.push({distance:oe,angleDelta:_e}),ce+=_e;oe-le[0].distance>K;)ce-=le.shift().angleDelta;if(ce>J)return!1;ie++,oe+=pe.dist(me)}return!0}function Dd(t){let e=0;for(let F=0;F<t.length-1;F++)e+=t[F].dist(t[F+1]);return e}function Ld(t,e,F){return t?.6*e*F:0}function Bd(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function x_(t,e,F,K,J,ee){const ie=Ld(F,J,ee),oe=Bd(F,K)*ee;let le=0;const ce=Dd(t)/2;for(let pe=0;pe<t.length-1;pe++){const me=t[pe],_e=t[pe+1],xe=me.dist(_e);if(le+xe>ce){const we=(ce-le)/xe,Ae=zr(me.x,_e.x,we),Re=zr(me.y,_e.y,we),ze=new Xo(Ae,Re,0,_e.angleTo(me),pe);return!ie||Md(t,ze,oe,ie,e)?ze:void 0}le+=xe}}function b_(t,e,F,K,J,ee,ie,oe,le){const ce=Ld(K,ee,ie),pe=Bd(K,J),me=pe*ie,_e=t[0].x===0||t[0].x===le||t[0].y===0||t[0].y===le;return e-me<e/4&&(e=me+e/4),kd(t,_e?e/2*oe%e:(pe/2+2*ee)*ie*oe%e,e,ce,F,me,_e,!1,le)}function kd(t,e,F,K,J,ee,ie,oe,le){const ce=ee/2,pe=Dd(t);let me=0,_e=e-F,xe=[];for(let we=0;we<t.length-1;we++){const Ae=t[we],Re=t[we+1],ze=Ae.dist(Re),Ze=Re.angleTo(Ae);for(;_e+F<me+ze;){_e+=F;const Ue=(_e-me)/ze,He=zr(Ae.x,Re.x,Ue),Ye=zr(Ae.y,Re.y,Ue);if(He>=0&&He<le&&Ye>=0&&Ye<le&&_e-ce>=0&&_e+ce<=pe){const Xe=new Xo(He,Ye,0,Ze,we);Xe._round(),K&&!Md(t,Xe,ee,K,J)||xe.push(Xe)}}me+=ze}return oe||xe.length||ie||(xe=kd(t,me/2,F,K,J,ee,ie,!0,le)),xe}function Nd(t,e,F,K,J){const ee=[];for(let ie=0;ie<t.length;ie++){const oe=t[ie];let le;for(let ce=0;ce<oe.length-1;ce++){let pe=oe[ce],me=oe[ce+1];pe.x<e&&me.x<e||(pe.x<e?pe=new zt(e,pe.y+(e-pe.x)/(me.x-pe.x)*(me.y-pe.y))._round():me.x<e&&(me=new zt(e,pe.y+(e-pe.x)/(me.x-pe.x)*(me.y-pe.y))._round()),pe.y<F&&me.y<F||(pe.y<F?pe=new zt(pe.x+(F-pe.y)/(me.y-pe.y)*(me.x-pe.x),F)._round():me.y<F&&(me=new zt(pe.x+(F-pe.y)/(me.y-pe.y)*(me.x-pe.x),F)._round()),pe.x>=K&&me.x>=K||(pe.x>=K?pe=new zt(K,pe.y+(K-pe.x)/(me.x-pe.x)*(me.y-pe.y))._round():me.x>=K&&(me=new zt(K,pe.y+(K-pe.x)/(me.x-pe.x)*(me.y-pe.y))._round()),pe.y>=J&&me.y>=J||(pe.y>=J?pe=new zt(pe.x+(J-pe.y)/(me.y-pe.y)*(me.x-pe.x),J)._round():me.y>=J&&(me=new zt(pe.x+(J-pe.y)/(me.y-pe.y)*(me.x-pe.x),J)._round()),le&&pe.equals(le[le.length-1])||(le=[pe],ee.push(le)),le.push(me)))))}}return ee}tr(Xo,"Anchor");const Lc=1e20;function Fd(t,e,F,K,J,ee,ie,oe,le){for(let ce=e;ce<e+K;ce++)zd(t,F*ee+ce,ee,J,ie,oe,le);for(let ce=F;ce<F+J;ce++)zd(t,ce*ee+e,1,K,ie,oe,le)}function zd(t,e,F,K,J,ee,ie){ee[0]=0,ie[0]=-Lc,ie[1]=Lc,J[0]=t[e];for(let oe=1,le=0,ce=0;oe<K;oe++){J[oe]=t[e+oe*F];const pe=oe*oe;do{const me=ee[le];ce=(J[oe]-J[me]+pe-me*me)/(oe-me)/2}while(ce<=ie[le]&&--le>-1);le++,ee[le]=oe,ie[le]=ce,ie[le+1]=Lc}for(let oe=0,le=0;oe<K;oe++){for(;ie[le+1]<oe;)le++;const ce=ee[le],pe=oe-ce;t[e+oe*F]=J[ce]+pe*pe}}const go=2,Of={none:0,ideographs:1,all:2};class cl{constructor(e,F,K){this.requestManager=e,this.localGlyphMode=F,this.localFontFamily=K,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,F){const K=[];for(const J in e)for(const ee of e[J])K.push({stack:J,id:ee});Ht(K,({stack:J,id:ee},ie)=>{let oe=this.entries[J];oe||(oe=this.entries[J]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let le=oe.glyphs[ee];if(le!==void 0)return void ie(null,{stack:J,id:ee,glyph:le});if(le=this._tinySDF(oe,J,ee),le)return oe.glyphs[ee]=le,void ie(null,{stack:J,id:ee,glyph:le});const ce=Math.floor(ee/256);if(256*ce>65535)return void ie(new Error("glyphs > 65535 not supported"));if(oe.ranges[ce])return void ie(null,{stack:J,id:ee,glyph:le});let pe=oe.requests[ce];pe||(pe=oe.requests[ce]=[],cl.loadGlyphRange(J,ce,this.url,this.requestManager,(me,_e)=>{if(_e){oe.ascender=_e.ascender,oe.descender=_e.descender;for(const xe in _e.glyphs)this._doesCharSupportLocalGlyph(+xe)||(oe.glyphs[+xe]=_e.glyphs[+xe]);oe.ranges[ce]=!0}for(const xe of pe)xe(me,_e);delete oe.requests[ce]})),pe.push((me,_e)=>{me?ie(me):_e&&ie(null,{stack:J,id:ee,glyph:_e.glyphs[ee]||null})})},(J,ee)=>{if(J)F(J);else if(ee){const ie={};for(const{stack:oe,id:le,glyph:ce}of ee)ie[oe]===void 0&&(ie[oe]={}),ie[oe].glyphs===void 0&&(ie[oe].glyphs={}),ie[oe].glyphs[le]=ce&&{id:ce.id,bitmap:ce.bitmap.clone(),metrics:ce.metrics},ie[oe].ascender=this.entries[oe].ascender,ie[oe].descender=this.entries[oe].descender;F(null,ie)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Of.none&&(this.localGlyphMode===Of.all?!!this.localFontFamily:!!this.localFontFamily&&(Jt["CJK Unified Ideographs"](e)||Jt["Hangul Syllables"](e)||Jt.Hiragana(e)||Jt.Katakana(e)||Jt["CJK Symbols and Punctuation"](e)))}_tinySDF(e,F,K){const J=this.localFontFamily;if(!J||!this._doesCharSupportLocalGlyph(K))return;let ee=e.tinySDF;if(!ee){let Ae="400";/bold/i.test(F)?Ae="900":/medium/i.test(F)?Ae="500":/light/i.test(F)&&(Ae="200"),ee=e.tinySDF=new cl.TinySDF({fontFamily:J,fontWeight:Ae,fontSize:24*go,buffer:3*go,radius:8*go}),ee.fontWeight=Ae}if(this.localGlyphs[ee.fontWeight][K])return this.localGlyphs[ee.fontWeight][K];const ie=String.fromCharCode(K),{data:oe,width:le,height:ce,glyphWidth:pe,glyphHeight:me,glyphLeft:_e,glyphTop:xe,glyphAdvance:we}=ee.draw(ie);return this.localGlyphs[ee.fontWeight][K]={id:K,bitmap:new Ko({width:le,height:ce},oe),metrics:{width:pe/go,height:me/go,left:_e/go,top:xe/go-27,advance:we/go,localGlyph:!0}}}}cl.loadGlyphRange=function(t,e,F,K,J){const ee=256*e,ie=ee+255,oe=K.transformRequest(K.normalizeGlyphsURL(F).replace("{fontstack}",t).replace("{range}",`${ee}-${ie}`),Ar.Glyphs);Wr(oe,(le,ce)=>{if(le)J(le);else if(ce){const pe={},me=function(_e){return new ih(_e).readFields(m_,{})}(ce);for(const _e of me.glyphs)pe[_e.id]=_e;J(null,{glyphs:pe,ascender:me.ascender,descender:me.descender})}})},cl.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:F=8,cutoff:K=.25,fontFamily:J="sans-serif",fontWeight:ee="normal",fontStyle:ie="normal"}={}){this.buffer=e,this.cutoff=K,this.radius=F;const oe=this.size=t+4*e,le=this._createCanvas(oe),ce=this.ctx=le.getContext("2d",{willReadFrequently:!0});ce.font=`${ie} ${ee} ${t}px ${J}`,ce.textBaseline="alphabetic",ce.textAlign="left",ce.fillStyle="black",this.gridOuter=new Float64Array(oe*oe),this.gridInner=new Float64Array(oe*oe),this.f=new Float64Array(oe),this.z=new Float64Array(oe+1),this.v=new Uint16Array(oe)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:F,actualBoundingBoxDescent:K,actualBoundingBoxLeft:J,actualBoundingBoxRight:ee}=this.ctx.measureText(t),ie=Math.ceil(F),oe=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(ee-J))),le=Math.min(this.size-this.buffer,ie+Math.ceil(K)),ce=oe+2*this.buffer,pe=le+2*this.buffer,me=Math.max(ce*pe,0),_e=new Uint8ClampedArray(me),xe={data:_e,width:ce,height:pe,glyphWidth:oe,glyphHeight:le,glyphTop:ie,glyphLeft:0,glyphAdvance:e};if(oe===0||le===0)return xe;const{ctx:we,buffer:Ae,gridInner:Re,gridOuter:ze}=this;we.clearRect(Ae,Ae,oe,le),we.fillText(t,Ae,Ae+ie);const Ze=we.getImageData(Ae,Ae,oe,le);ze.fill(Lc,0,me),Re.fill(0,0,me);for(let Ue=0;Ue<le;Ue++)for(let He=0;He<oe;He++){const Ye=Ze.data[4*(Ue*oe+He)+3]/255;if(Ye===0)continue;const Xe=(Ue+Ae)*ce+He+Ae;if(Ye===1)ze[Xe]=0,Re[Xe]=Lc;else{const dt=.5-Ye;ze[Xe]=dt>0?dt*dt:0,Re[Xe]=dt<0?dt*dt:0}}Fd(ze,0,0,ce,pe,ce,this.f,this.v,this.z),Fd(Re,Ae,Ae,oe,le,ce,this.f,this.v,this.z);for(let Ue=0;Ue<me;Ue++){const He=Math.sqrt(ze[Ue])-Math.sqrt(Re[Ue]);_e[Ue]=Math.round(255-255*(He/this.radius+this.cutoff))}return xe}};const ul=bn;function Ud(t,e,F,K){const J=[],ee=t.image,ie=ee.pixelRatio,oe=ee.paddedRect.w-2*ul,le=ee.paddedRect.h-2*ul,ce=t.right-t.left,pe=t.bottom-t.top,me=ee.stretchX||[[0,oe]],_e=ee.stretchY||[[0,le]],xe=(_t,Ct)=>_t+Ct[1]-Ct[0],we=me.reduce(xe,0),Ae=_e.reduce(xe,0),Re=oe-we,ze=le-Ae;let Ze=0,Ue=we,He=0,Ye=Ae,Xe=0,dt=Re,ut=0,Tt=ze;if(ee.content&&K){const _t=ee.content;Ze=oh(me,0,_t[0]),He=oh(_e,0,_t[1]),Ue=oh(me,_t[0],_t[2]),Ye=oh(_e,_t[1],_t[3]),Xe=_t[0]-Ze,ut=_t[1]-He,dt=_t[2]-_t[0]-Ue,Tt=_t[3]-_t[1]-Ye}const Nt=(_t,Ct,Pt,Lt)=>{const Gt=ah(_t.stretch-Ze,Ue,ce,t.left),bt=sh(_t.fixed-Xe,dt,_t.stretch,we),Xt=ah(Ct.stretch-He,Ye,pe,t.top),ir=sh(Ct.fixed-ut,Tt,Ct.stretch,Ae),Yt=ah(Pt.stretch-Ze,Ue,ce,t.left),vr=sh(Pt.fixed-Xe,dt,Pt.stretch,we),Wt=ah(Lt.stretch-He,Ye,pe,t.top),cr=sh(Lt.fixed-ut,Tt,Lt.stretch,Ae),$r=new zt(Gt,Xt),jr=new zt(Yt,Xt),xr=new zt(Yt,Wt),pr=new zt(Gt,Wt),pi=new zt(bt/ie,ir/ie),Tr=new zt(vr/ie,cr/ie),Sr=e*Math.PI/180;if(Sr){const ui=Math.sin(Sr),oi=Math.cos(Sr),$i=[oi,-ui,ui,oi];$r._matMult($i),jr._matMult($i),pr._matMult($i),xr._matMult($i)}const ni=_t.stretch+_t.fixed,ci=Ct.stretch+Ct.fixed;return{tl:$r,tr:jr,bl:pr,br:xr,tex:{x:ee.paddedRect.x+ul+ni,y:ee.paddedRect.y+ul+ci,w:Pt.stretch+Pt.fixed-ni,h:Lt.stretch+Lt.fixed-ci},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:pi,pixelOffsetBR:Tr,minFontScaleX:dt/ie/ce,minFontScaleY:Tt/ie/pe,isSDF:F}};if(K&&(ee.stretchX||ee.stretchY)){const _t=jd(me,Re,we),Ct=jd(_e,ze,Ae);for(let Pt=0;Pt<_t.length-1;Pt++){const Lt=_t[Pt],Gt=_t[Pt+1];for(let bt=0;bt<Ct.length-1;bt++)J.push(Nt(Lt,Ct[bt],Gt,Ct[bt+1]))}}else J.push(Nt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:oe+1},{fixed:0,stretch:le+1}));return J}function oh(t,e,F){let K=0;for(const J of t)K+=Math.max(e,Math.min(F,J[1]))-Math.max(e,Math.min(F,J[0]));return K}function jd(t,e,F){const K=[{fixed:-ul,stretch:0}];for(const[J,ee]of t){const ie=K[K.length-1];K.push({fixed:J-ie.stretch,stretch:ie.stretch}),K.push({fixed:J-ie.stretch,stretch:ie.stretch+(ee-J)})}return K.push({fixed:e+ul,stretch:F}),K}function ah(t,e,F,K){return t/e*F+K}function sh(t,e,F,K){return t-e*F/K}function w_(t,e,F,K){const J=e+t.positionedLines[K].lineOffset;return K===0?F+J/2:F+(J+(e+t.positionedLines[K-1].lineOffset))/2}class E_{constructor(e=[],F=T_){if(this.data=e,this.length=this.data.length,this.compare=F,this.length>0)for(let K=(this.length>>1)-1;K>=0;K--)this._down(K)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],F=this.data.pop();return this.length--,this.length>0&&(this.data[0]=F,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:F,compare:K}=this,J=F[e];for(;e>0;){const ee=e-1>>1,ie=F[ee];if(K(J,ie)>=0)break;F[e]=ie,e=ee}F[e]=J}_down(e){const{data:F,compare:K}=this,J=this.length>>1,ee=F[e];for(;e<J;){let ie=1+(e<<1),oe=F[ie];const le=ie+1;if(le<this.length&&K(F[le],oe)<0&&(ie=le,oe=F[le]),K(oe,ee)>=0)break;F[e]=oe,e=ie}F[e]=ee}}function T_(t,e){return t<e?-1:t>e?1:0}function S_(t,e=1,F=!1){let K=1/0,J=1/0,ee=-1/0,ie=-1/0;const oe=t[0];for(let xe=0;xe<oe.length;xe++){const we=oe[xe];(!xe||we.x<K)&&(K=we.x),(!xe||we.y<J)&&(J=we.y),(!xe||we.x>ee)&&(ee=we.x),(!xe||we.y>ie)&&(ie=we.y)}const le=Math.min(ee-K,ie-J);let ce=le/2;const pe=new E_([],I_);if(le===0)return new zt(K,J);for(let xe=K;xe<ee;xe+=le)for(let we=J;we<ie;we+=le)pe.push(new hl(xe+ce,we+ce,ce,t));let me=function(xe){let we=0,Ae=0,Re=0;const ze=xe[0];for(let Ze=0,Ue=ze.length,He=Ue-1;Ze<Ue;He=Ze++){const Ye=ze[Ze],Xe=ze[He],dt=Ye.x*Xe.y-Xe.x*Ye.y;Ae+=(Ye.x+Xe.x)*dt,Re+=(Ye.y+Xe.y)*dt,we+=3*dt}return new hl(Ae/we,Re/we,0,xe)}(t),_e=pe.length;for(;pe.length;){const xe=pe.pop();(xe.d>me.d||!me.d)&&(me=xe,F&&console.log("found best %d after %d probes",Math.round(1e4*xe.d)/1e4,_e)),xe.max-me.d<=e||(ce=xe.h/2,pe.push(new hl(xe.p.x-ce,xe.p.y-ce,ce,t)),pe.push(new hl(xe.p.x+ce,xe.p.y-ce,ce,t)),pe.push(new hl(xe.p.x-ce,xe.p.y+ce,ce,t)),pe.push(new hl(xe.p.x+ce,xe.p.y+ce,ce,t)),_e+=4)}return F&&(console.log(`num probes: ${_e}`),console.log(`best distance: ${me.d}`)),me.p}function I_(t,e){return e.max-t.max}class hl{constructor(e,F,K,J){this.p=new zt(e,F),this.h=K,this.d=function(ee,ie){let oe=!1,le=1/0;for(let ce=0;ce<ie.length;ce++){const pe=ie[ce];for(let me=0,_e=pe.length,xe=_e-1;me<_e;xe=me++){const we=pe[me],Ae=pe[xe];we.y>ee.y!=Ae.y>ee.y&&ee.x<(Ae.x-we.x)*(ee.y-we.y)/(Ae.y-we.y)+we.x&&(oe=!oe),le=Math.min(le,Bp(ee,we,Ae))}}return(oe?1:-1)*Math.sqrt(le)}(this.p,J),this.max=this.d+this.h*Math.SQRT2}}const fl=7,Cf=Number.POSITIVE_INFINITY,A_=Math.sqrt(2);function Vd(t,[e,F]){let K=0,J=0;if(F===Cf){e<0&&(e=0);const ee=e/A_;switch(t){case"top-right":case"top-left":J=ee-fl;break;case"bottom-right":case"bottom-left":J=-ee+fl;break;case"bottom":J=-e+fl;break;case"top":J=e-fl}switch(t){case"top-right":case"bottom-right":K=-ee;break;case"top-left":case"bottom-left":K=ee;break;case"left":K=e;break;case"right":K=-e}}else{switch(e=Math.abs(e),F=Math.abs(F),t){case"top-right":case"top-left":case"top":J=F-fl;break;case"bottom-right":case"bottom-left":case"bottom":J=-F+fl}switch(t){case"top-right":case"bottom-right":case"right":K=-e;break;case"top-left":case"bottom-left":case"left":K=e}}return[K,J]}function O_(t,e,F,K,J,ee,ie,oe,le,ce){t.createArrays(),t.tilePixelRatio=ur/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const pe=t.layers[0].layout,me=t.layers[0]._unevaluatedLayout._values,_e={};if(t.textSizeData.kind==="composite"){const{minZoom:Ae,maxZoom:Re}=t.textSizeData;_e.compositeTextSizes=[me["text-size"].possiblyEvaluate(new de(Ae),oe),me["text-size"].possiblyEvaluate(new de(Re),oe)]}if(t.iconSizeData.kind==="composite"){const{minZoom:Ae,maxZoom:Re}=t.iconSizeData;_e.compositeIconSizes=[me["icon-size"].possiblyEvaluate(new de(Ae),oe),me["icon-size"].possiblyEvaluate(new de(Re),oe)]}_e.layoutTextSize=me["text-size"].possiblyEvaluate(new de(le+1),oe),_e.layoutIconSize=me["icon-size"].possiblyEvaluate(new de(le+1),oe),_e.textMaxSize=me["text-size"].possiblyEvaluate(new de(18),oe);const xe=pe.get("text-rotation-alignment")==="map"&&pe.get("symbol-placement")!=="point",we=pe.get("text-size");for(const Ae of t.features){const Re=pe.get("text-font").evaluate(Ae,{},oe).join(","),ze=we.evaluate(Ae,{},oe),Ze=_e.layoutTextSize.evaluate(Ae,{},oe),Ue=(_e.layoutIconSize.evaluate(Ae,{},oe),{horizontal:{},vertical:void 0}),He=Ae.text;let Ye,Xe=[0,0];if(He){const Tt=He.toString(),Nt=pe.get("text-letter-spacing").evaluate(Ae,{},oe)*Zi,_t=pe.get("text-line-height").evaluate(Ae,{},oe)*Zi,Ct=Nh(Tt)?Nt:0,Pt=pe.get("text-anchor").evaluate(Ae,{},oe),Lt=pe.get("text-variable-anchor");if(!Lt){const Yt=pe.get("text-radial-offset").evaluate(Ae,{},oe);Xe=Yt?Vd(Pt,[Yt*Zi,Cf]):pe.get("text-offset").evaluate(Ae,{},oe).map(vr=>vr*Zi)}let Gt=xe?"center":pe.get("text-justify").evaluate(Ae,{},oe);const bt=pe.get("symbol-placement")==="point",Xt=bt?pe.get("text-max-width").evaluate(Ae,{},oe)*Zi:1/0,ir=Yt=>{t.allowVerticalPlacement&&ac(Tt)&&(Ue.vertical=If(He,e,F,J,Re,Xt,_t,Pt,Yt,Ct,Xe,Fn.vertical,!0,Ze,ze))};if(!xe&&Lt){const Yt=Gt==="auto"?Lt.map(Wt=>Pf(Wt)):[Gt];let vr=!1;for(let Wt=0;Wt<Yt.length;Wt++){const cr=Yt[Wt];if(!Ue.horizontal[cr])if(vr)Ue.horizontal[cr]=Ue.horizontal[0];else{const $r=If(He,e,F,J,Re,Xt,_t,"center",cr,Ct,Xe,Fn.horizontal,!1,Ze,ze);$r&&(Ue.horizontal[cr]=$r,vr=$r.positionedLines.length===1)}}ir("left")}else{if(Gt==="auto"&&(Gt=Pf(Pt)),bt||pe.get("text-writing-mode").indexOf("horizontal")>=0||!ac(Tt)){const Yt=If(He,e,F,J,Re,Xt,_t,Pt,Gt,Ct,Xe,Fn.horizontal,!1,Ze,ze);Yt&&(Ue.horizontal[Gt]=Yt)}ir(bt?"left":Gt)}}let dt=!1;if(Ae.icon&&Ae.icon.name){const Tt=K[Ae.icon.name];Tt&&(Ye=$_(J[Ae.icon.name],pe.get("icon-offset").evaluate(Ae,{},oe),pe.get("icon-anchor").evaluate(Ae,{},oe)),dt=Tt.sdf,t.sdfIcons===void 0?t.sdfIcons=Tt.sdf:t.sdfIcons!==Tt.sdf&&di("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Tt.pixelRatio!==t.pixelRatio||pe.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const ut=Wd(Ue.horizontal)||Ue.vertical;t.iconsInText||(t.iconsInText=!!ut&&ut.iconsInText),(ut||Ye)&&C_(t,Ae,Ue,Ye,K,_e,Ze,0,Xe,dt,ie,oe,ce)}ee&&t.generateCollisionDebugBuffers(le,t.collisionBoxArray)}function Pf(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function C_(t,e,F,K,J,ee,ie,oe,le,ce,pe,me,_e){let xe=ee.textMaxSize.evaluate(e,{},me);xe===void 0&&(xe=ie);const we=t.layers[0].layout,Ae=we.get("icon-offset").evaluate(e,{},me),Re=Wd(F.horizontal)||F.vertical,ze=_e.name==="globe",Ze=Zi,Ue=ie/Ze,He=t.tilePixelRatio*xe/Ze,Ye=(Pt=t.overscaling,t.zoom>18&&Pt>2&&(Pt>>=1),Math.max(ur/(512*Pt),1)*we.get("symbol-spacing")),Xe=we.get("text-padding")*t.tilePixelRatio,dt=we.get("icon-padding")*t.tilePixelRatio,ut=dr(we.get("text-max-angle")),Tt=we.get("text-rotation-alignment")==="map"&&we.get("symbol-placement")!=="point",Nt=we.get("icon-rotation-alignment")==="map"&&we.get("symbol-placement")!=="point",_t=we.get("symbol-placement"),Ct=Ye/2;var Pt;const Lt=we.get("icon-text-fit");let Gt;K&&Lt!=="none"&&(t.allowVerticalPlacement&&F.vertical&&(Gt=Rd(K,F.vertical,Lt,we.get("icon-text-fit-padding"),Ae,Ue)),Re&&(K=Rd(K,Re,Lt,we.get("icon-text-fit-padding"),Ae,Ue)));const bt=(Xt,ir,Yt)=>{if(ir.x<0||ir.x>=ur||ir.y<0||ir.y>=ur)return;let vr=null;if(ze){const{x:Wt,y:cr,z:$r}=_e.projectTilePoint(ir.x,ir.y,Yt);vr={anchor:new Xo(Wt,cr,$r,0,void 0),up:_e.upVector(Yt,ir.x,ir.y)}}(function(Wt,cr,$r,jr,xr,pr,pi,Tr,Sr,ni,ci,ui,oi,$i,Ei,Mi,ai,Ni,Di,bi,Gr,Li,fi,_n,Bi){const Xi=Wt.addToLineVertexArray(cr,jr);let Gi,gn,Wi,$o,ml,Gc,Wc,Em=0,Tm=0,Sm=0,Im=0,qf=-1,Hf=-1;const Po={};let Am=Uh("");const ys=$r?$r.anchor:cr;let Kf=0,Zf=0;if(Sr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Kf,Zf]=Sr.layout.get("text-offset").evaluate(Gr,{},Bi).map(Pn=>Pn*Zi):(Kf=Sr.layout.get("text-radial-offset").evaluate(Gr,{},Bi)*Zi,Zf=Cf),Wt.allowVerticalPlacement&&xr.vertical){const Pn=xr.vertical;if(Ei)Gc=Rf(Pn),Tr&&(Wc=Rf(Tr));else{const Rn=Sr.layout.get("text-rotate").evaluate(Gr,{},Bi)+90;Wi=lh(ni,ys,cr,ci,ui,oi,Pn,$i,Rn,Mi),Tr&&($o=lh(ni,ys,cr,ci,ui,oi,Tr,Ni,Rn))}}if(pr){const Pn=Sr.layout.get("icon-rotate").evaluate(Gr,{},Bi),Rn=Sr.layout.get("icon-text-fit")!=="none",qc=Ud(pr,Pn,fi,Rn),Yf=Tr?Ud(Tr,Pn,fi,Rn):void 0;gn=lh(ni,ys,cr,ci,ui,oi,pr,Ni,Pn),Em=4*qc.length;const Om=Wt.iconSizeData;let _s=null;Om.kind==="source"?(_s=[_o*Sr.layout.get("icon-size").evaluate(Gr,{},Bi)],_s[0]>ba&&di(`${Wt.layerIds[0]}: Value for "icon-size" is >= ${Bc}. Reduce your "icon-size".`)):Om.kind==="composite"&&(_s=[_o*Li.compositeIconSizes[0].evaluate(Gr,{},Bi),_o*Li.compositeIconSizes[1].evaluate(Gr,{},Bi)],(_s[0]>ba||_s[1]>ba)&&di(`${Wt.layerIds[0]}: Value for "icon-size" is >= ${Bc}. Reduce your "icon-size".`)),Wt.addSymbols(Wt.icon,qc,_s,bi,Di,Gr,!1,$r,cr,Xi.lineStartIndex,Xi.lineLength,-1,_n,Bi),qf=Wt.icon.placedSymbolArray.length-1,Yf&&(Tm=4*Yf.length,Wt.addSymbols(Wt.icon,Yf,_s,bi,Di,Gr,Fn.vertical,$r,cr,Xi.lineStartIndex,Xi.lineLength,-1,_n,Bi),Hf=Wt.icon.placedSymbolArray.length-1)}for(const Pn in xr.horizontal){const Rn=xr.horizontal[Pn];Gi||(Am=Uh(Rn.text),Ei?ml=Rf(Rn):Gi=lh(ni,ys,cr,ci,ui,oi,Rn,$i,Sr.layout.get("text-rotate").evaluate(Gr,{},Bi),Mi));const qc=Rn.positionedLines.length===1;if(Sm+=Gd(Wt,$r,cr,Rn,pi,Sr,Ei,Gr,Mi,Xi,xr.vertical?Fn.horizontal:Fn.horizontalOnly,qc?Object.keys(xr.horizontal):[Pn],Po,qf,Li,_n,Bi),qc)break}xr.vertical&&(Im+=Gd(Wt,$r,cr,xr.vertical,pi,Sr,Ei,Gr,Mi,Xi,Fn.vertical,["vertical"],Po,Hf,Li,_n,Bi));let Aa=-1;const Xf=(Pn,Rn)=>Pn?Math.max(Pn,Rn):Rn;Aa=Xf(ml,Aa),Aa=Xf(Gc,Aa),Aa=Xf(Wc,Aa);const ng=Aa>-1?1:0;Wt.glyphOffsetArray.length>=Ea.MAX_GLYPHS&&di("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Gr.sortKey!==void 0&&Wt.addToSortKeyRanges(Wt.symbolInstances.length,Gr.sortKey),Wt.symbolInstances.emplaceBack(ys.x,ys.y,ys.z,cr.x,cr.y,Po.right>=0?Po.right:-1,Po.center>=0?Po.center:-1,Po.left>=0?Po.left:-1,Po.vertical>=0?Po.vertical:-1,qf,Hf,Am,Gi!==void 0?Gi:Wt.collisionBoxArray.length,Gi!==void 0?Gi+1:Wt.collisionBoxArray.length,Wi!==void 0?Wi:Wt.collisionBoxArray.length,Wi!==void 0?Wi+1:Wt.collisionBoxArray.length,gn!==void 0?gn:Wt.collisionBoxArray.length,gn!==void 0?gn+1:Wt.collisionBoxArray.length,$o||Wt.collisionBoxArray.length,$o?$o+1:Wt.collisionBoxArray.length,ci,Sm,Im,Em,Tm,ng,0,Kf,Zf,Aa)})(t,ir,vr,Xt,F,K,J,Gt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Xe,Tt,le,0,dt,Nt,Ae,e,ee,ce,pe,me)};if(_t==="line")for(const Xt of Nd(e.geometry,0,0,ur,ur)){const ir=b_(Xt,Ye,ut,F.vertical||Re,K,Ze,He,t.overscaling,ur);for(const Yt of ir)Re&&P_(t,Re.text,Ct,Yt)||bt(Xt,Yt,me)}else if(_t==="line-center"){for(const Xt of e.geometry)if(Xt.length>1){const ir=x_(Xt,ut,F.vertical||Re,K,Ze,He);ir&&bt(Xt,ir,me)}}else if(e.type==="Polygon")for(const Xt of gf(e.geometry,0)){const ir=S_(Xt,16);bt(Xt[0],new Xo(ir.x,ir.y,0,0,void 0),me)}else if(e.type==="LineString")for(const Xt of e.geometry)bt(Xt,new Xo(Xt[0].x,Xt[0].y,0,0,void 0),me);else if(e.type==="Point")for(const Xt of e.geometry)for(const ir of Xt)bt([ir],new Xo(ir.x,ir.y,0,0,void 0),me)}const Bc=255,ba=Bc*_o;function Gd(t,e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe,we,Ae,Re){const ze=function(He,Ye,Xe,dt,ut,Tt,Nt,_t){const Ct=[];if(Ye.positionedLines.length===0)return Ct;const Pt=dt.layout.get("text-rotate").evaluate(Tt,{})*Math.PI/180,Lt=function(Yt){const vr=Yt[0],Wt=Yt[1],cr=vr*Wt;return cr>0?[vr,-Wt]:cr<0?[-vr,Wt]:vr===0?[Wt,vr]:[Wt,-vr]}(Xe);let Gt=Math.abs(Ye.top-Ye.bottom);for(const Yt of Ye.positionedLines)Gt-=Yt.lineOffset;const bt=Ye.positionedLines.length,Xt=Gt/bt;let ir=Ye.top-Xe[1];for(let Yt=0;Yt<bt;++Yt){const vr=Ye.positionedLines[Yt];ir=w_(Ye,Xt,ir,Yt);for(const Wt of vr.positionedGlyphs){if(!Wt.rect)continue;const cr=Wt.rect||{};let $r=Ed+1,jr=!0,xr=1,pr=0;if(Wt.imageName){const fi=Nt[Wt.imageName];if(!fi)continue;if(fi.sdf){di("SDF images are not supported in formatted text and will be ignored.");continue}jr=!1,xr=fi.pixelRatio,$r=bn/xr}const pi=(ut||_t)&&Wt.vertical,Tr=Wt.metrics.advance*Wt.scale/2,Sr=Wt.metrics,ni=Wt.rect;if(ni===null)continue;_t&&Ye.verticalizable&&(pr=Wt.imageName?Tr-Wt.metrics.width*Wt.scale/2:0);const ci=ut?[Wt.x+Tr,Wt.y]:[0,0];let ui=[0,0],oi=[0,0],$i=!1;ut||(pi?(oi=[Wt.x+Tr+Lt[0],Wt.y+Lt[1]-pr],$i=!0):ui=[Wt.x+Tr+Xe[0],Wt.y+Xe[1]-pr]);const Ei=ni.w*Wt.scale/(xr*(Wt.localGlyph?go:1)),Mi=ni.h*Wt.scale/(xr*(Wt.localGlyph?go:1));let ai,Ni,Di,bi;if(pi){const fi=Wt.y-ir,_n=new zt(-Tr,Tr-fi),Bi=-Math.PI/2,Xi=new zt(...oi);ai=new zt(-Tr+ui[0],ui[1]),ai._rotateAround(Bi,_n)._add(Xi),ai.x+=-fi+Tr,ai.y-=(Sr.left-$r)*Wt.scale;const Gi=Wt.imageName?Sr.advance*Wt.scale:Zi*Wt.scale,gn=String.fromCharCode(Wt.glyph);n_(gn)?ai.x+=(1-$r)*Wt.scale:o_(gn)?ai.x+=Gi-Sr.height*Wt.scale+(-$r-1)*Wt.scale:ai.x+=Wt.imageName||Sr.width+2*$r===ni.w&&Sr.height+2*$r===ni.h?(Gi-Mi)/2:(Gi-(Sr.height+2*$r)*Wt.scale)/2,Ni=new zt(ai.x,ai.y-Ei),Di=new zt(ai.x+Mi,ai.y),bi=new zt(ai.x+Mi,ai.y-Ei)}else{const fi=(Sr.left-$r)*Wt.scale-Tr+ui[0],_n=(-Sr.top-$r)*Wt.scale+ui[1],Bi=fi+Ei,Xi=_n+Mi;ai=new zt(fi,_n),Ni=new zt(Bi,_n),Di=new zt(fi,Xi),bi=new zt(Bi,Xi)}if(Pt){let fi;fi=ut?new zt(0,0):$i?new zt(Lt[0],Lt[1]):new zt(Xe[0],Xe[1]),ai._rotateAround(Pt,fi),Ni._rotateAround(Pt,fi),Di._rotateAround(Pt,fi),bi._rotateAround(Pt,fi)}const Gr=new zt(0,0),Li=new zt(0,0);Ct.push({tl:ai,tr:Ni,bl:Di,br:bi,tex:cr,writingMode:Ye.writingMode,glyphOffset:ci,sectionIndex:Wt.sectionIndex,isSDF:jr,pixelOffsetTL:Gr,pixelOffsetBR:Li,minFontScaleX:0,minFontScaleY:0})}}return Ct}(0,K,le,ee,ie,oe,J,t.allowVerticalPlacement),Ze=t.textSizeData;let Ue=null;Ze.kind==="source"?(Ue=[_o*ee.layout.get("text-size").evaluate(oe,{},Re)],Ue[0]>ba&&di(`${t.layerIds[0]}: Value for "text-size" is >= ${Bc}. Reduce your "text-size".`)):Ze.kind==="composite"&&(Ue=[_o*we.compositeTextSizes[0].evaluate(oe,{},Re),_o*we.compositeTextSizes[1].evaluate(oe,{},Re)],(Ue[0]>ba||Ue[1]>ba)&&di(`${t.layerIds[0]}: Value for "text-size" is >= ${Bc}. Reduce your "text-size".`)),t.addSymbols(t.text,ze,Ue,le,ie,oe,pe,e,F,ce.lineStartIndex,ce.lineLength,xe,Ae,Re);for(const He of me)_e[He]=t.text.placedSymbolArray.length-1;return 4*ze.length}function Wd(t){for(const e in t)return t[e];return null}function lh(t,e,F,K,J,ee,ie,oe,le,ce){let pe=ie.top,me=ie.bottom,_e=ie.left,xe=ie.right;const we=ie.collisionPadding;if(we&&(_e-=we[0],pe-=we[1],xe+=we[2],me+=we[3]),le){const Ae=new zt(_e,pe),Re=new zt(xe,pe),ze=new zt(_e,me),Ze=new zt(xe,me),Ue=dr(le);let He=new zt(0,0);ce&&(He=new zt(ce[0],ce[1])),Ae._rotateAround(Ue,He),Re._rotateAround(Ue,He),ze._rotateAround(Ue,He),Ze._rotateAround(Ue,He),_e=Math.min(Ae.x,Re.x,ze.x,Ze.x),xe=Math.max(Ae.x,Re.x,ze.x,Ze.x),pe=Math.min(Ae.y,Re.y,ze.y,Ze.y),me=Math.max(Ae.y,Re.y,ze.y,Ze.y)}return t.emplaceBack(e.x,e.y,e.z,F.x,F.y,_e,pe,xe,me,oe,K,J,ee),t.length-1}function Rf(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function P_(t,e,F,K){const J=t.compareText;if(e in J){const ee=J[e];for(let ie=ee.length-1;ie>=0;ie--)if(K.dist(ee[ie])<F)return!0}else J[e]=[];return J[e].push(K),!1}function qd(t,e){const F=t.fovAboveCenter,K=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,J=(t._camera.position[2]*t.worldSize-K)/Math.cos(t._pitch),ee=Math.sin(F)*J/Math.sin(Math.max(Math.PI/2-t._pitch-F,.01)),ie=Math.sin(t._pitch)*ee+J;return Math.min(1.01*ie,J*(1/t._horizonShift))}function ps(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const F=Math.pow(2,-t.z),K=t.x*F,J=(t.x+1)*F,ee=t.y*F,ie=(t.y+1)*F,oe=Nn(K),le=Nn(J),ce=on(ee),pe=on(ie),me=e.project(oe,ce),_e=e.project(le,ce),xe=e.project(le,pe),we=e.project(oe,pe);let Ae=Math.min(me.x,_e.x,xe.x,we.x),Re=Math.min(me.y,_e.y,xe.y,we.y),ze=Math.max(me.x,_e.x,xe.x,we.x),Ze=Math.max(me.y,_e.y,xe.y,we.y);const Ue=F/16;function He(Xe,dt,ut,Tt,Nt,_t){const Ct=(ut+Nt)/2,Pt=(Tt+_t)/2,Lt=e.project(Nn(Ct),on(Pt)),Gt=Math.max(0,Ae-Lt.x,Re-Lt.y,Lt.x-ze,Lt.y-Ze);Ae=Math.min(Ae,Lt.x),ze=Math.max(ze,Lt.x),Re=Math.min(Re,Lt.y),Ze=Math.max(Ze,Lt.y),Gt>Ue&&(He(Xe,Lt,ut,Tt,Ct,Pt),He(Lt,dt,Ct,Pt,Nt,_t))}He(me,_e,K,ee,J,ee),He(_e,xe,J,ee,J,ie),He(xe,we,J,ie,K,ie),He(we,me,K,ie,K,ee),Ae-=Ue,Re-=Ue,ze+=Ue,Ze+=Ue;const Ye=1/Math.max(ze-Ae,Ze-Re);return{scale:Ye,x:Ae*Ye,y:Re*Ye,x2:ze*Ye,y2:Ze*Ye,projection:e}}const R_=po(new Float32Array(16));class wa{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,F){return{x:0,y:0,z:0}}unproject(e,F){return new ii(0,0)}projectTilePoint(e,F,K){return{x:e,y:F,z:0}}locationPoint(e,F,K=!0){return e._coordinatePoint(e.locationCoordinate(F),K)}pixelsPerMeter(e,F){return yo(1,e)*F}pixelSpaceConversion(e,F,K){return 1}farthestPixelDistance(e){return qd(e,e.pixelsPerMeter)}pointCoordinate(e,F,K,J){const ee=e.horizonLineFromTop(!1),ie=new zt(F,Math.max(ee,K));return e.rayIntersectionCoordinate(e.pointRayIntersection(ie,J))}pointCoordinate3D(e,F,K){const J=new zt(F,K);if(e.elevation)return e.elevation.pointCoordinate(J);{const ee=this.pointCoordinate(e,J.x,J.y,0);return[ee.x,ee.y,ee.z]}}isPointAboveHorizon(e,F){if(e.elevation)return!this.pointCoordinate3D(e,F.x,F.y);const K=e.horizonLineFromTop();return F.y<K}createInversionMatrix(e,F){return R_}createTileMatrix(e,F,K){let J,ee,ie;const oe=K.canonical,le=po(new Float64Array(16));if(this.isReprojectedInTileSpace){const ce=ps(oe,this);J=1,ee=ce.x+K.wrap*ce.scale,ie=ce.y,as(le,le,[J/ce.scale,J/ce.scale,e.pixelsPerMeter/F])}else J=F/e.zoomScale(oe.z),ee=(oe.x+Math.pow(2,oe.z)*K.wrap)*J,ie=oe.y*J;return pc(le,le,[ee,ie,0]),as(le,le,[J/ur,J/ur,1]),le}upVector(e,F,K){return[0,0,1]}upVectorScale(e,F,K){return{metersToTile:1}}}class M_ extends wa{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[F,K]=this.parallels=e.parallels||[29.5,45.5],J=Math.sin(dr(F));this.n=(J+Math.sin(dr(K)))/2,this.c=1+J*(2*this.n-J),this.r0=Math.sqrt(this.c)/this.n}project(e,F){const{n:K,c:J,r0:ee}=this,ie=dr(e-this.center[0]),oe=dr(F),le=Math.sqrt(J-2*K*Math.sin(oe))/K;return{x:le*Math.sin(ie*K),y:le*Math.cos(ie*K)-ee,z:0}}unproject(e,F){const{n:K,c:J,r0:ee}=this,ie=ee+F;let oe=Math.atan2(e,Math.abs(ie))*Math.sign(ie);ie*K<0&&(oe-=Math.PI*Math.sign(e)*Math.sign(ie));const le=dr(this.center[0])*K;oe=It(oe,-Math.PI-le,Math.PI-le);const ce=ht(kr(oe/K)+this.center[0],-180,180),pe=Math.asin(ht((J-(e*e+ie*ie)*K*K)/(2*K),-1,1)),me=ht(kr(pe),-an,an);return new ii(ce,me)}}const kc=1.340264,Nc=-.081106,Fc=893e-6,zc=.003796,ch=Math.sqrt(3)/2;class D_ extends wa{project(e,F){F=F/180*Math.PI,e=e/180*Math.PI;const K=Math.asin(ch*Math.sin(F)),J=K*K,ee=J*J*J;return{x:.5*(e*Math.cos(K)/(ch*(kc+3*Nc*J+ee*(7*Fc+9*zc*J)))/Math.PI+.5),y:1-.5*(K*(kc+Nc*J+ee*(Fc+zc*J))/Math.PI+1),z:0}}unproject(e,F){e=(2*e-.5)*Math.PI;let K=F=(2*(1-F)-1)*Math.PI,J=K*K,ee=J*J*J;for(let pe,me,_e,xe=0;xe<12&&(me=K*(kc+Nc*J+ee*(Fc+zc*J))-F,_e=kc+3*Nc*J+ee*(7*Fc+9*zc*J),pe=me/_e,K=ht(K-pe,-Math.PI/3,Math.PI/3),J=K*K,ee=J*J*J,!(Math.abs(pe)<1e-12));++xe);const ie=ch*e*(kc+3*Nc*J+ee*(7*Fc+9*zc*J))/Math.cos(K),oe=Math.asin(Math.sin(K)/ch),le=ht(180*ie/Math.PI,-180,180),ce=ht(180*oe/Math.PI,-an,an);return new ii(le,ce)}}class L_ extends wa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,F){return{x:.5+e/360,y:.5-F/360,z:0}}unproject(e,F){const K=360*(e-.5),J=ht(360*(.5-F),-an,an);return new ii(K,J)}}const pl=Math.PI/2;function uh(t){return Math.tan((pl+t)/2)}class B_ extends wa{constructor(e){super(e),this.center=e.center||[0,30];const[F,K]=this.parallels=e.parallels||[30,30];let J=dr(F),ee=dr(K);this.southernCenter=J+ee<0,this.southernCenter&&(J=-J,ee=-ee);const ie=Math.cos(J),oe=uh(J);this.n=J===ee?Math.sin(J):Math.log(ie/Math.cos(ee))/Math.log(uh(ee)/oe),this.f=ie*Math.pow(uh(J),this.n)/this.n}project(e,F){F=dr(F),this.southernCenter&&(F=-F),e=dr(e-this.center[0]);const K=1e-6,{n:J,f:ee}=this;ee>0?F<-pl+K&&(F=-pl+K):F>pl-K&&(F=pl-K);const ie=ee/Math.pow(uh(F),J);let oe=ie*Math.sin(J*e),le=ee-ie*Math.cos(J*e);return oe=.5*(oe/Math.PI+.5),le=.5*(le/Math.PI+.5),{x:oe,y:this.southernCenter?le:1-le,z:0}}unproject(e,F){e=(2*e-.5)*Math.PI,this.southernCenter&&(F=1-F),F=(2*(1-F)-.5)*Math.PI;const{n:K,f:J}=this,ee=J-F,ie=Math.sign(ee),oe=Math.sign(K)*Math.sqrt(e*e+ee*ee);let le=Math.atan2(e,Math.abs(ee))*ie;ee*K<0&&(le-=Math.PI*Math.sign(e)*ie);const ce=ht(kr(le/K)+this.center[0],-180,180),pe=ht(kr(2*Math.atan(Math.pow(J/oe,1/K))-pl),-an,an);return new ii(ce,this.southernCenter?-pe:pe)}}class Hd extends wa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,F){return{x:So(e),y:Io(F),z:0}}unproject(e,F){const K=Nn(e),J=on(F);return new ii(K,J)}}const Kd=dr(an);class k_ extends wa{project(e,F){const K=(F=dr(F))*F,J=K*K;return{x:.5*((e=dr(e))*(.8707-.131979*K+J*(J*(.003971*K-.001529*J)-.013791))/Math.PI+.5),y:1-.5*(F*(1.007226+K*(.015085+J*(.028874*K-.044475-.005916*J)))/Math.PI+1),z:0}}unproject(e,F){e=(2*e-.5)*Math.PI;let K=F=(2*(1-F)-1)*Math.PI,J=25,ee=0,ie=K*K;do{ie=K*K;const ce=ie*ie;ee=(K*(1.007226+ie*(.015085+ce*(.028874*ie-.044475-.005916*ce)))-F)/(1.007226+ie*(.045255+ce*(.259866*ie-.311325-.005916*11*ce))),K=ht(K-ee,-Kd,Kd)}while(Math.abs(ee)>1e-6&&--J>0);ie=K*K;const oe=ht(kr(e/(.8707+ie*(ie*(ie*ie*ie*(.003971-.001529*ie)-.013791)-.131979))),-180,180),le=kr(K);return new ii(oe,le)}}const Zd=dr(an);class N_ extends wa{project(e,F){F=dr(F),e=dr(e);const K=Math.cos(F),J=2/Math.PI,ee=Math.acos(K*Math.cos(e/2)),ie=Math.sin(ee)/ee,oe=.5*(e*J+2*K*Math.sin(e/2)/ie)||0,le=.5*(F+Math.sin(F)/ie)||0;return{x:.5*(oe/Math.PI+.5),y:1-.5*(le/Math.PI+1),z:0}}unproject(e,F){let K=e=(2*e-.5)*Math.PI,J=F=(2*(1-F)-1)*Math.PI,ee=25;const ie=1e-6;let oe=0,le=0;do{const ce=Math.cos(J),pe=Math.sin(J),me=2*pe*ce,_e=pe*pe,xe=ce*ce,we=Math.cos(K/2),Ae=Math.sin(K/2),Re=2*we*Ae,ze=Ae*Ae,Ze=1-xe*we*we,Ue=Ze?1/Ze:0,He=Ze?Math.acos(ce*we)*Math.sqrt(1/Ze):0,Ye=.5*(2*He*ce*Ae+2*K/Math.PI)-e,Xe=.5*(He*pe+J)-F,dt=.5*Ue*(xe*ze+He*ce*we*_e)+1/Math.PI,ut=Ue*(Re*me/4-He*pe*Ae),Tt=.125*Ue*(me*Ae-He*pe*xe*Re),Nt=.5*Ue*(_e*we+He*ze*ce)+.5,_t=ut*Tt-Nt*dt;oe=(Xe*ut-Ye*Nt)/_t,le=(Ye*Tt-Xe*dt)/_t,K=ht(K-oe,-Math.PI,Math.PI),J=ht(J-le,-Zd,Zd)}while((Math.abs(oe)>ie||Math.abs(le)>ie)&&--ee>0);return new ii(kr(K),kr(J))}}class Xd extends wa{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(dr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,F){const{scale:K,cosPhi:J}=this;return{x:dr(e)*J*K+.5,y:-Math.sin(dr(F))/J*K+.5,z:0}}unproject(e,F){const{scale:K,cosPhi:J}=this,ee=-(F-.5)/K,ie=ht(kr((e-.5)/K)/J,-180,180),oe=Math.asin(ht(ee*J,-1,1)),le=ht(kr(oe),-an,an);return new ii(ie,le)}}class F_ extends Hd{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,F,K){const J=xc(e,F,K);return Ii(J,J,bc(To(K))),{x:J[0],y:J[1],z:J[2]}}locationPoint(e,F){const K=Js(F.lat,F.lng),J=dn([],K),ee=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(F),e._centerAltitude):e._centerAltitude;_c(K,K,J,yo(1,0)*ur*ee);const ie=po(new Float64Array(16));return os(ie,e.pixelMatrix,e.globeMatrix),Ii(K,K,ie),new zt(K[0],K[1])}pixelsPerMeter(e,F){return yo(1,0)*F}pixelSpaceConversion(e,F,K){const J=yo(1,e)*F,ee=zr(yo(1,45)*F,J,K);return this.pixelsPerMeter(e,F)/ee}createTileMatrix(e,F,K){const J=tf(To(K.canonical));return os(new Float64Array(16),e.globeMatrix,J)}createInversionMatrix(e,F){const{center:K}=e,J=bc(To(F));return Nu(J,J,dr(K.lng)),Wh(J,J,dr(K.lat)),as(J,J,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(J)}pointCoordinate(e,F,K,J){return xp(e,F,K,!0)||new el(0,0)}pointCoordinate3D(e,F,K){const J=this.pointCoordinate(e,F,K,0);return[J.x,J.y,J.z]}isPointAboveHorizon(e,F){return!xp(e,F.x,F.y,!1)}farthestPixelDistance(e){const F=function(J,ee){const ie=J.cameraToCenterDistance,oe=J._centerAltitude*ee,le=J._camera,ce=J._camera.forward(),pe=qo([],kn([],ce,-ie),[0,0,oe]),me=J.worldSize/(2*Math.PI),_e=[0,0,-me],xe=J.width/J.height,we=Math.tan(J.fovAboveCenter),Ae=kn([],le.up(),we),Re=kn([],le.right(),we*xe),ze=dn([],qo([],qo([],ce,Ae),Re)),Ze=[];let Ue;if(new Zh(pe,ze).closestPointOnSphere(_e,me,Ze)){const He=qo([],Ze,_e),Ye=mo([],He,pe);Ue=Math.cos(J.fovAboveCenter)*dc(Ye)}else{const He=mo([],pe,_e),Ye=mo([],_e,pe);dn(Ye,Ye);const Xe=dc(He)-me;Ue=Math.sqrt(Xe*(Xe+2*me));const dt=Math.acos(Ue/(me+Xe))-Math.acos(Zn(ce,Ye));Ue*=Math.cos(dt)}return 1.01*Ue}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),K=Qs(e.zoom);if(K>0){const J=qd(e,yo(1,e.center.lat)*e.worldSize),ee=e.worldSize/(2*Math.PI),ie=Math.max(e.width,e.height)/e.worldSize*Math.PI;return zr(F,J+ee*(1-Math.cos(ie)),Math.pow(K,10))}return F}upVector(e,F,K){return xc(F,K,e,1)}upVectorScale(e){return{metersToTile:Fu(Uu(To(e)))}}}function Yd(t){const e=t.parallels,F=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Hd(t);case"equirectangular":return new L_(t);case"naturalEarth":return new k_(t);case"equalEarth":return new D_(t);case"winkelTripel":return new N_(t);case"albers":return F?new Xd(t):new M_(t);case"lambertConformalConic":return F?new Xd(t):new B_(t);case"globe":return new F_(t)}throw new Error(`Invalid projection name: ${t.name}`)}const z_=Yu.types,U_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hh(t,e,F,K,J,ee,ie,oe,le,ce,pe,me,_e){const xe=oe?Math.min(ba,Math.round(oe[0])):0,we=oe?Math.min(ba,Math.round(oe[1])):0;t.emplaceBack(e,F,Math.round(32*K),Math.round(32*J),ee,ie,(xe<<1)+(le?1:0),we,16*ce,16*pe,256*me,256*_e)}function fh(t,e,F,K,J,ee,ie){t.emplaceBack(e,F,K,J,ee,ie)}function ph(t,e,F,K,J){t.emplaceBack(e,F,K,J),t.emplaceBack(e,F,K,J),t.emplaceBack(e,F,K,J),t.emplaceBack(e,F,K,J)}function j_(t){for(const e of t.sections)if(zh(e.text))return!0;return!1}class Mf{constructor(e){this.layoutVertexArray=new Mt,this.indexArray=new or,this.programConfigurations=e,this.segments=new Pi,this.dynamicLayoutVertexArray=new Bt,this.opacityVertexArray=new lr,this.placedSymbolArray=new Ci,this.globeExtVertexArray=new Ut}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,F,K,J){this.isEmpty()||(K&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,F),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Jy.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,U_,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Yy.members,!0)),this.opacityVertexBuffer.itemSize=1),(K||J)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}tr(Mf,"SymbolBuffers");class Df{constructor(e,F,K){this.layoutVertexArray=new e,this.layoutAttributes=F,this.indexArray=new K,this.segments=new Pi,this.collisionVertexArray=new Lr,this.collisionVertexArrayExt=new Pr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Qy.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,e_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}tr(Df,"CollisionBuffers");class Ea{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(ie=>ie.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=po([]),this.placementViewportMatrix=po([]);const F=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bf(this.zoom,F["text-size"]),this.iconSizeData=bf(this.zoom,F["icon-size"]);const K=this.layers[0].layout,J=K.get("symbol-sort-key"),ee=K.get("symbol-z-order");this.canOverlap=K.get("text-allow-overlap")||K.get("icon-allow-overlap")||K.get("text-ignore-placement")||K.get("icon-ignore-placement"),this.sortFeaturesByKey=ee!=="viewport-y"&&J.constantOr(1)!==void 0,this.sortFeaturesByY=(ee==="viewport-y"||ee==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=K.get("text-writing-mode").map(ie=>Fn[ie]),this.stateDependentLayerIds=this.layers.filter(ie=>ie.isStateDependent()).map(ie=>ie.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Mf(new ns(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Mf(new ns(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new pn,this.lineVertexArray=new Hs,this.symbolInstances=new mi}calculateGlyphDependencies(e,F,K,J,ee){for(let ie=0;ie<e.length;ie++)if(F[e.charCodeAt(ie)]=!0,J&&ee){const oe=Mc[e.charAt(ie)];oe&&(F[oe.charCodeAt(0)]=!0)}}populate(e,F,K,J){const ee=this.layers[0],ie=ee.layout,oe=this.projection.name==="globe",le=ie.get("text-font"),ce=ie.get("text-field"),pe=ie.get("icon-image"),me=(ce.value.kind!=="constant"||ce.value.value instanceof fn&&!ce.value.value.isEmpty()||ce.value.value.toString().length>0)&&(le.value.kind!=="constant"||le.value.value.length>0),_e=pe.value.kind!=="constant"||!!pe.value.value||Object.keys(pe.parameters).length>0,xe=ie.get("symbol-sort-key");if(this.features=[],!me&&!_e)return;const we=F.iconDependencies,Ae=F.glyphDependencies,Re=F.availableImages,ze=new de(this.zoom);for(const{feature:Ze,id:Ue,index:He,sourceLayerIndex:Ye}of e){const Xe=ee._featureFilter.needGeometry,dt=us(Ze,Xe);if(!ee._featureFilter.filter(ze,dt,K))continue;if(Xe||(dt.geometry=Ho(Ze,K,J)),oe&&Ze.type!==1&&K.z<=5){const _t=dt.geometry,Ct=.98078528056,Pt=(Lt,Gt)=>Zn(xc(Lt.x,Lt.y,K,1),xc(Gt.x,Gt.y,K,1))<Ct;for(let Lt=0;Lt<_t.length;Lt++)_t[Lt]=Jm(_t[Lt],Pt)}let ut,Tt;if(me){const _t=ee.getValueAndResolveTokens("text-field",dt,K,Re),Ct=fn.factory(_t);j_(Ct)&&(this.hasRTLText=!0),(!this.hasRTLText||ae()==="unavailable"||this.hasRTLText&&fe.isParsed())&&(ut=i_(Ct,ee,dt))}if(_e){const _t=ee.getValueAndResolveTokens("icon-image",dt,K,Re);Tt=_t instanceof Tn?_t:Tn.fromString(_t)}if(!ut&&!Tt)continue;const Nt=this.sortFeaturesByKey?xe.evaluate(dt,{},K):void 0;if(this.features.push({id:Ue,text:ut,icon:Tt,index:He,sourceLayerIndex:Ye,geometry:dt.geometry,properties:Ze.properties,type:z_[Ze.type],sortKey:Nt}),Tt&&(we[Tt.name]=!0),ut){const _t=le.evaluate(dt,{},K).join(","),Ct=ie.get("text-rotation-alignment")==="map"&&ie.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fn.vertical)>=0;for(const Pt of ut.sections)if(Pt.image)we[Pt.image.name]=!0;else{const Lt=ac(ut.toString()),Gt=Pt.fontStack||_t,bt=Ae[Gt]=Ae[Gt]||{};this.calculateGlyphDependencies(Pt.text,bt,Ct,this.allowVerticalPlacement,Lt)}}}ie.get("symbol-placement")==="line"&&(this.features=function(Ze){const Ue={},He={},Ye=[];let Xe=0;function dt(_t){Ye.push(Ze[_t]),Xe++}function ut(_t,Ct,Pt){const Lt=He[_t];return delete He[_t],He[Ct]=Lt,Ye[Lt].geometry[0].pop(),Ye[Lt].geometry[0]=Ye[Lt].geometry[0].concat(Pt[0]),Lt}function Tt(_t,Ct,Pt){const Lt=Ue[Ct];return delete Ue[Ct],Ue[_t]=Lt,Ye[Lt].geometry[0].shift(),Ye[Lt].geometry[0]=Pt[0].concat(Ye[Lt].geometry[0]),Lt}function Nt(_t,Ct,Pt){const Lt=Pt?Ct[0][Ct[0].length-1]:Ct[0][0];return`${_t}:${Lt.x}:${Lt.y}`}for(let _t=0;_t<Ze.length;_t++){const Ct=Ze[_t],Pt=Ct.geometry,Lt=Ct.text?Ct.text.toString():null;if(!Lt){dt(_t);continue}const Gt=Nt(Lt,Pt),bt=Nt(Lt,Pt,!0);if(Gt in He&&bt in Ue&&He[Gt]!==Ue[bt]){const Xt=Tt(Gt,bt,Pt),ir=ut(Gt,bt,Ye[Xt].geometry);delete Ue[Gt],delete He[bt],He[Nt(Lt,Ye[ir].geometry,!0)]=ir,Ye[Xt].geometry=null}else Gt in He?ut(Gt,bt,Pt):bt in Ue?Tt(Gt,bt,Pt):(dt(_t),Ue[Gt]=Xe-1,He[bt]=Xe-1)}return Ye.filter(_t=>_t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ze,Ue)=>Ze.sortKey-Ue.sortKey)}update(e,F,K,J){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,F,this.layers,K,J),this.icon.programConfigurations.updatePaintArrays(e,F,this.layers,K,J))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Yd(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,F){const K=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:J,y:ee}of F)this.lineVertexArray.emplaceBack(J,ee);return{lineStartIndex:K,lineLength:this.lineVertexArray.length-K}}addSymbols(e,F,K,J,ee,ie,oe,le,ce,pe,me,_e,xe,we){const Ae=e.indexArray,Re=e.layoutVertexArray,ze=e.globeExtVertexArray,Ze=e.segments.prepareSegment(4*F.length,Re,Ae,this.canOverlap?ie.sortKey:void 0),Ue=this.glyphOffsetArray.length,He=Ze.vertexLength,Ye=this.allowVerticalPlacement&&oe===Fn.vertical?Math.PI/2:0,Xe=ie.text&&ie.text.sections;for(let ut=0;ut<F.length;ut++){const{tl:Tt,tr:Nt,bl:_t,br:Ct,tex:Pt,pixelOffsetTL:Lt,pixelOffsetBR:Gt,minFontScaleX:bt,minFontScaleY:Xt,glyphOffset:ir,isSDF:Yt,sectionIndex:vr}=F[ut],Wt=Ze.vertexLength,cr=ir[1];if(hh(Re,ce.x,ce.y,Tt.x,cr+Tt.y,Pt.x,Pt.y,K,Yt,Lt.x,Lt.y,bt,Xt),hh(Re,ce.x,ce.y,Nt.x,cr+Nt.y,Pt.x+Pt.w,Pt.y,K,Yt,Gt.x,Lt.y,bt,Xt),hh(Re,ce.x,ce.y,_t.x,cr+_t.y,Pt.x,Pt.y+Pt.h,K,Yt,Lt.x,Gt.y,bt,Xt),hh(Re,ce.x,ce.y,Ct.x,cr+Ct.y,Pt.x+Pt.w,Pt.y+Pt.h,K,Yt,Gt.x,Gt.y,bt,Xt),le){const{x:$r,y:jr,z:xr}=le.anchor,[pr,pi,Tr]=le.up;fh(ze,$r,jr,xr,pr,pi,Tr),fh(ze,$r,jr,xr,pr,pi,Tr),fh(ze,$r,jr,xr,pr,pi,Tr),fh(ze,$r,jr,xr,pr,pi,Tr),ph(e.dynamicLayoutVertexArray,$r,jr,xr,Ye)}else ph(e.dynamicLayoutVertexArray,ce.x,ce.y,ce.z,Ye);Ae.emplaceBack(Wt,Wt+1,Wt+2),Ae.emplaceBack(Wt+1,Wt+2,Wt+3),Ze.vertexLength+=4,Ze.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ir[0]),ut!==F.length-1&&vr===F[ut+1].sectionIndex||e.programConfigurations.populatePaintArrays(Re.length,ie,ie.index,{},xe,we,Xe&&Xe[vr])}const dt=le?le.anchor:ce;e.placedSymbolArray.emplaceBack(dt.x,dt.y,dt.z,ce.x,ce.y,Ue,this.glyphOffsetArray.length-Ue,He,pe,me,ce.segment,K?K[0]:0,K?K[1]:0,J[0],J[1],oe,0,!1,0,_e,0)}_commitLayoutVertex(e,F,K,J,ee,ie,oe){e.emplaceBack(F,K,J,ee,ie,Math.round(oe.x),Math.round(oe.y))}_addCollisionDebugVertices(e,F,K,J,ee,ie,oe){const le=K.segments.prepareSegment(4,K.layoutVertexArray,K.indexArray),ce=le.vertexLength,pe=oe.tileAnchorX,me=oe.tileAnchorY;for(let xe=0;xe<4;xe++)K.collisionVertexArray.emplaceBack(0,0,0,0);K.collisionVertexArrayExt.emplaceBack(F,-e.padding,-e.padding),K.collisionVertexArrayExt.emplaceBack(F,e.padding,-e.padding),K.collisionVertexArrayExt.emplaceBack(F,e.padding,e.padding),K.collisionVertexArrayExt.emplaceBack(F,-e.padding,e.padding),this._commitLayoutVertex(K.layoutVertexArray,J,ee,ie,pe,me,new zt(e.x1,e.y1)),this._commitLayoutVertex(K.layoutVertexArray,J,ee,ie,pe,me,new zt(e.x2,e.y1)),this._commitLayoutVertex(K.layoutVertexArray,J,ee,ie,pe,me,new zt(e.x2,e.y2)),this._commitLayoutVertex(K.layoutVertexArray,J,ee,ie,pe,me,new zt(e.x1,e.y2)),le.vertexLength+=4;const _e=K.indexArray;_e.emplaceBack(ce,ce+1),_e.emplaceBack(ce+1,ce+2),_e.emplaceBack(ce+2,ce+3),_e.emplaceBack(ce+3,ce),le.primitiveLength+=4}_addTextDebugCollisionBoxes(e,F,K,J,ee,ie){for(let oe=J;oe<ee;oe++){const le=K.get(oe),ce=this.getSymbolInstanceTextSize(e,ie,F,oe);this._addCollisionDebugVertices(le,ce,this.textCollisionBox,le.projectedAnchorX,le.projectedAnchorY,le.projectedAnchorZ,ie)}}_addIconDebugCollisionBoxes(e,F,K,J,ee,ie){for(let oe=J;oe<ee;oe++){const le=K.get(oe),ce=this.getSymbolInstanceIconSize(e,F,ie.placedIconSymbolIndex);this._addCollisionDebugVertices(le,ce,this.iconCollisionBox,le.projectedAnchorX,le.projectedAnchorY,le.projectedAnchorZ,ie)}}generateCollisionDebugBuffers(e,F){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Df(rr,yd.members,Vi),this.iconCollisionBox=new Df(rr,yd.members,Vi);const K=ol(this.iconSizeData,e),J=ol(this.textSizeData,e);for(let ee=0;ee<this.symbolInstances.length;ee++){const ie=this.symbolInstances.get(ee);this._addTextDebugCollisionBoxes(J,e,F,ie.textBoxStartIndex,ie.textBoxEndIndex,ie),this._addTextDebugCollisionBoxes(J,e,F,ie.verticalTextBoxStartIndex,ie.verticalTextBoxEndIndex,ie),this._addIconDebugCollisionBoxes(K,e,F,ie.iconBoxStartIndex,ie.iconBoxEndIndex,ie),this._addIconDebugCollisionBoxes(K,e,F,ie.verticalIconBoxStartIndex,ie.verticalIconBoxEndIndex,ie)}}getSymbolInstanceTextSize(e,F,K,J){const ee=this.text.placedSymbolArray.get(F.rightJustifiedTextSymbolIndex>=0?F.rightJustifiedTextSymbolIndex:F.centerJustifiedTextSymbolIndex>=0?F.centerJustifiedTextSymbolIndex:F.leftJustifiedTextSymbolIndex>=0?F.leftJustifiedTextSymbolIndex:F.verticalPlacedTextSymbolIndex>=0?F.verticalPlacedTextSymbolIndex:J),ie=th(this.textSizeData,e,ee)/Zi;return this.tilePixelRatio*ie}getSymbolInstanceIconSize(e,F,K){const J=this.icon.placedSymbolArray.get(K),ee=th(this.iconSizeData,e,J);return this.tilePixelRatio*ee}_commitDebugCollisionVertexUpdate(e,F,K){e.emplaceBack(F,-K,-K),e.emplaceBack(F,K,-K),e.emplaceBack(F,K,K),e.emplaceBack(F,-K,K)}_updateTextDebugCollisionBoxes(e,F,K,J,ee,ie){for(let oe=J;oe<ee;oe++){const le=K.get(oe),ce=this.getSymbolInstanceTextSize(e,ie,F,oe);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,ce,le.padding)}}_updateIconDebugCollisionBoxes(e,F,K,J,ee,ie){for(let oe=J;oe<ee;oe++){const le=K.get(oe),ce=this.getSymbolInstanceIconSize(e,F,ie);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,ce,le.padding)}}updateCollisionDebugBuffers(e,F){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const K=ol(this.iconSizeData,e),J=ol(this.textSizeData,e);for(let ee=0;ee<this.symbolInstances.length;ee++){const ie=this.symbolInstances.get(ee);this._updateTextDebugCollisionBoxes(J,e,F,ie.textBoxStartIndex,ie.textBoxEndIndex,ie),this._updateTextDebugCollisionBoxes(J,e,F,ie.verticalTextBoxStartIndex,ie.verticalTextBoxEndIndex,ie),this._updateIconDebugCollisionBoxes(K,e,F,ie.iconBoxStartIndex,ie.iconBoxEndIndex,ie.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(K,e,F,ie.verticalIconBoxStartIndex,ie.verticalIconBoxEndIndex,ie.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,F,K,J,ee,ie,oe,le,ce){const pe={};if(F<K){const{x1:me,y1:_e,x2:xe,y2:we,padding:Ae,projectedAnchorX:Re,projectedAnchorY:ze,projectedAnchorZ:Ze,tileAnchorX:Ue,tileAnchorY:He,featureIndex:Ye}=e.get(F);pe.textBox={x1:me,y1:_e,x2:xe,y2:we,padding:Ae,projectedAnchorX:Re,projectedAnchorY:ze,projectedAnchorZ:Ze,tileAnchorX:Ue,tileAnchorY:He},pe.textFeatureIndex=Ye}if(J<ee){const{x1:me,y1:_e,x2:xe,y2:we,padding:Ae,projectedAnchorX:Re,projectedAnchorY:ze,projectedAnchorZ:Ze,tileAnchorX:Ue,tileAnchorY:He,featureIndex:Ye}=e.get(J);pe.verticalTextBox={x1:me,y1:_e,x2:xe,y2:we,padding:Ae,projectedAnchorX:Re,projectedAnchorY:ze,projectedAnchorZ:Ze,tileAnchorX:Ue,tileAnchorY:He},pe.verticalTextFeatureIndex=Ye}if(ie<oe){const{x1:me,y1:_e,x2:xe,y2:we,padding:Ae,projectedAnchorX:Re,projectedAnchorY:ze,projectedAnchorZ:Ze,tileAnchorX:Ue,tileAnchorY:He,featureIndex:Ye}=e.get(ie);pe.iconBox={x1:me,y1:_e,x2:xe,y2:we,padding:Ae,projectedAnchorX:Re,projectedAnchorY:ze,projectedAnchorZ:Ze,tileAnchorX:Ue,tileAnchorY:He},pe.iconFeatureIndex=Ye}if(le<ce){const{x1:me,y1:_e,x2:xe,y2:we,padding:Ae,projectedAnchorX:Re,projectedAnchorY:ze,projectedAnchorZ:Ze,tileAnchorX:Ue,tileAnchorY:He,featureIndex:Ye}=e.get(le);pe.verticalIconBox={x1:me,y1:_e,x2:xe,y2:we,padding:Ae,projectedAnchorX:Re,projectedAnchorY:ze,projectedAnchorZ:Ze,tileAnchorX:Ue,tileAnchorY:He},pe.verticalIconFeatureIndex=Ye}return pe}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let F=0;F<this.symbolInstances.length;F++){const K=this.symbolInstances.get(F);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,K.textBoxStartIndex,K.textBoxEndIndex,K.verticalTextBoxStartIndex,K.verticalTextBoxEndIndex,K.iconBoxStartIndex,K.iconBoxEndIndex,K.verticalIconBoxStartIndex,K.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,F){const K=e.placedSymbolArray.get(F),J=K.vertexStartIndex+4*K.numGlyphs;for(let ee=K.vertexStartIndex;ee<J;ee+=4)e.indexArray.emplaceBack(ee,ee+1,ee+2),e.indexArray.emplaceBack(ee+1,ee+2,ee+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const F=Math.sin(e),K=Math.cos(e),J=[],ee=[],ie=[];for(let oe=0;oe<this.symbolInstances.length;++oe){ie.push(oe);const le=this.symbolInstances.get(oe);J.push(0|Math.round(F*le.tileAnchorX+K*le.tileAnchorY)),ee.push(le.featureIndex)}return ie.sort((oe,le)=>J[oe]-J[le]||ee[le]-ee[oe]),ie}addToSortKeyRanges(e,F){const K=this.sortKeyRanges[this.sortKeyRanges.length-1];K&&K.sortKey===F?K.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:F,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const F of this.symbolInstanceIndexes){const K=this.symbolInstances.get(F);this.featureSortOrder.push(K.featureIndex);const{rightJustifiedTextSymbolIndex:J,centerJustifiedTextSymbolIndex:ee,leftJustifiedTextSymbolIndex:ie,verticalPlacedTextSymbolIndex:oe,placedIconSymbolIndex:le,verticalPlacedIconSymbolIndex:ce}=K;J>=0&&this.addIndicesForPlacedSymbol(this.text,J),ee>=0&&ee!==J&&this.addIndicesForPlacedSymbol(this.text,ee),ie>=0&&ie!==ee&&ie!==J&&this.addIndicesForPlacedSymbol(this.text,ie),oe>=0&&this.addIndicesForPlacedSymbol(this.text,oe),le>=0&&this.addIndicesForPlacedSymbol(this.icon,le),ce>=0&&this.addIndicesForPlacedSymbol(this.icon,ce)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}tr(Ea,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ea.MAX_GLYPHS=65535,Ea.addDynamicAttributes=ph;const V_=new Ge({"symbol-placement":new Se(Et.layout_symbol["symbol-placement"]),"symbol-spacing":new Se(Et.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Se(Et.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new De(Et.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Se(Et.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Se(Et.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Se(Et.layout_symbol["icon-ignore-placement"]),"icon-optional":new Se(Et.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Se(Et.layout_symbol["icon-rotation-alignment"]),"icon-size":new De(Et.layout_symbol["icon-size"]),"icon-text-fit":new Se(Et.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Se(Et.layout_symbol["icon-text-fit-padding"]),"icon-image":new De(Et.layout_symbol["icon-image"]),"icon-rotate":new De(Et.layout_symbol["icon-rotate"]),"icon-padding":new Se(Et.layout_symbol["icon-padding"]),"icon-keep-upright":new Se(Et.layout_symbol["icon-keep-upright"]),"icon-offset":new De(Et.layout_symbol["icon-offset"]),"icon-anchor":new De(Et.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Se(Et.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Se(Et.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Se(Et.layout_symbol["text-rotation-alignment"]),"text-field":new De(Et.layout_symbol["text-field"]),"text-font":new De(Et.layout_symbol["text-font"]),"text-size":new De(Et.layout_symbol["text-size"]),"text-max-width":new De(Et.layout_symbol["text-max-width"]),"text-line-height":new De(Et.layout_symbol["text-line-height"]),"text-letter-spacing":new De(Et.layout_symbol["text-letter-spacing"]),"text-justify":new De(Et.layout_symbol["text-justify"]),"text-radial-offset":new De(Et.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Se(Et.layout_symbol["text-variable-anchor"]),"text-anchor":new De(Et.layout_symbol["text-anchor"]),"text-max-angle":new Se(Et.layout_symbol["text-max-angle"]),"text-writing-mode":new Se(Et.layout_symbol["text-writing-mode"]),"text-rotate":new De(Et.layout_symbol["text-rotate"]),"text-padding":new Se(Et.layout_symbol["text-padding"]),"text-keep-upright":new Se(Et.layout_symbol["text-keep-upright"]),"text-transform":new De(Et.layout_symbol["text-transform"]),"text-offset":new De(Et.layout_symbol["text-offset"]),"text-allow-overlap":new Se(Et.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Se(Et.layout_symbol["text-ignore-placement"]),"text-optional":new Se(Et.layout_symbol["text-optional"])});var Lf={paint:new Ge({"icon-opacity":new De(Et.paint_symbol["icon-opacity"]),"icon-color":new De(Et.paint_symbol["icon-color"]),"icon-halo-color":new De(Et.paint_symbol["icon-halo-color"]),"icon-halo-width":new De(Et.paint_symbol["icon-halo-width"]),"icon-halo-blur":new De(Et.paint_symbol["icon-halo-blur"]),"icon-translate":new Se(Et.paint_symbol["icon-translate"]),"icon-translate-anchor":new Se(Et.paint_symbol["icon-translate-anchor"]),"text-opacity":new De(Et.paint_symbol["text-opacity"]),"text-color":new De(Et.paint_symbol["text-color"],{runtimeType:$n,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new De(Et.paint_symbol["text-halo-color"]),"text-halo-width":new De(Et.paint_symbol["text-halo-width"]),"text-halo-blur":new De(Et.paint_symbol["text-halo-blur"]),"text-translate":new Se(Et.paint_symbol["text-translate"]),"text-translate-anchor":new Se(Et.paint_symbol["text-translate-anchor"])}),layout:V_};class Jd{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ea,this.defaultValue=e}evaluate(e){if(e.formattedSection){const F=this.defaultValue.property.overrides;if(F&&F.hasOverride(e.formattedSection))return F.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tr(Jd,"FormatSectionOverride",{omit:["defaultValue"]});class dh extends fo{constructor(e){super(e,Lf)}recalculate(e,F){super.recalculate(e,F),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const K=this.layout.get("text-writing-mode");if(K){const J=[];for(const ee of K)J.indexOf(ee)<0&&J.push(ee);this.layout._values["text-writing-mode"]=J}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,F,K,J){const ee=this.layout.get(e).evaluate(F,{},K,J),ie=this._unevaluatedLayout._values[e];return ie.isDataDriven()||fa(ie.value)||!ee?ee:function(oe,le){return le.replace(/{([^{}]+)}/g,(ce,pe)=>pe in oe?String(oe[pe]):"")}(F.properties,ee)}createBucket(e){return new Ea(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Lf.paint.overridableProperties){if(!dh.hasPaintOverride(this.layout,e))continue;const F=this.paint.get(e),K=new Jd(F),J=new Fs(K,F.property.specification);let ee=null;ee=F.value.kind==="constant"||F.value.kind==="source"?new Zl("source",J):new Ka("composite",J,F.value.zoomStops,F.value._interpolationType),this.paint._values[e]=new Be(F.property,ee,F.parameters)}}_handleOverridablePaintPropertyUpdate(e,F,K){return!(!this.layout||F.isDataDriven()||K.isDataDriven())&&dh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,F){const K=e.get("text-field"),J=Lf.paint.properties[F];let ee=!1;const ie=oe=>{for(const le of oe)if(J.overrides&&J.overrides.hasOverride(le))return void(ee=!0)};if(K.value.kind==="constant"&&K.value.value instanceof fn)ie(K.value.value.sections);else if(K.value.kind==="source"){const oe=ce=>{ee||(ce instanceof Lo&&wi(ce.value)===Pa?ie(ce.value.sections):ce instanceof xo?ie(ce.sections):ce.eachChild(oe))},le=K.value;le._styleExpression&&oe(le._styleExpression.expression)}return ee}getProgramConfiguration(e){return new va(this,e)}}var G_={paint:new Ge({"background-color":new Se(Et.paint_background["background-color"]),"background-pattern":new Se(Et.paint_background["background-pattern"]),"background-opacity":new Se(Et.paint_background["background-opacity"])})},W_={paint:new Ge({"raster-opacity":new Se(Et.paint_raster["raster-opacity"]),"raster-hue-rotate":new Se(Et.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Se(Et.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Se(Et.paint_raster["raster-brightness-max"]),"raster-saturation":new Se(Et.paint_raster["raster-saturation"]),"raster-contrast":new Se(Et.paint_raster["raster-contrast"]),"raster-resampling":new Se(Et.paint_raster["raster-resampling"]),"raster-fade-duration":new Se(Et.paint_raster["raster-fade-duration"])})};class q_ extends fo{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var H_={paint:new Ge({"sky-type":new Se(Et.paint_sky["sky-type"]),"sky-atmosphere-sun":new Se(Et.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Se(Et.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Se(Et.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Se(Et.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ve(Et.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Se(Et.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Se(Et.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Se(Et.paint_sky["sky-opacity"])})};function Bf(t,e,F){const K=[0,0,1],J=mp([]);return _p(J,J,F?-dr(t)+Math.PI:dr(t)),yp(J,J,-dr(e)),hp(K,K,J),dn(K,K)}const K_={circle:class extends fo{constructor(t){super(t,oy)}createBucket(t){return new lf(t)}queryRadius(t){const e=t;return tl("circle-radius",this,e)+tl("circle-stroke-width",this,e)+Gu(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,F,K,J,ee,ie,oe){const le=zp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),ee.angle,t.pixelToTileUnitsFactor),ce=this.paint.get("circle-radius").evaluate(e,F)+this.paint.get("circle-stroke-width").evaluate(e,F);return Up(t,K,ee,ie,oe,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",le,ce)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new va(this,t)}},heatmap:class extends fo{createBucket(t){return new Vp(t)}constructor(t){super(t,cy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ff({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return tl("heatmap-radius",this,t)}queryIntersectsFeature(t,e,F,K,J,ee,ie,oe){const le=this.paint.get("heatmap-radius").evaluate(e,F);return Up(t,K,ee,ie,oe,!0,!0,new zt(0,0),le)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new va(this,t)}},hillshade:class extends fo{constructor(t){super(t,uy)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends fo{constructor(t){super(t,Sy)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),F=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&F.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),F}getProgramConfiguration(t){return new va(this,t)}recalculate(t,e){super.recalculate(t,e);const F=this.paint._values["fill-outline-color"];F.value.kind==="constant"&&F.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Zu(t)}queryRadius(){return Gu(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,F,K,J,ee){return!t.queryGeometry.isAboveHorizon&&Lp(Fp(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),ee.angle,t.pixelToTileUnitsFactor),K)}isTileClipped(){return!0}},"fill-extrusion":class extends fo{constructor(t){super(t,jy)}createBucket(t){return new Cc(t)}queryRadius(){return Gu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new va(this,t)}queryIntersectsFeature(t,e,F,K,J,ee,ie,oe,le){const ce=zp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),ee.angle,t.pixelToTileUnitsFactor),pe=this.paint.get("fill-extrusion-height").evaluate(e,F),me=this.paint.get("fill-extrusion-base").evaluate(e,F),_e=[0,0],xe=oe&&ee.elevation,we=ee.elevation?ee.elevation.exaggeration():1,Ae=t.tile.getBucket(this);if(xe&&Ae instanceof Cc){const He=Ae.centroidVertexArray,Ye=le+1;Ye<He.length&&(_e[0]=He.geta_centroid_pos0(Ye),_e[1]=He.geta_centroid_pos1(Ye))}if(_e[0]===0&&_e[1]===1)return!1;ee.projection.name==="globe"&&(K=ld([K],[new zt(0,0),new zt(ur,ur)],t.tileID.canonical).map(He=>He.polygon).flat());const Re=xe?oe:null,[ze,Ze]=function(He,Ye,Xe,dt,ut,Tt,Nt,_t,Ct,Pt,Lt){return He.projection.name==="globe"?function(Gt,bt,Xt,ir,Yt,vr,Wt,cr,$r,jr,xr){const pr=[],pi=[],Tr=Gt.projection.upVectorScale(xr,Gt.center.lat,Gt.worldSize).metersToTile,Sr=[0,0,0,1],ni=[0,0,0,1],ci=(oi,$i,Ei,Mi)=>{oi[0]=$i,oi[1]=Ei,oi[2]=Mi,oi[3]=1},ui=sd();Xt>0&&(Xt+=ui),ir+=ui;for(const oi of bt){const $i=[],Ei=[];for(const Mi of oi){const ai=Mi.x+Yt.x,Ni=Mi.y+Yt.y,Di=Gt.projection.projectTilePoint(ai,Ni,xr),bi=Gt.projection.upVector(xr,Mi.x,Mi.y);let Gr=Xt,Li=ir;if(Wt){const fi=fd(ai,Ni,Xt,ir,Wt,cr,$r,jr);Gr+=fi.base,Li+=fi.top}Xt!==0?ci(Sr,Di.x+bi[0]*Tr*Gr,Di.y+bi[1]*Tr*Gr,Di.z+bi[2]*Tr*Gr):ci(Sr,Di.x,Di.y,Di.z),ci(ni,Di.x+bi[0]*Tr*Li,Di.y+bi[1]*Tr*Li,Di.z+bi[2]*Tr*Li),Ii(Sr,Sr,vr),Ii(ni,ni,vr),$i.push(new nl(Sr[0],Sr[1],Sr[2])),Ei.push(new nl(ni[0],ni[1],ni[2]))}pr.push($i),pi.push(Ei)}return[pr,pi]}(He,Ye,Xe,dt,ut,Tt,Nt,_t,Ct,Pt,Lt):Nt?function(Gt,bt,Xt,ir,Yt,vr,Wt,cr,$r){const jr=[],xr=[],pr=[0,0,0,1];for(const pi of Gt){const Tr=[],Sr=[];for(const ni of pi){const ci=ni.x+ir.x,ui=ni.y+ir.y,oi=fd(ci,ui,bt,Xt,vr,Wt,cr,$r);pr[0]=ci,pr[1]=ui,pr[2]=oi.base,pr[3]=1,ss(pr,pr,Yt),pr[3]=Math.max(pr[3],1e-5);const $i=new nl(pr[0]/pr[3],pr[1]/pr[3],pr[2]/pr[3]);pr[0]=ci,pr[1]=ui,pr[2]=oi.top,pr[3]=1,ss(pr,pr,Yt),pr[3]=Math.max(pr[3],1e-5);const Ei=new nl(pr[0]/pr[3],pr[1]/pr[3],pr[2]/pr[3]);Tr.push($i),Sr.push(Ei)}jr.push(Tr),xr.push(Sr)}return[jr,xr]}(Ye,Xe,dt,ut,Tt,Nt,_t,Ct,Pt):function(Gt,bt,Xt,ir,Yt){const vr=[],Wt=[],cr=Yt[8]*bt,$r=Yt[9]*bt,jr=Yt[10]*bt,xr=Yt[11]*bt,pr=Yt[8]*Xt,pi=Yt[9]*Xt,Tr=Yt[10]*Xt,Sr=Yt[11]*Xt;for(const ni of Gt){const ci=[],ui=[];for(const oi of ni){const $i=oi.x+ir.x,Ei=oi.y+ir.y,Mi=Yt[0]*$i+Yt[4]*Ei+Yt[12],ai=Yt[1]*$i+Yt[5]*Ei+Yt[13],Ni=Yt[2]*$i+Yt[6]*Ei+Yt[14],Di=Yt[3]*$i+Yt[7]*Ei+Yt[15],bi=Mi+cr,Gr=ai+$r,Li=Ni+jr,fi=Math.max(Di+xr,1e-5),_n=Mi+pr,Bi=ai+pi,Xi=Ni+Tr,Gi=Math.max(Di+Sr,1e-5);ci.push(new nl(bi/fi,Gr/fi,Li/fi)),ui.push(new nl(_n/Gi,Bi/Gi,Xi/Gi))}vr.push(ci),Wt.push(ui)}return[vr,Wt]}(Ye,Xe,dt,ut,Tt)}(ee,K,me,pe,ce,ie,Re,_e,we,ee.center.lat,t.tileID.canonical),Ue=t.queryGeometry;return function(He,Ye,Xe){let dt=1/0;Lp(Xe,Ye)&&(dt=hd(Xe,Ye[0]));for(let ut=0;ut<Ye.length;ut++){const Tt=Ye[ut],Nt=He[ut];for(let _t=0;_t<Tt.length-1;_t++){const Ct=Tt[_t],Pt=[Ct,Tt[_t+1],Nt[_t+1],Nt[_t],Ct];Dp(Xe,Pt)&&(dt=Math.min(dt,hd(Xe,Pt)))}}return dt!==1/0&&dt}(ze,Ze,Ue.isPointQuery()?Ue.screenBounds:Ue.screenGeometry)}},line:class extends fo{constructor(t){super(t,pd),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Bl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=dd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new eh(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new va(this,t)}queryRadius(t){const e=t,F=md(tl("line-width",this,e),tl("line-gap-width",this,e)),K=tl("line-offset",this,e);return F/2+Math.abs(K)+Gu(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,F,K,J,ee){if(t.queryGeometry.isAboveHorizon)return!1;const ie=Fp(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),ee.angle,t.pixelToTileUnitsFactor),oe=t.pixelToTileUnitsFactor/2*md(this.paint.get("line-width").evaluate(e,F),this.paint.get("line-gap-width").evaluate(e,F)),le=this.paint.get("line-offset").evaluate(e,F);return le&&(K=function(ce,pe){const me=[],_e=new zt(0,0);for(let xe=0;xe<ce.length;xe++){const we=ce[xe],Ae=[];for(let Re=0;Re<we.length;Re++){const ze=we[Re],Ze=we[Re+1],Ue=Re===0?_e:ze.sub(we[Re-1])._unit()._perp(),He=Re===we.length-1?_e:Ze.sub(ze)._unit()._perp(),Ye=Ue._add(He)._unit();Ye._mult(1/(Ye.x*He.x+Ye.y*He.y)),Ae.push(Ye._mult(pe)._add(ze))}me.push(Ae)}return me}(K,le*t.pixelToTileUnitsFactor)),function(ce,pe,me){for(let _e=0;_e<pe.length;_e++){const xe=pe[_e];if(ce.length>=3){for(let we=0;we<xe.length;we++)if(hs(ce,xe[we]))return!0}if(ty(ce,xe,me))return!0}return!1}(ie,K,oe)}isTileClipped(){return!0}},symbol:dh,background:class extends fo{constructor(t){super(t,G_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends fo{constructor(t){super(t,W_)}getProgramIds(){return["raster"]}},sky:class extends fo{constructor(t){super(t,H_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ff({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const K=this.paint.get("sky-atmosphere-sun"),J=!K,ee=t.style.light,ie=ee.properties.get("position");return J&&ee.properties.get("anchor")==="viewport"&&di("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),J?Bf(ie.azimuthal,90-ie.polar,e):Bf(K[0],90-K[1],e)}const F=this.paint.get("sky-gradient-center");return Bf(F[0],90-F[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class Uc{constructor(e,F,K,J){this.context=e,this.format=K,this.texture=e.gl.createTexture(),this.update(F,J)}update(e,F,K){const{width:J,height:ee}=e,{context:ie}=this,{gl:oe}=ie,{HTMLImageElement:le,HTMLCanvasElement:ce,HTMLVideoElement:pe,ImageData:me,ImageBitmap:_e}=ye;if(oe.bindTexture(oe.TEXTURE_2D,this.texture),ie.pixelStoreUnpackFlipY.set(!1),ie.pixelStoreUnpack.set(1),ie.pixelStoreUnpackPremultiplyAlpha.set(this.format===oe.RGBA&&(!F||F.premultiply!==!1)),K||this.size&&this.size[0]===J&&this.size[1]===ee){const{x:xe,y:we}=K||{x:0,y:0};e instanceof le||e instanceof ce||e instanceof pe||e instanceof me||_e&&e instanceof _e?oe.texSubImage2D(oe.TEXTURE_2D,0,xe,we,oe.RGBA,oe.UNSIGNED_BYTE,e):oe.texSubImage2D(oe.TEXTURE_2D,0,xe,we,J,ee,oe.RGBA,oe.UNSIGNED_BYTE,e.data)}else this.size=[J,ee],e instanceof le||e instanceof ce||e instanceof pe||e instanceof me||_e&&e instanceof _e?oe.texImage2D(oe.TEXTURE_2D,0,this.format,this.format,oe.UNSIGNED_BYTE,e):oe.texImage2D(oe.TEXTURE_2D,0,this.format,J,ee,0,this.format,oe.UNSIGNED_BYTE,e.data);this.useMipmap=!!(F&&F.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&oe.generateMipmap(oe.TEXTURE_2D)}bind(e,F){const{context:K}=this,{gl:J}=K;J.bindTexture(J.TEXTURE_2D,this.texture),e!==this.filter&&(J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,e),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,this.useMipmap?e===J.NEAREST?J.NEAREST_MIPMAP_NEAREST:J.LINEAR_MIPMAP_NEAREST:e),this.filter=e),F!==this.wrap&&(J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,F),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,F),this.wrap=F)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Z_{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class X_{constructor(){this.tasks={},this.taskQueue=[],Yi(["process"],this),this.invoker=new Z_(this.process),this.nextId=0}add(e,F){const K=this.nextId++,J=function({type:ee,isSymbolTile:ie,zoom:oe}){return oe=oe||0,ee==="message"?0:ee!=="maybePrepare"||ie?ee!=="parseTile"||ie?ee==="parseTile"&&ie?300-oe:ee==="maybePrepare"&&ie?400-oe:500:200-oe:100-oe}(F);if(J===0){Mn();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[K]={fn:e,metadata:F,priority:J,id:K},this.taskQueue.push(K),this.invoker.trigger(),{cancel:()=>{delete this.tasks[K]}}}process(){Mn();try{if(this.taskQueue=this.taskQueue.filter(K=>!!this.tasks[K]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const F=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!F)return;F.fn()}finally{}}pick(){let e=null,F=1/0;for(let J=0;J<this.taskQueue.length;J++){const ee=this.tasks[this.taskQueue[J]];ee.priority<F&&(F=ee.priority,e=J)}if(e===null)return null;const K=this.taskQueue[e];return this.taskQueue.splice(e,1),K}remove(){this.invoker.remove()}}class Qd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let F=0;F<e.length;F++){const K=e[F];this._stringToNumber[K]=F,this._numberToString[F]=K}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Y_=["tile","layer","source","sourceLayer","state"];class em{constructor(e,F,K,J,ee){this.type="Feature",this._vectorTileFeature=e,this._z=F,this._x=K,this._y=J,this.properties=e.properties,this.id=ee}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const F of Y_)this[F]!==void 0&&(e[F]=this[F]);return e}}const Jn=32,Ao=33,Ta=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,F=0,K=0,J=0,ee=0,ie=0,oe=0;for(1&e?J=ee=ie=Jn:F=K=oe=Jn;(e>>=1)>1;){const ce=F+J>>1,pe=K+ee>>1;1&e?(J=F,ee=K,F=ie,K=oe):(F=J,K=ee,J=ie,ee=oe),ie=ce,oe=pe}const le=4*t;Ta[le+0]=F,Ta[le+1]=K,Ta[le+2]=J,Ta[le+3]=ee}const Oo=new Uint16Array(2178),Sa=new Uint8Array(1089),mh=new Uint16Array(1089);function tm(t){return t===0?-.03125:t===32?.03125:0}var rm=nt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const im={type:2,extent:ur,loadGeometry:()=>[[new zt(0,0),new zt(ur+1,0),new zt(ur+1,ur+1),new zt(0,ur+1),new zt(0,0)]]};class kf{constructor(e,F,K,J,ee){this.tileID=e,this.uid=si(),this.uses=0,this.tileSize=F,this.tileZoom=K,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=ee,this.expiredRequestCount=0,this.state="loading",J&&J.transform&&(this.projection=J.transform.projection)}registerFadeDuration(e){const F=e+this.timeAdded;F<eo.now()||this.fadeEndTime&&F<this.fadeEndTime||(this.fadeEndTime=F)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=ps(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,F,K){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(J,ee){const ie={};if(!ee)return ie;for(const oe of J){const le=oe.layerIds.map(ce=>ee.getLayer(ce)).filter(Boolean);if(le.length!==0){oe.layers=le,oe.stateDependentLayerIds&&(oe.stateDependentLayers=oe.stateDependentLayerIds.map(ce=>le.filter(pe=>pe.id===ce)[0]));for(const ce of le)ie[ce.id]=oe}}return ie}(e.buckets,F.style),this.hasSymbolBuckets=!1;for(const J in this.buckets){const ee=this.buckets[J];if(ee instanceof Ea){if(this.hasSymbolBuckets=!0,!K)break;ee.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const J in this.buckets){const ee=this.buckets[J];if(ee instanceof Ea&&ee.hasRTLText){this.hasRTLText=!0,fe.isLoading()||fe.isLoaded()||ae()!=="deferred"||he();break}}this.queryPadding=0;for(const J in this.buckets){const ee=this.buckets[J];this.queryPadding=Math.max(this.queryPadding,F.style.getLayer(J).queryRadius(ee))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ri}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const K in this.buckets){const J=this.buckets[K];J.uploadPending()&&J.upload(e)}const F=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Uc(e,this.imageAtlas.image,F.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Uc(e,this.glyphAtlasImage,F.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Uc(e,this.lineAtlas.image,F.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,F,K,J,ee,ie,oe,le){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:J,pixelPosMatrix:oe,transform:ie,params:ee,tileTransform:this.tileTransform},e,F,K):{}}querySourceFeatures(e,F){const K=this.latestFeatureIndex;if(!K||!K.rawTileData)return;const J=K.loadVTLayers(),ee=F?F.sourceLayer:"",ie=J._geojsonTileLayer||J[ee];if(!ie)return;const oe=Vs(F&&F.filter),{z:le,x:ce,y:pe}=this.tileID.canonical,me={z:le,x:ce,y:pe};for(let _e=0;_e<ie.length;_e++){const xe=ie.feature(_e);if(oe.needGeometry){const Re=us(xe,!0);if(!oe.filter(new de(this.tileID.overscaledZ),Re,this.tileID.canonical))continue}else if(!oe.filter(new de(this.tileID.overscaledZ),xe))continue;const we=K.getId(xe,ee),Ae=new em(xe,le,ce,pe,we);Ae.tile=me,e.push(Ae)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const F=this.expirationTime;if(e.cacheControl){const K=en(e.cacheControl);K["max-age"]&&(this.expirationTime=Date.now()+1e3*K["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const K=Date.now();let J=!1;if(this.expirationTime>K)J=!1;else if(F)if(this.expirationTime<F)J=!0;else{const ee=this.expirationTime-F;ee?this.expirationTime=K+Math.max(ee,3e4):J=!0}else J=!0;J?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,F){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!F)return;const K=this.latestFeatureIndex.loadVTLayers(),J=F.style.listImages();for(const ee in this.buckets){if(!F.style.hasLayer(ee))continue;const ie=this.buckets[ee],oe=ie.layers[0].sourceLayer||"_geojsonTileLayer",le=K[oe],ce=e[oe];if(!le||!ce||Object.keys(ce).length===0)continue;if(ie.update(ce,le,J,this.imageAtlas&&this.imageAtlas.patternPositions||{}),ie instanceof eh||ie instanceof Zu){const me=F.style._getSourceCache(ie.layers[0].source);F._terrain&&F._terrain.enabled&&me&&ie.programConfigurations.needsUpload&&F._terrain._clearRenderCacheForTile(me.id,this.tileID)}const pe=F&&F.style&&F.style.getLayer(ee);pe&&(this.queryPadding=Math.max(this.queryPadding,pe.queryRadius(ie)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<eo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=eo.now()+e}setTexture(e,F){const K=F.context,J=K.gl;this.texture=this.texture||F.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Uc(K,e,J.RGBA,{useMipmap:!0}),this.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE))}setDependencies(e,F){const K={};for(const J of F)K[J]=!0;this.dependencies[e]=K}hasDependency(e,F){for(const K of e){const J=this.dependencies[K];if(J){for(const ee of F)if(J[ee])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,F){if(!F||F.name==="mercator"||this._tileDebugBuffer)return;const K=Ho(im,this.tileID.canonical,this.tileTransform)[0],J=new kt,ee=new An;for(let ie=0;ie<K.length;ie++){const{x:oe,y:le}=K[ie];J.emplaceBack(oe,le),ee.emplaceBack(ie)}ee.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(ee),this._tileDebugBuffer=e.createVertexBuffer(J,vc.members),this._tileDebugSegments=Pi.simpleSegment(0,0,J.length,ee.length)}_makeTileBoundsBuffers(e,F){if(this._tileBoundsBuffer||!F||F.name==="mercator")return;const K=Ho(im,this.tileID.canonical,this.tileTransform)[0];let J,ee;if(this.isRaster){const ie=function(oe,le){const ce=ps(oe,le),pe=Math.pow(2,oe.z);for(let Re=0;Re<Ao;Re++)for(let ze=0;ze<Ao;ze++){const Ze=Nn((oe.x+(ze+tm(ze))/Jn)/pe),Ue=on((oe.y+(Re+tm(Re))/Jn)/pe),He=le.project(Ze,Ue),Ye=Re*Ao+ze;Oo[2*Ye+0]=Math.round((He.x*ce.scale-ce.x)*ur),Oo[2*Ye+1]=Math.round((He.y*ce.scale-ce.y)*ur)}Sa.fill(0),mh.fill(0);for(let Re=2045;Re>=0;Re--){const ze=4*Re,Ze=Ta[ze+0],Ue=Ta[ze+1],He=Ta[ze+2],Ye=Ta[ze+3],Xe=Ze+He>>1,dt=Ue+Ye>>1,ut=Xe+dt-Ue,Tt=dt+Ze-Xe,Nt=Ue*Ao+Ze,_t=Ye*Ao+He,Ct=dt*Ao+Xe,Pt=Math.hypot((Oo[2*Nt+0]+Oo[2*_t+0])/2-Oo[2*Ct+0],(Oo[2*Nt+1]+Oo[2*_t+1])/2-Oo[2*Ct+1])>=16;Sa[Ct]=Sa[Ct]||(Pt?1:0),Re<1022&&(Sa[Ct]=Sa[Ct]||Sa[(Ue+Tt>>1)*Ao+(Ze+ut>>1)]||Sa[(Ye+Tt>>1)*Ao+(He+ut>>1)])}const me=new At,_e=new or;let xe=0;function we(Re,ze){const Ze=ze*Ao+Re;return mh[Ze]===0&&(me.emplaceBack(Oo[2*Ze+0],Oo[2*Ze+1],Re*ur/Jn,ze*ur/Jn),mh[Ze]=++xe),mh[Ze]-1}function Ae(Re,ze,Ze,Ue,He,Ye){const Xe=Re+Ze>>1,dt=ze+Ue>>1;if(Math.abs(Re-He)+Math.abs(ze-Ye)>1&&Sa[dt*Ao+Xe])Ae(He,Ye,Re,ze,Xe,dt),Ae(Ze,Ue,He,Ye,Xe,dt);else{const ut=we(Re,ze),Tt=we(Ze,Ue),Nt=we(He,Ye);_e.emplaceBack(ut,Tt,Nt)}}return Ae(0,0,Jn,Jn,Jn,0),Ae(Jn,Jn,0,0,0,Jn),{vertices:me,indices:_e}}(this.tileID.canonical,F);J=ie.vertices,ee=ie.indices}else{J=new At,ee=new or;for(const{x:oe,y:le}of K)J.emplaceBack(oe,le,0,0);const ie=_f(J.int16,void 0,4);for(let oe=0;oe<ie.length;oe+=3)ee.emplaceBack(ie[oe],ie[oe+1],ie[oe+2])}this._tileBoundsBuffer=e.createVertexBuffer(J,rm.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(ee),this._tileBoundsSegments=Pi.simpleSegment(0,0,J.length,ee.length)}_makeGlobeTileDebugBuffers(e,F){const K=F.projection;if(!K||K.name!=="globe"||F.freezeTileCoverage)return;const J=this.tileID.canonical,ee=bc(bp(J,F)),ie=Qs(F.zoom);let oe;ie>0&&(oe=Gh(new Float64Array(16),F.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,J,F,ee,oe,ie),this._makeGlobeTileDebugTextBuffer(e,J,F,ee,oe,ie)}_globePoint(e,F,K,J,ee,ie,oe){let le=xc(e,F,K);if(ie){const ce=1<<K.z,pe=So(J.center.lng),me=Io(J.center.lat),_e=(K.x+.5)/ce-pe;let xe=0;_e>.5?xe=-1:_e<-.5&&(xe=1);let we=(e/ur+K.x)/ce+xe,Ae=(F/ur+K.y)/ce;we=(we-pe)*J._pixelsPerMercatorPixel+pe,Ae=(Ae-me)*J._pixelsPerMercatorPixel+me;const Re=[we*J.worldSize,Ae*J.worldSize,0];Ii(Re,Re,ie),le=cs(le,Re,oe)}return Ii(le,le,ee)}_makeGlobeTileDebugBorderBuffer(e,F,K,J,ee,ie){const oe=new kt,le=new An,ce=new ct,pe=(_e,xe,we,Ae,Re)=>{const ze=(we-_e)/(Re-1),Ze=(Ae-xe)/(Re-1),Ue=oe.length;for(let He=0;He<Re;He++){const Ye=_e+He*ze,Xe=xe+He*Ze;oe.emplaceBack(Ye,Xe);const dt=this._globePoint(Ye,Xe,F,K,J,ee,ie);ce.emplaceBack(dt[0],dt[1],dt[2]),le.emplaceBack(Ue+He)}},me=ur;pe(0,0,me,0,16),pe(me,0,me,me,16),pe(me,me,0,me,16),pe(0,me,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(le),this._tileDebugBuffer=e.createVertexBuffer(oe,vc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(ce,vp.members),this._tileDebugSegments=Pi.simpleSegment(0,0,oe.length,le.length)}_makeGlobeTileDebugTextBuffer(e,F,K,J,ee,ie){const oe=ur/4,le=new kt,ce=new or,pe=new ct,me=25;ce.reserve(32),le.reserve(me),pe.reserve(me);const _e=(xe,we)=>me*xe+we;for(let xe=0;xe<me;xe++){const we=xe*oe;for(let Ae=0;Ae<me;Ae++){const Re=Ae*oe;le.emplaceBack(Re,we);const ze=this._globePoint(Re,we,F,K,J,ee,ie);pe.emplaceBack(ze[0],ze[1],ze[2])}}for(let xe=0;xe<4;xe++)for(let we=0;we<4;we++){const Ae=_e(xe,we),Re=_e(xe,we+1),ze=_e(xe+1,we),Ze=_e(xe+1,we+1);ce.emplaceBack(Ae,Re,ze),ce.emplaceBack(ze,Re,Ze)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(ce),this._tileDebugTextBuffer=e.createVertexBuffer(le,vc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(pe,vp.members),this._tileDebugTextSegments=Pi.simpleSegment(0,0,me,32)}}class J_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,F,K){const J=String(F);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][J]=this.stateChanges[e][J]||{},mr(this.stateChanges[e][J],K),this.deletedStates[e]===null){this.deletedStates[e]={};for(const ee in this.state[e])ee!==J&&(this.deletedStates[e][ee]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][J]===null){this.deletedStates[e][J]={};for(const ee in this.state[e][J])K[ee]||(this.deletedStates[e][J][ee]=null)}else for(const ee in K)this.deletedStates[e]&&this.deletedStates[e][J]&&this.deletedStates[e][J][ee]===null&&delete this.deletedStates[e][J][ee]}removeFeatureState(e,F,K){if(this.deletedStates[e]===null)return;const J=String(F);if(this.deletedStates[e]=this.deletedStates[e]||{},K&&F!==void 0)this.deletedStates[e][J]!==null&&(this.deletedStates[e][J]=this.deletedStates[e][J]||{},this.deletedStates[e][J][K]=null);else if(F!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][J])for(K in this.deletedStates[e][J]={},this.stateChanges[e][J])this.deletedStates[e][J][K]=null;else this.deletedStates[e][J]=null;else this.deletedStates[e]=null}getState(e,F){const K=String(F),J=mr({},(this.state[e]||{})[K],(this.stateChanges[e]||{})[K]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const ee=this.deletedStates[e][F];if(ee===null)return{};for(const ie in ee)delete J[ie]}return J}initializeTileState(e,F){e.setFeatureState(this.state,F)}coalesceChanges(e,F){const K={};for(const J in this.stateChanges){this.state[J]=this.state[J]||{};const ee={};for(const ie in this.stateChanges[J])this.state[J][ie]||(this.state[J][ie]={}),mr(this.state[J][ie],this.stateChanges[J][ie]),ee[ie]=this.state[J][ie];K[J]=ee}for(const J in this.deletedStates){this.state[J]=this.state[J]||{};const ee={};if(this.deletedStates[J]===null)for(const ie in this.state[J])ee[ie]={},this.state[J][ie]={};else for(const ie in this.deletedStates[J]){if(this.deletedStates[J][ie]===null)this.state[J][ie]={};else if(this.state[J][ie])for(const oe of Object.keys(this.deletedStates[J][ie]))delete this.state[J][ie][oe];ee[ie]=this.state[J][ie]}K[J]=K[J]||{},mr(K[J],ee)}if(this.stateChanges={},this.deletedStates={},Object.keys(K).length!==0)for(const J in e)e[J].setFeatureState(K,F)}}class nm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,F){const K=this.toIdx(e,F);return{min:this.minimums[K],max:this.maximums[K]}}isLeaf(e,F){return this.leaves[this.toIdx(e,F)]}toIdx(e,F){return F*this.size+e}}function om(t,e,F,K){let J=0,ee=Number.MAX_VALUE;for(let ie=0;ie<3;ie++)if(Math.abs(K[ie])<1e-15){if(F[ie]<t[ie]||F[ie]>e[ie])return null}else{const oe=1/K[ie];let le=(t[ie]-F[ie])*oe,ce=(e[ie]-F[ie])*oe;if(le>ce){const pe=le;le=ce,ce=pe}if(le>J&&(J=le),ce<ee&&(ee=ce),J>ee)return null}return J}function am(t,e,F,K,J,ee,ie,oe,le,ce,pe){const me=K-t,_e=J-e,xe=ee-F,we=ie-t,Ae=oe-e,Re=le-F,ze=pe[1]*Re-pe[2]*Ae,Ze=pe[2]*we-pe[0]*Re,Ue=pe[0]*Ae-pe[1]*we,He=me*ze+_e*Ze+xe*Ue;if(Math.abs(He)<1e-15)return null;const Ye=1/He,Xe=ce[0]-t,dt=ce[1]-e,ut=ce[2]-F,Tt=(Xe*ze+dt*Ze+ut*Ue)*Ye;if(Tt<0||Tt>1)return null;const Nt=dt*xe-ut*_e,_t=ut*me-Xe*xe,Ct=Xe*_e-dt*me,Pt=(pe[0]*Nt+pe[1]*_t+pe[2]*Ct)*Ye;return Pt<0||Tt+Pt>1?null:(we*Nt+Ae*_t+Re*Ct)*Ye}function sm(t,e,F){return(t-e)/(F-e)}function lm(t,e,F,K,J,ee,ie,oe,le){const ce=1<<F,pe=ee-K,me=ie-J,_e=(t+1)/ce*pe+K,xe=(e+0)/ce*me+J,we=(e+1)/ce*me+J;oe[0]=(t+0)/ce*pe+K,oe[1]=xe,le[0]=_e,le[1]=we}class cm{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const F=function(ee){const ie=Math.ceil(Math.log2(ee.dim/8)),oe=[];let le=Math.ceil(Math.pow(2,ie));const ce=1/le,pe=(xe,we,Ae,Re,ze)=>{const Ze=Re?1:0,Ue=(xe+1)*Ae-Ze,He=we*Ae,Ye=(we+1)*Ae-Ze;ze[0]=xe*Ae,ze[1]=He,ze[2]=Ue,ze[3]=Ye};let me=new nm(le);const _e=[];for(let xe=0;xe<le*le;xe++){pe(xe%le,Math.floor(xe/le),ce,!1,_e);const we=Ia(_e[0],_e[1],ee),Ae=Ia(_e[2],_e[1],ee),Re=Ia(_e[2],_e[3],ee),ze=Ia(_e[0],_e[3],ee);me.minimums.push(Math.min(we,Ae,Re,ze)),me.maximums.push(Math.max(we,Ae,Re,ze)),me.leaves.push(1)}for(oe.push(me),le/=2;le>=1;le/=2){const xe=oe[oe.length-1];me=new nm(le);for(let we=0;we<le*le;we++){pe(we%le,Math.floor(we/le),2,!0,_e);const Ae=xe.getElevation(_e[0],_e[1]),Re=xe.getElevation(_e[2],_e[1]),ze=xe.getElevation(_e[2],_e[3]),Ze=xe.getElevation(_e[0],_e[3]),Ue=xe.isLeaf(_e[0],_e[1]),He=xe.isLeaf(_e[2],_e[1]),Ye=xe.isLeaf(_e[2],_e[3]),Xe=xe.isLeaf(_e[0],_e[3]),dt=Math.min(Ae.min,Re.min,ze.min,Ze.min),ut=Math.max(Ae.max,Re.max,ze.max,Ze.max),Tt=Ue&&He&&Ye&&Xe;me.maximums.push(ut),me.minimums.push(dt),me.leaves.push(ut-dt<=5&&Tt?1:0)}oe.push(me)}return oe}(this.dem),K=F.length-1,J=F[K];this._addNode(J.minimums[0],J.maximums[0],J.leaves[0]),this._construct(F,0,0,K,0)}raycastRoot(e,F,K,J,ee,ie,oe=1){return om([e,F,-100],[K,J,this.maximums[0]*oe],ee,ie)}raycast(e,F,K,J,ee,ie,oe=1){if(!this.nodeCount)return null;const le=this.raycastRoot(e,F,K,J,ee,ie,oe);if(le==null)return null;const ce=[],pe=[],me=[],_e=[],xe=[{idx:0,t:le,nodex:0,nodey:0,depth:0}];for(;xe.length>0;){const{idx:we,t:Ae,nodex:Re,nodey:ze,depth:Ze}=xe.pop();if(this.leaves[we]){lm(Re,ze,Ze,e,F,K,J,me,_e);const He=1<<Ze,Ye=(Re+0)/He,Xe=(Re+1)/He,dt=(ze+0)/He,ut=(ze+1)/He,Tt=Ia(Ye,dt,this.dem)*oe,Nt=Ia(Xe,dt,this.dem)*oe,_t=Ia(Xe,ut,this.dem)*oe,Ct=Ia(Ye,ut,this.dem)*oe,Pt=am(me[0],me[1],Tt,_e[0],me[1],Nt,_e[0],_e[1],_t,ee,ie),Lt=am(_e[0],_e[1],_t,me[0],_e[1],Ct,me[0],me[1],Tt,ee,ie),Gt=Math.min(Pt!==null?Pt:Number.MAX_VALUE,Lt!==null?Lt:Number.MAX_VALUE);if(Gt!==Number.MAX_VALUE)return Gt;{const bt=_c([],ee,ie,Ae);if(um(Tt,Nt,Ct,_t,sm(bt[0],me[0],_e[0]),sm(bt[1],me[1],_e[1]))>=bt[2])return Ae}continue}let Ue=0;for(let He=0;He<this._siblingOffset.length;He++){lm((Re<<1)+this._siblingOffset[He][0],(ze<<1)+this._siblingOffset[He][1],Ze+1,e,F,K,J,me,_e),me[2]=-100,_e[2]=this.maximums[this.childOffsets[we]+He]*oe;const Ye=om(me,_e,ee,ie);if(Ye!=null){const Xe=Ye;ce[He]=Xe;let dt=!1;for(let ut=0;ut<Ue&&!dt;ut++)Xe>=ce[pe[ut]]&&(pe.splice(ut,0,He),dt=!0);dt||(pe[Ue]=He),Ue++}}for(let He=0;He<Ue;He++){const Ye=pe[He];xe.push({idx:this.childOffsets[we]+Ye,t:ce[Ye],nodex:(Re<<1)+this._siblingOffset[Ye][0],nodey:(ze<<1)+this._siblingOffset[Ye][1],depth:Ze+1})}}return null}_addNode(e,F,K){return this.minimums.push(e),this.maximums.push(F),this.leaves.push(K),this.childOffsets.push(0),this.nodeCount++}_construct(e,F,K,J,ee){if(e[J].isLeaf(F,K)===1)return;this.childOffsets[ee]||(this.childOffsets[ee]=this.nodeCount);const ie=J-1,oe=e[ie];let le=0,ce=0;for(let pe=0;pe<this._siblingOffset.length;pe++){const me=2*F+this._siblingOffset[pe][0],_e=2*K+this._siblingOffset[pe][1],xe=oe.getElevation(me,_e),we=oe.isLeaf(me,_e),Ae=this._addNode(xe.min,xe.max,we);we&&(le|=1<<pe),ce||(ce=Ae)}for(let pe=0;pe<this._siblingOffset.length;pe++)le&1<<pe||this._construct(e,2*F+this._siblingOffset[pe][0],2*K+this._siblingOffset[pe][1],ie,ce+pe)}}function um(t,e,F,K,J,ee){return zr(zr(t,F,ee),zr(e,K,ee),J)}function Ia(t,e,F){const K=F.dim,J=ht(t*K-.5,0,K-1),ee=ht(e*K-.5,0,K-1),ie=Math.floor(J),oe=Math.floor(ee),le=Math.min(ie+1,K-1),ce=Math.min(oe+1,K-1);return um(F.get(ie,oe),F.get(le,oe),F.get(ie,ce),F.get(le,ce),J-ie,ee-oe)}const hm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Q_(t,e,F){return(256*t*256+256*e+F)/10-1e4}function eg(t,e,F){return 256*t+e+F/256-32768}class yh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,F,K,J=!1,ee=!1){if(this.uid=e,F.height!==F.width)throw new RangeError("DEM tiles must be square");if(K&&K!=="mapbox"&&K!=="terrarium")return di(`"${K}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=F.height;const ie=this.dim=F.height-2,oe=new Uint32Array(F.data.buffer);if(this.pixels=new Uint8Array(F.data.buffer),this.encoding=K||"mapbox",this.borderReady=J,!J){for(let le=0;le<ie;le++)oe[this._idx(-1,le)]=oe[this._idx(0,le)],oe[this._idx(ie,le)]=oe[this._idx(ie-1,le)],oe[this._idx(le,-1)]=oe[this._idx(le,0)],oe[this._idx(le,ie)]=oe[this._idx(le,ie-1)];oe[this._idx(-1,-1)]=oe[this._idx(0,0)],oe[this._idx(ie,-1)]=oe[this._idx(ie-1,0)],oe[this._idx(-1,ie)]=oe[this._idx(0,ie-1)],oe[this._idx(ie,ie)]=oe[this._idx(ie-1,ie-1)],ee&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new cm(this)}get(e,F,K=!1){K&&(e=ht(e,-1,this.dim),F=ht(F,-1,this.dim));const J=4*this._idx(e,F);return(this.encoding==="terrarium"?eg:Q_)(this.pixels[J],this.pixels[J+1],this.pixels[J+2])}static getUnpackVector(e){return hm[e]}get unpackVector(){return hm[this.encoding]}_idx(e,F){if(e<-1||e>=this.dim+1||F<-1||F>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(F+1)*this.stride+(e+1)}static pack(e,F){const K=[0,0,0,0],J=yh.getUnpackVector(F);let ee=Math.floor((e+J[3])/J[2]);return K[2]=ee%256,ee=Math.floor(ee/256),K[1]=ee%256,ee=Math.floor(ee/256),K[0]=ee,K}getPixels(){return new Cn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,F,K){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let J=F*this.dim,ee=F*this.dim+this.dim,ie=K*this.dim,oe=K*this.dim+this.dim;switch(F){case-1:J=ee-1;break;case 1:ee=J+1}switch(K){case-1:ie=oe-1;break;case 1:oe=ie+1}const le=-F*this.dim,ce=-K*this.dim;for(let pe=ie;pe<oe;pe++)for(let me=J;me<ee;me++){const _e=4*this._idx(me,pe),xe=4*this._idx(me+le,pe+ce);this.pixels[_e+0]=e.pixels[xe+0],this.pixels[_e+1]=e.pixels[xe+1],this.pixels[_e+2]=e.pixels[xe+2],this.pixels[_e+3]=e.pixels[xe+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}tr(yh,"DEMData"),tr(cm,"DemMinMaxQuadTree",{omit:["dem"]});class tg{constructor(e,F){this.max=e,this.onRemove=F,this.reset()}reset(){for(const e in this.data)for(const F of this.data[e])F.timeout&&clearTimeout(F.timeout),this.onRemove(F.value);return this.data={},this.order=[],this}add(e,F,K){const J=e.wrapped().key;this.data[J]===void 0&&(this.data[J]=[]);const ee={value:F,timeout:void 0};if(K!==void 0&&(ee.timeout=setTimeout(()=>{this.remove(e,ee)},K)),this.data[J].push(ee),this.order.push(J),this.order.length>this.max){const ie=this._getAndRemoveByKey(this.order[0]);ie&&this.onRemove(ie)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const F=this.data[e].shift();return F.timeout&&clearTimeout(F.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),F.value}getByKey(e){const F=this.data[e];return F?F[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,F){if(!this.has(e))return this;const K=e.wrapped().key,J=F===void 0?0:this.data[K].indexOf(F),ee=this.data[K][J];return this.data[K].splice(J,1),ee.timeout&&clearTimeout(ee.timeout),this.data[K].length===0&&delete this.data[K],this.onRemove(ee.value),this.order.splice(this.order.indexOf(K),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const F=this._getAndRemoveByKey(this.order[0]);F&&this.onRemove(F)}return this}filter(e){const F=[];for(const K in this.data)for(const J of this.data[K])e(J.value)||F.push(J);for(const K of F)this.remove(K.value.tileID,K)}}class dl{constructor(e,F,K){this.func=e,this.mask=F,this.range=K}}dl.ReadOnly=!1,dl.ReadWrite=!0,dl.disabled=new dl(519,dl.ReadOnly,[0,1]);const Nf=7680;class Ff{constructor(e,F,K,J,ee,ie){this.test=e,this.ref=F,this.mask=K,this.fail=J,this.depthFail=ee,this.pass=ie}}Ff.disabled=new Ff({func:519,mask:0},0,0,Nf,Nf,Nf);class Co{constructor(e,F,K){this.blendFunction=e,this.blendColor=F,this.mask=K}}Co.Replace=[1,0],Co.disabled=new Co(Co.Replace,Si.transparent,[!1,!1,!1,!1]),Co.unblended=new Co(Co.Replace,Si.transparent,[!0,!0,!0,!0]),Co.alphaBlended=new Co([1,771],Si.transparent,[!0,!0,!0,!0]);const zf=1029,Uf=2305;class vo{constructor(e,F,K){this.enable=e,this.mode=F,this.frontFace=K}}vo.disabled=new vo(!1,zf,Uf),vo.backCCW=new vo(!0,zf,Uf),vo.backCW=new vo(!0,zf,2304),vo.frontCW=new vo(!0,1028,2304),vo.frontCCW=new vo(!0,1028,Uf);class ds extends Ca{constructor(e,F,K){super(),this.id=e,this._onlySymbols=K,F.on("data",J=>{J.dataType==="source"&&J.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&J.dataType==="source"&&J.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),F.on("error",()=>{this._sourceErrored=!0}),this._source=F,this._tiles={},this._cache=new tg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=F.minTileCacheSize,this._maxTileCacheSize=F.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new J_,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const F=this._tiles[e];if(F.state!=="loaded"&&F.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,F){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,F)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const F in this._tiles){const K=this._tiles[F];K.upload(e),K.prepare(this.map.style.imageManager)}}getIds(){return ar(this._tiles).map(e=>e.tileID).sort(fm).map(e=>e.key)}getRenderableIds(e){const F=[];for(const K in this._tiles)this._isIdRenderable(+K,e)&&F.push(this._tiles[K]);return e?F.sort((K,J)=>{const ee=K.tileID,ie=J.tileID,oe=new zt(ee.canonical.x,ee.canonical.y)._rotate(this.transform.angle),le=new zt(ie.canonical.x,ie.canonical.y)._rotate(this.transform.angle);return ee.overscaledZ-ie.overscaledZ||le.y-oe.y||le.x-oe.x}).map(K=>K.tileID.key):F.map(K=>K.tileID).sort(fm).map(K=>K.key)}hasRenderableParent(e){const F=this.findLoadedParent(e,0);return!!F&&this._isIdRenderable(F.tileID.key)}_isIdRenderable(e,F){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(F||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,F){const K=this._tiles[e];K&&(K.state!=="loading"&&(K.state=F),this._loadTile(K,this._tileLoaded.bind(this,K,e,F)))}_tileLoaded(e,F,K,J){if(J)if(e.state="errored",J.status!==404)this._source.fire(new to(J,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const ee=this.map.painter.terrain;this.update(this.transform,ee.getScaledDemTileSize(),!0),ee.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=eo.now(),K==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(F,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Mo("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const F=this.getRenderableIds();for(let J=0;J<F.length;J++){const ee=F[J];if(e.neighboringTiles&&e.neighboringTiles[ee]){const ie=this.getTileByID(ee);K(e,ie),K(ie,e)}}function K(J,ee){if(!J.dem||J.dem.borderReady)return;J.needsHillshadePrepare=!0,J.needsDEMTextureUpload=!0;let ie=ee.tileID.canonical.x-J.tileID.canonical.x;const oe=ee.tileID.canonical.y-J.tileID.canonical.y,le=Math.pow(2,J.tileID.canonical.z),ce=ee.tileID.key;ie===0&&oe===0||Math.abs(oe)>1||(Math.abs(ie)>1&&(Math.abs(ie+le)===1?ie+=le:Math.abs(ie-le)===1&&(ie-=le)),ee.dem&&J.dem&&(J.dem.backfillBorder(ee.dem,ie,oe),J.neighboringTiles&&J.neighboringTiles[ce]&&(J.neighboringTiles[ce].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,F,K,J){for(const ee in this._tiles){let ie=this._tiles[ee];if(J[ee]||!ie.hasData()||ie.tileID.overscaledZ<=F||ie.tileID.overscaledZ>K)continue;let oe=ie.tileID;for(;ie&&ie.tileID.overscaledZ>F+1;){const ce=ie.tileID.scaledTo(ie.tileID.overscaledZ-1);ie=this._tiles[ce.key],ie&&ie.hasData()&&(oe=ce)}let le=oe;for(;le.overscaledZ>F;)if(le=le.scaledTo(le.overscaledZ-1),e[le.key]){J[oe.key]=oe;break}}}findLoadedParent(e,F){if(e.key in this._loadedParentTiles){const K=this._loadedParentTiles[e.key];return K&&K.tileID.overscaledZ>=F?K:null}for(let K=e.overscaledZ-1;K>=F;K--){const J=e.scaledTo(K),ee=this._getLoadedTile(J);if(ee)return ee}}_getLoadedTile(e){const F=this._tiles[e.key];return F&&F.hasData()?F:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,F){F=F||this._source.tileSize;const K=Math.ceil(e.width/F)+1,J=Math.ceil(e.height/F)+1,ee=Math.floor(K*J*5),ie=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,ee):ee,oe=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,ie):ie;this._cache.setMaxSize(oe)}handleWrapJump(e){const F=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,F){const K={};for(const J in this._tiles){const ee=this._tiles[J];ee.tileID=ee.tileID.unwrapTo(ee.tileID.wrap+F),K[ee.tileID.key]=ee}this._tiles=K;for(const J in this._timers)clearTimeout(this._timers[J]),delete this._timers[J];for(const J in this._tiles)this._setTileReloadTimer(+J,this._tiles[J])}}update(e,F,K){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!K)return;let J;this.updateCacheSize(e,F),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?J=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(oe=>new yn(oe.canonical.z,oe.wrap,oe.canonical.z,oe.canonical.x,oe.canonical.y)):(J=e.coveringTiles({tileSize:F||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!K,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(J=J.filter(oe=>this._source.hasTile(oe)))):J=[];const ee=this._updateRetainedTiles(J);if(pm(this._source.type)&&J.length!==0){const oe={},le={},ce=Object.keys(ee);for(const me of ce){const _e=ee[me],xe=this._tiles[me];if(!xe||xe.fadeEndTime&&xe.fadeEndTime<=eo.now())continue;const we=this.findLoadedParent(_e,Math.max(_e.overscaledZ-ds.maxOverzooming,this._source.minzoom));we&&(this._addTile(we.tileID),oe[we.tileID.key]=we.tileID),le[me]=_e}const pe=J[J.length-1].overscaledZ;for(const me in this._tiles){const _e=this._tiles[me];if(ee[me]||!_e.hasData())continue;let xe=_e.tileID;for(;xe.overscaledZ>pe;){xe=xe.scaledTo(xe.overscaledZ-1);const we=this._tiles[xe.key];if(we&&we.hasData()&&le[xe.key]){ee[me]=_e.tileID;break}}}for(const me in oe)ee[me]||(this._coveredTiles[me]=!0,ee[me]=oe[me])}for(const oe in ee)this._tiles[oe].clearFadeHold();const ie=function(oe,le){const ce=[];for(const pe in oe)pe in le||ce.push(pe);return ce}(this._tiles,ee);for(const oe of ie){const le=this._tiles[oe];le.hasSymbolBuckets&&!le.holdingForFade()?le.setHoldDuration(this.map._fadeDuration):le.hasSymbolBuckets&&!le.symbolFadeFinished()||this._removeTile(+oe)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const F={};if(e.length===0)return F;const K={},J=e.reduce((ce,pe)=>Math.min(ce,pe.overscaledZ),1/0),ee=e[0].overscaledZ,ie=Math.max(ee-ds.maxOverzooming,this._source.minzoom),oe=Math.max(ee+ds.maxUnderzooming,this._source.minzoom),le={};for(const ce of e){const pe=this._addTile(ce);F[ce.key]=ce,pe.hasData()||J<this._source.maxzoom&&(le[ce.key]=ce)}this._retainLoadedChildren(le,J,oe,F);for(const ce of e){let pe=this._tiles[ce.key];if(pe.hasData())continue;if(ce.canonical.z>=this._source.maxzoom){const _e=ce.children(this._source.maxzoom)[0],xe=this.getTile(_e);if(xe&&xe.hasData()){F[_e.key]=_e;continue}}else{const _e=ce.children(this._source.maxzoom);if(F[_e[0].key]&&F[_e[1].key]&&F[_e[2].key]&&F[_e[3].key])continue}let me=pe.wasRequested();for(let _e=ce.overscaledZ-1;_e>=ie;--_e){const xe=ce.scaledTo(_e);if(K[xe.key]||(K[xe.key]=!0,pe=this.getTile(xe),!pe&&me&&(pe=this._addTile(xe)),pe&&(F[xe.key]=xe,me=pe.wasRequested(),pe.hasData())))break}}return F}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const F=[];let K,J=this._tiles[e].tileID;for(;J.overscaledZ>0;){if(J.key in this._loadedParentTiles){K=this._loadedParentTiles[J.key];break}F.push(J.key);const ee=J.scaledTo(J.overscaledZ-1);if(K=this._getLoadedTile(ee),K)break;J=ee}for(const ee of F)this._loadedParentTiles[ee]=K}}_addTile(e){let F=this._tiles[e.key];if(F)return F;F=this._cache.getAndRemove(e),F&&(this._setTileReloadTimer(e.key,F),F.tileID=e,this._state.initializeTileState(F,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,F)));const K=!!F;if(!K){const J=this.map?this.map.painter:null;F=new kf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,J,this._isRaster),this._loadTile(F,this._tileLoaded.bind(this,F,e.key,F.state))}return F?(F.uses++,this._tiles[e.key]=F,K||this._source.fire(new Mo("dataloading",{tile:F,coord:F.tileID,dataType:"source"})),F):null}_setTileReloadTimer(e,F){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const K=F.getExpiryTimeout();K&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},K))}_removeTile(e){const F=this._tiles[e];F&&(F.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),F.uses>0||(F.hasData()&&F.state!=="reloading"?this._cache.add(F.tileID,F,F.getExpiryTimeout()):(F.aborted=!0,this._abortTile(F),this._unloadTile(F))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,F,K){const J=[],ee=this.transform;if(!ee)return J;const ie=ee.projection.name==="globe",oe=So(ee.center.lng);for(const le in this._tiles){const ce=this._tiles[le];if(K&&ce.clearQueryDebugViz(),ce.holdingForFade())continue;let pe;if(ie){const me=ce.tileID.canonical;if(me.z===0){const _e=[Math.abs(ht(oe,...jc(me,-1))-oe),Math.abs(ht(oe,...jc(me,1))-oe)];pe=[0,2*_e.indexOf(Math.min(..._e))-1]}else{const _e=[Math.abs(ht(oe,...jc(me,-1))-oe),Math.abs(ht(oe,...jc(me,0))-oe),Math.abs(ht(oe,...jc(me,1))-oe)];pe=[_e.indexOf(Math.min(..._e))-1]}}else pe=[0];for(const me of pe){const _e=e.containsTile(ce,ee,F,me);_e&&J.push(_e)}}return J}getVisibleCoordinates(e){const F=this.getRenderableIds(e).map(K=>this._tiles[K].tileID);for(const K of F)K.projMatrix=this.transform.calculateProjMatrix(K.toUnwrapped());return F}hasTransition(){if(this._source.hasTransition())return!0;if(pm(this._source.type))for(const e in this._tiles){const F=this._tiles[e];if(F.fadeEndTime!==void 0&&F.fadeEndTime>=eo.now())return!0}return!1}setFeatureState(e,F,K){this._state.updateState(e=e||"_geojsonTileLayer",F,K)}removeFeatureState(e,F,K){this._state.removeFeatureState(e=e||"_geojsonTileLayer",F,K)}getFeatureState(e,F){return this._state.getState(e=e||"_geojsonTileLayer",F)}setDependencies(e,F,K){const J=this._tiles[e];J&&J.setDependencies(F,K)}reloadTilesForDependencies(e,F){for(const K in this._tiles)this._tiles[K].hasDependency(e,F)&&this._reloadTile(+K,"reloading");this._cache.filter(K=>!K.hasDependency(e,F))}_preloadTiles(e,F){if(!this._sourceLoaded){const oe=()=>{this._sourceLoaded&&(this._source.off("data",oe),this._preloadTiles(e,F))};return void this._source.on("data",oe)}const K=new Map,J=Array.isArray(e)?e:[e],ee=this.map.painter.terrain,ie=this.usedForTerrain&&ee?ee.getScaledDemTileSize():this._source.tileSize;for(const oe of J){const le=oe.coveringTiles({tileSize:ie,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const ce of le)K.set(ce.key,ce);this.usedForTerrain&&oe.updateElevation(!1)}Ht(Array.from(K.values()),(oe,le)=>{const ce=new kf(oe,this._source.tileSize*oe.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(ce,pe=>{this._source.type==="raster-dem"&&ce.dem&&this._backfillDEM(ce),le(pe,ce)})},F)}}function fm(t,e){const F=Math.abs(2*t.wrap)-+(t.wrap<0),K=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||K-F||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function pm(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function jc(t,e){const F=1<<t.z;return[t.x/F+e,(t.x+1)/F+e]}ds.maxOverzooming=10,ds.maxUnderzooming=3;class _h{constructor(e,F,K){this._demTile=e,this._dem=this._demTile.dem,this._scale=F,this._offset=K}static create(e,F,K){const J=K||e.findDEMTileFor(F);if(!J||!J.dem)return;const ee=J.dem,ie=J.tileID,oe=1<<F.canonical.z-ie.canonical.z;return new _h(J,J.tileSize/ur/oe,[(F.canonical.x/oe-ie.canonical.x)*ee.dim,(F.canonical.y/oe-ie.canonical.y)*ee.dim])}tileCoordToPixel(e,F){const K=F*this._scale+this._offset[1],J=Math.floor(e*this._scale+this._offset[0]),ee=Math.floor(K);return new zt(J,ee)}getElevationAt(e,F,K,J){const ee=e*this._scale+this._offset[0],ie=F*this._scale+this._offset[1],oe=Math.floor(ee),le=Math.floor(ie),ce=this._dem;return J=!!J,K?zr(zr(ce.get(oe,le,J),ce.get(oe,le+1,J),ie-le),zr(ce.get(oe+1,le,J),ce.get(oe+1,le+1,J),ie-le),ee-oe):ce.get(oe,le,J)}getElevationAtPixel(e,F,K){return this._dem.get(e,F,!!K)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*yo(1,e)*this._dem.stride}}class dm{constructor(e,F){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new zo(ur,16,0),this.featureIndexArray=new ts,this.promoteId=F}insert(e,F,K,J,ee,ie=0){const oe=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(K,J,ee,ie);const le=this.grid;for(let ce=0;ce<F.length;ce++){const pe=F[ce],me=[1/0,1/0,-1/0,-1/0];for(let _e=0;_e<pe.length;_e++){const xe=pe[_e];me[0]=Math.min(me[0],xe.x),me[1]=Math.min(me[1],xe.y),me[2]=Math.max(me[2],xe.x),me[3]=Math.max(me[3],xe.y)}me[0]<ur&&me[1]<ur&&me[2]>=0&&me[3]>=0&&le.insert(oe,me[0],me[1],me[2],me[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new xf(new ih(this.rawTileData)).layers,this.sourceLayerCoder=new Qd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,F,K,J){this.loadVTLayers();const ee=e.params||{},ie=Vs(ee.filter),oe=e.tileResult,le=e.transform,ce=oe.bufferedTilespaceBounds,pe=this.grid.query(ce.min.x,ce.min.y,ce.max.x,ce.max.y,(we,Ae,Re,ze)=>Np(oe.bufferedTilespaceGeometry,we,Ae,Re,ze));pe.sort(rg);let me=null;le.elevation&&pe.length>0&&(me=_h.create(le.elevation,this.tileID));const _e={};let xe;for(let we=0;we<pe.length;we++){const Ae=pe[we];if(Ae===xe)continue;xe=Ae;const Re=this.featureIndexArray.get(Ae);let ze=null;this.loadMatchingFeature(_e,Re,ie,ee.layers,ee.availableImages,F,K,J,(Ze,Ue,He,Ye=0)=>(ze||(ze=Ho(Ze,this.tileID.canonical,e.tileTransform)),Ue.queryIntersectsFeature(oe,Ze,He,ze,this.z,e.transform,e.pixelPosMatrix,me,Ye)))}return _e}loadMatchingFeature(e,F,K,J,ee,ie,oe,le,ce){const{featureIndex:pe,bucketIndex:me,sourceLayerIndex:_e,layoutVertexArrayOffset:xe}=F,we=this.bucketLayerIDs[me];if(J&&!function(Ze,Ue){for(let He=0;He<Ze.length;He++)if(Ue.indexOf(Ze[He])>=0)return!0;return!1}(J,we))return;const Ae=this.sourceLayerCoder.decode(_e),Re=this.vtLayers[Ae].feature(pe);if(K.needGeometry){const Ze=us(Re,!0);if(!K.filter(new de(this.tileID.overscaledZ),Ze,this.tileID.canonical))return}else if(!K.filter(new de(this.tileID.overscaledZ),Re))return;const ze=this.getId(Re,Ae);for(let Ze=0;Ze<we.length;Ze++){const Ue=we[Ze];if(J&&J.indexOf(Ue)<0)continue;const He=ie[Ue];if(!He)continue;let Ye={};ze!==void 0&&le&&(Ye=le.getState(He.sourceLayer||"_geojsonTileLayer",ze));const Xe=mr({},oe[Ue]);Xe.paint=mm(Xe.paint,He.paint,Re,Ye,ee),Xe.layout=mm(Xe.layout,He.layout,Re,Ye,ee);const dt=!ce||ce(Re,He,Ye,xe);if(!dt)continue;const ut=new em(Re,this.z,this.x,this.y,ze);ut.layer=Xe;let Tt=e[Ue];Tt===void 0&&(Tt=e[Ue]=[]),Tt.push({featureIndex:pe,feature:ut,intersectionZ:dt})}}lookupSymbolFeatures(e,F,K,J,ee,ie,oe,le){const ce={};this.loadVTLayers();const pe=Vs(ee);for(const me of e)this.loadMatchingFeature(ce,{bucketIndex:K,sourceLayerIndex:J,featureIndex:me,layoutVertexArrayOffset:0},pe,ie,oe,le,F);return ce}loadFeature(e){const{featureIndex:F,sourceLayerIndex:K}=e;this.loadVTLayers();const J=this.sourceLayerCoder.decode(K),ee=this.vtFeatures[J];if(ee[F])return ee[F];const ie=this.vtLayers[J].feature(F);return ee[F]=ie,ie}hasLayer(e){for(const F of this.bucketLayerIDs)for(const K of F)if(e===K)return!0;return!1}getId(e,F){let K=e.id;if(this.promoteId){const J=typeof this.promoteId=="string"?this.promoteId:this.promoteId[F];J!=null&&(K=e.properties[J]),typeof K=="boolean"&&(K=Number(K))}return K}}function mm(t,e,F,K,J){return Rr(t,(ee,ie)=>{const oe=e instanceof Ne?e.get(ie):null;return oe&&oe.evaluate?oe.evaluate(F,K,J):oe})}function rg(t,e){return e-t}tr(dm,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class ym{constructor(e,F){this.width=e,this.height=F,this.nextRow=0,this.image=new Ko({width:e,height:F}),this.positions={},this.uploaded=!1}getDash(e,F){const K=this.getKey(e,F);return this.positions[K]}trim(){const e=this.width,F=this.height=Xr(this.nextRow);this.image.resize({width:e,height:F})}getKey(e,F){return e.join(",")+F}getDashRanges(e,F,K){const J=[];let ee=e.length%2==1?-e[e.length-1]*K:0,ie=e[0]*K,oe=!0;J.push({left:ee,right:ie,isDash:oe,zeroLength:e[0]===0});let le=e[0];for(let ce=1;ce<e.length;ce++){oe=!oe;const pe=e[ce];ee=le*K,le+=pe,ie=le*K,J.push({left:ee,right:ie,isDash:oe,zeroLength:pe===0})}return J}addRoundDash(e,F,K){const J=F/2;for(let ee=-K;ee<=K;ee++){const ie=this.width*(this.nextRow+K+ee);let oe=0,le=e[oe];for(let ce=0;ce<this.width;ce++){ce/le.right>1&&(le=e[++oe]);const pe=Math.abs(ce-le.left),me=Math.abs(ce-le.right),_e=Math.min(pe,me);let xe;const we=ee/K*(J+1);if(le.isDash){const Ae=J-Math.abs(we);xe=Math.sqrt(_e*_e+Ae*Ae)}else xe=J-Math.sqrt(_e*_e+we*we);this.image.data[ie+ce]=Math.max(0,Math.min(255,xe+128))}}}addRegularDash(e,F){for(let le=e.length-1;le>=0;--le){const ce=e[le],pe=e[le+1];ce.zeroLength?e.splice(le,1):pe&&pe.isDash===ce.isDash&&(pe.left=ce.left,e.splice(le,1))}const K=e[0],J=e[e.length-1];K.isDash===J.isDash&&(K.left=J.left-this.width,J.right=K.right+this.width);const ee=this.width*this.nextRow;let ie=0,oe=e[ie];for(let le=0;le<this.width;le++){le/oe.right>1&&(oe=e[++ie]);const ce=Math.abs(le-oe.left),pe=Math.abs(le-oe.right),me=Math.min(ce,pe);this.image.data[ee+le]=Math.max(0,Math.min(255,(oe.isDash?me:-me)+F+128))}}addDash(e,F){const K=this.getKey(e,F);if(this.positions[K])return this.positions[K];const J=F==="round",ee=J?7:0,ie=2*ee+1;if(this.nextRow+ie>this.height)return di("LineAtlas out of space"),null;e.length===0&&e.push(1);let oe=0;for(let pe=0;pe<e.length;pe++)e[pe]<0&&(di("Negative value is found in line dasharray, replacing values with 0"),e[pe]=0),oe+=e[pe];if(oe!==0){const pe=this.width/oe,me=this.getDashRanges(e,this.width,pe);J?this.addRoundDash(me,pe,ee):this.addRegularDash(me,F==="square"?.5*pe:0)}const le=this.nextRow+ee;this.nextRow+=ie;const ce={tl:[le,ee],br:[oe,0]};return this.positions[K]=ce,ce}}tr(ym,"LineAtlas");const _m=1*go;class gm{constructor(e){const F={},K=[];for(const oe in e){const le=e[oe],ce=F[oe]={};for(const pe in le.glyphs){const me=le.glyphs[+pe];if(!me||me.bitmap.width===0||me.bitmap.height===0)continue;const _e=me.metrics.localGlyph?_m:1,xe={x:0,y:0,w:me.bitmap.width+2*_e,h:me.bitmap.height+2*_e};K.push(xe),ce[pe]=xe}}const{w:J,h:ee}=Tf(K),ie=new Ko({width:J||1,height:ee||1});for(const oe in e){const le=e[oe];for(const ce in le.glyphs){const pe=le.glyphs[+ce];if(!pe||pe.bitmap.width===0||pe.bitmap.height===0)continue;const me=F[oe][ce],_e=pe.metrics.localGlyph?_m:1;Ko.copy(pe.bitmap,ie,{x:0,y:0},{x:me.x+_e,y:me.y+_e},pe.bitmap)}}this.image=ie,this.positions=F}}tr(gm,"GlyphAtlas");class ig{constructor(e){this.tileID=new yn(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=ps(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,F,K,J,ee){this.status="parsing",this.data=e,this.collisionBoxArray=new ri;const ie=new Qd(Object.keys(e.layers).sort()),oe=new dm(this.tileID,this.promoteId);oe.bucketLayerIDs=[];const le={},ce=new ym(256,256),pe={featureIndex:oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:ce,availableImages:K},me=F.familiesBySource[this.source];for(const Ye in me){const Xe=e.layers[Ye];if(!Xe)continue;let dt=!1,ut=!1;for(const _t of me[Ye])_t[0].type==="symbol"?dt=!0:ut=!0;if(this.isSymbolTile===!0&&!dt||this.isSymbolTile===!1&&!ut)continue;Xe.version===1&&di(`Vector tile source "${this.source}" layer "${Ye}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Tt=ie.encode(Ye),Nt=[];for(let _t=0;_t<Xe.length;_t++){const Ct=Xe.feature(_t),Pt=oe.getId(Ct,Ye);Nt.push({feature:Ct,id:Pt,index:_t,sourceLayerIndex:Tt})}for(const _t of me[Ye]){const Ct=_t[0];this.isSymbolTile!==void 0&&Ct.type==="symbol"!==this.isSymbolTile||Ct.minzoom&&this.zoom<Math.floor(Ct.minzoom)||Ct.maxzoom&&this.zoom>=Ct.maxzoom||Ct.visibility!=="none"&&(jf(_t,this.zoom,K),(le[Ct.id]=Ct.createBucket({index:oe.bucketLayerIDs.length,layers:_t,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Tt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:K})).populate(Nt,pe,this.tileID.canonical,this.tileTransform),oe.bucketLayerIDs.push(_t.map(Pt=>Pt.id)))}}let _e,xe,we,Ae;ce.trim();const Re={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ze=()=>{if(_e)return ee(_e);if(xe&&we&&Ae){const Ye=new gm(xe),Xe=new Td(we,Ae);for(const dt in le){const ut=le[dt];ut instanceof Ea?(jf(ut.layers,this.zoom,K),O_(ut,xe,Ye.positions,we,Xe.iconPositions,this.showCollisionBoxes,K,this.tileID.canonical,this.tileZoom,this.projection)):ut.hasPattern&&(ut instanceof eh||ut instanceof Zu||ut instanceof Cc)&&(jf(ut.layers,this.zoom,K),ut.addFeatures(pe,this.tileID.canonical,Xe.patternPositions,K,this.tileTransform))}this.status="done",ee(null,{buckets:ar(le).filter(dt=>!dt.isEmpty()),featureIndex:oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ye.image,lineAtlas:ce,imageAtlas:Xe,glyphMap:this.returnDependencies?xe:null,iconMap:this.returnDependencies?we:null,glyphPositions:this.returnDependencies?Ye.positions:null})}},Ze=Rr(pe.glyphDependencies,Ye=>Object.keys(Ye).map(Number));Object.keys(Ze).length?J.send("getGlyphs",{uid:this.uid,stacks:Ze},(Ye,Xe)=>{_e||(_e=Ye,xe=Xe,ze())},void 0,!1,Re):xe={};const Ue=Object.keys(pe.iconDependencies);Ue.length?J.send("getImages",{icons:Ue,source:this.source,tileID:this.tileID,type:"icons"},(Ye,Xe)=>{_e||(_e=Ye,we=Xe,ze())},void 0,!1,Re):we={};const He=Object.keys(pe.patternDependencies);He.length?J.send("getImages",{icons:He,source:this.source,tileID:this.tileID,type:"patterns"},(Ye,Xe)=>{_e||(_e=Ye,Ae=Xe,ze())},void 0,!1,Re):Ae={},ze()}}function jf(t,e,F){const K=new de(e);for(const J of t)J.recalculate(K,F)}class vm{constructor(e){this.entries={},this.scheduler=e}request(e,F,K,J){const ee=this.entries[e]=this.entries[e]||{callbacks:[]};if(ee.result){const[ie,oe]=ee.result;return this.scheduler?this.scheduler.add(()=>{J(ie,oe)},F):J(ie,oe),()=>{}}return ee.callbacks.push(J),ee.cancel||(ee.cancel=K((ie,oe)=>{ee.result=[ie,oe];for(const le of ee.callbacks)this.scheduler?this.scheduler.add(()=>{le(ie,oe)},F):le(ie,oe);setTimeout(()=>delete this.entries[e],3e3)})),()=>{ee.result||(ee.callbacks=ee.callbacks.filter(ie=>ie!==J),ee.callbacks.length||(ee.cancel(),delete this.entries[e]))}}}function $m(t,e,F){const K=JSON.stringify(t.request);return t.data&&(this.deduped.entries[K]={result:[null,t.data]}),this.deduped.request(K,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},J=>{const ee=Wr(t.request,(ie,oe,le,ce)=>{ie?J(ie):oe&&J(null,{vectorTile:F?void 0:new xf(new ih(oe)),rawData:oe,cacheControl:le,expires:ce})});return()=>{ee.cancel(),J()}},e)}const xm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Vf{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[F,K]=new Uint8Array(e,0,2);if(F!==219)throw new Error("Data does not appear to be in a KDBush format.");const J=K>>4;if(J!==1)throw new Error(`Got v${J} data when expected v1.`);const ee=xm[15&K];if(!ee)throw new Error("Unrecognized array type.");const[ie]=new Uint16Array(e,2,1),[oe]=new Uint32Array(e,4,1);return new Vf(oe,ie,ee,e)}constructor(e,F=64,K=Float64Array,J){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+F,2),65535),this.ArrayType=K,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const ee=xm.indexOf(this.ArrayType),ie=2*e*this.ArrayType.BYTES_PER_ELEMENT,oe=e*this.IndexArrayType.BYTES_PER_ELEMENT,le=(8-oe%8)%8;if(ee<0)throw new Error(`Unexpected typed array class: ${K}.`);J&&J instanceof ArrayBuffer?(this.data=J,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+oe+le,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+ie+oe+le),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+oe+le,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+ee]),new Uint16Array(this.data,2,1)[0]=F,new Uint32Array(this.data,4,1)[0]=e)}add(e,F){const K=this._pos>>1;return this.ids[K]=K,this.coords[this._pos++]=e,this.coords[this._pos++]=F,K}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Gf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,F,K,J){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:ee,coords:ie,nodeSize:oe}=this,le=[0,ee.length-1,0],ce=[];for(;le.length;){const pe=le.pop()||0,me=le.pop()||0,_e=le.pop()||0;if(me-_e<=oe){for(let Re=_e;Re<=me;Re++){const ze=ie[2*Re],Ze=ie[2*Re+1];ze>=e&&ze<=K&&Ze>=F&&Ze<=J&&ce.push(ee[Re])}continue}const xe=_e+me>>1,we=ie[2*xe],Ae=ie[2*xe+1];we>=e&&we<=K&&Ae>=F&&Ae<=J&&ce.push(ee[xe]),(pe===0?e<=we:F<=Ae)&&(le.push(_e),le.push(xe-1),le.push(1-pe)),(pe===0?K>=we:J>=Ae)&&(le.push(xe+1),le.push(me),le.push(1-pe))}return ce}within(e,F,K){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:J,coords:ee,nodeSize:ie}=this,oe=[0,J.length-1,0],le=[],ce=K*K;for(;oe.length;){const pe=oe.pop()||0,me=oe.pop()||0,_e=oe.pop()||0;if(me-_e<=ie){for(let Re=_e;Re<=me;Re++)wm(ee[2*Re],ee[2*Re+1],e,F)<=ce&&le.push(J[Re]);continue}const xe=_e+me>>1,we=ee[2*xe],Ae=ee[2*xe+1];wm(we,Ae,e,F)<=ce&&le.push(J[xe]),(pe===0?e-K<=we:F-K<=Ae)&&(oe.push(_e),oe.push(xe-1),oe.push(1-pe)),(pe===0?e+K>=we:F+K>=Ae)&&(oe.push(xe+1),oe.push(me),oe.push(1-pe))}return le}}function Gf(t,e,F,K,J,ee){if(J-K<=F)return;const ie=K+J>>1;bm(t,e,ie,K,J,ee),Gf(t,e,F,K,ie-1,1-ee),Gf(t,e,F,ie+1,J,1-ee)}function bm(t,e,F,K,J,ee){for(;J>K;){if(J-K>600){const ce=J-K+1,pe=F-K+1,me=Math.log(ce),_e=.5*Math.exp(2*me/3),xe=.5*Math.sqrt(me*_e*(ce-_e)/ce)*(pe-ce/2<0?-1:1);bm(t,e,F,Math.max(K,Math.floor(F-pe*_e/ce+xe)),Math.min(J,Math.floor(F+(ce-pe)*_e/ce+xe)),ee)}const ie=e[2*F+ee];let oe=K,le=J;for(Vc(t,e,K,F),e[2*J+ee]>ie&&Vc(t,e,K,J);oe<le;){for(Vc(t,e,oe,le),oe++,le--;e[2*oe+ee]<ie;)oe++;for(;e[2*le+ee]>ie;)le--}e[2*K+ee]===ie?Vc(t,e,K,le):(le++,Vc(t,e,le,J)),le<=F&&(K=le+1),F<=le&&(J=le-1)}}function Vc(t,e,F,K){Wf(t,F,K),Wf(e,2*F,2*K),Wf(e,2*F+1,2*K+1)}function Wf(t,e,F){const K=t[e];t[e]=t[F],t[F]=K}function wm(t,e,F,K){const J=t-F,ee=e-K;return J*J+ee*ee}H.ARRAY_TYPE=On,H.AUTH_ERR_MSG=Je,H.Aabb=mn,H.Actor=class{constructor(t,e,F){this.target=t,this.parent=e,this.mapId=F,this.callbacks={},this.cancelCallbacks={},Yi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Mn()?t:ye,this.scheduler=new X_}send(t,e,F,K,J=!1,ee){const ie=Math.round(1e18*Math.random()).toString(36).substring(0,10);F&&(F.metadata=ee,this.callbacks[ie]=F);const oe=Hi(this.globalScope)?void 0:[];return this.target.postMessage({id:ie,type:t,hasCallback:!!F,targetMapId:K,mustQueue:J,sourceMapId:this.mapId,data:ya(e,oe)},oe),{cancel:()=>{F&&delete this.callbacks[ie],this.target.postMessage({id:ie,type:"<cancel>",targetMapId:K,sourceMapId:this.mapId})}}}receive(t){const e=t.data,F=e.id;if(F&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const K=this.cancelCallbacks[F];delete this.cancelCallbacks[F],K&&K.cancel()}else if(e.mustQueue||Mn()){const K=this.callbacks[F];this.cancelCallbacks[F]=this.scheduler.add(()=>this.processTask(F,e),K&&K.metadata||{type:"message"})}else this.processTask(F,e)}processTask(t,e){if(e.type==="<response>"){const F=this.callbacks[t];delete this.callbacks[t],F&&(e.error?F(Uo(e.error)):F(null,Uo(e.data)))}else{const F=Hi(this.globalScope)?void 0:[],K=e.hasCallback?(ee,ie)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:ee?ya(ee):null,data:ya(ie,F)},F)}:ee=>{},J=Uo(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,J,K);else if(this.parent.getWorkerSource){const ee=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,ee[0],J.source)[ee[1]](J,K)}else K(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},H.CanonicalTileID=Qu,H.Color=Si,H.ColorMode=Co,H.CullFaceMode=vo,H.DEMData=yh,H.DataConstantProperty=Se,H.DedupedRequest=vm,H.DepthMode=dl,H.EXTENT=ur,H.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const F=e.getSource().maxzoom,K=1<<F,J=Math.floor(t.x),ee=Math.floor((t.x-J)*K),ie=Math.floor(t.y*K),oe=this.findDEMTileFor(new yn(F,J,F,ee,ie));return!(!oe||!oe.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,F=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const K=this._source();if(!K||t.y<0||t.y>1)return e;const J=K.getSource().maxzoom,ee=1<<J,ie=Math.floor(t.x),oe=t.x-ie,le=new yn(J,ie,J,Math.floor(oe*ee),Math.floor(t.y*ee)),ce=this.findDEMTileFor(le);if(!ce||!ce.dem)return e;const pe=ce.dem,me=1<<ce.tileID.canonical.z,_e=(oe*me-ce.tileID.canonical.x)*pe.dim,xe=(t.y*me-ce.tileID.canonical.y)*pe.dim,we=Math.floor(_e),Ae=Math.floor(xe);return(F?this.exaggeration():1)*zr(zr(pe.get(we,Ae),pe.get(we,Ae+1),xe-Ae),zr(pe.get(we+1,Ae),pe.get(we+1,Ae+1),xe-Ae),_e-we)}getAtTileOffset(t,e,F){const K=1<<t.canonical.z;return this.getAtPointOrZero(new el(t.wrap+(t.canonical.x+e/ur)/K,(t.canonical.y+F/ur)/K))}getAtTileOffsetFunc(t,e,F,K){return J=>{const ee=this.getAtTileOffset(t,J.x,J.y),ie=K.upVector(t.canonical,J.x,J.y);return kn(ie,ie,ee*K.upVectorScale(t.canonical,e,F).metersToTile),ie}}getForTilePoints(t,e,F,K){if(this.isUsingMockSource())return!1;const J=_h.create(this,t,K);return!!J&&(e.forEach(ee=>{ee[2]=this.exaggeration()*J.getElevationAt(ee[0],ee[1],F)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const F=e.dem.tree,K=e.tileID,J=1<<t.canonical.z-K.canonical.z;let ee=t.canonical.x/J-K.canonical.x,ie=t.canonical.y/J-K.canonical.y,oe=0;for(let le=0;le<t.canonical.z-K.canonical.z&&!F.leaves[oe];le++){ee*=2,ie*=2;const ce=2*Math.floor(ie)+Math.floor(ee);oe=F.childOffsets[oe]+ce,ee%=1,ie%=1}return{min:this.exaggeration()*F.minimums[oe],max:this.exaggeration()*F.maximums[oe]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,F){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},H.ErrorEvent=to,H.EvaluationParameters=de,H.Event=Mo,H.Evented=Ca,H.FillExtrusionBucket=Cc,H.Frustum=Yh,H.FrustumCorners=Xh,H.GLOBE_RADIUS=Eo,H.GLOBE_SCALE_MATCH_LATITUDE=45,H.GLOBE_ZOOM_THRESHOLD_MAX=$p,H.GLOBE_ZOOM_THRESHOLD_MIN=Jh,H.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const F=new kt,K=new or,J=[],ee=t+1+2,ie=e[0]+1,oe=e[0]+1+(1+e.length),le=(ce,pe,me)=>{let _e=ce===ee-1?ce-2:ce===0?ce:ce-1;return _e+=me?24575:0,[_e,pe]};for(let ce=0;ce<ee;++ce)F.emplaceBack(...le(ce,0,!0));for(let ce=0;ce<ie;++ce)for(let pe=0;pe<ee;++pe)F.emplaceBack(...le(pe,ce,(pe===0||pe===ee-1)&&!0));for(let ce=0;ce<e.length;++ce){const pe=e[ce];for(let me=0;me<ee;++me)F.emplaceBack(...le(me,pe,!0))}for(let ce=0;ce<e.length;++ce){const pe=K.length,me=e[ce]+1+2,_e=new or;for(let Ae=0;Ae<me-1;Ae++){const Re=Ae===me-2,ze=Re?ee*(oe-e.length+ce-Ae):ee;for(let Ze=0;Ze<ee-1;Ze++){const Ue=Ae*ee+Ze;Ae===0||Re||Ze===0||Ze===ee-2?(_e.emplaceBack(Ue+1,Ue,Ue+ze),_e.emplaceBack(Ue+ze,Ue+ze+1,Ue+1)):(K.emplaceBack(Ue+1,Ue,Ue+ze),K.emplaceBack(Ue+ze,Ue+ze+1,Ue+1))}}const xe=Pi.simpleSegment(0,pe,F.length,K.length-pe);for(let Ae=0;Ae<_e.uint16.length;Ae+=3)K.emplaceBack(_e.uint16[Ae],_e.uint16[Ae+1],_e.uint16[Ae+2]);const we=Pi.simpleSegment(0,pe,F.length,K.length-pe);J.push({withoutSkirts:xe,withSkirts:we})}return{vertices:F,indices:K,segments:J}}_createGrid(t){const e=this._fillGridMeshWithLods(ls,$c);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,vc.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new or;for(let J=0;J<=ls;J++)e.emplaceBack(0,J+1,J+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const F=new ti,K=new ti;this._poleSegments=[];for(let J=0,ee=0;J<Jh;J++){const ie=360/(1<<J);F.emplaceBack(0,-Eo,0,.5,0),K.emplaceBack(0,-Eo,0,.5,1);for(let oe=0;oe<=ls;oe++){const le=oe/ls,ce=zr(0,ie,le),[pe,me,_e]=Ys(Xm,Ym,ce,Eo);F.emplaceBack(pe,me,_e,le,0),K.emplaceBack(pe,me,_e,le,1)}this._poleSegments.push(Pi.simpleSegment(ee,0,66,64)),ee+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(F,gp,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(K,gp,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const F=new Vi,K=ls,J=K+1+2,ee=1;this._wireframeSegments=[];for(let ie=0,oe=0;ie<$c.length;ie++){const le=$c[ie];for(let pe=ee;pe<le+ee;pe++)for(let me=ee;me<K+ee;me++){const _e=pe*J+me;F.emplaceBack(_e,_e+1),F.emplaceBack(_e,_e+J),F.emplaceBack(_e,_e+J+1)}const ce=le*K*3;this._wireframeSegments.push(Pi.simpleSegment(0,oe,(le+1)*J,ce)),oe+=ce}this._wireframeIndexBuffer=t.createIndexBuffer(F)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},H.GlyphManager=cl,H.ImagePosition=Sf,H.KDBush=Vf,H.LivePerformanceUtils=gh,H.LngLat=ii,H.LngLatBounds=$a,H.LocalGlyphMode=Of,H.MAX_MERCATOR_LATITUDE=an,H.MercatorCoordinate=el,H.ONE_EM=Zi,H.OverscaledTileID=yn,H.PerformanceMarkers=Qo,H.Point=zt,H.Properties=Ge,H.RGBAImage=Cn,H.Ray=Zh,H.RequestManager=class{constructor(t,e,F){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!F,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let F=0;F<10;F++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",nr,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!it(t))return t;const F=Kt(t);return F.path=`/styles/v1${F.path}`,this._makeAPIURL(F,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!it(t))return t;const F=Kt(t);return F.path=`/fonts/v1${F.path}`,this._makeAPIURL(F,this._customAccessToken||e)}normalizeSourceURL(t,e,F,K){if(!it(t))return t;const J=Kt(t);return J.path=`/v4/${J.authority}.json`,J.params.push("secure"),F&&J.params.push(`language=${F}`),K&&J.params.push(`worldview=${K}`),this._makeAPIURL(J,this._customAccessToken||e)}normalizeSpriteURL(t,e,F,K){const J=Kt(t);return it(t)?(J.path=`/styles/v1${J.path}/sprite${e}${F}`,this._makeAPIURL(J,this._customAccessToken||K)):(J.path+=`${e}${F}`,Vt(J))}normalizeTileURL(t,e,F){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!it(t))return t;const K=Kt(t);K.path=K.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||F&&K.authority!=="raster"&&F===512?"@2x":""}${je.supported?".webp":"$1"}`),K.authority==="raster"?K.path=`/${Fe.RASTER_URL_PREFIX}${K.path}`:(K.path=K.path.replace(/^.+\/v4\//,"/"),K.path=`/${Fe.TILE_URL_VERSION}${K.path}`);const J=this._customAccessToken||function(ee){for(const ie of ee){const oe=ie.match(/^access_token=(.*)$/);if(oe)return oe[1]}return null}(K.params)||Fe.ACCESS_TOKEN;return Fe.REQUIRE_ACCESS_TOKEN&&J&&this._skuToken&&K.params.push(`sku=${this._skuToken}`),this._makeAPIURL(K,J)}canonicalizeTileURL(t,e){const F=Kt(t);if(!F.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!F.path.match(/\.[\w]+$/))return t;let K="mapbox://";F.path.match(/^\/raster\/v1\//)?K+=`raster/${F.path.replace(`/${Fe.RASTER_URL_PREFIX}/`,"")}`:K+=`tiles/${F.path.replace(`/${Fe.TILE_URL_VERSION}/`,"")}`;let J=F.params;return e&&(J=J.filter(ee=>!ee.match(/^access_token=/))),J.length&&(K+=`?${J.join("&")}`),K}canonicalizeTileset(t,e){const F=!!e&&it(e),K=[];for(const J of t.tiles||[])lt(J)?K.push(this.canonicalizeTileURL(J,F)):K.push(J);return K}_makeAPIURL(t,e){const F="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",K=Kt(Fe.API_URL);if(t.protocol=K.protocol,t.authority=K.authority,t.protocol==="http"){const J=t.params.indexOf("secure");J>=0&&t.params.splice(J,1)}if(K.path!=="/"&&(t.path=`${K.path}${t.path}`),!Fe.REQUIRE_ACCESS_TOKEN)return Vt(t);if(e=e||Fe.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${F}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${F}`)}return t.params=t.params.filter(J=>J.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Vt(t)}},H.ResourceType=Ar,H.SegmentVector=Pi,H.SourceCache=ds,H.StencilMode=Ff,H.StructArrayLayout1ui2=An,H.StructArrayLayout2f1f2i16=fr,H.StructArrayLayout2i4=kt,H.StructArrayLayout2ui4=Vi,H.StructArrayLayout3f12=Pr,H.StructArrayLayout3ui6=or,H.StructArrayLayout4i8=At,H.StructArrayLayout5f20=ti,H.Texture=Uc,H.Tile=kf,H.Transitionable=Te,H.Uniform1f=Bu,H.Uniform1i=class extends Go{constructor(t){super(t),this.current=0}set(t,e,F){this.fetchUniformLocation(t,e)&&this.current!==F&&(this.current=F,this.gl.uniform1i(this.location,F))}},H.Uniform2f=class extends Go{constructor(t){super(t),this.current=[0,0]}set(t,e,F){this.fetchUniformLocation(t,e)&&(F[0]===this.current[0]&&F[1]===this.current[1]||(this.current=F,this.gl.uniform2f(this.location,F[0],F[1])))}},H.Uniform3f=class extends Go{constructor(t){super(t),this.current=[0,0,0]}set(t,e,F){this.fetchUniformLocation(t,e)&&(F[0]===this.current[0]&&F[1]===this.current[1]&&F[2]===this.current[2]||(this.current=F,this.gl.uniform3f(this.location,F[0],F[1],F[2])))}},H.Uniform4f=tp,H.UniformColor=rp,H.UniformMatrix2f=class extends Go{constructor(t){super(t),this.current=Dm}set(t,e,F){if(this.fetchUniformLocation(t,e)){for(let K=0;K<4;K++)if(F[K]!==this.current[K]){this.current=F,this.gl.uniformMatrix2fv(this.location,!1,F);break}}}},H.UniformMatrix3f=class extends Go{constructor(t){super(t),this.current=Mm}set(t,e,F){if(this.fetchUniformLocation(t,e)){for(let K=0;K<9;K++)if(F[K]!==this.current[K]){this.current=F,this.gl.uniformMatrix3fv(this.location,!1,F);break}}}},H.UniformMatrix4f=class extends Go{constructor(t){super(t),this.current=Rm}set(t,e,F){if(this.fetchUniformLocation(t,e)){if(F[12]!==this.current[12]||F[0]!==this.current[0])return this.current=F,void this.gl.uniformMatrix4fv(this.location,!1,F);for(let K=1;K<16;K++)if(F[K]!==this.current[K]){this.current=F,this.gl.uniformMatrix4fv(this.location,!1,F);break}}}},H.UnwrappedTileID=ud,H.ValidationError=er,H.VectorTileFeature=Yu,H.VectorTileWorkerSource=class extends Ca{constructor(t,e,F,K,J){super(),this.actor=t,this.layerIndex=e,this.availableImages=F,this.loadVectorData=J||$m,this.loading={},this.loaded={},this.deduped=new vm(t.scheduler),this.isSpriteLoaded=K,this.scheduler=t.scheduler}loadTile(t,e){const F=t.uid,K=t&&t.request,J=K&&K.collectResourceTiming,ee=this.loading[F]=new ig(t);ee.abort=this.loadVectorData(t,(ie,oe)=>{const le=!this.loading[F];if(delete this.loading[F],le||ie||!oe)return ee.status="done",le||(this.loaded[F]=ee),e(ie);const ce=oe.rawData,pe={};oe.expires&&(pe.expires=oe.expires),oe.cacheControl&&(pe.cacheControl=oe.cacheControl),ee.vectorTile=oe.vectorTile||new xf(new ih(ce));const me=()=>{ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor,(_e,xe)=>{if(_e||!xe)return e(_e);const we={};if(J){const Ae=yl(K);Ae.length>0&&(we.resourceTiming=JSON.parse(JSON.stringify(Ae)))}e(null,mr({rawTileData:ce.slice(0)},xe,pe,we))})};this.isSpriteLoaded?me():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(me,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):me()}),this.loaded=this.loaded||{},this.loaded[F]=ee})}reloadTile(t,e){const F=this.loaded,K=t.uid,J=this;if(F&&F[K]){const ee=F[K];ee.showCollisionBoxes=t.showCollisionBoxes,ee.enableTerrain=!!t.enableTerrain,ee.projection=t.projection,ee.tileTransform=ps(t.tileID.canonical,t.projection);const ie=(oe,le)=>{const ce=ee.reloadCallback;ce&&(delete ee.reloadCallback,ee.parse(ee.vectorTile,J.layerIndex,this.availableImages,J.actor,ce)),e(oe,le)};ee.status==="parsing"?ee.reloadCallback=ie:ee.status==="done"&&(ee.vectorTile?ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor,ie):ie())}}abortTile(t,e){const F=t.uid,K=this.loading[F];K&&(K.abort&&K.abort(),delete this.loading[F]),e()}removeTile(t,e){const F=this.loaded,K=t.uid;F&&F[K]&&delete F[K],e()}},H.WritingMode=Fn,H.ZoomDependentExpression=Ka,H.add=qo,H.addDynamicAttributes=ph,H.adjoint=function(t,e){var F=e[0],K=e[1],J=e[2],ee=e[3],ie=e[4],oe=e[5],le=e[6],ce=e[7],pe=e[8];return t[0]=ie*pe-oe*ce,t[1]=J*ce-K*pe,t[2]=K*oe-J*ie,t[3]=oe*le-ee*pe,t[4]=F*pe-J*le,t[5]=J*ee-F*oe,t[6]=ee*ce-ie*le,t[7]=K*le-F*ce,t[8]=F*ie-K*ee,t},H.asyncAll=Ht,H.bezier=xt,H.bindAll=Yi,H.boundsAttributes=rm,H.bufferConvexPolygon=function(t,e){const F=[];for(let K=0;K<t.length;K++){const J=It(K-1,-1,t.length-1),ee=It(K+1,-1,t.length-1),ie=t[K],oe=t[ee],le=t[J].sub(ie).unit(),ce=oe.sub(ie).unit(),pe=ce.angleWithSep(le.x,le.y),me=le.add(ce).unit().mult(-1*e/Math.sin(pe/2));F.push(ie.add(me))}return F},H.cacheEntryPossiblyAdded=function(t){Dt++,Dt>Me&&(t.getActor().send("enforceCacheSizeLimit",Jo),Dt=0)},H.calculateGlobeLabelMatrix=function(t,e){const{x:F,y:K}=t.point,J=Tp(F,K,t.worldSize/t._pixelsPerMercatorPixel,0,0);return os(J,J,tf(To(e)))},H.calculateGlobeMatrix=function(t){const{x:e,y:F}=t.point,{lng:K,lat:J}=t._center;return Tp(e,F,t.worldSize,K,J)},H.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,F=e/yo(1,t.center.lat),K=po(new Float64Array(16));return pc(K,K,[t.point.x,t.point.y,0]),as(K,K,[F,F,e]),Float32Array.from(K)},H.circumferenceAtLatitude=nf,H.clamp=ht,H.clearTileCache=function(t){if(!We())return;const e=ye.caches.delete(sn);t&&e.catch(t).then(()=>t())},H.clipLine=Nd,H.clone=function(t){var e=new On(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},H.clone$1=Fi,H.collisionCircleLayout=t_,H.config=Fe,H.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},H.create=function(){var t=new On(16);return On!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},H.create$1=op,H.createExpression=pa,H.createLayout=nt,H.createStyleLayer=function(t){return t.type==="custom"?new q_(t):new K_[t.type](t)},H.cross=Kh,H.degToRad=dr,H.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},H.div=function(t,e,F){return t[0]=e[0]/F[0],t[1]=e[1]/F[1],t[2]=e[2]/F[2],t},H.dot=Zn,H.earthRadius=wc,H.ease=Zt,H.easeCubicInOut=qi,H.ecefToLatLng=function([t,e,F]){const K=Math.hypot(t,e,F),J=Math.atan2(t,F),ee=.5*Math.PI-Math.acos(-e/K);return new ii(kr(J),kr(ee))},H.emitValidationErrors=Cu,H.endsWith=Ji,H.enforceCacheSizeLimit=function(t){ot(),$e&&$e.then(e=>{e.keys().then(F=>{for(let K=0;K<F.length-t;K++)e.delete(F[K])})})},H.evaluateSizeForFeature=th,H.evaluateSizeForZoom=ol,H.evaluateVariableOffset=Vd,H.evented=ne,H.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},H.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},H.exported=eo,H.exported$1=je,H.extend=mr,H.extend$1=ro,H.fillExtrusionHeightLift=sd,H.filterObject=vn,H.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},H.fromQuat=function(t,e){var F=e[0],K=e[1],J=e[2],ee=e[3],ie=F+F,oe=K+K,le=J+J,ce=F*ie,pe=K*ie,me=K*oe,_e=J*ie,xe=J*oe,we=J*le,Ae=ee*ie,Re=ee*oe,ze=ee*le;return t[0]=1-me-we,t[1]=pe+ze,t[2]=_e-Re,t[3]=0,t[4]=pe-ze,t[5]=1-ce-we,t[6]=xe+Ae,t[7]=0,t[8]=_e+Re,t[9]=xe-Ae,t[10]=1-ce-me,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},H.fromRotation=function(t,e){var F=Math.sin(e),K=Math.cos(e);return t[0]=K,t[1]=F,t[2]=0,t[3]=-F,t[4]=K,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},H.fromScaling=sp,H.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return un[e]},H.getAABBPointSquareDist=function(t,e,F){let K=0;for(let J=0;J<2;++J){const ee=F?F[J]:0;t[J]>ee&&(K+=(t[J]-ee)*(t[J]-ee)),e[J]<ee&&(K+=(ee-e[J])*(ee-e[J]))}return K},H.getAnchorAlignment=Af,H.getAnchorJustification=Pf,H.getBounds=function(t){let e=1/0,F=1/0,K=-1/0,J=-1/0;for(const ee of t)e=Math.min(e,ee.x),F=Math.min(F,ee.y),K=Math.max(K,ee.x),J=Math.max(J,ee.y);return{min:new zt(e,F),max:new zt(K,J)}},H.getColumn=Un,H.getDefaultExportFromCjs=sr,H.getGridMatrix=function(t,e,F,K){const J=e.getNorth(),ee=e.getSouth(),ie=e.getWest(),oe=e.getEast(),le=1<<t.z,ce=oe-ie,pe=J-ee,me=ce/ls,_e=-pe/$c[F],xe=[0,me,0,_e,0,0,J,ie,0];if(t.z>0){const we=180/K;ap(xe,xe,[we/ce+1,0,0,0,we/pe+1,0,-.5*we/me,.5*we/_e,1])}return xe[2]=le,xe[5]=t.x,xe[8]=t.y,xe},H.getImage=qe,H.getJSON=function(t,e){return Jr(mr(t,{type:"json"}),e)},H.getLatitudinalLod=function(t){const e=an-5;t=ht(t,-e,e)/e*90;const F=Math.pow(Math.abs(Math.sin(dr(t))),3);return Math.round(F*($c.length-1))},H.getMapSessionAPI=zi,H.getPerformanceMeasurement=yl,H.getProjection=Yd,H.getRTLTextPluginStatus=ae,H.getReferrer=Zr,H.getTilePoint=function(t,{x:e,y:F},K=0){return new zt(((e-K)*t.scale-t.x)*ur,(F*t.scale-t.y)*ur)},H.getTileVec3=function(t,e,F=0){return Xs(((e.x-F)*t.scale-t.x)*ur,(e.y*t.scale-t.y)*ur,Cp(e.z,e.y))},H.getVideo=function(t,e){const F=ye.document.createElement("video");F.muted=!0,F.onloadstart=function(){e(null,F)};for(let K=0;K<t.length;K++){const J=ye.document.createElement("source");gs(t[K])||(F.crossOrigin="Anonymous"),J.src=t[K],F.appendChild(J)}return{cancel:()=>{}}},H.globeCenterToScreenPoint=function(t){const e=[0,0,0],F=po(new Float64Array(16));return os(F,t.pixelMatrix,t.globeMatrix),Ii(e,e,F),new zt(e[0],e[1])},H.globeDenormalizeECEF=tf,H.globeECEFOrigin=function(t,e){const F=[0,0,0];return Ii(F,F,bc(To(e.canonical))),Ii(F,F,t),F},H.globeMetersToEcef=Fu,H.globeNormalizeECEF=bc,H.globePixelsToTileUnits=function(t,e){return ur/(512*Math.pow(2,t))*Uu(To(e))},H.globePoleMatrixForTile=function(t,e,F){const K=po(new Float64Array(16)),J=(e/(1<<t)-.5)*Math.PI*2;return Nu(K,F.globeMatrix,J),Float32Array.from(K)},H.globeTileBounds=To,H.globeTiltAtLngLat=Sp,H.globeToMercatorTransition=Qs,H.globeUseCustomAntiAliasing=function(t,e,F){const K=Qs(F.zoom),J=t.style.map._antialias,ee=!!e.extStandardDerivatives,ie=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return K===0&&!J&&!ie&&ee},H.identity=po,H.identity$1=mp,H.invert=Gh,H.isFullscreen=function(){return!!ye.document.fullscreenElement||!!ye.document.webkitFullscreenElement},H.isLngLatBehindGlobe=rf,H.isMapAuthenticated=function(t){return ln.has(t)},H.isMapboxURL=it,H.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Hi(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},H.latFromMercatorY=on,H.latLngToECEF=Js,H.len=Vm,H.length=dc,H.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},H.lngFromMercatorX=Nn,H.loadVectorTile=$m,H.makeRequest=Jr,H.mapValue=function(t,e,F,K,J){return ht((t-e)/(F-e)*(J-K)+K,K,J)},H.mercatorScale=Pp,H.mercatorXfromLng=So,H.mercatorYfromLat=Io,H.mercatorZfromAltitude=yo,H.mul=Um,H.mul$1=jm,H.multiply=os,H.multiply$1=ap,H.multiply$2=up,H.nextPowerOfTwo=Xr,H.normalize=dn,H.normalize$1=Gm,H.normalize$2=pp,H.number=zr,H.ortho=function(t,e,F,K,J,ee,ie){var oe=1/(e-F),le=1/(K-J),ce=1/(ee-ie);return t[0]=-2*oe,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*le,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*ce,t[11]=0,t[12]=(e+F)*oe,t[13]=(J+K)*le,t[14]=(ie+ee)*ce,t[15]=1,t},H.pbf=_d,H.perspective=function(t,e,F,K,J){var ee,ie=1/Math.tan(e/2);return t[0]=ie/F,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=ie,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,J!=null&&J!==1/0?(t[10]=(J+K)*(ee=1/(K-J)),t[14]=2*J*K*ee):(t[10]=-1,t[14]=-2*K),t},H.pick=function(t,e){const F={};for(let K=0;K<e.length;K++){const J=e[K];J in t&&(F[J]=t[J])}return F},H.plugin=fe,H.pointGeometry=br,H.polesInViewport=function(t){const e=po(new Float64Array(16));os(e,t.pixelMatrix,t.globeMatrix);const F=[0,Xn,0],K=[0,Yn,0];return Ii(F,F,e),Ii(K,K,e),[F[0]>0&&F[0]<=t.width&&F[1]>0&&F[1]<=t.height&&!rf(t,new ii(t.center.lat,90)),K[0]>0&&K[0]<=t.width&&K[1]>0&&K[1]<=t.height&&!rf(t,new ii(t.center.lat,-90))]},H.polygonContainsPoint=hs,H.polygonIntersectsBox=Np,H.polygonIntersectsPolygon=Dp,H.polygonizeBounds=function(t,e,F=0,K=!0){const J=new zt(F,F),ee=t.sub(J),ie=e.add(J),oe=[ee,new zt(ie.x,ee.y),ie,new zt(ee.x,ie.y)];return K&&oe.push(ee.clone()),oe},H.posAttributes=vc,H.postMapLoadEvent=Ai,H.postPerformanceEvent=ki,H.postTurnstileEvent=Nr,H.potpack=Tf,H.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},H.radToDeg=kr,H.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],H.registerForPluginStateChange=function(t){return t({pluginStatus:Q,pluginURL:U}),ne.on("pluginStateChange",t),t},H.removeAuthState=function(t){ln.delete(t)},H.renderColorRamp=ff,H.resample=Rp,H.rotateX=Wh,H.rotateX$1=yp,H.rotateY=Nu,H.rotateY$1=_p,H.rotateZ=function(t,e,F){var K=Math.sin(F),J=Math.cos(F),ee=e[0],ie=e[1],oe=e[2],le=e[3],ce=e[4],pe=e[5],me=e[6],_e=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=ee*J+ce*K,t[1]=ie*J+pe*K,t[2]=oe*J+me*K,t[3]=le*J+_e*K,t[4]=ce*J-ee*K,t[5]=pe*J-ie*K,t[6]=me*J-oe*K,t[7]=_e*J-le*K,t},H.rotateZ$1=function(t,e,F){F*=.5;var K=e[0],J=e[1],ee=e[2],ie=e[3],oe=Math.sin(F),le=Math.cos(F);return t[0]=K*le+J*oe,t[1]=J*le-K*oe,t[2]=ee*le+ie*oe,t[3]=ie*le-ee*oe,t},H.scale=as,H.scale$1=fp,H.scale$2=kn,H.scaleAndAdd=_c,H.set=function(t,e,F,K){return t[0]=e,t[1]=F,t[2]=K,t},H.setCacheLimits=function(t,e){Jo=t,Me=e},H.setColumn=function(t,e,F){t[4*e+0]=F[0],t[4*e+1]=F[1],t[4*e+2]=F[2],t[4*e+3]=F[3]},H.setRTLTextPlugin=function(t,e,F=!1){if(Q===lc||Q===cc||Q===uc)throw new Error("setRTLTextPlugin cannot be called multiple times.");U=eo.resolveURL(t),Q=lc,_a=e,te(),F||he()},H.smoothstep=Rt,H.spec=Et,H.squaredLength=function(t){var e=t[0],F=t[1],K=t[2];return e*e+F*F+K*K},H.storeAuthState=function(t,e){e?ln.add(t):ln.delete(t)},H.sub=mo,H.subtract=Hh,H.symbolSize=r_,H.tileAABB=function(t,e,F,K,J,ee,ie,oe,le){if(le.name==="globe")return Zm(t,e,new Qu(F,K,J));const ce=ps({z:F,x:K,y:J},le);return new mn([(ee+ce.x/ce.scale)*e,e*(ce.y/ce.scale),ie],[(ee+ce.x2/ce.scale)*e,e*(ce.y2/ce.scale),oe])},H.tileCornersToBounds=zu,H.tileTransform=ps,H.transformMat3=function(t,e,F){var K=e[0],J=e[1],ee=e[2];return t[0]=K*F[0]+J*F[3]+ee*F[6],t[1]=K*F[1]+J*F[4]+ee*F[7],t[2]=K*F[2]+J*F[5]+ee*F[8],t},H.transformMat4=Ii,H.transformMat4$1=ss,H.transformQuat=hp,H.transitionTileAABBinECEF=bp,H.translate=pc,H.transpose=function(t,e){if(t===e){var F=e[1],K=e[2],J=e[5];t[1]=e[3],t[2]=e[6],t[3]=F,t[5]=e[7],t[6]=K,t[7]=J}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},H.triggerPluginCompletionEvent=Y,H.uniqueId=si,H.updateGlobeVertexNormal=function(t,e,F,K,J){const ee=5*e+2;t.float32[ee+0]=F,t.float32[ee+1]=K,t.float32[ee+2]=J},H.validateCustomStyleLayer=function(t){const e=[],F=t.id;return F===void 0&&e.push({message:`layers.${F}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${F}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${F}: property "renderingMode" must be either "2d" or "3d"`}),e},H.validateFilter=t=>In(Qa(t)),H.validateFog=t=>In(Iu(t)),H.validateLayer=t=>In(wu(t)),H.validateLight=t=>In(Su(t)),H.validateSource=t=>In(Tu(t)),H.validateStyle=Ou,H.validateTerrain=t=>In(ic(t)),H.values=ar,H.vectorTile=Xu,H.version=Ie,H.warnOnce=di,H.window=ye,H.wrap=It}),se(["./shared"],function(H){function ye(Ke){if(typeof Ke=="number"||typeof Ke=="boolean"||typeof Ke=="string"||Ke==null)return JSON.stringify(Ke);if(Array.isArray(Ke)){let Ce="[";for(const qe of Ke)Ce+=`${ye(qe)},`;return`${Ce}]`}let Oe="{";for(const Ce of Object.keys(Ke).sort())Oe+=`${Ce}:${ye(Ke[Ce])},`;return`${Oe}}`}function Ie(Ke){let Oe="";for(const Ce of H.refProperties)Oe+=`/${ye(Ke[Ce])}`;return Oe}class Ee{constructor(Oe){this.keyCache={},Oe&&this.replace(Oe)}replace(Oe){this._layerConfigs={},this._layers={},this.update(Oe,[])}update(Oe,Ce){for(const Je of Oe)this._layerConfigs[Je.id]=Je,(this._layers[Je.id]=H.createStyleLayer(Je)).compileFilter(),this.keyCache[Je.id]&&delete this.keyCache[Je.id];for(const Je of Ce)delete this.keyCache[Je],delete this._layerConfigs[Je],delete this._layers[Je];this.familiesBySource={};const qe=function(Je,it){const lt={};for(let rt=0;rt<Je.length;rt++){const gt=it&&it[Je[rt].id]||Ie(Je[rt]);it&&(it[Je[rt].id]=gt);let qt=lt[gt];qt||(qt=lt[gt]=[]),qt.push(Je[rt])}const st=[];for(const rt in lt)st.push(lt[rt]);return st}(H.values(this._layerConfigs),this.keyCache);for(const Je of qe){const it=Je.map(Kt=>this._layers[Kt.id]),lt=it[0];if(lt.visibility==="none")continue;const st=lt.source||"";let rt=this.familiesBySource[st];rt||(rt=this.familiesBySource[st]={});const gt=lt.sourceLayer||"_geojsonTileLayer";let qt=rt[gt];qt||(qt=rt[gt]=[]),qt.push(it)}}}class Fe{loadTile(Oe,Ce){const{uid:qe,encoding:Je,rawImageData:it,padding:lt,buildQuadTree:st}=Oe,rt=H.window.ImageBitmap&&it instanceof H.window.ImageBitmap?this.getImageData(it,lt):it;Ce(null,new H.DEMData(qe,rt,Je,lt<1,st))}getImageData(Oe,Ce){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Oe.width,Oe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Oe.width,this.offscreenCanvas.height=Oe.height,this.offscreenCanvasContext.drawImage(Oe,0,0,Oe.width,Oe.height);const qe=this.offscreenCanvasContext.getImageData(-Ce,-Ce,Oe.width+2*Ce,Oe.height+2*Ce);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),qe}}function je(Ke,Oe){if(Ke.length!==0){mt(Ke[0],Oe);for(var Ce=1;Ce<Ke.length;Ce++)mt(Ke[Ce],!Oe)}}function mt(Ke,Oe){for(var Ce=0,qe=0,Je=0,it=Ke.length,lt=it-1;Je<it;lt=Je++){var st=(Ke[Je][0]-Ke[lt][0])*(Ke[lt][1]+Ke[Je][1]),rt=Ce+st;qe+=Math.abs(Ce)>=Math.abs(st)?Ce-rt+st:st-rt+Ce,Ce=rt}Ce+qe>=0!=!!Oe&&Ke.reverse()}var wt=H.getDefaultExportFromCjs(function Ke(Oe,Ce){var qe,Je=Oe&&Oe.type;if(Je==="FeatureCollection")for(qe=0;qe<Oe.features.length;qe++)Ke(Oe.features[qe],Ce);else if(Je==="GeometryCollection")for(qe=0;qe<Oe.geometries.length;qe++)Ke(Oe.geometries[qe],Ce);else if(Je==="Feature")Ke(Oe.geometry,Ce);else if(Je==="Polygon")je(Oe.coordinates,Ce);else if(Je==="MultiPolygon")for(qe=0;qe<Oe.coordinates.length;qe++)je(Oe.coordinates[qe],Ce);return Oe});const Ot=H.VectorTileFeature.prototype.toGeoJSON;var $t={exports:{}},jt=H.pointGeometry,nr=H.vectorTile.VectorTileFeature,sr=gr;function gr(Ke,Oe){this.options=Oe||{},this.features=Ke,this.length=Ke.length}function hr(Ke,Oe){this.id=typeof Ke.id=="number"?Ke.id:void 0,this.type=Ke.type,this.rawGeometry=Ke.type===1?[Ke.geometry]:Ke.geometry,this.properties=Ke.tags,this.extent=Oe||4096}gr.prototype.feature=function(Ke){return new hr(this.features[Ke],this.options.extent)},hr.prototype.loadGeometry=function(){var Ke=this.rawGeometry;this.geometry=[];for(var Oe=0;Oe<Ke.length;Oe++){for(var Ce=Ke[Oe],qe=[],Je=0;Je<Ce.length;Je++)qe.push(new jt(Ce[Je][0],Ce[Je][1]));this.geometry.push(qe)}return this.geometry},hr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ke=this.geometry,Oe=1/0,Ce=-1/0,qe=1/0,Je=-1/0,it=0;it<Ke.length;it++)for(var lt=Ke[it],st=0;st<lt.length;st++){var rt=lt[st];Oe=Math.min(Oe,rt.x),Ce=Math.max(Ce,rt.x),qe=Math.min(qe,rt.y),Je=Math.max(Je,rt.y)}return[Oe,qe,Ce,Je]},hr.prototype.toGeoJSON=nr.prototype.toGeoJSON;var Ir=H.pbf,br=sr;function yr(Ke){var Oe=new Ir;return function(Ce,qe){for(var Je in Ce.layers)qe.writeMessage(3,zt,Ce.layers[Je])}(Ke,Oe),Oe.finish()}function zt(Ke,Oe){var Ce;Oe.writeVarintField(15,Ke.version||1),Oe.writeStringField(1,Ke.name||""),Oe.writeVarintField(5,Ke.extent||4096);var qe={keys:[],values:[],keycache:{},valuecache:{}};for(Ce=0;Ce<Ke.length;Ce++)qe.feature=Ke.feature(Ce),Oe.writeMessage(2,gi,qe);var Je=qe.keys;for(Ce=0;Ce<Je.length;Ce++)Oe.writeStringField(3,Je[Ce]);var it=qe.values;for(Ce=0;Ce<it.length;Ce++)Oe.writeMessage(4,qi,it[Ce])}function gi(Ke,Oe){var Ce=Ke.feature;Ce.id!==void 0&&Oe.writeVarintField(1,Ce.id),Oe.writeMessage(2,Ti,Ke),Oe.writeVarintField(3,Ce.type),Oe.writeMessage(4,un,Ce)}function Ti(Ke,Oe){var Ce=Ke.feature,qe=Ke.keys,Je=Ke.values,it=Ke.keycache,lt=Ke.valuecache;for(var st in Ce.properties){var rt=Ce.properties[st],gt=it[st];if(rt!==null){gt===void 0&&(qe.push(st),it[st]=gt=qe.length-1),Oe.writeVarint(gt);var qt=typeof rt;qt!=="string"&&qt!=="boolean"&&qt!=="number"&&(rt=JSON.stringify(rt));var Kt=qt+":"+rt,Vt=lt[Kt];Vt===void 0&&(Je.push(rt),lt[Kt]=Vt=Je.length-1),Oe.writeVarint(Vt)}}}function dr(Ke,Oe){return(Oe<<3)+(7&Ke)}function kr(Ke){return Ke<<1^Ke>>31}function un(Ke,Oe){for(var Ce=Ke.loadGeometry(),qe=Ke.type,Je=0,it=0,lt=Ce.length,st=0;st<lt;st++){var rt=Ce[st],gt=1;qe===1&&(gt=rt.length),Oe.writeVarint(dr(1,gt));for(var qt=qe===3?rt.length-1:rt.length,Kt=0;Kt<qt;Kt++){Kt===1&&qe!==1&&Oe.writeVarint(dr(2,qt-1));var Vt=rt[Kt].x-Je,wr=rt[Kt].y-it;Oe.writeVarint(kr(Vt)),Oe.writeVarint(kr(wr)),Je+=Vt,it+=wr}qe===3&&Oe.writeVarint(dr(7,1))}}function qi(Ke,Oe){var Ce=typeof Ke;Ce==="string"?Oe.writeStringField(1,Ke):Ce==="boolean"?Oe.writeBooleanField(7,Ke):Ce==="number"&&(Ke%1!=0?Oe.writeDoubleField(3,Ke):Ke<0?Oe.writeSVarintField(6,Ke):Oe.writeVarintField(5,Ke))}$t.exports=yr,$t.exports.fromVectorTileJs=yr,$t.exports.fromGeojsonVt=function(Ke,Oe){Oe=Oe||{};var Ce={};for(var qe in Ke)Ce[qe]=new br(Ke[qe].features,Oe),Ce[qe].name=qe,Ce[qe].version=Oe.version,Ce[qe].extent=Oe.extent;return yr({layers:Ce})},$t.exports.GeoJSONWrapper=br;var xt=H.getDefaultExportFromCjs($t.exports);const Zt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ke=>Ke},ht=Math.fround||(Rt=new Float32Array(1),Ke=>(Rt[0]=+Ke,Rt[0]));var Rt;const It=3,Ht=5,ar=6;class mr{constructor(Oe){this.options=Object.assign(Object.create(Zt),Oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Oe){const{log:Ce,minZoom:qe,maxZoom:Je}=this.options;Ce&&console.time("total time");const it=`prepare ${Oe.length} points`;Ce&&console.time(it),this.points=Oe;const lt=[];for(let rt=0;rt<Oe.length;rt++){const gt=Oe[rt];if(!gt.geometry)continue;const[qt,Kt]=gt.geometry.coordinates,Vt=ht(xi(qt)),wr=ht(Xr(Kt));lt.push(Vt,wr,1/0,rt,-1,1),this.options.reduce&&lt.push(0)}let st=this.trees[Je+1]=this._createTree(lt);Ce&&console.timeEnd(it);for(let rt=Je;rt>=qe;rt--){const gt=+Date.now();st=this.trees[rt]=this._createTree(this._cluster(st,rt)),Ce&&console.log("z%d: %d clusters in %dms",rt,st.numItems,+Date.now()-gt)}return Ce&&console.timeEnd("total time"),this}getClusters(Oe,Ce){let qe=((Oe[0]+180)%360+360)%360-180;const Je=Math.max(-90,Math.min(90,Oe[1]));let it=Oe[2]===180?180:((Oe[2]+180)%360+360)%360-180;const lt=Math.max(-90,Math.min(90,Oe[3]));if(Oe[2]-Oe[0]>=360)qe=-180,it=180;else if(qe>it){const Kt=this.getClusters([qe,Je,180,lt],Ce),Vt=this.getClusters([-180,Je,it,lt],Ce);return Kt.concat(Vt)}const st=this.trees[this._limitZoom(Ce)],rt=st.range(xi(qe),Xr(lt),xi(it),Xr(Je)),gt=st.data,qt=[];for(const Kt of rt){const Vt=this.stride*Kt;qt.push(gt[Vt+Ht]>1?Fr(gt,Vt,this.clusterProps):this.points[gt[Vt+It]])}return qt}getChildren(Oe){const Ce=this._getOriginId(Oe),qe=this._getOriginZoom(Oe),Je="No cluster with the specified id.",it=this.trees[qe];if(!it)throw new Error(Je);const lt=it.data;if(Ce*this.stride>=lt.length)throw new Error(Je);const st=this.options.radius/(this.options.extent*Math.pow(2,qe-1)),rt=it.within(lt[Ce*this.stride],lt[Ce*this.stride+1],st),gt=[];for(const qt of rt){const Kt=qt*this.stride;lt[Kt+4]===Oe&&gt.push(lt[Kt+Ht]>1?Fr(lt,Kt,this.clusterProps):this.points[lt[Kt+It]])}if(gt.length===0)throw new Error(Je);return gt}getLeaves(Oe,Ce,qe){const Je=[];return this._appendLeaves(Je,Oe,Ce=Ce||10,qe=qe||0,0),Je}getTile(Oe,Ce,qe){const Je=this.trees[this._limitZoom(Oe)],it=Math.pow(2,Oe),{extent:lt,radius:st}=this.options,rt=st/lt,gt=(qe-rt)/it,qt=(qe+1+rt)/it,Kt={features:[]};return this._addTileFeatures(Je.range((Ce-rt)/it,gt,(Ce+1+rt)/it,qt),Je.data,Ce,qe,it,Kt),Ce===0&&this._addTileFeatures(Je.range(1-rt/it,gt,1,qt),Je.data,it,qe,it,Kt),Ce===it-1&&this._addTileFeatures(Je.range(0,gt,rt/it,qt),Je.data,-1,qe,it,Kt),Kt.features.length?Kt:null}getClusterExpansionZoom(Oe){let Ce=this._getOriginZoom(Oe)-1;for(;Ce<=this.options.maxZoom;){const qe=this.getChildren(Oe);if(Ce++,qe.length!==1)break;Oe=qe[0].properties.cluster_id}return Ce}_appendLeaves(Oe,Ce,qe,Je,it){const lt=this.getChildren(Ce);for(const st of lt){const rt=st.properties;if(rt&&rt.cluster?it+rt.point_count<=Je?it+=rt.point_count:it=this._appendLeaves(Oe,rt.cluster_id,qe,Je,it):it<Je?it++:Oe.push(st),Oe.length===qe)break}return it}_createTree(Oe){const Ce=new H.KDBush(Oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let qe=0;qe<Oe.length;qe+=this.stride)Ce.add(Oe[qe],Oe[qe+1]);return Ce.finish(),Ce.data=Oe,Ce}_addTileFeatures(Oe,Ce,qe,Je,it,lt){for(const st of Oe){const rt=st*this.stride,gt=Ce[rt+Ht]>1;let qt,Kt,Vt;if(gt)qt=si(Ce,rt,this.clusterProps),Kt=Ce[rt],Vt=Ce[rt+1];else{const Er=this.points[Ce[rt+It]];qt=Er.properties;const[Cr,Nr]=Er.geometry.coordinates;Kt=xi(Cr),Vt=Xr(Nr)}const wr={type:1,geometry:[[Math.round(this.options.extent*(Kt*it-qe)),Math.round(this.options.extent*(Vt*it-Je))]],tags:qt};let Or;Or=gt||this.options.generateId?Ce[rt+It]:this.points[Ce[rt+It]].id,Or!==void 0&&(wr.id=Or),lt.features.push(wr)}}_limitZoom(Oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+Oe),this.options.maxZoom+1))}_cluster(Oe,Ce){const{radius:qe,extent:Je,reduce:it,minPoints:lt}=this.options,st=qe/(Je*Math.pow(2,Ce)),rt=Oe.data,gt=[],qt=this.stride;for(let Kt=0;Kt<rt.length;Kt+=qt){if(rt[Kt+2]<=Ce)continue;rt[Kt+2]=Ce;const Vt=rt[Kt],wr=rt[Kt+1],Or=Oe.within(rt[Kt],rt[Kt+1],st),Er=rt[Kt+Ht];let Cr=Er;for(const Nr of Or){const vi=Nr*qt;rt[vi+2]>Ce&&(Cr+=rt[vi+Ht])}if(Cr>Er&&Cr>=lt){let Nr,vi=Vt*Er,Ai=wr*Er,tn=-1;const ki=((Kt/qt|0)<<5)+(Ce+1)+this.points.length;for(const jn of Or){const zi=jn*qt;if(rt[zi+2]<=Ce)continue;rt[zi+2]=Ce;const ln=rt[zi+Ht];vi+=rt[zi]*ln,Ai+=rt[zi+1]*ln,rt[zi+4]=ki,it&&(Nr||(Nr=this._map(rt,Kt,!0),tn=this.clusterProps.length,this.clusterProps.push(Nr)),it(Nr,this._map(rt,zi)))}rt[Kt+4]=ki,gt.push(vi/Cr,Ai/Cr,1/0,ki,-1,Cr),it&&gt.push(tn)}else{for(let Nr=0;Nr<qt;Nr++)gt.push(rt[Kt+Nr]);if(Cr>1)for(const Nr of Or){const vi=Nr*qt;if(!(rt[vi+2]<=Ce)){rt[vi+2]=Ce;for(let Ai=0;Ai<qt;Ai++)gt.push(rt[vi+Ai])}}}}return gt}_getOriginId(Oe){return Oe-this.points.length>>5}_getOriginZoom(Oe){return(Oe-this.points.length)%32}_map(Oe,Ce,qe){if(Oe[Ce+Ht]>1){const lt=this.clusterProps[Oe[Ce+ar]];return qe?Object.assign({},lt):lt}const Je=this.points[Oe[Ce+It]].properties,it=this.options.map(Je);return qe&&it===Je?Object.assign({},it):it}}function Fr(Ke,Oe,Ce){return{type:"Feature",id:Ke[Oe+It],properties:si(Ke,Oe,Ce),geometry:{type:"Point",coordinates:[(qe=Ke[Oe],360*(qe-.5)),wn(Ke[Oe+1])]}};var qe}function si(Ke,Oe,Ce){const qe=Ke[Oe+Ht],Je=qe>=1e4?`${Math.round(qe/1e3)}k`:qe>=1e3?Math.round(qe/100)/10+"k":qe,it=Ke[Oe+ar],lt=it===-1?{}:Object.assign({},Ce[it]);return Object.assign(lt,{cluster:!0,cluster_id:Ke[Oe+It],point_count:qe,point_count_abbreviated:Je})}function xi(Ke){return Ke/360+.5}function Xr(Ke){const Oe=Math.sin(Ke*Math.PI/180),Ce=.5-.25*Math.log((1+Oe)/(1-Oe))/Math.PI;return Ce<0?0:Ce>1?1:Ce}function wn(Ke){const Oe=(180-360*Ke)*Math.PI/180;return 360*Math.atan(Math.exp(Oe))/Math.PI-90}function Yi(Ke,Oe,Ce,qe){for(var Je,it=qe,lt=Ce-Oe>>1,st=Ce-Oe,rt=Ke[Oe],gt=Ke[Oe+1],qt=Ke[Ce],Kt=Ke[Ce+1],Vt=Oe+3;Vt<Ce;Vt+=3){var wr=Ji(Ke[Vt],Ke[Vt+1],rt,gt,qt,Kt);if(wr>it)Je=Vt,it=wr;else if(wr===it){var Or=Math.abs(Vt-lt);Or<st&&(Je=Vt,st=Or)}}it>qe&&(Je-Oe>3&&Yi(Ke,Oe,Je,qe),Ke[Je+2]=it,Ce-Je>3&&Yi(Ke,Je,Ce,qe))}function Ji(Ke,Oe,Ce,qe,Je,it){var lt=Je-Ce,st=it-qe;if(lt!==0||st!==0){var rt=((Ke-Ce)*lt+(Oe-qe)*st)/(lt*lt+st*st);rt>1?(Ce=Je,qe=it):rt>0&&(Ce+=lt*rt,qe+=st*rt)}return(lt=Ke-Ce)*lt+(st=Oe-qe)*st}function Rr(Ke,Oe,Ce,qe){var Je={id:Ke===void 0?null:Ke,type:Oe,geometry:Ce,tags:qe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(it){var lt=it.geometry,st=it.type;if(st==="Point"||st==="MultiPoint"||st==="LineString")vn(it,lt);else if(st==="Polygon"||st==="MultiLineString")for(var rt=0;rt<lt.length;rt++)vn(it,lt[rt]);else if(st==="MultiPolygon")for(rt=0;rt<lt.length;rt++)for(var gt=0;gt<lt[rt].length;gt++)vn(it,lt[rt][gt])}(Je),Je}function vn(Ke,Oe){for(var Ce=0;Ce<Oe.length;Ce+=3)Ke.minX=Math.min(Ke.minX,Oe[Ce]),Ke.minY=Math.min(Ke.minY,Oe[Ce+1]),Ke.maxX=Math.max(Ke.maxX,Oe[Ce]),Ke.maxY=Math.max(Ke.maxY,Oe[Ce+1])}function Fi(Ke,Oe,Ce,qe){if(Oe.geometry){var Je=Oe.geometry.coordinates,it=Oe.geometry.type,lt=Math.pow(Ce.tolerance/((1<<Ce.maxZoom)*Ce.extent),2),st=[],rt=Oe.id;if(Ce.promoteId?rt=Oe.properties[Ce.promoteId]:Ce.generateId&&(rt=qe||0),it==="Point")Ro(Je,st);else if(it==="MultiPoint")for(var gt=0;gt<Je.length;gt++)Ro(Je[gt],st);else if(it==="LineString")di(Je,st,lt,!1);else if(it==="MultiLineString"){if(Ce.lineMetrics){for(gt=0;gt<Je.length;gt++)di(Je[gt],st=[],lt,!1),Ke.push(Rr(rt,"LineString",st,Oe.properties));return}Qi(Je,st,lt,!1)}else if(it==="Polygon")Qi(Je,st,lt,!0);else{if(it!=="MultiPolygon"){if(it==="GeometryCollection"){for(gt=0;gt<Oe.geometry.geometries.length;gt++)Fi(Ke,{id:rt,geometry:Oe.geometry.geometries[gt],properties:Oe.properties},Ce,qe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(gt=0;gt<Je.length;gt++){var qt=[];Qi(Je[gt],qt,lt,!0),st.push(qt)}}Ke.push(Rr(rt,it,st,Oe.properties))}}function Ro(Ke,Oe){Oe.push(Yo(Ke[0])),Oe.push(Mn(Ke[1])),Oe.push(0)}function di(Ke,Oe,Ce,qe){for(var Je,it,lt=0,st=0;st<Ke.length;st++){var rt=Yo(Ke[st][0]),gt=Mn(Ke[st][1]);Oe.push(rt),Oe.push(gt),Oe.push(0),st>0&&(lt+=qe?(Je*gt-rt*it)/2:Math.sqrt(Math.pow(rt-Je,2)+Math.pow(gt-it,2))),Je=rt,it=gt}var qt=Oe.length-3;Oe[2]=1,Yi(Oe,0,qt,Ce),Oe[qt+2]=1,Oe.size=Math.abs(lt),Oe.start=0,Oe.end=Oe.size}function Qi(Ke,Oe,Ce,qe){for(var Je=0;Je<Ke.length;Je++){var it=[];di(Ke[Je],it,Ce,qe),Oe.push(it)}}function Yo(Ke){return Ke/360+.5}function Mn(Ke){var Oe=Math.sin(Ke*Math.PI/180),Ce=.5-.25*Math.log((1+Oe)/(1-Oe))/Math.PI;return Ce<0?0:Ce>1?1:Ce}function en(Ke,Oe,Ce,qe,Je,it,lt,st){if(qe/=Oe,it>=(Ce/=Oe)&&lt<qe)return Ke;if(lt<Ce||it>=qe)return null;for(var rt=[],gt=0;gt<Ke.length;gt++){var qt=Ke[gt],Kt=qt.geometry,Vt=qt.type,wr=Je===0?qt.minX:qt.minY,Or=Je===0?qt.maxX:qt.maxY;if(wr>=Ce&&Or<qe)rt.push(qt);else if(!(Or<Ce||wr>=qe)){var Er=[];if(Vt==="Point"||Vt==="MultiPoint")zn(Kt,Er,Ce,qe,Je);else if(Vt==="LineString")Hi(Kt,Er,Ce,qe,Je,!1,st.lineMetrics);else if(Vt==="MultiLineString")Un(Kt,Er,Ce,qe,Je,!1);else if(Vt==="Polygon")Un(Kt,Er,Ce,qe,Je,!0);else if(Vt==="MultiPolygon")for(var Cr=0;Cr<Kt.length;Cr++){var Nr=[];Un(Kt[Cr],Nr,Ce,qe,Je,!0),Nr.length&&Er.push(Nr)}if(Er.length){if(st.lineMetrics&&Vt==="LineString"){for(Cr=0;Cr<Er.length;Cr++)rt.push(Rr(qt.id,Vt,Er[Cr],qt.tags));continue}Vt!=="LineString"&&Vt!=="MultiLineString"||(Er.length===1?(Vt="LineString",Er=Er[0]):Vt="MultiLineString"),Vt!=="Point"&&Vt!=="MultiPoint"||(Vt=Er.length===3?"Point":"MultiPoint"),rt.push(Rr(qt.id,Vt,Er,qt.tags))}}}return rt.length?rt:null}function zn(Ke,Oe,Ce,qe,Je){for(var it=0;it<Ke.length;it+=3){var lt=Ke[it+Je];lt>=Ce&&lt<=qe&&(Oe.push(Ke[it]),Oe.push(Ke[it+1]),Oe.push(Ke[it+2]))}}function Hi(Ke,Oe,Ce,qe,Je,it,lt){for(var st,rt,gt=Qn(Ke),qt=Je===0?Jo:Me,Kt=Ke.start,Vt=0;Vt<Ke.length-3;Vt+=3){var wr=Ke[Vt],Or=Ke[Vt+1],Er=Ke[Vt+2],Cr=Ke[Vt+3],Nr=Ke[Vt+4],vi=Je===0?wr:Or,Ai=Je===0?Cr:Nr,tn=!1;lt&&(st=Math.sqrt(Math.pow(wr-Cr,2)+Math.pow(Or-Nr,2))),vi<Ce?Ai>Ce&&(rt=qt(gt,wr,Or,Cr,Nr,Ce),lt&&(gt.start=Kt+st*rt)):vi>qe?Ai<qe&&(rt=qt(gt,wr,Or,Cr,Nr,qe),lt&&(gt.start=Kt+st*rt)):sn(gt,wr,Or,Er),Ai<Ce&&vi>=Ce&&(rt=qt(gt,wr,Or,Cr,Nr,Ce),tn=!0),Ai>qe&&vi<=qe&&(rt=qt(gt,wr,Or,Cr,Nr,qe),tn=!0),!it&&tn&&(lt&&(gt.end=Kt+st*rt),Oe.push(gt),gt=Qn(Ke)),lt&&(Kt+=st)}var ki=Ke.length-3;wr=Ke[ki],Or=Ke[ki+1],Er=Ke[ki+2],(vi=Je===0?wr:Or)>=Ce&&vi<=qe&&sn(gt,wr,Or,Er),ki=gt.length-3,it&&ki>=3&&(gt[ki]!==gt[0]||gt[ki+1]!==gt[1])&&sn(gt,gt[0],gt[1],gt[2]),gt.length&&Oe.push(gt)}function Qn(Ke){var Oe=[];return Oe.size=Ke.size,Oe.start=Ke.start,Oe.end=Ke.end,Oe}function Un(Ke,Oe,Ce,qe,Je,it){for(var lt=0;lt<Ke.length;lt++)Hi(Ke[lt],Oe,Ce,qe,Je,it,!1)}function sn(Ke,Oe,Ce,qe){Ke.push(Oe),Ke.push(Ce),Ke.push(qe)}function Jo(Ke,Oe,Ce,qe,Je,it){var lt=(it-Oe)/(qe-Oe);return Ke.push(it),Ke.push(Ce+(Je-Ce)*lt),Ke.push(1),lt}function Me(Ke,Oe,Ce,qe,Je,it){var lt=(it-Ce)/(Je-Ce);return Ke.push(Oe+(qe-Oe)*lt),Ke.push(it),Ke.push(1),lt}function $e(Ke,Oe){for(var Ce=[],qe=0;qe<Ke.length;qe++){var Je,it=Ke[qe],lt=it.type;if(lt==="Point"||lt==="MultiPoint"||lt==="LineString")Je=be(it.geometry,Oe);else if(lt==="MultiLineString"||lt==="Polygon"){Je=[];for(var st=0;st<it.geometry.length;st++)Je.push(be(it.geometry[st],Oe))}else if(lt==="MultiPolygon")for(Je=[],st=0;st<it.geometry.length;st++){for(var rt=[],gt=0;gt<it.geometry[st].length;gt++)rt.push(be(it.geometry[st][gt],Oe));Je.push(rt)}Ce.push(Rr(it.id,lt,Je,it.tags))}return Ce}function be(Ke,Oe){var Ce=[];Ce.size=Ke.size,Ke.start!==void 0&&(Ce.start=Ke.start,Ce.end=Ke.end);for(var qe=0;qe<Ke.length;qe+=3)Ce.push(Ke[qe]+Oe,Ke[qe+1],Ke[qe+2]);return Ce}function We(Ke,Oe){if(Ke.transformed)return Ke;var Ce,qe,Je,it=1<<Ke.z,lt=Ke.x,st=Ke.y;for(Ce=0;Ce<Ke.features.length;Ce++){var rt=Ke.features[Ce],gt=rt.geometry,qt=rt.type;if(rt.geometry=[],qt===1)for(qe=0;qe<gt.length;qe+=2)rt.geometry.push(ot(gt[qe],gt[qe+1],Oe,it,lt,st));else for(qe=0;qe<gt.length;qe++){var Kt=[];for(Je=0;Je<gt[qe].length;Je+=2)Kt.push(ot(gt[qe][Je],gt[qe][Je+1],Oe,it,lt,st));rt.geometry.push(Kt)}}return Ke.transformed=!0,Ke}function ot(Ke,Oe,Ce,qe,Je,it){return[Math.round(Ce*(Ke*qe-Je)),Math.round(Ce*(Oe*qe-it))]}function vt(Ke,Oe,Ce,qe,Je){for(var it=Oe===Je.maxZoom?0:Je.tolerance/((1<<Oe)*Je.extent),lt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ce,y:qe,z:Oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},st=0;st<Ke.length;st++){lt.numFeatures++,Dt(lt,Ke[st],it,Je);var rt=Ke[st].minX,gt=Ke[st].minY,qt=Ke[st].maxX,Kt=Ke[st].maxY;rt<lt.minX&&(lt.minX=rt),gt<lt.minY&&(lt.minY=gt),qt>lt.maxX&&(lt.maxX=qt),Kt>lt.maxY&&(lt.maxY=Kt)}return lt}function Dt(Ke,Oe,Ce,qe){var Je=Oe.geometry,it=Oe.type,lt=[];if(it==="Point"||it==="MultiPoint")for(var st=0;st<Je.length;st+=3)lt.push(Je[st]),lt.push(Je[st+1]),Ke.numPoints++,Ke.numSimplified++;else if(it==="LineString")Ar(lt,Je,Ke,Ce,!1,!1);else if(it==="MultiLineString"||it==="Polygon")for(st=0;st<Je.length;st++)Ar(lt,Je[st],Ke,Ce,it==="Polygon",st===0);else if(it==="MultiPolygon")for(var rt=0;rt<Je.length;rt++){var gt=Je[rt];for(st=0;st<gt.length;st++)Ar(lt,gt[st],Ke,Ce,!0,st===0)}if(lt.length){var qt=Oe.tags||null;if(it==="LineString"&&qe.lineMetrics){for(var Kt in qt={},Oe.tags)qt[Kt]=Oe.tags[Kt];qt.mapbox_clip_start=Je.start/Je.size,qt.mapbox_clip_end=Je.end/Je.size}var Vt={geometry:lt,type:it==="Polygon"||it==="MultiPolygon"?3:it==="LineString"||it==="MultiLineString"?2:1,tags:qt};Oe.id!==null&&(Vt.id=Oe.id),Ke.features.push(Vt)}}function Ar(Ke,Oe,Ce,qe,Je,it){var lt=qe*qe;if(qe>0&&Oe.size<(Je?lt:qe))Ce.numPoints+=Oe.length/3;else{for(var st=[],rt=0;rt<Oe.length;rt+=3)(qe===0||Oe[rt+2]>lt)&&(Ce.numSimplified++,st.push(Oe[rt]),st.push(Oe[rt+1])),Ce.numPoints++;Je&&function(gt,qt){for(var Kt=0,Vt=0,wr=gt.length,Or=wr-2;Vt<wr;Or=Vt,Vt+=2)Kt+=(gt[Vt]-gt[Or])*(gt[Vt+1]+gt[Or+1]);if(Kt>0===qt)for(Vt=0,wr=gt.length;Vt<wr/2;Vt+=2){var Er=gt[Vt],Cr=gt[Vt+1];gt[Vt]=gt[wr-2-Vt],gt[Vt+1]=gt[wr-1-Vt],gt[wr-2-Vt]=Er,gt[wr-1-Vt]=Cr}}(st,it),Ke.push(st)}}function Yr(Ke,Oe){var Ce=(Oe=this.options=function(Je,it){for(var lt in it)Je[lt]=it[lt];return Je}(Object.create(this.options),Oe)).debug;if(Ce&&console.time("preprocess data"),Oe.maxZoom<0||Oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Oe.promoteId&&Oe.generateId)throw new Error("promoteId and generateId cannot be used together.");var qe=function(Je,it){var lt=[];if(Je.type==="FeatureCollection")for(var st=0;st<Je.features.length;st++)Fi(lt,Je.features[st],it,st);else Fi(lt,Je.type==="Feature"?Je:{geometry:Je},it);return lt}(Ke,Oe);this.tiles={},this.tileCoords=[],Ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Oe.indexMaxZoom,Oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),qe=function(Je,it){var lt=it.buffer/it.extent,st=Je,rt=en(Je,1,-1-lt,lt,0,-1,2,it),gt=en(Je,1,1-lt,2+lt,0,-1,2,it);return(rt||gt)&&(st=en(Je,1,-lt,1+lt,0,-1,2,it)||[],rt&&(st=$e(rt,1).concat(st)),gt&&(st=st.concat($e(gt,-1)))),st}(qe,Oe),qe.length&&this.splitTile(qe,0,0,0),Ce&&(qe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Zr(Ke,Oe,Ce){return 32*((1<<Ke)*Ce+Oe)+Ke}function Jr(Ke,Oe){const Ce=Ke.tileID.canonical;if(!this._geoJSONIndex)return Oe(null,null);const qe=this._geoJSONIndex.getTile(Ce.z,Ce.x,Ce.y);if(!qe)return Oe(null,null);const Je=new class{constructor(lt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=H.EXTENT,this.length=lt.length,this._features=lt}feature(lt){return new class{constructor(st){this._feature=st,this.extent=H.EXTENT,this.type=st.type,this.properties=st.tags,"id"in st&&!isNaN(st.id)&&(this.id=parseInt(st.id,10))}loadGeometry(){if(this._feature.type===1){const st=[];for(const rt of this._feature.geometry)st.push([new H.Point(rt[0],rt[1])]);return st}{const st=[];for(const rt of this._feature.geometry){const gt=[];for(const qt of rt)gt.push(new H.Point(qt[0],qt[1]));st.push(gt)}return st}}toGeoJSON(st,rt,gt){return Ot.call(this,st,rt,gt)}}(this._features[lt])}}(qe.features);let it=xt(Je);it.byteOffset===0&&it.byteLength===it.buffer.byteLength||(it=new Uint8Array(it)),Oe(null,{vectorTile:Je,rawData:it.buffer})}Yr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Yr.prototype.splitTile=function(Ke,Oe,Ce,qe,Je,it,lt){for(var st=[Ke,Oe,Ce,qe],rt=this.options,gt=rt.debug;st.length;){qe=st.pop(),Ce=st.pop(),Oe=st.pop(),Ke=st.pop();var qt=1<<Oe,Kt=Zr(Oe,Ce,qe),Vt=this.tiles[Kt];if(!Vt&&(gt>1&&console.time("creation"),Vt=this.tiles[Kt]=vt(Ke,Oe,Ce,qe,rt),this.tileCoords.push({z:Oe,x:Ce,y:qe}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Oe,Ce,qe,Vt.numFeatures,Vt.numPoints,Vt.numSimplified),console.timeEnd("creation"));var wr="z"+Oe;this.stats[wr]=(this.stats[wr]||0)+1,this.total++}if(Vt.source=Ke,Je){if(Oe===rt.maxZoom||Oe===Je)continue;var Or=1<<Je-Oe;if(Ce!==Math.floor(it/Or)||qe!==Math.floor(lt/Or))continue}else if(Oe===rt.indexMaxZoom||Vt.numPoints<=rt.indexMaxPoints)continue;if(Vt.source=null,Ke.length!==0){gt>1&&console.time("clipping");var Er,Cr,Nr,vi,Ai,tn,ki=.5*rt.buffer/rt.extent,jn=.5-ki,zi=.5+ki,ln=1+ki;Er=Cr=Nr=vi=null,Ai=en(Ke,qt,Ce-ki,Ce+zi,0,Vt.minX,Vt.maxX,rt),tn=en(Ke,qt,Ce+jn,Ce+ln,0,Vt.minX,Vt.maxX,rt),Ke=null,Ai&&(Er=en(Ai,qt,qe-ki,qe+zi,1,Vt.minY,Vt.maxY,rt),Cr=en(Ai,qt,qe+jn,qe+ln,1,Vt.minY,Vt.maxY,rt),Ai=null),tn&&(Nr=en(tn,qt,qe-ki,qe+zi,1,Vt.minY,Vt.maxY,rt),vi=en(tn,qt,qe+jn,qe+ln,1,Vt.minY,Vt.maxY,rt),tn=null),gt>1&&console.timeEnd("clipping"),st.push(Er||[],Oe+1,2*Ce,2*qe),st.push(Cr||[],Oe+1,2*Ce,2*qe+1),st.push(Nr||[],Oe+1,2*Ce+1,2*qe),st.push(vi||[],Oe+1,2*Ce+1,2*qe+1)}}},Yr.prototype.getTile=function(Ke,Oe,Ce){var qe=this.options,Je=qe.extent,it=qe.debug;if(Ke<0||Ke>24)return null;var lt=1<<Ke,st=Zr(Ke,Oe=(Oe%lt+lt)%lt,Ce);if(this.tiles[st])return We(this.tiles[st],Je);it>1&&console.log("drilling down to z%d-%d-%d",Ke,Oe,Ce);for(var rt,gt=Ke,qt=Oe,Kt=Ce;!rt&&gt>0;)gt--,qt=Math.floor(qt/2),Kt=Math.floor(Kt/2),rt=this.tiles[Zr(gt,qt,Kt)];return rt&&rt.source?(it>1&&console.log("found parent tile z%d-%d-%d",gt,qt,Kt),it>1&&console.time("drilling down"),this.splitTile(rt.source,gt,qt,Kt,Ke,Oe,Ce),it>1&&console.timeEnd("drilling down"),this.tiles[st]?We(this.tiles[st],Je):null):null};class Wr extends H.VectorTileWorkerSource{constructor(Oe,Ce,qe,Je,it){super(Oe,Ce,qe,Je,Jr),it&&(this.loadGeoJSON=it)}loadData(Oe,Ce){const qe=Oe&&Oe.request,Je=qe&&qe.collectResourceTiming;this.loadGeoJSON(Oe,(it,lt)=>{if(it||!lt)return Ce(it);if(typeof lt!="object")return Ce(new Error(`Input data given to '${Oe.source}' is not a valid GeoJSON object.`));{wt(lt,!0);try{if(Oe.filter){const rt=H.createExpression(Oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(rt.result==="error")throw new Error(rt.value.map(qt=>`${qt.key}: ${qt.message}`).join(", "));lt={type:"FeatureCollection",features:lt.features.filter(qt=>rt.value.evaluate({zoom:0},qt))}}this._geoJSONIndex=Oe.cluster?new mr(function({superclusterOptions:rt,clusterProperties:gt}){if(!gt||!rt)return rt;const qt={},Kt={},Vt={accumulated:null,zoom:0},wr={properties:null},Or=Object.keys(gt);for(const Er of Or){const[Cr,Nr]=gt[Er],vi=H.createExpression(Nr),Ai=H.createExpression(typeof Cr=="string"?[Cr,["accumulated"],["get",Er]]:Cr);qt[Er]=vi.value,Kt[Er]=Ai.value}return rt.map=Er=>{wr.properties=Er;const Cr={};for(const Nr of Or)Cr[Nr]=qt[Nr].evaluate(Vt,wr);return Cr},rt.reduce=(Er,Cr)=>{wr.properties=Cr;for(const Nr of Or)Vt.accumulated=Er[Nr],Er[Nr]=Kt[Nr].evaluate(Vt,wr)},rt}(Oe)).load(lt.features):function(rt,gt){return new Yr(rt,gt)}(lt,Oe.geojsonVtOptions)}catch(rt){return Ce(rt)}this.loaded={};const st={};if(Je){const rt=H.getPerformanceMeasurement(qe);rt&&(st.resourceTiming={},st.resourceTiming[Oe.source]=JSON.parse(JSON.stringify(rt)))}Ce(null,st)}})}reloadTile(Oe,Ce){const qe=this.loaded;return qe&&qe[Oe.uid]?super.reloadTile(Oe,Ce):this.loadTile(Oe,Ce)}loadGeoJSON(Oe,Ce){if(Oe.request)H.getJSON(Oe.request,Ce);else{if(typeof Oe.data!="string")return Ce(new Error(`Input data given to '${Oe.source}' is not a valid GeoJSON object.`));try{return Ce(null,JSON.parse(Oe.data))}catch{return Ce(new Error(`Input data given to '${Oe.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Oe,Ce){try{Ce(null,this._geoJSONIndex.getClusterExpansionZoom(Oe.clusterId))}catch(qe){Ce(qe)}}getClusterChildren(Oe,Ce){try{Ce(null,this._geoJSONIndex.getChildren(Oe.clusterId))}catch(qe){Ce(qe)}}getClusterLeaves(Oe,Ce){try{Ce(null,this._geoJSONIndex.getLeaves(Oe.clusterId,Oe.limit,Oe.offset))}catch(qe){Ce(qe)}}}class gs{constructor(Oe){this.self=Oe,this.actor=new H.Actor(Oe,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=H.getProjection({name:"mercator"}),this.workerSourceTypes={vector:H.VectorTileWorkerSource,geojson:Wr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Ce,qe)=>{if(this.workerSourceTypes[Ce])throw new Error(`Worker source with name "${Ce}" already registered.`);this.workerSourceTypes[Ce]=qe},this.self.registerRTLTextPlugin=Ce=>{if(H.plugin.isParsed())throw new Error("RTL text plugin already registered.");H.plugin.applyArabicShaping=Ce.applyArabicShaping,H.plugin.processBidirectionalText=Ce.processBidirectionalText,H.plugin.processStyledBidirectionalText=Ce.processStyledBidirectionalText}}clearCaches(Oe,Ce,qe){delete this.layerIndexes[Oe],delete this.availableImages[Oe],delete this.workerSources[Oe],delete this.demWorkerSources[Oe],qe()}checkIfReady(Oe,Ce,qe){qe()}setReferrer(Oe,Ce){this.referrer=Ce}spriteLoaded(Oe,Ce){this.isSpriteLoaded[Oe]=Ce;for(const qe in this.workerSources[Oe]){const Je=this.workerSources[Oe][qe];for(const it in Je)Je[it]instanceof H.VectorTileWorkerSource&&(Je[it].isSpriteLoaded=Ce,Je[it].fire(new H.Event("isSpriteLoaded")))}}setImages(Oe,Ce,qe){this.availableImages[Oe]=Ce;for(const Je in this.workerSources[Oe]){const it=this.workerSources[Oe][Je];for(const lt in it)it[lt].availableImages=Ce}qe()}enableTerrain(Oe,Ce,qe){this.terrain=Ce,qe()}setProjection(Oe,Ce){this.projections[Oe]=H.getProjection(Ce)}setLayers(Oe,Ce,qe){this.getLayerIndex(Oe).replace(Ce),qe()}updateLayers(Oe,Ce,qe){this.getLayerIndex(Oe).update(Ce.layers,Ce.removedIds),qe()}loadTile(Oe,Ce,qe){const Je=this.enableTerrain?H.extend({enableTerrain:this.terrain},Ce):Ce;Je.projection=this.projections[Oe]||this.defaultProjection,this.getWorkerSource(Oe,Ce.type,Ce.source).loadTile(Je,qe)}loadDEMTile(Oe,Ce,qe){const Je=this.enableTerrain?H.extend({buildQuadTree:this.terrain},Ce):Ce;this.getDEMWorkerSource(Oe,Ce.source).loadTile(Je,qe)}reloadTile(Oe,Ce,qe){const Je=this.enableTerrain?H.extend({enableTerrain:this.terrain},Ce):Ce;Je.projection=this.projections[Oe]||this.defaultProjection,this.getWorkerSource(Oe,Ce.type,Ce.source).reloadTile(Je,qe)}abortTile(Oe,Ce,qe){this.getWorkerSource(Oe,Ce.type,Ce.source).abortTile(Ce,qe)}removeTile(Oe,Ce,qe){this.getWorkerSource(Oe,Ce.type,Ce.source).removeTile(Ce,qe)}removeSource(Oe,Ce,qe){if(!this.workerSources[Oe]||!this.workerSources[Oe][Ce.type]||!this.workerSources[Oe][Ce.type][Ce.source])return;const Je=this.workerSources[Oe][Ce.type][Ce.source];delete this.workerSources[Oe][Ce.type][Ce.source],Je.removeSource!==void 0?Je.removeSource(Ce,qe):qe()}loadWorkerSource(Oe,Ce,qe){try{this.self.importScripts(Ce.url),qe()}catch(Je){qe(Je.toString())}}syncRTLPluginState(Oe,Ce,qe){try{H.plugin.setState(Ce);const Je=H.plugin.getPluginURL();if(H.plugin.isLoaded()&&!H.plugin.isParsed()&&Je!=null){this.self.importScripts(Je);const it=H.plugin.isParsed();qe(it?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Je}`),it)}}catch(Je){qe(Je.toString())}}getAvailableImages(Oe){let Ce=this.availableImages[Oe];return Ce||(Ce=[]),Ce}getLayerIndex(Oe){let Ce=this.layerIndexes[Oe];return Ce||(Ce=this.layerIndexes[Oe]=new Ee),Ce}getWorkerSource(Oe,Ce,qe){if(this.workerSources[Oe]||(this.workerSources[Oe]={}),this.workerSources[Oe][Ce]||(this.workerSources[Oe][Ce]={}),!this.workerSources[Oe][Ce][qe]){const Je={send:(it,lt,st,rt,gt,qt)=>{this.actor.send(it,lt,st,Oe,gt,qt)},scheduler:this.actor.scheduler};this.workerSources[Oe][Ce][qe]=new this.workerSourceTypes[Ce](Je,this.getLayerIndex(Oe),this.getAvailableImages(Oe),this.isSpriteLoaded[Oe])}return this.workerSources[Oe][Ce][qe]}getDEMWorkerSource(Oe,Ce){return this.demWorkerSources[Oe]||(this.demWorkerSources[Oe]={}),this.demWorkerSources[Oe][Ce]||(this.demWorkerSources[Oe][Ce]=new Fe),this.demWorkerSources[Oe][Ce]}enforceCacheSizeLimit(Oe,Ce){H.enforceCacheSizeLimit(Ce)}getWorkerPerformanceMetrics(Oe,Ce,qe){qe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new gs(self)),gs}),se(["./shared"],function(H){function ye(Q,U){if(Array.isArray(Q)){if(!Array.isArray(U)||Q.length!==U.length)return!1;for(let Y=0;Y<Q.length;Y++)if(!ye(Q[Y],U[Y]))return!1;return!0}if(typeof Q=="object"&&Q!==null&&U!==null){if(typeof U!="object"||Object.keys(Q).length!==Object.keys(U).length)return!1;for(const Y in Q)if(!ye(Q[Y],U[Y]))return!1;return!0}return Q===U}var Ie=Ee;function Ee(Q){return!function(U){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var te,ne,ae=new Blob([""],{type:"text/javascript"}),he=URL.createObjectURL(ae);try{ne=new Worker(he),te=!0}catch{te=!1}return ne&&ne.terminate(),URL.revokeObjectURL(he),te}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var te=document.createElement("canvas");te.width=te.height=1;var ne=te.getContext("2d");if(!ne)return!1;var ae=ne.getImageData(0,0,1,1);return ae&&ae.width===te.width}()?(Fe[Y=U&&U.failIfMajorPerformanceCaveat]===void 0&&(Fe[Y]=function(te){var ne,ae=function(he){var fe=document.createElement("canvas"),de=Object.create(Ee.webGLContextAttributes);return de.failIfMajorPerformanceCaveat=he,fe.getContext("webgl",de)||fe.getContext("experimental-webgl",de)}(te);if(!ae)return!1;try{ne=ae.createShader(ae.VERTEX_SHADER)}catch{return!1}return!(!ne||ae.isContextLost())&&(ae.shaderSource(ne,"void main() {}"),ae.compileShader(ne),ae.getShaderParameter(ne,ae.COMPILE_STATUS)===!0)}(Y)),Fe[Y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var Y}(Q)}var Fe={};function je(Q,U,Y){const te=H.window.document.createElement(Q);return U!==void 0&&(te.className=U),Y&&Y.appendChild(te),te}function mt(Q,U,Y){const te=H.window.document.createElementNS("http://www.w3.org/2000/svg",Q);for(const ne of Object.keys(U))te.setAttributeNS(null,ne,U[ne]);return Y&&Y.appendChild(te),te}Ee.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const wt=H.window.document&&H.window.document.documentElement.style,Ot=wt&&wt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let $t;function jt(){wt&&Ot&&($t=wt[Ot],wt[Ot]="none")}function nr(){wt&&Ot&&(wt[Ot]=$t)}function sr(Q){Q.preventDefault(),Q.stopPropagation(),H.window.removeEventListener("click",sr,!0)}function gr(){H.window.addEventListener("click",sr,!0),H.window.setTimeout(()=>{H.window.removeEventListener("click",sr,!0)},0)}function hr(Q,U){const Y=Q.getBoundingClientRect();return yr(Q,Y,U)}function Ir(Q,U){const Y=Q.getBoundingClientRect(),te=[];for(let ne=0;ne<U.length;ne++)te.push(yr(Q,Y,U[ne]));return te}function br(Q){return H.window.InstallTrigger!==void 0&&Q.button===2&&Q.ctrlKey&&H.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:Q.button}function yr(Q,U,Y){const te=Q.offsetWidth===U.width?1:Q.offsetWidth/U.width;return new H.Point((Y.clientX-U.left)*te,(Y.clientY-U.top)*te)}function zt(Q,U){var Y=U[0],te=U[1],ne=U[2],ae=U[3],he=Y*ae-ne*te;return he?(Q[0]=ae*(he=1/he),Q[1]=-te*he,Q[2]=-ne*he,Q[3]=Y*he,Q):null}function gi(Q){const{userImage:U}=Q;return!!(U&&U.render&&U.render())&&(Q.data.replace(new Uint8Array(U.data.buffer)),!0)}class Ti extends H.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new H.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(U){if(this.loaded!==U&&(this.loaded=U,U)){for(const{ids:Y,callback:te}of this.requestors)this._notify(Y,te);this.requestors=[]}}hasImage(U){return!!this.getImage(U)}getImage(U){return this.images[U]}addImage(U,Y){this._validate(U,Y)&&(this.images[U]=Y)}_validate(U,Y){let te=!0;return this._validateStretch(Y.stretchX,Y.data&&Y.data.width)||(this.fire(new H.ErrorEvent(new Error(`Image "${U}" has invalid "stretchX" value`))),te=!1),this._validateStretch(Y.stretchY,Y.data&&Y.data.height)||(this.fire(new H.ErrorEvent(new Error(`Image "${U}" has invalid "stretchY" value`))),te=!1),this._validateContent(Y.content,Y)||(this.fire(new H.ErrorEvent(new Error(`Image "${U}" has invalid "content" value`))),te=!1),te}_validateStretch(U,Y){if(!U)return!0;let te=0;for(const ne of U){if(ne[0]<te||ne[1]<ne[0]||Y<ne[1])return!1;te=ne[1]}return!0}_validateContent(U,Y){return!(U&&(U.length!==4||U[0]<0||Y.data.width<U[0]||U[1]<0||Y.data.height<U[1]||U[2]<0||Y.data.width<U[2]||U[3]<0||Y.data.height<U[3]||U[2]<U[0]||U[3]<U[1]))}updateImage(U,Y){Y.version=this.images[U].version+1,this.images[U]=Y,this.updatedImages[U]=!0}removeImage(U){const Y=this.images[U];delete this.images[U],delete this.patterns[U],Y.userImage&&Y.userImage.onRemove&&Y.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(U,Y){let te=!0;if(!this.isLoaded())for(const ne of U)this.images[ne]||(te=!1);this.isLoaded()||te?this._notify(U,Y):this.requestors.push({ids:U,callback:Y})}_notify(U,Y){const te={};for(const ne of U){this.images[ne]||this.fire(new H.Event("styleimagemissing",{id:ne}));const ae=this.images[ne];ae?te[ne]={data:ae.data.clone(),pixelRatio:ae.pixelRatio,sdf:ae.sdf,version:ae.version,stretchX:ae.stretchX,stretchY:ae.stretchY,content:ae.content,hasRenderCallback:!!(ae.userImage&&ae.userImage.render)}:H.warnOnce(`Image "${ne}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}Y(null,te)}getPixelSize(){const{width:U,height:Y}=this.atlasImage;return{width:U,height:Y}}getPattern(U){const Y=this.patterns[U],te=this.getImage(U);if(!te)return null;if(Y&&Y.position.version===te.version)return Y.position;if(Y)Y.position.version=te.version;else{const ne={w:te.data.width+2,h:te.data.height+2,x:0,y:0},ae=new H.ImagePosition(ne,te);this.patterns[U]={bin:ne,position:ae}}return this._updatePatternAtlas(),this.patterns[U].position}bind(U){const Y=U.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new H.Texture(U,this.atlasImage,Y.RGBA),this.atlasTexture&&this.atlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)}_updatePatternAtlas(){const U=[];for(const ae in this.patterns)U.push(this.patterns[ae].bin);const{w:Y,h:te}=H.potpack(U),ne=this.atlasImage;ne.resize({width:Y||1,height:te||1});for(const ae in this.patterns){const{bin:he}=this.patterns[ae],fe=he.x+1,de=he.y+1,ve=this.images[ae].data,ge=ve.width,Te=ve.height;H.RGBAImage.copy(ve,ne,{x:0,y:0},{x:fe,y:de},{width:ge,height:Te}),H.RGBAImage.copy(ve,ne,{x:0,y:Te-1},{x:fe,y:de-1},{width:ge,height:1}),H.RGBAImage.copy(ve,ne,{x:0,y:0},{x:fe,y:de+Te},{width:ge,height:1}),H.RGBAImage.copy(ve,ne,{x:ge-1,y:0},{x:fe-1,y:de},{width:1,height:Te}),H.RGBAImage.copy(ve,ne,{x:0,y:0},{x:fe+ge,y:de},{width:1,height:Te})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(U){for(const Y of U){if(this.callbackDispatchedThisFrame[Y])continue;this.callbackDispatchedThisFrame[Y]=!0;const te=this.images[Y];gi(te)&&this.updateImage(Y,te)}}}const dr=new H.Properties({anchor:new H.DataConstantProperty(H.spec.light.anchor),position:new class{constructor(){this.specification=H.spec.light.position}possiblyEvaluate(Q,U){return function([Y,te,ne]){const ae=H.degToRad(te+90),he=H.degToRad(ne);return{x:Y*Math.cos(ae)*Math.sin(he),y:Y*Math.sin(ae)*Math.sin(he),z:Y*Math.cos(he),azimuthal:te,polar:ne}}(Q.expression.evaluate(U))}interpolate(Q,U,Y){return{x:H.number(Q.x,U.x,Y),y:H.number(Q.y,U.y,Y),z:H.number(Q.z,U.z,Y),azimuthal:H.number(Q.azimuthal,U.azimuthal,Y),polar:H.number(Q.polar,U.polar,Y)}}},color:new H.DataConstantProperty(H.spec.light.color),intensity:new H.DataConstantProperty(H.spec.light.intensity)});class kr extends H.Evented{constructor(U){super(),this._transitionable=new H.Transitionable(dr),this.setLight(U),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(U,Y={}){if(!this._validate(H.validateLight,U,Y))for(const te in U){const ne=U[te];H.endsWith(te,"-transition")?this._transitionable.setTransition(te.slice(0,-11),ne):this._transitionable.setValue(te,ne)}}updateTransitions(U){this._transitioning=this._transitionable.transitioned(U,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(U){this.properties=this._transitioning.possiblyEvaluate(U)}_validate(U,Y,te){return(!te||te.validate!==!1)&&H.emitValidationErrors(this,U.call(H.validateStyle,H.extend({value:Y,style:{glyphs:!0,sprite:!0},styleSpec:H.spec})))}}const un=new H.Properties({source:new H.DataConstantProperty(H.spec.terrain.source),exaggeration:new H.DataConstantProperty(H.spec.terrain.exaggeration)});let qi=class extends H.Evented{constructor(Q,U){super(),this._transitionable=new H.Transitionable(un),this.set(Q),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=U}get(){return this._transitionable.serialize()}set(Q){for(const U in Q){const Y=Q[U];H.endsWith(U,"-transition")?this._transitionable.setTransition(U.slice(0,-11),Y):this._transitionable.setValue(U,Y)}}updateTransitions(Q){this._transitioning=this._transitionable.transitioned(Q,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(Q){this.properties=this._transitioning.possiblyEvaluate(Q)}};function xt(Q,U,Y,te){const ne=H.smoothstep(45,65,Y),[ae,he]=Zt(Q,te),fe=H.length(U);let de=1-Math.min(1,Math.exp((fe-ae)/(he-ae)*-6));return de*=de*de,de=Math.min(1,1.00747*de),de*ne*Q.alpha}function Zt(Q,U){const Y=.5/Math.tan(.5*U);return[Q.range[0]+Y,Q.range[1]+Y]}const ht=new H.Properties({range:new H.DataConstantProperty(H.spec.fog.range),color:new H.DataConstantProperty(H.spec.fog.color),"high-color":new H.DataConstantProperty(H.spec.fog["high-color"]),"space-color":new H.DataConstantProperty(H.spec.fog["space-color"]),"horizon-blend":new H.DataConstantProperty(H.spec.fog["horizon-blend"]),"star-intensity":new H.DataConstantProperty(H.spec.fog["star-intensity"])});class Rt extends H.Evented{constructor(U,Y){super(),this._transitionable=new H.Transitionable(ht),this.set(U),this._transitioning=this._transitionable.untransitioned(),this._transform=Y}get state(){const U=this._transform,Y=U.projection.name==="globe",te=H.globeToMercatorTransition(U.zoom),ne=this.properties.get("range"),ae=[.5,3];return{range:Y?[H.number(ae[0],ne[0],te),H.number(ae[1],ne[1],te)]:ne,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(U,Y={}){if(!this._validate(H.validateFog,U,Y)){for(const te of Object.keys(H.spec.fog))U&&U[te]===void 0&&(U[te]=H.spec.fog[te].default);for(const te in U){const ne=U[te];H.endsWith(te,"-transition")?this._transitionable.setTransition(te.slice(0,-11),ne):this._transitionable.setValue(te,ne)}}}getOpacity(U){if(!this._transform.projection.supportsFog)return 0;const Y=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:H.smoothstep(45,65,U))*Y.a}getOpacityAtLatLng(U,Y){return this._transform.projection.supportsFog?function(te,ne,ae){const he=H.MercatorCoordinate.fromLngLat(ne),fe=ae.elevation?ae.elevation.getAtPointOrZero(he):0,de=[he.x,he.y,fe];return H.transformMat4(de,de,ae.mercatorFogMatrix),xt(te,de,ae.pitch,ae._fov)}(this.state,U,Y):0}getFovAdjustedRange(U){return this._transform.projection.supportsFog?Zt(this.state,U):[0,1]}updateTransitions(U){this._transitioning=this._transitionable.transitioned(U,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(U){this.properties=this._transitioning.possiblyEvaluate(U)}_validate(U,Y,te){return(!te||te.validate!==!1)&&H.emitValidationErrors(this,U.call(H.validateStyle,H.extend({value:Y,style:{glyphs:!0,sprite:!0},styleSpec:H.spec})))}}class It{constructor(U,Y){this.workerPool=U,this.actors=[],this.currentActor=0,this.id=H.uniqueId();const te=this.workerPool.acquire(this.id);for(let ne=0;ne<te.length;ne++){const ae=new It.Actor(te[ne],Y,this.id);ae.name=`Worker ${ne}`,this.actors.push(ae)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(U,Y,te){H.asyncAll(this.actors,(ne,ae)=>{ne.send(U,Y,ae)},te=te||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(U=>{U.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ht(Q,U,Y){return U*(H.EXTENT/(Q.tileSize*Math.pow(2,Y-Q.tileID.overscaledZ)))}It.Actor=H.Actor;class ar{constructor(U,Y,te,ne){this.screenBounds=U,this.cameraPoint=Y,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=te,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,ne)}static createFromScreenPoints(U,Y){let te,ne;if(U instanceof H.Point||typeof U[0]=="number"){const ae=H.Point.convert(U);te=[ae],ne=Y.isPointAboveHorizon(ae)}else{const ae=H.Point.convert(U[0]),he=H.Point.convert(U[1]);te=[ae,he],ne=H.polygonizeBounds(ae,he).every(fe=>Y.isPointAboveHorizon(fe))}return new ar(te,Y.getCameraPoint(),ne,Y)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(U){return H.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],U)}bufferedCameraGeometry(U){const Y=this.screenBounds[0],te=this.screenBounds.length===1?this.screenBounds[0].add(new H.Point(1,1)):this.screenBounds[1],ne=H.polygonizeBounds(Y,te,0,!1);return this.cameraPoint.y>te.y&&(this.cameraPoint.x>Y.x&&this.cameraPoint.x<te.x?ne.splice(3,0,this.cameraPoint):this.cameraPoint.x>=te.x?ne[2]=this.cameraPoint:this.cameraPoint.x<=Y.x&&(ne[3]=this.cameraPoint)),H.bufferConvexPolygon(ne,U)}bufferedCameraGeometryGlobe(U){const Y=this.screenBounds[0],te=this.screenBounds.length===1?this.screenBounds[0].add(new H.Point(1,1)):this.screenBounds[1],ne=H.polygonizeBounds(Y,te,U),ae=this.cameraPoint.clone();switch(3*((ae.y>Y.y)+(ae.y>te.y))+((ae.x>Y.x)+(ae.x>te.x))){case 0:ne[0]=ae,ne[4]=ae.clone();break;case 1:ne.splice(1,0,ae);break;case 2:ne[1]=ae;break;case 3:ne.splice(4,0,ae);break;case 5:ne.splice(2,0,ae);break;case 6:ne[3]=ae;break;case 7:ne.splice(3,0,ae);break;case 8:ne[2]=ae}return ne}containsTile(U,Y,te,ne=0){const ae=U.queryPadding/Y._pixelsPerMercatorPixel+1,he=te?this._bufferedCameraMercator(ae,Y):this._bufferedScreenMercator(ae,Y);let fe=U.tileID.wrap+(he.unwrapped?ne:0);const de=he.polygon.map(Ne=>H.getTilePoint(U.tileTransform,Ne,fe));if(!H.polygonIntersectsBox(de,0,0,H.EXTENT,H.EXTENT))return;fe=U.tileID.wrap+(this.screenGeometryMercator.unwrapped?ne:0);const ve=this.screenGeometryMercator.polygon.map(Ne=>H.getTileVec3(U.tileTransform,Ne,fe)),ge=ve.map(Ne=>new H.Point(Ne[0],Ne[1])),Te=Y.getFreeCameraOptions().position||new H.MercatorCoordinate(0,0,0),Pe=H.getTileVec3(U.tileTransform,Te,fe),Le=ve.map(Ne=>{const Se=H.sub(Ne,Ne,Pe);return H.normalize(Se,Se),new H.Ray(Pe,Se)}),ke=Ht(U,1,Y.zoom)*Y._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:ge,tilespaceRays:Le,bufferedTilespaceGeometry:de,bufferedTilespaceBounds:(Be=H.getBounds(de),Be.min.x=H.clamp(Be.min.x,0,H.EXTENT),Be.min.y=H.clamp(Be.min.y,0,H.EXTENT),Be.max.x=H.clamp(Be.max.x,0,H.EXTENT),Be.max.y=H.clamp(Be.max.y,0,H.EXTENT),Be),tile:U,tileID:U.tileID,pixelToTileUnitsFactor:ke};var Be}_bufferedScreenMercator(U,Y){const te=si(U);if(this._screenRaycastCache[te])return this._screenRaycastCache[te];{let ne;return ne=Y.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(U),Y):{polygon:this.bufferedScreenGeometry(U).map(ae=>Y.pointCoordinate3D(ae)),unwrapped:!0},this._screenRaycastCache[te]=ne,ne}}_bufferedCameraMercator(U,Y){const te=si(U);if(this._cameraRaycastCache[te])return this._cameraRaycastCache[te];{let ne;return ne=Y.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(U),Y):{polygon:this.bufferedCameraGeometry(U).map(ae=>Y.pointCoordinate3D(ae)),unwrapped:!0},this._cameraRaycastCache[te]=ne,ne}}_projectAndResample(U,Y){const te=function(ae,he){const fe=H.multiply([],he.pixelMatrix,he.globeMatrix),de=[0,-H.GLOBE_RADIUS,0,1],ve=[0,H.GLOBE_RADIUS,0,1],ge=[0,0,0,1];H.transformMat4$1(de,de,fe),H.transformMat4$1(ve,ve,fe),H.transformMat4$1(ge,ge,fe);const Te=new H.Point(de[0]/de[3],de[1]/de[3]),Pe=new H.Point(ve[0]/ve[3],ve[1]/ve[3]),Le=H.polygonContainsPoint(ae,Te)&&de[3]<ge[3],ke=H.polygonContainsPoint(ae,Pe)&&ve[3]<ge[3];if(!Le&&!ke)return null;const Be=function(et,at,nt){for(let pt=1;pt<et.length;pt++){const kt=Fr(at.pointCoordinate3D(et[pt-1]).x),ct=Fr(at.pointCoordinate3D(et[pt]).x);if(nt<0){if(kt<ct)return{idx:pt,t:-kt/(ct-1-kt)}}else if(ct<kt)return{idx:pt,t:(1-kt)/(ct+1-kt)}}return null}(ae,he,Le?-1:1);if(!Be)return null;const{idx:Ne,t:Se}=Be;let De=Ne>1?mr(ae.slice(0,Ne),he):[],Ve=Ne<ae.length?mr(ae.slice(Ne),he):[];De=De.map(et=>new H.Point(Fr(et.x),et.y)),Ve=Ve.map(et=>new H.Point(Fr(et.x),et.y));const Ge=[...De];Ge.length===0&&Ge.push(Ve[Ve.length-1]);const Qe=H.number(Ge[Ge.length-1].y,(Ve.length===0?De[0]:Ve[0]).y,Se);let tt;return tt=Le?[new H.Point(0,Qe),new H.Point(0,0),new H.Point(1,0),new H.Point(1,Qe)]:[new H.Point(1,Qe),new H.Point(1,1),new H.Point(0,1),new H.Point(0,Qe)],Ge.push(...tt),Ve.length===0?Ge.push(De[0]):Ge.push(...Ve),{polygon:Ge.map(et=>new H.MercatorCoordinate(et.x,et.y)),unwrapped:!1}}(U,Y);if(te)return te;const ne=function(ae,he){let fe=!1,de=-1/0,ve=0;for(let Te=0;Te<ae.length-1;Te++)ae[Te].x>de&&(de=ae[Te].x,ve=Te);for(let Te=0;Te<ae.length-1;Te++){const Pe=(ve+Te)%(ae.length-1),Le=ae[Pe],ke=ae[Pe+1];Math.abs(Le.x-ke.x)>.5&&(Le.x<ke.x?(Le.x+=1,Pe===0&&(ae[ae.length-1].x+=1)):(ke.x+=1,Pe+1===ae.length-1&&(ae[0].x+=1)),fe=!0)}const ge=H.mercatorXfromLng(he.center.lng);return fe&&ge<Math.abs(ge-1)&&ae.forEach(Te=>{Te.x-=1}),{polygon:ae,unwrapped:fe}}(mr(U,Y).map(ae=>new H.Point(Fr(ae.x),ae.y)),Y);return{polygon:ne.polygon.map(ae=>new H.MercatorCoordinate(ae.x,ae.y)),unwrapped:ne.unwrapped}}}function mr(Q,U){return H.resample(Q,Y=>{const te=U.pointCoordinate3D(Y);Y.x=te.x,Y.y=te.y},1/256)}function Fr(Q){return Q<0?1+Q%1:Q%1}function si(Q){return 100*Q|0}function xi(Q,U,Y,te,ne){const ae=function(he,fe){if(he)return ne(he);if(fe){Q.url&&fe.tiles&&Q.tiles&&delete Q.tiles;const de=H.pick(H.extend(fe,Q),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);fe.vector_layers&&(de.vectorLayers=fe.vector_layers,de.vectorLayerIds=de.vectorLayers.map(ve=>ve.id)),de.tiles=U.canonicalizeTileset(de,Q.url),ne(null,de)}};return Q.url?H.getJSON(U.transformRequest(U.normalizeSourceURL(Q.url,null,Y,te),H.ResourceType.Source),ae):H.exported.frame(()=>ae(null,Q))}class Xr{constructor(U,Y,te){this.bounds=H.LngLatBounds.convert(this.validateBounds(U)),this.minzoom=Y||0,this.maxzoom=te||24}validateBounds(U){return Array.isArray(U)&&U.length===4?[Math.max(-180,U[0]),Math.max(-90,U[1]),Math.min(180,U[2]),Math.min(90,U[3])]:[-180,-90,180,90]}contains(U){const Y=Math.pow(2,U.z),te=Math.floor(H.mercatorXfromLng(this.bounds.getWest())*Y),ne=Math.floor(H.mercatorYfromLat(this.bounds.getNorth())*Y),ae=Math.ceil(H.mercatorXfromLng(this.bounds.getEast())*Y),he=Math.ceil(H.mercatorYfromLat(this.bounds.getSouth())*Y);return U.x>=te&&U.x<ae&&U.y>=ne&&U.y<he}}class wn{constructor(U,Y,te){this.context=U;const ne=U.gl;this.buffer=ne.createBuffer(),this.dynamicDraw=!!te,this.context.unbindVAO(),U.bindElementBuffer.set(this.buffer),ne.bufferData(ne.ELEMENT_ARRAY_BUFFER,Y.arrayBuffer,this.dynamicDraw?ne.DYNAMIC_DRAW:ne.STATIC_DRAW),this.dynamicDraw||Y.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(U){const Y=this.context.gl;this.context.unbindVAO(),this.bind(),Y.bufferSubData(Y.ELEMENT_ARRAY_BUFFER,0,U.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ji{constructor(U,Y,te,ne){this.length=Y.length,this.attributes=te,this.itemSize=Y.bytesPerElement,this.dynamicDraw=ne,this.context=U;const ae=U.gl;this.buffer=ae.createBuffer(),U.bindVertexBuffer.set(this.buffer),ae.bufferData(ae.ARRAY_BUFFER,Y.arrayBuffer,this.dynamicDraw?ae.DYNAMIC_DRAW:ae.STATIC_DRAW),this.dynamicDraw||Y.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(U){const Y=this.context.gl;this.bind(),Y.bufferSubData(Y.ARRAY_BUFFER,0,U.arrayBuffer)}enableAttributes(U,Y){for(let te=0;te<this.attributes.length;te++){const ne=Y.attributes[this.attributes[te].name];ne!==void 0&&U.enableVertexAttribArray(ne)}}setVertexAttribPointers(U,Y,te){for(let ne=0;ne<this.attributes.length;ne++){const ae=this.attributes[ne],he=Y.attributes[ae.name];he!==void 0&&U.vertexAttribPointer(he,ae.components,U[Yi[ae.type]],!1,this.itemSize,ae.offset+this.itemSize*(te||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Rr{constructor(U){this.gl=U.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(U){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class vn extends Rr{getDefault(){return H.Color.transparent}set(U){const Y=this.current;(U.r!==Y.r||U.g!==Y.g||U.b!==Y.b||U.a!==Y.a||this.dirty)&&(this.gl.clearColor(U.r,U.g,U.b,U.a),this.current=U,this.dirty=!1)}}class Fi extends Rr{getDefault(){return 1}set(U){(U!==this.current||this.dirty)&&(this.gl.clearDepth(U),this.current=U,this.dirty=!1)}}class Ro extends Rr{getDefault(){return 0}set(U){(U!==this.current||this.dirty)&&(this.gl.clearStencil(U),this.current=U,this.dirty=!1)}}class di extends Rr{getDefault(){return[!0,!0,!0,!0]}set(U){const Y=this.current;(U[0]!==Y[0]||U[1]!==Y[1]||U[2]!==Y[2]||U[3]!==Y[3]||this.dirty)&&(this.gl.colorMask(U[0],U[1],U[2],U[3]),this.current=U,this.dirty=!1)}}class Qi extends Rr{getDefault(){return!0}set(U){(U!==this.current||this.dirty)&&(this.gl.depthMask(U),this.current=U,this.dirty=!1)}}class Yo extends Rr{getDefault(){return 255}set(U){(U!==this.current||this.dirty)&&(this.gl.stencilMask(U),this.current=U,this.dirty=!1)}}class Mn extends Rr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(U){const Y=this.current;(U.func!==Y.func||U.ref!==Y.ref||U.mask!==Y.mask||this.dirty)&&(this.gl.stencilFunc(U.func,U.ref,U.mask),this.current=U,this.dirty=!1)}}class en extends Rr{getDefault(){const U=this.gl;return[U.KEEP,U.KEEP,U.KEEP]}set(U){const Y=this.current;(U[0]!==Y[0]||U[1]!==Y[1]||U[2]!==Y[2]||this.dirty)&&(this.gl.stencilOp(U[0],U[1],U[2]),this.current=U,this.dirty=!1)}}class zn extends Rr{getDefault(){return!1}set(U){if(U===this.current&&!this.dirty)return;const Y=this.gl;U?Y.enable(Y.STENCIL_TEST):Y.disable(Y.STENCIL_TEST),this.current=U,this.dirty=!1}}class Hi extends Rr{getDefault(){return[0,1]}set(U){const Y=this.current;(U[0]!==Y[0]||U[1]!==Y[1]||this.dirty)&&(this.gl.depthRange(U[0],U[1]),this.current=U,this.dirty=!1)}}class Qn extends Rr{getDefault(){return!1}set(U){if(U===this.current&&!this.dirty)return;const Y=this.gl;U?Y.enable(Y.DEPTH_TEST):Y.disable(Y.DEPTH_TEST),this.current=U,this.dirty=!1}}class Un extends Rr{getDefault(){return this.gl.LESS}set(U){(U!==this.current||this.dirty)&&(this.gl.depthFunc(U),this.current=U,this.dirty=!1)}}class sn extends Rr{getDefault(){return!1}set(U){if(U===this.current&&!this.dirty)return;const Y=this.gl;U?Y.enable(Y.BLEND):Y.disable(Y.BLEND),this.current=U,this.dirty=!1}}class Jo extends Rr{getDefault(){const U=this.gl;return[U.ONE,U.ZERO]}set(U){const Y=this.current;(U[0]!==Y[0]||U[1]!==Y[1]||this.dirty)&&(this.gl.blendFunc(U[0],U[1]),this.current=U,this.dirty=!1)}}class Me extends Rr{getDefault(){return H.Color.transparent}set(U){const Y=this.current;(U.r!==Y.r||U.g!==Y.g||U.b!==Y.b||U.a!==Y.a||this.dirty)&&(this.gl.blendColor(U.r,U.g,U.b,U.a),this.current=U,this.dirty=!1)}}class $e extends Rr{getDefault(){return this.gl.FUNC_ADD}set(U){(U!==this.current||this.dirty)&&(this.gl.blendEquation(U),this.current=U,this.dirty=!1)}}class be extends Rr{getDefault(){return!1}set(U){if(U===this.current&&!this.dirty)return;const Y=this.gl;U?Y.enable(Y.CULL_FACE):Y.disable(Y.CULL_FACE),this.current=U,this.dirty=!1}}class We extends Rr{getDefault(){return this.gl.BACK}set(U){(U!==this.current||this.dirty)&&(this.gl.cullFace(U),this.current=U,this.dirty=!1)}}class ot extends Rr{getDefault(){return this.gl.CCW}set(U){(U!==this.current||this.dirty)&&(this.gl.frontFace(U),this.current=U,this.dirty=!1)}}let vt,Dt=class extends Rr{getDefault(){return null}set(Q){(Q!==this.current||this.dirty)&&(this.gl.useProgram(Q),this.current=Q,this.dirty=!1)}};class Ar extends Rr{getDefault(){return this.gl.TEXTURE0}set(U){(U!==this.current||this.dirty)&&(this.gl.activeTexture(U),this.current=U,this.dirty=!1)}}class Yr extends Rr{getDefault(){const U=this.gl;return[0,0,U.drawingBufferWidth,U.drawingBufferHeight]}set(U){const Y=this.current;(U[0]!==Y[0]||U[1]!==Y[1]||U[2]!==Y[2]||U[3]!==Y[3]||this.dirty)&&(this.gl.viewport(U[0],U[1],U[2],U[3]),this.current=U,this.dirty=!1)}}class Zr extends Rr{getDefault(){return null}set(U){if(U===this.current&&!this.dirty)return;const Y=this.gl;Y.bindFramebuffer(Y.FRAMEBUFFER,U),this.current=U,this.dirty=!1}}class Jr extends Rr{getDefault(){return null}set(U){if(U===this.current&&!this.dirty)return;const Y=this.gl;Y.bindRenderbuffer(Y.RENDERBUFFER,U),this.current=U,this.dirty=!1}}class Wr extends Rr{getDefault(){return null}set(U){if(U===this.current&&!this.dirty)return;const Y=this.gl;Y.bindTexture(Y.TEXTURE_2D,U),this.current=U,this.dirty=!1}}class gs extends Rr{getDefault(){return null}set(U){if(U===this.current&&!this.dirty)return;const Y=this.gl;Y.bindBuffer(Y.ARRAY_BUFFER,U),this.current=U,this.dirty=!1}}class Ke extends Rr{getDefault(){return null}set(U){const Y=this.gl;Y.bindBuffer(Y.ELEMENT_ARRAY_BUFFER,U),this.current=U,this.dirty=!1}}class Oe extends Rr{constructor(U){super(U),this.vao=U.extVertexArrayObject}getDefault(){return null}set(U){this.vao&&(U!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(U),this.current=U,this.dirty=!1)}}class Ce extends Rr{getDefault(){return 4}set(U){if(U===this.current&&!this.dirty)return;const Y=this.gl;Y.pixelStorei(Y.UNPACK_ALIGNMENT,U),this.current=U,this.dirty=!1}}class qe extends Rr{getDefault(){return!1}set(U){if(U===this.current&&!this.dirty)return;const Y=this.gl;Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,U),this.current=U,this.dirty=!1}}class Je extends Rr{getDefault(){return!1}set(U){if(U===this.current&&!this.dirty)return;const Y=this.gl;Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,U),this.current=U,this.dirty=!1}}class it extends Rr{constructor(U,Y){super(U),this.context=U,this.parent=Y}getDefault(){return null}}class lt extends it{setDirty(){this.dirty=!0}set(U){if(U===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const Y=this.gl;Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,U,0),this.current=U,this.dirty=!1}}class st extends it{attachment(){return this.gl.DEPTH_ATTACHMENT}set(U){if(U===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const Y=this.gl;Y.framebufferRenderbuffer(Y.FRAMEBUFFER,this.attachment(),Y.RENDERBUFFER,U),this.current=U,this.dirty=!1}}class rt extends st{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class gt{constructor(U,Y,te,ne){this.context=U,this.width=Y,this.height=te;const ae=this.framebuffer=U.gl.createFramebuffer();this.colorAttachment=new lt(U,ae),ne&&(this.depthAttachment=new st(U,ae))}destroy(){const U=this.context.gl,Y=this.colorAttachment.get();if(Y&&U.deleteTexture(Y),this.depthAttachment){const te=this.depthAttachment.get();te&&U.deleteRenderbuffer(te)}U.deleteFramebuffer(this.framebuffer)}}class qt{constructor(U,Y=!1){if(this.gl=U,this.isWebGL2=Y,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),Y){const te=U;this.extVertexArrayObject={createVertexArrayOES:te.createVertexArray.bind(U),deleteVertexArrayOES:te.deleteVertexArray.bind(U),bindVertexArrayOES:te.bindVertexArray.bind(U)}}this.clearColor=new vn(this),this.clearDepth=new Fi(this),this.clearStencil=new Ro(this),this.colorMask=new di(this),this.depthMask=new Qi(this),this.stencilMask=new Yo(this),this.stencilFunc=new Mn(this),this.stencilOp=new en(this),this.stencilTest=new zn(this),this.depthRange=new Hi(this),this.depthTest=new Qn(this),this.depthFunc=new Un(this),this.blend=new sn(this),this.blendFunc=new Jo(this),this.blendColor=new Me(this),this.blendEquation=new $e(this),this.cullFace=new be(this),this.cullFaceSide=new We(this),this.frontFace=new ot(this),this.program=new Dt(this),this.activeTexture=new Ar(this),this.viewport=new Yr(this),this.bindFramebuffer=new Zr(this),this.bindRenderbuffer=new Jr(this),this.bindTexture=new Wr(this),this.bindVertexBuffer=new gs(this),this.bindElementBuffer=new Ke(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Oe(this),this.pixelStoreUnpack=new Ce(this),this.pixelStoreUnpackPremultiplyAlpha=new qe(this),this.pixelStoreUnpackFlipY=new Je(this),this.extTextureFilterAnisotropic=U.getExtension("EXT_texture_filter_anisotropic")||U.getExtension("MOZ_EXT_texture_filter_anisotropic")||U.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=U.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=U.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=U.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=U.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),Y||(this.extTextureHalfFloat=U.getExtension("OES_texture_half_float")),(Y||this.extTextureHalfFloat&&U.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=U.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=Y||U.getExtension("OES_standard_derivatives"),this.extTimerQuery=U.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=U.getParameter(U.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(U,Y){return new wn(this,U,Y)}createVertexBuffer(U,Y,te){return new Ji(this,U,Y,te)}createRenderbuffer(U,Y,te){const ne=this.gl,ae=ne.createRenderbuffer();return this.bindRenderbuffer.set(ae),ne.renderbufferStorage(ne.RENDERBUFFER,U,Y,te),this.bindRenderbuffer.set(null),ae}createFramebuffer(U,Y,te){return new gt(this,U,Y,te)}clear({color:U,depth:Y,stencil:te}){const ne=this.gl;let ae=0;U&&(ae|=ne.COLOR_BUFFER_BIT,this.clearColor.set(U),this.colorMask.set([!0,!0,!0,!0])),Y!==void 0&&(ae|=ne.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(Y),this.depthMask.set(!0)),te!==void 0&&(ae|=ne.STENCIL_BUFFER_BIT,this.clearStencil.set(te),this.stencilMask.set(255)),ne.clear(ae)}setCullFace(U){U.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(U.mode),this.frontFace.set(U.frontFace))}setDepthMode(U){U.func!==this.gl.ALWAYS||U.mask?(this.depthTest.set(!0),this.depthFunc.set(U.func),this.depthMask.set(U.mask),this.depthRange.set(U.range)):this.depthTest.set(!1)}setStencilMode(U){U.test.func!==this.gl.ALWAYS||U.mask?(this.stencilTest.set(!0),this.stencilMask.set(U.mask),this.stencilOp.set([U.fail,U.depthFail,U.pass]),this.stencilFunc.set({func:U.test.func,ref:U.ref,mask:U.test.mask})):this.stencilTest.set(!1)}setColorMode(U){ye(U.blendFunction,H.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(U.blendFunction),this.blendColor.set(U.blendColor)),this.colorMask.set(U.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Kt extends H.Evented{constructor(U,Y,te,ne){if(super(),this.id=U,this.dispatcher=te,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,H.extend(this,H.pick(Y,["url","scheme","tileSize","promoteId"])),this._options=H.extend({type:"vector"},Y),this._collectResourceTiming=Y.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(ne),this._tileWorkers={},this._deduped=new H.DedupedRequest}load(U){this._loaded=!1,this.fire(new H.Event("dataloading",{dataType:"source"}));const Y=Array.isArray(this.map._language)?this.map._language.join():this.map._language,te=this.map._worldview;this._tileJSONRequest=xi(this._options,this.map._requestManager,Y,te,(ne,ae)=>{this._tileJSONRequest=null,this._loaded=!0,ne?(Y&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${Y}`),te&&te.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${te}`),this.fire(new H.ErrorEvent(ne))):ae&&(H.extend(this,ae),ae.bounds&&(this.tileBounds=new Xr(ae.bounds,this.minzoom,this.maxzoom)),H.postTurnstileEvent(ae.tiles,this.map._requestManager._customAccessToken),this.fire(new H.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new H.Event("data",{dataType:"source",sourceDataType:"content"}))),U&&U(ne)})}loaded(){return this._loaded}hasTile(U){return!this.tileBounds||this.tileBounds.contains(U.canonical)}onAdd(U){this.map=U,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(U){return this._options.tiles=U,this.reload(),this}setUrl(U){return this.url=U,this._options.url=U,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return H.extend({},this._options)}loadTile(U,Y){const te=this.map._requestManager.normalizeTileURL(U.tileID.canonical.url(this.tiles,this.scheme)),ne={request:this.map._requestManager.transformRequest(te,H.ResourceType.Tile),data:void 0,uid:U.uid,tileID:U.tileID,tileZoom:U.tileZoom,zoom:U.tileID.overscaledZ,tileSize:this.tileSize*U.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:H.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:U.isSymbolTile};if(ne.request.collectResourceTiming=this._collectResourceTiming,U.actor&&U.state!=="expired")U.state==="loading"?U.reloadCallback=Y:U.request=U.actor.send("reloadTile",ne,ae.bind(this));else if(U.actor=this._tileWorkers[te]=this._tileWorkers[te]||this.dispatcher.getActor(),this.dispatcher.ready)U.request=U.actor.send("loadTile",ne,ae.bind(this),void 0,!0);else{const he=H.loadVectorTile.call({deduped:this._deduped},ne,(fe,de)=>{fe||!de?ae.call(this,fe):(ne.data={cacheControl:de.cacheControl,expires:de.expires,rawData:de.rawData.slice(0)},U.actor&&U.actor.send("loadTile",ne,ae.bind(this),void 0,!0))},!0);U.request={cancel:he}}function ae(he,fe){return delete U.request,U.aborted?Y(null):he&&he.status!==404?Y(he):(fe&&fe.resourceTiming&&(U.resourceTiming=fe.resourceTiming),this.map._refreshExpiredTiles&&fe&&U.setExpiryData(fe),U.loadVectorData(fe,this.map.painter),H.cacheEntryPossiblyAdded(this.dispatcher),Y(null),void(U.reloadCallback&&(this.loadTile(U,U.reloadCallback),U.reloadCallback=null)))}}abortTile(U){U.request&&(U.request.cancel(),delete U.request),U.actor&&U.actor.send("abortTile",{uid:U.uid,type:this.type,source:this.id})}unloadTile(U){U.unloadVectorData(),U.actor&&U.actor.send("removeTile",{uid:U.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Vt extends H.Evented{constructor(U,Y,te,ne){super(),this.id=U,this.dispatcher=te,this.setEventedParent(ne),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=H.extend({type:"raster"},Y),H.extend(this,H.pick(Y,["url","scheme","tileSize"]))}load(U){this._loaded=!1,this.fire(new H.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xi(this._options,this.map._requestManager,null,null,(Y,te)=>{this._tileJSONRequest=null,this._loaded=!0,Y?this.fire(new H.ErrorEvent(Y)):te&&(H.extend(this,te),te.bounds&&(this.tileBounds=new Xr(te.bounds,this.minzoom,this.maxzoom)),H.postTurnstileEvent(te.tiles),this.fire(new H.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new H.Event("data",{dataType:"source",sourceDataType:"content"}))),U&&U(Y)})}loaded(){return this._loaded}onAdd(U){this.map=U,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(U){return this._options.tiles=U,this.reload(),this}setUrl(U){return this.url=U,this._options.url=U,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return H.extend({},this._options)}hasTile(U){return!this.tileBounds||this.tileBounds.contains(U.canonical)}loadTile(U,Y){const te=H.exported.devicePixelRatio>=2,ne=this.map._requestManager.normalizeTileURL(U.tileID.canonical.url(this.tiles,this.scheme),te,this.tileSize);U.request=H.getImage(this.map._requestManager.transformRequest(ne,H.ResourceType.Tile),(ae,he,fe,de)=>(delete U.request,U.aborted?(U.state="unloaded",Y(null)):ae?(U.state="errored",Y(ae)):he?(this.map._refreshExpiredTiles&&U.setExpiryData({cacheControl:fe,expires:de}),U.setTexture(he,this.map.painter),U.state="loaded",H.cacheEntryPossiblyAdded(this.dispatcher),void Y(null)):Y(null)))}static loadTileData(U,Y,te){U.setTexture(Y,te)}static unloadTileData(U,Y){U.texture&&Y.saveTileTexture(U.texture)}abortTile(U,Y){U.request&&(U.request.cancel(),delete U.request),Y()}unloadTile(U,Y){U.texture&&this.map.painter.saveTileTexture(U.texture),Y()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function wr(Q,U,Y,te,ne,ae,he,fe){const de=[Q,Y,ne,U,te,ae,1,1,1],ve=[he,fe,1],ge=H.adjoint([],de),[Te,Pe,Le]=H.transformMat3(ve,ve,H.transpose(ge,ge));return H.multiply$1(de,[Te,0,0,0,Pe,0,0,0,Le],de)}class Or extends H.Evented{constructor(U,Y,te,ne){super(),this.id=U,this.dispatcher=te,this.coordinates=Y.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(ne),this.options=Y,this._dirty=!1}load(U,Y){this._loaded=Y||!1,this.fire(new H.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=H.getImage(this.map._requestManager.transformRequest(this.url,H.ResourceType.Image),(te,ne)=>{if(this._imageRequest=null,this._loaded=!0,te)this.fire(new H.ErrorEvent(te));else if(ne){const{HTMLImageElement:ae}=H.window;this.image=ne instanceof ae?H.exported.getImageData(ne):ne,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,U&&(this.coordinates=U),this._finishLoading()}})}loaded(){return this._loaded}updateImage(U){return this.image&&U.url?(this._imageRequest&&U.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=U.url,this.load(U.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new H.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(U){this.map=U,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(U){this.coordinates=U,this._boundsArray=void 0;const Y=U.map(H.MercatorCoordinate.fromLngLat);return this.tileID=function(te){let ne=1/0,ae=1/0,he=-1/0,fe=-1/0;for(const Te of te)ne=Math.min(ne,Te.x),ae=Math.min(ae,Te.y),he=Math.max(he,Te.x),fe=Math.max(fe,Te.y);const de=Math.max(he-ne,fe-ae),ve=Math.max(0,Math.floor(-Math.log(de)/Math.LN2)),ge=Math.pow(2,ve);return new H.CanonicalTileID(ve,Math.floor((ne+he)/2*ge),Math.floor((ae+fe)/2*ge))}(Y),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new H.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(U){for(const de in this.tiles){const ve=this.tiles[de];ve.state!=="loaded"&&(ve.state="loaded",ve.texture=this.texture)}if(this._boundsArray)return;const Y=H.tileTransform(this.tileID,this.map.transform.projection),[te,ne,ae,he]=this.coordinates.map(de=>{const ve=Y.projection.project(de[0],de[1]);return H.getTilePoint(Y,ve)._round()});this.perspectiveTransform=function(de,ve,ge,Te,Pe,Le,ke,Be,Ne,Se){const De=wr(0,0,de,0,0,ve,de,ve),Ve=wr(ge,Te,Pe,Le,ke,Be,Ne,Se);return H.multiply$1(Ve,H.adjoint(De,De),Ve),[Ve[6]/Ve[8]*de/H.EXTENT,Ve[7]/Ve[8]*ve/H.EXTENT]}(this.width,this.height,te.x,te.y,ne.x,ne.y,he.x,he.y,ae.x,ae.y);const fe=this._boundsArray=new H.StructArrayLayout4i8;fe.emplaceBack(te.x,te.y,0,0),fe.emplaceBack(ne.x,ne.y,H.EXTENT,0),fe.emplaceBack(he.x,he.y,0,H.EXTENT),fe.emplaceBack(ae.x,ae.y,H.EXTENT,H.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=U.createVertexBuffer(fe,H.boundsAttributes.members),this.boundsSegments=H.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const U=this.map.painter.context,Y=U.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new H.Texture(U,this.image,Y.RGBA),this.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(U)}loadTile(U,Y){this.tileID&&this.tileID.equals(U.tileID.canonical)?(this.tiles[String(U.tileID.wrap)]=U,U.buckets={},Y(null)):(U.state="errored",Y(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Er={vector:Kt,raster:Vt,"raster-dem":class extends Vt{constructor(Q,U,Y,te){super(Q,U,Y,te),this.type="raster-dem",this.maxzoom=22,this._options=H.extend({type:"raster-dem"},U),this.encoding=U.encoding||"mapbox"}loadTile(Q,U){const Y=this.map._requestManager.normalizeTileURL(Q.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function te(ne,ae){ne&&(Q.state="errored",U(ne)),ae&&(Q.dem=ae,Q.dem.onDeserialize(),Q.needsHillshadePrepare=!0,Q.needsDEMTextureUpload=!0,Q.state="loaded",U(null))}Q.request=H.getImage(this.map._requestManager.transformRequest(Y,H.ResourceType.Tile),(function(ne,ae,he,fe){if(delete Q.request,Q.aborted)Q.state="unloaded",U(null);else if(ne)Q.state="errored",U(ne);else if(ae){this.map._refreshExpiredTiles&&Q.setExpiryData({cacheControl:he,expires:fe});const de=H.window.ImageBitmap&&ae instanceof H.window.ImageBitmap&&(vt==null&&(vt=H.window.OffscreenCanvas&&new H.window.OffscreenCanvas(1,1).getContext("2d")&&typeof H.window.createImageBitmap=="function"),vt),ve=1-(ae.width-H.prevPowerOfTwo(ae.width))/2;ve<1||Q.neighboringTiles||(Q.neighboringTiles=this._getNeighboringTiles(Q.tileID));const ge=de?ae:H.exported.getImageData(ae,ve),Te={uid:Q.uid,coord:Q.tileID,source:this.id,rawImageData:ge,encoding:this.encoding,padding:ve};Q.actor&&Q.state!=="expired"||(Q.actor=this.dispatcher.getActor(),Q.actor.send("loadDEMTile",Te,te.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(Q){const U=Q.canonical,Y=Math.pow(2,U.z),te=(U.x-1+Y)%Y,ne=U.x===0?Q.wrap-1:Q.wrap,ae=(U.x+1+Y)%Y,he=U.x+1===Y?Q.wrap+1:Q.wrap,fe={};return fe[new H.OverscaledTileID(Q.overscaledZ,ne,U.z,te,U.y).key]={backfilled:!1},fe[new H.OverscaledTileID(Q.overscaledZ,he,U.z,ae,U.y).key]={backfilled:!1},U.y>0&&(fe[new H.OverscaledTileID(Q.overscaledZ,ne,U.z,te,U.y-1).key]={backfilled:!1},fe[new H.OverscaledTileID(Q.overscaledZ,Q.wrap,U.z,U.x,U.y-1).key]={backfilled:!1},fe[new H.OverscaledTileID(Q.overscaledZ,he,U.z,ae,U.y-1).key]={backfilled:!1}),U.y+1<Y&&(fe[new H.OverscaledTileID(Q.overscaledZ,ne,U.z,te,U.y+1).key]={backfilled:!1},fe[new H.OverscaledTileID(Q.overscaledZ,Q.wrap,U.z,U.x,U.y+1).key]={backfilled:!1},fe[new H.OverscaledTileID(Q.overscaledZ,he,U.z,ae,U.y+1).key]={backfilled:!1}),fe}unloadTile(Q){Q.demTexture&&this.map.painter.saveTileTexture(Q.demTexture),Q.fbo&&(Q.fbo.destroy(),delete Q.fbo),Q.dem&&delete Q.dem,delete Q.neighboringTiles,Q.state="unloaded"}},geojson:class extends H.Evented{constructor(Q,U,Y,te){super(),this.id=Q,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=Y.getActor(),this.setEventedParent(te),this._data=U.data,this._options=H.extend({},U),this._collectResourceTiming=U.collectResourceTiming,U.maxzoom!==void 0&&(this.maxzoom=U.maxzoom),U.type&&(this.type=U.type),U.attribution&&(this.attribution=U.attribution),this.promoteId=U.promoteId;const ne=H.EXTENT/this.tileSize;this.workerOptions=H.extend({source:this.id,cluster:U.cluster||!1,geojsonVtOptions:{buffer:(U.buffer!==void 0?U.buffer:128)*ne,tolerance:(U.tolerance!==void 0?U.tolerance:.375)*ne,extent:H.EXTENT,maxZoom:this.maxzoom,lineMetrics:U.lineMetrics||!1,generateId:U.generateId||!1},superclusterOptions:{maxZoom:U.clusterMaxZoom!==void 0?U.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,U.clusterMinPoints||2),extent:H.EXTENT,radius:(U.clusterRadius!==void 0?U.clusterRadius:50)*ne,log:!1,generateId:U.generateId||!1},clusterProperties:U.clusterProperties,filter:U.filter},U.workerOptions)}onAdd(Q){this.map=Q,this.setData(this._data)}setData(Q){return this._data=Q,this._updateWorkerData(),this}getClusterExpansionZoom(Q,U){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:Q,source:this.id},U),this}getClusterChildren(Q,U){return this.actor.send("geojson.getClusterChildren",{clusterId:Q,source:this.id},U),this}getClusterLeaves(Q,U,Y,te){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:Q,limit:U,offset:Y},te),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new H.Event("dataloading",{dataType:"source"})),this._loaded=!1;const Q=H.extend({},this.workerOptions),U=this._data;typeof U=="string"?(Q.request=this.map._requestManager.transformRequest(H.exported.resolveURL(U),H.ResourceType.Source),Q.request.collectResourceTiming=this._collectResourceTiming):Q.data=JSON.stringify(U),this._pendingLoad=this.actor.send(`${this.type}.loadData`,Q,(Y,te)=>{if(this._loaded=!0,this._pendingLoad=null,Y)this.fire(new H.ErrorEvent(Y));else{const ne={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&te&&te.resourceTiming&&te.resourceTiming[this.id]&&(ne.resourceTiming=te.resourceTiming[this.id]),this.fire(new H.Event("data",ne)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(Q,U){const Y=Q.actor?"reloadTile":"loadTile";Q.actor=this.actor,Q.request=this.actor.send(Y,{type:this.type,uid:Q.uid,tileID:Q.tileID,tileZoom:Q.tileZoom,zoom:Q.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:H.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(te,ne)=>(delete Q.request,Q.unloadVectorData(),Q.aborted?U(null):te?U(te):(Q.loadVectorData(ne,this.map.painter,Y==="reloadTile"),U(null))),void 0,Y==="loadTile")}abortTile(Q){Q.request&&(Q.request.cancel(),delete Q.request),Q.aborted=!0}unloadTile(Q){Q.unloadVectorData(),this.actor.send("removeTile",{uid:Q.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return H.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Or{constructor(Q,U,Y,te){super(Q,U,Y,te),this.roundZoom=!0,this.type="video",this.options=U}load(){this._loaded=!1;const Q=this.options;this.urls=[];for(const U of Q.urls)this.urls.push(this.map._requestManager.transformRequest(U,H.ResourceType.Source).url);H.getVideo(this.urls,(U,Y)=>{this._loaded=!0,U?this.fire(new H.ErrorEvent(U)):Y&&(this.video=Y,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(Q){if(this.video){const U=this.video.seekable;Q<U.start(0)||Q>U.end(0)?this.fire(new H.ErrorEvent(new H.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${U.start(0)} and ${U.end(0)}-second mark.`))):this.video.currentTime=Q}}getVideo(){return this.video}onAdd(Q){this.map||(this.map=Q,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const Q=this.map.painter.context,U=Q.gl;this.texture?this.video.paused||(this.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE),U.texSubImage2D(U.TEXTURE_2D,0,0,0,U.RGBA,U.UNSIGNED_BYTE,this.video)):(this.texture=new H.Texture(Q,this.video,U.RGBA),this.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(Q)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Or,canvas:class extends Or{constructor(Q,U,Y,te){super(Q,U,Y,te),U.coordinates?Array.isArray(U.coordinates)&&U.coordinates.length===4&&!U.coordinates.some(ne=>!Array.isArray(ne)||ne.length!==2||ne.some(ae=>typeof ae!="number"))||this.fire(new H.ErrorEvent(new H.ValidationError(`sources.${Q}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new H.ErrorEvent(new H.ValidationError(`sources.${Q}`,null,'missing required property "coordinates"'))),U.animate&&typeof U.animate!="boolean"&&this.fire(new H.ErrorEvent(new H.ValidationError(`sources.${Q}`,null,'optional "animate" property must be a boolean value'))),U.canvas?typeof U.canvas=="string"||U.canvas instanceof H.window.HTMLCanvasElement||this.fire(new H.ErrorEvent(new H.ValidationError(`sources.${Q}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new H.ErrorEvent(new H.ValidationError(`sources.${Q}`,null,'missing required property "canvas"'))),this.options=U,this.animate=U.animate===void 0||U.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof H.window.HTMLCanvasElement?this.options.canvas:H.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new H.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(Q){this.map=Q,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let Q=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,Q=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,Q=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const U=this.map.painter.context;this.texture?(Q||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new H.Texture(U,this.canvas,U.gl.RGBA,{premultiply:!0}),this._prepareData(U)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const Q of[this.canvas.width,this.canvas.height])if(isNaN(Q)||Q<=0)return!0;return!1}},custom:class extends H.Evented{constructor(Q,U,Y,te){super(),this.id=Q,this.type="custom",this._dataType="raster",this._dispatcher=Y,this._implementation=U,this.setEventedParent(te),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new H.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new H.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Xr(this._implementation.bounds,this.minzoom,this.maxzoom)),U.update=this._update.bind(this),U.clearTiles=this._clearTiles.bind(this),U.coveringTiles=this._coveringTiles.bind(this),H.extend(this,H.pick(U,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return H.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new H.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new H.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(Q){this._map=Q,this._loaded=!1,this.fire(new H.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(Q),this.load()}onRemove(Q){this._implementation.onRemove&&this._implementation.onRemove(Q)}hasTile(Q){if(this._implementation.hasTile){const{x:U,y:Y,z:te}=Q.canonical;return this._implementation.hasTile({x:U,y:Y,z:te})}return!this.tileBounds||this.tileBounds.contains(Q.canonical)}loadTile(Q,U){const{x:Y,y:te,z:ne}=Q.tileID.canonical,ae=new H.window.AbortController;Q.request=Promise.resolve(this._implementation.loadTile({x:Y,y:te,z:ne},{signal:ae.signal})).then((function(he){return delete Q.request,Q.aborted?(Q.state="unloaded",U(null)):he===void 0?(Q.state="errored",U(null)):he===null?(this.loadTileData(Q,{width:this.tileSize,height:this.tileSize,data:null}),Q.state="loaded",U(null)):function(fe){return fe instanceof H.window.ImageData||fe instanceof H.window.HTMLCanvasElement||fe instanceof H.window.ImageBitmap||fe instanceof H.window.HTMLImageElement}(he)?(this.loadTileData(Q,he),Q.state="loaded",void U(null)):(Q.state="errored",U(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(he=>{he.code!==20&&(Q.state="errored",U(he))}),Q.request.cancel=()=>ae.abort()}loadTileData(Q,U){Vt.loadTileData(Q,U,this._map.painter)}unloadTileData(Q){Vt.unloadTileData(Q,this._map.painter)}unloadTile(Q,U){if(this.unloadTileData(Q),this._implementation.unloadTile){const{x:Y,y:te,z:ne}=Q.tileID.canonical;this._implementation.unloadTile({x:Y,y:te,z:ne})}U()}abortTile(Q,U){Q.request&&Q.request.cancel&&(Q.request.cancel(),delete Q.request),U()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(Q=>({x:Q.canonical.x,y:Q.canonical.y,z:Q.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new H.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Cr=function(Q,U,Y,te){const ne=new Er[U.type](Q,U,Y,te);if(ne.id!==Q)throw new Error(`Expected Source id to be ${Q} instead of ${ne.id}`);return H.bindAll(["load","abort","unload","serialize","prepare"],ne),ne};function Nr(Q,U){const Y=H.identity([]);return H.scale(Y,Y,[.5*Q.width,.5*-Q.height,1]),H.translate(Y,Y,[1,-1,0]),H.multiply(Y,Y,Q.calculateProjMatrix(U.toUnwrapped())),Float32Array.from(Y)}function vi(Q,U,Y,te,ne,ae,he,fe=!1){const de=Q.tilesIn(te,he,fe);de.sort(tn);const ve=[];for(const Te of de)ve.push({wrappedTileID:Te.tile.tileID.wrapped().key,queryResults:Te.tile.queryRenderedFeatures(U,Y,Q._state,Te,ne,ae,Nr(Q.transform,Te.tile.tileID),fe)});const ge=function(Te){const Pe={},Le={};for(const ke of Te){const Be=ke.queryResults,Ne=ke.wrappedTileID,Se=Le[Ne]=Le[Ne]||{};for(const De in Be){const Ve=Be[De],Ge=Se[De]=Se[De]||{},Qe=Pe[De]=Pe[De]||[];for(const tt of Ve)Ge[tt.featureIndex]||(Ge[tt.featureIndex]=!0,Qe.push(tt))}}return Pe}(ve);for(const Te in ge)ge[Te].forEach(Pe=>{const Le=Pe.feature,ke=Le.layer;ke&&ke.type!=="background"&&ke.type!=="sky"&&(Le.source=ke.source,ke["source-layer"]&&(Le.sourceLayer=ke["source-layer"]),Le.state=Le.id!==void 0?Q.getFeatureState(ke["source-layer"],Le.id):{})});return ge}function Ai(Q,U){const Y=Q.getRenderableIds().map(ae=>Q.getTileByID(ae)),te=[],ne={};for(let ae=0;ae<Y.length;ae++){const he=Y[ae],fe=he.tileID.canonical.key;ne[fe]||(ne[fe]=!0,he.querySourceFeatures(te,U))}return te}function tn(Q,U){const Y=Q.tileID,te=U.tileID;return Y.overscaledZ-te.overscaledZ||Y.canonical.y-te.canonical.y||Y.wrap-te.wrap||Y.canonical.x-te.canonical.x}function ki(){return _a.workerClass!=null?new _a.workerClass:new H.window.Worker(_a.workerUrl)}const jn="mapboxgl_preloaded_worker_pool";class zi{constructor(){this.active={}}acquire(U){if(!this.workers)for(this.workers=[];this.workers.length<zi.workerCount;)this.workers.push(new ki);return this.active[U]=!0,this.workers.slice()}release(U){delete this.active[U],this.numActive()===0&&(this.workers.forEach(Y=>{Y.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jn]}numActive(){return Object.keys(this.active).length}}let ln;function Qo(){return ln||(ln=new zi),ln}function gh(Q,U){const Y={};for(const te in Q)te!=="ref"&&(Y[te]=Q[te]);return H.refProperties.forEach(te=>{te in U&&(Y[te]=U[te])}),Y}function Hc(Q){Q=Q.slice();const U=Object.create(null);for(let Y=0;Y<Q.length;Y++)U[Q[Y].id]=Q[Y];for(let Y=0;Y<Q.length;Y++)"ref"in Q[Y]&&(Q[Y]=gh(Q[Y],U[Q[Y].ref]));return Q}zi.workerCount=2;const qr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function yl(Q,U,Y){Y.push({command:qr.addSource,args:[Q,U[Q]]})}function Oa(Q,U,Y){U.push({command:qr.removeSource,args:[Q]}),Y[Q]=!0}function _l(Q,U,Y,te){Oa(Q,Y,te),yl(Q,U,Y)}function vs(Q,U,Y){let te;for(te in Q[Y])if(Q[Y].hasOwnProperty(te)&&te!=="data"&&!ye(Q[Y][te],U[Y][te]))return!1;for(te in U[Y])if(U[Y].hasOwnProperty(te)&&te!=="data"&&!ye(Q[Y][te],U[Y][te]))return!1;return!0}function Vn(Q,U,Y,te,ne,ae){let he;for(he in U=U||{},Q=Q||{})Q.hasOwnProperty(he)&&(ye(Q[he],U[he])||Y.push({command:ae,args:[te,he,U[he],ne]}));for(he in U)U.hasOwnProperty(he)&&!Q.hasOwnProperty(he)&&(ye(Q[he],U[he])||Y.push({command:ae,args:[te,he,U[he],ne]}))}function eo(Q){return Q.id}function gl(Q,U){return Q[U.id]=U,Q}class vl{constructor(U,Y){this.reset(U,Y)}reset(U,Y){this.points=U||[],this._distances=[0];for(let te=1;te<this.points.length;te++)this._distances[te]=this._distances[te-1]+this.points[te].dist(this.points[te-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(Y||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(U){if(this.points.length===1)return this.points[0];U=H.clamp(U,0,1);let Y=1,te=this._distances[Y];const ne=U*this.paddedLength+this.padding;for(;te<ne&&Y<this._distances.length;)te=this._distances[++Y];const ae=Y-1,he=this._distances[ae],fe=te-he,de=fe>0?(ne-he)/fe:0;return this.points[ae].mult(1-de).add(this.points[Y].mult(de))}}class Mo{constructor(U,Y,te){const ne=this.boxCells=[],ae=this.circleCells=[];this.xCellCount=Math.ceil(U/te),this.yCellCount=Math.ceil(Y/te);for(let he=0;he<this.xCellCount*this.yCellCount;he++)ne.push([]),ae.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=U,this.height=Y,this.xScale=this.xCellCount/U,this.yScale=this.yCellCount/Y,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(U,Y,te,ne,ae){this._forEachCell(Y,te,ne,ae,this._insertBoxCell,this.boxUid++),this.boxKeys.push(U),this.bboxes.push(Y),this.bboxes.push(te),this.bboxes.push(ne),this.bboxes.push(ae)}insertCircle(U,Y,te,ne){this._forEachCell(Y-ne,te-ne,Y+ne,te+ne,this._insertCircleCell,this.circleUid++),this.circleKeys.push(U),this.circles.push(Y),this.circles.push(te),this.circles.push(ne)}_insertBoxCell(U,Y,te,ne,ae,he){this.boxCells[ae].push(he)}_insertCircleCell(U,Y,te,ne,ae,he){this.circleCells[ae].push(he)}_query(U,Y,te,ne,ae,he){if(te<0||U>this.width||ne<0||Y>this.height)return!ae&&[];const fe=[];if(U<=0&&Y<=0&&this.width<=te&&this.height<=ne){if(ae)return!0;for(let de=0;de<this.boxKeys.length;de++)fe.push({key:this.boxKeys[de],x1:this.bboxes[4*de],y1:this.bboxes[4*de+1],x2:this.bboxes[4*de+2],y2:this.bboxes[4*de+3]});for(let de=0;de<this.circleKeys.length;de++){const ve=this.circles[3*de],ge=this.circles[3*de+1],Te=this.circles[3*de+2];fe.push({key:this.circleKeys[de],x1:ve-Te,y1:ge-Te,x2:ve+Te,y2:ge+Te})}return he?fe.filter(he):fe}return this._forEachCell(U,Y,te,ne,this._queryCell,fe,{hitTest:ae,seenUids:{box:{},circle:{}}},he),ae?fe.length>0:fe}_queryCircle(U,Y,te,ne,ae){const he=U-te,fe=U+te,de=Y-te,ve=Y+te;if(fe<0||he>this.width||ve<0||de>this.height)return!ne&&[];const ge=[];return this._forEachCell(he,de,fe,ve,this._queryCellCircle,ge,{hitTest:ne,circle:{x:U,y:Y,radius:te},seenUids:{box:{},circle:{}}},ae),ne?ge.length>0:ge}query(U,Y,te,ne,ae){return this._query(U,Y,te,ne,!1,ae)}hitTest(U,Y,te,ne,ae){return this._query(U,Y,te,ne,!0,ae)}hitTestCircle(U,Y,te,ne){return this._queryCircle(U,Y,te,!0,ne)}_queryCell(U,Y,te,ne,ae,he,fe,de){const ve=fe.seenUids,ge=this.boxCells[ae];if(ge!==null){const Pe=this.bboxes;for(const Le of ge)if(!ve.box[Le]){ve.box[Le]=!0;const ke=4*Le;if(U<=Pe[ke+2]&&Y<=Pe[ke+3]&&te>=Pe[ke+0]&&ne>=Pe[ke+1]&&(!de||de(this.boxKeys[Le]))){if(fe.hitTest)return he.push(!0),!0;he.push({key:this.boxKeys[Le],x1:Pe[ke],y1:Pe[ke+1],x2:Pe[ke+2],y2:Pe[ke+3]})}}}const Te=this.circleCells[ae];if(Te!==null){const Pe=this.circles;for(const Le of Te)if(!ve.circle[Le]){ve.circle[Le]=!0;const ke=3*Le;if(this._circleAndRectCollide(Pe[ke],Pe[ke+1],Pe[ke+2],U,Y,te,ne)&&(!de||de(this.circleKeys[Le]))){if(fe.hitTest)return he.push(!0),!0;{const Be=Pe[ke],Ne=Pe[ke+1],Se=Pe[ke+2];he.push({key:this.circleKeys[Le],x1:Be-Se,y1:Ne-Se,x2:Be+Se,y2:Ne+Se})}}}}}_queryCellCircle(U,Y,te,ne,ae,he,fe,de){const ve=fe.circle,ge=fe.seenUids,Te=this.boxCells[ae];if(Te!==null){const Le=this.bboxes;for(const ke of Te)if(!ge.box[ke]){ge.box[ke]=!0;const Be=4*ke;if(this._circleAndRectCollide(ve.x,ve.y,ve.radius,Le[Be+0],Le[Be+1],Le[Be+2],Le[Be+3])&&(!de||de(this.boxKeys[ke])))return he.push(!0),!0}}const Pe=this.circleCells[ae];if(Pe!==null){const Le=this.circles;for(const ke of Pe)if(!ge.circle[ke]){ge.circle[ke]=!0;const Be=3*ke;if(this._circlesCollide(Le[Be],Le[Be+1],Le[Be+2],ve.x,ve.y,ve.radius)&&(!de||de(this.circleKeys[ke])))return he.push(!0),!0}}}_forEachCell(U,Y,te,ne,ae,he,fe,de){const ve=this._convertToXCellCoord(U),ge=this._convertToYCellCoord(Y),Te=this._convertToXCellCoord(te),Pe=this._convertToYCellCoord(ne);for(let Le=ve;Le<=Te;Le++)for(let ke=ge;ke<=Pe;ke++)if(ae.call(this,U,Y,te,ne,this.xCellCount*ke+Le,he,fe,de))return}_convertToXCellCoord(U){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(U*this.xScale)))}_convertToYCellCoord(U){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(U*this.yScale)))}_circlesCollide(U,Y,te,ne,ae,he){const fe=ne-U,de=ae-Y,ve=te+he;return ve*ve>fe*fe+de*de}_circleAndRectCollide(U,Y,te,ne,ae,he,fe){const de=(he-ne)/2,ve=Math.abs(U-(ne+de));if(ve>de+te)return!1;const ge=(fe-ae)/2,Te=Math.abs(Y-(ae+ge));if(Te>ge+te)return!1;if(ve<=de||Te<=ge)return!0;const Pe=ve-de,Le=Te-ge;return Pe*Pe+Le*Le<=te*te}}const to={unknown:0,flipRequired:1,flipNotRequired:2},Ca=Math.tan(85*Math.PI/180);function Et(Q,U,Y,te,ne,ae,he){const fe=H.create();if(Y)if(ae.name==="globe"){const de=H.calculateGlobeLabelMatrix(ne,U);H.multiply(fe,fe,de)}else{const de=zt([],he);fe[0]=de[0],fe[1]=de[1],fe[4]=de[2],fe[5]=de[3],te||H.rotateZ(fe,fe,ne.angle)}else H.multiply(fe,ne.labelPlaneMatrix,Q);return fe}function ro(Q,U,Y,te,ne,ae,he){const fe=Et(Q,U,Y,te,ne,ae,he);return ae.name==="globe"&&Y||(fe[2]=fe[6]=fe[10]=fe[14]=0),fe}function Oi(Q,U,Y,te,ne,ae,he){if(Y){if(ae.name==="globe"){const fe=Et(Q,U,Y,te,ne,ae,he);return H.invert(fe,fe),H.multiply(fe,Q,fe),fe}{const fe=H.clone(Q),de=H.identity([]);return de[0]=he[0],de[1]=he[1],de[4]=he[2],de[5]=he[3],H.multiply(fe,fe,de),te||H.rotateZ(fe,fe,-ne.angle),fe}}return ne.glCoordMatrix}function Ui(Q,U,Y,te){const ne=[Q,U,Y,1];Y?H.transformMat4$1(ne,ne,te):Dr(ne,ne,te);const ae=ne[3];return ne[0]/=ae,ne[1]/=ae,ne[2]/=ae,ne}function Kc(Q,U){return Math.min(.5+Q/U*.5,1.5)}function Gn(Q,U){const Y=Q[0]/Q[3],te=Q[1]/Q[3];return Y>=-U[0]&&Y<=U[0]&&te>=-U[1]&&te<=U[1]}function $l(Q,U,Y,te,ne,ae,he,fe,de,ve){const ge=Y.transform,Te=te?Q.textSizeData:Q.iconSizeData,Pe=H.evaluateSizeForZoom(Te,Y.transform.zoom),Le=ge.projection.name==="globe",ke=[256/Y.width*2+1,256/Y.height*2+1],Be=te?Q.text.dynamicLayoutVertexArray:Q.icon.dynamicLayoutVertexArray;Be.clear();let Ne=null;Le&&(Ne=te?Q.text.globeExtVertexArray:Q.icon.globeExtVertexArray);const Se=Q.lineVertexArray,De=te?Q.text.placedSymbolArray:Q.icon.placedSymbolArray,Ve=Y.transform.width/Y.transform.height;let Ge,Qe=!1;for(let tt=0;tt<De.length;tt++){const et=De.get(tt),{numGlyphs:at,writingMode:nt}=et;if(nt!==H.WritingMode.vertical||Qe||Ge===H.WritingMode.horizontal||(Qe=!0),Ge=nt,(et.hidden||nt===H.WritingMode.vertical)&&!Qe){Dn(at,Be);continue}Qe=!1;const pt=new H.Point(et.tileAnchorX,et.tileAnchorY);let{x:kt,y:ct,z:At}=ge.projection.projectTilePoint(pt.x,pt.y,ve.canonical);if(de){const[_r,rr,fr]=de(pt);kt+=_r,ct+=rr,At+=fr}const yt=[kt,ct,At,1];if(H.transformMat4$1(yt,yt,U),!Gn(yt,ke)){Dn(at,Be);continue}const Bt=Kc(Y.transform.cameraToCenterDistance,yt[3]),ft=H.evaluateSizeForFeature(Te,Pe,et),St=he?ft/Bt:ft*Bt,Ft=Ui(kt,ct,At,ne);if(Ft[3]<=0){Dn(at,Be);continue}let Mt={};const Ut=he?null:de,lr=Qt(et,St,!1,fe,U,ne,ae,Q.glyphOffsetArray,Se,Be,Ne,Ft,pt,Mt,Ve,Ut,ge.projection,ve,he);Qe=lr.useVertical,Ut&&lr.needsFlipping&&(Mt={}),(lr.notEnoughRoom||Qe||lr.needsFlipping&&Qt(et,St,!0,fe,U,ne,ae,Q.glyphOffsetArray,Se,Be,Ne,Ft,pt,Mt,Ve,Ut,ge.projection,ve,he).notEnoughRoom)&&Dn(at,Be)}te?(Q.text.dynamicLayoutVertexBuffer.updateData(Be),Ne&&Q.text.globeExtVertexBuffer.updateData(Ne)):(Q.icon.dynamicLayoutVertexBuffer.updateData(Be),Ne&&Q.icon.globeExtVertexBuffer.updateData(Ne))}function Zc(Q,U,Y,te,ne,ae,he,fe,de,ve,ge,Te,Pe,Le,ke,Be){const{lineStartIndex:Ne,glyphStartIndex:Se,segment:De}=fe,Ve=Se+fe.numGlyphs,Ge=Ne+fe.lineLength,Qe=U.getoffsetX(Se),tt=U.getoffsetX(Ve-1),et=$n(Q*Qe,Y,te,ne,ae,he,De,Ne,Ge,de,ve,ge,Te,Pe,!0,Le,ke,Be);if(!et)return null;const at=$n(Q*tt,Y,te,ne,ae,he,De,Ne,Ge,de,ve,ge,Te,Pe,!0,Le,ke,Be);return at?{first:et,last:at}:null}function ea(Q,U,Y,te){return Q===H.WritingMode.horizontal&&Math.abs(te)>Math.abs(Y)?{useVertical:!0}:Q===H.WritingMode.vertical?te>0?{needsFlipping:!0}:null:U!==to.unknown&&function(ne,ae){return ne===0||Math.abs(ae/ne)>Ca}(Y,te)?U===to.flipRequired?{needsFlipping:!0}:null:Y<0?{needsFlipping:!0}:null}function Qt(Q,U,Y,te,ne,ae,he,fe,de,ve,ge,Te,Pe,Le,ke,Be,Ne,Se,De){const Ve=U/24,Ge=Q.lineOffsetX*Ve,Qe=Q.lineOffsetY*Ve,{lineStartIndex:tt,glyphStartIndex:et,numGlyphs:at,segment:nt,writingMode:pt,flipState:kt}=Q,ct=tt+Q.lineLength,At=yt=>{if(ge){const[Ft,Mt,Ut]=yt.up,lr=ve.length;H.updateGlobeVertexNormal(ge,lr+0,Ft,Mt,Ut),H.updateGlobeVertexNormal(ge,lr+1,Ft,Mt,Ut),H.updateGlobeVertexNormal(ge,lr+2,Ft,Mt,Ut),H.updateGlobeVertexNormal(ge,lr+3,Ft,Mt,Ut)}const[Bt,ft,St]=yt.point;H.addDynamicAttributes(ve,Bt,ft,St,yt.angle)};if(at>1){const yt=Zc(Ve,fe,Ge,Qe,Y,Te,Pe,Q,de,ae,Le,Be,!1,Ne,Se,De);if(!yt)return{notEnoughRoom:!0};if(te&&!Y){let[Bt,ft,St]=yt.first.point,[Ft,Mt,Ut]=yt.last.point;[Bt,ft]=Ui(Bt,ft,St,he),[Ft,Mt]=Ui(Ft,Mt,Ut,he);const lr=ea(pt,kt,(Ft-Bt)*ke,Mt-ft);if(Q.flipState=lr&&lr.needsFlipping?to.flipRequired:to.flipNotRequired,lr)return lr}At(yt.first);for(let Bt=et+1;Bt<et+at-1;Bt++){const ft=$n(Ve*fe.getoffsetX(Bt),Ge,Qe,Y,Te,Pe,nt,tt,ct,de,ae,Le,Be,!1,!1,Ne,Se,De);if(!ft)return ve.length-=4*(Bt-et),{notEnoughRoom:!0};At(ft)}At(yt.last)}else{if(te&&!Y){const Bt=Ui(Pe.x,Pe.y,0,ne),ft=tt+nt+1,St=new H.Point(de.getx(ft),de.gety(ft)),Ft=Ui(St.x,St.y,0,ne),Mt=Ft[3]>0?Ft:Mr(Pe,St,Bt,1,ne,void 0,Ne,Se.canonical),Ut=ea(pt,kt,(Mt[0]-Bt[0])*ke,Mt[1]-Bt[1]);if(Q.flipState=Ut&&Ut.needsFlipping?to.flipRequired:to.flipNotRequired,Ut)return Ut}const yt=$n(Ve*fe.getoffsetX(et),Ge,Qe,Y,Te,Pe,nt,tt,ct,de,ae,Le,Be,!1,!1,Ne,Se,De);if(!yt)return{notEnoughRoom:!0};At(yt)}return{}}function Br(Q,U,Y,te,ne){const{x:ae,y:he,z:fe}=te.projectTilePoint(Q.x,Q.y,U);if(!ne)return Ui(ae,he,fe,Y);const[de,ve,ge]=ne(Q);return Ui(ae+de,he+ve,fe+ge,Y)}function Mr(Q,U,Y,te,ne,ae,he,fe){const de=Br(Q.sub(U)._unit()._add(Q),fe,ne,he,ae);return H.sub(de,Y,de),H.normalize(de,de),H.scaleAndAdd(de,Y,de,te)}function $n(Q,U,Y,te,ne,ae,he,fe,de,ve,ge,Te,Pe,Le,ke,Be,Ne,Se){const De=te?Q-U:Q+U;let Ve=De>0?1:-1,Ge=0;te&&(Ve*=-1,Ge=Math.PI),Ve<0&&(Ge+=Math.PI);let Qe=fe+he+(Ve>0?0:1)|0,tt=ne,et=ne,at=0,nt=0;const pt=Math.abs(De),kt=[],ct=[];let At=ae,yt=At;const Bt=()=>Mr(yt,At,et,pt-at+1,ge,Pe,Be,Ne.canonical);for(;at+nt<=pt;){if(Qe+=Ve,Qe<fe||Qe>=de)return null;if(et=tt,yt=At,kt.push(et),Le&&ct.push(yt),At=new H.Point(ve.getx(Qe),ve.gety(Qe)),tt=Te[Qe],!tt){const fr=Br(At,Ne.canonical,ge,Be,Pe);tt=fr[3]>0?Te[Qe]=fr:Bt()}at+=nt,nt=H.distance(et,tt)}ke&&Pe&&(Te[Qe]&&(tt=Bt(),nt=H.distance(et,tt)),Te[Qe]=tt);const ft=(pt-at)/nt,St=At.sub(yt)._mult(ft)._add(yt),Ft=H.sub([],tt,et),Mt=H.scaleAndAdd([],et,Ft,ft);let Ut=[0,0,1],lr=Ft[0],_r=Ft[1];if(Se&&(Ut=Be.upVector(Ne.canonical,St.x,St.y),Ut[0]!==0||Ut[1]!==0||Ut[2]!==1)){const fr=[Ut[2],0,-Ut[0]],Lr=H.cross([],Ut,fr);H.normalize(fr,fr),H.normalize(Lr,Lr),lr=H.dot(Ft,fr),_r=H.dot(Ft,Lr)}if(Y){const fr=H.cross([],Ut,Ft);H.normalize(fr,fr),H.scaleAndAdd(Mt,Mt,fr,Y*Ve)}const rr=Ge+Math.atan2(_r,lr);return kt.push(Mt),Le&&ct.push(St),{point:Mt,angle:rr,path:kt,tilePath:ct,up:Ut}}function Dn(Q,U){const Y=U.length,te=Y+4*Q;U.resize(te),U.float32.fill(-1/0,4*Y,4*te)}function Dr(Q,U,Y){const te=U[0],ne=U[1];return Q[0]=Y[0]*te+Y[4]*ne+Y[12],Q[1]=Y[1]*te+Y[5]*ne+Y[13],Q[3]=Y[3]*te+Y[7]*ne+Y[15],Q}const xn=100;class Pa{constructor(U,Y,te=new Mo(U.width+200,U.height+200,25),ne=new Mo(U.width+200,U.height+200,25)){this.transform=U,this.grid=te,this.ignoredGrid=ne,this.pitchfactor=Math.cos(U._pitch)*U.cameraToCenterDistance,this.screenRightBoundary=U.width+xn,this.screenBottomBoundary=U.height+xn,this.gridRightBoundary=U.width+200,this.gridBottomBoundary=U.height+200,this.fogState=Y}placeCollisionBox(U,Y,te,ne,ae,he,fe,de){let ve=te.projectedAnchorX,ge=te.projectedAnchorY,Te=te.projectedAnchorZ;const Pe=te.elevation,Le=te.tileID,ke=U.getProjection();if(Pe&&Le){const[tt,et,at]=ke.upVector(Le.canonical,te.tileAnchorX,te.tileAnchorY),nt=ke.upVectorScale(Le.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;ve+=tt*Pe*nt,ge+=et*Pe*nt,Te+=at*Pe*nt}const Be=this.projectAndGetPerspectiveRatio(fe,ve,ge,Te,te.tileID,ke.name==="globe"||!!Pe||this.transform.pitch>0,ke),Ne=he*Be.perspectiveRatio,Se=(te.x1*Y+ne.x-te.padding)*Ne+Be.point.x,De=(te.y1*Y+ne.y-te.padding)*Ne+Be.point.y,Ve=(te.x2*Y+ne.x+te.padding)*Ne+Be.point.x,Ge=(te.y2*Y+ne.y+te.padding)*Ne+Be.point.y,Qe=Be.perspectiveRatio<=.55||Be.occluded;return!this.isInsideGrid(Se,De,Ve,Ge)||!ae&&this.grid.hitTest(Se,De,Ve,Ge,de)||Qe?{box:[],offscreen:!1,occluded:Be.occluded}:{box:[Se,De,Ve,Ge],offscreen:this.isOffscreen(Se,De,Ve,Ge),occluded:!1}}placeCollisionCircles(U,Y,te,ne,ae,he,fe,de,ve,ge,Te,Pe,Le,ke,Be){const Ne=[],Se=this.transform.elevation,De=U.getProjection(),Ve=Se?Se.getAtTileOffsetFunc(Be,this.transform.center.lat,this.transform.worldSize,De):null,Ge=new H.Point(te.tileAnchorX,te.tileAnchorY);let{x:Qe,y:tt,z:et}=De.projectTilePoint(Ge.x,Ge.y,Be.canonical);if(Ve){const[St,Ft,Mt]=Ve(Ge);Qe+=St,tt+=Ft,et+=Mt}const at=De.name==="globe",nt=this.projectAndGetPerspectiveRatio(fe,Qe,tt,et,Be,at||!!Se||this.transform.pitch>0,De),{perspectiveRatio:pt}=nt,kt=(Te?he/pt:he*pt)/H.ONE_EM,ct=Ui(Qe,tt,et,de),At=nt.signedDistanceFromCamera>0?Zc(kt,ae,te.lineOffsetX*kt,te.lineOffsetY*kt,!1,ct,Ge,te,ne,de,{},Se&&!Te?Ve:null,Te&&!!Se,De,Be,Te):null;let yt=!1,Bt=!1,ft=!0;if(At&&!nt.occluded){const St=.5*Le*pt+ke,Ft=new H.Point(-100,-100),Mt=new H.Point(this.screenRightBoundary,this.screenBottomBoundary),Ut=new vl,{first:lr,last:_r}=At,rr=lr.path.length;let fr=[];for(let or=rr-1;or>=1;or--)fr.push(lr.path[or]);for(let or=1;or<_r.path.length;or++)fr.push(_r.path[or]);const Lr=2.5*St;ve&&(fr=fr.map(([or,Kr,Qr],ei)=>(Ve&&!at&&(Qr=Ve(ei<rr-1?lr.tilePath[rr-1-ei]:_r.tilePath[ei-rr+2])[2]),Ui(or,Kr,Qr,ve))),fr.some(or=>or[3]<=0)&&(fr=[]));let Pr=[];if(fr.length>0){let or=1/0,Kr=-1/0,Qr=1/0,ei=-1/0;for(const ti of fr)or=Math.min(or,ti[0]),Qr=Math.min(Qr,ti[1]),Kr=Math.max(Kr,ti[0]),ei=Math.max(ei,ti[1]);Kr>=Ft.x&&or<=Mt.x&&ei>=Ft.y&&Qr<=Mt.y&&(Pr=[fr.map(ti=>new H.Point(ti[0],ti[1]))],(or<Ft.x||Kr>Mt.x||Qr<Ft.y||ei>Mt.y)&&(Pr=H.clipLine(Pr,Ft.x,Ft.y,Mt.x,Mt.y)))}for(const or of Pr){Ut.reset(or,.25*St);let Kr=0;Kr=Ut.length<=.5*St?1:Math.ceil(Ut.paddedLength/Lr)+1;for(let Qr=0;Qr<Kr;Qr++){const ei=Qr/Math.max(Kr-1,1),ti=Ut.lerp(ei),nn=ti.x+xn,Vi=ti.y+xn;Ne.push(nn,Vi,St,0);const An=nn-St,Kn=Vi-St,_i=nn+St,ri=Vi+St;if(ft=ft&&this.isOffscreen(An,Kn,_i,ri),Bt=Bt||this.isInsideGrid(An,Kn,_i,ri),!Y&&this.grid.hitTestCircle(nn,Vi,St,Pe)&&(yt=!0,!ge))return{circles:[],offscreen:!1,collisionDetected:yt,occluded:!1}}}}return{circles:!ge&&yt||!Bt?[]:Ne,offscreen:ft,collisionDetected:yt,occluded:nt.occluded}}queryRenderedSymbols(U){if(U.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const Y=[];let te=1/0,ne=1/0,ae=-1/0,he=-1/0;for(const ge of U){const Te=new H.Point(ge.x+xn,ge.y+xn);te=Math.min(te,Te.x),ne=Math.min(ne,Te.y),ae=Math.max(ae,Te.x),he=Math.max(he,Te.y),Y.push(Te)}const fe=this.grid.query(te,ne,ae,he).concat(this.ignoredGrid.query(te,ne,ae,he)),de={},ve={};for(const ge of fe){const Te=ge.key;if(de[Te.bucketInstanceId]===void 0&&(de[Te.bucketInstanceId]={}),de[Te.bucketInstanceId][Te.featureIndex])continue;const Pe=[new H.Point(ge.x1,ge.y1),new H.Point(ge.x2,ge.y1),new H.Point(ge.x2,ge.y2),new H.Point(ge.x1,ge.y2)];H.polygonIntersectsPolygon(Y,Pe)&&(de[Te.bucketInstanceId][Te.featureIndex]=!0,ve[Te.bucketInstanceId]===void 0&&(ve[Te.bucketInstanceId]=[]),ve[Te.bucketInstanceId].push(Te.featureIndex))}return ve}insertCollisionBox(U,Y,te,ne,ae){(Y?this.ignoredGrid:this.grid).insert({bucketInstanceId:te,featureIndex:ne,collisionGroupID:ae},U[0],U[1],U[2],U[3])}insertCollisionCircles(U,Y,te,ne,ae){const he=Y?this.ignoredGrid:this.grid,fe={bucketInstanceId:te,featureIndex:ne,collisionGroupID:ae};for(let de=0;de<U.length;de+=4)he.insertCircle(fe,U[de],U[de+1],U[de+2])}projectAndGetPerspectiveRatio(U,Y,te,ne,ae,he,fe){const de=[Y,te,ne,1];let ve=!1;ne||this.transform.pitch>0?(H.transformMat4$1(de,de,U),this.fogState&&ae&&fe.name!=="globe"&&(ve=function(Pe,Le,ke,Be,Ne,Se){const De=Se.calculateFogTileMatrix(Ne),Ve=[Le,ke,Be];return H.transformMat4(Ve,Ve,De),xt(Pe,Ve,Se.pitch,Se._fov)}(this.fogState,Y,te,ne,ae.toUnwrapped(),this.transform)>.9)):Dr(de,de,U);const ge=de[3];return{point:new H.Point((de[0]/ge+1)/2*this.transform.width+xn,(-de[1]/ge+1)/2*this.transform.height+xn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(fe)/ge*.5,1.5),signedDistanceFromCamera:ge,occluded:he&&de[2]>ge||ve}}isOffscreen(U,Y,te,ne){return te<xn||U>=this.screenRightBoundary||ne<xn||Y>this.screenBottomBoundary}isInsideGrid(U,Y,te,ne){return te>=0&&U<this.gridRightBoundary&&ne>=0&&Y<this.gridBottomBoundary}getViewportMatrix(){const U=H.identity([]);return H.translate(U,U,[-100,-100,0]),U}}function Do(Q,U,Y){const te=U.createTileMatrix(Q,Q.worldSize,Y.toUnwrapped());return H.multiply(new Float32Array(16),Q.projMatrix,te)}function En(Q,U,Y){if(U.projection.name===Y.projection.name)return Q.projMatrix;const te=Y.clone();return te.setProjection(U.projection),Do(te,U.getProjection(),Q)}function yi(Q,U,Y){return U.name===Y.projection.name?Q.projMatrix:Do(Y,U,Q)}class Xc{constructor(U,Y,te,ne){this.opacity=U?Math.max(0,Math.min(1,U.opacity+(U.placed?Y:-Y))):ne&&te?1:0,this.placed=te}isHidden(){return this.opacity===0&&!this.placed}}class io{constructor(U,Y,te,ne,ae,he=!1){this.text=new Xc(U?U.text:null,Y,te,ae),this.icon=new Xc(U?U.icon:null,Y,ne,ae),this.clipped=he}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ra{constructor(U,Y,te,ne=!1){this.text=U,this.icon=Y,this.skipFade=te,this.clipped=ne}}class Ma{constructor(){this.invProjMatrix=H.create(),this.viewportMatrix=H.create(),this.circles=[]}}class xl{constructor(U,Y,te,ne,ae){this.bucketInstanceId=U,this.featureIndex=Y,this.sourceLayerIndex=te,this.bucketIndex=ne,this.tileID=ae}}class Yc{constructor(U){this.crossSourceCollisions=U,this.maxGroupID=0,this.collisionGroups={}}get(U){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[U]){const Y=++this.maxGroupID;this.collisionGroups[U]={ID:Y,predicate:te=>te.collisionGroupID===Y}}return this.collisionGroups[U]}}function Da(Q,U,Y,te,ne){const{horizontalAlign:ae,verticalAlign:he}=H.getAnchorAlignment(Q),fe=-(ae-.5)*U,de=-(he-.5)*Y,ve=H.evaluateVariableOffset(Q,te);return new H.Point(fe+ve[0]*ne,de+ve[1]*ne)}function La(Q,U,Y,te,ne){const ae=new H.Point(Q,U);return Y&&ae._rotate(te?ne:-ne),ae}class $s{constructor(U,Y,te,ne,ae){this.transform=U.clone(),this.projection=U.projection.name,this.collisionIndex=new Pa(this.transform,ae),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=Y,this.retainedQueryData={},this.collisionGroups=new Yc(te),this.collisionCircleArrays={},this.prevPlacement=ne,ne&&(ne.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(U,Y,te,ne){const ae=te.getBucket(Y),he=te.latestFeatureIndex;if(!ae||!he||Y.id!==ae.layerIds[0])return;const fe=ae.layers[0].layout,de=te.collisionBoxArray,ve=Math.pow(2,this.transform.zoom-te.tileID.overscaledZ),ge=te.tileSize/H.EXTENT,Te=te.tileID.toUnwrapped();this.transform.setProjection(ae.projection);const Pe=(Le=te.tileID,ke=ae.getProjection(),Be=this.transform,ke.name===this.projection?Be.calculateProjMatrix(Le.toUnwrapped()):Do(Be,ke,Le));var Le,ke,Be;const Ne=fe.get("text-pitch-alignment")==="map",Se=fe.get("text-rotation-alignment")==="map";Y.compileFilter();const De=Y.dynamicFilter(),Ve=Y.dynamicFilterNeedsFeature(),Ge=this.transform.calculatePixelsToTileUnitsMatrix(te),Qe=ro(Pe,te.tileID.canonical,Ne,Se,this.transform,ae.getProjection(),Ge);let tt=null;if(Ne){const nt=Oi(Pe,te.tileID.canonical,Ne,Se,this.transform,ae.getProjection(),Ge);tt=H.multiply([],this.transform.labelPlaneMatrix,nt)}let et=null;De&&te.latestFeatureIndex&&(et={unwrappedTileID:Te,dynamicFilter:De,dynamicFilterNeedsFeature:Ve,featureIndex:te.latestFeatureIndex}),this.retainedQueryData[ae.bucketInstanceId]=new xl(ae.bucketInstanceId,he,ae.sourceLayerIndex,ae.index,te.tileID);const at={bucket:ae,layout:fe,posMatrix:Pe,textLabelPlaneMatrix:Qe,labelToScreenMatrix:tt,clippingData:et,scale:ve,textPixelRatio:ge,holdingForFade:te.holdingForFade(),collisionBoxArray:de,partiallyEvaluatedTextSize:H.evaluateSizeForZoom(ae.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:H.evaluateSizeForZoom(ae.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(ae.sourceID)};if(ne)for(const nt of ae.sortKeyRanges){const{sortKey:pt,symbolInstanceStart:kt,symbolInstanceEnd:ct}=nt;U.push({sortKey:pt,symbolInstanceStart:kt,symbolInstanceEnd:ct,parameters:at})}else U.push({symbolInstanceStart:0,symbolInstanceEnd:ae.symbolInstances.length,parameters:at})}attemptAnchorPlacement(U,Y,te,ne,ae,he,fe,de,ve,ge,Te,Pe,Le,ke,Be,Ne,Se,De){const{textOffset0:Ve,textOffset1:Ge,crossTileID:Qe}=Pe,tt=[Ve,Ge],et=Da(U,te,ne,tt,ae),at=this.collisionIndex.placeCollisionBox(ke,ae,Y,La(et.x,et.y,he,fe,this.transform.angle),Te,de,ve,ge.predicate);if(Ne){const nt=ke.getSymbolInstanceIconSize(De,this.transform.zoom,Pe.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ke,nt,Ne,La(et.x,et.y,he,fe,this.transform.angle),Te,de,ve,ge.predicate).box.length===0)return}if(at.box.length>0){let nt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Qe]&&this.prevPlacement.placements[Qe]&&this.prevPlacement.placements[Qe].text&&(nt=this.prevPlacement.variableOffsets[Qe].anchor),this.variableOffsets[Qe]={textOffset:tt,width:te,height:ne,anchor:U,textScale:ae,prevAnchor:nt},this.markUsedJustification(ke,U,Pe,Be),ke.allowVerticalPlacement&&(this.markUsedOrientation(ke,Be,Pe),this.placedOrientations[Qe]=Be),{shift:et,placedGlyphBoxes:at}}}placeLayerBucketPart(U,Y,te,ne){const{bucket:ae,layout:he,posMatrix:fe,textLabelPlaneMatrix:de,labelToScreenMatrix:ve,clippingData:ge,textPixelRatio:Te,holdingForFade:Pe,collisionBoxArray:Le,partiallyEvaluatedTextSize:ke,partiallyEvaluatedIconSize:Be,collisionGroup:Ne}=U.parameters,Se=he.get("text-optional"),De=he.get("icon-optional"),Ve=he.get("text-allow-overlap"),Ge=he.get("icon-allow-overlap"),Qe=he.get("text-rotation-alignment")==="map",tt=he.get("text-pitch-alignment")==="map",et=he.get("icon-text-fit")!=="none",at=he.get("symbol-z-order")==="viewport-y";this.transform.setProjection(ae.projection);let nt=Ve&&(Ge||!ae.hasIconData()||De),pt=Ge&&(Ve||!ae.hasTextData()||Se);!ae.collisionArrays&&Le&&ae.deserializeCollisionBoxes(Le),te&&ne&&ae.updateCollisionDebugBuffers(this.transform.zoom,Le);const kt=(ct,At,yt)=>{const{crossTileID:Bt,numVerticalGlyphVertices:ft}=ct;if(ge){const _i={zoom:this.transform.zoom,pitch:this.transform.pitch};let ri=null;if(ge.dynamicFilterNeedsFeature){const Vr=this.retainedQueryData[ae.bucketInstanceId];ri=ge.featureIndex.loadFeature({featureIndex:ct.featureIndex,bucketIndex:Vr.bucketIndex,sourceLayerIndex:Vr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,ge.dynamicFilter)(_i,ri,this.retainedQueryData[ae.bucketInstanceId].tileID.canonical,new H.Point(ct.tileAnchorX,ct.tileAnchorY),this.transform.calculateDistanceTileData(ge.unwrappedTileID)))return this.placements[Bt]=new Ra(!1,!1,!1,!0),void Y.add(Bt)}if(Y.has(Bt))return;if(Pe)return void(this.placements[Bt]=new Ra(!1,!1,!1));let St=!1,Ft=!1,Mt=!0,Ut=!1,lr=!1,_r=null,rr={box:null,offscreen:null,occluded:null},fr={box:null,offscreen:null,occluded:null},Lr=null,Pr=null,or=null,Kr=0,Qr=0,ei=0;yt.textFeatureIndex?Kr=yt.textFeatureIndex:ct.useRuntimeCollisionCircles&&(Kr=ct.featureIndex),yt.verticalTextFeatureIndex&&(Qr=yt.verticalTextFeatureIndex);const ti=_i=>{_i.tileID=this.retainedQueryData[ae.bucketInstanceId].tileID;const ri=this.transform.elevation;(ri||_i.elevation)&&(_i.elevation=ri?ri.getAtTileOffset(_i.tileID,_i.tileAnchorX,_i.tileAnchorY):0)},nn=yt.textBox;if(nn){ti(nn);const _i=Vr=>{let Ci=H.WritingMode.horizontal;if(ae.allowVerticalPlacement&&!Vr&&this.prevPlacement){const cn=this.prevPlacement.placedOrientations[Bt];cn&&(this.placedOrientations[Bt]=cn,Ci=cn,this.markUsedOrientation(ae,Ci,ct))}return Ci},ri=(Vr,Ci)=>{if(ae.allowVerticalPlacement&&ft>0&&yt.verticalTextBox){for(const cn of ae.writingModes)if(cn===H.WritingMode.vertical?(rr=Ci(),fr=rr):rr=Vr(),rr&&rr.box&&rr.box.length)break}else rr=Vr()};if(he.get("text-variable-anchor")){let Vr=he.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Bt]){const mi=this.prevPlacement.variableOffsets[Bt];Vr.indexOf(mi.anchor)>0&&(Vr=Vr.filter(pn=>pn!==mi.anchor),Vr.unshift(mi.anchor))}const Ci=(mi,pn,Hs)=>{const jo=ae.getSymbolInstanceTextSize(ke,ct,this.transform.zoom,At),ts=(mi.x2-mi.x1)*jo+2*mi.padding,uo=(mi.y2-mi.y1)*jo+2*mi.padding,wo=et&&!Ge?pn:null;wo&&ti(wo);let Vo={box:[],offscreen:!1,occluded:!1};const Ks=Ve?2*Vr.length:Vr.length;for(let rs=0;rs<Ks;++rs){const hc=this.attemptAnchorPlacement(Vr[rs%Vr.length],mi,ts,uo,jo,Qe,tt,Te,fe,Ne,rs>=Vr.length,ct,At,ae,Hs,wo,ke,Be);if(hc&&(Vo=hc.placedGlyphBoxes,Vo&&Vo.box&&Vo.box.length)){St=!0,_r=hc.shift;break}}return Vo};ri(()=>Ci(nn,yt.iconBox,H.WritingMode.horizontal),()=>{const mi=yt.verticalTextBox;return mi&&ti(mi),ae.allowVerticalPlacement&&!(rr&&rr.box&&rr.box.length)&&ft>0&&mi?Ci(mi,yt.verticalIconBox,H.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),rr&&(St=rr.box,Mt=rr.offscreen,Ut=rr.occluded);const cn=_i(!(!rr||!rr.box));if(!St&&this.prevPlacement){const mi=this.prevPlacement.variableOffsets[Bt];mi&&(this.variableOffsets[Bt]=mi,this.markUsedJustification(ae,mi.anchor,ct,cn))}}else{const Vr=(Ci,cn)=>{const mi=ae.getSymbolInstanceTextSize(ke,ct,this.transform.zoom,At),pn=this.collisionIndex.placeCollisionBox(ae,mi,Ci,new H.Point(0,0),Ve,Te,fe,Ne.predicate);return pn&&pn.box&&pn.box.length&&(this.markUsedOrientation(ae,cn,ct),this.placedOrientations[Bt]=cn),pn};ri(()=>Vr(nn,H.WritingMode.horizontal),()=>{const Ci=yt.verticalTextBox;return ae.allowVerticalPlacement&&ft>0&&Ci?(ti(Ci),Vr(Ci,H.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),_i(!!(rr&&rr.box&&rr.box.length))}}if(Lr=rr,St=Lr&&Lr.box&&Lr.box.length>0,Mt=Lr&&Lr.offscreen,Ut=Lr&&Lr.occluded,ct.useRuntimeCollisionCircles){const _i=ae.text.placedSymbolArray.get(ct.centerJustifiedTextSymbolIndex>=0?ct.centerJustifiedTextSymbolIndex:ct.verticalPlacedTextSymbolIndex),ri=H.evaluateSizeForFeature(ae.textSizeData,ke,_i),Vr=he.get("text-padding");Pr=this.collisionIndex.placeCollisionCircles(ae,Ve,_i,ae.lineVertexArray,ae.glyphOffsetArray,ri,fe,de,ve,te,tt,Ne.predicate,ct.collisionCircleDiameter*ri/H.ONE_EM,Vr,this.retainedQueryData[ae.bucketInstanceId].tileID),St=Ve||Pr.circles.length>0&&!Pr.collisionDetected,Mt=Mt&&Pr.offscreen,Ut=Pr.occluded}if(yt.iconFeatureIndex&&(ei=yt.iconFeatureIndex),yt.iconBox){const _i=ri=>{ti(ri);const Vr=et&&_r?La(_r.x,_r.y,Qe,tt,this.transform.angle):new H.Point(0,0),Ci=ae.getSymbolInstanceIconSize(Be,this.transform.zoom,ct.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(ae,Ci,ri,Vr,Ge,Te,fe,Ne.predicate)};fr&&fr.box&&fr.box.length&&yt.verticalIconBox?(or=_i(yt.verticalIconBox),Ft=or.box.length>0):(or=_i(yt.iconBox),Ft=or.box.length>0),Mt=Mt&&or.offscreen,lr=or.occluded}const Vi=Se||ct.numHorizontalGlyphVertices===0&&ft===0,An=De||ct.numIconVertices===0;if(Vi||An?An?Vi||(Ft=Ft&&St):St=Ft&&St:Ft=St=Ft&&St,St&&Lr&&Lr.box&&this.collisionIndex.insertCollisionBox(Lr.box,he.get("text-ignore-placement"),ae.bucketInstanceId,fr&&fr.box&&Qr?Qr:Kr,Ne.ID),Ft&&or&&this.collisionIndex.insertCollisionBox(or.box,he.get("icon-ignore-placement"),ae.bucketInstanceId,ei,Ne.ID),Pr&&(St&&this.collisionIndex.insertCollisionCircles(Pr.circles,he.get("text-ignore-placement"),ae.bucketInstanceId,Kr,Ne.ID),te)){const _i=ae.bucketInstanceId;let ri=this.collisionCircleArrays[_i];ri===void 0&&(ri=this.collisionCircleArrays[_i]=new Ma);for(let Vr=0;Vr<Pr.circles.length;Vr+=4)ri.circles.push(Pr.circles[Vr+0]),ri.circles.push(Pr.circles[Vr+1]),ri.circles.push(Pr.circles[Vr+2]),ri.circles.push(Pr.collisionDetected?1:0)}const Kn=ae.projection.name!=="globe";nt=nt&&(Kn||!Ut),pt=pt&&(Kn||!lr),this.placements[Bt]=new Ra(St||nt,Ft||pt,Mt||ae.justReloaded),Y.add(Bt)};if(at){const ct=ae.getSortedSymbolIndexes(this.transform.angle);for(let At=ct.length-1;At>=0;--At){const yt=ct[At];kt(ae.symbolInstances.get(yt),yt,ae.collisionArrays[yt])}}else for(let ct=U.symbolInstanceStart;ct<U.symbolInstanceEnd;ct++)kt(ae.symbolInstances.get(ct),ct,ae.collisionArrays[ct]);if(te&&ae.bucketInstanceId in this.collisionCircleArrays){const ct=this.collisionCircleArrays[ae.bucketInstanceId];H.invert(ct.invProjMatrix,fe),ct.viewportMatrix=this.collisionIndex.getViewportMatrix()}ae.justReloaded=!1}markUsedJustification(U,Y,te,ne){const{leftJustifiedTextSymbolIndex:ae,centerJustifiedTextSymbolIndex:he,rightJustifiedTextSymbolIndex:fe,verticalPlacedTextSymbolIndex:de,crossTileID:ve}=te,ge=H.getAnchorJustification(Y),Te=ne===H.WritingMode.vertical?de:ge==="left"?ae:ge==="center"?he:ge==="right"?fe:-1;ae>=0&&(U.text.placedSymbolArray.get(ae).crossTileID=Te>=0&&ae!==Te?0:ve),he>=0&&(U.text.placedSymbolArray.get(he).crossTileID=Te>=0&&he!==Te?0:ve),fe>=0&&(U.text.placedSymbolArray.get(fe).crossTileID=Te>=0&&fe!==Te?0:ve),de>=0&&(U.text.placedSymbolArray.get(de).crossTileID=Te>=0&&de!==Te?0:ve)}markUsedOrientation(U,Y,te){const ne=Y===H.WritingMode.horizontal||Y===H.WritingMode.horizontalOnly?Y:0,ae=Y===H.WritingMode.vertical?Y:0,{leftJustifiedTextSymbolIndex:he,centerJustifiedTextSymbolIndex:fe,rightJustifiedTextSymbolIndex:de,verticalPlacedTextSymbolIndex:ve}=te,ge=U.text.placedSymbolArray;he>=0&&(ge.get(he).placedOrientation=ne),fe>=0&&(ge.get(fe).placedOrientation=ne),de>=0&&(ge.get(de).placedOrientation=ne),ve>=0&&(ge.get(ve).placedOrientation=ae)}commit(U){this.commitTime=U,this.zoomAtLastRecencyCheck=this.transform.zoom;const Y=this.prevPlacement;let te=!1;this.prevZoomAdjustment=Y?Y.zoomAdjustment(this.transform.zoom):0;const ne=Y?Y.symbolFadeChange(U):1,ae=Y?Y.opacities:{},he=Y?Y.variableOffsets:{},fe=Y?Y.placedOrientations:{};for(const de in this.placements){const ve=this.placements[de],ge=ae[de];ge?(this.opacities[de]=new io(ge,ne,ve.text,ve.icon,null,ve.clipped),te=te||ve.text!==ge.text.placed||ve.icon!==ge.icon.placed):(this.opacities[de]=new io(null,ne,ve.text,ve.icon,ve.skipFade,ve.clipped),te=te||ve.text||ve.icon)}for(const de in ae){const ve=ae[de];if(!this.opacities[de]){const ge=new io(ve,ne,!1,!1);ge.isHidden()||(this.opacities[de]=ge,te=te||ve.text.placed||ve.icon.placed)}}for(const de in he)this.variableOffsets[de]||!this.opacities[de]||this.opacities[de].isHidden()||(this.variableOffsets[de]=he[de]);for(const de in fe)this.placedOrientations[de]||!this.opacities[de]||this.opacities[de].isHidden()||(this.placedOrientations[de]=fe[de]);te?this.lastPlacementChangeTime=U:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=Y?Y.lastPlacementChangeTime:U)}updateLayerOpacities(U,Y){const te=new Set;for(const ne of Y){const ae=ne.getBucket(U);ae&&ne.latestFeatureIndex&&U.id===ae.layerIds[0]&&this.updateBucketOpacities(ae,te,ne.collisionBoxArray)}}updateBucketOpacities(U,Y,te){U.hasTextData()&&U.text.opacityVertexArray.clear(),U.hasIconData()&&U.icon.opacityVertexArray.clear(),U.hasIconCollisionBoxData()&&U.iconCollisionBox.collisionVertexArray.clear(),U.hasTextCollisionBoxData()&&U.textCollisionBox.collisionVertexArray.clear();const ne=U.layers[0].layout,ae=!!U.layers[0].dynamicFilter(),he=new io(null,0,!1,!1,!0),fe=ne.get("text-allow-overlap"),de=ne.get("icon-allow-overlap"),ve=ne.get("text-variable-anchor"),ge=ne.get("text-rotation-alignment")==="map",Te=ne.get("text-pitch-alignment")==="map",Pe=ne.get("icon-text-fit")!=="none",Le=new io(null,0,fe&&(de||!U.hasIconData()||ne.get("icon-optional")),de&&(fe||!U.hasTextData()||ne.get("text-optional")),!0);!U.collisionArrays&&te&&(U.hasIconCollisionBoxData()||U.hasTextCollisionBoxData())&&U.deserializeCollisionBoxes(te);const ke=(Ne,Se,De)=>{for(let Ve=0;Ve<Se/4;Ve++)Ne.opacityVertexArray.emplaceBack(De)};let Be=0;for(let Ne=0;Ne<U.symbolInstances.length;Ne++){const Se=U.symbolInstances.get(Ne),{numHorizontalGlyphVertices:De,numVerticalGlyphVertices:Ve,crossTileID:Ge,numIconVertices:Qe}=Se,tt=Y.has(Ge);let et=this.opacities[Ge];tt?et=he:et||(et=Le,this.opacities[Ge]=et),Y.add(Ge);const at=De>0||Ve>0,nt=Qe>0,pt=this.placedOrientations[Ge],kt=pt===H.WritingMode.vertical,ct=pt===H.WritingMode.horizontal||pt===H.WritingMode.horizontalOnly;if(!at&&!nt||et.isHidden()||Be++,at){const At=Ba(et.text);ke(U.text,De,kt?wi:At),ke(U.text,Ve,ct?wi:At);const yt=et.text.isHidden(),{leftJustifiedTextSymbolIndex:Bt,centerJustifiedTextSymbolIndex:ft,rightJustifiedTextSymbolIndex:St,verticalPlacedTextSymbolIndex:Ft}=Se,Mt=U.text.placedSymbolArray,Ut=yt||kt?1:0;Bt>=0&&(Mt.get(Bt).hidden=Ut),ft>=0&&(Mt.get(ft).hidden=Ut),St>=0&&(Mt.get(St).hidden=Ut),Ft>=0&&(Mt.get(Ft).hidden=yt||ct?1:0);const lr=this.variableOffsets[Ge];lr&&this.markUsedJustification(U,lr.anchor,Se,pt);const _r=this.placedOrientations[Ge];_r&&(this.markUsedJustification(U,"left",Se,_r),this.markUsedOrientation(U,_r,Se))}if(nt){const At=Ba(et.icon),{placedIconSymbolIndex:yt,verticalPlacedIconSymbolIndex:Bt}=Se,ft=U.icon.placedSymbolArray,St=et.icon.isHidden()?1:0;yt>=0&&(ke(U.icon,Qe,kt?wi:At),ft.get(yt).hidden=St),Bt>=0&&(ke(U.icon,Se.numVerticalIconVertices,ct?wi:At),ft.get(Bt).hidden=St)}if(U.hasIconCollisionBoxData()||U.hasTextCollisionBoxData()){const At=U.collisionArrays[Ne];if(At){let yt=new H.Point(0,0),Bt=!0;if(At.textBox||At.verticalTextBox){if(ve){const St=this.variableOffsets[Ge];St?(yt=Da(St.anchor,St.width,St.height,St.textOffset,St.textScale),ge&&yt._rotate(Te?this.transform.angle:-this.transform.angle)):Bt=!1}ae&&(Bt=!et.clipped),At.textBox&&ta(U.textCollisionBox.collisionVertexArray,et.text.placed,!Bt||kt,yt.x,yt.y),At.verticalTextBox&&ta(U.textCollisionBox.collisionVertexArray,et.text.placed,!Bt||ct,yt.x,yt.y)}const ft=Bt&&!!(!ct&&At.verticalIconBox);At.iconBox&&ta(U.iconCollisionBox.collisionVertexArray,et.icon.placed,ft,Pe?yt.x:0,Pe?yt.y:0),At.verticalIconBox&&ta(U.iconCollisionBox.collisionVertexArray,et.icon.placed,!ft,Pe?yt.x:0,Pe?yt.y:0)}}}if(U.fullyClipped=Be===0,U.sortFeatures(this.transform.angle),this.retainedQueryData[U.bucketInstanceId]&&(this.retainedQueryData[U.bucketInstanceId].featureSortOrder=U.featureSortOrder),U.hasTextData()&&U.text.opacityVertexBuffer&&U.text.opacityVertexBuffer.updateData(U.text.opacityVertexArray),U.hasIconData()&&U.icon.opacityVertexBuffer&&U.icon.opacityVertexBuffer.updateData(U.icon.opacityVertexArray),U.hasIconCollisionBoxData()&&U.iconCollisionBox.collisionVertexBuffer&&U.iconCollisionBox.collisionVertexBuffer.updateData(U.iconCollisionBox.collisionVertexArray),U.hasTextCollisionBoxData()&&U.textCollisionBox.collisionVertexBuffer&&U.textCollisionBox.collisionVertexBuffer.updateData(U.textCollisionBox.collisionVertexArray),U.bucketInstanceId in this.collisionCircleArrays){const Ne=this.collisionCircleArrays[U.bucketInstanceId];U.placementInvProjMatrix=Ne.invProjMatrix,U.placementViewportMatrix=Ne.viewportMatrix,U.collisionCircleArray=Ne.circles,delete this.collisionCircleArrays[U.bucketInstanceId]}}symbolFadeChange(U){return this.fadeDuration===0?1:(U-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(U){return Math.max(0,(this.transform.zoom-U)/1.5)}hasTransitions(U){return this.stale||U-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(U,Y){const te=this.zoomAtLastRecencyCheck===Y?1-this.zoomAdjustment(Y):1;return this.zoomAtLastRecencyCheck=Y,this.commitTime+this.fadeDuration*te>U}setStale(){this.stale=!0}}function ta(Q,U,Y,te,ne){Q.emplaceBack(U?1:0,Y?1:0,te||0,ne||0),Q.emplaceBack(U?1:0,Y?1:0,te||0,ne||0),Q.emplaceBack(U?1:0,Y?1:0,te||0,ne||0),Q.emplaceBack(U?1:0,Y?1:0,te||0,ne||0)}const hn=Math.pow(2,25),Si=Math.pow(2,24),bl=Math.pow(2,17),wl=Math.pow(2,16),fn=Math.pow(2,9),Tn=Math.pow(2,8),Jc=Math.pow(2,1);function Ba(Q){if(Q.opacity===0&&!Q.placed)return 0;if(Q.opacity===1&&Q.placed)return 4294967295;const U=Q.placed?1:0,Y=Math.floor(127*Q.opacity);return Y*hn+U*Si+Y*bl+U*wl+Y*fn+U*Tn+Y*Jc+U}const wi=0;class ka{constructor(U){this._sortAcrossTiles=U.layout.get("symbol-z-order")!=="viewport-y"&&U.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(U,Y,te,ne,ae){const he=this._bucketParts;for(;this._currentTileIndex<U.length;)if(Y.getBucketParts(he,ne,U[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,ae())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,he.sort((fe,de)=>fe.sortKey-de.sortKey));this._currentPartIndex<he.length;){const fe=he[this._currentPartIndex];if(Y.placeLayerBucketPart(fe,this._seenCrossTileIDs,te,fe.symbolInstanceStart===0),this._currentPartIndex++,ae())return!0}return!1}}class El{constructor(U,Y,te,ne,ae,he,fe,de){this.placement=new $s(U,ae,he,fe,de),this._currentPlacementIndex=Y.length-1,this._forceFullPlacement=te,this._showCollisionBoxes=ne,this._done=!1}isDone(){return this._done}continuePlacement(U,Y,te){const ne=H.exported.now(),ae=()=>{const he=H.exported.now()-ne;return!this._forceFullPlacement&&he>2};for(;this._currentPlacementIndex>=0;){const he=Y[U[this._currentPlacementIndex]],fe=this.placement.collisionIndex.transform.zoom;if(he.type==="symbol"&&(!he.minzoom||he.minzoom<=fe)&&(!he.maxzoom||he.maxzoom>fe)){if(this._inProgressLayer||(this._inProgressLayer=new ka(he)),this._inProgressLayer.continuePlacement(te[he.source],this.placement,this._showCollisionBoxes,he,ae))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(U){return this.placement.commit(U),this.placement}}const Lo=512/H.EXTENT/2;class Ki{constructor(U,Y,te){this.tileID=U,this.bucketInstanceId=te,this.index=new H.KDBush(Y.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const ne=U.canonical.x*H.EXTENT,ae=U.canonical.y*H.EXTENT;for(let he=0;he<Y.length;he++){const{key:fe,crossTileID:de,tileAnchorX:ve,tileAnchorY:ge}=Y.get(he),Te=Math.floor((ne+ve)*Lo),Pe=Math.floor((ae+ge)*Lo);this.index.add(Te,Pe),this.keys.push(fe),this.crossTileIDs.push(de)}this.index.finish()}findMatches(U,Y,te){const ne=this.tileID.canonical.z<Y.canonical.z?1:Math.pow(2,this.tileID.canonical.z-Y.canonical.z),ae=Lo/Math.pow(2,Y.canonical.z-this.tileID.canonical.z),he=Y.canonical.x*H.EXTENT,fe=Y.canonical.y*H.EXTENT;for(let de=0;de<U.length;de++){const ve=U.get(de);if(ve.crossTileID)continue;const{key:ge,tileAnchorX:Te,tileAnchorY:Pe}=ve,Le=Math.floor((he+Te)*ae),ke=Math.floor((fe+Pe)*ae),Be=this.index.range(Le-ne,ke-ne,Le+ne,ke+ne);for(const Ne of Be){const Se=this.crossTileIDs[Ne];if(this.keys[Ne]===ge&&!te.has(Se)){te.add(Se),ve.crossTileID=Se;break}}}}}class Tl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Sl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(U){const Y=Math.round((U-this.lng)/360);if(Y!==0)for(const te in this.indexes){const ne=this.indexes[te],ae={};for(const he in ne){const fe=ne[he];fe.tileID=fe.tileID.unwrapTo(fe.tileID.wrap+Y),ae[fe.tileID.key]=fe}this.indexes[te]=ae}this.lng=U}addBucket(U,Y,te){if(this.indexes[U.overscaledZ]&&this.indexes[U.overscaledZ][U.key]){if(this.indexes[U.overscaledZ][U.key].bucketInstanceId===Y.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(U.overscaledZ,this.indexes[U.overscaledZ][U.key])}for(let ae=0;ae<Y.symbolInstances.length;ae++)Y.symbolInstances.get(ae).crossTileID=0;this.usedCrossTileIDs[U.overscaledZ]||(this.usedCrossTileIDs[U.overscaledZ]=new Set);const ne=this.usedCrossTileIDs[U.overscaledZ];for(const ae in this.indexes){const he=this.indexes[ae];if(Number(ae)>U.overscaledZ)for(const fe in he){const de=he[fe];de.tileID.isChildOf(U)&&de.findMatches(Y.symbolInstances,U,ne)}else{const fe=he[U.scaledTo(Number(ae)).key];fe&&fe.findMatches(Y.symbolInstances,U,ne)}}for(let ae=0;ae<Y.symbolInstances.length;ae++){const he=Y.symbolInstances.get(ae);he.crossTileID||(he.crossTileID=te.generate(),ne.add(he.crossTileID))}return this.indexes[U.overscaledZ]===void 0&&(this.indexes[U.overscaledZ]={}),this.indexes[U.overscaledZ][U.key]=new Ki(U,Y.symbolInstances,Y.bucketInstanceId),!0}removeBucketCrossTileIDs(U,Y){for(const te of Y.crossTileIDs)this.usedCrossTileIDs[U].delete(te)}removeStaleBuckets(U){let Y=!1;for(const te in this.indexes){const ne=this.indexes[te];for(const ae in ne)U[ne[ae].bucketInstanceId]||(this.removeBucketCrossTileIDs(te,ne[ae]),delete ne[ae],Y=!0)}return Y}}class no{constructor(){this.layerIndexes={},this.crossTileIDs=new Tl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(U,Y,te,ne){let ae=this.layerIndexes[U.id];ae===void 0&&(ae=this.layerIndexes[U.id]=new Sl);let he=!1;const fe={};ne.name!=="globe"&&ae.handleWrapJump(te);for(const de of Y){const ve=de.getBucket(U);ve&&U.id===ve.layerIds[0]&&(ve.bucketInstanceId||(ve.bucketInstanceId=++this.maxBucketInstanceId),ae.addBucket(de.tileID,ve,this.crossTileIDs)&&(he=!0),fe[ve.bucketInstanceId]=!0)}return ae.removeStaleBuckets(fe)&&(he=!0),he}pruneUnusedLayers(U){const Y={};U.forEach(te=>{Y[te]=!0});for(const te in this.layerIndexes)Y[te]||delete this.layerIndexes[te]}}const xo=(Q,U)=>H.emitValidationErrors(Q,U&&U.filter(Y=>Y.identifier!=="source.canvas")),xs=H.pick(qr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),vh=H.pick(qr,["setCenter","setZoom","setBearing","setPitch"]),Il={version:8,layers:[],sources:{}},ra={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Wn extends H.Evented{constructor(U,Y={}){super(),this.map=U,this.dispatcher=new It(Qo(),this),this.imageManager=new Ti,this.imageManager.setEventedParent(this),this.glyphManager=new H.GlyphManager(U._requestManager,Y.localFontFamily?H.LocalGlyphMode.all:Y.localIdeographFontFamily?H.LocalGlyphMode.ideographs:H.LocalGlyphMode.none,Y.localFontFamily||Y.localIdeographFontFamily),this.crossTileSymbolIndex=new no,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",H.getReferrer());const te=this;this._rtlTextPluginCallback=Wn.registerForPluginStateChange(ne=>{te.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:ne.pluginStatus,pluginURL:ne.pluginURL},(ae,he)=>{if(H.triggerPluginCompletionEvent(ae),he&&he.every(fe=>fe))for(const fe in te._sourceCaches){const de=te._sourceCaches[fe],ve=de.getSource().type;ve!=="vector"&&ve!=="geojson"||de.reload()}})}),this.on("data",ne=>{if(ne.dataType!=="source"||ne.sourceDataType!=="metadata")return;const ae=this.getSource(ne.sourceId);if(ae&&ae.vectorLayerIds)for(const he in this._layers){const fe=this._layers[he];fe.source===ae.id&&this._validateLayer(fe)}})}loadURL(U,Y={}){this.fire(new H.Event("dataloading",{dataType:"style"}));const te=typeof Y.validate=="boolean"?Y.validate:!H.isMapboxURL(U);U=this.map._requestManager.normalizeStyleURL(U,Y.accessToken);const ne=this.map._requestManager.transformRequest(U,H.ResourceType.Style);this._request=H.getJSON(ne,(ae,he)=>{this._request=null,ae?this.fire(new H.ErrorEvent(ae)):he&&this._load(he,te)})}loadJSON(U,Y={}){this.fire(new H.Event("dataloading",{dataType:"style"})),this._request=H.exported.frame(()=>{this._request=null,this._load(U,Y.validate!==!1)})}loadEmpty(){this.fire(new H.Event("dataloading",{dataType:"style"})),this._load(Il,!1)}_updateLayerCount(U,Y){const te=Y?1:-1;U.is3D()&&(this._num3DLayers+=te),U.type==="circle"&&(this._numCircleLayers+=te),U.type==="symbol"&&(this._numSymbolLayers+=te)}_load(U,Y){if(Y&&xo(this,H.validateStyle(U)))return;this._loaded=!0,this.stylesheet=H.clone$1(U),this._updateMapProjection();for(const ne in U.sources)this.addSource(ne,U.sources[ne],{validate:!1});this._changed=!1,U.sprite?this._loadSprite(U.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(U.glyphs);const te=Hc(this.stylesheet.layers);this._order=te.map(ne=>ne.id),this._layers={},this._serializedLayers={};for(const ne of te){const ae=H.createStyleLayer(ne);ae.setEventedParent(this,{layer:{id:ae.id}}),this._layers[ae.id]=ae,this._serializedLayers[ae.id]=ae.serialize(),this._updateLayerCount(ae,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new kr(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new H.Event("data",{dataType:"style"})),this.fire(new H.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(U){U?this.stylesheet.projection=U:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(U){this._spriteRequest=function(Y,te,ne){let ae,he,fe;const de=H.exported.devicePixelRatio>1?"@2x":"";let ve=H.getJSON(te.transformRequest(te.normalizeSpriteURL(Y,de,".json"),H.ResourceType.SpriteJSON),(Pe,Le)=>{ve=null,fe||(fe=Pe,ae=Le,Te())}),ge=H.getImage(te.transformRequest(te.normalizeSpriteURL(Y,de,".png"),H.ResourceType.SpriteImage),(Pe,Le)=>{ge=null,fe||(fe=Pe,he=Le,Te())});function Te(){if(fe)ne(fe);else if(ae&&he){const Pe=H.exported.getImageData(he),Le={};for(const ke in ae){const{width:Be,height:Ne,x:Se,y:De,sdf:Ve,pixelRatio:Ge,stretchX:Qe,stretchY:tt,content:et}=ae[ke],at=new H.RGBAImage({width:Be,height:Ne});H.RGBAImage.copy(Pe,at,{x:Se,y:De},{x:0,y:0},{width:Be,height:Ne}),Le[ke]={data:at,pixelRatio:Ge,sdf:Ve,stretchX:Qe,stretchY:tt,content:et}}ne(null,Le)}}return{cancel(){ve&&(ve.cancel(),ve=null),ge&&(ge.cancel(),ge=null)}}}(U,this.map._requestManager,(Y,te)=>{if(this._spriteRequest=null,Y)this.fire(new H.ErrorEvent(Y));else if(te)for(const ne in te)this.imageManager.addImage(ne,te[ne]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new H.Event("data",{dataType:"style"}))})}_validateLayer(U){const Y=this.getSource(U.source);if(!Y)return;const te=U.sourceLayer;te&&(Y.type==="geojson"||Y.vectorLayerIds&&Y.vectorLayerIds.indexOf(te)===-1)&&this.fire(new H.ErrorEvent(new Error(`Source layer "${te}" does not exist on source "${Y.id}" as specified by style layer "${U.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const U in this._sourceCaches)if(!this._sourceCaches[U].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(U){const Y=[];for(const te of U){const ne=this._layers[te];ne.type!=="custom"&&Y.push(ne.serialize())}return Y}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const U in this._sourceCaches)if(this._sourceCaches[U].hasTransition())return!0;for(const U in this._layers)if(this._layers[U].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(U){return!!this.terrain&&(typeof U.isLayerDraped=="function"?U.isLayerDraped():ra[U.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(U){if(!this._loaded)return;const Y=this._changed;if(this._changed){const ne=Object.keys(this._updatedLayers),ae=Object.keys(this._removedLayers);(ne.length||ae.length)&&this._updateWorkerLayers(ne,ae);for(const he in this._updatedSources){const fe=this._updatedSources[he];fe==="reload"?this._reloadSource(he):fe==="clear"&&this._clearSource(he)}this._updateTilesForChangedImages();for(const he in this._updatedPaintProps)this._layers[he].updateTransitions(U);this.light.updateTransitions(U),this.fog&&this.fog.updateTransitions(U),this._resetUpdates()}const te={};for(const ne in this._sourceCaches){const ae=this._sourceCaches[ne];te[ne]=ae.used,ae.used=!1}for(const ne of this._order){const ae=this._layers[ne];if(ae.recalculate(U,this._availableImages),!ae.isHidden(U.zoom)){const fe=this._getLayerSourceCache(ae);fe&&(fe.used=!0)}const he=this.map.painter;if(he){const fe=ae.getProgramIds();if(!fe)continue;const de=ae.getProgramConfiguration(U.zoom);for(const ve of fe)he.useProgram(ve,de)}}for(const ne in te){const ae=this._sourceCaches[ne];te[ne]!==ae.used&&ae.getSource().fire(new H.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ae.getSource().id}))}this.light.recalculate(U),this.terrain&&this.terrain.recalculate(U),this.fog&&this.fog.recalculate(U),this.z=U.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),Y&&this.fire(new H.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const U=Object.keys(this._changedImages);if(U.length){for(const Y in this._sourceCaches)this._sourceCaches[Y].reloadTilesForDependencies(["icons","patterns"],U);this._changedImages={}}}_updateWorkerLayers(U,Y){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(U),removedIds:Y})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(U){if(this._checkLoaded(),xo(this,H.validateStyle(U)))return!1;(U=H.clone$1(U)).layers=Hc(U.layers);const Y=function(ne,ae){if(!ne)return[{command:qr.setStyle,args:[ae]}];let he=[];try{if(!ye(ne.version,ae.version))return[{command:qr.setStyle,args:[ae]}];ye(ne.center,ae.center)||he.push({command:qr.setCenter,args:[ae.center]}),ye(ne.zoom,ae.zoom)||he.push({command:qr.setZoom,args:[ae.zoom]}),ye(ne.bearing,ae.bearing)||he.push({command:qr.setBearing,args:[ae.bearing]}),ye(ne.pitch,ae.pitch)||he.push({command:qr.setPitch,args:[ae.pitch]}),ye(ne.sprite,ae.sprite)||he.push({command:qr.setSprite,args:[ae.sprite]}),ye(ne.glyphs,ae.glyphs)||he.push({command:qr.setGlyphs,args:[ae.glyphs]}),ye(ne.transition,ae.transition)||he.push({command:qr.setTransition,args:[ae.transition]}),ye(ne.light,ae.light)||he.push({command:qr.setLight,args:[ae.light]}),ye(ne.fog,ae.fog)||he.push({command:qr.setFog,args:[ae.fog]}),ye(ne.projection,ae.projection)||he.push({command:qr.setProjection,args:[ae.projection]});const fe={},de=[];(function(Te,Pe,Le,ke){let Be;for(Be in Pe=Pe||{},Te=Te||{})Te.hasOwnProperty(Be)&&(Pe.hasOwnProperty(Be)||Oa(Be,Le,ke));for(Be in Pe){if(!Pe.hasOwnProperty(Be))continue;const Ne=Pe[Be];Te.hasOwnProperty(Be)?ye(Te[Be],Ne)||(Te[Be].type==="geojson"&&Ne.type==="geojson"&&vs(Te,Pe,Be)?Le.push({command:qr.setGeoJSONSourceData,args:[Be,Ne.data]}):_l(Be,Pe,Le,ke)):yl(Be,Pe,Le)}})(ne.sources,ae.sources,de,fe);const ve=[];ne.layers&&ne.layers.forEach(Te=>{Te.source&&fe[Te.source]?he.push({command:qr.removeLayer,args:[Te.id]}):ve.push(Te)});let ge=ne.terrain;ge&&fe[ge.source]&&(he.push({command:qr.setTerrain,args:[void 0]}),ge=void 0),he=he.concat(de),ye(ge,ae.terrain)||he.push({command:qr.setTerrain,args:[ae.terrain]}),function(Te,Pe,Le){Pe=Pe||[];const ke=(Te=Te||[]).map(eo),Be=Pe.map(eo),Ne=Te.reduce(gl,{}),Se=Pe.reduce(gl,{}),De=ke.slice(),Ve=Object.create(null);let Ge,Qe,tt,et,at,nt,pt;for(Ge=0,Qe=0;Ge<ke.length;Ge++)tt=ke[Ge],Se.hasOwnProperty(tt)?Qe++:(Le.push({command:qr.removeLayer,args:[tt]}),De.splice(De.indexOf(tt,Qe),1));for(Ge=0,Qe=0;Ge<Be.length;Ge++)tt=Be[Be.length-1-Ge],De[De.length-1-Ge]!==tt&&(Ne.hasOwnProperty(tt)?(Le.push({command:qr.removeLayer,args:[tt]}),De.splice(De.lastIndexOf(tt,De.length-Qe),1)):Qe++,nt=De[De.length-Ge],Le.push({command:qr.addLayer,args:[Se[tt],nt]}),De.splice(De.length-Ge,0,tt),Ve[tt]=!0);for(Ge=0;Ge<Be.length;Ge++)if(tt=Be[Ge],et=Ne[tt],at=Se[tt],!Ve[tt]&&!ye(et,at))if(ye(et.source,at.source)&&ye(et["source-layer"],at["source-layer"])&&ye(et.type,at.type)){for(pt in Vn(et.layout,at.layout,Le,tt,null,qr.setLayoutProperty),Vn(et.paint,at.paint,Le,tt,null,qr.setPaintProperty),ye(et.filter,at.filter)||Le.push({command:qr.setFilter,args:[tt,at.filter]}),ye(et.minzoom,at.minzoom)&&ye(et.maxzoom,at.maxzoom)||Le.push({command:qr.setLayerZoomRange,args:[tt,at.minzoom,at.maxzoom]}),et)et.hasOwnProperty(pt)&&pt!=="layout"&&pt!=="paint"&&pt!=="filter"&&pt!=="metadata"&&pt!=="minzoom"&&pt!=="maxzoom"&&(pt.indexOf("paint.")===0?Vn(et[pt],at[pt],Le,tt,pt.slice(6),qr.setPaintProperty):ye(et[pt],at[pt])||Le.push({command:qr.setLayerProperty,args:[tt,pt,at[pt]]}));for(pt in at)at.hasOwnProperty(pt)&&!et.hasOwnProperty(pt)&&pt!=="layout"&&pt!=="paint"&&pt!=="filter"&&pt!=="metadata"&&pt!=="minzoom"&&pt!=="maxzoom"&&(pt.indexOf("paint.")===0?Vn(et[pt],at[pt],Le,tt,pt.slice(6),qr.setPaintProperty):ye(et[pt],at[pt])||Le.push({command:qr.setLayerProperty,args:[tt,pt,at[pt]]}))}else Le.push({command:qr.removeLayer,args:[tt]}),nt=De[De.lastIndexOf(tt)+1],Le.push({command:qr.addLayer,args:[at,nt]})}(ve,ae.layers,he)}catch(fe){console.warn("Unable to compute style diff:",fe),he=[{command:qr.setStyle,args:[ae]}]}return he}(this.serialize(),U).filter(ne=>!(ne.command in vh));if(Y.length===0)return!1;const te=Y.filter(ne=>!(ne.command in xs));if(te.length>0)throw new Error(`Unimplemented: ${te.map(ne=>ne.command).join(", ")}.`);return Y.forEach(ne=>{ne.command!=="setTransition"&&ne.command!=="setProjection"&&this[ne.command].apply(this,ne.args)}),this.stylesheet=U,this._updateMapProjection(),!0}addImage(U,Y){return this.getImage(U)?this.fire(new H.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(U,Y),this._afterImageUpdated(U),this)}updateImage(U,Y){this.imageManager.updateImage(U,Y)}getImage(U){return this.imageManager.getImage(U)}removeImage(U){return this.getImage(U)?(this.imageManager.removeImage(U),this._afterImageUpdated(U),this):this.fire(new H.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(U){this._availableImages=this.imageManager.listImages(),this._changedImages[U]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new H.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(U,Y,te={}){if(this._checkLoaded(),this.getSource(U)!==void 0)throw new Error("There is already a source with this ID");if(!Y.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(Y).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(Y.type)>=0&&this._validate(H.validateSource,`sources.${U}`,Y,null,te))return;this.map&&this.map._collectResourceTiming&&(Y.collectResourceTiming=!0);const ne=Cr(U,Y,this.dispatcher,this);ne.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(U),source:ne.serialize(),sourceId:U}));const ae=he=>{const fe=(he?"symbol:":"other:")+U,de=this._sourceCaches[fe]=new H.SourceCache(fe,ne,he);(he?this._symbolSourceCaches:this._otherSourceCaches)[U]=de,de.style=this,de.onAdd(this.map)};ae(!1),Y.type!=="vector"&&Y.type!=="geojson"||ae(!0),ne.onAdd&&ne.onAdd(this.map),this._changed=!0}removeSource(U){this._checkLoaded();const Y=this.getSource(U);if(!Y)throw new Error("There is no source with this ID");for(const ne in this._layers)if(this._layers[ne].source===U)return this.fire(new H.ErrorEvent(new Error(`Source "${U}" cannot be removed while layer "${ne}" is using it.`)));if(this.terrain&&this.terrain.get().source===U)return this.fire(new H.ErrorEvent(new Error(`Source "${U}" cannot be removed while terrain is using it.`)));const te=this._getSourceCaches(U);for(const ne of te)delete this._sourceCaches[ne.id],delete this._updatedSources[ne.id],ne.fire(new H.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:ne.getSource().id})),ne.setEventedParent(null),ne.clearTiles();return delete this._otherSourceCaches[U],delete this._symbolSourceCaches[U],Y.setEventedParent(null),Y.onRemove&&Y.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(U,Y){this._checkLoaded(),this.getSource(U).setData(Y),this._changed=!0}getSource(U){const Y=this._getSourceCache(U);return Y&&Y.getSource()}_getSources(){const U=[];for(const Y in this._otherSourceCaches){const te=this._getSourceCache(Y);te&&U.push(te.getSource())}return U}addLayer(U,Y,te={}){this._checkLoaded();const ne=U.id;if(this.getLayer(ne))return void this.fire(new H.ErrorEvent(new Error(`Layer with id "${ne}" already exists on this map`)));let ae;if(U.type==="custom"){if(xo(this,H.validateCustomStyleLayer(U)))return;ae=H.createStyleLayer(U)}else{if(typeof U.source=="object"&&(this.addSource(ne,U.source),U=H.clone$1(U),U=H.extend(U,{source:ne})),this._validate(H.validateLayer,`layers.${ne}`,U,{arrayIndex:-1},te))return;ae=H.createStyleLayer(U),this._validateLayer(ae),ae.setEventedParent(this,{layer:{id:ne}}),this._serializedLayers[ae.id]=ae.serialize(),this._updateLayerCount(ae,!0)}const he=Y?this._order.indexOf(Y):this._order.length;if(Y&&he===-1)return void this.fire(new H.ErrorEvent(new Error(`Layer with id "${Y}" does not exist on this map.`)));this._order.splice(he,0,ne),this._layerOrderChanged=!0,this._layers[ne]=ae;const fe=this._getLayerSourceCache(ae);if(this._removedLayers[ne]&&ae.source&&fe&&ae.type!=="custom"){const de=this._removedLayers[ne];delete this._removedLayers[ne],de.type!==ae.type?this._updatedSources[ae.source]="clear":(this._updatedSources[ae.source]="reload",fe.pause())}this._updateLayer(ae),ae.onAdd&&ae.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(U,Y){if(this._checkLoaded(),this._changed=!0,!this._layers[U])return void this.fire(new H.ErrorEvent(new Error(`The layer '${U}' does not exist in the map's style and cannot be moved.`)));if(U===Y)return;const te=this._order.indexOf(U);this._order.splice(te,1);const ne=Y?this._order.indexOf(Y):this._order.length;Y&&ne===-1?this.fire(new H.ErrorEvent(new Error(`Layer with id "${Y}" does not exist on this map.`))):(this._order.splice(ne,0,U),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(U){this._checkLoaded();const Y=this._layers[U];if(!Y)return void this.fire(new H.ErrorEvent(new Error(`The layer '${U}' does not exist in the map's style and cannot be removed.`)));Y.setEventedParent(null),this._updateLayerCount(Y,!1);const te=this._order.indexOf(U);this._order.splice(te,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[U]=Y,delete this._layers[U],delete this._serializedLayers[U],delete this._updatedLayers[U],delete this._updatedPaintProps[U],Y.onRemove&&Y.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(U){return this._layers[U]}hasLayer(U){return U in this._layers}hasLayerType(U){for(const Y in this._layers)if(this._layers[Y].type===U)return!0;return!1}setLayerZoomRange(U,Y,te){this._checkLoaded();const ne=this.getLayer(U);ne?ne.minzoom===Y&&ne.maxzoom===te||(Y!=null&&(ne.minzoom=Y),te!=null&&(ne.maxzoom=te),this._updateLayer(ne)):this.fire(new H.ErrorEvent(new Error(`The layer '${U}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(U,Y,te={}){this._checkLoaded();const ne=this.getLayer(U);if(ne){if(!ye(ne.filter,Y))return Y==null?(ne.filter=void 0,void this._updateLayer(ne)):void(this._validate(H.validateFilter,`layers.${ne.id}.filter`,Y,{layerType:ne.type},te)||(ne.filter=H.clone$1(Y),this._updateLayer(ne)))}else this.fire(new H.ErrorEvent(new Error(`The layer '${U}' does not exist in the map's style and cannot be filtered.`)))}getFilter(U){const Y=this.getLayer(U);return Y&&H.clone$1(Y.filter)}setLayoutProperty(U,Y,te,ne={}){this._checkLoaded();const ae=this.getLayer(U);ae?ye(ae.getLayoutProperty(Y),te)||(ae.setLayoutProperty(Y,te,ne),this._updateLayer(ae)):this.fire(new H.ErrorEvent(new Error(`The layer '${U}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(U,Y){const te=this.getLayer(U);if(te)return te.getLayoutProperty(Y);this.fire(new H.ErrorEvent(new Error(`The layer '${U}' does not exist in the map's style.`)))}setPaintProperty(U,Y,te,ne={}){this._checkLoaded();const ae=this.getLayer(U);ae?ye(ae.getPaintProperty(Y),te)||(ae.setPaintProperty(Y,te,ne)&&this._updateLayer(ae),this._changed=!0,this._updatedPaintProps[U]=!0):this.fire(new H.ErrorEvent(new Error(`The layer '${U}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(U,Y){const te=this.getLayer(U);return te&&te.getPaintProperty(Y)}setFeatureState(U,Y){this._checkLoaded();const te=U.source,ne=U.sourceLayer,ae=this.getSource(te);if(!ae)return void this.fire(new H.ErrorEvent(new Error(`The source '${te}' does not exist in the map's style.`)));const he=ae.type;if(he==="geojson"&&ne)return void this.fire(new H.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(he==="vector"&&!ne)return void this.fire(new H.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));U.id===void 0&&this.fire(new H.ErrorEvent(new Error("The feature id parameter must be provided.")));const fe=this._getSourceCaches(te);for(const de of fe)de.setFeatureState(ne,U.id,Y)}removeFeatureState(U,Y){this._checkLoaded();const te=U.source,ne=this.getSource(te);if(!ne)return void this.fire(new H.ErrorEvent(new Error(`The source '${te}' does not exist in the map's style.`)));const ae=ne.type,he=ae==="vector"?U.sourceLayer:void 0;if(ae==="vector"&&!he)return void this.fire(new H.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(Y&&typeof U.id!="string"&&typeof U.id!="number")return void this.fire(new H.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const fe=this._getSourceCaches(te);for(const de of fe)de.removeFeatureState(he,U.id,Y)}getFeatureState(U){this._checkLoaded();const Y=U.source,te=U.sourceLayer,ne=this.getSource(Y);if(ne){if(ne.type!=="vector"||te)return U.id===void 0&&this.fire(new H.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(Y)[0].getFeatureState(te,U.id);this.fire(new H.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new H.ErrorEvent(new Error(`The source '${Y}' does not exist in the map's style.`)))}getTransition(){return H.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const U={};for(const Y in this._sourceCaches){const te=this._sourceCaches[Y].getSource();U[te.id]||(U[te.id]=te.serialize())}return H.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:U,layers:this._serializeLayers(this._order)},Y=>Y!==void 0)}_updateLayer(U){this._updatedLayers[U.id]=!0;const Y=this._getLayerSourceCache(U);U.source&&!this._updatedSources[U.source]&&Y&&Y.getSource().type!=="raster"&&(this._updatedSources[U.source]="reload",Y.pause()),this._changed=!0,U.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(U){const Y=he=>this._layers[he].type==="fill-extrusion",te={},ne=[];for(let he=this._order.length-1;he>=0;he--){const fe=this._order[he];if(Y(fe)){te[fe]=he;for(const de of U){const ve=de[fe];if(ve)for(const ge of ve)ne.push(ge)}}}ne.sort((he,fe)=>fe.intersectionZ-he.intersectionZ);const ae=[];for(let he=this._order.length-1;he>=0;he--){const fe=this._order[he];if(Y(fe))for(let de=ne.length-1;de>=0;de--){const ve=ne[de].feature;if(te[ve.layer.id]<he)break;ae.push(ve),ne.pop()}else for(const de of U){const ve=de[fe];if(ve)for(const ge of ve)ae.push(ge.feature)}}return ae}queryRenderedFeatures(U,Y,te){Y&&Y.filter&&this._validate(H.validateFilter,"queryRenderedFeatures.filter",Y.filter,null,Y);const ne={};if(Y&&Y.layers){if(!Array.isArray(Y.layers))return this.fire(new H.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const de of Y.layers){const ve=this._layers[de];if(!ve)return this.fire(new H.ErrorEvent(new Error(`The layer '${de}' does not exist in the map's style and cannot be queried for features.`))),[];ne[ve.source]=!0}}const ae=[];Y.availableImages=this._availableImages;const he=Y&&Y.layers?Y.layers.some(de=>{const ve=this.getLayer(de);return ve&&ve.is3D()}):this.has3DLayers(),fe=ar.createFromScreenPoints(U,te);for(const de in this._sourceCaches){const ve=this._sourceCaches[de].getSource().id;Y.layers&&!ne[ve]||ae.push(vi(this._sourceCaches[de],this._layers,this._serializedLayers,fe,Y,te,he,!!this.map._showQueryGeometry))}return this.placement&&ae.push(function(de,ve,ge,Te,Pe,Le,ke){const Be={},Ne=Le.queryRenderedSymbols(Te),Se=[];for(const De of Object.keys(Ne).map(Number))Se.push(ke[De]);Se.sort(tn);for(const De of Se){const Ve=De.featureIndex.lookupSymbolFeatures(Ne[De.bucketInstanceId],ve,De.bucketIndex,De.sourceLayerIndex,Pe.filter,Pe.layers,Pe.availableImages,de);for(const Ge in Ve){const Qe=Be[Ge]=Be[Ge]||[],tt=Ve[Ge];tt.sort((et,at)=>{const nt=De.featureSortOrder;if(nt){const pt=nt.indexOf(et.featureIndex);return nt.indexOf(at.featureIndex)-pt}return at.featureIndex-et.featureIndex});for(const et of tt)Qe.push(et)}}for(const De in Be)Be[De].forEach(Ve=>{const Ge=Ve.feature,Qe=ge(de[De]);if(!Qe)return;const tt=Qe.getFeatureState(Ge.layer["source-layer"],Ge.id);Ge.source=Ge.layer.source,Ge.layer["source-layer"]&&(Ge.sourceLayer=Ge.layer["source-layer"]),Ge.state=tt});return Be}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),fe.screenGeometry,Y,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ae)}querySourceFeatures(U,Y){Y&&Y.filter&&this._validate(H.validateFilter,"querySourceFeatures.filter",Y.filter,null,Y);const te=this._getSourceCaches(U);let ne=[];for(const ae of te)ne=ne.concat(Ai(ae,Y));return ne}addSourceType(U,Y,te){return Wn.getSourceType(U)?te(new Error(`A source type called "${U}" already exists.`)):(Wn.setSourceType(U,Y),Y.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:U,url:Y.workerSourceURL},te):te(null,null))}getLight(){return this.light.getLight()}setLight(U,Y={}){this._checkLoaded();const te=this.light.getLight();let ne=!1;for(const he in U)if(!ye(U[he],te[he])){ne=!0;break}if(!ne)return;const ae=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(U,Y),this.light.updateTransitions(ae)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(U,Y=1){if(this._checkLoaded(),!U)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let te=U;if(Y===1){if(typeof te.source=="object"){const ne="terrain-dem-src";this.addSource(ne,te.source),te=H.clone$1(te),te=H.extend(te,{source:ne})}if(this._validate(H.validateTerrain,"terrain",te))return}if(!this.terrain||this.terrain&&Y!==this.terrain.drapeRenderMode){if(!te)return;this._createTerrain(te,Y)}else{const ne=this.terrain,ae=ne.get();for(const he of Object.keys(H.spec.terrain))!te.hasOwnProperty(he)&&H.spec.terrain[he].default&&(te[he]=H.spec.terrain[he].default);for(const he in te)if(!ye(te[he],ae[he])){ne.set(te),this.stylesheet.terrain=te;const fe=this._setTransitionParameters({duration:0});ne.updateTransitions(fe);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(U){const Y=this.fog=new Rt(U,this.map.transform);this.stylesheet.fog=U;const te=this._setTransitionParameters({duration:0});Y.updateTransitions(te)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const U of this.map._markers)U._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(U){if(this._checkLoaded(),!U)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const Y=this.fog,te=Y.get();Object.keys(U).length===0&&Y.set(U);for(const ne in U)if(!ye(U[ne],te[ne])){Y.set(U),this.stylesheet.fog=U;const ae=this._setTransitionParameters({duration:0});Y.updateTransitions(ae);break}}else this._createFog(U);this._markersNeedUpdate=!0}_setTransitionParameters(U){return{now:H.exported.now(),transition:H.extend(U,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const U=this._order.filter(te=>this.isLayerDraped(this._layers[te])),Y=this._order.filter(te=>!this.isLayerDraped(this._layers[te]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...U),this._drapedFirstOrder.push(...Y)}_createTerrain(U,Y){const te=this.terrain=new qi(U,Y);this.stylesheet.terrain=U,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const ne=this._setTransitionParameters({duration:0});te.updateTransitions(ne)}_force3DLayerUpdate(){for(const U in this._layers){const Y=this._layers[U];Y.type==="fill-extrusion"&&this._updateLayer(Y)}}_forceSymbolLayerUpdate(){for(const U in this._layers){const Y=this._layers[U];Y.type==="symbol"&&this._updateLayer(Y)}}_validate(U,Y,te,ne,ae={}){return(!ae||ae.validate!==!1)&&xo(this,U.call(H.validateStyle,H.extend({key:Y,style:this.serialize(),value:te,styleSpec:H.spec},ne)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),H.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const U in this._layers)this._layers[U].setEventedParent(null);for(const U in this._sourceCaches)this._sourceCaches[U].clearTiles(),this._sourceCaches[U].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(U){const Y=this._getSourceCaches(U);for(const te of Y)te.clearTiles()}_reloadSource(U){const Y=this._getSourceCaches(U);for(const te of Y)te.resume(),te.reload()}_reloadSources(){for(const U of this._getSources())U.reload&&U.reload()}_updateSources(U){for(const Y in this._sourceCaches)this._sourceCaches[Y].update(U)}_generateCollisionBoxes(){for(const U in this._sourceCaches){const Y=this._sourceCaches[U];Y.resume(),Y.reload()}}_updatePlacement(U,Y,te,ne,ae=!1){let he=!1,fe=!1;const de={};for(const ve of this._order){const ge=this._layers[ve];if(ge.type!=="symbol")continue;if(!de[ge.source]){const Pe=this._getLayerSourceCache(ge);if(!Pe)continue;de[ge.source]=Pe.getRenderableIds(!0).map(Le=>Pe.getTileByID(Le)).sort((Le,ke)=>ke.tileID.overscaledZ-Le.tileID.overscaledZ||(Le.tileID.isLessThan(ke.tileID)?-1:1))}const Te=this.crossTileSymbolIndex.addLayer(ge,de[ge.source],U.center.lng,U.projection);he=he||Te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),ae=ae||this._layerOrderChanged||te===0,this._layerOrderChanged&&this.fire(new H.Event("neworder")),(ae||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(H.exported.now(),U.zoom))&&(this.pauseablePlacement=new El(U,this._order,ae,Y,te,ne,this.placement,this.fog&&U.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,de),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(H.exported.now()),fe=!0),he&&this.pauseablePlacement.placement.setStale()),fe||he)for(const ve of this._order){const ge=this._layers[ve];ge.type==="symbol"&&this.placement.updateLayerOpacities(ge,de[ge.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(H.exported.now())}_releaseSymbolFadeTiles(){for(const U in this._sourceCaches)this._sourceCaches[U].releaseSymbolFadeTiles()}getImages(U,Y,te){this.imageManager.getImages(Y.icons,te),this._updateTilesForChangedImages();const ne=ae=>{ae&&ae.setDependencies(Y.tileID.key,Y.type,Y.icons)};ne(this._otherSourceCaches[Y.source]),ne(this._symbolSourceCaches[Y.source])}getGlyphs(U,Y,te){this.glyphManager.getGlyphs(Y.stacks,te)}getResource(U,Y,te){return H.makeRequest(Y,te)}_getSourceCache(U){return this._otherSourceCaches[U]}_getLayerSourceCache(U){return U.type==="symbol"?this._symbolSourceCaches[U.source]:this._otherSourceCaches[U.source]}_getSourceCaches(U){const Y=[];return this._otherSourceCaches[U]&&Y.push(this._otherSourceCaches[U]),this._symbolSourceCaches[U]&&Y.push(this._symbolSourceCaches[U]),Y}_isSourceCacheLoaded(U){const Y=this._getSourceCaches(U);return Y.length===0?(this.fire(new H.ErrorEvent(new Error(`There is no source with ID '${U}'`))),!1):Y.every(te=>te.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Wn.getSourceType=function(Q){return Er[Q]},Wn.setSourceType=function(Q,U){Er[Q]=U},Wn.registerForPluginStateChange=H.registerForPluginStateChange;var Al=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Bo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",oo=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Na=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ao=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let bs={},ia={};const Fa=[];na(Al,Fa),na(oo,Fa),na(Na,Fa),na(ao,Fa),bs=Hr("",oo),ia=Hr(ao,Na);const Qc=Hr(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),ws=Al,Ol=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Cl={background:Hr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Hr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Hr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Hr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Hr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Hr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Hr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Hr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Hr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Hr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Hr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Hr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Hr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Hr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Hr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Hr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Hr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Hr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Hr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Hr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Hr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Hr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Hr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Hr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Hr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Hr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Bo),skyboxGradient:Hr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Bo),skyboxCapture:Hr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Hr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Hr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function na(Q,U){const Y=Q.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let te of Y)if(te=te.trim(),te[0]==="#"&&te.includes("if")&&!te.includes("endif")){te=te.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const ne=te.split(" ");for(const ae of ne)U.includes(ae)||U.push(ae)}}function Hr(Q,U){const Y=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,te=U.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),ne={},ae=[...Fa];return na(Q,ae),na(U,ae),{fragmentSource:Q=Q.replace(Y,(he,fe,de,ve,ge)=>(ne[ge]=!0,fe==="define"?`
#ifndef HAS_UNIFORM_u_${ge}
varying ${de} ${ve} ${ge};
#else
uniform ${de} ${ve} u_${ge};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ge}
    ${de} ${ve} ${ge} = u_${ge};
#endif
`)),vertexSource:U=U.replace(Y,(he,fe,de,ve,ge)=>{const Te=ve==="float"?"vec2":"vec4",Pe=ge.match(/color/)?"color":Te;return ne[ge]?fe==="define"?`
#ifndef HAS_UNIFORM_u_${ge}
uniform lowp float u_${ge}_t;
attribute ${de} ${Te} a_${ge};
varying ${de} ${ve} ${ge};
#else
uniform ${de} ${ve} u_${ge};
#endif
`:Pe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ge}
    ${ge} = a_${ge};
#else
    ${de} ${ve} ${ge} = u_${ge};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ge}
    ${ge} = unpack_mix_${Pe}(a_${ge}, u_${ge}_t);
#else
    ${de} ${ve} ${ge} = u_${ge};
#endif
`:fe==="define"?`
#ifndef HAS_UNIFORM_u_${ge}
uniform lowp float u_${ge}_t;
attribute ${de} ${Te} a_${ge};
#else
uniform ${de} ${ve} u_${ge};
#endif
`:Pe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ge}
    ${de} ${ve} ${ge} = a_${ge};
#else
    ${de} ${ve} ${ge} = u_${ge};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ge}
    ${de} ${ve} ${ge} = unpack_mix_${Pe}(a_${ge}, u_${ge}_t);
#else
    ${de} ${ve} ${ge} = u_${ge};
#endif
`}),staticAttributes:te,usedDefines:ae}}class $h{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(U,Y,te,ne,ae,he,fe){this.context=U;let de=this.boundPaintVertexBuffers.length!==ne.length;for(let ge=0;!de&&ge<ne.length;ge++)this.boundPaintVertexBuffers[ge]!==ne[ge]&&(de=!0);let ve=this.boundDynamicVertexBuffers.length!==fe.length;for(let ge=0;!ve&&ge<fe.length;ge++)this.boundDynamicVertexBuffers[ge]!==fe[ge]&&(ve=!0);if(!U.extVertexArrayObject||!this.vao||this.boundProgram!==Y||this.boundLayoutVertexBuffer!==te||de||ve||this.boundIndexBuffer!==ae||this.boundVertexOffset!==he)this.freshBind(Y,te,ne,ae,he,fe);else{U.bindVertexArrayOES.set(this.vao);for(const ge of fe)ge&&ge.bind();ae&&ae.dynamicDraw&&ae.bind()}}freshBind(U,Y,te,ne,ae,he){let fe;const de=U.numAttributes,ve=this.context,ge=ve.gl;if(ve.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ve.extVertexArrayObject.createVertexArrayOES(),ve.bindVertexArrayOES.set(this.vao),fe=0,this.boundProgram=U,this.boundLayoutVertexBuffer=Y,this.boundPaintVertexBuffers=te,this.boundIndexBuffer=ne,this.boundVertexOffset=ae,this.boundDynamicVertexBuffers=he;else{fe=ve.currentNumAttributes||0;for(let Te=de;Te<fe;Te++)ge.disableVertexAttribArray(Te)}Y.enableAttributes(ge,U),Y.bind(),Y.setVertexAttribPointers(ge,U,ae);for(const Te of te)Te.enableAttributes(ge,U),Te.bind(),Te.setVertexAttribPointers(ge,U,ae);for(const Te of he)Te&&(Te.enableAttributes(ge,U),Te.bind(),Te.setVertexAttribPointers(ge,U,ae));ne&&ne.bind(),ve.currentNumAttributes=de}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Pl(Q,U){const Y=Math.pow(2,U.canonical.z),te=U.canonical.y;return[new H.MercatorCoordinate(0,te/Y).toLngLat().lat,new H.MercatorCoordinate(0,(te+1)/Y).toLngLat().lat]}function eu(Q,U,Y,te,ne,ae,he){const fe=Q.context,de=fe.gl,ve=Y.fbo;if(!ve)return;Q.prepareDrawTile();const ge=Q.useProgram("hillshade");fe.activeTexture.set(de.TEXTURE0),de.bindTexture(de.TEXTURE_2D,ve.colorAttachment.get());const Te=((Be,Ne,Se,De)=>{const Ve=Se.paint.get("hillshade-shadow-color"),Ge=Se.paint.get("hillshade-highlight-color"),Qe=Se.paint.get("hillshade-accent-color");let tt=Se.paint.get("hillshade-illumination-direction")*(Math.PI/180);Se.paint.get("hillshade-illumination-anchor")==="viewport"&&(tt-=Be.transform.angle);const et=!Be.options.moving;return{u_matrix:De||Be.transform.calculateProjMatrix(Ne.tileID.toUnwrapped(),et),u_image:0,u_latrange:Pl(0,Ne.tileID),u_light:[Se.paint.get("hillshade-exaggeration"),tt],u_shadow:Ve,u_highlight:Ge,u_accent:Qe}})(Q,Y,te,Q.terrain?U.projMatrix:null);Q.prepareDrawProgram(fe,ge,U.toUnwrapped());const{tileBoundsBuffer:Pe,tileBoundsIndexBuffer:Le,tileBoundsSegments:ke}=Q.getTileBoundsBuffers(Y);ge.draw(fe,de.TRIANGLES,ne,ae,he,H.CullFaceMode.disabled,Te,te.id,Pe,Le,ke)}function Rl(Q,U,Y){if(!U.needsDEMTextureUpload)return;const te=Q.context,ne=te.gl;te.pixelStoreUnpackPremultiplyAlpha.set(!1),U.demTexture=U.demTexture||Q.getTileTexture(Y.stride);const ae=Y.getPixels();U.demTexture?U.demTexture.update(ae,{premultiply:!1}):U.demTexture=new H.Texture(te,ae,ne.RGBA,{premultiply:!1}),U.needsDEMTextureUpload=!1}function tu(Q,U,Y,te,ne,ae){const he=Q.context,fe=he.gl;if(!U.dem)return;const de=U.dem;if(he.activeTexture.set(fe.TEXTURE1),Rl(Q,U,de),!U.demTexture)return;U.demTexture.bind(fe.NEAREST,fe.CLAMP_TO_EDGE);const ve=de.dim;he.activeTexture.set(fe.TEXTURE0);let ge=U.fbo;if(!ge){const ke=new H.Texture(he,{width:ve,height:ve,data:null},fe.RGBA);ke.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),ge=U.fbo=he.createFramebuffer(ve,ve,!0),ge.colorAttachment.set(ke.texture)}he.bindFramebuffer.set(ge.framebuffer),he.viewport.set([0,0,ve,ve]);const{tileBoundsBuffer:Te,tileBoundsIndexBuffer:Pe,tileBoundsSegments:Le}=Q.getMercatorTileBoundsBuffers();Q.useProgram("hillshadePrepare").draw(he,fe.TRIANGLES,te,ne,ae,H.CullFaceMode.disabled,((ke,Be)=>{const Ne=Be.stride,Se=H.create();return H.ortho(Se,0,H.EXTENT,-H.EXTENT,0,0,1),H.translate(Se,Se,[0,-H.EXTENT,0]),{u_matrix:Se,u_image:1,u_dimension:[Ne,Ne],u_zoom:ke.overscaledZ,u_unpack:Be.unpackVector}})(U.tileID,de),Y.id,Te,Pe,Le),U.needsHillshadePrepare=!1}const Ml=Q=>({u_matrix:new H.UniformMatrix4f(Q),u_image0:new H.Uniform1i(Q),u_skirt_height:new H.Uniform1f(Q)}),oa=(Q,U)=>({u_matrix:Q,u_image0:0,u_skirt_height:U}),Es=(Q,U,Y,te,ne,ae,he,fe,de,ve,ge,Te,Pe,Le,ke)=>({u_proj_matrix:Float32Array.from(Q),u_globe_matrix:U,u_normalize_matrix:Float32Array.from(te),u_merc_matrix:Y,u_zoom_transition:ne,u_merc_center:ae,u_image0:0,u_frustum_tl:he,u_frustum_tr:fe,u_frustum_br:de,u_frustum_bl:ve,u_globe_pos:ge,u_globe_radius:Te,u_viewport:Pe,u_grid_matrix:ke?Float32Array.from(ke):new Float32Array(9),u_skirt_height:Le});function aa(Q,U){return Q!=null&&U!=null&&!(!Q.hasData()||!U.hasData())&&Q.demTexture!=null&&U.demTexture!=null&&Q.tileID.key!==U.tileID.key}const so=new class{constructor(){this.operations={}}newMorphing(Q,U,Y,te,ne){if(Q in this.operations){const ae=this.operations[Q];ae.to.tileID.key!==Y.tileID.key&&(ae.queued=Y)}else this.operations[Q]={startTime:te,phase:0,duration:ne,from:U,to:Y,queued:null}}getMorphValuesForProxy(Q){if(!(Q in this.operations))return null;const U=this.operations[Q];return{from:U.from,to:U.to,phase:U.phase}}update(Q){for(const U in this.operations){const Y=this.operations[U];for(Y.phase=(Q-Y.startTime)/Y.duration;Y.phase>=1||!this._validOp(Y);)if(!this._nextOp(Y,Q)){delete this.operations[U];break}}}_nextOp(Q,U){return!!Q.queued&&(Q.from=Q.to,Q.to=Q.queued,Q.queued=null,Q.phase=0,Q.startTime=U,!0)}_validOp(Q){return Q.from.hasData()&&Q.to.hasData()}},ko={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ts(Q){return 6*Math.pow(1.5,22-Q)}function ru(Q,U){const Y=1<<Q.z;return!U&&(Q.x===0||Q.x===Y-1)||Q.y===0||Q.y===Y-1}const za=Q=>({u_matrix:Q});function Dl(Q,U,Y,te,ne){if(ne>0){const ae=H.exported.now(),he=(ae-Q.timeAdded)/ne,fe=U?(ae-U.timeAdded)/ne:-1,de=Y.getSource(),ve=te.coveringZoomLevel({tileSize:de.tileSize,roundZoom:de.roundZoom}),ge=!U||Math.abs(U.tileID.overscaledZ-ve)>Math.abs(Q.tileID.overscaledZ-ve),Te=ge&&Q.refreshedUponExpiration?1:H.clamp(ge?he:1-fe,0,1);return Q.refreshedUponExpiration&&he>=1&&(Q.refreshedUponExpiration=!1),U?{opacity:1,mix:1-Te}:{opacity:Te,mix:0}}return{opacity:1,mix:0}}class Ll extends H.SourceCache{constructor(U){const Y={type:"raster-dem",maxzoom:U.transform.maxZoom},te=new It(Qo(),null),ne=Cr("mock-dem",Y,te,U.style);super("mock-dem",ne,!1),ne.setEventedParent(this),this._sourceLoaded=!0}_loadTile(U,Y){U.state="loaded",Y(null)}}class Ss extends H.SourceCache{constructor(U){const Y=Cr("proxy",{type:"geojson",maxzoom:U.transform.maxZoom},new It(Qo(),null),U.style);super("proxy",Y,!1),Y.setEventedParent(this),this.map=this.getSource().map=U,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(U,Y,te){if(U.freezeTileCoverage)return;this.transform=U;const ne=U.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((ae,he)=>{if(ae[he.key]="",!this._tiles[he.key]){const fe=new H.Tile(he,this._source.tileSize*he.overscaleFactor(),U.tileZoom);fe.state="loaded",this._tiles[he.key]=fe}return ae},{});for(const ae in this._tiles)ae in ne||(this.freeFBO(ae),this._tiles[ae].unloadVectorData(),delete this._tiles[ae])}freeFBO(U){const Y=this.proxyCachedFBO[U];if(Y!==void 0){const te=Object.values(Y);this.renderCachePool.push(...te),delete this.proxyCachedFBO[U]}}deallocRenderCache(){this.renderCache.forEach(U=>U.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Is extends H.OverscaledTileID{constructor(U,Y,te){super(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y),this.proxyTileKey=Y,this.projMatrix=te}}class Bl extends H.Elevation{constructor(U,Y){super(),this.painter=U,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[te,ne,ae]=function(de){const ve=new H.StructArrayLayout2i4,ge=new H.StructArrayLayout3ui6,Te=131;ve.reserve(17161),ge.reserve(33800);const Pe=H.EXTENT/128,Le=H.EXTENT+Pe/2,ke=Le+Pe;for(let Ne=-Pe;Ne<ke;Ne+=Pe)for(let Se=-Pe;Se<ke;Se+=Pe){const De=Se<0||Se>Le||Ne<0||Ne>Le?24575:0,Ve=H.clamp(Math.round(Se),0,H.EXTENT),Ge=H.clamp(Math.round(Ne),0,H.EXTENT);ve.emplaceBack(Ve+De,Ge)}const Be=(Ne,Se)=>{const De=Se*Te+Ne;ge.emplaceBack(De+1,De,De+Te),ge.emplaceBack(De+Te,De+Te+1,De+1)};for(let Ne=1;Ne<129;Ne++)for(let Se=1;Se<129;Se++)Be(Se,Ne);return[0,129].forEach(Ne=>{for(let Se=0;Se<130;Se++)Be(Se,Ne),Be(Ne,Se)}),[ve,ge,32768]}(),he=U.context;this.gridBuffer=he.createVertexBuffer(te,H.posAttributes.members),this.gridIndexBuffer=he.createIndexBuffer(ne),this.gridSegments=H.SegmentVector.simpleSegment(0,0,te.length,ne.length),this.gridNoSkirtSegments=H.SegmentVector.simpleSegment(0,0,te.length,ae),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ss(Y.map),this.orthoMatrix=H.create(),H.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,H.EXTENT,0,H.EXTENT,0,1);const fe=he.gl;this._overlapStencilMode=new H.StencilMode({func:fe.GEQUAL,mask:255},0,255,fe.KEEP,fe.KEEP,fe.REPLACE),this._previousZoom=U.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=Y,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ll(Y.map)}set style(U){U.on("data",this._onStyleDataEvent.bind(this)),U.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=U,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(U,Y,te){if(U&&U.terrain){this._style!==U&&(this.style=U),this.enabled=!0;const ne=U.terrain.properties;this.sourceCache=U.terrain.drapeRenderMode===0?this._mockSourceCache:U._getSourceCache(ne.get("source")),this._exaggeration=ne.get("exaggeration");const ae=()=>{this.sourceCache.used&&H.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const he=this.getScaledDemTileSize();this.sourceCache.update(Y,he,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,ae(),this._initializing=!0),ae(),Y.updateElevation(!0,te),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(Y),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(U){this._findCoveringTileCache[U]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const U=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||U.efficiency!==100&&H.warnOnce(`Terrain render cache efficiency is not optimal (${U.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${U.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(U){U.coord&&U.dataType==="source"?this._clearRenderCacheForTile(U.sourceCacheId,U.coord):U.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const U in this._style._sourceCaches)this._style._sourceCaches[U].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(U=>U.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const U=2*this.proxySourceCache.getSource().tileSize;return[U,U]}set useVertexMorphing(U){this._useVertexMorphing=U}updateTileBinding(U){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const Y=this.proxySourceCache,te=this.painter.transform;this._initializing&&(this._initializing=te._centerAltitude===0&&this.getAtPointOrZero(H.MercatorCoordinate.fromLngLat(te.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const ne=this.proxyCoords=Y.getIds().map(de=>{const ve=Y.getTileByID(de).tileID;return ve.projMatrix=te.calculateProjMatrix(ve.toUnwrapped()),ve});(function(de,ve){const ge=ve.transform.pointCoordinate(ve.transform.getCameraPoint()),Te=new H.Point(ge.x,ge.y);de.sort((Pe,Le)=>{if(Le.overscaledZ-Pe.overscaledZ)return Le.overscaledZ-Pe.overscaledZ;const ke=new H.Point(Pe.canonical.x+(1<<Pe.canonical.z)*Pe.wrap,Pe.canonical.y),Be=new H.Point(Le.canonical.x+(1<<Le.canonical.z)*Le.wrap,Le.canonical.y),Ne=Te.mult(1<<Pe.canonical.z);return Ne.x-=.5,Ne.y-=.5,Ne.distSqr(ke)-Ne.distSqr(Be)})})(ne,this.painter),this._previousZoom=te.zoom;const ae=this.proxyToSource||{};this.proxyToSource={},ne.forEach(de=>{this.proxyToSource[de.key]={}}),this.terrainTileForTile={};const he=this._style._sourceCaches;for(const de in he){const ve=he[de];if(!ve.used||(ve!==this.sourceCache&&this.resetTileLookupCache(ve.id),this._setupProxiedCoordsForOrtho(ve,U[de],ae),ve.usedForTerrain))continue;const ge=U[de];ve.getSource().reparseOverscaled&&this._assignTerrainTiles(ge)}this.proxiedCoords[Y.id]=ne.map(de=>new Is(de,de.key,this.orthoMatrix)),this._assignTerrainTiles(ne),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(ae),this.renderingToTexture=!1,this._updateTimestamp=H.exported.now();const fe={};this._visibleDemTiles=[];for(const de of this.proxyCoords){const ve=this.terrainTileForTile[de.key];if(!ve)continue;const ge=ve.tileID.key;ge in fe||(this._visibleDemTiles.push(ve),fe[ge]=ge)}}_assignTerrainTiles(U){this._initializing||U.forEach(Y=>{if(this.terrainTileForTile[Y.key])return;const te=this._findTileCoveringTileID(Y,this.sourceCache);te&&(this.terrainTileForTile[Y.key]=te)})}_prepareDEMTextures(){const U=this.painter.context,Y=U.gl;for(const te in this.terrainTileForTile){const ne=this.terrainTileForTile[te],ae=ne.dem;!ae||ne.demTexture&&!ne.needsDEMTextureUpload||(U.activeTexture.set(Y.TEXTURE1),Rl(this.painter,ne,ae))}}_prepareDemTileUniforms(U,Y,te,ne){if(!Y||Y.demTexture==null)return!1;const ae=U.tileID.canonical,he=Math.pow(2,Y.tileID.canonical.z-ae.z),fe=ne||"";return te[`u_dem_tl${fe}`]=[ae.x*he%1,ae.y*he%1],te[`u_dem_scale${fe}`]=he,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const U=this.painter.context,Y=U.gl;if(!this._emptyDepthBufferTexture){const te=new H.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new H.Texture(U,te,Y.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let U=0;const Y=this._visibleDemTiles.reduce((te,ne)=>{if(!ne.dem)return te;const ae=ne.dem.tree.minimums[0];return ae>0&&U++,te+ae},0);return U?Y/U:0}_updateEmptyDEMTexture(){const U=this.painter.context,Y=U.gl;U.activeTexture.set(Y.TEXTURE2);const te=this._getLoadedAreaMinimum(),ne=new H.RGBAImage({width:1,height:1},new Uint8Array(H.DEMData.pack(te,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let ae=this._emptyDEMTexture;return ae?ae.update(ne,{premultiply:!1}):ae=this._emptyDEMTexture=new H.Texture(U,ne,Y.RGBA,{premultiply:!1}),ae}setupElevationDraw(U,Y,te){const ne=this.painter.context,ae=ne.gl,he=(fe=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:H.DEMData.getUnpackVector(fe),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var fe;he.u_dem_size=this.sourceCache.getSource().tileSize,he.u_exaggeration=this.exaggeration();let de=null,ve=null,ge=1;if(te&&te.morphing&&this._useVertexMorphing){const Te=te.morphing.srcDemTile,Pe=te.morphing.dstDemTile;ge=te.morphing.phase,Te&&Pe&&(this._prepareDemTileUniforms(U,Te,he,"_prev")&&(ve=Te),this._prepareDemTileUniforms(U,Pe,he)&&(de=Pe))}if(ve&&de?(ne.activeTexture.set(ae.TEXTURE2),de.demTexture.bind(ae.NEAREST,ae.CLAMP_TO_EDGE,ae.NEAREST),ne.activeTexture.set(ae.TEXTURE4),ve.demTexture.bind(ae.NEAREST,ae.CLAMP_TO_EDGE,ae.NEAREST),he.u_dem_lerp=ge):(de=this.terrainTileForTile[U.tileID.key],ne.activeTexture.set(ae.TEXTURE2),(this._prepareDemTileUniforms(U,de,he)?de.demTexture:this.emptyDEMTexture).bind(ae.NEAREST,ae.CLAMP_TO_EDGE)),ne.activeTexture.set(ae.TEXTURE3),te&&te.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(ae.NEAREST,ae.CLAMP_TO_EDGE),this._depthFBO&&(he.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(ae.NEAREST,ae.CLAMP_TO_EDGE),he.u_depth_size_inv=[1,1]),te&&te.useMeterToDem&&de){const Te=(1<<de.tileID.canonical.z)*H.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;he.u_meter_to_dem=Te}if(te&&te.labelPlaneMatrixInv&&(he.u_label_plane_matrix_inv=te.labelPlaneMatrixInv),Y.setTerrainUniformValues(ne,he),this.painter.transform.projection.name==="globe"){const Te=this.globeUniformValues(this.painter.transform,U.tileID.canonical,te&&te.useDenormalizedUpVectorScale);Y.setGlobeUniformValues(ne,Te)}}globeUniformValues(U,Y,te){const ne=U.projection;return{u_tile_tl_up:ne.upVector(Y,0,0),u_tile_tr_up:ne.upVector(Y,H.EXTENT,0),u_tile_br_up:ne.upVector(Y,H.EXTENT,H.EXTENT),u_tile_bl_up:ne.upVector(Y,0,H.EXTENT),u_tile_up_scale:te?H.globeMetersToEcef(1):ne.upVectorScale(Y,U.center.lat,U.worldSize).metersToTile}}renderToBackBuffer(U){const Y=this.painter,te=this.painter.context;U.length!==0&&(te.bindFramebuffer.set(null),te.viewport.set([0,0,Y.width,Y.height]),Y.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(ne,ae,he,fe,de){if(ne.transform.projection.name==="globe")(function(ve,ge,Te,Pe,Le){const ke=ve.context,Be=ke.gl;let Ne,Se;const De=ve.options.showTerrainWireframe?2:0,Ve=ve.transform,Ge=H.globeUseCustomAntiAliasing(ve,ke,Ve),Qe=(Bt,ft)=>{if(Se===Bt)return;const St=[ko[Bt],"PROJECTION_GLOBE_VIEW"];Ge&&St.push("CUSTOM_ANTIALIASING"),ft&&St.push(ko[De]),Ne=ve.useProgram("globeRaster",null,St),Se=Bt},tt=ve.colorModeForRenderPass(),et=new H.DepthMode(Be.LEQUAL,H.DepthMode.ReadWrite,ve.depthRangeFor3D);so.update(Le);const at=H.calculateGlobeMercatorMatrix(Ve),nt=[H.mercatorXfromLng(Ve.center.lng),H.mercatorYfromLat(Ve.center.lat)],pt=De?[!1,!0]:[!1],kt=ve.globeSharedBuffers,ct=[Ve.width*H.exported.devicePixelRatio,Ve.height*H.exported.devicePixelRatio],At=Float32Array.from(Ve.globeMatrix),yt={useDenormalizedUpVectorScale:!0};if(pt.forEach(Bt=>{const ft=ve.transform,St=Ts(ft.zoom)*ge.exaggeration();Se=-1;const Ft=Bt?Be.LINES:Be.TRIANGLES;for(const Mt of Pe){const Ut=Te.getTile(Mt),lr=H.StencilMode.disabled,_r=ge.prevTerrainTileForTile[Mt.key],rr=ge.terrainTileForTile[Mt.key];aa(_r,rr)&&so.newMorphing(Mt.key,_r,rr,Le,250),ke.activeTexture.set(Be.TEXTURE0),Ut.texture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE);const fr=so.getMorphValuesForProxy(Mt.key),Lr=fr?1:0;fr&&H.extend$1(yt,{morphing:{srcDemTile:fr.from,dstDemTile:fr.to,phase:H.easeCubicInOut(fr.phase)}});const Pr=H.tileCornersToBounds(Mt.canonical),or=H.getLatitudinalLod(Pr.getCenter().lat),Kr=H.getGridMatrix(Mt.canonical,Pr,or,ft.worldSize/ft._pixelsPerMercatorPixel),Qr=H.globeNormalizeECEF(H.globeTileBounds(Mt.canonical)),ei=Es(ft.projMatrix,At,at,Qr,H.globeToMercatorTransition(ft.zoom),nt,ft.frustumCorners.TL,ft.frustumCorners.TR,ft.frustumCorners.BR,ft.frustumCorners.BL,ft.globeCenterInViewSpace,ft.globeRadius,ct,St,Kr);if(Qe(Lr,Bt),ge.setupElevationDraw(Ut,Ne,yt),ve.prepareDrawProgram(ke,Ne,Mt.toUnwrapped()),kt){const[ti,nn,Vi]=Bt?kt.getWirefameBuffers(ve.context,or):kt.getGridBuffers(or,St!==0);Ne.draw(ke,Ft,et,lr,tt,H.CullFaceMode.backCCW,ei,"globe_raster",ti,nn,Vi)}}}),kt){const Bt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ge&&Bt.push("CUSTOM_ANTIALIASING"),Ne=ve.useProgram("globeRaster",null,Bt);for(const ft of Pe){const{x:St,y:Ft,z:Mt}=ft.canonical,Ut=Ft===0,lr=Ft===(1<<Mt)-1,[_r,rr,fr,Lr]=kt.getPoleBuffers(Mt);if(Lr&&(Ut||lr)){const Pr=Te.getTile(ft);ke.activeTexture.set(Be.TEXTURE0),Pr.texture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE);let or=H.globePoleMatrixForTile(Mt,St,Ve);const Kr=H.globeNormalizeECEF(H.globeTileBounds(ft.canonical)),Qr=(ei,ti)=>ei.draw(ke,Be.TRIANGLES,et,H.StencilMode.disabled,tt,H.CullFaceMode.disabled,Es(Ve.projMatrix,or,or,Kr,0,nt,Ve.frustumCorners.TL,Ve.frustumCorners.TR,Ve.frustumCorners.BR,Ve.frustumCorners.BL,Ve.globeCenterInViewSpace,Ve.globeRadius,ct,0),"globe_pole_raster",ti,fr,Lr);ge.setupElevationDraw(Pr,Ne,yt),ve.prepareDrawProgram(ke,Ne,ft.toUnwrapped()),Ut&&Qr(Ne,_r),lr&&(or=H.scale(H.create(),or,[1,-1,1]),Qr(Ne,rr))}}}})(ne,ae,he,fe,de);else{const ve=ne.context,ge=ve.gl;let Te,Pe;const Le=ne.options.showTerrainWireframe?2:0,ke=(Ve,Ge)=>{if(Pe===Ve)return;const Qe=[ko[Ve]];Ge&&Qe.push(ko[Le]),Te=ne.useProgram("terrainRaster",null,Qe),Pe=Ve},Be=ne.colorModeForRenderPass(),Ne=new H.DepthMode(ge.LEQUAL,H.DepthMode.ReadWrite,ne.depthRangeFor3D);so.update(de);const Se=ne.transform,De=Ts(Se.zoom)*ae.exaggeration();(Le?[!1,!0]:[!1]).forEach(Ve=>{Pe=-1;const Ge=Ve?ge.LINES:ge.TRIANGLES,[Qe,tt]=Ve?ae.getWirefameBuffer():[ae.gridIndexBuffer,ae.gridSegments];for(const et of fe){const at=he.getTile(et),nt=H.StencilMode.disabled,pt=ae.prevTerrainTileForTile[et.key],kt=ae.terrainTileForTile[et.key];aa(pt,kt)&&so.newMorphing(et.key,pt,kt,de,250),ve.activeTexture.set(ge.TEXTURE0),at.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE,ge.LINEAR_MIPMAP_NEAREST);const ct=so.getMorphValuesForProxy(et.key),At=ct?1:0;let yt;ct&&(yt={morphing:{srcDemTile:ct.from,dstDemTile:ct.to,phase:H.easeCubicInOut(ct.phase)}});const Bt=oa(et.projMatrix,ru(et.canonical,Se.renderWorldCopies)?De/10:De);ke(At,Ve),ae.setupElevationDraw(at,Te,yt),ne.prepareDrawProgram(ve,Te,et.toUnwrapped()),Te.draw(ve,Ge,Ne,nt,Be,H.CullFaceMode.backCCW,Bt,"terrain_raster",ae.gridBuffer,Qe,tt)}})}}(Y,this,this.proxySourceCache,U,this._updateTimestamp),this.renderingToTexture=!0,Y.gpuTimingDeferredRenderEnd(),U.splice(0,U.length))}renderBatch(U){if(this._drapedRenderBatches.length===0)return U+1;this.renderingToTexture=!0;const Y=this.painter,te=this.painter.context,ne=this.proxySourceCache,ae=this.proxiedCoords[ne.id],he=this._drapedRenderBatches.shift(),fe=[],de=Y.style.order;let ve=0;for(const ge of ae){const Te=ne.getTileByID(ge.proxyTileKey),Pe=ne.proxyCachedFBO[ge.key]?ne.proxyCachedFBO[ge.key][U]:void 0,Le=Pe!==void 0?ne.renderCache[Pe]:this.pool[ve++],ke=Pe!==void 0;if(Te.texture=Le.tex,ke&&!Le.dirty){fe.push(Te.tileID);continue}let Be;te.bindFramebuffer.set(Le.fb.framebuffer),this.renderedToTile=!1,Le.dirty&&(te.clear({color:H.Color.transparent,stencil:0}),Le.dirty=!1);for(let Ne=he.start;Ne<=he.end;++Ne){const Se=Y.style._layers[de[Ne]];if(Se.isHidden(Y.transform.zoom))continue;const De=Y.style._getLayerSourceCache(Se),Ve=De?this.proxyToSource[ge.key][De.id]:[ge];if(!Ve)continue;const Ge=Ve;te.viewport.set([0,0,Le.fb.width,Le.fb.height]),Be!==(De?De.id:null)&&(this._setupStencil(Le,Ve,Se,De),Be=De?De.id:null),Y.renderLayer(Y,De,Se,Ge)}this.renderedToTile?(Le.dirty=!0,fe.push(Te.tileID)):ke||--ve,ve===5&&(ve=0,this.renderToBackBuffer(fe))}return this.renderToBackBuffer(fe),this.renderingToTexture=!1,te.bindFramebuffer.set(null),te.viewport.set([0,0,Y.width,Y.height]),he.end+1}postRender(){}renderCacheEfficiency(U){const Y=U.order.length;if(Y===0)return{efficiency:100};let te,ne=0,ae=0,he=!1;for(let fe=0;fe<Y;++fe){const de=U._layers[U.order[fe]];this._style.isLayerDraped(de)?(he&&++ne,++ae):he||(he=!0,te=de.id)}return ae===0?{efficiency:100}:{efficiency:100*(1-ne/ae),firstUndrapedLayer:te}}getMinElevationBelowMSL(){let U=0;return this._visibleDemTiles.filter(Y=>Y.dem).forEach(Y=>{U=Math.min(U,Y.dem.tree.minimums[0])}),U===0?U:(U-30)*this._exaggeration}raycast(U,Y,te){if(!this._visibleDemTiles)return null;const ne=this._visibleDemTiles.filter(ae=>ae.dem).map(ae=>{const he=ae.tileID,fe=1<<he.overscaledZ,{x:de,y:ve}=he.canonical,ge=de/fe,Te=(de+1)/fe,Pe=ve/fe,Le=(ve+1)/fe;return{minx:ge,miny:Pe,maxx:Te,maxy:Le,t:ae.dem.tree.raycastRoot(ge,Pe,Te,Le,U,Y,te),tile:ae}});ne.sort((ae,he)=>(ae.t!==null?ae.t:Number.MAX_VALUE)-(he.t!==null?he.t:Number.MAX_VALUE));for(const ae of ne){if(ae.t==null)return null;const he=ae.tile.dem.tree.raycast(ae.minx,ae.miny,ae.maxx,ae.maxy,U,Y,te);if(he!=null)return he}return null}_createFBO(){const U=this.painter.context,Y=U.gl,te=this.drapeBufferSize;U.activeTexture.set(Y.TEXTURE0);const ne=new H.Texture(U,{width:te[0],height:te[1],data:null},Y.RGBA);ne.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const ae=U.createFramebuffer(te[0],te[1],!1);return ae.colorAttachment.set(ne.texture),ae.depthAttachment=new rt(U,ae.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=U.createRenderbuffer(U.gl.DEPTH_STENCIL,te[0],te[1]),this._stencilRef=0,ae.depthAttachment.set(this._sharedDepthStencil),U.clear({stencil:0})):ae.depthAttachment.set(this._sharedDepthStencil),U.extTextureFilterAnisotropic&&!U.extTextureFilterAnisotropicForceOff&&Y.texParameterf(Y.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax),{fb:ae,tex:ne,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const U in this._style._sourceCaches)if(this._style._sourceCaches[U].hasTransition())return!0;return this._style.order.some(U=>{const Y=this._style._layers[U],te=Y.isHidden(this.painter.transform.zoom);return Y.type==="custom"?!te&&Y.shouldRedrape():!te&&Y.hasTransition()})}_clearLineLayersFromRenderCache(){let U=!1;for(const te of this._style._getSources())if(te instanceof Kt){U=!0;break}if(!U)return;const Y={};for(let te=0;te<this._style.order.length;++te){const ne=this._style._layers[this._style.order[te]],ae=this._style._getLayerSourceCache(ne);if(ae&&!Y[ae.id]&&!ne.isHidden(this.painter.transform.zoom)&&ne.type==="line"&&ne.widthExpression()instanceof H.ZoomDependentExpression){Y[ae.id]=!0;for(const he of this.proxyCoords){const fe=this.proxyToSource[he.key][ae.id];if(fe)for(const de of fe)this._clearRenderCacheForTile(ae.id,de)}}}}_clearRasterLayersFromRenderCache(){let U=!1;for(const te in this._style._sourceCaches)if(this._style._sourceCaches[te]._source instanceof Vt){U=!0;break}if(!U)return;const Y={};for(let te=0;te<this._style.order.length;++te){const ne=this._style._layers[this._style.order[te]],ae=this._style._getLayerSourceCache(ne);if(!ae||Y[ae.id]||ne.isHidden(this.painter.transform.zoom)||ne.type!=="raster")continue;const he=ne.paint.get("raster-fade-duration");for(const fe of this.proxyCoords){const de=this.proxyToSource[fe.key][ae.id];if(de)for(const ve of de){const ge=Dl(ae.getTile(ve),ae.findLoadedParent(ve,0),ae,this.painter.transform,he);(ge.opacity!==1||ge.mix!==0)&&this._clearRenderCacheForTile(ae.id,ve)}}}}_setupDrapedRenderBatches(){const U=this._style.order,Y=U.length;if(Y===0)return;const te=[];let ne,ae=0,he=this._style._layers[U[ae]];for(;!this._style.isLayerDraped(he)&&he.isHidden(this.painter.transform.zoom)&&++ae<Y;)he=this._style._layers[U[ae]];for(;ae<Y;++ae){const fe=this._style._layers[U[ae]];fe.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(fe)?ne===void 0&&(ne=ae):ne!==void 0&&(te.push({start:ne,end:ae-1}),ne=void 0))}ne!==void 0&&te.push({start:ne,end:ae-1}),this._drapedRenderBatches=te}_setupRenderCache(U){const Y=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,Y.renderCache.length>Y.renderCachePool.length){const he=Object.values(Y.proxyCachedFBO);Y.proxyCachedFBO={};for(let fe=0;fe<he.length;++fe){const de=Object.values(he[fe]);Y.renderCachePool.push(...de)}}return}this._clearRasterLayersFromRenderCache();const te=this.proxyCoords,ne=this._tilesDirty;for(let he=te.length-1;he>=0;he--){const fe=te[he];if(Y.getTileByID(fe.key),Y.proxyCachedFBO[fe.key]!==void 0){const de=U[fe.key],ve=this.proxyToSource[fe.key];let ge=0;for(const Te in ve){const Pe=ve[Te],Le=de[Te];if(!Le||Le.length!==Pe.length||Pe.some((ke,Be)=>ke!==Le[Be]||ne[Te]&&ne[Te].hasOwnProperty(ke.key))){ge=-1;break}++ge}for(const Te in Y.proxyCachedFBO[fe.key])Y.renderCache[Y.proxyCachedFBO[fe.key][Te]].dirty=ge<0||ge!==Object.values(de).length}}const ae=[...this._drapedRenderBatches];ae.sort((he,fe)=>fe.end-fe.start-(he.end-he.start));for(const he of ae)for(const fe of te){if(Y.proxyCachedFBO[fe.key])continue;let de=Y.renderCachePool.pop();de===void 0&&Y.renderCache.length<50&&(de=Y.renderCache.length,Y.renderCache.push(this._createFBO())),de!==void 0&&(Y.proxyCachedFBO[fe.key]={},Y.proxyCachedFBO[fe.key][he.start]=de,Y.renderCache[de].dirty=!0)}this._tilesDirty={}}_setupStencil(U,Y,te,ne){if(!ne||!this._sourceTilesOverlap[ne.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const ae=this.painter.context,he=ae.gl;if(Y.length<=1)return void(this._overlapStencilType=!1);let fe;if(te.isTileClipped())fe=Y.length,this._overlapStencilMode.test={func:he.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(Y[0].overscaledZ>Y[Y.length-1].overscaledZ))return void(this._overlapStencilType=!1);fe=1,this._overlapStencilMode.test={func:he.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+fe>255&&(ae.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=fe,this._overlapStencilMode.ref=this._stencilRef,te.isTileClipped()&&this._renderTileClippingMasks(Y,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(U){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[U.key]),this._overlapStencilMode):H.StencilMode.disabled}_renderTileClippingMasks(U,Y){const te=this.painter,ne=this.painter.context,ae=ne.gl;te._tileClippingMaskIDs={},ne.setColorMode(H.ColorMode.disabled),ne.setDepthMode(H.DepthMode.disabled);const he=te.useProgram("clippingMask");for(const fe of U){const de=te._tileClippingMaskIDs[fe.key]=--Y;he.draw(ne,ae.TRIANGLES,H.DepthMode.disabled,new H.StencilMode({func:ae.ALWAYS,mask:0},de,255,ae.KEEP,ae.KEEP,ae.REPLACE),H.ColorMode.disabled,H.CullFaceMode.disabled,za(fe.projMatrix),"$clipping",te.tileExtentBuffer,te.quadTriangleIndexBuffer,te.tileExtentSegments)}}pointCoordinate(U){const Y=this.painter.transform;if(U.x<0||U.x>Y.width||U.y<0||U.y>Y.height)return null;const te=[U.x,U.y,1,1];H.transformMat4$1(te,te,Y.pixelMatrixInverse),H.scale$1(te,te,1/te[3]),te[0]/=Y.worldSize,te[1]/=Y.worldSize;const ne=Y._camera.position,ae=H.mercatorZfromAltitude(1,Y.center.lat),he=[ne[0],ne[1],ne[2]/ae,0],fe=H.subtract([],te.slice(0,3),he);H.normalize(fe,fe);const de=this.raycast(he,fe,this._exaggeration);return de!==null&&de?(H.scaleAndAdd(he,he,fe,de),he[3]=he[2],he[2]*=ae,he):null}drawDepth(){const U=this.painter,Y=U.context,te=this.proxySourceCache,ne=Math.ceil(U.width),ae=Math.ceil(U.height);if(!this._depthFBO||this._depthFBO.width===ne&&this._depthFBO.height===ae||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const he=Y.gl,fe=Y.createFramebuffer(ne,ae,!0);Y.activeTexture.set(he.TEXTURE0);const de=new H.Texture(Y,{width:ne,height:ae,data:null},he.RGBA);de.bind(he.NEAREST,he.CLAMP_TO_EDGE),fe.colorAttachment.set(de.texture);const ve=Y.createRenderbuffer(Y.gl.DEPTH_COMPONENT16,ne,ae);fe.depthAttachment.set(ve),this._depthFBO=fe,this._depthTexture=de}Y.bindFramebuffer.set(this._depthFBO.framebuffer),Y.viewport.set([0,0,ne,ae]),function(he,fe,de,ve){if(he.transform.projection.name==="globe")return;const ge=he.context,Te=ge.gl;ge.clear({depth:1});const Pe=he.useProgram("terrainDepth"),Le=new H.DepthMode(Te.LESS,H.DepthMode.ReadWrite,he.depthRangeFor3D);for(const ke of ve){const Be=de.getTile(ke),Ne=oa(ke.projMatrix,0);fe.setupElevationDraw(Be,Pe),Pe.draw(ge,Te.TRIANGLES,Le,H.StencilMode.disabled,H.ColorMode.unblended,H.CullFaceMode.backCCW,Ne,"terrain_depth",fe.gridBuffer,fe.gridIndexBuffer,fe.gridNoSkirtSegments)}}(U,this,te,this.proxyCoords)}_setupProxiedCoordsForOrtho(U,Y,te){if(U.getSource()instanceof Or)return this._setupProxiedCoordsForImageSource(U,Y,te);this._findCoveringTileCache[U.id]=this._findCoveringTileCache[U.id]||{};const ne=this.proxiedCoords[U.id]=[],ae=this.proxyCoords;for(let fe=0;fe<ae.length;fe++){const de=ae[fe],ve=this._findTileCoveringTileID(de,U);if(ve){const ge=this._createProxiedId(de,ve,te[de.key]&&te[de.key][U.id]);ne.push(ge),this.proxyToSource[de.key][U.id]=[ge]}}let he=!1;for(let fe=0;fe<Y.length;fe++){const de=U.getTile(Y[fe]);if(!de||!de.hasData())continue;const ve=this._findTileCoveringTileID(de.tileID,this.proxySourceCache);if(ve&&ve.tileID.canonical.z!==de.tileID.canonical.z){const ge=this.proxyToSource[ve.tileID.key][U.id],Te=this._createProxiedId(ve.tileID,de,te[ve.tileID.key]&&te[ve.tileID.key][U.id]);ge?ge.splice(ge.length-1,0,Te):this.proxyToSource[ve.tileID.key][U.id]=[Te],ne.push(Te),he=!0}}this._sourceTilesOverlap[U.id]=he}_setupProxiedCoordsForImageSource(U,Y,te){if(!U.getSource().loaded())return;const ne=this.proxiedCoords[U.id]=[],ae=this.proxyCoords,he=U.getSource(),fe=new H.Point(he.tileID.x,he.tileID.y)._div(1<<he.tileID.z),de=he.coordinates.map(H.MercatorCoordinate.fromLngLat).reduce((ge,Te)=>(ge.min.x=Math.min(ge.min.x,Te.x-fe.x),ge.min.y=Math.min(ge.min.y,Te.y-fe.y),ge.max.x=Math.max(ge.max.x,Te.x-fe.x),ge.max.y=Math.max(ge.max.y,Te.y-fe.y),ge),{min:new H.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new H.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),ve=(ge,Te)=>{const Pe=ge.wrap+ge.canonical.x/(1<<ge.canonical.z),Le=ge.canonical.y/(1<<ge.canonical.z),ke=H.EXTENT/(1<<ge.canonical.z),Be=Te.wrap+Te.canonical.x/(1<<Te.canonical.z),Ne=Te.canonical.y/(1<<Te.canonical.z);return Pe+ke<Be+de.min.x||Pe>Be+de.max.x||Le+ke<Ne+de.min.y||Le>Ne+de.max.y};for(let ge=0;ge<ae.length;ge++){const Te=ae[ge];for(let Pe=0;Pe<Y.length;Pe++){const Le=U.getTile(Y[Pe]);if(!Le||!Le.hasData()||ve(Te,Le.tileID))continue;const ke=this._createProxiedId(Te,Le,te[Te.key]&&te[Te.key][U.id]),Be=this.proxyToSource[Te.key][U.id];Be?Be.push(ke):this.proxyToSource[Te.key][U.id]=[ke],ne.push(ke)}}}_createProxiedId(U,Y,te){let ne=this.orthoMatrix;if(te){const ae=te.find(he=>he.key===Y.tileID.key);if(ae)return ae}if(Y.tileID.key!==U.key){const ae=U.canonical.z-Y.tileID.canonical.z;let he,fe,de;ne=H.create();const ve=Y.tileID.wrap-U.wrap<<U.overscaledZ;ae>0?(he=H.EXTENT>>ae,fe=he*((Y.tileID.canonical.x<<ae)-U.canonical.x+ve),de=he*((Y.tileID.canonical.y<<ae)-U.canonical.y)):(he=H.EXTENT<<-ae,fe=H.EXTENT*(Y.tileID.canonical.x-(U.canonical.x+ve<<-ae)),de=H.EXTENT*(Y.tileID.canonical.y-(U.canonical.y<<-ae))),H.ortho(ne,0,he,0,he,0,1),H.translate(ne,ne,[fe,de,0])}return new Is(Y.tileID,U.key,ne)}_findTileCoveringTileID(U,Y){let te=Y.getTile(U);if(te&&te.hasData())return te;const ne=this._findCoveringTileCache[Y.id],ae=ne[U.key];if(te=ae?Y.getTileByID(ae):null,te&&te.hasData()||ae===null)return te;let he=te?te.tileID:U,fe=he.overscaledZ;const de=Y.getSource().minzoom,ve=[];if(!ae){const Te=Y.getSource().maxzoom;if(U.canonical.z>=Te){const Pe=U.canonical.z-Te;Y.getSource().reparseOverscaled?(fe=Math.max(U.canonical.z+2,Y.transform.tileZoom),he=new H.OverscaledTileID(fe,U.wrap,Te,U.canonical.x>>Pe,U.canonical.y>>Pe)):Pe!==0&&(fe=Te,he=new H.OverscaledTileID(fe,U.wrap,Te,U.canonical.x>>Pe,U.canonical.y>>Pe))}he.key!==U.key&&(ve.push(he.key),te=Y.getTile(he))}const ge=Te=>{ve.forEach(Pe=>{ne[Pe]=Te}),ve.length=0};for(fe-=1;fe>=de&&(!te||!te.hasData());fe--){te&&ge(te.tileID.key);const Te=he.calculateScaledKey(fe);if(te=Y.getTileByID(Te),te&&te.hasData())break;const Pe=ne[Te];if(Pe===null)break;Pe===void 0?ve.push(Te):te=Y.getTileByID(Pe)}return ge(te?te.tileID.key:null),te&&te.hasData()?te:null}findDEMTileFor(U){return this.enabled?this._findTileCoveringTileID(U,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(U,Y){let te=this._tilesDirty[U];te||(te=this._tilesDirty[U]={}),te[Y.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const U=function(Y){let te=0;const ne=new H.StructArrayLayout2ui4,ae=131;for(let he=1;he<129;he++){for(let fe=1;fe<129;fe++)te=he*ae+fe,ne.emplaceBack(te,te+1),ne.emplaceBack(te,te+ae),ne.emplaceBack(te+1,te+ae),he===128&&ne.emplaceBack(te+ae,te+ae+1);ne.emplaceBack(te+1,te+1+ae)}return ne}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(U),this.wireframeSegments=H.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,U.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class zr{static cacheKey(U,Y,te,ne){let ae=`${Y}${ne?ne.cacheKey:""}`;for(const he of te)U.usedDefines.includes(he)&&(ae+=`/${he}`);return ae}constructor(U,Y,te,ne,ae,he){const fe=U.gl;this.program=fe.createProgram();const de=function(Se){const De=[];for(let Ve=0;Ve<Se.length;Ve++){if(Se[Ve]===null)continue;const Ge=Se[Ve].split(" ");De.push(Ge.pop())}return De}(te.staticAttributes),ve=ne?ne.getBinderAttributes():[],ge=de.concat(ve);let Te=ne?ne.defines():[];Te=Te.concat(he.map(Se=>`#define ${Se}`));const Pe=U.isWebGL2?`#version 300 es
`:"",Le=Pe+Te.concat(U.extStandardDerivatives&&Pe.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Ol):Ol,Ol,ws,Qc.fragmentSource,ia.fragmentSource,te.fragmentSource).join(`
`),ke=Pe+Te.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ws,Qc.vertexSource,ia.vertexSource,bs.vertexSource,te.vertexSource).join(`
`),Be=fe.createShader(fe.FRAGMENT_SHADER);if(fe.isContextLost())return void(this.failedToCreate=!0);fe.shaderSource(Be,Le),fe.compileShader(Be),fe.attachShader(this.program,Be);const Ne=fe.createShader(fe.VERTEX_SHADER);if(fe.isContextLost())this.failedToCreate=!0;else{fe.shaderSource(Ne,ke),fe.compileShader(Ne),fe.attachShader(this.program,Ne),this.attributes={},this.numAttributes=ge.length;for(let Se=0;Se<this.numAttributes;Se++)ge[Se]&&(fe.bindAttribLocation(this.program,Se,ge[Se]),this.attributes[ge[Se]]=Se);fe.linkProgram(this.program),fe.deleteShader(Ne),fe.deleteShader(Be),this.fixedUniforms=ae(U),this.binderUniforms=ne?ne.getUniforms(U):[],he.includes("TERRAIN")&&(this.terrainUniforms=(Se=>({u_dem:new H.Uniform1i(Se),u_dem_prev:new H.Uniform1i(Se),u_dem_unpack:new H.Uniform4f(Se),u_dem_tl:new H.Uniform2f(Se),u_dem_scale:new H.Uniform1f(Se),u_dem_tl_prev:new H.Uniform2f(Se),u_dem_scale_prev:new H.Uniform1f(Se),u_dem_size:new H.Uniform1f(Se),u_dem_lerp:new H.Uniform1f(Se),u_exaggeration:new H.Uniform1f(Se),u_depth:new H.Uniform1i(Se),u_depth_size_inv:new H.Uniform2f(Se),u_meter_to_dem:new H.Uniform1f(Se),u_label_plane_matrix_inv:new H.UniformMatrix4f(Se)}))(U)),he.includes("GLOBE")&&(this.globeUniforms=(Se=>({u_tile_tl_up:new H.Uniform3f(Se),u_tile_tr_up:new H.Uniform3f(Se),u_tile_br_up:new H.Uniform3f(Se),u_tile_bl_up:new H.Uniform3f(Se),u_tile_up_scale:new H.Uniform1f(Se)}))(U)),he.includes("FOG")&&(this.fogUniforms=(Se=>({u_fog_matrix:new H.UniformMatrix4f(Se),u_fog_range:new H.Uniform2f(Se),u_fog_color:new H.Uniform4f(Se),u_fog_horizon_blend:new H.Uniform1f(Se),u_fog_temporal_offset:new H.Uniform1f(Se),u_frustum_tl:new H.Uniform3f(Se),u_frustum_tr:new H.Uniform3f(Se),u_frustum_br:new H.Uniform3f(Se),u_frustum_bl:new H.Uniform3f(Se),u_globe_pos:new H.Uniform3f(Se),u_globe_radius:new H.Uniform1f(Se),u_globe_transition:new H.Uniform1f(Se),u_is_globe:new H.Uniform1i(Se),u_viewport:new H.Uniform2f(Se)}))(U))}}setTerrainUniformValues(U,Y){if(!this.terrainUniforms)return;const te=this.terrainUniforms;if(!this.failedToCreate){U.program.set(this.program);for(const ne in Y)te[ne]&&te[ne].set(this.program,ne,Y[ne])}}setGlobeUniformValues(U,Y){if(!this.globeUniforms)return;const te=this.globeUniforms;if(!this.failedToCreate){U.program.set(this.program);for(const ne in Y)te[ne]&&te[ne].set(this.program,ne,Y[ne])}}setFogUniformValues(U,Y){if(!this.fogUniforms)return;const te=this.fogUniforms;if(!this.failedToCreate){U.program.set(this.program);for(const ne in Y)te[ne].set(this.program,ne,Y[ne])}}draw(U,Y,te,ne,ae,he,fe,de,ve,ge,Te,Pe,Le,ke,Be){const Ne=U.gl;if(this.failedToCreate)return;U.program.set(this.program),U.setDepthMode(te),U.setStencilMode(ne),U.setColorMode(ae),U.setCullFace(he);for(const De of Object.keys(this.fixedUniforms))this.fixedUniforms[De].set(this.program,De,fe[De]);ke&&ke.setUniforms(this.program,U,this.binderUniforms,Pe,{zoom:Le});const Se={[Ne.LINES]:2,[Ne.TRIANGLES]:3,[Ne.LINE_STRIP]:1}[Y];for(const De of Te.get()){const Ve=De.vaos||(De.vaos={});(Ve[de]||(Ve[de]=new $h)).bind(U,this,ve,ke?ke.getPaintVertexBuffers():[],ge,De.vertexOffset,Be||[]),Ne.drawElements(Y,De.primitiveLength*Se,Ne.UNSIGNED_SHORT,De.primitiveOffset*Se*2)}}}function Ua(Q,U){const Y=Math.pow(2,U.tileID.overscaledZ),te=U.tileSize*Math.pow(2,Q.transform.tileZoom)/Y,ne=te*(U.tileID.canonical.x+U.tileID.wrap*Y),ae=te*U.tileID.canonical.y;return{u_image:0,u_texsize:U.imageAtlasTexture.size,u_tile_units_to_pixels:1/Ht(U,1,Q.transform.tileZoom),u_pixel_coord_upper:[ne>>16,ae>>16],u_pixel_coord_lower:[65535&ne,65535&ae]}}const iu=H.create(),kl=(Q,U,Y,te,ne,ae,he,fe,de,ve,ge)=>{const Te=U.style.light,Pe=Te.properties.get("position"),Le=[Pe.x,Pe.y,Pe.z],ke=H.create$1();Te.properties.get("anchor")==="viewport"&&(H.fromRotation(ke,-U.transform.angle),H.transformMat3(Le,Le,ke));const Be=Te.properties.get("color"),Ne=U.transform,Se={u_matrix:Q,u_lightpos:Le,u_lightintensity:Te.properties.get("intensity"),u_lightcolor:[Be.r,Be.g,Be.b],u_vertical_gradient:+Y,u_opacity:te,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:iu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:ne,u_edge_radius:ae};return Ne.projection.name==="globe"&&(Se.u_tile_id=[he.canonical.x,he.canonical.y,1<<he.canonical.z],Se.u_zoom_transition=de,Se.u_inv_rot_matrix=ge,Se.u_merc_center=ve,Se.u_up_dir=Ne.projection.upVector(new H.CanonicalTileID(0,0,0),ve[0]*H.EXTENT,ve[1]*H.EXTENT),Se.u_height_lift=fe),Se},nu=(Q,U,Y,te,ne,ae,he,fe,de,ve,ge,Te)=>{const Pe=kl(Q,U,Y,te,ne,ae,he,de,ve,ge,Te),Le={u_height_factor:-Math.pow(2,he.overscaledZ)/fe.tileSize/8};return H.extend(Pe,Ua(U,fe),Le)},No=Q=>({u_matrix:Q}),Nl=(Q,U,Y)=>H.extend(No(Q),Ua(U,Y)),xh=(Q,U)=>({u_matrix:Q,u_world:U}),bh=(Q,U,Y,te)=>H.extend(Nl(Q,U,Y),{u_world:te}),wh=H.create(),Fl=(Q,U,Y,te,ne,ae)=>{const he=Q.transform,fe=he.projection.name==="globe";let de;if(ae.paint.get("circle-pitch-alignment")==="map")if(fe){const ge=H.globePixelsToTileUnits(he.zoom,U.canonical)*he._pixelsPerMercatorPixel;de=Float32Array.from([ge,0,0,ge])}else de=he.calculatePixelsToTileUnitsMatrix(Y);else de=new Float32Array([he.pixelsToGLUnits[0],0,0,he.pixelsToGLUnits[1]]);const ve={u_camera_to_center_distance:he.cameraToCenterDistance,u_matrix:Q.translatePosMatrix(U.projMatrix,Y,ae.paint.get("circle-translate"),ae.paint.get("circle-translate-anchor")),u_device_pixel_ratio:H.exported.devicePixelRatio,u_extrude_scale:de,u_inv_rot_matrix:wh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(fe){ve.u_inv_rot_matrix=te,ve.u_merc_center=ne,ve.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],ve.u_zoom_transition=H.globeToMercatorTransition(he.zoom);const ge=ne[0]*H.EXTENT,Te=ne[1]*H.EXTENT;ve.u_up_dir=he.projection.upVector(new H.CanonicalTileID(0,0,0),ge,Te)}return ve},zl=Q=>{const U=[];return Q.paint.get("circle-pitch-alignment")==="map"&&U.push("PITCH_WITH_MAP"),Q.paint.get("circle-pitch-scale")==="map"&&U.push("SCALE_WITH_MAP"),U},Ul=(Q,U,Y,te)=>{const ne=H.EXTENT/Y.tileSize;return{u_matrix:Q,u_camera_to_center_distance:U.getCameraToCenterDistance(te),u_extrude_scale:[U.pixelsToGLUnits[0]/ne,U.pixelsToGLUnits[1]/ne]}},As=(Q,U,Y=1)=>({u_matrix:Q,u_color:U,u_overlay:0,u_overlay_scale:Y}),ou=H.create(),au=(Q,U,Y,te,ne,ae,he)=>{const fe=Q.transform,de=fe.projection.name==="globe",ve=de?H.globePixelsToTileUnits(fe.zoom,U.canonical)*fe._pixelsPerMercatorPixel:Ht(Y,1,ae),ge={u_matrix:U.projMatrix,u_extrude_scale:ve,u_intensity:he,u_inv_rot_matrix:ou,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(de){ge.u_inv_rot_matrix=te,ge.u_merc_center=ne,ge.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],ge.u_zoom_transition=H.globeToMercatorTransition(fe.zoom);const Te=ne[0]*H.EXTENT,Pe=ne[1]*H.EXTENT;ge.u_up_dir=fe.projection.upVector(new H.CanonicalTileID(0,0,0),Te,Pe)}return ge},Eh=(Q,U,Y,te,ne,ae,he)=>{const fe=Q.transform,de=fe.calculatePixelsToTileUnitsMatrix(U);return{u_matrix:jl(Q,U,Y,te),u_pixels_to_tile_units:de,u_device_pixel_ratio:ae,u_units_to_pixels:[1/fe.pixelsToGLUnits[0],1/fe.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:ne,u_texsize:Va(Y)?U.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:sa(U,Q.transform),u_alpha_discard_threshold:0,u_trim_offset:he}},ja=(Q,U,Y,te,ne)=>{const ae=Q.transform;return{u_matrix:jl(Q,U,Y,te),u_texsize:U.imageAtlasTexture.size,u_pixels_to_tile_units:ae.calculatePixelsToTileUnitsMatrix(U),u_device_pixel_ratio:ne,u_image:0,u_tile_units_to_pixels:sa(U,ae),u_units_to_pixels:[1/ae.pixelsToGLUnits[0],1/ae.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function sa(Q,U){return 1/Ht(Q,1,U.tileZoom)}function jl(Q,U,Y,te){return Q.translatePosMatrix(te||U.tileID.projMatrix,U,Y.paint.get("line-translate"),Y.paint.get("line-translate-anchor"))}function Va(Q){const U=Q.paint.get("line-dasharray").value;return U.value||U.kind!=="constant"}const Vl=(Q,U,Y,te,ne,ae)=>{return{u_matrix:Q,u_tl_parent:U,u_scale_parent:Y,u_fade_t:te.mix,u_opacity:te.opacity*ne.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ne.paint.get("raster-brightness-min"),u_brightness_high:ne.paint.get("raster-brightness-max"),u_saturation_factor:(fe=ne.paint.get("raster-saturation"),fe>0?1-1/(1.001-fe):-fe),u_contrast_factor:(he=ne.paint.get("raster-contrast"),he>0?1/(1-he):1+he),u_spin_weights:qn(ne.paint.get("raster-hue-rotate")),u_perspective_transform:ae};var he,fe};function qn(Q){Q*=Math.PI/180;const U=Math.sin(Q),Y=Math.cos(Q);return[(2*Y+1)/3,(-Math.sqrt(3)*U-Y+1)/3,(Math.sqrt(3)*U-Y+1)/3]}const Os=H.create(),Gl=(Q,U,Y,te,ne,ae,he,fe,de,ve,ge,Te,Pe,Le,ke,Be)=>{const Ne=ne.transform,Se={u_is_size_zoom_constant:+(Q==="constant"||Q==="source"),u_is_size_feature_constant:+(Q==="constant"||Q==="camera"),u_size_t:U?U.uSizeT:0,u_size:U?U.uSize:0,u_camera_to_center_distance:Ne.cameraToCenterDistance,u_rotate_symbol:+Y,u_aspect_ratio:Ne.width/Ne.height,u_fade_change:ne.options.fadeDuration?ne.symbolFadeChange:1,u_matrix:ae,u_label_plane_matrix:he,u_coord_matrix:fe,u_is_text:+de,u_pitch_with_map:+te,u_texsize:ve,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Os,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Os,u_up_vector:[0,-1,0]};return Be.name==="globe"&&(Se.u_tile_id=[ge.canonical.x,ge.canonical.y,1<<ge.canonical.z],Se.u_zoom_transition=Te,Se.u_inv_rot_matrix=Le,Se.u_merc_center=Pe,Se.u_camera_forward=Ne._camera.forward(),Se.u_ecef_origin=H.globeECEFOrigin(Ne.globeMatrix,ge.toUnwrapped()),Se.u_tile_matrix=Float32Array.from(Ne.globeMatrix),Se.u_up_vector=ke),Se},Cs=(Q,U,Y,te,ne,ae,he,fe,de,ve,ge,Te,Pe,Le,ke,Be,Ne)=>H.extend(Gl(Q,U,Y,te,ne,ae,he,fe,de,ve,Te,Pe,Le,ke,Be,Ne),{u_gamma_scale:te?ne.transform.cameraToCenterDistance*Math.cos(ne.terrain?0:ne.transform._pitch):1,u_device_pixel_ratio:H.exported.devicePixelRatio,u_is_halo:+ge}),su=(Q,U,Y,te,ne,ae,he,fe,de,ve,ge,Te,Pe,Le,ke,Be)=>H.extend(Cs(Q,U,Y,te,ne,ae,he,fe,!0,de,!0,ge,Te,Pe,Le,ke,Be),{u_texsize_icon:ve,u_texture_icon:1}),Wl=(Q,U,Y)=>({u_matrix:Q,u_opacity:U,u_color:Y}),Th=(Q,U,Y,te,ne)=>H.extend(function(ae,he,fe){const de=he.imageManager.getPattern(ae.toString()),{width:ve,height:ge}=he.imageManager.getPixelSize(),Te=Math.pow(2,fe.tileID.overscaledZ),Pe=fe.tileSize*Math.pow(2,he.transform.tileZoom)/Te,Le=Pe*(fe.tileID.canonical.x+fe.tileID.wrap*Te),ke=Pe*fe.tileID.canonical.y;return{u_image:0,u_pattern_tl:de.tl,u_pattern_br:de.br,u_texsize:[ve,ge],u_pattern_size:de.displaySize,u_tile_units_to_pixels:1/Ht(fe,1,he.transform.tileZoom),u_pixel_coord_upper:[Le>>16,ke>>16],u_pixel_coord_lower:[65535&Le,65535&ke]}}(te,Y,ne),{u_matrix:Q,u_opacity:U}),ql={fillExtrusion:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_lightpos:new H.Uniform3f(Q),u_lightintensity:new H.Uniform1f(Q),u_lightcolor:new H.Uniform3f(Q),u_vertical_gradient:new H.Uniform1f(Q),u_opacity:new H.Uniform1f(Q),u_edge_radius:new H.Uniform1f(Q),u_ao:new H.Uniform2f(Q),u_tile_id:new H.Uniform3f(Q),u_zoom_transition:new H.Uniform1f(Q),u_inv_rot_matrix:new H.UniformMatrix4f(Q),u_merc_center:new H.Uniform2f(Q),u_up_dir:new H.Uniform3f(Q),u_height_lift:new H.Uniform1f(Q)}),fillExtrusionPattern:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_lightpos:new H.Uniform3f(Q),u_lightintensity:new H.Uniform1f(Q),u_lightcolor:new H.Uniform3f(Q),u_vertical_gradient:new H.Uniform1f(Q),u_height_factor:new H.Uniform1f(Q),u_edge_radius:new H.Uniform1f(Q),u_ao:new H.Uniform2f(Q),u_tile_id:new H.Uniform3f(Q),u_zoom_transition:new H.Uniform1f(Q),u_inv_rot_matrix:new H.UniformMatrix4f(Q),u_merc_center:new H.Uniform2f(Q),u_up_dir:new H.Uniform3f(Q),u_height_lift:new H.Uniform1f(Q),u_image:new H.Uniform1i(Q),u_texsize:new H.Uniform2f(Q),u_pixel_coord_upper:new H.Uniform2f(Q),u_pixel_coord_lower:new H.Uniform2f(Q),u_tile_units_to_pixels:new H.Uniform1f(Q),u_opacity:new H.Uniform1f(Q)}),fill:Q=>({u_matrix:new H.UniformMatrix4f(Q)}),fillPattern:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_image:new H.Uniform1i(Q),u_texsize:new H.Uniform2f(Q),u_pixel_coord_upper:new H.Uniform2f(Q),u_pixel_coord_lower:new H.Uniform2f(Q),u_tile_units_to_pixels:new H.Uniform1f(Q)}),fillOutline:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_world:new H.Uniform2f(Q)}),fillOutlinePattern:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_world:new H.Uniform2f(Q),u_image:new H.Uniform1i(Q),u_texsize:new H.Uniform2f(Q),u_pixel_coord_upper:new H.Uniform2f(Q),u_pixel_coord_lower:new H.Uniform2f(Q),u_tile_units_to_pixels:new H.Uniform1f(Q)}),circle:Q=>({u_camera_to_center_distance:new H.Uniform1f(Q),u_extrude_scale:new H.UniformMatrix2f(Q),u_device_pixel_ratio:new H.Uniform1f(Q),u_matrix:new H.UniformMatrix4f(Q),u_inv_rot_matrix:new H.UniformMatrix4f(Q),u_merc_center:new H.Uniform2f(Q),u_tile_id:new H.Uniform3f(Q),u_zoom_transition:new H.Uniform1f(Q),u_up_dir:new H.Uniform3f(Q)}),collisionBox:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_camera_to_center_distance:new H.Uniform1f(Q),u_extrude_scale:new H.Uniform2f(Q)}),collisionCircle:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_inv_matrix:new H.UniformMatrix4f(Q),u_camera_to_center_distance:new H.Uniform1f(Q),u_viewport_size:new H.Uniform2f(Q)}),debug:Q=>({u_color:new H.UniformColor(Q),u_matrix:new H.UniformMatrix4f(Q),u_overlay:new H.Uniform1i(Q),u_overlay_scale:new H.Uniform1f(Q)}),clippingMask:Q=>({u_matrix:new H.UniformMatrix4f(Q)}),heatmap:Q=>({u_extrude_scale:new H.Uniform1f(Q),u_intensity:new H.Uniform1f(Q),u_matrix:new H.UniformMatrix4f(Q),u_inv_rot_matrix:new H.UniformMatrix4f(Q),u_merc_center:new H.Uniform2f(Q),u_tile_id:new H.Uniform3f(Q),u_zoom_transition:new H.Uniform1f(Q),u_up_dir:new H.Uniform3f(Q)}),heatmapTexture:Q=>({u_image:new H.Uniform1i(Q),u_color_ramp:new H.Uniform1i(Q),u_opacity:new H.Uniform1f(Q)}),hillshade:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_image:new H.Uniform1i(Q),u_latrange:new H.Uniform2f(Q),u_light:new H.Uniform2f(Q),u_shadow:new H.UniformColor(Q),u_highlight:new H.UniformColor(Q),u_accent:new H.UniformColor(Q)}),hillshadePrepare:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_image:new H.Uniform1i(Q),u_dimension:new H.Uniform2f(Q),u_zoom:new H.Uniform1f(Q),u_unpack:new H.Uniform4f(Q)}),line:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_pixels_to_tile_units:new H.UniformMatrix2f(Q),u_device_pixel_ratio:new H.Uniform1f(Q),u_units_to_pixels:new H.Uniform2f(Q),u_dash_image:new H.Uniform1i(Q),u_gradient_image:new H.Uniform1i(Q),u_image_height:new H.Uniform1f(Q),u_texsize:new H.Uniform2f(Q),u_tile_units_to_pixels:new H.Uniform1f(Q),u_alpha_discard_threshold:new H.Uniform1f(Q),u_trim_offset:new H.Uniform2f(Q)}),linePattern:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_texsize:new H.Uniform2f(Q),u_pixels_to_tile_units:new H.UniformMatrix2f(Q),u_device_pixel_ratio:new H.Uniform1f(Q),u_image:new H.Uniform1i(Q),u_units_to_pixels:new H.Uniform2f(Q),u_tile_units_to_pixels:new H.Uniform1f(Q),u_alpha_discard_threshold:new H.Uniform1f(Q)}),raster:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_tl_parent:new H.Uniform2f(Q),u_scale_parent:new H.Uniform1f(Q),u_fade_t:new H.Uniform1f(Q),u_opacity:new H.Uniform1f(Q),u_image0:new H.Uniform1i(Q),u_image1:new H.Uniform1i(Q),u_brightness_low:new H.Uniform1f(Q),u_brightness_high:new H.Uniform1f(Q),u_saturation_factor:new H.Uniform1f(Q),u_contrast_factor:new H.Uniform1f(Q),u_spin_weights:new H.Uniform3f(Q),u_perspective_transform:new H.Uniform2f(Q)}),symbolIcon:Q=>({u_is_size_zoom_constant:new H.Uniform1i(Q),u_is_size_feature_constant:new H.Uniform1i(Q),u_size_t:new H.Uniform1f(Q),u_size:new H.Uniform1f(Q),u_camera_to_center_distance:new H.Uniform1f(Q),u_rotate_symbol:new H.Uniform1i(Q),u_aspect_ratio:new H.Uniform1f(Q),u_fade_change:new H.Uniform1f(Q),u_matrix:new H.UniformMatrix4f(Q),u_label_plane_matrix:new H.UniformMatrix4f(Q),u_coord_matrix:new H.UniformMatrix4f(Q),u_is_text:new H.Uniform1i(Q),u_pitch_with_map:new H.Uniform1i(Q),u_texsize:new H.Uniform2f(Q),u_tile_id:new H.Uniform3f(Q),u_zoom_transition:new H.Uniform1f(Q),u_inv_rot_matrix:new H.UniformMatrix4f(Q),u_merc_center:new H.Uniform2f(Q),u_camera_forward:new H.Uniform3f(Q),u_tile_matrix:new H.UniformMatrix4f(Q),u_up_vector:new H.Uniform3f(Q),u_ecef_origin:new H.Uniform3f(Q),u_texture:new H.Uniform1i(Q)}),symbolSDF:Q=>({u_is_size_zoom_constant:new H.Uniform1i(Q),u_is_size_feature_constant:new H.Uniform1i(Q),u_size_t:new H.Uniform1f(Q),u_size:new H.Uniform1f(Q),u_camera_to_center_distance:new H.Uniform1f(Q),u_rotate_symbol:new H.Uniform1i(Q),u_aspect_ratio:new H.Uniform1f(Q),u_fade_change:new H.Uniform1f(Q),u_matrix:new H.UniformMatrix4f(Q),u_label_plane_matrix:new H.UniformMatrix4f(Q),u_coord_matrix:new H.UniformMatrix4f(Q),u_is_text:new H.Uniform1i(Q),u_pitch_with_map:new H.Uniform1i(Q),u_texsize:new H.Uniform2f(Q),u_texture:new H.Uniform1i(Q),u_gamma_scale:new H.Uniform1f(Q),u_device_pixel_ratio:new H.Uniform1f(Q),u_tile_id:new H.Uniform3f(Q),u_zoom_transition:new H.Uniform1f(Q),u_inv_rot_matrix:new H.UniformMatrix4f(Q),u_merc_center:new H.Uniform2f(Q),u_camera_forward:new H.Uniform3f(Q),u_tile_matrix:new H.UniformMatrix4f(Q),u_up_vector:new H.Uniform3f(Q),u_ecef_origin:new H.Uniform3f(Q),u_is_halo:new H.Uniform1i(Q)}),symbolTextAndIcon:Q=>({u_is_size_zoom_constant:new H.Uniform1i(Q),u_is_size_feature_constant:new H.Uniform1i(Q),u_size_t:new H.Uniform1f(Q),u_size:new H.Uniform1f(Q),u_camera_to_center_distance:new H.Uniform1f(Q),u_rotate_symbol:new H.Uniform1i(Q),u_aspect_ratio:new H.Uniform1f(Q),u_fade_change:new H.Uniform1f(Q),u_matrix:new H.UniformMatrix4f(Q),u_label_plane_matrix:new H.UniformMatrix4f(Q),u_coord_matrix:new H.UniformMatrix4f(Q),u_is_text:new H.Uniform1i(Q),u_pitch_with_map:new H.Uniform1i(Q),u_texsize:new H.Uniform2f(Q),u_texsize_icon:new H.Uniform2f(Q),u_texture:new H.Uniform1i(Q),u_texture_icon:new H.Uniform1i(Q),u_gamma_scale:new H.Uniform1f(Q),u_device_pixel_ratio:new H.Uniform1f(Q),u_is_halo:new H.Uniform1i(Q)}),background:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_opacity:new H.Uniform1f(Q),u_color:new H.UniformColor(Q)}),backgroundPattern:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_opacity:new H.Uniform1f(Q),u_image:new H.Uniform1i(Q),u_pattern_tl:new H.Uniform2f(Q),u_pattern_br:new H.Uniform2f(Q),u_texsize:new H.Uniform2f(Q),u_pattern_size:new H.Uniform2f(Q),u_pixel_coord_upper:new H.Uniform2f(Q),u_pixel_coord_lower:new H.Uniform2f(Q),u_tile_units_to_pixels:new H.Uniform1f(Q)}),terrainRaster:Ml,terrainDepth:Ml,skybox:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_sun_direction:new H.Uniform3f(Q),u_cubemap:new H.Uniform1i(Q),u_opacity:new H.Uniform1f(Q),u_temporal_offset:new H.Uniform1f(Q)}),skyboxGradient:Q=>({u_matrix:new H.UniformMatrix4f(Q),u_color_ramp:new H.Uniform1i(Q),u_center_direction:new H.Uniform3f(Q),u_radius:new H.Uniform1f(Q),u_opacity:new H.Uniform1f(Q),u_temporal_offset:new H.Uniform1f(Q)}),skyboxCapture:Q=>({u_matrix_3f:new H.UniformMatrix3f(Q),u_sun_direction:new H.Uniform3f(Q),u_sun_intensity:new H.Uniform1f(Q),u_color_tint_r:new H.Uniform4f(Q),u_color_tint_m:new H.Uniform4f(Q),u_luminance:new H.Uniform1f(Q)}),globeRaster:Q=>({u_proj_matrix:new H.UniformMatrix4f(Q),u_globe_matrix:new H.UniformMatrix4f(Q),u_normalize_matrix:new H.UniformMatrix4f(Q),u_merc_matrix:new H.UniformMatrix4f(Q),u_zoom_transition:new H.Uniform1f(Q),u_merc_center:new H.Uniform2f(Q),u_image0:new H.Uniform1i(Q),u_grid_matrix:new H.UniformMatrix3f(Q),u_skirt_height:new H.Uniform1f(Q),u_frustum_tl:new H.Uniform3f(Q),u_frustum_tr:new H.Uniform3f(Q),u_frustum_br:new H.Uniform3f(Q),u_frustum_bl:new H.Uniform3f(Q),u_globe_pos:new H.Uniform3f(Q),u_globe_radius:new H.Uniform1f(Q),u_viewport:new H.Uniform2f(Q)}),globeAtmosphere:Q=>({u_frustum_tl:new H.Uniform3f(Q),u_frustum_tr:new H.Uniform3f(Q),u_frustum_br:new H.Uniform3f(Q),u_frustum_bl:new H.Uniform3f(Q),u_horizon:new H.Uniform1f(Q),u_transition:new H.Uniform1f(Q),u_fadeout_range:new H.Uniform1f(Q),u_color:new H.Uniform4f(Q),u_high_color:new H.Uniform4f(Q),u_space_color:new H.Uniform4f(Q),u_star_intensity:new H.Uniform1f(Q),u_star_density:new H.Uniform1f(Q),u_star_size:new H.Uniform1f(Q),u_temporal_offset:new H.Uniform1f(Q),u_horizon_angle:new H.Uniform1f(Q),u_rotation_matrix:new H.UniformMatrix4f(Q)})};let Ps;function Ga(Q,U,Y,te,ne,ae,he){const fe=Q.context,de=fe.gl,ve=Q.transform,ge=Q.useProgram("collisionBox"),Te=[];let Pe=0,Le=0;for(let Ge=0;Ge<te.length;Ge++){const Qe=te[Ge],tt=U.getTile(Qe),et=tt.getBucket(Y);if(!et)continue;const at=En(Qe,et,ve);let nt=at;ne[0]===0&&ne[1]===0||(nt=Q.translatePosMatrix(at,tt,ne,ae));const pt=he?et.textCollisionBox:et.iconCollisionBox,kt=et.collisionCircleArray;if(kt.length>0){const ct=H.create(),At=nt;H.mul(ct,et.placementInvProjMatrix,ve.glCoordMatrix),H.mul(ct,ct,et.placementViewportMatrix),Te.push({circleArray:kt,circleOffset:Le,transform:At,invTransform:ct,projection:et.getProjection()}),Pe+=kt.length/4,Le=Pe}pt&&(Q.terrain&&Q.terrain.setupElevationDraw(tt,ge),ge.draw(fe,de.LINES,H.DepthMode.disabled,H.StencilMode.disabled,Q.colorModeForRenderPass(),H.CullFaceMode.disabled,Ul(nt,ve,tt,et.getProjection()),Y.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,null,ve.zoom,null,[pt.collisionVertexBuffer,pt.collisionVertexBufferExt]))}if(!he||!Te.length)return;const ke=Q.useProgram("collisionCircle"),Be=new H.StructArrayLayout2f1f2i16;Be.resize(4*Pe),Be._trim();let Ne=0;for(const Ge of Te)for(let Qe=0;Qe<Ge.circleArray.length/4;Qe++){const tt=4*Qe,et=Ge.circleArray[tt+0],at=Ge.circleArray[tt+1],nt=Ge.circleArray[tt+2],pt=Ge.circleArray[tt+3];Be.emplace(Ne++,et,at,nt,pt,0),Be.emplace(Ne++,et,at,nt,pt,1),Be.emplace(Ne++,et,at,nt,pt,2),Be.emplace(Ne++,et,at,nt,pt,3)}(!Ps||Ps.length<2*Pe)&&(Ps=function(Ge){const Qe=2*Ge,tt=new H.StructArrayLayout3ui6;tt.resize(Qe),tt._trim();for(let et=0;et<Qe;et++){const at=6*et;tt.uint16[at+0]=4*et+0,tt.uint16[at+1]=4*et+1,tt.uint16[at+2]=4*et+2,tt.uint16[at+3]=4*et+2,tt.uint16[at+4]=4*et+3,tt.uint16[at+5]=4*et+0}return tt}(Pe));const Se=fe.createIndexBuffer(Ps,!0),De=fe.createVertexBuffer(Be,H.collisionCircleLayout.members,!0);for(const Ge of Te){const Qe={u_matrix:Ge.transform,u_inv_matrix:Ge.invTransform,u_camera_to_center_distance:(Ve=ve).getCameraToCenterDistance(Ge.projection),u_viewport_size:[Ve.width,Ve.height]};ke.draw(fe,de.TRIANGLES,H.DepthMode.disabled,H.StencilMode.disabled,Q.colorModeForRenderPass(),H.CullFaceMode.disabled,Qe,Y.id,De,Se,H.SegmentVector.simpleSegment(0,2*Ge.circleOffset,Ge.circleArray.length,Ge.circleArray.length/2),null,ve.zoom)}var Ve;De.destroy(),Se.destroy()}const lu=H.create();function Hl({width:Q,height:U,anchor:Y,textOffset:te,textScale:ne},ae){const{horizontalAlign:he,verticalAlign:fe}=H.getAnchorAlignment(Y),de=-(he-.5)*Q,ve=-(fe-.5)*U,ge=H.evaluateVariableOffset(Y,te);return new H.Point((de/ne+ge[0])*ae,(ve/ne+ge[1])*ae)}function Sh(Q,U,Y,te,ne,ae,he,fe,de,ve,ge){const Te=Q.text.placedSymbolArray,Pe=Q.text.dynamicLayoutVertexArray,Le=Q.icon.dynamicLayoutVertexArray,ke={},Be=Q.getProjection(),Ne=yi(fe,Be,ae),Se=ae.elevation,De=Be.upVectorScale(fe.canonical,ae.center.lat,ae.worldSize).metersToTile;Pe.clear();for(let Ve=0;Ve<Te.length;Ve++){const Ge=Te.get(Ve),{tileAnchorX:Qe,tileAnchorY:tt,numGlyphs:et}=Ge,at=Ge.hidden||!Ge.crossTileID||Q.allowVerticalPlacement&&!Ge.placedOrientation?null:te[Ge.crossTileID];if(at){let nt=0,pt=0,kt=0;if(Se){const Ut=Se?Se.getAtTileOffset(fe,Qe,tt):0,[lr,_r,rr]=Be.upVector(fe.canonical,Qe,tt);nt=Ut*lr*De,pt=Ut*_r*De,kt=Ut*rr*De}let[ct,At,yt,Bt]=Ui(Ge.projectedAnchorX+nt,Ge.projectedAnchorY+pt,Ge.projectedAnchorZ+kt,Y?Ne:he);const ft=Kc(ae.getCameraToCenterDistance(Be),Bt);let St=ne.evaluateSizeForFeature(Q.textSizeData,ve,Ge)*ft/H.ONE_EM;Y&&(St*=Q.tilePixelRatio/de);const Ft=Hl(at,St);Y?({x:ct,y:At,z:yt}=Be.projectTilePoint(Qe+Ft.x,tt+Ft.y,fe.canonical),[ct,At,yt]=Ui(ct+nt,At+pt,yt+kt,he)):(U&&Ft._rotate(-ae.angle),ct+=Ft.x,At+=Ft.y,yt=0);const Mt=Q.allowVerticalPlacement&&Ge.placedOrientation===H.WritingMode.vertical?Math.PI/2:0;for(let Ut=0;Ut<et;Ut++)H.addDynamicAttributes(Pe,ct,At,yt,Mt);ge&&Ge.associatedIconIndex>=0&&(ke[Ge.associatedIconIndex]={x:ct,y:At,z:yt,angle:Mt})}else Dn(et,Pe)}if(ge){Le.clear();const Ve=Q.icon.placedSymbolArray;for(let Ge=0;Ge<Ve.length;Ge++){const Qe=Ve.get(Ge),{numGlyphs:tt}=Qe,et=ke[Ge];if(Qe.hidden||!et)Dn(tt,Le);else{const{x:at,y:nt,z:pt,angle:kt}=et;for(let ct=0;ct<tt;ct++)H.addDynamicAttributes(Le,at,nt,pt,kt)}}Q.icon.dynamicLayoutVertexBuffer.updateData(Le)}Q.text.dynamicLayoutVertexBuffer.updateData(Pe)}function Kl(Q,U,Y){return Y.iconsInText&&U?"symbolTextAndIcon":Q?"symbolSDF":"symbolIcon"}function cu(Q,U,Y,te,ne,ae,he,fe,de,ve,ge,Te){const Pe=Q.context,Le=Pe.gl,ke=Q.transform,Be=fe==="map",Ne=de==="map",Se=Be&&Y.layout.get("symbol-placement")!=="point",De=Be&&!Ne&&!Se,Ve=Y.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ge=!1;const Qe=Q.depthModeForSublayer(0,H.DepthMode.ReadOnly),tt=[H.mercatorXfromLng(ke.center.lng),H.mercatorYfromLat(ke.center.lat)],et=Y.layout.get("text-variable-anchor"),at=ke.projection.name==="globe",nt=[],pt=[0,-1,0];let kt=pt;!at&&!ke.mercatorFromTransition||Be||(kt=function(ct){const At=ct._camera.getWorldToCamera(ct.worldSize,1),yt=H.multiply([],At,ct.globeMatrix);H.invert(yt,yt);const Bt=[0,0,0],ft=[0,1,0,0];return H.transformMat4$1(ft,ft,yt),Bt[0]=ft[0],Bt[1]=ft[1],Bt[2]=ft[2],H.normalize(Bt,Bt),Bt}(ke));for(const ct of te){const At=U.getTile(ct),yt=At.getBucket(Y);if(!yt||yt.projection.name==="mercator"&&at)continue;const Bt=ne?yt.text:yt.icon;if(!Bt||yt.fullyClipped||!Bt.segments.get().length)continue;const ft=Bt.programConfigurations.get(Y.id),St=ne||yt.sdfIcons,Ft=ne?yt.textSizeData:yt.iconSizeData,Mt=Ne||ke.pitch!==0,Ut=H.evaluateSizeForZoom(Ft,ke.zoom);let lr,_r,rr,fr,Lr=[0,0],Pr=null;if(ne)_r=At.glyphAtlasTexture,rr=Le.LINEAR,lr=At.glyphAtlasTexture.size,yt.iconsInText&&(Lr=At.imageAtlasTexture.size,Pr=At.imageAtlasTexture,fr=Mt||Q.options.rotating||Q.options.zooming||Ft.kind==="composite"||Ft.kind==="camera"?Le.LINEAR:Le.NEAREST);else{const uo=Y.layout.get("icon-size").constantOr(0)!==1||yt.iconsNeedLinear;_r=At.imageAtlasTexture,rr=St||Q.options.rotating||Q.options.zooming||uo||Mt?Le.LINEAR:Le.NEAREST,lr=At.imageAtlasTexture.size}const or=yt.projection.name==="globe",Kr=or?kt:pt,Qr=or?H.globeToMercatorTransition(ke.zoom):0,ei=yi(ct,yt.getProjection(),ke),ti=ke.calculatePixelsToTileUnitsMatrix(At),nn=Et(ei,At.tileID.canonical,Ne,Be,ke,yt.getProjection(),ti),Vi=Q.terrain&&Ne&&Se?H.invert(H.create(),nn):lu,An=Oi(ei,At.tileID.canonical,Ne,Be,ke,yt.getProjection(),ti),Kn=et&&yt.hasTextData(),_i=Y.layout.get("icon-text-fit")!=="none"&&Kn&&yt.hasIconData();if(Se){const uo=ke.elevation,wo=uo?uo.getAtTileOffsetFunc(ct,ke.center.lat,ke.worldSize,yt.getProjection()):null,Vo=ro(ei,At.tileID.canonical,Ne,Be,ke,yt.getProjection(),ti);$l(yt,ei,Q,ne,Vo,An,Ne,ve,wo,ct)}const ri=Se||ne&&et||_i,Vr=Q.translatePosMatrix(ei,At,ae,he),Ci=ri?lu:nn,cn=Q.translatePosMatrix(An,At,ae,he,!0),mi=yt.getProjection().createInversionMatrix(ke,ct.canonical),pn=[];Q.terrainRenderModeElevated()&&Ne&&pn.push("PITCH_WITH_MAP_TERRAIN"),or&&pn.push("PROJECTION_GLOBE_VIEW"),ri&&pn.push("PROJECTED_POS_ON_VIEWPORT");const Hs=St&&Y.paint.get(ne?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let jo;jo=St?yt.iconsInText?su(Ft.kind,Ut,De,Ne,Q,Vr,Ci,cn,lr,Lr,ct,Qr,tt,mi,Kr,yt.getProjection()):Cs(Ft.kind,Ut,De,Ne,Q,Vr,Ci,cn,ne,lr,!0,ct,Qr,tt,mi,Kr,yt.getProjection()):Gl(Ft.kind,Ut,De,Ne,Q,Vr,Ci,cn,ne,lr,ct,Qr,tt,mi,Kr,yt.getProjection());const ts={program:Q.useProgram(Kl(St,ne,yt),ft,pn),buffers:Bt,uniformValues:jo,atlasTexture:_r,atlasTextureIcon:Pr,atlasInterpolation:rr,atlasInterpolationIcon:fr,isSDF:St,hasHalo:Hs,tile:At,labelPlaneMatrixInv:Vi};if(Ve&&yt.canOverlap){Ge=!0;const uo=Bt.segments.get();for(const wo of uo)nt.push({segments:new H.SegmentVector([wo]),sortKey:wo.sortKey,state:ts})}else nt.push({segments:Bt.segments,sortKey:0,state:ts})}Ge&&nt.sort((ct,At)=>ct.sortKey-At.sortKey);for(const ct of nt){const At=ct.state;if(Q.terrain&&Q.terrain.setupElevationDraw(At.tile,At.program,{useDepthForOcclusion:!at,labelPlaneMatrixInv:At.labelPlaneMatrixInv}),Pe.activeTexture.set(Le.TEXTURE0),At.atlasTexture.bind(At.atlasInterpolation,Le.CLAMP_TO_EDGE),At.atlasTextureIcon&&(Pe.activeTexture.set(Le.TEXTURE1),At.atlasTextureIcon&&At.atlasTextureIcon.bind(At.atlasInterpolationIcon,Le.CLAMP_TO_EDGE)),At.isSDF){const yt=At.uniformValues;At.hasHalo&&(yt.u_is_halo=1,Wa(At.buffers,ct.segments,Y,Q,At.program,Qe,ge,Te,yt)),yt.u_is_halo=0}Wa(At.buffers,ct.segments,Y,Q,At.program,Qe,ge,Te,At.uniformValues)}}function Wa(Q,U,Y,te,ne,ae,he,fe,de){const ve=te.context,ge=[Q.dynamicLayoutVertexBuffer,Q.opacityVertexBuffer,Q.globeExtVertexBuffer];ne.draw(ve,ve.gl.TRIANGLES,ae,he,fe,H.CullFaceMode.disabled,de,Y.id,Q.layoutVertexBuffer,Q.indexBuffer,U,Y.paint,te.transform.zoom,Q.programConfigurations.get(Y.id),ge)}function uu(Q,U,Y,te,ne,ae,he){const fe=Q.context.gl,de=Y.paint.get("fill-pattern"),ve=de&&de.constantOr(1);let ge,Te,Pe,Le,ke;he?(Te=ve&&!Y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ge=fe.LINES):(Te=ve?"fillPattern":"fill",ge=fe.TRIANGLES);for(const Be of te){const Ne=U.getTile(Be);if(ve&&!Ne.patternsLoaded())continue;const Se=Ne.getBucket(Y);if(!Se)continue;Q.prepareDrawTile();const De=Se.programConfigurations.get(Y.id),Ve=Q.useProgram(Te,De);ve&&(Q.context.activeTexture.set(fe.TEXTURE0),Ne.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),De.updatePaintBuffers());const Ge=de.constantOr(null);if(Ge&&Ne.imageAtlas){const tt=Ne.imageAtlas.patternPositions[Ge.toString()];tt&&De.setConstantPatternPositions(tt)}const Qe=Q.translatePosMatrix(Be.projMatrix,Ne,Y.paint.get("fill-translate"),Y.paint.get("fill-translate-anchor"));if(he){Le=Se.indexBuffer2,ke=Se.segments2;const tt=Q.terrain&&Q.terrain.renderingToTexture?Q.terrain.drapeBufferSize:[fe.drawingBufferWidth,fe.drawingBufferHeight];Pe=Te==="fillOutlinePattern"&&ve?bh(Qe,Q,Ne,tt):xh(Qe,tt)}else Le=Se.indexBuffer,ke=Se.segments,Pe=ve?Nl(Qe,Q,Ne):No(Qe);Q.prepareDrawProgram(Q.context,Ve,Be.toUnwrapped()),Ve.draw(Q.context,ge,ne,Q.stencilModeForClipping(Be),ae,H.CullFaceMode.disabled,Pe,Y.id,Se.layoutVertexBuffer,Le,ke,Y.paint,Q.transform.zoom,De)}}function Rs(Q,U,Y,te,ne,ae,he){const fe=Q.context,de=fe.gl,ve=Q.transform,ge=Y.paint.get("fill-extrusion-pattern"),Te=ge.constantOr(1),Pe=Y.paint.get("fill-extrusion-opacity"),Le=[Y.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y.paint.get("fill-extrusion-ambient-occlusion-radius")],ke=Y.layout.get("fill-extrusion-edge-radius"),Be=ke>0&&!Y.paint.get("fill-extrusion-rounded-roof"),Ne=Be?0:ke,Se=ve.projection.name==="globe"?H.fillExtrusionHeightLift():0,De=ve.projection.name==="globe",Ve=De?H.globeToMercatorTransition(ve.zoom):0,Ge=[H.mercatorXfromLng(ve.center.lng),H.mercatorYfromLat(ve.center.lat)],Qe=[];De&&Qe.push("PROJECTION_GLOBE_VIEW"),Le[0]>0&&Qe.push("FAUX_AO"),Be&&Qe.push("ZERO_ROOF_RADIUS");for(const tt of te){const et=U.getTile(tt),at=et.getBucket(Y);if(!at||at.projection.name!==ve.projection.name)continue;const nt=at.programConfigurations.get(Y.id),pt=Q.useProgram(Te?"fillExtrusionPattern":"fillExtrusion",nt,Qe);if(Q.terrain){const St=Q.terrain;if(Q.style.terrainSetForDrapingOnly())St.setupElevationDraw(et,pt,{useMeterToDem:!0});else{if(!at.enableTerrain)continue;if(St.setupElevationDraw(et,pt,{useMeterToDem:!0}),hu(fe,U,tt,at,Y,St),!at.centroidVertexBuffer){const Ft=pt.attributes.a_centroid_pos;Ft!==void 0&&de.vertexAttrib2f(Ft,0,0)}}}Te&&(Q.context.activeTexture.set(de.TEXTURE0),et.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),nt.updatePaintBuffers());const kt=ge.constantOr(null);if(kt&&et.imageAtlas){const St=et.imageAtlas.patternPositions[kt.toString()];St&&nt.setConstantPatternPositions(St)}const ct=Q.translatePosMatrix(tt.projMatrix,et,Y.paint.get("fill-extrusion-translate"),Y.paint.get("fill-extrusion-translate-anchor")),At=ve.projection.createInversionMatrix(ve,tt.canonical),yt=Y.paint.get("fill-extrusion-vertical-gradient"),Bt=Te?nu(ct,Q,yt,Pe,Le,Ne,tt,et,Se,Ve,Ge,At):kl(ct,Q,yt,Pe,Le,Ne,tt,Se,Ve,Ge,At);Q.prepareDrawProgram(fe,pt,tt.toUnwrapped());const ft=[];Q.terrain&&ft.push(at.centroidVertexBuffer),De&&ft.push(at.layoutVertexExtBuffer),pt.draw(fe,fe.gl.TRIANGLES,ne,ae,he,H.CullFaceMode.backCCW,Bt,Y.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,Y.paint,Q.transform.zoom,nt,ft)}}function hu(Q,U,Y,te,ne,ae){const he=[Se=>{let De=Se.canonical.x-1,Ve=Se.wrap;return De<0&&(De=(1<<Se.canonical.z)-1,Ve--),new H.OverscaledTileID(Se.overscaledZ,Ve,Se.canonical.z,De,Se.canonical.y)},Se=>{let De=Se.canonical.x+1,Ve=Se.wrap;return De===1<<Se.canonical.z&&(De=0,Ve++),new H.OverscaledTileID(Se.overscaledZ,Ve,Se.canonical.z,De,Se.canonical.y)},Se=>new H.OverscaledTileID(Se.overscaledZ,Se.wrap,Se.canonical.z,Se.canonical.x,(Se.canonical.y===0?1<<Se.canonical.z:Se.canonical.y)-1),Se=>new H.OverscaledTileID(Se.overscaledZ,Se.wrap,Se.canonical.z,Se.canonical.x,Se.canonical.y===(1<<Se.canonical.z)-1?0:Se.canonical.y+1)],fe=Se=>{const De=U.getSource().minzoom,Ve=Qe=>{const tt=U.getTileByID(Qe);if(tt&&tt.hasData())return tt.getBucket(ne)},Ge=[0,-1,1];for(const Qe of Ge){if(Se.overscaledZ+Qe<De)continue;const tt=Ve(Se.calculateScaledKey(Se.overscaledZ+Qe));if(tt)return tt}},de=[0,0,0],ve=(Se,De)=>(de[0]=Math.min(Se.min.y,De.min.y),de[1]=Math.max(Se.max.y,De.max.y),de[2]=H.EXTENT-De.min.x>Se.max.x?De.min.x-H.EXTENT:Se.max.x,de),ge=(Se,De)=>(de[0]=Math.min(Se.min.x,De.min.x),de[1]=Math.max(Se.max.x,De.max.x),de[2]=H.EXTENT-De.min.y>Se.max.y?De.min.y-H.EXTENT:Se.max.y,de),Te=[(Se,De)=>ve(Se,De),(Se,De)=>ve(De,Se),(Se,De)=>ge(Se,De),(Se,De)=>ge(De,Se)],Pe=new H.Point(0,0);let Le,ke,Be;const Ne=(Se,De,Ve,Ge,Qe)=>{const tt=[[Ge?Ve:Se,Ge?Se:Ve,0],[Ge?Ve:De,Ge?De:Ve,0]],et=Qe<0?H.EXTENT+Qe:Qe,at=[Ge?et:(Se+De)/2,Ge?(Se+De)/2:et,0];return Ve===0&&Qe<0||Ve!==0&&Qe>0?ae.getForTilePoints(Be,[at],!0,ke):tt.push(at),ae.getForTilePoints(Y,tt,!0,Le),Math.max(tt[0][2],tt[1][2],at[2])/ae.exaggeration()};for(let Se=0;Se<4;Se++){const De=(Se<2?1:5)-Se,Ve=te.borders[Se];if(Ve.length===0)continue;const Ge=Be=he[Se](Y),Qe=fe(Ge);if(!(Qe&&Qe instanceof H.FillExtrusionBucket&&Qe.enableTerrain)||te.borderDoneWithNeighborZ[Se]===Qe.canonical.z&&Qe.borderDoneWithNeighborZ[De]===te.canonical.z||(ke=ae.findDEMTileFor(Ge),!ke||!ke.dem))continue;if(!Le){const nt=ae.findDEMTileFor(Y);if(!nt||!nt.dem)return;Le=nt}const tt=Qe.borders[De];let et=0;const at=Qe.borderDoneWithNeighborZ[De]!==te.canonical.z;if(te.canonical.z===Qe.canonical.z){for(let nt=0;nt<Ve.length;nt++){const pt=te.featuresOnBorder[Ve[nt]],kt=pt.borders[Se];let ct;for(;et<tt.length&&(ct=Qe.featuresOnBorder[tt[et]],!(ct.borders[De][1]>kt[0]+3));)at&&Qe.encodeCentroid(void 0,ct,!1),et++;if(ct&&et<tt.length){const At=et;let yt=0;for(;!(ct.borders[De][0]>kt[1]-3)&&(yt++,++et!==tt.length);)ct=Qe.featuresOnBorder[tt[et]];if(ct=Qe.featuresOnBorder[tt[At]],pt.intersectsCount()>1||ct.intersectsCount()>1||yt!==1){yt!==1&&(et=At),te.encodeCentroid(void 0,pt,!1),at&&Qe.encodeCentroid(void 0,ct,!1);continue}const Bt=Te[Se](pt,ct),ft=Se%2?H.EXTENT-1:0;Pe.x=Ne(Bt[0],Math.min(H.EXTENT-1,Bt[1]),ft,Se<2,Bt[2]),Pe.y=0,te.encodeCentroid(Pe,pt,!1),at&&Qe.encodeCentroid(Pe,ct,!1)}else te.encodeCentroid(void 0,pt,!1)}te.borderDoneWithNeighborZ[Se]=Qe.canonical.z,te.needsCentroidUpdate=!0,at&&(Qe.borderDoneWithNeighborZ[De]=te.canonical.z,Qe.needsCentroidUpdate=!0)}else{for(const nt of Ve)te.encodeCentroid(void 0,te.featuresOnBorder[nt],!1);if(at){for(const nt of tt)Qe.encodeCentroid(void 0,Qe.featuresOnBorder[nt],!1);Qe.borderDoneWithNeighborZ[De]=te.canonical.z,Qe.needsCentroidUpdate=!0}te.borderDoneWithNeighborZ[Se]=Qe.canonical.z,te.needsCentroidUpdate=!0}}(te.needsCentroidUpdate||!te.centroidVertexBuffer&&te.centroidVertexArray.length!==0)&&te.uploadCentroid(Q)}const la=new H.Color(1,0,0,1),Ih=new H.Color(0,1,0,1),Ah=new H.Color(0,0,1,1),Oh=new H.Color(1,0,1,1),Ch=new H.Color(0,1,1,1);function Ph(Q,U,Y){const te=Q.context,ne=Q.transform,ae=te.gl,he=ne.projection.name==="globe",fe=he?["PROJECTION_GLOBE_VIEW"]:null;let de=Y.projMatrix;if(he&&H.globeToMercatorTransition(ne.zoom)>0){const pt=H.transitionTileAABBinECEF(Y.canonical,ne),kt=H.globeDenormalizeECEF(pt);de=H.multiply(new Float32Array(16),ne.globeMatrix,kt),H.multiply(de,ne.projMatrix,de)}const ve=Q.useProgram("debug",null,fe),ge=U.getTileByID(Y.key);Q.terrain&&Q.terrain.setupElevationDraw(ge,ve);const Te=H.DepthMode.disabled,Pe=H.StencilMode.disabled,Le=Q.colorModeForRenderPass(),ke="$debug";te.activeTexture.set(ae.TEXTURE0),Q.emptyTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),he?ge._makeGlobeTileDebugBuffers(Q.context,ne):ge._makeDebugTileBoundsBuffers(Q.context,ne.projection);const Be=ge._tileDebugBuffer||Q.debugBuffer,Ne=ge._tileDebugIndexBuffer||Q.debugIndexBuffer,Se=ge._tileDebugSegments||Q.debugSegments;ve.draw(te,ae.LINE_STRIP,Te,Pe,Le,H.CullFaceMode.disabled,As(de,H.Color.red),ke,Be,Ne,Se,null,null,null,[ge._globeTileDebugBorderBuffer]);const De=ge.latestRawTileData,Ve=Math.floor((De&&De.byteLength||0)/1024),Ge=U.getTile(Y).tileSize,Qe=512/Math.min(Ge,512)*(Y.overscaledZ/ne.zoom)*.5;let tt=Y.canonical.toString();Y.overscaledZ!==Y.canonical.z&&(tt+=` => ${Y.overscaledZ}`),tt+=` ${Ve}kb`,function(pt,kt){pt.initDebugOverlayCanvas();const ct=pt.debugOverlayCanvas,At=pt.context.gl,yt=pt.debugOverlayCanvas.getContext("2d");yt.clearRect(0,0,ct.width,ct.height),yt.shadowColor="white",yt.shadowBlur=2,yt.lineWidth=1.5,yt.strokeStyle="white",yt.textBaseline="top",yt.font="bold 36px Open Sans, sans-serif",yt.fillText(kt,5,5),yt.strokeText(kt,5,5),pt.debugOverlayTexture.update(ct),pt.debugOverlayTexture.bind(At.LINEAR,At.CLAMP_TO_EDGE)}(Q,tt);const et=ge._tileDebugTextBuffer||Q.debugBuffer,at=ge._tileDebugTextIndexBuffer||Q.quadTriangleIndexBuffer,nt=ge._tileDebugTextSegments||Q.debugSegments;ve.draw(te,ae.TRIANGLES,Te,Pe,H.ColorMode.alphaBlended,H.CullFaceMode.disabled,As(de,H.Color.transparent,Qe),ke,et,at,nt,null,null,null,[ge._globeTileDebugTextBuffer])}function fu(Q,U,Y,te){ca(Q,0,U+Y/2,Q.transform.width,Y,te)}function Ms(Q,U,Y,te){ca(Q,U-Y/2,0,Y,Q.transform.height,te)}function ca(Q,U,Y,te,ne,ae){const he=Q.context,fe=he.gl;fe.enable(fe.SCISSOR_TEST),fe.scissor(U*H.exported.devicePixelRatio,Y*H.exported.devicePixelRatio,te*H.exported.devicePixelRatio,ne*H.exported.devicePixelRatio),he.clear({color:ae}),fe.disable(fe.SCISSOR_TEST)}const pu=H.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:du}=pu;function lo(Q,U,Y,te){Q.emplaceBack(U,Y,te)}class Ds{constructor(U){this.vertexArray=new H.StructArrayLayout3f12,this.indices=new H.StructArrayLayout3ui6,lo(this.vertexArray,-1,-1,1),lo(this.vertexArray,1,-1,1),lo(this.vertexArray,-1,1,1),lo(this.vertexArray,1,1,1),lo(this.vertexArray,-1,-1,-1),lo(this.vertexArray,1,-1,-1),lo(this.vertexArray,-1,1,-1),lo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=U.createVertexBuffer(this.vertexArray,du),this.indexBuffer=U.createIndexBuffer(this.indices),this.segment=H.SegmentVector.simpleSegment(0,0,36,12)}}function Sn(Q,U,Y,te,ne,ae){const he=Q.gl,fe=U.paint.get("sky-atmosphere-color"),de=U.paint.get("sky-atmosphere-halo-color"),ve=U.paint.get("sky-atmosphere-sun-intensity"),ge=((Te,Pe,Le,ke,Be)=>({u_matrix_3f:Te,u_sun_direction:Pe,u_sun_intensity:Le,u_color_tint_r:[ke.r,ke.g,ke.b,ke.a],u_color_tint_m:[Be.r,Be.g,Be.b,Be.a],u_luminance:5e-5}))(H.fromMat4(H.create$1(),te),ne,ve,fe,de);he.framebufferTexture2D(he.FRAMEBUFFER,he.COLOR_ATTACHMENT0,he.TEXTURE_CUBE_MAP_POSITIVE_X+ae,U.skyboxTexture,0),Y.draw(Q,he.TRIANGLES,H.DepthMode.disabled,H.StencilMode.disabled,H.ColorMode.unblended,H.CullFaceMode.frontCW,ge,"skyboxCapture",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}const qa=H.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class mu{constructor(U){const Y=new H.StructArrayLayout5f20;Y.emplaceBack(-1,1,1,0,0),Y.emplaceBack(1,1,1,1,0),Y.emplaceBack(1,-1,1,1,1),Y.emplaceBack(-1,-1,1,0,1);const te=new H.StructArrayLayout3ui6;te.emplaceBack(0,1,2),te.emplaceBack(2,3,0),this.vertexBuffer=U.createVertexBuffer(Y,qa.members),this.indexBuffer=U.createIndexBuffer(te),this.segments=H.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Fo={symbol:function(Q,U,Y,te,ne){if(Q.renderPass!=="translucent")return;const ae=H.StencilMode.disabled,he=Q.colorModeForRenderPass();Y.layout.get("text-variable-anchor")&&function(fe,de,ve,ge,Te,Pe,Le){const ke=de.transform,Be=Te==="map",Ne=Pe==="map";for(const Se of fe){const De=ge.getTile(Se),Ve=De.getBucket(ve);if(!Ve||!Ve.text||!Ve.text.segments.get().length)continue;const Ge=H.evaluateSizeForZoom(Ve.textSizeData,ke.zoom),Qe=yi(Se,Ve.getProjection(),ke),tt=ke.calculatePixelsToTileUnitsMatrix(De),et=Et(Qe,De.tileID.canonical,Ne,Be,ke,Ve.getProjection(),tt),at=ve.layout.get("icon-text-fit")!=="none"&&Ve.hasIconData();if(Ge){const nt=Math.pow(2,ke.zoom-De.tileID.overscaledZ);Sh(Ve,Be,Ne,Le,H.symbolSize,ke,et,Se,nt,Ge,at)}}}(te,Q,Y,U,Y.layout.get("text-rotation-alignment"),Y.layout.get("text-pitch-alignment"),ne),Y.paint.get("icon-opacity").constantOr(1)!==0&&cu(Q,U,Y,te,!1,Y.paint.get("icon-translate"),Y.paint.get("icon-translate-anchor"),Y.layout.get("icon-rotation-alignment"),Y.layout.get("icon-pitch-alignment"),Y.layout.get("icon-keep-upright"),ae,he),Y.paint.get("text-opacity").constantOr(1)!==0&&cu(Q,U,Y,te,!0,Y.paint.get("text-translate"),Y.paint.get("text-translate-anchor"),Y.layout.get("text-rotation-alignment"),Y.layout.get("text-pitch-alignment"),Y.layout.get("text-keep-upright"),ae,he),U.map.showCollisionBoxes&&(Ga(Q,U,Y,te,Y.paint.get("text-translate"),Y.paint.get("text-translate-anchor"),!0),Ga(Q,U,Y,te,Y.paint.get("icon-translate"),Y.paint.get("icon-translate-anchor"),!1))},circle:function(Q,U,Y,te){if(Q.renderPass!=="translucent")return;const ne=Y.paint.get("circle-opacity"),ae=Y.paint.get("circle-stroke-width"),he=Y.paint.get("circle-stroke-opacity"),fe=Y.layout.get("circle-sort-key").constantOr(1)!==void 0;if(ne.constantOr(1)===0&&(ae.constantOr(1)===0||he.constantOr(1)===0))return;const de=Q.context,ve=de.gl,ge=Q.transform,Te=Q.depthModeForSublayer(0,H.DepthMode.ReadOnly),Pe=H.StencilMode.disabled,Le=Q.colorModeForRenderPass(),ke=ge.projection.name==="globe",Be=[H.mercatorXfromLng(ge.center.lng),H.mercatorYfromLat(ge.center.lat)],Ne=[];for(let De=0;De<te.length;De++){const Ve=te[De],Ge=U.getTile(Ve),Qe=Ge.getBucket(Y);if(!Qe||Qe.projection.name!==ge.projection.name)continue;const tt=Qe.programConfigurations.get(Y.id),et=zl(Y);ke&&et.push("PROJECTION_GLOBE_VIEW");const at=Q.useProgram("circle",tt,et),nt=Qe.layoutVertexBuffer,pt=Qe.globeExtVertexBuffer,kt=Qe.indexBuffer,ct=ge.projection.createInversionMatrix(ge,Ve.canonical),At={programConfiguration:tt,program:at,layoutVertexBuffer:nt,globeExtVertexBuffer:pt,indexBuffer:kt,uniformValues:Fl(Q,Ve,Ge,ct,Be,Y),tile:Ge};if(fe){const yt=Qe.segments.get();for(const Bt of yt)Ne.push({segments:new H.SegmentVector([Bt]),sortKey:Bt.sortKey,state:At})}else Ne.push({segments:Qe.segments,sortKey:0,state:At})}fe&&Ne.sort((De,Ve)=>De.sortKey-Ve.sortKey);const Se={useDepthForOcclusion:!ke};for(const De of Ne){const{programConfiguration:Ve,program:Ge,layoutVertexBuffer:Qe,globeExtVertexBuffer:tt,indexBuffer:et,uniformValues:at,tile:nt}=De.state,pt=De.segments;Q.terrain&&Q.terrain.setupElevationDraw(nt,Ge,Se),Q.prepareDrawProgram(de,Ge,nt.tileID.toUnwrapped()),Ge.draw(de,ve.TRIANGLES,Te,Pe,Le,H.CullFaceMode.disabled,at,Y.id,Qe,et,pt,Y.paint,ge.zoom,Ve,[tt])}},heatmap:function(Q,U,Y,te){if(Y.paint.get("heatmap-opacity")!==0)if(Q.renderPass==="offscreen"){const ne=Q.context,ae=ne.gl,he=H.StencilMode.disabled,fe=new H.ColorMode([ae.ONE,ae.ONE],H.Color.transparent,[!0,!0,!0,!0]);(function(Le,ke,Be,Ne){const Se=Le.gl,De=ke.width*Ne,Ve=ke.height*Ne;Le.activeTexture.set(Se.TEXTURE1),Le.viewport.set([0,0,De,Ve]);let Ge=Be.heatmapFbo;if(!Ge||Ge&&(Ge.width!==De||Ge.height!==Ve)){Ge&&Ge.destroy();const Qe=Se.createTexture();Se.bindTexture(Se.TEXTURE_2D,Qe),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_WRAP_S,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_WRAP_T,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_MIN_FILTER,Se.LINEAR),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_MAG_FILTER,Se.LINEAR),Ge=Be.heatmapFbo=Le.createFramebuffer(De,Ve,!1),function(tt,et,at,nt,pt,kt){const ct=tt.gl;ct.texImage2D(ct.TEXTURE_2D,0,tt.isWebGL2&&tt.extRenderToTextureHalfFloat?ct.RGBA16F:ct.RGBA,pt,kt,0,ct.RGBA,tt.extRenderToTextureHalfFloat?tt.isWebGL2?ct.HALF_FLOAT:tt.extTextureHalfFloat.HALF_FLOAT_OES:ct.UNSIGNED_BYTE,null),nt.colorAttachment.set(at)}(Le,0,Qe,Ge,De,Ve)}else Se.bindTexture(Se.TEXTURE_2D,Ge.colorAttachment.get()),Le.bindFramebuffer.set(Ge.framebuffer)})(ne,Q,Y,Q.transform.projection.name==="globe"?.5:.25),ne.clear({color:H.Color.transparent});const de=Q.transform,ve=de.projection.name==="globe",ge=ve?["PROJECTION_GLOBE_VIEW"]:null,Te=ve?H.CullFaceMode.frontCCW:H.CullFaceMode.disabled,Pe=[H.mercatorXfromLng(de.center.lng),H.mercatorYfromLat(de.center.lat)];for(let Le=0;Le<te.length;Le++){const ke=te[Le];if(U.hasRenderableParent(ke))continue;const Be=U.getTile(ke),Ne=Be.getBucket(Y);if(!Ne||Ne.projection.name!==de.projection.name)continue;const Se=Ne.programConfigurations.get(Y.id),De=Q.useProgram("heatmap",Se,ge),{zoom:Ve}=Q.transform;Q.terrain&&Q.terrain.setupElevationDraw(Be,De),Q.prepareDrawProgram(ne,De,ke.toUnwrapped());const Ge=de.projection.createInversionMatrix(de,ke.canonical);De.draw(ne,ae.TRIANGLES,H.DepthMode.disabled,he,fe,Te,au(Q,ke,Be,Ge,Pe,Ve,Y.paint.get("heatmap-intensity")),Y.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,Y.paint,Q.transform.zoom,Se,ve?[Ne.globeExtVertexBuffer]:null)}ne.viewport.set([0,0,Q.width,Q.height])}else Q.renderPass==="translucent"&&(Q.context.setColorMode(Q.colorModeForRenderPass()),function(ne,ae){const he=ne.context,fe=he.gl,de=ae.heatmapFbo;if(!de)return;he.activeTexture.set(fe.TEXTURE0),fe.bindTexture(fe.TEXTURE_2D,de.colorAttachment.get()),he.activeTexture.set(fe.TEXTURE1);let ve=ae.colorRampTexture;ve||(ve=ae.colorRampTexture=new H.Texture(he,ae.colorRamp,fe.RGBA)),ve.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),ne.useProgram("heatmapTexture").draw(he,fe.TRIANGLES,H.DepthMode.disabled,H.StencilMode.disabled,ne.colorModeForRenderPass(),H.CullFaceMode.disabled,((ge,Te,Pe,Le)=>({u_image:0,u_color_ramp:1,u_opacity:Te.paint.get("heatmap-opacity")}))(0,ae),ae.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments,ae.paint,ne.transform.zoom)}(Q,Y))},line:function(Q,U,Y,te){if(Q.renderPass!=="translucent")return;const ne=Y.paint.get("line-opacity"),ae=Y.paint.get("line-width");if(ne.constantOr(1)===0||ae.constantOr(1)===0)return;const he=Q.depthModeForSublayer(0,H.DepthMode.ReadOnly),fe=Q.colorModeForRenderPass(),de=Q.terrain&&Q.terrain.renderingToTexture?1:H.exported.devicePixelRatio,ve=Y.paint.get("line-dasharray"),ge=ve.constantOr(1),Te=Y.layout.get("line-cap"),Pe=Y.paint.get("line-pattern"),Le=Pe.constantOr(1),ke=Y.paint.get("line-gradient"),Be=Le?"linePattern":"line",Ne=Q.context,Se=Ne.gl,De=(Ge=>{const Qe=[];Va(Ge)&&Qe.push("RENDER_LINE_DASH"),Ge.paint.get("line-gradient")&&Qe.push("RENDER_LINE_GRADIENT");const tt=Ge.paint.get("line-trim-offset");tt[0]===0&&tt[1]===0||Qe.push("RENDER_LINE_TRIM_OFFSET");const et=Ge.paint.get("line-pattern").constantOr(1),at=Ge.paint.get("line-opacity").constantOr(1)!==1;return!et&&at&&Qe.push("RENDER_LINE_ALPHA_DISCARD"),Qe})(Y);let Ve=De.includes("RENDER_LINE_ALPHA_DISCARD");Q.terrain&&Q.terrain.clipOrMaskOverlapStencilType()&&(Ve=!1);for(const Ge of te){const Qe=U.getTile(Ge);if(Le&&!Qe.patternsLoaded())continue;const tt=Qe.getBucket(Y);if(!tt)continue;Q.prepareDrawTile();const et=tt.programConfigurations.get(Y.id),at=Q.useProgram(Be,et,De),nt=Pe.constantOr(null);if(nt&&Qe.imageAtlas){const St=Qe.imageAtlas.patternPositions[nt.toString()];St&&et.setConstantPatternPositions(St)}const pt=ve.constantOr(null),kt=Te.constantOr(null);if(!Le&&pt&&kt&&Qe.lineAtlas){const St=Qe.lineAtlas.getDash(pt,kt);St&&et.setConstantPatternPositions(St)}let[ct,At]=Y.paint.get("line-trim-offset");(kt==="round"||kt==="square")&&ct!==At&&(ct===0&&(ct-=1),At===1&&(At+=1));const yt=Q.terrain?Ge.projMatrix:null,Bt=Le?ja(Q,Qe,Y,yt,de):Eh(Q,Qe,Y,yt,tt.lineClipsArray.length,de,[ct,At]);if(ke){const St=tt.gradients[Y.id];let Ft=St.texture;if(Y.gradientVersion!==St.version){let Mt=256;if(Y.stepInterpolant){const Ut=U.getSource().maxzoom,lr=Ge.canonical.z===Ut?Math.ceil(1<<Q.transform.maxZoom-Ge.canonical.z):1;Mt=H.clamp(H.nextPowerOfTwo(tt.maxLineLength/H.EXTENT*1024*lr),256,Ne.maxTextureSize)}St.gradient=H.renderColorRamp({expression:Y.gradientExpression(),evaluationKey:"lineProgress",resolution:Mt,image:St.gradient||void 0,clips:tt.lineClipsArray}),St.texture?St.texture.update(St.gradient):St.texture=new H.Texture(Ne,St.gradient,Se.RGBA),St.version=Y.gradientVersion,Ft=St.texture}Ne.activeTexture.set(Se.TEXTURE1),Ft.bind(Y.stepInterpolant?Se.NEAREST:Se.LINEAR,Se.CLAMP_TO_EDGE)}ge&&(Ne.activeTexture.set(Se.TEXTURE0),Qe.lineAtlasTexture.bind(Se.LINEAR,Se.REPEAT),et.updatePaintBuffers()),Le&&(Ne.activeTexture.set(Se.TEXTURE0),Qe.imageAtlasTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),et.updatePaintBuffers()),Q.prepareDrawProgram(Ne,at,Ge.toUnwrapped());const ft=St=>{at.draw(Ne,Se.TRIANGLES,he,St,fe,H.CullFaceMode.disabled,Bt,Y.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,Y.paint,Q.transform.zoom,et,[tt.layoutVertexBuffer2])};if(Ve){const St=Q.stencilModeForClipping(Ge).ref;St===0&&Q.terrain&&Ne.clear({stencil:0});const Ft={func:Se.EQUAL,mask:255};Bt.u_alpha_discard_threshold=.8,ft(new H.StencilMode(Ft,St,255,Se.KEEP,Se.KEEP,Se.INVERT)),Bt.u_alpha_discard_threshold=0,ft(new H.StencilMode(Ft,St,255,Se.KEEP,Se.KEEP,Se.KEEP))}else ft(Q.stencilModeForClipping(Ge))}Ve&&(Q.resetStencilClippingMasks(),Q.terrain&&Ne.clear({stencil:0}))},fill:function(Q,U,Y,te){const ne=Y.paint.get("fill-color"),ae=Y.paint.get("fill-opacity");if(ae.constantOr(1)===0)return;const he=Q.colorModeForRenderPass(),fe=Y.paint.get("fill-pattern"),de=Q.opaquePassEnabledForLayer()&&!fe.constantOr(1)&&ne.constantOr(H.Color.transparent).a===1&&ae.constantOr(0)===1?"opaque":"translucent";if(Q.renderPass===de){const ve=Q.depthModeForSublayer(1,Q.renderPass==="opaque"?H.DepthMode.ReadWrite:H.DepthMode.ReadOnly);uu(Q,U,Y,te,ve,he,!1)}if(Q.renderPass==="translucent"&&Y.paint.get("fill-antialias")){const ve=Q.depthModeForSublayer(Y.getPaintProperty("fill-outline-color")?2:0,H.DepthMode.ReadOnly);uu(Q,U,Y,te,ve,he,!0)}},"fill-extrusion":function(Q,U,Y,te){const ne=Y.paint.get("fill-extrusion-opacity");if(ne!==0&&Q.renderPass==="translucent"){const ae=new H.DepthMode(Q.context.gl.LEQUAL,H.DepthMode.ReadWrite,Q.depthRangeFor3D);if(ne!==1||Y.paint.get("fill-extrusion-pattern").constantOr(1))Rs(Q,U,Y,te,ae,H.StencilMode.disabled,H.ColorMode.disabled),Rs(Q,U,Y,te,ae,Q.stencilModeFor3D(),Q.colorModeForRenderPass()),Q.resetStencilClippingMasks();else{const he=Q.colorModeForRenderPass();Rs(Q,U,Y,te,ae,H.StencilMode.disabled,he)}}},hillshade:function(Q,U,Y,te){if(Q.renderPass!=="offscreen"&&Q.renderPass!=="translucent")return;const ne=Q.context,ae=Q.depthModeForSublayer(0,H.DepthMode.ReadOnly),he=Q.colorModeForRenderPass(),fe=Q.terrain&&Q.terrain.renderingToTexture,[de,ve]=Q.renderPass!=="translucent"||fe?[{},te]:Q.stencilConfigForOverlap(te);for(const ge of ve){const Te=U.getTile(ge);if(Te.needsHillshadePrepare&&Q.renderPass==="offscreen")tu(Q,Te,Y,ae,H.StencilMode.disabled,he);else if(Q.renderPass==="translucent"){const Pe=fe&&Q.terrain?Q.terrain.stencilModeForRTTOverlap(ge):de[ge.overscaledZ];eu(Q,ge,Te,Y,ae,Pe,he)}}ne.viewport.set([0,0,Q.width,Q.height]),Q.resetStencilClippingMasks()},raster:function(Q,U,Y,te,ne,ae){if(Q.renderPass!=="translucent"||Y.paint.get("raster-opacity")===0||!te.length)return;const he=Q.context,fe=he.gl,de=U.getSource(),ve=Q.useProgram("raster"),ge=Q.colorModeForRenderPass(),Te=Q.terrain&&Q.terrain.renderingToTexture,[Pe,Le]=de instanceof Or||Te?[{},te]:Q.stencilConfigForOverlap(te),ke=Le[Le.length-1].overscaledZ,Be=!Q.options.moving;for(const Ne of Le){const Se=Te?H.DepthMode.disabled:Q.depthModeForSublayer(Ne.overscaledZ-ke,Y.paint.get("raster-opacity")===1?H.DepthMode.ReadWrite:H.DepthMode.ReadOnly,fe.LESS),De=Ne.toUnwrapped(),Ve=U.getTile(Ne);if(Te&&(!Ve||!Ve.hasData()))continue;const Ge=Te?Ne.projMatrix:Q.transform.calculateProjMatrix(De,Be),Qe=Q.terrain&&Te?Q.terrain.stencilModeForRTTOverlap(Ne):Pe[Ne.overscaledZ],tt=ae?0:Y.paint.get("raster-fade-duration");Ve.registerFadeDuration(tt);const et=U.findLoadedParent(Ne,0),at=Dl(Ve,et,U,Q.transform,tt);let nt,pt;Q.terrain&&Q.terrain.prepareDrawTile();const kt=Y.paint.get("raster-resampling")==="nearest"?fe.NEAREST:fe.LINEAR;he.activeTexture.set(fe.TEXTURE0),Ve.texture.bind(kt,fe.CLAMP_TO_EDGE),he.activeTexture.set(fe.TEXTURE1),et?(et.texture.bind(kt,fe.CLAMP_TO_EDGE),nt=Math.pow(2,et.tileID.overscaledZ-Ve.tileID.overscaledZ),pt=[Ve.tileID.canonical.x*nt%1,Ve.tileID.canonical.y*nt%1]):Ve.texture.bind(kt,fe.CLAMP_TO_EDGE),Ve.texture.useMipmap&&he.extTextureFilterAnisotropic&&Q.transform.pitch>20&&fe.texParameterf(fe.TEXTURE_2D,he.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,he.extTextureFilterAnisotropicMax);const ct=Vl(Ge,pt||[0,0],nt||1,at,Y,de instanceof Or?de.perspectiveTransform:[0,0]);if(Q.prepareDrawProgram(he,ve,De),de instanceof Or)de.boundsBuffer&&de.boundsSegments&&ve.draw(he,fe.TRIANGLES,Se,H.StencilMode.disabled,ge,H.CullFaceMode.disabled,ct,Y.id,de.boundsBuffer,Q.quadTriangleIndexBuffer,de.boundsSegments);else{const{tileBoundsBuffer:At,tileBoundsIndexBuffer:yt,tileBoundsSegments:Bt}=Q.getTileBoundsBuffers(Ve);ve.draw(he,fe.TRIANGLES,Se,Qe,ge,H.CullFaceMode.disabled,ct,Y.id,At,yt,Bt)}}Q.resetStencilClippingMasks()},background:function(Q,U,Y,te){const ne=Y.paint.get("background-color"),ae=Y.paint.get("background-opacity");if(ae===0)return;const he=Q.context,fe=he.gl,de=Q.transform,ve=de.tileSize,ge=Y.paint.get("background-pattern");if(Q.isPatternMissing(ge))return;const Te=!ge&&ne.a===1&&ae===1&&Q.opaquePassEnabledForLayer()?"opaque":"translucent";if(Q.renderPass!==Te)return;const Pe=H.StencilMode.disabled,Le=Q.depthModeForSublayer(0,Te==="opaque"?H.DepthMode.ReadWrite:H.DepthMode.ReadOnly),ke=Q.colorModeForRenderPass(),Be=Q.useProgram(ge?"backgroundPattern":"background");let Ne,Se=te;Se||(Ne=Q.getBackgroundTiles(),Se=Object.values(Ne).map(De=>De.tileID)),ge&&(he.activeTexture.set(fe.TEXTURE0),Q.imageManager.bind(Q.context));for(const De of Se){const Ve=De.toUnwrapped(),Ge=te?De.projMatrix:Q.transform.calculateProjMatrix(Ve);Q.prepareDrawTile();const Qe=U?U.getTile(De):Ne?Ne[De.key]:new H.Tile(De,ve,de.zoom,Q),tt=ge?Th(Ge,ae,Q,ge,{tileID:De,tileSize:ve}):Wl(Ge,ae,ne);Q.prepareDrawProgram(he,Be,Ve);const{tileBoundsBuffer:et,tileBoundsIndexBuffer:at,tileBoundsSegments:nt}=Q.getTileBoundsBuffers(Qe);Be.draw(he,fe.TRIANGLES,Le,Pe,ke,H.CullFaceMode.disabled,tt,Y.id,et,at,nt)}},sky:function(Q,U,Y){const te=Q.transform,ne=te.projection.name==="mercator"||te.projection.name==="globe"?1:H.smoothstep(7,8,te.zoom),ae=Y.paint.get("sky-opacity")*ne;if(ae===0)return;const he=Q.context,fe=Y.paint.get("sky-type"),de=new H.DepthMode(he.gl.LEQUAL,H.DepthMode.ReadOnly,[0,1]),ve=Q.frameCounter/1e3%1;fe==="atmosphere"?Q.renderPass==="offscreen"?Y.needsSkyboxCapture(Q)&&(function(ge,Te,Pe,Le){const ke=ge.context,Be=ke.gl;let Ne=Te.skyboxFbo;if(!Ne){Ne=Te.skyboxFbo=ke.createFramebuffer(32,32,!1),Te.skyboxGeometry=new Ds(ke),Te.skyboxTexture=ke.gl.createTexture(),Be.bindTexture(Be.TEXTURE_CUBE_MAP,Te.skyboxTexture),Be.texParameteri(Be.TEXTURE_CUBE_MAP,Be.TEXTURE_WRAP_S,Be.CLAMP_TO_EDGE),Be.texParameteri(Be.TEXTURE_CUBE_MAP,Be.TEXTURE_WRAP_T,Be.CLAMP_TO_EDGE),Be.texParameteri(Be.TEXTURE_CUBE_MAP,Be.TEXTURE_MIN_FILTER,Be.LINEAR),Be.texParameteri(Be.TEXTURE_CUBE_MAP,Be.TEXTURE_MAG_FILTER,Be.LINEAR);for(let Ge=0;Ge<6;++Ge)Be.texImage2D(Be.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,0,Be.RGBA,32,32,0,Be.RGBA,Be.UNSIGNED_BYTE,null)}ke.bindFramebuffer.set(Ne.framebuffer),ke.viewport.set([0,0,32,32]);const Se=Te.getCenter(ge,!0),De=ge.useProgram("skyboxCapture"),Ve=new Float64Array(16);H.identity(Ve),H.rotateY(Ve,Ve,.5*-Math.PI),Sn(ke,Te,De,Ve,Se,0),H.identity(Ve),H.rotateY(Ve,Ve,.5*Math.PI),Sn(ke,Te,De,Ve,Se,1),H.identity(Ve),H.rotateX(Ve,Ve,.5*-Math.PI),Sn(ke,Te,De,Ve,Se,2),H.identity(Ve),H.rotateX(Ve,Ve,.5*Math.PI),Sn(ke,Te,De,Ve,Se,3),H.identity(Ve),Sn(ke,Te,De,Ve,Se,4),H.identity(Ve),H.rotateY(Ve,Ve,Math.PI),Sn(ke,Te,De,Ve,Se,5),ke.viewport.set([0,0,ge.width,ge.height])}(Q,Y),Y.markSkyboxValid(Q)):Q.renderPass==="sky"&&function(ge,Te,Pe,Le,ke){const Be=ge.context,Ne=Be.gl,Se=ge.transform,De=ge.useProgram("skybox");Be.activeTexture.set(Ne.TEXTURE0),Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,Te.skyboxTexture);const Ve=((Ge,Qe,tt,et,at)=>({u_matrix:Ge,u_sun_direction:Qe,u_cubemap:0,u_opacity:et,u_temporal_offset:at}))(Se.skyboxMatrix,Te.getCenter(ge,!1),0,Le,ke);ge.prepareDrawProgram(Be,De),De.draw(Be,Ne.TRIANGLES,Pe,H.StencilMode.disabled,ge.colorModeForRenderPass(),H.CullFaceMode.backCW,Ve,"skybox",Te.skyboxGeometry.vertexBuffer,Te.skyboxGeometry.indexBuffer,Te.skyboxGeometry.segment)}(Q,Y,de,ae,ve):fe==="gradient"&&Q.renderPass==="sky"&&function(ge,Te,Pe,Le,ke){const Be=ge.context,Ne=Be.gl,Se=ge.transform,De=ge.useProgram("skyboxGradient");Te.skyboxGeometry||(Te.skyboxGeometry=new Ds(Be)),Be.activeTexture.set(Ne.TEXTURE0);let Ve=Te.colorRampTexture;Ve||(Ve=Te.colorRampTexture=new H.Texture(Be,Te.colorRamp,Ne.RGBA)),Ve.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE);const Ge=((Qe,tt,et,at,nt)=>({u_matrix:Qe,u_color_ramp:0,u_center_direction:tt,u_radius:H.degToRad(et),u_opacity:at,u_temporal_offset:nt}))(Se.skyboxMatrix,Te.getCenter(ge,!1),Te.paint.get("sky-gradient-radius"),Le,ke);ge.prepareDrawProgram(Be,De),De.draw(Be,Ne.TRIANGLES,Pe,H.StencilMode.disabled,ge.colorModeForRenderPass(),H.CullFaceMode.backCW,Ge,"skyboxGradient",Te.skyboxGeometry.vertexBuffer,Te.skyboxGeometry.indexBuffer,Te.skyboxGeometry.segment)}(Q,Y,de,ae,ve)},debug:function(Q,U,Y){for(let te=0;te<Y.length;te++)Ph(Q,U,Y[te])},custom:function(Q,U,Y,te){const ne=Q.context,ae=Y.implementation;if(!Q.transform.projection.unsupportedLayers||!Q.transform.projection.unsupportedLayers.includes("custom")||Q.terrain&&(Q.terrain.renderingToTexture||Q.renderPass==="offscreen")&&Y.isLayerDraped()){if(Q.renderPass==="offscreen"){const he=ae.prerender;if(he){if(Q.setCustomLayerDefaults(),ne.setColorMode(Q.colorModeForRenderPass()),Q.transform.projection.name==="globe"){const fe=Q.transform.pointMerc;he.call(ae,ne.gl,Q.transform.customLayerMatrix(),Q.transform.getProjection(),Q.transform.globeToMercatorMatrix(),H.globeToMercatorTransition(Q.transform.zoom),[fe.x,fe.y],Q.transform.pixelsPerMeterRatio)}else he.call(ae,ne.gl,Q.transform.customLayerMatrix());ne.setDirty(),Q.setBaseState()}}else if(Q.renderPass==="translucent"){if(Q.terrain&&Q.terrain.renderingToTexture){const fe=ae.renderToTile;if(fe){const de=te[0].canonical,ve=new H.MercatorCoordinate(de.x+te[0].wrap*(1<<de.z),de.y,de.z);ne.setDepthMode(H.DepthMode.disabled),ne.setStencilMode(H.StencilMode.disabled),ne.setColorMode(Q.colorModeForRenderPass()),Q.setCustomLayerDefaults(),fe.call(ae,ne.gl,ve),ne.setDirty(),Q.setBaseState()}return}Q.setCustomLayerDefaults(),ne.setColorMode(Q.colorModeForRenderPass()),ne.setStencilMode(H.StencilMode.disabled);const he=ae.renderingMode==="3d"?new H.DepthMode(Q.context.gl.LEQUAL,H.DepthMode.ReadWrite,Q.depthRangeFor3D):Q.depthModeForSublayer(0,H.DepthMode.ReadOnly);if(ne.setDepthMode(he),Q.transform.projection.name==="globe"){const fe=Q.transform.pointMerc;ae.render(ne.gl,Q.transform.customLayerMatrix(),Q.transform.getProjection(),Q.transform.globeToMercatorMatrix(),H.globeToMercatorTransition(Q.transform.zoom),[fe.x,fe.y],Q.transform.pixelsPerMeterRatio)}else ae.render(ne.gl,Q.transform.customLayerMatrix());ne.setDirty(),Q.setBaseState(),ne.bindFramebuffer.set(null)}}else H.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class ua{constructor(U,Y,te=!1){this.context=new qt(U,te),this.transform=Y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=H.SourceCache.maxUnderzooming+H.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(U,Y){const te=!!U&&!!U.terrain&&this.transform.projection.supportsTerrain;if(!(te||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Bl(this,U));const ne=this._terrain;this.transform.elevation=te?ne:null,ne.update(U,this.transform,Y)}_updateFog(U){const Y=U.fog;if(!Y||this.transform.projection.name==="globe"||Y.getOpacity(this.transform.pitch)<1||Y.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[te,ne]=Y.getFovAdjustedRange(this.transform._fov);if(te>ne)return void(this.transform.fogCullDistSq=null);const ae=te+.78*(ne-te);this.transform.fogCullDistSq=ae*ae}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(U,Y){if(this.width=U*H.exported.devicePixelRatio,this.height=Y*H.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const te of this.style.order)this.style._layers[te].resize()}setup(){const U=this.context,Y=new H.StructArrayLayout2i4;Y.emplaceBack(0,0),Y.emplaceBack(H.EXTENT,0),Y.emplaceBack(0,H.EXTENT),Y.emplaceBack(H.EXTENT,H.EXTENT),this.tileExtentBuffer=U.createVertexBuffer(Y,H.posAttributes.members),this.tileExtentSegments=H.SegmentVector.simpleSegment(0,0,4,2);const te=new H.StructArrayLayout2i4;te.emplaceBack(0,0),te.emplaceBack(H.EXTENT,0),te.emplaceBack(0,H.EXTENT),te.emplaceBack(H.EXTENT,H.EXTENT),this.debugBuffer=U.createVertexBuffer(te,H.posAttributes.members),this.debugSegments=H.SegmentVector.simpleSegment(0,0,4,5);const ne=new H.StructArrayLayout2i4;ne.emplaceBack(-1,-1),ne.emplaceBack(1,-1),ne.emplaceBack(-1,1),ne.emplaceBack(1,1),this.viewportBuffer=U.createVertexBuffer(ne,H.posAttributes.members),this.viewportSegments=H.SegmentVector.simpleSegment(0,0,4,2);const ae=new H.StructArrayLayout4i8;ae.emplaceBack(0,0,0,0),ae.emplaceBack(H.EXTENT,0,H.EXTENT,0),ae.emplaceBack(0,H.EXTENT,0,H.EXTENT),ae.emplaceBack(H.EXTENT,H.EXTENT,H.EXTENT,H.EXTENT),this.mercatorBoundsBuffer=U.createVertexBuffer(ae,H.boundsAttributes.members),this.mercatorBoundsSegments=H.SegmentVector.simpleSegment(0,0,4,2);const he=new H.StructArrayLayout3ui6;he.emplaceBack(0,1,2),he.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=U.createIndexBuffer(he);const fe=new H.StructArrayLayout1ui2;for(const ve of[0,1,3,2,0])fe.emplaceBack(ve);this.debugIndexBuffer=U.createIndexBuffer(fe),this.emptyTexture=new H.Texture(U,new H.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),U.gl.RGBA),this.identityMat=H.create();const de=this.context.gl;this.stencilClearMode=new H.StencilMode({func:de.ALWAYS,mask:0},0,255,de.ZERO,de.ZERO,de.ZERO),this.loadTimeStamps.push(H.window.performance.now()),this.atmosphereBuffer=new mu(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(U){return U._makeTileBoundsBuffers(this.context,this.transform.projection),U._tileBoundsBuffer?{tileBoundsBuffer:U._tileBoundsBuffer,tileBoundsIndexBuffer:U._tileBoundsIndexBuffer,tileBoundsSegments:U._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const U=this.context,Y=U.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(U,Y.TRIANGLES,H.DepthMode.disabled,this.stencilClearMode,H.ColorMode.disabled,H.CullFaceMode.disabled,za(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(U,Y,te){if(!Y||this.currentStencilSource===Y.id||!U.isTileClipped()||!te||te.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let fe=!1;for(const de of te)if(this._tileClippingMaskIDs[de.key]===void 0){fe=!0;break}if(!fe)return}this.currentStencilSource=Y.id;const ne=this.context,ae=ne.gl;this.nextStencilID+te.length>256&&this.clearStencil(),ne.setColorMode(H.ColorMode.disabled),ne.setDepthMode(H.DepthMode.disabled);const he=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const fe of te){const de=Y.getTile(fe),ve=this._tileClippingMaskIDs[fe.key]=this.nextStencilID++,{tileBoundsBuffer:ge,tileBoundsIndexBuffer:Te,tileBoundsSegments:Pe}=this.getTileBoundsBuffers(de);he.draw(ne,ae.TRIANGLES,H.DepthMode.disabled,new H.StencilMode({func:ae.ALWAYS,mask:0},ve,255,ae.KEEP,ae.KEEP,ae.REPLACE),H.ColorMode.disabled,H.CullFaceMode.disabled,za(fe.projMatrix),"$clipping",ge,Te,Pe)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const U=this.nextStencilID++,Y=this.context.gl;return new H.StencilMode({func:Y.NOTEQUAL,mask:255},U,255,Y.KEEP,Y.KEEP,Y.REPLACE)}stencilModeForClipping(U){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(U);const Y=this.context.gl;return new H.StencilMode({func:Y.EQUAL,mask:255},this._tileClippingMaskIDs[U.key],0,Y.KEEP,Y.KEEP,Y.REPLACE)}stencilConfigForOverlap(U){const Y=this.context.gl,te=U.sort((he,fe)=>fe.overscaledZ-he.overscaledZ),ne=te[te.length-1].overscaledZ,ae=te[0].overscaledZ-ne+1;if(ae>1){this.currentStencilSource=void 0,this.nextStencilID+ae>256&&this.clearStencil();const he={};for(let fe=0;fe<ae;fe++)he[fe+ne]=new H.StencilMode({func:Y.GEQUAL,mask:255},fe+this.nextStencilID,255,Y.KEEP,Y.KEEP,Y.REPLACE);return this.nextStencilID+=ae,[he,te]}return[{[ne]:H.StencilMode.disabled},te]}colorModeForRenderPass(){const U=this.context.gl;return this._showOverdrawInspector?new H.ColorMode([U.CONSTANT_COLOR,U.ONE],new H.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?H.ColorMode.unblended:H.ColorMode.alphaBlended}depthModeForSublayer(U,Y,te){if(!this.opaquePassEnabledForLayer())return H.DepthMode.disabled;const ne=1-((1+this.currentLayer)*this.numSublayers+U)*this.depthEpsilon;return new H.DepthMode(te||this.context.gl.LEQUAL,Y,[ne,ne])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(U,Y){this.style=U,this.options=Y,this.imageManager=U.imageManager,this.glyphManager=U.glyphManager,this.symbolFadeChange=U.placement.symbolFadeChange(H.exported.now()),this.imageManager.beginFrame();const te=this.style.order,ne=this.style._sourceCaches;for(const ve in ne){const ge=ne[ve];ge.used&&ge.prepare(this.context)}const ae={},he={},fe={};for(const ve in ne){const ge=ne[ve];ae[ve]=ge.getVisibleCoordinates(),he[ve]=ae[ve].slice().reverse(),fe[ve]=ge.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ve=0;ve<te.length;ve++)if(this.style._layers[te[ve]].is3D()){this.opaquePassCutoff=ve;break}if(this.terrain&&(this.terrain.updateTileBinding(fe),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new H.GlobeSharedBuffers(this.context)),!H.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const ve of te){const ge=this.style._layers[ve],Te=U._getLayerSourceCache(ge);if(!ge.hasOffscreenPass()||ge.isHidden(this.transform.zoom))continue;const Pe=Te?he[Te.id]:void 0;(ge.type==="custom"||ge.isSky()||Pe&&Pe.length)&&this.renderLayer(this,Te,ge,Pe)}this.depthRangeFor3D=[0,1-(U.order.length+2)*this.numSublayers*this.depthEpsilon];const de=this.terrain;if(de&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&de.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:Y.showOverdrawInspector?H.Color.black:H.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=Y.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=te.length-1;this.currentLayer>=0;this.currentLayer--){const ve=this.style._layers[te[this.currentLayer]],ge=U._getLayerSourceCache(ve);if(ve.isSky())continue;const Te=ge?he[ge.id]:void 0;this._renderTileClippingMasks(ve,ge,Te),this.renderLayer(this,ge,ve,Te)}if(this.style.fog&&this.transform.projection.supportsFog&&function(ve,ge){const Te=ve.context,Pe=Te.gl,Le=ve.transform,ke=new H.DepthMode(Pe.LEQUAL,H.DepthMode.ReadOnly,[0,1]),Be=ve.useProgram("globeAtmosphere",null,Le.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Ne=H.globeToMercatorTransition(Le.zoom),Se=ge.properties.get("color").toArray01(),De=ge.properties.get("high-color").toArray01(),Ve=ge.properties.get("space-color").toArray01PremultipliedAlpha(),Ge=H.identity$1([]);H.rotateY$1(Ge,Ge,-H.degToRad(Le._center.lng)),H.rotateX$1(Ge,Ge,H.degToRad(Le._center.lat)),H.rotateZ$1(Ge,Ge,Le.angle),H.rotateX$1(Ge,Ge,-Le._pitch);const Qe=H.fromQuat(new Float32Array(16),Ge),tt=H.mapValue(ge.properties.get("star-intensity"),0,1,0,.25),et=5e-4,at=H.mapValue(ge.properties.get("horizon-blend"),0,1,et,.25),nt=H.globeUseCustomAntiAliasing(ve,Te,Le)&&at===et?Le.worldSize/(2*Math.PI*1.025)-1:Le.globeRadius,pt=ve.frameCounter/1e3%1,kt=H.length(Le.globeCenterInViewSpace),ct=Math.sqrt(Math.pow(kt,2)-Math.pow(nt,2)),At=Math.acos(ct/kt),yt=((ft,St,Ft,Mt,Ut,lr,_r,rr,fr,Lr,Pr,or,Kr,Qr)=>({u_frustum_tl:ft,u_frustum_tr:St,u_frustum_br:Ft,u_frustum_bl:Mt,u_horizon:Ut,u_transition:lr,u_fadeout_range:_r,u_color:rr,u_high_color:fr,u_space_color:Lr,u_star_intensity:Pr,u_star_size:5*H.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:or,u_horizon_angle:Kr,u_rotation_matrix:Qr}))(Le.frustumCorners.TL,Le.frustumCorners.TR,Le.frustumCorners.BR,Le.frustumCorners.BL,Le.frustumCorners.horizon,Ne,at,Se,De,Ve,tt,pt,At,Qe);ve.prepareDrawProgram(Te,Be);const Bt=ve.atmosphereBuffer;Bt&&Be.draw(Te,Pe.TRIANGLES,ke,H.StencilMode.disabled,H.ColorMode.alphaBlended,H.CullFaceMode.backCW,yt,"skybox",Bt.vertexBuffer,Bt.indexBuffer,Bt.segments)}(this,this.style.fog),this.renderPass="sky",(H.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<te.length;this.currentLayer++){const ve=this.style._layers[te[this.currentLayer]],ge=U._getLayerSourceCache(ve);ve.isSky()&&this.renderLayer(this,ge,ve,ge?he[ge.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<te.length;){const ve=this.style._layers[te[this.currentLayer]],ge=U._getLayerSourceCache(ve);if(ve.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(ve)){if(ve.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Te=ge?(ve.type==="symbol"?fe:he)[ge.id]:void 0;this._renderTileClippingMasks(ve,ge,ge?ae[ge.id]:void 0),this.renderLayer(this,ge,ve,Te),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ve=null;H.values(this.style._layers).forEach(ge=>{const Te=U._getLayerSourceCache(ge);Te&&!ge.isHidden(this.transform.zoom)&&(!ve||ve.getSource().maxzoom<Te.getSource().maxzoom)&&(ve=Te)}),ve&&this.options.showTileBoundaries&&Fo.debug(this,ve,ve.getVisibleCoordinates())}this.options.showPadding&&function(ve){const ge=ve.transform.padding;fu(ve,ve.transform.height-(ge.top||0),3,la),fu(ve,ge.bottom||0,3,Ih),Ms(ve,ge.left||0,3,Ah),Ms(ve,ve.transform.width-(ge.right||0),3,Oh);const Te=ve.transform.centerPoint;(function(Pe,Le,ke,Be){ca(Pe,Le-1,ke-10,2,20,Be),ca(Pe,Le-10,ke-1,20,2,Be)})(ve,Te.x,ve.transform.height-Te.y,Ch)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(H.window.performance.now()),this.saveCanvasCopy())}renderLayer(U,Y,te,ne){te.isHidden(this.transform.zoom)||(te.type==="background"||te.type==="sky"||te.type==="custom"||ne&&ne.length)&&(this.id=te.id,this.gpuTimingStart(te),(!U.transform.projection.unsupportedLayers||!U.transform.projection.unsupportedLayers.includes(te.type)||U.terrain&&te.type==="custom")&&Fo[te.type](U,Y,te,ne,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(U){if(!this.options.gpuTiming)return;const Y=this.context.extTimerQuery;let te=this.gpuTimers[U.id];te||(te=this.gpuTimers[U.id]={calls:0,cpuTime:0,query:Y.createQueryEXT()}),te.calls++,Y.beginQueryEXT(Y.TIME_ELAPSED_EXT,te.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const U=this.context.extTimerQuery,Y=U.createQueryEXT();this.deferredRenderGpuTimeQueries.push(Y),U.beginQueryEXT(U.TIME_ELAPSED_EXT,Y)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const U=this.context.extTimerQuery;U.endQueryEXT(U.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const U=this.context.extTimerQuery;U.endQueryEXT(U.TIME_ELAPSED_EXT)}collectGpuTimers(){const U=this.gpuTimers;return this.gpuTimers={},U}collectDeferredRenderGpuQueries(){const U=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],U}queryGpuTimers(U){const Y={};for(const te in U){const ne=U[te],ae=this.context.extTimerQuery,he=ae.getQueryObjectEXT(ne.query,ae.QUERY_RESULT_EXT)/1e6;ae.deleteQueryEXT(ne.query),Y[te]=he}return Y}queryGpuTimeDeferredRender(U){if(!this.options.gpuTimingDeferredRender)return 0;const Y=this.context.extTimerQuery;let te=0;for(const ne of U)te+=Y.getQueryObjectEXT(ne,Y.QUERY_RESULT_EXT)/1e6,Y.deleteQueryEXT(ne);return te}translatePosMatrix(U,Y,te,ne,ae){if(!te[0]&&!te[1])return U;const he=ae?ne==="map"?this.transform.angle:0:ne==="viewport"?-this.transform.angle:0;if(he){const ve=Math.sin(he),ge=Math.cos(he);te=[te[0]*ge-te[1]*ve,te[0]*ve+te[1]*ge]}const fe=[ae?te[0]:Ht(Y,te[0],this.transform.zoom),ae?te[1]:Ht(Y,te[1],this.transform.zoom),0],de=new Float32Array(16);return H.translate(de,U,fe),de}saveTileTexture(U){const Y=this._tileTextures[U.size[0]];Y?Y.push(U):this._tileTextures[U.size[0]]=[U]}getTileTexture(U){const Y=this._tileTextures[U];return Y&&Y.length>0?Y.pop():null}isPatternMissing(U){return U===null||U!==void 0&&!this.imageManager.getPattern(U.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const U=this.terrain&&this.terrain.renderingToTexture,Y=this.terrain&&this.terrain.exaggeration()===0,te=this.style&&this.style.fog,ne=[];return this.terrainRenderModeElevated()&&ne.push("TERRAIN"),this.transform.projection.name==="globe"&&ne.push("GLOBE"),Y&&ne.push("ZERO_EXAGGERATION"),te&&!U&&te.getOpacity(this.transform.pitch)!==0&&ne.push("FOG"),U&&ne.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&ne.push("OVERDRAW_INSPECTOR"),ne}useProgram(U,Y,te){this.cache=this.cache||{};const ne=te||[],ae=this.currentGlobalDefines().concat(ne),he=zr.cacheKey(Cl[U],U,ae,Y);return this.cache[he]||(this.cache[he]=new zr(this.context,U,Cl[U],Y,ql[U],ae)),this.cache[he]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const U=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(U.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=H.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new H.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(U,Y,te){if(this.terrain&&this.terrain.renderingToTexture)return;const ne=this.style.fog;if(ne){const ae=ne.getOpacity(this.transform.pitch),he=((fe,de,ve,ge,Te,Pe,Le,ke,Be,Ne,Se)=>{const De=fe.transform,Ve=de.properties.get("color").toArray01();Ve[3]=ge;const Ge=fe.frameCounter/1e3%1;return{u_fog_matrix:ve?De.calculateFogTileMatrix(ve):fe.identityMat,u_fog_range:de.getFovAdjustedRange(De._fov),u_fog_color:Ve,u_fog_horizon_blend:de.properties.get("horizon-blend"),u_fog_temporal_offset:Ge,u_frustum_tl:Te,u_frustum_tr:Pe,u_frustum_br:Le,u_frustum_bl:ke,u_globe_pos:Be,u_globe_radius:Ne,u_viewport:Se,u_globe_transition:H.globeToMercatorTransition(De.zoom),u_is_globe:+(De.projection.name==="globe")}})(this,ne,te,ae,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*H.exported.devicePixelRatio,this.transform.height*H.exported.devicePixelRatio]);Y.setFogUniformValues(U,he)}}setTileLoadedFlag(U){this.tileLoaded=U}saveCanvasCopy(){const U=this.canvasCopy();U&&(this.frameCopies.push(U),this.tileLoaded=!1)}canvasCopy(){const U=this.context.gl,Y=U.createTexture();return U.bindTexture(U.TEXTURE_2D,Y),U.copyTexImage2D(U.TEXTURE_2D,0,U.RGBA,0,0,U.drawingBufferWidth,U.drawingBufferHeight,0),Y}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const U=this.style&&this.style.fog;return!!U&&U.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const U=this._backgroundTiles,Y=this._backgroundTiles={},te=this.transform.coveringTiles({tileSize:512});for(const ne of te)Y[ne.key]=U[ne.key]||new H.Tile(ne,512,this.transform.tileZoom,this);return Y}clearBackgroundTiles(){this._backgroundTiles={}}}class Ls{constructor(U=0,Y=0,te=0,ne=0){if(isNaN(U)||U<0||isNaN(Y)||Y<0||isNaN(te)||te<0||isNaN(ne)||ne<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=U,this.bottom=Y,this.left=te,this.right=ne}interpolate(U,Y,te){return Y.top!=null&&U.top!=null&&(this.top=H.number(U.top,Y.top,te)),Y.bottom!=null&&U.bottom!=null&&(this.bottom=H.number(U.bottom,Y.bottom,te)),Y.left!=null&&U.left!=null&&(this.left=H.number(U.left,Y.left,te)),Y.right!=null&&U.right!=null&&(this.right=H.number(U.right,Y.right,te)),this}getCenter(U,Y){const te=H.clamp((this.left+U-this.right)/2,0,U),ne=H.clamp((this.top+Y-this.bottom)/2,0,Y);return new H.Point(te,ne)}equals(U){return this.top===U.top&&this.bottom===U.bottom&&this.left===U.left&&this.right===U.right}clone(){return new Ls(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Bs(Q,U){const Y=H.getColumn(Q,3);H.fromQuat(Q,U),H.setColumn(Q,3,Y)}function Ur(Q,U){const Y=H.identity$1([]);return H.rotateZ$1(Y,Y,-U),H.rotateX$1(Y,Y,-Q),Y}function Ha(Q,U){const Y=[Q[0],Q[1],0],te=[U[0],U[1],0];if(H.length(Y)>=1e-15){const he=H.normalize([],Y);H.scale$2(te,he,H.dot(te,he)),U[0]=te[0],U[1]=te[1]}const ne=H.cross([],U,Q);if(H.len(ne)<1e-15)return null;const ae=Math.atan2(-ne[1],ne[0]);return Ur(Math.atan2(Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]),-Q[2]),ae)}class yu{constructor(U,Y){this.position=U,this.orientation=Y}get position(){return this._position}set position(U){if(U){const Y=U instanceof H.MercatorCoordinate?U:new H.MercatorCoordinate(U[0],U[1],U[2]);this._renderWorldCopies&&(Y.x=H.wrap(Y.x,0,1)),this._position=Y}else this._position=null}lookAtPoint(U,Y){if(this.orientation=null,!this.position)return;const te=this.position,ne=this._elevation?this._elevation.getAtPointOrZero(H.MercatorCoordinate.fromLngLat(U)):0,ae=H.MercatorCoordinate.fromLngLat(U,ne),he=[ae.x-te.x,ae.y-te.y,ae.z-te.z];Y||(Y=[0,0,1]),Y[2]=Math.abs(Y[2]),this.orientation=Ha(he,Y)}setPitchBearing(U,Y){this.orientation=Ur(H.degToRad(U),H.degToRad(-Y))}}class ks{constructor(U,Y){this._transform=H.identity([]),this.orientation=Y,this.position=U}get mercatorPosition(){const U=this.position;return new H.MercatorCoordinate(U[0],U[1],U[2])}get position(){const U=H.getColumn(this._transform,3);return[U[0],U[1],U[2]]}set position(U){var Y;U&&H.setColumn(this._transform,3,[(Y=U)[0],Y[1],Y[2],1])}get orientation(){return this._orientation}set orientation(U){this._orientation=U||H.identity$1([]),U&&Bs(this._transform,this._orientation)}getPitchBearing(){const U=this.forward(),Y=this.right();return{bearing:Math.atan2(-Y[1],Y[0]),pitch:Math.atan2(Math.sqrt(U[0]*U[0]+U[1]*U[1]),-U[2])}}setPitchBearing(U,Y){this._orientation=Ur(U,Y),Bs(this._transform,this._orientation)}forward(){const U=H.getColumn(this._transform,2);return[-U[0],-U[1],-U[2]]}up(){const U=H.getColumn(this._transform,1);return[-U[0],-U[1],-U[2]]}right(){const U=H.getColumn(this._transform,0);return[U[0],U[1],U[2]]}getCameraToWorld(U,Y){const te=new Float64Array(16);return H.invert(te,this.getWorldToCamera(U,Y)),te}getWorldToCameraPosition(U,Y,te){const ne=this.position;H.scale$2(ne,ne,-U);const ae=new Float64Array(16);return H.fromScaling(ae,[te,te,te]),H.translate(ae,ae,ne),ae[10]*=Y,ae}getWorldToCamera(U,Y){const te=new Float64Array(16),ne=new Float64Array(4),ae=this.position;return H.conjugate(ne,this._orientation),H.scale$2(ae,ae,-U),H.fromQuat(te,ne),H.translate(te,te,ae),te[1]*=-1,te[5]*=-1,te[9]*=-1,te[13]*=-1,te[8]*=Y,te[9]*=Y,te[10]*=Y,te[11]*=Y,te}getCameraToClipPerspective(U,Y,te,ne){const ae=new Float64Array(16);return H.perspective(ae,U,Y,te,ne),ae}getDistanceToElevation(U,Y=!1){const te=U===0?0:H.mercatorZfromAltitude(U,Y?H.latFromMercatorY(this.position[1]):this.position[1]),ne=this.forward();return(te-this.position[2])/ne[2]}clone(){return new ks([...this.position],[...this.orientation])}}function ha(Q,U){const Y=Ns(Q.projection,Q.zoom,Q.width,Q.height),te=function(ae,he,fe,de,ve){const ge=new H.LngLat(fe.lng-180*co,fe.lat),Te=new H.LngLat(fe.lng+180*co,fe.lat),Pe=ae.project(ge.lng,ge.lat),Le=ae.project(Te.lng,Te.lat),ke=-Math.atan2(Le.y-Pe.y,Le.x-Pe.x),Be=H.MercatorCoordinate.fromLngLat(fe);Be.y=H.clamp(Be.y,-1+co,1-co);const Ne=Be.toLngLat(),Se=ae.project(Ne.lng,Ne.lat),De=H.MercatorCoordinate.fromLngLat(Ne);De.x+=co;const Ve=De.toLngLat(),Ge=ae.project(Ve.lng,Ve.lat),Qe=Fs(Ge.x-Se.x,Ge.y-Se.y,ke),tt=H.MercatorCoordinate.fromLngLat(Ne);tt.y+=co;const et=tt.toLngLat(),at=ae.project(et.lng,et.lat),nt=Fs(at.x-Se.x,at.y-Se.y,ke),pt=Math.abs(Qe.x)/Math.abs(nt.y),kt=H.identity([]);H.rotateZ(kt,kt,-ke*(1-(ve?0:de)));const ct=H.identity([]);return H.scale(ct,ct,[1,1-(1-pt)*de,1]),ct[4]=-nt.x/nt.y*de,H.rotateZ(ct,ct,ke),H.multiply(ct,kt,ct),ct}(Q.projection,0,Q.center,Y,U),ne=_u(Q);return H.scale(te,te,[ne,ne,1]),te}function _u(Q){const U=Q.projection,Y=Ns(Q.projection,Q.zoom,Q.width,Q.height),te=gu(U,Q.center),ne=gu(U,H.LngLat.convert(U.center));return Math.pow(2,te*Y+(1-Y)*ne)}function Ns(Q,U,Y,te,ne=1/0){const ae=Q.range;if(!ae)return 0;const he=Math.min(ne,Math.max(Y,te)),fe=Math.log(he/1024)/Math.LN2;return H.smoothstep(ae[0]+fe,ae[1]+fe,U)}const co=1/4e4;function gu(Q,U){const Y=H.clamp(U.lat,-H.MAX_MERCATOR_LATITUDE,H.MAX_MERCATOR_LATITUDE),te=new H.LngLat(U.lng-180*co,Y),ne=new H.LngLat(U.lng+180*co,Y),ae=Q.project(te.lng,Y),he=Q.project(ne.lng,Y),fe=H.MercatorCoordinate.fromLngLat(te),de=H.MercatorCoordinate.fromLngLat(ne),ve=he.x-ae.x,ge=he.y-ae.y,Te=de.x-fe.x,Pe=de.y-fe.y,Le=Math.sqrt((Te*Te+Pe*Pe)/(ve*ve+ge*ge));return Math.log(Le)/Math.LN2}function Fs(Q,U,Y){const te=Math.cos(Y),ne=Math.sin(Y);return{x:Q*te-U*ne,y:Q*ne+U*te}}class fa{constructor(U,Y,te,ne,ae,he,fe){this.tileSize=512,this._renderWorldCopies=ae===void 0||ae,this._minZoom=U||0,this._maxZoom=Y||22,this._minPitch=te??0,this._maxPitch=ne??60,this.setProjection(he),this.setMaxBounds(fe),this.width=0,this.height=0,this._center=new H.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ls,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ks,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const U=new fa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return U._elevation=this._elevation,U._centerAltitude=this._centerAltitude,U._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,U.tileSize=this.tileSize,U.mercatorFromTransition=this.mercatorFromTransition,U.width=this.width,U.height=this.height,U.cameraElevationReference=this.cameraElevationReference,U._center=this._center,U._setZoom(this.zoom),U._seaLevelZoom=this._seaLevelZoom,U.angle=this.angle,U._fov=this._fov,U._pitch=this._pitch,U._nearZ=this._nearZ,U._farZ=this._farZ,U._averageElevation=this._averageElevation,U._unmodified=this._unmodified,U._edgeInsets=this._edgeInsets.clone(),U._camera=this._camera.clone(),U._calcMatrices(),U.freezeTileCoverage=this.freezeTileCoverage,U.frustumCorners=this.frustumCorners,U}get elevation(){return this._elevation}set elevation(U){this._elevation!==U&&(this._elevation=U,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(U,Y=!1){const te=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||te)&&this._updateCameraOnTerrain(),(U||te)&&this._constrainCamera(Y),this._calcMatrices()}getProjection(){return H.pick(this.projection,["name","center","parallels"])}setProjection(U){this.projectionOptions=U||{name:"mercator"};const Y=this.projection?this.getProjection():void 0;this.projection=H.getProjection(this.projectionOptions);const te=!ye(Y,this.getProjection());return te&&this._calcMatrices(),this.mercatorFromTransition=!1,te}setMercatorFromTransition(){const U=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=H.getProjection({name:"mercator"});const Y=U!==this.projection.name;return Y&&this._calcMatrices(),Y}get minZoom(){return this._minZoom}set minZoom(U){this._minZoom!==U&&(this._minZoom=U,this.zoom=Math.max(this.zoom,U))}get maxZoom(){return this._maxZoom}set maxZoom(U){this._maxZoom!==U&&(this._maxZoom=U,this.zoom=Math.min(this.zoom,U))}get minPitch(){return this._minPitch}set minPitch(U){this._minPitch!==U&&(this._minPitch=U,this.pitch=Math.max(this.pitch,U))}get maxPitch(){return this._maxPitch}set maxPitch(U){this._maxPitch!==U&&(this._maxPitch=U,this.pitch=Math.min(this.pitch,U))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(U){U===void 0?U=!0:U===null&&(U=!1),this._renderWorldCopies=U}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const U=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(U))}get cameraWorldSize(){const U=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(U))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return H.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new H.Point(this.width,this.height)}get bearing(){return H.wrap(this.rotation,-180,180)}set bearing(U){this.rotation=U}get rotation(){return-this.angle/Math.PI*180}set rotation(U){const Y=-U*Math.PI/180;var te;this.angle!==Y&&(this._unmodified=!1,this.angle=Y,this._calcMatrices(),this.rotationMatrix=(te=new H.ARRAY_TYPE(4),H.ARRAY_TYPE!=Float32Array&&(te[1]=0,te[2]=0),te[0]=1,te[3]=1,te),function(ne,ae,he){var fe=ae[0],de=ae[1],ve=ae[2],ge=ae[3],Te=Math.sin(he),Pe=Math.cos(he);ne[0]=fe*Pe+ve*Te,ne[1]=de*Pe+ge*Te,ne[2]=fe*-Te+ve*Pe,ne[3]=de*-Te+ge*Pe}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(U){const Y=H.clamp(U,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==Y&&(this._unmodified=!1,this._pitch=Y,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const U=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/U)}set fov(U){U=Math.max(.01,Math.min(60,U)),this._fov!==U&&(this._unmodified=!1,this._fov=H.degToRad(U),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(U){this._averageElevation=U,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(U){const Y=Math.min(Math.max(U,this.minZoom),this.maxZoom);this._zoom!==Y&&(this._unmodified=!1,this._setZoom(Y),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(U){this._zoom=U,this.scale=this.zoomScale(U),this.tileZoom=Math.floor(U),this.zoomFraction=U-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const U=this._elevation;this._centerAltitude=U.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=U.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const U=this._elevation,Y=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],te=this.horizonLineFromTop();let ne=0,ae=0;for(let he=0;he<Y.length;he++){const fe=new H.Point(Y[he][0]*this.width,te+Y[he][1]*(this.height-te)),de=U.pointCoordinate(fe);if(!de)continue;const ve=1/Math.hypot(de[0]-this._camera.position[0],de[1]-this._camera.position[1]);ne+=de[3]*ve,ae+=ve}return ae===0?NaN:ne/ae}get center(){return this._center}set center(U){U.lat===this._center.lat&&U.lng===this._center.lng||(this._unmodified=!1,this._center=U,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const U=this._seaLevelZoom,Y=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),te=this.pixelsPerMeter/this.worldSize*Y,ne=this._mercatorZfromZoom(U),ae=this._mercatorZfromZoom(this._maxZoom),he=Math.max(ne-te,ae);this._setZoom(this._zoomFromMercatorZ(he))}get padding(){return this._edgeInsets.toJSON()}set padding(U){this._edgeInsets.equals(U)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,U,1),this._calcMatrices())}computeZoomRelativeTo(U){const Y=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,U.toAltitude()));let te;te=U.z<this._camera.position[2]?[Y.x,Y.y,Y.z]:[U.x,U.y,U.z];const ne=H.length(H.sub([],this._camera.position,te));return H.clamp(this._zoomFromMercatorZ(ne),this._minZoom,this._maxZoom)}setFreeCameraOptions(U){if(!this.height||!U.position&&!U.orientation)return;this._updateCameraState();let Y=!1;if(U.orientation&&!H.exactEquals(U.orientation,this._camera.orientation)&&(Y=this._setCameraOrientation(U.orientation)),U.position){const te=[U.position.x,U.position.y,U.position.z];H.exactEquals$1(te,this._camera.position)||(this._setCameraPosition(te),Y=!0)}Y&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const U=this._camera.position,Y=new yu;return Y.position=new H.MercatorCoordinate(U[0],U[1],U[2]),Y.orientation=this._camera.orientation,Y._elevation=this.elevation,Y._renderWorldCopies=this.renderWorldCopies,Y}_setCameraOrientation(U){if(!H.length$1(U))return!1;H.normalize$1(U,U);const Y=H.transformQuat([],[0,0,-1],U),te=H.transformQuat([],[0,-1,0],U);if(te[2]<0)return!1;const ne=Ha(Y,te);return!!ne&&(this._camera.orientation=ne,!0)}_setCameraPosition(U){const Y=this.zoomScale(this.minZoom)*this.tileSize,te=this.zoomScale(this.maxZoom)*this.tileSize,ne=this.cameraToCenterDistance;U[2]=H.clamp(U[2],ne/te,ne/Y),this._camera.position=U}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(U){return this._edgeInsets.equals(U)}interpolatePadding(U,Y,te){this._unmodified=!1,this._edgeInsets.interpolate(U,Y,te),this._constrain(),this._calcMatrices()}coveringZoomLevel(U){const Y=(U.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/U.tileSize));return Math.max(0,Y)}getVisibleUnwrappedCoordinates(U){const Y=[new H.UnwrappedTileID(0,U)];if(this.renderWorldCopies){const te=this.pointCoordinate(new H.Point(0,0)),ne=this.pointCoordinate(new H.Point(this.width,0)),ae=this.pointCoordinate(new H.Point(this.width,this.height)),he=this.pointCoordinate(new H.Point(0,this.height)),fe=Math.floor(Math.min(te.x,ne.x,ae.x,he.x)),de=Math.floor(Math.max(te.x,ne.x,ae.x,he.x)),ve=1;for(let ge=fe-ve;ge<=de+ve;ge++)ge!==0&&Y.push(new H.UnwrappedTileID(ge,U))}return Y}coveringTiles(U){let Y=this.coveringZoomLevel(U);const te=Y,ne=this.elevation&&!U.isTerrainDEM,ae=this.projection.name==="mercator";if(U.minzoom!==void 0&&Y<U.minzoom)return[];U.maxzoom!==void 0&&Y>U.maxzoom&&(Y=U.maxzoom);const he=this.locationCoordinate(this.center),fe=this.center.lat,de=1<<Y,ve=[de*he.x,de*he.y,0],ge=this.projection.name==="globe",Te=!ge,Pe=H.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,Y,Te),Le=ge?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ke=de*H.mercatorZfromAltitude(1,this.center.lat),Be=this._camera.position[2]/H.mercatorZfromAltitude(1,this.center.lat),Ne=[de*Le.x,de*Le.y,Be*(Te?1:ke)],Se=this.cameraToCenterDistance/U.tileSize*(U.roundZoom?1:.502),De=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?Y:0,Ve=U.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Ge=U.isTerrainDEM?-Ve:this._elevation?this._elevation.getMinElevationBelowMSL():0,Qe=this.projection.isReprojectedInTileSpace?_u(this):1,tt=ft=>{const Ft=new H.MercatorCoordinate(ft.x+25e-6,ft.y,ft.z),Mt=new H.MercatorCoordinate(ft.x,ft.y+25e-6,ft.z),Ut=ft.toLngLat(),lr=Ft.toLngLat(),_r=Mt.toLngLat(),rr=this.locationCoordinate(Ut),fr=this.locationCoordinate(lr),Lr=this.locationCoordinate(_r),Pr=Math.hypot(fr.x-rr.x,fr.y-rr.y),or=Math.hypot(Lr.x-rr.x,Lr.y-rr.y);return Math.sqrt(Pr*or)*Qe/25e-6},et=ft=>{const St=Ve,Ft=Ge;return{aabb:H.tileAABB(this,de,0,0,0,ft,Ft,St,this.projection),zoom:0,x:0,y:0,minZ:Ft,maxZ:St,wrap:ft,fullyVisible:!1}},at=[];let nt=[];const pt=Y,kt=U.reparseOverscaled?te:Y,ct=ft=>ft*ft,At=ct((Be-this._centerAltitude)*ke),yt=ft=>{if(!this._elevation||!ft.tileID||!ae)return;const St=this._elevation.getMinMaxForTile(ft.tileID),Ft=ft.aabb;St?(Ft.min[2]=St.min,Ft.max[2]=St.max,Ft.center[2]=(Ft.min[2]+Ft.max[2])/2):(ft.shouldSplit=Bt(ft),ft.shouldSplit||(Ft.min[2]=Ft.max[2]=Ft.center[2]=this._centerAltitude))},Bt=ft=>{if(ft.zoom<De)return!0;if(ft.zoom===pt)return!1;if(ft.shouldSplit!=null)return ft.shouldSplit;const St=ft.aabb.distanceX(Ne),Ft=ft.aabb.distanceY(Ne);let Mt=At,Ut=1;if(ge){Mt=ct(ft.aabb.distanceZ(Ne));const rr=Math.pow(2,ft.zoom),fr=H.latFromMercatorY((ft.y+1)/rr),Lr=H.latFromMercatorY(ft.y/rr),Pr=Math.min(Math.max(fe,fr),Lr),or=H.circumferenceAtLatitude(Pr)/H.circumferenceAtLatitude(fe);if(Ut=Pr===fe?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,or/this._mercatorScaleRatio),this.zoom<=H.GLOBE_ZOOM_THRESHOLD_MIN&&ft.zoom===pt-1&&or>=.9)return!0}else if(ne&&(Mt=ct(ft.aabb.distanceZ(Ne)*ke)),this.projection.isReprojectedInTileSpace&&te<=5){const rr=Math.pow(2,ft.zoom),fr=tt(new H.MercatorCoordinate((ft.x+.5)/rr,(ft.y+.5)/rr));Ut=fr>.85?1:fr}const lr=St*St+Ft*Ft+Mt,_r=ct((1<<pt-ft.zoom)*Se*Ut*((rr,fr)=>{if(fr*ct(.707)<rr)return 1;const Lr=Math.sqrt(fr/rr);return Lr/(1.4144271570014144+(Math.pow(1.1,Lr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Mt,At),lr));return lr<_r};if(this.renderWorldCopies)for(let ft=1;ft<=3;ft++)at.push(et(-ft)),at.push(et(ft));for(at.push(et(0));at.length>0;){const ft=at.pop(),St=ft.x,Ft=ft.y;let Mt=ft.fullyVisible;if(!Mt){const Ut=ft.aabb.intersects(Pe);if(Ut===0)continue;Mt=Ut===2}if(ft.zoom!==pt&&Bt(ft))for(let Ut=0;Ut<4;Ut++){const lr=(St<<1)+Ut%2,_r=(Ft<<1)+(Ut>>1),rr={aabb:ae?ft.aabb.quadrant(Ut):H.tileAABB(this,de,ft.zoom+1,lr,_r,ft.wrap,ft.minZ,ft.maxZ,this.projection),zoom:ft.zoom+1,x:lr,y:_r,wrap:ft.wrap,fullyVisible:Mt,tileID:void 0,shouldSplit:void 0,minZ:ft.minZ,maxZ:ft.maxZ};ne&&!ge&&(rr.tileID=new H.OverscaledTileID(ft.zoom+1===pt?kt:ft.zoom+1,ft.wrap,ft.zoom+1,lr,_r),yt(rr)),at.push(rr)}else{const Ut=ft.zoom===pt?kt:ft.zoom;if(U.minzoom&&U.minzoom>Ut)continue;const lr=ve[0]-(.5+St+(ft.wrap<<ft.zoom))*(1<<Y-ft.zoom),_r=ve[1]-.5-Ft,rr=ft.tileID?ft.tileID:new H.OverscaledTileID(Ut,ft.wrap,ft.zoom,St,Ft);nt.push({tileID:rr,distanceSq:lr*lr+_r*_r})}}if(this.fogCullDistSq){const ft=this.fogCullDistSq,St=this.horizonLineFromTop();nt=nt.filter(Ft=>{const Mt=[0,0,0,1],Ut=[H.EXTENT,H.EXTENT,0,1],lr=this.calculateFogTileMatrix(Ft.tileID.toUnwrapped());H.transformMat4$1(Mt,Mt,lr),H.transformMat4$1(Ut,Ut,lr);const _r=H.getAABBPointSquareDist(Mt,Ut);if(_r===0)return!0;let rr=!1;const fr=this._elevation;if(fr&&_r>ft&&St!==0){const Lr=this.calculateProjMatrix(Ft.tileID.toUnwrapped());let Pr;U.isTerrainDEM||(Pr=fr.getMinMaxForTile(Ft.tileID)),Pr||(Pr={min:Ge,max:Ve});const or=H.furthestTileCorner(this.rotation),Kr=[or[0]*H.EXTENT,or[1]*H.EXTENT,Pr.max];H.transformMat4(Kr,Kr,Lr),rr=(1-Kr[1])*this.height*.5<St}return _r<ft||rr})}return nt.sort((ft,St)=>ft.distanceSq-St.distanceSq).map(ft=>ft.tileID)}resize(U,Y){this.width=U,this.height=Y,this.pixelsToGLUnits=[2/U,-2/Y],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(U){return Math.pow(2,U)}scaleZoom(U){return Math.log(U)/Math.LN2}project(U){const Y=H.clamp(U.lat,-H.MAX_MERCATOR_LATITUDE,H.MAX_MERCATOR_LATITUDE),te=this.projection.project(U.lng,Y);return new H.Point(te.x*this.worldSize,te.y*this.worldSize)}unproject(U){return this.projection.unproject(U.x/this.worldSize,U.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/H.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(U,Y){let te,ne;const ae=this.centerPoint;if(this.projection.name==="globe"){const fe=this.worldSize;te=(Y.x-ae.x)/fe,ne=(Y.y-ae.y)/fe}else{const fe=this.pointCoordinate(Y),de=this.pointCoordinate(ae);te=fe.x-de.x,ne=fe.y-de.y}const he=this.locationCoordinate(U);this.setLocation(new H.MercatorCoordinate(he.x-te,he.y-ne))}setLocation(U){this.center=this.coordinateLocation(U),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(U){return this.projection.locationPoint(this,U)}locationPoint3D(U){return this.projection.locationPoint(this,U,!0)}pointLocation(U){return this.coordinateLocation(this.pointCoordinate(U))}pointLocation3D(U){return this.coordinateLocation(this.pointCoordinate3D(U))}locationCoordinate(U,Y){const te=Y?H.mercatorZfromAltitude(Y,U.lat):void 0,ne=this.projection.project(U.lng,U.lat);return new H.MercatorCoordinate(ne.x,ne.y,te)}coordinateLocation(U){return this.projection.unproject(U.x,U.y)}pointRayIntersection(U,Y){const te=Y??this._centerAltitude,ne=[U.x,U.y,0,1],ae=[U.x,U.y,1,1];H.transformMat4$1(ne,ne,this.pixelMatrixInverse),H.transformMat4$1(ae,ae,this.pixelMatrixInverse);const he=ae[3];H.scale$1(ne,ne,1/ne[3]),H.scale$1(ae,ae,1/he);const fe=ne[2],de=ae[2];return{p0:ne,p1:ae,t:fe===de?0:(te-fe)/(de-fe)}}screenPointToMercatorRay(U){const Y=[U.x,U.y,0,1],te=[U.x,U.y,1,1];return H.transformMat4$1(Y,Y,this.pixelMatrixInverse),H.transformMat4$1(te,te,this.pixelMatrixInverse),H.scale$1(Y,Y,1/Y[3]),H.scale$1(te,te,1/te[3]),Y[2]=H.mercatorZfromAltitude(Y[2],this._center.lat)*this.worldSize,te[2]=H.mercatorZfromAltitude(te[2],this._center.lat)*this.worldSize,H.scale$1(Y,Y,1/this.worldSize),H.scale$1(te,te,1/this.worldSize),new H.Ray([Y[0],Y[1],Y[2]],H.normalize([],H.sub([],te,Y)))}rayIntersectionCoordinate(U){const{p0:Y,p1:te,t:ne}=U,ae=H.mercatorZfromAltitude(Y[2],this._center.lat),he=H.mercatorZfromAltitude(te[2],this._center.lat);return new H.MercatorCoordinate(H.number(Y[0],te[0],ne)/this.worldSize,H.number(Y[1],te[1],ne)/this.worldSize,H.number(ae,he,ne))}pointCoordinate(U,Y=this._centerAltitude){return this.projection.pointCoordinate(this,U.x,U.y,Y)}pointCoordinate3D(U){if(!this.elevation)return this.pointCoordinate(U);let Y=this.projection.pointCoordinate3D(this,U.x,U.y);if(Y)return new H.MercatorCoordinate(Y[0],Y[1],Y[2]);let te=0,ne=this.horizonLineFromTop();if(U.y>ne)return this.pointCoordinate(U);const ae=.02*ne,he=U.clone();for(let fe=0;fe<10&&ne-te>ae;fe++){he.y=H.number(te,ne,.66);const de=this.projection.pointCoordinate3D(this,he.x,he.y);de?(ne=he.y,Y=de):te=he.y}return Y?new H.MercatorCoordinate(Y[0],Y[1],Y[2]):this.pointCoordinate(U)}isPointAboveHorizon(U){return this.projection.isPointAboveHorizon(this,U)}isPointOnSurface(U){if(U.y<0||U.y>this.height||U.x<0||U.x>this.width)return!1;if(this.elevation||this.zoom>=H.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(U);const Y=this.pointCoordinate(U);return Y.y>=0&&Y.y<=1}_coordinatePoint(U,Y){const te=Y&&this.elevation?this.elevation.getAtPointOrZero(U,this._centerAltitude):this._centerAltitude,ne=[U.x*this.worldSize,U.y*this.worldSize,te+U.toAltitude(),1];return H.transformMat4$1(ne,ne,this.pixelMatrix),ne[3]>0?new H.Point(ne[0]/ne[3],ne[1]/ne[3]):new H.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:U,left:Y}=this._edgeInsets,te=this.height-this._edgeInsets.bottom,ne=this.width-this._edgeInsets.right,ae=this.pointLocation3D(new H.Point(Y,U)),he=this.pointLocation3D(new H.Point(ne,U)),fe=this.pointLocation3D(new H.Point(ne,te)),de=this.pointLocation3D(new H.Point(Y,te));let ve=Math.min(ae.lng,he.lng,fe.lng,de.lng),ge=Math.max(ae.lng,he.lng,fe.lng,de.lng),Te=Math.min(ae.lat,he.lat,fe.lat,de.lat),Pe=Math.max(ae.lat,he.lat,fe.lat,de.lat);const Le=Math.pow(2,-this.zoom)/16*270,ke=this.projection.name==="globe"?1:4,Be=(Ne,Se,De,Ve,Ge)=>{const Qe=(Ne+De)/2,tt=(Se+Ve)/2,et=new H.Point(Qe,tt),{lng:at,lat:nt}=this.pointLocation3D(et),pt=Math.max(0,ve-at,Te-nt,at-ge,nt-Pe);ve=Math.min(ve,at),ge=Math.max(ge,at),Te=Math.min(Te,nt),Pe=Math.max(Pe,nt),(Ge<ke||pt>Le)&&(Be(Ne,Se,Qe,tt,Ge+1),Be(Qe,tt,De,Ve,Ge+1))};if(Be(Y,U,ne,U,1),Be(ne,U,ne,te,1),Be(ne,te,Y,te,1),Be(Y,te,Y,U,1),this.projection.name==="globe"){const[Ne,Se]=H.polesInViewport(this);Ne?(Pe=90,ge=180,ve=-180):Se&&(Te=-90,ge=180,ve=-180)}return new H.LngLatBounds(new H.LngLat(ve,Te),new H.LngLat(ge,Pe))}_getBoundsRectangular(U,Y){const{top:te,left:ne}=this._edgeInsets,ae=this.height-this._edgeInsets.bottom,he=this.width-this._edgeInsets.right,fe=new H.Point(ne,te),de=new H.Point(he,te),ve=new H.Point(he,ae),ge=new H.Point(ne,ae);let Te=this.pointCoordinate(fe,U),Pe=this.pointCoordinate(de,U);const Le=this.pointCoordinate(ve,Y),ke=this.pointCoordinate(ge,Y),Be=(Ne,Se)=>(Se.y-Ne.y)/(Se.x-Ne.x);return Te.y>1&&Pe.y>=0?Te=new H.MercatorCoordinate((1-ke.y)/Be(ke,Te)+ke.x,1):Te.y<0&&Pe.y<=1&&(Te=new H.MercatorCoordinate(-ke.y/Be(ke,Te)+ke.x,0)),Pe.y>1&&Te.y>=0?Pe=new H.MercatorCoordinate((1-Le.y)/Be(Le,Pe)+Le.x,1):Pe.y<0&&Te.y<=1&&(Pe=new H.MercatorCoordinate(-Le.y/Be(Le,Pe)+Le.x,0)),new H.LngLatBounds().extend(this.coordinateLocation(Te)).extend(this.coordinateLocation(Pe)).extend(this.coordinateLocation(ke)).extend(this.coordinateLocation(Le))}_getBoundsRectangularTerrain(){const U=this.elevation;if(!U.visibleDemTiles.length||U.isUsingMockSource())return this._getBoundsRectangular(0,0);const Y=U.visibleDemTiles.reduce((te,ne)=>{if(ne.dem){const ae=ne.dem.tree;te.min=Math.min(te.min,ae.minimums[0]),te.max=Math.max(te.max,ae.maximums[0])}return te},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(Y.min*U.exaggeration(),Y.max*U.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(U=!0){const Y=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,te=this.height/2-Y*(1-this._horizonShift);return U?Math.max(0,te):te}getMaxBounds(){return this.maxBounds}setMaxBounds(U){this.maxBounds=U,this.minLat=-H.MAX_MERCATOR_LATITUDE,this.maxLat=H.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,U&&(this.minLat=U.getSouth(),this.maxLat=U.getNorth(),this.minLng=U.getWest(),this.maxLng=U.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=H.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=H.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=H.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=H.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(U,Y){return this.projection.createTileMatrix(this,Y,U)}calculateDistanceTileData(U){const Y=U.key,te=this._distanceTileDataCache;if(te[Y])return te[Y];const ne=U.canonical,ae=1/this.height,he=this.cameraWorldSize,fe=he/this.zoomScale(ne.z),de=(ne.x+Math.pow(2,ne.z)*U.wrap)*fe,ve=ne.y*fe,ge=this.point;ge.x*=he/this.worldSize,ge.y*=he/this.worldSize;const Te=this.angle,Pe=Math.sin(-Te),Le=-Math.cos(-Te);return te[Y]={bearing:[Pe,Le],center:[(ge.x-de)*ae,(ge.y-ve)*ae],scale:fe/H.EXTENT*ae},te[Y]}calculateFogTileMatrix(U){const Y=U.key,te=this._fogTileMatrixCache;if(te[Y])return te[Y];const ne=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,U);return H.multiply(ne,this.worldToFogMatrix,ne),te[Y]=new Float32Array(ne),te[Y]}calculateProjMatrix(U,Y=!1){const te=U.key,ne=Y?this._alignedProjMatrixCache:this._projMatrixCache;if(ne[te])return ne[te];const ae=this.calculatePosMatrix(U,this.worldSize);return H.multiply(ae,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:Y?this.alignedProjMatrix:this.projMatrix,ae),ne[te]=new Float32Array(ae),ne[te]}calculatePixelsToTileUnitsMatrix(U){const Y=U.tileID.key,te=this._pixelsToTileUnitsCache;if(te[Y])return te[Y];const ne=function(ae,he){const{scale:fe}=ae.tileTransform,de=fe*H.EXTENT/(ae.tileSize*Math.pow(2,he.zoom-ae.tileID.overscaledZ+ae.tileID.canonical.z));return ve=new Float32Array(4),Pe=(ge=he.inverseAdjustmentMatrix)[1],Le=ge[2],ke=ge[3],Ne=(Te=[de,de])[1],ve[0]=ge[0]*(Be=Te[0]),ve[1]=Pe*Be,ve[2]=Le*Ne,ve[3]=ke*Ne,ve;var ve,ge,Te,Pe,Le,ke,Be,Ne}(U,this);return te[Y]=ne,te[Y]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const U=1/this.worldSize,Y=H.fromScaling([],[U,U,U]);return H.multiply(Y,Y,this.globeMatrix),Y}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const U=this._elevation;this._updateCameraState();const Y=H.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,te=this._computeCameraPosition(Y),ne=this._camera.forward(),ae=H.mercatorZfromAltitude(1,this._center.lat);te[2]/=ae,ne[2]/=ae,H.normalize(ne,ne);const he=U.raycast(te,ne,U.exaggeration());if(he){const fe=H.scaleAndAdd([],te,ne,he),de=new H.MercatorCoordinate(fe[0],fe[1],H.mercatorZfromAltitude(fe[2],H.latFromMercatorY(fe[1]))),ve=(de.z+H.length([de.x-te[0],de.y-te[1],de.z-te[2]*ae]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(ve),this._centerAltitude=de.toAltitude(),this._center=this.coordinateLocation(de),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(U=!1){if(!this._elevation)return;const Y=this._elevation,te=H.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,ne=this._computeCameraPosition(te),ae=Y.getAtPointOrZero(new H.MercatorCoordinate(...ne)),he=this.pixelsPerMeter/this.worldSize*ae,fe=this._minimumHeightOverTerrain(),de=ne[2]-he;if(de<=fe)if(de<0||U){const ve=this.locationCoordinate(this._center,this._centerAltitude),ge=[ne[0],ne[1],ve.z-ne[2]],Te=H.length(ge);ge[2]-=(fe-de)/this._pixelsPerMercatorPixel;const Pe=H.length(ge);if(Pe===0)return;H.scale$2(ge,ge,Te/Pe*this._pixelsPerMercatorPixel),this._camera.position=[ne[0],ne[1],ve.z*this._pixelsPerMercatorPixel-ge[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const U=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||U){const Pe=this.center;return Pe.lat=H.clamp(Pe.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!U)&&(Pe.lng=H.clamp(Pe.lng,this.minLng,this.maxLng)),this.center=Pe,void(this._constraining=!1)}const Y=this._unmodified,{x:te,y:ne}=this.point;let ae=0,he=te,fe=ne;const de=this.width/2,ve=this.height/2,ge=this.worldMinY*this.scale,Te=this.worldMaxY*this.scale;if(ne-ve<ge&&(fe=ge+ve),ne+ve>Te&&(fe=Te-ve),Te-ge<this.height&&(ae=Math.max(ae,this.height/(Te-ge)),fe=(Te+ge)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Pe=this.worldMinX*this.scale,Le=this.worldMaxX*this.scale,ke=this.worldSize/2-(Pe+Le)/2;he=(te+ke+this.worldSize)%this.worldSize-ke,he-de<Pe&&(he=Pe+de),he+de>Le&&(he=Le-de),Le-Pe<this.width&&(ae=Math.max(ae,this.width/(Le-Pe)),he=(Le+Pe)/2)}he===te&&fe===ne||(this.center=this.unproject(new H.Point(he,fe))),ae&&(this.zoom+=this.scaleZoom(ae)),this._constrainCamera(),this._unmodified=Y,this._constraining=!1}_minZoomForBounds(){let U=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(U=Math.max(U,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),U}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const U=this.centerOffset,Y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=H.mercatorZfromAltitude(1,this.center.lat)/H.mercatorZfromAltitude(1,H.GLOBE_SCALE_MATCH_LATITUDE));const te=Ns(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,te),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const ne=this.projection.zAxisUnit==="meters"?Y:1,ae=this._camera.getWorldToCamera(this.worldSize,ne),he=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);he[8]=2*-U.x/this.width,he[9]=2*U.y/this.height;let fe=H.mul([],he,ae);if(this.projection.isReprojectedInTileSpace){const tt=this.locationCoordinate(this.center),et=H.identity([]);H.translate(et,et,[tt.x*this.worldSize,tt.y*this.worldSize,0]),H.multiply(et,et,ha(this)),H.translate(et,et,[-tt.x*this.worldSize,-tt.y*this.worldSize,0]),H.multiply(fe,fe,et),this.inverseAdjustmentMatrix=function(at){const nt=ha(at,!0);return zt([],[nt[0],nt[1],nt[4],nt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=H.scale([],fe,[this.worldSize,this.worldSize,this.worldSize/ne,1]),this.projMatrix=fe,this.invProjMatrix=H.invert(new Float64Array(16),this.projMatrix);const de=H.invert([],he);this.frustumCorners=H.FrustumCorners.fromInvProjectionMatrix(de,this.horizonLineFromTop(),this.height);const ve=new Float32Array(16);H.identity(ve),H.scale(ve,ve,[1,-1,1]),H.rotateX(ve,ve,this._pitch),H.rotateZ(ve,ve,this.angle);const ge=H.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),Te=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ge[8]=2*-U.x/this.width,ge[9]=2*(U.y+Te)/this.height,this.skyboxMatrix=H.multiply(ve,ge,ve);const Pe=this.point,Le=Pe.x,ke=Pe.y,Be=this.width%2/2,Ne=this.height%2/2,Se=Math.cos(this.angle),De=Math.sin(this.angle),Ve=Le-Math.round(Le)+Se*Be+De*Ne,Ge=ke-Math.round(ke)+Se*Ne+De*Be,Qe=new Float64Array(fe);if(H.translate(Qe,Qe,[Ve>.5?Ve-1:Ve,Ge>.5?Ge-1:Ge,0]),this.alignedProjMatrix=Qe,fe=H.create(),H.scale(fe,fe,[this.width/2,-this.height/2,1]),H.translate(fe,fe,[1,-1,0]),this.labelPlaneMatrix=fe,fe=H.create(),H.scale(fe,fe,[1,-1,1]),H.translate(fe,fe,[-1,-1,0]),H.scale(fe,fe,[2/this.width,2/this.height,1]),this.glCoordMatrix=fe,this.pixelMatrix=H.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},fe=H.invert(new Float64Array(16),this.pixelMatrix),!fe)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=fe,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=H.calculateGlobeMatrix(this);const tt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=H.transformMat4(tt,tt,ae),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=fe;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const U=this.cameraWorldSizeForFog,Y=this.cameraPixelsPerMeter,te=this._camera.position,ne=1/this.height/this._pixelsPerMercatorPixel,ae=[U,U,Y];H.scale$2(ae,ae,ne),H.scale$2(te,te,-1),H.multiply$2(te,te,ae);const he=H.create();H.translate(he,he,te),H.scale(he,he,ae),this.mercatorFogMatrix=he,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(U,Y,ne)}_computeCameraPosition(U){const Y=(U=U||this.pixelsPerMeter)/this.pixelsPerMeter,te=this._camera.forward(),ne=this.point,ae=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*Y-U/this.worldSize*this._centerAltitude;return[ne.x/this.worldSize-te[0]*ae,ne.y/this.worldSize-te[1]*ae,U/this.worldSize*this._centerAltitude-te[2]*ae]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(U){const Y=this._maxCameraBoundsDistance()*Math.cos(this._pitch),te=this._camera.position[2],ne=U[2];let ae=1;this.projection.wrap&&(this.center=this.center.wrap()),ne>0&&(ae=Math.min((Y-te)/ne,1)),this._camera.position=H.scaleAndAdd([],this._camera.position,U,ae),this._updateStateFromCamera()}_updateStateFromCamera(){const U=this._camera.position,Y=this._camera.forward(),{pitch:te,bearing:ne}=this._camera.getPitchBearing(),ae=H.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,he=this._mercatorZfromZoom(this._maxZoom)*Math.cos(H.degToRad(this._maxPitch)),fe=Math.max((U[2]-ae)/Math.cos(te),he),de=this._zoomFromMercatorZ(fe);H.scaleAndAdd(U,U,Y,fe),this._pitch=H.clamp(te,H.degToRad(this.minPitch),H.degToRad(this.maxPitch)),this.angle=H.wrap(ne,-Math.PI,Math.PI),this._setZoom(H.clamp(de,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new H.MercatorCoordinate(U[0],U[1],U[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(U){return Math.pow(2,U)*this.tileSize}_mercatorZfromZoom(U){return this.cameraToCenterDistance/this._worldSizeFromZoom(U)}_minimumHeightOverTerrain(){const U=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(U)}_zoomFromMercatorZ(U){return this.scaleZoom(this.cameraToCenterDistance/(U*this.tileSize))}zoomFromMercatorZAdjusted(U){let Y=0,te=H.GLOBE_ZOOM_THRESHOLD_MAX,ne=0,ae=1/0;for(;te-Y>1e-6&&te>Y;){const he=Y+.5*(te-Y),fe=this.tileSize*Math.pow(2,he),de=this.getCameraToCenterDistance(this.projection,he,fe),ve=this.scaleZoom(de/(U*this.tileSize)),ge=Math.abs(he-ve);ge<ae&&(ae=ge,ne=he),he<ve?Y=he:te=he}return ne}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(H.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(U,Y){const te=Math.min(U.x,Y.x),ne=Math.max(U.x,Y.x),ae=Math.min(U.y,Y.y),he=Math.max(U.y,Y.y);if(ae<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const fe=[new H.Point(te,ae),new H.Point(ne,he),new H.Point(te,he),new H.Point(ne,ae)],de=this.renderWorldCopies?-3:0,ve=this.renderWorldCopies?4:1;for(const ge of fe){const Te=this.pointRayIntersection(ge);if(Te.t<0)return!0;const Pe=this.rayIntersectionCoordinate(Te);if(Pe.x<de||Pe.y<0||Pe.x>ve||Pe.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+H.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new H.Point(0,0),new H.Point(this.width,this.height))}zoomDeltaToMovement(U,Y){const te=H.length(H.sub([],this._camera.position,U)),ne=this._zoomFromMercatorZ(te)+Y;return te-this._mercatorZfromZoom(ne)}getCameraPoint(){if(this.projection.name==="globe"){const U=function([Y,te,ne],ae){const he=[Y,te,ne,1];H.transformMat4$1(he,he,ae);const fe=he[3]=Math.max(he[3],1e-6);return he[0]/=fe,he[1]/=fe,he[2]/=fe,he}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new H.Point(U[0],U[1])}{const U=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new H.Point(0,U))}}getCameraToCenterDistance(U,Y=this.zoom,te=this.worldSize){const ne=Ns(U,Y,this.width,this.height,1024),ae=U.pixelSpaceConversion(this.center.lat,te,ne);return .5/Math.tan(.5*this._fov)*this.height*ae}getWorldToCameraMatrix(){const U=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&H.multiply(U,U,this.globeMatrix),U}}function pa(Q,U){let Y=!1,te=null;const ne=()=>{te=null,Y&&(Q(),te=setTimeout(ne,U),Y=!1)};return()=>(Y=!0,te||ne(),te)}class Zl{constructor(U){this._hashName=U&&encodeURIComponent(U),H.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=pa(this._updateHashUnthrottled.bind(this),300)}addTo(U){return this._map=U,H.window.addEventListener("hashchange",this._onHashChange,!1),U.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),H.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const U=this._map;if(!U)return"";const Y=Ka(U);if(this._hashName){const te=this._hashName;let ne=!1;const ae=H.window.location.hash.slice(1).split("&").map(he=>{const fe=he.split("=")[0];return fe===te?(ne=!0,`${fe}=${Y}`):he}).filter(he=>he);return ne||ae.push(`${te}=${Y}`),`#${ae.join("&")}`}return`#${Y}`}_getCurrentHash(){const U=H.window.location.hash.replace("#","");if(this._hashName){let Y;return U.split("&").map(te=>te.split("=")).forEach(te=>{te[0]===this._hashName&&(Y=te)}),(Y&&Y[1]||"").split("/")}return U.split("/")}_onHashChange(){const U=this._map;if(!U)return!1;const Y=this._getCurrentHash();if(Y.length>=3&&!Y.some(te=>isNaN(te))){const te=U.dragRotate.isEnabled()&&U.touchZoomRotate.isEnabled()?+(Y[3]||0):U.getBearing();return U.jumpTo({center:[+Y[2],+Y[1]],zoom:+Y[0],bearing:te,pitch:+(Y[4]||0)}),!0}return!1}_updateHashUnthrottled(){const U=H.window.location.href.replace(/(#.+)?$/,this.getHashString());H.window.history.replaceState(H.window.history.state,null,U)}}function Ka(Q,U){const Y=Q.getCenter(),te=Math.round(100*Q.getZoom())/100,ne=Math.ceil((te*Math.LN2+Math.log(512/360/.5))/Math.LN10),ae=Math.pow(10,ne),he=Math.round(Y.lng*ae)/ae,fe=Math.round(Y.lat*ae)/ae,de=Q.getBearing(),ve=Q.getPitch();let ge=U?`/${he}/${fe}/${te}`:`${te}/${fe}/${he}`;return(de||ve)&&(ge+="/"+Math.round(10*de)/10),ve&&(ge+=`/${Math.round(ve)}`),ge}const Za={linearity:.3,easing:H.bezier(0,0,.3,1)},zs=H.extend({deceleration:2500,maxSpeed:1400},Za),Us=H.extend({deceleration:20,maxSpeed:1400},Za),er=H.extend({deceleration:1e3,maxSpeed:360},Za),Ln=H.extend({deceleration:1e3,maxSpeed:90},Za);class vu{constructor(U){this._map=U,this.clear()}clear(){this._inertiaBuffer=[]}record(U){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:H.exported.now(),settings:U})}_drainInertiaBuffer(){const U=this._inertiaBuffer,Y=H.exported.now();for(;U.length>0&&Y-U[0].time>160;)U.shift()}_onMoveEnd(U){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const Y={zoom:0,bearing:0,pitch:0,pan:new H.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:ae}of this._inertiaBuffer)Y.zoom+=ae.zoomDelta||0,Y.bearing+=ae.bearingDelta||0,Y.pitch+=ae.pitchDelta||0,ae.panDelta&&Y.pan._add(ae.panDelta),ae.around&&(Y.around=ae.around),ae.pinchAround&&(Y.pinchAround=ae.pinchAround);const te=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,ne={};if(Y.pan.mag()){const ae=Ya(Y.pan.mag(),te,H.extend({},zs,U||{}));ne.offset=Y.pan.mult(ae.amount/Y.pan.mag()),ne.center=this._map.transform.center,Xa(ne,ae)}if(Y.zoom){const ae=Ya(Y.zoom,te,Us);ne.zoom=this._map.transform.zoom+ae.amount,Xa(ne,ae)}if(Y.bearing){const ae=Ya(Y.bearing,te,er);ne.bearing=this._map.transform.bearing+H.clamp(ae.amount,-179,179),Xa(ne,ae)}if(Y.pitch){const ae=Ya(Y.pitch,te,Ln);ne.pitch=this._map.transform.pitch+ae.amount,Xa(ne,ae)}if(ne.zoom||ne.bearing){const ae=Y.pinchAround===void 0?Y.around:Y.pinchAround;ne.around=ae?this._map.unproject(ae):this._map.getCenter()}return this.clear(),ne.noMoveStart=!0,ne}}function Xa(Q,U){(!Q.duration||Q.duration<U.duration)&&(Q.duration=U.duration,Q.easing=U.easing)}function Ya(Q,U,Y){const{maxSpeed:te,linearity:ne,deceleration:ae}=Y,he=H.clamp(Q*ne/(U/1e3),-te,te),fe=Math.abs(he)/(ae*ne);return{easing:Y.easing,duration:1e3*fe,amount:he*(fe/2)}}class ji extends H.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(U,Y,te,ne={}){const ae=hr(Y.getCanvasContainer(),te),he=Y.unproject(ae);super(U,H.extend({point:ae,lngLat:he,originalEvent:te},ne)),this._defaultPrevented=!1,this.target=Y}}class Ja extends H.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(U,Y,te){const ne=U==="touchend"?te.changedTouches:te.touches,ae=Ir(Y.getCanvasContainer(),ne),he=ae.map(de=>Y.unproject(de)),fe=ae.reduce((de,ve,ge,Te)=>de.add(ve.div(Te.length)),new H.Point(0,0));super(U,{points:ae,point:fe,lngLats:he,lngLat:Y.unproject(fe),originalEvent:te}),this._defaultPrevented=!1}}class js extends H.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(U,Y,te){super(U,{originalEvent:te}),this._defaultPrevented=!1}}class Xl{constructor(U,Y){this._map=U,this._clickTolerance=Y.clickTolerance}reset(){this._mousedownPos=void 0}wheel(U){return this._firePreventable(new js(U.type,this._map,U))}mousedown(U,Y){return this._mousedownPos=Y,this._firePreventable(new ji(U.type,this._map,U))}mouseup(U){this._map.fire(new ji(U.type,this._map,U))}preclick(U){const Y=H.extend({},U);Y.type="preclick",this._map.fire(new ji(Y.type,this._map,Y))}click(U,Y){this._mousedownPos&&this._mousedownPos.dist(Y)>=this._clickTolerance||(this.preclick(U),this._map.fire(new ji(U.type,this._map,U)))}dblclick(U){return this._firePreventable(new ji(U.type,this._map,U))}mouseover(U){this._map.fire(new ji(U.type,this._map,U))}mouseout(U){this._map.fire(new ji(U.type,this._map,U))}touchstart(U){return this._firePreventable(new Ja(U.type,this._map,U))}touchmove(U){this._map.fire(new Ja(U.type,this._map,U))}touchend(U){this._map.fire(new Ja(U.type,this._map,U))}touchcancel(U){this._map.fire(new Ja(U.type,this._map,U))}_firePreventable(U){if(this._map.fire(U),U.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vs{constructor(U){this._map=U}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(U){this._map.fire(new ji(U.type,this._map,U))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ji("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(U){this._delayContextMenu?this._contextMenuEvent=U:this._map.fire(new ji(U.type,this._map,U)),this._map.listens("contextmenu")&&U.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $u{constructor(U,Y){this._map=U,this._el=U.getCanvasContainer(),this._container=U.getContainer(),this._clickTolerance=Y.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(U,Y){this.isEnabled()&&U.shiftKey&&U.button===0&&(jt(),this._startPos=this._lastPos=Y,this._active=!0)}mousemoveWindow(U,Y){if(!this._active)return;const te=Y,ne=this._startPos,ae=this._lastPos;if(!ne||!ae||ae.equals(te)||!this._box&&te.dist(ne)<this._clickTolerance)return;this._lastPos=te,this._box||(this._box=je("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",U));const he=Math.min(ne.x,te.x),fe=Math.max(ne.x,te.x),de=Math.min(ne.y,te.y),ve=Math.max(ne.y,te.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${he}px,${de}px)`,this._box.style.width=fe-he+"px",this._box.style.height=ve-de+"px")})}mouseupWindow(U,Y){if(!this._active)return;const te=this._startPos,ne=Y;if(te&&U.button===0){if(this.reset(),gr(),te.x!==ne.x||te.y!==ne.y)return this._map.fire(new H.Event("boxzoomend",{originalEvent:U})),{cameraAnimation:ae=>ae.fitScreenCoordinates(te,ne,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",U)}}keydown(U){this._active&&U.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",U))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),nr(),delete this._startPos,delete this._lastPos}_fireEvent(U,Y){return this._map.fire(new H.Event(U,{originalEvent:Y}))}}function Gs(Q,U){const Y={};for(let te=0;te<Q.length;te++)Y[Q[te].identifier]=U[te];return Y}class da{constructor(U){this.reset(),this.numTouches=U.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(U,Y,te){(this.centroid||te.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=U.timeStamp),te.length===this.numTouches&&(this.centroid=function(ne){const ae=new H.Point(0,0);for(const he of ne)ae._add(he);return ae.div(ne.length)}(Y),this.touches=Gs(te,Y)))}touchmove(U,Y,te){if(this.aborted||!this.centroid)return;const ne=Gs(te,Y);for(const ae in this.touches){const he=ne[ae];(!he||he.dist(this.touches[ae])>30)&&(this.aborted=!0)}}touchend(U,Y,te){if((!this.centroid||U.timeStamp-this.startTime>500)&&(this.aborted=!0),te.length===0){const ne=!this.aborted&&this.centroid;if(this.reset(),ne)return ne}}}class Yl{constructor(U){this.singleTap=new da(U),this.numTaps=U.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(U,Y,te){this.singleTap.touchstart(U,Y,te)}touchmove(U,Y,te){this.singleTap.touchmove(U,Y,te)}touchend(U,Y,te){const ne=this.singleTap.touchend(U,Y,te);if(ne){const ae=U.timeStamp-this.lastTime<500,he=!this.lastTap||this.lastTap.dist(ne)<30;if(ae&&he||this.reset(),this.count++,this.lastTime=U.timeStamp,this.lastTap=ne,this.count===this.numTaps)return this.reset(),ne}}}class Rh{constructor(){this._zoomIn=new Yl({numTouches:1,numTaps:2}),this._zoomOut=new Yl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(U,Y,te){this._zoomIn.touchstart(U,Y,te),this._zoomOut.touchstart(U,Y,te)}touchmove(U,Y,te){this._zoomIn.touchmove(U,Y,te),this._zoomOut.touchmove(U,Y,te)}touchend(U,Y,te){const ne=this._zoomIn.touchend(U,Y,te),ae=this._zoomOut.touchend(U,Y,te);return ne?(this._active=!0,U.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:he=>he.easeTo({duration:300,zoom:he.getZoom()+1,around:he.unproject(ne)},{originalEvent:U})}):ae?(this._active=!0,U.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:he=>he.easeTo({duration:300,zoom:he.getZoom()-1,around:he.unproject(ae)},{originalEvent:U})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xu={0:1,2:2};class ma{constructor(U){this.reset(),this._clickTolerance=U.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(U,Y){return!1}_move(U,Y){return{}}mousedown(U,Y){if(this._lastPoint)return;const te=br(U);this._correctButton(U,te)&&(this._lastPoint=Y,this._eventButton=te)}mousemoveWindow(U,Y){const te=this._lastPoint;if(te){if(U.preventDefault(),this._eventButton!=null&&function(ne,ae){const he=xu[ae];return ne.buttons===void 0||(ne.buttons&he)!==he}(U,this._eventButton))this.reset();else if(this._moved||!(Y.dist(te)<this._clickTolerance))return this._moved=!0,this._lastPoint=Y,this._move(te,Y)}}mouseupWindow(U){this._lastPoint&&br(U)===this._eventButton&&(this._moved&&gr(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jl extends ma{mousedown(U,Y){super.mousedown(U,Y),this._lastPoint&&(this._active=!0)}_correctButton(U,Y){return Y===0&&!U.ctrlKey}_move(U,Y){return{around:Y,panDelta:Y.sub(U)}}}class Ql extends ma{_correctButton(U,Y){return Y===0&&U.ctrlKey||Y===2}_move(U,Y){const te=.8*(Y.x-U.x);if(te)return this._active=!0,{bearingDelta:te}}contextmenu(U){U.preventDefault()}}class ec extends ma{_correctButton(U,Y){return Y===0&&U.ctrlKey||Y===2}_move(U,Y){const te=-.5*(Y.y-U.y);if(te)return this._active=!0,{pitchDelta:te}}contextmenu(U){U.preventDefault()}}class Ws{constructor(U,Y){this._map=U,this._el=U.getCanvasContainer(),this._minTouches=1,this._clickTolerance=Y.clickTolerance||1,this.reset(),H.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new H.Point(0,0)}touchstart(U,Y,te){return this._calculateTransform(U,Y,te)}touchmove(U,Y,te){if(this._active&&!(te.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(te.length===1&&!H.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return U.cancelable&&U.preventDefault(),this._calculateTransform(U,Y,te)}}touchend(U,Y,te){this._calculateTransform(U,Y,te),this._active&&te.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(U,Y,te){te.length>0&&(this._active=!0);const ne=Gs(te,Y),ae=new H.Point(0,0),he=new H.Point(0,0);let fe=0;for(const ve in ne){const ge=ne[ve],Te=this._touches[ve];Te&&(ae._add(ge),he._add(ge.sub(Te)),fe++,ne[ve]=ge)}if(this._touches=ne,fe<this._minTouches||!he.mag())return;const de=he.div(fe);return this._sum._add(de),this._sum.mag()<this._clickTolerance?void 0:{around:ae.div(fe),panDelta:de}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=je("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Qa{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(U){}_move(U,Y,te){return{}}touchstart(U,Y,te){this._firstTwoTouches||te.length<2||(this._firstTwoTouches=[te[0].identifier,te[1].identifier],this._start([Y[0],Y[1]]))}touchmove(U,Y,te){const ne=this._firstTwoTouches;if(!ne)return;U.preventDefault();const[ae,he]=ne,fe=es(te,Y,ae),de=es(te,Y,he);if(!fe||!de)return;const ve=this._aroundCenter?null:fe.add(de).div(2);return this._move([fe,de],ve,U)}touchend(U,Y,te){if(!this._firstTwoTouches)return;const[ne,ae]=this._firstTwoTouches,he=es(te,Y,ne),fe=es(te,Y,ae);he&&fe||(this._active&&gr(),this.reset())}touchcancel(){this.reset()}enable(U){this._enabled=!0,this._aroundCenter=!!U&&U.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function es(Q,U,Y){for(let te=0;te<Q.length;te++)if(Q[te].identifier===Y)return U[te]}function tc(Q,U){return Math.log(Q/U)/Math.LN2}class bu extends Qa{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(U){this._startDistance=this._distance=U[0].dist(U[1])}_move(U,Y){const te=this._distance;if(this._distance=U[0].dist(U[1]),this._active||!(Math.abs(tc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tc(this._distance,te),pinchAround:Y}}}function rc(Q,U){return 180*Q.angleWith(U)/Math.PI}class wu extends Qa{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(U){this._startVector=this._vector=U[0].sub(U[1]),this._minDiameter=U[0].dist(U[1])}_move(U,Y){const te=this._vector;if(this._vector=U[0].sub(U[1]),te&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:rc(this._vector,te),pinchAround:Y}}_isBelowThreshold(U){this._minDiameter=Math.min(this._minDiameter,U.mag());const Y=25/(Math.PI*this._minDiameter)*360,te=this._startVector;if(!te)return!1;const ne=rc(U,te);return Math.abs(ne)<Y}}function bo(Q){return Math.abs(Q.y)>Math.abs(Q.x)}class Eu extends Qa{constructor(U){super(),this._map=U}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(U){this._lastPoints=U,bo(U[0].sub(U[1]))&&(this._valid=!1)}_move(U,Y,te){const ne=this._lastPoints;if(!ne)return;const ae=U[0].sub(ne[0]),he=U[1].sub(ne[1]);return this._map._cooperativeGestures&&!H.isFullscreen()&&te.touches.length<3||(this._valid=this.gestureBeginsVertically(ae,he,te.timeStamp),!this._valid)?void 0:(this._lastPoints=U,this._active=!0,{pitchDelta:(ae.y+he.y)/2*-.5})}gestureBeginsVertically(U,Y,te){if(this._valid!==void 0)return this._valid;const ne=U.mag()>=2,ae=Y.mag()>=2;if(!ne&&!ae)return;if(!ne||!ae)return this._firstMove==null&&(this._firstMove=te),te-this._firstMove<100&&void 0;const he=U.y>0==Y.y>0;return bo(U)&&bo(Y)&&he}}const Tu={panStep:100,bearingStep:15,pitchStep:10};class Mh{constructor(){const U=Tu;this._panStep=U.panStep,this._bearingStep=U.bearingStep,this._pitchStep=U.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(U){if(U.altKey||U.ctrlKey||U.metaKey)return;let Y=0,te=0,ne=0,ae=0,he=0;switch(U.keyCode){case 61:case 107:case 171:case 187:Y=1;break;case 189:case 109:case 173:Y=-1;break;case 37:U.shiftKey?te=-1:(U.preventDefault(),ae=-1);break;case 39:U.shiftKey?te=1:(U.preventDefault(),ae=1);break;case 38:U.shiftKey?ne=1:(U.preventDefault(),he=-1);break;case 40:U.shiftKey?ne=-1:(U.preventDefault(),he=1);break;default:return}return this._rotationDisabled&&(te=0,ne=0),{cameraAnimation:fe=>{const de=fe.getZoom();fe.easeTo({duration:300,easeId:"keyboardHandler",easing:Su,zoom:Y?Math.round(de)+Y*(U.shiftKey?2:1):de,bearing:fe.getBearing()+te*this._bearingStep,pitch:fe.getPitch()+ne*this._pitchStep,offset:[-ae*this._panStep,-he*this._panStep],center:fe.getCenter()},{originalEvent:U})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Su(Q){return Q*(2-Q)}const ic=4.000244140625;class Iu{constructor(U,Y){this._map=U,this._el=U.getCanvasContainer(),this._handler=Y,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,H.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(U){this._defaultZoomRate=U}setWheelZoomRate(U){this._wheelZoomRate=U}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(U){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!U&&U.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(U){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(U.ctrlKey||U.metaKey||this.isZooming()||H.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let Y=U.deltaMode===H.window.WheelEvent.DOM_DELTA_LINE?40*U.deltaY:U.deltaY;const te=H.exported.now(),ne=te-(this._lastWheelEventTime||0);this._lastWheelEventTime=te,Y!==0&&Y%ic==0?this._type="wheel":Y!==0&&Math.abs(Y)<4?this._type="trackpad":ne>400?(this._type=null,this._lastValue=Y,this._timeout=setTimeout(this._onTimeout,40,U)):this._type||(this._type=Math.abs(ne*Y)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,Y+=this._lastValue)),U.shiftKey&&Y&&(Y/=4),this._type&&(this._lastWheelEvent=U,this._delta-=Y,this._active||this._start(U)),U.preventDefault()}_onTimeout(U){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(U)}_start(U){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const Y=hr(this._el,U);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:Y,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const U=this._map.transform;this._type==="wheel"&&U.projection.wrap&&(U._center.lng>=180||U._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const Y=()=>U._terrainEnabled()&&this._aroundCoord?U.computeZoomRelativeTo(this._aroundCoord):U.zoom;if(this._delta!==0){const de=this._type==="wheel"&&Math.abs(this._delta)>ic?this._wheelZoomRate:this._defaultZoomRate;let ve=2/(1+Math.exp(-Math.abs(this._delta*de)));this._delta<0&&ve!==0&&(ve=1/ve);const ge=Y(),Te=Math.pow(2,ge),Pe=typeof this._targetZoom=="number"?U.zoomScale(this._targetZoom):Te;this._targetZoom=Math.min(U.maxZoom,Math.max(U.minZoom,U.scaleZoom(Pe*ve))),this._type==="wheel"&&(this._startZoom=ge,this._easing=this._smoothOutEasing(200)),this._delta=0}const te=typeof this._targetZoom=="number"?this._targetZoom:Y(),ne=this._startZoom,ae=this._easing;let he,fe=!1;if(this._type==="wheel"&&ne&&ae){const de=Math.min((H.exported.now()-this._lastWheelEventTime)/200,1),ve=ae(de);he=H.number(ne,te,ve),de<1?this._frameId||(this._frameId=!0):fe=!0}else he=te,fe=!0;return this._active=!0,fe&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!fe,zoomDelta:he-Y(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(U){let Y=H.ease;if(this._prevEase){const te=this._prevEase,ne=(H.exported.now()-te.start)/te.duration,ae=te.easing(ne+.01)-te.easing(ne),he=.27/Math.sqrt(ae*ae+1e-4)*.01,fe=Math.sqrt(.0729-he*he);Y=H.bezier(he,fe,.25,1)}return this._prevEase={start:H.exported.now(),duration:U,easing:Y},Y}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=je("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(H.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Au{constructor(U,Y){this._clickZoom=U,this._tapZoom=Y}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class rn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(U,Y){return U.preventDefault(),{cameraAnimation:te=>{te.easeTo({duration:300,zoom:te.getZoom()+(U.shiftKey?-1:1),around:te.unproject(Y)},{originalEvent:U})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dh{constructor(){this._tap=new Yl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(U,Y,te){this._swipePoint||(this._tapTime&&U.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?te.length>0&&(this._swipePoint=Y[0],this._swipeTouch=te[0].identifier):this._tap.touchstart(U,Y,te))}touchmove(U,Y,te){if(this._tapTime){if(this._swipePoint){if(te[0].identifier!==this._swipeTouch)return;const ne=Y[0],ae=ne.y-this._swipePoint.y;return this._swipePoint=ne,U.preventDefault(),this._active=!0,{zoomDelta:ae/128}}}else this._tap.touchmove(U,Y,te)}touchend(U,Y,te){this._tapTime?this._swipePoint&&te.length===0&&this.reset():this._tap.touchend(U,Y,te)&&(this._tapTime=U.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ou{constructor(U,Y,te){this._el=U,this._mousePan=Y,this._touchPan=te}enable(U){this._inertiaOptions=U||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Lh{constructor(U,Y,te){this._pitchWithRotate=U.pitchWithRotate,this._mouseRotate=Y,this._mousePitch=te}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Bh{constructor(U,Y,te,ne){this._el=U,this._touchZoom=Y,this._touchRotate=te,this._tapDragZoom=ne,this._rotationDisabled=!1,this._enabled=!0}enable(U){this._touchZoom.enable(U),this._rotationDisabled||this._touchRotate.enable(U),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const In=Q=>Q.zoom||Q.drag||Q.pitch||Q.rotate;class Cu extends H.Event{}class kh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(U,Y){const te=H.sub([],Y,U);this.radius=H.length(te[2]<0?H.div([],te,this.constants):[te[0],te[1],0])}projectRay(U){H.div(U,U,this.constants),H.normalize(U,U),H.mul$1(U,U,this.constants);const Y=H.scale$2([],U,this.radius);if(Y[2]>0){const te=H.scale$2([],[0,0,1],H.dot(Y,[0,0,1])),ne=H.scale$2([],H.normalize([],[Y[0],Y[1],0]),this.radius),ae=H.add([],Y,H.scale$2([],H.sub([],H.add([],ne,te),Y),2));Y[0]=ae[0],Y[1]=ae[1]}return Y}}function Bn(Q){return Q.panDelta&&Q.panDelta.mag()||Q.zoomDelta||Q.bearingDelta||Q.pitchDelta}class Hn{constructor(U,Y){this._map=U,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vu(U),this._bearingSnap=Y.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new kh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(Y),H.bindAll(["handleEvent","handleWindowEvent"],this);const te=this._el;this._listeners=[[te,"touchstart",{passive:!0}],[te,"touchmove",{passive:!1}],[te,"touchend",void 0],[te,"touchcancel",void 0],[te,"mousedown",void 0],[te,"mousemove",void 0],[te,"mouseup",void 0],[H.window.document,"mousemove",{capture:!0}],[H.window.document,"mouseup",void 0],[te,"mouseover",void 0],[te,"mouseout",void 0],[te,"dblclick",void 0],[te,"click",void 0],[te,"keydown",{capture:!1}],[te,"keyup",void 0],[te,"wheel",{passive:!1}],[te,"contextmenu",void 0],[H.window,"blur",void 0]];for(const[ne,ae,he]of this._listeners)ne.addEventListener(ae,ne===H.window.document?this.handleWindowEvent:this.handleEvent,he)}destroy(){for(const[U,Y,te]of this._listeners)U.removeEventListener(Y,U===H.window.document?this.handleWindowEvent:this.handleEvent,te)}_addDefaultHandlers(U){const Y=this._map,te=Y.getCanvasContainer();this._add("mapEvent",new Xl(Y,U));const ne=Y.boxZoom=new $u(Y,U);this._add("boxZoom",ne);const ae=new Rh,he=new rn;Y.doubleClickZoom=new Au(he,ae),this._add("tapZoom",ae),this._add("clickZoom",he);const fe=new Dh;this._add("tapDragZoom",fe);const de=Y.touchPitch=new Eu(Y);this._add("touchPitch",de);const ve=new Ql(U),ge=new ec(U);Y.dragRotate=new Lh(U,ve,ge),this._add("mouseRotate",ve,["mousePitch"]),this._add("mousePitch",ge,["mouseRotate"]);const Te=new Jl(U),Pe=new Ws(Y,U);Y.dragPan=new Ou(te,Te,Pe),this._add("mousePan",Te),this._add("touchPan",Pe,["touchZoom","touchRotate"]);const Le=new wu,ke=new bu;Y.touchZoomRotate=new Bh(te,ke,Le,fe),this._add("touchRotate",Le,["touchPan","touchZoom"]),this._add("touchZoom",ke,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Vs(Y));const Be=Y.scrollZoom=new Iu(Y,this);this._add("scrollZoom",Be,["mousePan"]);const Ne=Y.keyboard=new Mh;this._add("keyboard",Ne);for(const Se of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])U.interactive&&U[Se]&&Y[Se].enable(U[Se])}_add(U,Y,te){this._handlers.push({handlerName:U,handler:Y,allowed:te}),this._handlersById[U]=Y}stop(U){if(!this._updatingCamera){for(const{handler:Y}of this._handlers)Y.reset();this._inertia.clear(),this._fireEvents({},{},U),this._changes=[]}}isActive(){for(const{handler:U}of this._handlers)if(U.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!In(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(U,Y,te){for(const ne in U)if(ne!==te&&(!Y||Y.indexOf(ne)<0))return!0;return!1}handleWindowEvent(U){this.handleEvent(U,`${U.type}Window`)}_getMapTouches(U){const Y=[];for(const te of U)this._el.contains(te.target)&&Y.push(te);return Y}handleEvent(U,Y){this._updatingCamera=!0;const te=U.type==="renderFrame",ne=te?void 0:U,ae={needsRenderFrame:!1},he={},fe={},de=U.touches?this._getMapTouches(U.touches):void 0,ve=de?Ir(this._el,de):te?void 0:hr(this._el,U);for(const{handlerName:Pe,handler:Le,allowed:ke}of this._handlers){if(!Le.isEnabled())continue;let Be;this._blockedByActive(fe,ke,Pe)?Le.reset():Le[Y||U.type]&&(Be=Le[Y||U.type](U,ve,de),this.mergeHandlerResult(ae,he,Be,Pe,ne),Be&&Be.needsRenderFrame&&this._triggerRenderFrame()),(Be||Le.isActive())&&(fe[Pe]=Le)}const ge={};for(const Pe in this._previousActiveHandlers)fe[Pe]||(ge[Pe]=ne);this._previousActiveHandlers=fe,(Object.keys(ge).length||Bn(ae))&&(this._changes.push([ae,he,ge]),this._triggerRenderFrame()),(Object.keys(fe).length||Bn(ae))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Te}=ae;Te&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Te(this._map))}mergeHandlerResult(U,Y,te,ne,ae){if(!te)return;H.extend(U,te);const he={handlerName:ne,originalEvent:te.originalEvent||ae};te.zoomDelta!==void 0&&(Y.zoom=he),te.panDelta!==void 0&&(Y.drag=he),te.pitchDelta!==void 0&&(Y.pitch=he),te.bearingDelta!==void 0&&(Y.rotate=he)}_applyChanges(){const U={},Y={},te={};for(const[ne,ae,he]of this._changes)ne.panDelta&&(U.panDelta=(U.panDelta||new H.Point(0,0))._add(ne.panDelta)),ne.zoomDelta&&(U.zoomDelta=(U.zoomDelta||0)+ne.zoomDelta),ne.bearingDelta&&(U.bearingDelta=(U.bearingDelta||0)+ne.bearingDelta),ne.pitchDelta&&(U.pitchDelta=(U.pitchDelta||0)+ne.pitchDelta),ne.around!==void 0&&(U.around=ne.around),ne.aroundCoord!==void 0&&(U.aroundCoord=ne.aroundCoord),ne.pinchAround!==void 0&&(U.pinchAround=ne.pinchAround),ne.noInertia&&(U.noInertia=ne.noInertia),H.extend(Y,ae),H.extend(te,he);this._updateMapTransform(U,Y,te),this._changes=[]}_updateMapTransform(U,Y,te){const ne=this._map,ae=ne.transform,he=De=>[De.x,De.y,De.z];if((De=>{const Ve=this._eventsInProgress.drag;return Ve&&!this._handlersById[Ve.handlerName].isActive()})()&&!Bn(U)){const De=ae.zoom;ae.cameraElevationReference="sea",ae.recenterOnTerrain(),ae.cameraElevationReference="ground",De!==ae.zoom&&this._map._update(!0)}if(ae._isCameraConstrained&&ne._stop(!0),!Bn(U))return void this._fireEvents(Y,te,!0);let{panDelta:fe,zoomDelta:de,bearingDelta:ve,pitchDelta:ge,around:Te,aroundCoord:Pe,pinchAround:Le}=U;ae._isCameraConstrained&&(de>0&&(de=0),ae._isCameraConstrained=!1),Le!==void 0&&(Te=Le),(de||(De=>Y[De]&&!this._eventsInProgress[De])("drag"))&&Te&&(this._dragOrigin=he(ae.pointCoordinate3D(Te)),this._trackingEllipsoid.setup(ae._camera.position,this._dragOrigin)),ae.cameraElevationReference="sea",ne._stop(!0),Te=Te||ne.transform.centerPoint,ve&&(ae.bearing+=ve),ge&&(ae.pitch+=ge),ae._updateCameraState();const ke=[0,0,0];if(fe)if(ae.projection.name==="mercator"){const De=this._trackingEllipsoid.projectRay(ae.screenPointToMercatorRay(Te).dir),Ve=this._trackingEllipsoid.projectRay(ae.screenPointToMercatorRay(Te.sub(fe)).dir);ke[0]=Ve[0]-De[0],ke[1]=Ve[1]-De[1]}else{const De=ae.pointCoordinate(Te);if(ae.projection.name==="globe"){fe=fe.rotate(-ae.angle);const Ve=ae._pixelsPerMercatorPixel/ae.worldSize;ke[0]=-fe.x*H.mercatorScale(H.latFromMercatorY(De.y))*Ve,ke[1]=-fe.y*H.mercatorScale(ae.center.lat)*Ve}else{const Ve=ae.pointCoordinate(Te.sub(fe));De&&Ve&&(ke[0]=Ve.x-De.x,ke[1]=Ve.y-De.y)}}const Be=ae.zoom,Ne=[0,0,0];if(de){const De=he(Pe||ae.pointCoordinate3D(Te)),Ve={dir:H.normalize([],H.sub([],De,ae._camera.position))};if(Ve.dir[2]<0){const Ge=ae.zoomDeltaToMovement(De,de);H.scale$2(Ne,Ve.dir,Ge)}}const Se=H.add(ke,ke,Ne);ae._translateCameraConstrained(Se),de&&Math.abs(ae.zoom-Be)>1e-4&&ae.recenterOnTerrain(),ae.cameraElevationReference="ground",this._map._update(),U.noInertia||this._inertia.record(U),this._fireEvents(Y,te,!0)}_fireEvents(U,Y,te){const ne=In(this._eventsInProgress),ae=In(U),he={};for(const ge in U){const{originalEvent:Te}=U[ge];this._eventsInProgress[ge]||(he[`${ge}start`]=Te),this._eventsInProgress[ge]=U[ge]}!ne&&ae&&this._fireEvent("movestart",ae.originalEvent);for(const ge in he)this._fireEvent(ge,he[ge]);ae&&this._fireEvent("move",ae.originalEvent);for(const ge in U){const{originalEvent:Te}=U[ge];this._fireEvent(ge,Te)}const fe={};let de;for(const ge in this._eventsInProgress){const{handlerName:Te,originalEvent:Pe}=this._eventsInProgress[ge];this._handlersById[Te].isActive()||(delete this._eventsInProgress[ge],de=Y[Te]||Pe,fe[`${ge}end`]=de)}for(const ge in fe)this._fireEvent(ge,fe[ge]);const ve=In(this._eventsInProgress);if(te&&(ne||ae)&&!ve){this._updatingCamera=!0;const ge=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Te=Pe=>Pe!==0&&-this._bearingSnap<Pe&&Pe<this._bearingSnap;ge?(Te(ge.bearing||this._map.getBearing())&&(ge.bearing=0),this._map.easeTo(ge,{originalEvent:de})):(this._map.fire(new H.Event("moveend",{originalEvent:de})),Te(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(U,Y){this._map.fire(new H.Event(U,Y?{originalEvent:Y}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(U=>{this._frameId=void 0,this.handleEvent(new Cu("renderFrame",{timeStamp:U})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const zo="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qs extends H.Evented{constructor(U,Y){super(),this._moving=!1,this._zooming=!1,this.transform=U,this._bearingSnap=Y.bearingSnap,this._respectPrefersReducedMotion=Y.respectPrefersReducedMotion!==!1,H.bindAll(["_renderFrameCallback"],this)}getCenter(){return new H.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(U,Y){return this.jumpTo({center:U},Y)}panBy(U,Y,te){return U=H.Point.convert(U).mult(-1),this.panTo(this.transform.center,H.extend({offset:U},Y),te)}panTo(U,Y,te){return this.easeTo(H.extend({center:U},Y),te)}getZoom(){return this.transform.zoom}setZoom(U,Y){return this.jumpTo({zoom:U},Y),this}zoomTo(U,Y,te){return this.easeTo(H.extend({zoom:U},Y),te)}zoomIn(U,Y){return this.zoomTo(this.getZoom()+1,U,Y),this}zoomOut(U,Y){return this.zoomTo(this.getZoom()-1,U,Y),this}getBearing(){return this.transform.bearing}setBearing(U,Y){return this.jumpTo({bearing:U},Y),this}getPadding(){return this.transform.padding}setPadding(U,Y){return this.jumpTo({padding:U},Y),this}rotateTo(U,Y,te){return this.easeTo(H.extend({bearing:U},Y),te)}resetNorth(U,Y){return this.rotateTo(0,H.extend({duration:1e3},U),Y),this}resetNorthPitch(U,Y){return this.easeTo(H.extend({bearing:0,pitch:0,duration:1e3},U),Y),this}snapToNorth(U,Y){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(U,Y):this}getPitch(){return this.transform.pitch}setPitch(U,Y){return this.jumpTo({pitch:U},Y),this}cameraForBounds(U,Y){U=H.LngLatBounds.convert(U);const te=Y&&Y.bearing||0,ne=Y&&Y.pitch||0,ae=U.getNorthWest(),he=U.getSouthEast();return this._cameraForBounds(this.transform,ae,he,te,ne,Y)}_extendCameraOptions(U){const Y={top:0,bottom:0,right:0,left:0};if(typeof(U=H.extend({padding:Y,offset:[0,0],maxZoom:this.transform.maxZoom},U)).padding=="number"){const te=U.padding;U.padding={top:te,bottom:te,right:te,left:te}}return U.padding=H.extend(Y,U.padding),U}_minimumAABBFrustumDistance(U,Y){const te=Y.max[0]-Y.min[0],ne=Y.max[1]-Y.min[1];return te/ne>U.aspect?te/(2*Math.tan(.5*U.fovX)*U.aspect):ne/(2*Math.tan(.5*U.fovY)*U.aspect)}_cameraForBoundsOnGlobe(U,Y,te,ne,ae,he){const fe=U.clone(),de=this._extendCameraOptions(he);fe.bearing=ne,fe.pitch=ae;const ve=H.LngLat.convert(Y),ge=H.LngLat.convert(te),Te=.5*(ve.lat+ge.lat),Pe=.5*(ve.lng+ge.lng),Le=H.latLngToECEF(Te,Pe),ke=H.normalize([],Le),Be=H.normalize([],H.cross([],ke,[0,1,0])),Ne=H.cross([],Be,ke),Se=[Be[0],Be[1],Be[2],0,Ne[0],Ne[1],Ne[2],0,ke[0],ke[1],ke[2],0,0,0,0,1],De=[Le,H.latLngToECEF(ve.lat,ve.lng),H.latLngToECEF(ge.lat,ve.lng),H.latLngToECEF(ge.lat,ge.lng),H.latLngToECEF(ve.lat,ge.lng),H.latLngToECEF(Te,ve.lng),H.latLngToECEF(Te,ge.lng),H.latLngToECEF(ve.lat,Pe),H.latLngToECEF(ge.lat,Pe)];let Ve=H.Aabb.fromPoints(De.map(Mt=>[H.dot(Be,Mt),H.dot(Ne,Mt),H.dot(ke,Mt)]));const Ge=H.transformMat4([],Ve.center,Se);H.squaredLength(Ge)===0&&H.set(Ge,0,0,1),H.normalize(Ge,Ge),H.scale$2(Ge,Ge,H.GLOBE_RADIUS),fe.center=H.ecefToLatLng(Ge);const Qe=fe.getWorldToCameraMatrix(),tt=H.invert(new Float64Array(16),Qe);Ve=H.Aabb.applyTransform(Ve,H.multiply([],Qe,Se)),H.transformMat4(Ge,Ge,Qe);const et=.5*(Ve.max[2]-Ve.min[2]),at=this._minimumAABBFrustumDistance(fe,Ve),nt=H.scale$2([],[0,0,1],et),pt=H.add(nt,Ge,nt),kt=at+(fe.pitch===0?0:H.distance(Ge,pt)),ct=fe.globeCenterInViewSpace,At=H.sub([],Ge,[ct[0],ct[1],ct[2]]);H.normalize(At,At),H.scale$2(At,At,kt);const yt=H.add([],Ge,At);H.transformMat4(yt,yt,tt);const Bt=H.earthRadius/H.GLOBE_RADIUS,ft=H.length(yt),St=H.mercatorZfromAltitude(Math.max(ft*Bt-H.earthRadius,Number.EPSILON),0),Ft=Math.min(fe.zoomFromMercatorZAdjusted(St),de.maxZoom);return Ft>.5*(H.GLOBE_ZOOM_THRESHOLD_MIN+H.GLOBE_ZOOM_THRESHOLD_MAX)?(fe.setProjection({name:"mercator"}),fe.zoom=Ft,this._cameraForBounds(fe,Y,te,ne,ae,he)):{center:fe.center,zoom:Ft,bearing:ne,pitch:ae}}queryTerrainElevation(U,Y){const te=this.transform.elevation;return te?(Y=H.extend({},{exaggerated:!0},Y),te.getAtPoint(H.MercatorCoordinate.fromLngLat(U),null,Y.exaggerated)):null}_cameraForBounds(U,Y,te,ne,ae,he){if(U.projection.name==="globe")return this._cameraForBoundsOnGlobe(U,Y,te,ne,ae,he);const fe=U.clone(),de=this._extendCameraOptions(he),ve=fe.padding;fe.bearing=ne,fe.pitch=ae;const ge=H.LngLat.convert(Y),Te=H.LngLat.convert(te),Pe=new H.LngLat(ge.lng,Te.lat),Le=new H.LngLat(Te.lng,ge.lat),ke=fe.project(ge),Be=fe.project(Te),Ne=this.queryTerrainElevation(ge),Se=this.queryTerrainElevation(Te),De=this.queryTerrainElevation(Pe),Ve=this.queryTerrainElevation(Le),Ge=[[ke.x,ke.y,Math.min(Ne||0,Se||0,De||0,Ve||0)],[Be.x,Be.y,Math.max(Ne||0,Se||0,De||0,Ve||0)]];let Qe=H.Aabb.fromPoints(Ge);const tt=fe.getWorldToCameraMatrix(),et=H.invert(new Float64Array(16),tt);Qe=H.Aabb.applyTransform(Qe,tt);const at=H.sub([],Qe.max,Qe.min),nt=ve.left||0,pt=ve.right||0,kt=ve.bottom||0,ct=ve.top||0,{left:At,right:yt,top:Bt,bottom:ft}=de.padding,St=.5*(nt+pt),Ft=.5*(ct+kt),Mt=Math.min(fe.scaleZoom(fe.scale*Math.min((fe.width-(nt+pt+At+yt))/at[0],(fe.height-(kt+ct+ft+Bt))/at[1])),de.maxZoom),Ut=fe.scale/fe.zoomScale(Mt);Qe=new H.Aabb([Qe.min[0]-(At+St)*Ut,Qe.min[1]-(ft+Ft)*Ut,Qe.min[2]],[Qe.max[0]+(yt+St)*Ut,Qe.max[1]+(Bt+Ft)*Ut,Qe.max[2]]);const lr=.5*at[2],_r=this._minimumAABBFrustumDistance(fe,Qe),rr=[0,0,1,0];H.transformMat4$1(rr,rr,tt),H.normalize$2(rr,rr);const fr=H.scale$2([],rr,_r+lr),Lr=H.add([],Qe.center,fr),Pr=(typeof de.offset.x=="number"&&typeof de.offset.y=="number"?new H.Point(de.offset.x,de.offset.y):H.Point.convert(de.offset)).rotate(-H.degToRad(ne));Qe.center[0]-=Pr.x*Ut,Qe.center[1]+=Pr.y*Ut,H.transformMat4(Qe.center,Qe.center,et),H.transformMat4(Lr,Lr,et);const or=[Qe.center[0],Qe.center[1],Lr[2]*fe.pixelsPerMeter];H.scale$2(or,or,1/fe.worldSize);const Kr=H.lngFromMercatorX(or[0]),Qr=H.latFromMercatorY(or[1]),ei=Math.min(fe._zoomFromMercatorZ(or[2]),de.maxZoom),ti=new H.LngLat(Kr,Qr);return fe.mercatorFromTransition&&ei<.5*(H.GLOBE_ZOOM_THRESHOLD_MIN+H.GLOBE_ZOOM_THRESHOLD_MAX)?(fe.setProjection({name:"globe"}),fe.zoom=ei,this._cameraForBounds(fe,Y,te,ne,ae,he)):{center:ti,zoom:ei,bearing:ne,pitch:ae}}fitBounds(U,Y,te){const ne=this.cameraForBounds(U,Y);return this._fitInternal(ne,Y,te)}fitScreenCoordinates(U,Y,te,ne,ae){const he=H.Point.convert(U),fe=H.Point.convert(Y),de=new H.Point(Math.min(he.x,fe.x),Math.min(he.y,fe.y)),ve=new H.Point(Math.max(he.x,fe.x),Math.max(he.y,fe.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(he,fe))return this;const ge=this.transform.pointLocation3D(de),Te=this.transform.pointLocation3D(ve),Pe=this.transform.pointLocation3D(new H.Point(de.x,ve.y)),Le=this.transform.pointLocation3D(new H.Point(ve.x,de.y)),ke=[Math.min(ge.lng,Te.lng,Pe.lng,Le.lng),Math.min(ge.lat,Te.lat,Pe.lat,Le.lat)],Be=[Math.max(ge.lng,Te.lng,Pe.lng,Le.lng),Math.max(ge.lat,Te.lat,Pe.lat,Le.lat)],Ne=ne&&ne.pitch?ne.pitch:this.getPitch(),Se=this._cameraForBounds(this.transform,ke,Be,te,Ne,ne);return this._fitInternal(Se,ne,ae)}_fitInternal(U,Y,te){return U?(delete(Y=H.extend(U,Y)).padding,Y.linear?this.easeTo(Y,te):this.flyTo(Y,te)):this}jumpTo(U,Y){this.stop();const te=U.preloadOnly?this.transform.clone():this.transform;let ne=!1,ae=!1,he=!1;return"zoom"in U&&te.zoom!==+U.zoom&&(ne=!0,te.zoom=+U.zoom),U.center!==void 0&&(te.center=H.LngLat.convert(U.center)),"bearing"in U&&te.bearing!==+U.bearing&&(ae=!0,te.bearing=+U.bearing),"pitch"in U&&te.pitch!==+U.pitch&&(he=!0,te.pitch=+U.pitch),U.padding==null||te.isPaddingEqual(U.padding)||(te.padding=U.padding),U.preloadOnly?(this._preloadTiles(te),this):(this.fire(new H.Event("movestart",Y)).fire(new H.Event("move",Y)),ne&&this.fire(new H.Event("zoomstart",Y)).fire(new H.Event("zoom",Y)).fire(new H.Event("zoomend",Y)),ae&&this.fire(new H.Event("rotatestart",Y)).fire(new H.Event("rotate",Y)).fire(new H.Event("rotateend",Y)),he&&this.fire(new H.Event("pitchstart",Y)).fire(new H.Event("pitch",Y)).fire(new H.Event("pitchend",Y)),this.fire(new H.Event("moveend",Y)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||H.warnOnce(zo),this.transform.getFreeCameraOptions()}setFreeCameraOptions(U,Y){const te=this.transform;if(!te.projection.supportsFreeCamera)return H.warnOnce(zo),this;this.stop();const ne=te.zoom,ae=te.pitch,he=te.bearing;te.setFreeCameraOptions(U);const fe=ne!==te.zoom,de=ae!==te.pitch,ve=he!==te.bearing;return this.fire(new H.Event("movestart",Y)).fire(new H.Event("move",Y)),fe&&this.fire(new H.Event("zoomstart",Y)).fire(new H.Event("zoom",Y)).fire(new H.Event("zoomend",Y)),ve&&this.fire(new H.Event("rotatestart",Y)).fire(new H.Event("rotate",Y)).fire(new H.Event("rotateend",Y)),de&&this.fire(new H.Event("pitchstart",Y)).fire(new H.Event("pitch",Y)).fire(new H.Event("pitchend",Y)),this.fire(new H.Event("moveend",Y)),this}easeTo(U,Y){this._stop(!1,U.easeId),((U=H.extend({offset:[0,0],duration:500,easing:H.ease},U)).animate===!1||this._prefersReducedMotion(U))&&(U.duration=0);const te=this.transform,ne=this.getZoom(),ae=this.getBearing(),he=this.getPitch(),fe=this.getPadding(),de="zoom"in U?+U.zoom:ne,ve="bearing"in U?this._normalizeBearing(U.bearing,ae):ae,ge="pitch"in U?+U.pitch:he,Te="padding"in U?U.padding:te.padding,Pe=H.Point.convert(U.offset);let Le,ke,Be;if(te.projection.name==="globe"){const nt=H.MercatorCoordinate.fromLngLat(te.center),pt=Pe.rotate(-te.angle);nt.x+=pt.x/te.worldSize,nt.y+=pt.y/te.worldSize;const kt=nt.toLngLat(),ct=H.LngLat.convert(U.center||kt);this._normalizeCenter(ct),Le=te.centerPoint.add(pt),ke=new H.Point(nt.x,nt.y).mult(te.worldSize),Be=new H.Point(H.mercatorXfromLng(ct.lng),H.mercatorYfromLat(ct.lat)).mult(te.worldSize).sub(ke)}else{Le=te.centerPoint.add(Pe);const nt=te.pointLocation(Le),pt=H.LngLat.convert(U.center||nt);this._normalizeCenter(pt),ke=te.project(nt),Be=te.project(pt).sub(ke)}const Ne=te.zoomScale(de-ne);let Se,De;U.around&&(Se=H.LngLat.convert(U.around),De=te.locationPoint(Se));const Ve=this._zooming||de!==ne,Ge=this._rotating||ae!==ve,Qe=this._pitching||ge!==he,tt=!te.isPaddingEqual(Te),et=nt=>pt=>{if(Ve&&(nt.zoom=H.number(ne,de,pt)),Ge&&(nt.bearing=H.number(ae,ve,pt)),Qe&&(nt.pitch=H.number(he,ge,pt)),tt&&(nt.interpolatePadding(fe,Te,pt),Le=nt.centerPoint.add(Pe)),Se)nt.setLocationAtPoint(Se,De);else{const kt=nt.zoomScale(nt.zoom-ne),ct=de>ne?Math.min(2,Ne):Math.max(.5,Ne),At=Math.pow(ct,1-pt),yt=nt.unproject(ke.add(Be.mult(pt*At)).mult(kt));nt.setLocationAtPoint(nt.renderWorldCopies?yt.wrap():yt,Le)}return U.preloadOnly||this._fireMoveEvents(Y),nt};if(U.preloadOnly){const nt=this._emulate(et,U.duration,te);return this._preloadTiles(nt),this}const at={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ve,this._rotating=Ge,this._pitching=Qe,this._padding=tt,this._easeId=U.easeId,this._prepareEase(Y,U.noMoveStart,at),this._ease(et(te),nt=>{te.recenterOnTerrain(),this._afterEase(Y,nt)},U),this}_prepareEase(U,Y,te={}){this._moving=!0,this.transform.cameraElevationReference="sea",Y||te.moving||this.fire(new H.Event("movestart",U)),this._zooming&&!te.zooming&&this.fire(new H.Event("zoomstart",U)),this._rotating&&!te.rotating&&this.fire(new H.Event("rotatestart",U)),this._pitching&&!te.pitching&&this.fire(new H.Event("pitchstart",U))}_fireMoveEvents(U){this.fire(new H.Event("move",U)),this._zooming&&this.fire(new H.Event("zoom",U)),this._rotating&&this.fire(new H.Event("rotate",U)),this._pitching&&this.fire(new H.Event("pitch",U))}_afterEase(U,Y){if(this._easeId&&Y&&this._easeId===Y)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const te=this._zooming,ne=this._rotating,ae=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,te&&this.fire(new H.Event("zoomend",U)),ne&&this.fire(new H.Event("rotateend",U)),ae&&this.fire(new H.Event("pitchend",U)),this.fire(new H.Event("moveend",U))}flyTo(U,Y){if(this._prefersReducedMotion(U)){const Mt=H.pick(U,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Mt,Y)}this.stop(),U=H.extend({offset:[0,0],speed:1.2,curve:1.42,easing:H.ease},U);const te=this.transform,ne=this.getZoom(),ae=this.getBearing(),he=this.getPitch(),fe=this.getPadding(),de="zoom"in U?H.clamp(+U.zoom,te.minZoom,te.maxZoom):ne,ve="bearing"in U?this._normalizeBearing(U.bearing,ae):ae,ge="pitch"in U?+U.pitch:he,Te="padding"in U?U.padding:te.padding,Pe=te.zoomScale(de-ne),Le=H.Point.convert(U.offset);let ke=te.centerPoint.add(Le);const Be=te.pointLocation(ke),Ne=H.LngLat.convert(U.center||Be);this._normalizeCenter(Ne);const Se=te.project(Be),De=te.project(Ne).sub(Se);let Ve=U.curve;const Ge=Math.max(te.width,te.height),Qe=Ge/Pe,tt=De.mag();if("minZoom"in U){const Mt=H.clamp(Math.min(U.minZoom,ne,de),te.minZoom,te.maxZoom),Ut=Ge/te.zoomScale(Mt-ne);Ve=Math.sqrt(Ut/tt*2)}const et=Ve*Ve;function at(Mt){const Ut=(Qe*Qe-Ge*Ge+(Mt?-1:1)*et*et*tt*tt)/(2*(Mt?Qe:Ge)*et*tt);return Math.log(Math.sqrt(Ut*Ut+1)-Ut)}function nt(Mt){return(Math.exp(Mt)-Math.exp(-Mt))/2}function pt(Mt){return(Math.exp(Mt)+Math.exp(-Mt))/2}const kt=at(0);let ct=function(Mt){return pt(kt)/pt(kt+Ve*Mt)},At=function(Mt){return Ge*((pt(kt)*(nt(Ut=kt+Ve*Mt)/pt(Ut))-nt(kt))/et)/tt;var Ut},yt=(at(1)-kt)/Ve;if(Math.abs(tt)<1e-6||!isFinite(yt)){if(Math.abs(Ge-Qe)<1e-6)return this.easeTo(U,Y);const Mt=Qe<Ge?-1:1;yt=Math.abs(Math.log(Qe/Ge))/Ve,At=function(){return 0},ct=function(Ut){return Math.exp(Mt*Ve*Ut)}}U.duration="duration"in U?+U.duration:1e3*yt/("screenSpeed"in U?+U.screenSpeed/Ve:+U.speed),U.maxDuration&&U.duration>U.maxDuration&&(U.duration=0);const Bt=ae!==ve,ft=ge!==he,St=!te.isPaddingEqual(Te),Ft=Mt=>Ut=>{const lr=Ut*yt,_r=1/ct(lr);Mt.zoom=Ut===1?de:ne+Mt.scaleZoom(_r),Bt&&(Mt.bearing=H.number(ae,ve,Ut)),ft&&(Mt.pitch=H.number(he,ge,Ut)),St&&(Mt.interpolatePadding(fe,Te,Ut),ke=Mt.centerPoint.add(Le));const rr=Ut===1?Ne:Mt.unproject(Se.add(De.mult(At(lr))).mult(_r));return Mt.setLocationAtPoint(Mt.renderWorldCopies?rr.wrap():rr,ke),Mt._updateCameraOnTerrain(),U.preloadOnly||this._fireMoveEvents(Y),Mt};if(U.preloadOnly){const Mt=this._emulate(Ft,U.duration,te);return this._preloadTiles(Mt),this}return this._zooming=!0,this._rotating=Bt,this._pitching=ft,this._padding=St,this._prepareEase(Y,!1),this._ease(Ft(te),()=>this._afterEase(Y),U),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(U,Y){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const te=this._onEaseEnd;this._onEaseEnd=void 0,te.call(this,Y)}if(!U){const te=this.handlers;te&&te.stop(!1)}return this}_ease(U,Y,te){te.animate===!1||te.duration===0?(U(1),Y()):(this._easeStart=H.exported.now(),this._easeOptions=te,this._onEaseFrame=U,this._onEaseEnd=Y,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const U=Math.min((H.exported.now()-this._easeStart)/this._easeOptions.duration,1),Y=this._onEaseFrame;Y&&Y(this._easeOptions.easing(U)),U<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(U,Y){U=H.wrap(U,-180,180);const te=Math.abs(U-Y);return Math.abs(U-360-Y)<te&&(U-=360),Math.abs(U+360-Y)<te&&(U+=360),U}_normalizeCenter(U){const Y=this.transform;if(!Y.renderWorldCopies||Y.maxBounds)return;const te=U.lng-Y.center.lng;U.lng+=te>180?-360:te<-180?360:0}_prefersReducedMotion(U){return this._respectPrefersReducedMotion&&H.exported.prefersReducedMotion&&!(U&&U.essential)}_emulate(U,Y,te){const ne=Math.ceil(15*Y/1e3),ae=[],he=U(te.clone());for(let fe=0;fe<=ne;fe++){const de=he(fe/ne);ae.push(de.clone())}return ae}}class tr{constructor(U={}){this.options=U,H.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(U){const Y=this.options&&this.options.compact;return this._map=U,this._container=je("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=je("button","mapboxgl-ctrl-attrib-button",this._container),je("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=je("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),Y&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),Y===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(U,Y){const te=this._map._getUIString(`AttributionControl.${Y}`);U.setAttribute("aria-label",te),U.removeAttribute("title"),U.firstElementChild&&U.firstElementChild.setAttribute("title",te)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let U=this._editLink;U||(U=this._editLink=this._container.querySelector(".mapbox-improve-map"));const Y=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||H.config.ACCESS_TOKEN}];if(U){const te=Y.reduce((ne,ae,he)=>(ae.value&&(ne+=`${ae.key}=${ae.value}${he<Y.length-1?"&":""}`),ne),"?");U.href=`${H.config.FEEDBACK_URL}/${te}#${Ka(this._map,!0)}`,U.rel="noopener nofollow",this._setElementTitle(U,"MapFeedback")}}_updateData(U){!U||U.sourceDataType!=="metadata"&&U.sourceDataType!=="visibility"&&U.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let U=[];if(this._map.style.stylesheet){const ne=this._map.style.stylesheet;this.styleOwner=ne.owner,this.styleId=ne.id}const Y=this._map.style._sourceCaches;for(const ne in Y){const ae=Y[ne];if(ae.used){const he=ae.getSource();he.attribution&&U.indexOf(he.attribution)<0&&U.push(he.attribution)}}U.sort((ne,ae)=>ne.length-ae.length),U=U.filter((ne,ae)=>{for(let he=ae+1;he<U.length;he++)if(U[he].indexOf(ne)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?U=[...this.options.customAttribution,...U]:U.unshift(this.options.customAttribution));const te=U.join(" | ");te!==this._attribHTML&&(this._attribHTML=te,U.length?(this._innerContainer.innerHTML=te,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class nc{constructor(){H.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(U){this._map=U,this._container=je("div","mapboxgl-ctrl");const Y=je("a","mapboxgl-ctrl-logo");return Y.target="_blank",Y.rel="noopener nofollow",Y.href="https://www.mapbox.com/",Y.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),Y.setAttribute("rel","noopener nofollow"),this._container.appendChild(Y),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(U){U&&U.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const U=this._map.style._sourceCaches;if(Object.entries(U).length===0)return!0;for(const Y in U){const te=U[Y].getSource();if(te.hasOwnProperty("mapbox_logo")&&!te.mapbox_logo)return!1}return!0}_updateCompact(){const U=this._container.children;if(U.length){const Y=U[0];this._map.getCanvasContainer().offsetWidth<250?Y.classList.add("mapboxgl-compact"):Y.classList.remove("mapboxgl-compact")}}}class oc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(U){const Y=++this._id;return this._queue.push({callback:U,id:Y,cancelled:!1}),Y}remove(U){const Y=this._currentlyRunning,te=Y?this._queue.concat(Y):this._queue;for(const ne of te)if(ne.id===U)return void(ne.cancelled=!0)}run(U=0){const Y=this._currentlyRunning=this._queue;this._queue=[];for(const te of Y)if(!te.cancelled&&(te.callback(U),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ya(Q,U,Y){if(Q=new H.LngLat(Q.lng,Q.lat),U){const te=new H.LngLat(Q.lng-360,Q.lat),ne=new H.LngLat(Q.lng+360,Q.lat),ae=360*Math.ceil(Math.abs(Q.lng-Y.center.lng)/360),he=Y.locationPoint(Q).distSqr(U),fe=U.x<0||U.y<0||U.x>Y.width||U.y>Y.height;Y.locationPoint(te).distSqr(U)<he&&(fe||Math.abs(te.lng-Y.center.lng)<ae)?Q=te:Y.locationPoint(ne).distSqr(U)<he&&(fe||Math.abs(ne.lng-Y.center.lng)<ae)&&(Q=ne)}for(;Math.abs(Q.lng-Y.center.lng)>180;){const te=Y.locationPoint(Q);if(te.x>=0&&te.y>=0&&te.x<=Y.width&&te.y<=Y.height)break;Q.lng>Y.center.lng?Q.lng-=360:Q.lng+=360}return Q}const Uo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Jt extends H.Evented{constructor(U,Y){if(super(),(U instanceof H.window.HTMLElement||Y)&&(U=H.extend({element:U},Y)),H.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=U&&U.anchor||"center",this._color=U&&U.color||"#3FB1CE",this._scale=U&&U.scale||1,this._draggable=U&&U.draggable||!1,this._clickTolerance=U&&U.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=U&&U.rotation||0,this._rotationAlignment=U&&U.rotationAlignment||"auto",this._pitchAlignment=U&&U.pitchAlignment&&U.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=U&&U.occludedOpacity||.2,U&&U.element)this._element=U.element,this._offset=H.Point.convert(U&&U.offset||[0,0]);else{this._defaultMarker=!0,this._element=je("div");const ne=41,ae=27,he=mt("svg",{display:"block",height:ne*this._scale+"px",width:ae*this._scale+"px",viewBox:`0 0 ${ae} ${ne}`},this._element),fe=mt("radialGradient",{id:"shadowGradient"},mt("defs",{},he));mt("stop",{offset:"10%","stop-opacity":.4},fe),mt("stop",{offset:"100%","stop-opacity":.05},fe),mt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},he),mt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},he),mt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},he),mt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},he),this._offset=H.Point.convert(U&&U.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ne=>{ne.preventDefault()}),this._element.addEventListener("mousedown",ne=>{ne.preventDefault()});const te=this._element.classList;for(const ne in Uo)te.remove(`mapboxgl-marker-anchor-${ne}`);te.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(U){return U===this._map||(this.remove(),this._map=U,U.getCanvasContainer().appendChild(this._element),U.on("move",this._updateMoving),U.on("moveend",this._update),U.on("remove",this._clearFadeTimer),U._addMarker(this),this.setDraggable(this._draggable),this._update(),U.on("click",this._onMapClick)),this}remove(){const U=this._map;return U&&(U.off("click",this._onMapClick),U.off("move",this._updateMoving),U.off("moveend",this._update),U.off("mousedown",this._addDragHandler),U.off("touchstart",this._addDragHandler),U.off("mouseup",this._onUp),U.off("touchend",this._onUp),U.off("mousemove",this._onMove),U.off("touchmove",this._onMove),U.off("remove",this._clearFadeTimer),U._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(U){return this._lngLat=H.LngLat.convert(U),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(U){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),U){if(!("offset"in U.options)){const ne=Math.sqrt(Math.pow(13.5,2)/2);U.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[ne,-1*(38.1-13.5+ne)],"bottom-right":[-ne,-1*(38.1-13.5+ne)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=U,U._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(U){const Y=U.code,te=U.charCode||U.keyCode;Y!=="Space"&&Y!=="Enter"&&te!==32&&te!==13||this.togglePopup()}_onMapClick(U){const Y=U.originalEvent.target,te=this._element;this._popup&&(Y===te||te.contains(Y))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const U=this._popup;return U?(U.isOpen()?(U.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(U.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const U=this._map,Y=this._pos;if(!U||!Y)return!1;const te=U.unproject(Y),ne=U.getFreeCameraOptions();if(!ne.position)return!1;const ae=ne.position.toLngLat();return ae.distanceTo(te)<.9*ae.distanceTo(this._lngLat)}_evaluateOpacity(){const U=this._map;if(!U)return;const Y=this._pos;if(!Y||Y.x<0||Y.x>U.transform.width||Y.y<0||Y.y>U.transform.height)return void this._clearFadeTimer();const te=U.unproject(Y);let ne;U._showingGlobe()&&H.isLngLatBehindGlobe(U.transform,this._lngLat)?ne=0:(ne=1-U._queryFogOpacity(te),U.transform._terrainEnabled()&&U.getTerrain()&&this._behindTerrain()&&(ne*=this._occludedOpacity)),this._element.style.opacity=`${ne}`,this._element.style.pointerEvents=ne>0?"auto":"none",this._popup&&this._popup._setOpacity(ne),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const U=this._pos;if(!U||!this._map)return;const Y=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${U.x}px,${U.y}px)
            ${Uo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${Y.x}px,${Y.y}px)
        `}_calculateXYTransform(){const U=this._pos,Y=this._map,te=this.getPitchAlignment();if(!Y||!U||te!=="map")return"";if(!Y._showingGlobe()){const de=Y.getPitch();return de?`rotateX(${de}deg)`:""}const ne=H.radToDeg(H.globeTiltAtLngLat(Y.transform,this._lngLat)),ae=U.sub(H.globeCenterToScreenPoint(Y.transform)),he=Math.abs(ae.x)+Math.abs(ae.y);if(he===0)return"";const fe=ne/he;return`rotateX(${-ae.y*fe}deg) rotateY(${ae.x*fe}deg)`}_calculateZTransform(){const U=this._pos,Y=this._map;if(!Y||!U)return"";let te=0;const ne=this.getRotationAlignment();if(ne==="map")if(Y._showingGlobe()){const ae=Y.project(new H.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),he=Y.project(new H.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(ae);te=H.radToDeg(Math.atan2(he.y,he.x))-90}else te=-Y.getBearing();else if(ne==="horizon"){const ae=H.smoothstep(4,6,Y.getZoom()),he=H.globeCenterToScreenPoint(Y.transform);he.y+=ae*Y.transform.height;const fe=U.sub(he),de=H.radToDeg(Math.atan2(fe.y,fe.x));te=(de>90?de-270:de+90)*(1-ae)}return te+=this._rotation,te?`rotateZ(${te}deg)`:""}_update(U){H.window.cancelAnimationFrame(this._updateFrameId);const Y=this._map;Y&&(Y.transform.renderWorldCopies&&(this._lngLat=ya(this._lngLat,this._pos,Y.transform)),this._pos=Y.project(this._lngLat),U===!0?this._updateFrameId=H.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),Y._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(Y._showingGlobe()||Y.getTerrain()||Y.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(U){return this._offset=H.Point.convert(U),this._update(),this}_onMove(U){const Y=this._map;if(!Y)return;const te=this._pointerdownPos,ne=this._positionDelta;if(te&&ne){if(!this._isDragging){const ae=this._clickTolerance||Y._clickTolerance;if(U.point.dist(te)<ae)return;this._isDragging=!0}this._pos=U.point.sub(ne),this._lngLat=Y.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new H.Event("dragstart"))),this.fire(new H.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const U=this._map;U&&(U.off("mousemove",this._onMove),U.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new H.Event("dragend")),this._state="inactive"}_addDragHandler(U){const Y=this._map,te=this._pos;Y&&te&&this._element.contains(U.originalEvent.target)&&(U.preventDefault(),this._positionDelta=U.point.sub(te),this._pointerdownPos=U.point,this._state="pending",Y.on("mousemove",this._onMove),Y.on("touchmove",this._onMove),Y.once("mouseup",this._onUp),Y.once("touchend",this._onUp))}setDraggable(U){this._draggable=!!U;const Y=this._map;return Y&&(U?(Y.on("mousedown",this._addDragHandler),Y.on("touchstart",this._addDragHandler)):(Y.off("mousedown",this._addDragHandler),Y.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(U){return this._rotation=U||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(U){return this._rotationAlignment=U||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(U){return this._pitchAlignment=U||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(U){return this._occludedOpacity=U||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ac={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Nh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pu(Q=new H.Point(0,0),U="bottom"){if(typeof Q=="number"){const Y=Math.round(Math.sqrt(.5*Math.pow(Q,2)));switch(U){case"top":return new H.Point(0,Q);case"top-left":return new H.Point(Y,Y);case"top-right":return new H.Point(-Y,Y);case"bottom":return new H.Point(0,-Q);case"bottom-left":return new H.Point(Y,-Y);case"bottom-right":return new H.Point(-Y,-Y);case"left":return new H.Point(Q,0);case"right":return new H.Point(-Q,0)}return new H.Point(0,0)}return Q instanceof H.Point||Array.isArray(Q)?H.Point.convert(Q):H.Point.convert(Q[U]||[0,0])}class sc{constructor(U){this.jumpTo(U)}getValue(U){if(U<=this._startTime)return this._start;if(U>=this._endTime)return this._end;const Y=H.easeCubicInOut((U-this._startTime)/(this._endTime-this._startTime));return this._start*(1-Y)+this._end*Y}isEasing(U){return U>=this._startTime&&U<=this._endTime}jumpTo(U){this._startTime=-1/0,this._endTime=-1/0,this._start=U,this._end=U}easeTo(U,Y,te){this._start=this.getValue(Y),this._end=U,this._startTime=Y,this._endTime=Y+te}}const Ru={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use â + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Mu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Fh={showCompass:!0,showZoom:!0,visualizePitch:!1};class zh{constructor(U,Y,te=!1){this._clickTolerance=10,this.element=Y,this.mouseRotate=new Ql({clickTolerance:U.dragRotate._mouseRotate._clickTolerance}),this.map=U,te&&(this.mousePitch=new ec({clickTolerance:U.dragRotate._mousePitch._clickTolerance})),H.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Y.addEventListener("mousedown",this.mousedown),Y.addEventListener("touchstart",this.touchstart,{passive:!1}),Y.addEventListener("touchmove",this.touchmove),Y.addEventListener("touchend",this.touchend),Y.addEventListener("touchcancel",this.reset)}down(U,Y){this.mouseRotate.mousedown(U,Y),this.mousePitch&&this.mousePitch.mousedown(U,Y),jt()}move(U,Y){const te=this.map,ne=this.mouseRotate.mousemoveWindow(U,Y),ae=ne&&ne.bearingDelta;if(ae&&te.setBearing(te.getBearing()+ae),this.mousePitch){const he=this.mousePitch.mousemoveWindow(U,Y),fe=he&&he.pitchDelta;fe&&te.setPitch(te.getPitch()+fe)}}off(){const U=this.element;U.removeEventListener("mousedown",this.mousedown),U.removeEventListener("touchstart",this.touchstart,{passive:!1}),U.removeEventListener("touchmove",this.touchmove),U.removeEventListener("touchend",this.touchend),U.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){nr(),H.window.removeEventListener("mousemove",this.mousemove),H.window.removeEventListener("mouseup",this.mouseup)}mousedown(U){this.down(H.extend({},U,{ctrlKey:!0,preventDefault:()=>U.preventDefault()}),hr(this.element,U)),H.window.addEventListener("mousemove",this.mousemove),H.window.addEventListener("mouseup",this.mouseup)}mousemove(U){this.move(U,hr(this.element,U))}mouseup(U){this.mouseRotate.mouseupWindow(U),this.mousePitch&&this.mousePitch.mouseupWindow(U),this.offTemp()}touchstart(U){U.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ir(this.element,U.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>U.preventDefault()},this._startPos))}touchmove(U){U.targetTouches.length!==1?this.reset():(this._lastPos=Ir(this.element,U.targetTouches)[0],this.move({preventDefault:()=>U.preventDefault()},this._lastPos))}touchend(U){U.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const lc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},cc={maxWidth:100,unit:"metric"},uc={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},_a={version:H.version,supported:Ie,setRTLTextPlugin:H.setRTLTextPlugin,getRTLTextPluginStatus:H.getRTLTextPluginStatus,Map:class extends qs{constructor(Q){if(H.LivePerformanceUtils.mark(H.PerformanceMarkers.create),(Q=H.extend({},Mu,Q)).minZoom!=null&&Q.maxZoom!=null&&Q.minZoom>Q.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(Q.minPitch!=null&&Q.maxPitch!=null&&Q.minPitch>Q.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(Q.minPitch!=null&&Q.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(Q.maxPitch!=null&&Q.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(Q.antialias&&H.isSafariWithAntialiasingBug(H.window)&&(Q.antialias=!1,H.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new fa(Q.minZoom,Q.maxZoom,Q.minPitch,Q.maxPitch,Q.renderWorldCopies),Q),this._interactive=Q.interactive,this._minTileCacheSize=Q.minTileCacheSize,this._maxTileCacheSize=Q.maxTileCacheSize,this._failIfMajorPerformanceCaveat=Q.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=Q.preserveDrawingBuffer,this._antialias=Q.antialias,this._useWebGL2=Q.useWebGL2,this._trackResize=Q.trackResize,this._bearingSnap=Q.bearingSnap,this._refreshExpiredTiles=Q.refreshExpiredTiles,this._fadeDuration=Q.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=Q.crossSourceCollisions,this._collectResourceTiming=Q.collectResourceTiming,this._optimizeForTerrain=Q.optimizeForTerrain,this._language=this._parseLanguage(Q.language),this._worldview=Q.worldview,this._renderTaskQueue=new oc,this._domRenderTaskQueue=new oc,this._controls=[],this._markers=[],this._popups=[],this._mapId=H.uniqueId(),this._locale=H.extend({},Ru,Q.locale),this._clickTolerance=Q.clickTolerance,this._cooperativeGestures=Q.cooperativeGestures,this._performanceMetricsCollection=Q.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new sc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new H.RequestManager(Q.transformRequest,Q.accessToken,Q.testMode),this._silenceAuthErrors=!!Q.testMode,typeof Q.container=="string"){if(this._container=H.window.document.getElementById(Q.container),!this._container)throw new Error(`Container '${Q.container}' not found.`)}else{if(!(Q.container instanceof H.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=Q.container}if(this._container.childNodes.length>0&&H.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),Q.maxBounds&&this.setMaxBounds(Q.maxBounds),H.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),H.window!==void 0&&(H.window.addEventListener("online",this._onWindowOnline,!1),H.window.addEventListener("resize",this._onWindowResize,!1),H.window.addEventListener("orientationchange",this._onWindowResize,!1),H.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),H.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Hn(this,Q),this._localFontFamily=Q.localFontFamily,this._localIdeographFontFamily=Q.localIdeographFontFamily,Q.style&&this.setStyle(Q.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),Q.projection&&this.setProjection(Q.projection),this._hash=Q.hash&&new Zl(typeof Q.hash=="string"&&Q.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:Q.center,zoom:Q.zoom,bearing:Q.bearing,pitch:Q.pitch}),Q.bounds&&(this.resize(),this.fitBounds(Q.bounds,H.extend({},Q.fitBoundsOptions,{duration:0})))),this.resize(),Q.attributionControl&&this.addControl(new tr({customAttribution:Q.customAttribution})),this._logoControl=new nc,this.addControl(this._logoControl,Q.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",U=>{this._update(U.dataType==="style"),this.fire(new H.Event(`${U.dataType}data`,U))}),this.on("dataloading",U=>{this.fire(new H.Event(`${U.dataType}dataloading`,U))})}_getMapId(){return this._mapId}addControl(Q,U){if(U===void 0&&(U=Q.getDefaultPosition?Q.getDefaultPosition():"top-right"),!Q||!Q.onAdd)return this.fire(new H.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const Y=Q.onAdd(this);this._controls.push(Q);const te=this._controlPositions[U];return U.indexOf("bottom")!==-1?te.insertBefore(Y,te.firstChild):te.appendChild(Y),this}removeControl(Q){if(!Q||!Q.onRemove)return this.fire(new H.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const U=this._controls.indexOf(Q);return U>-1&&this._controls.splice(U,1),Q.onRemove(this),this}hasControl(Q){return this._controls.indexOf(Q)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(Q){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const U=!this._moving;return U&&this.fire(new H.Event("movestart",Q)).fire(new H.Event("move",Q)),this.fire(new H.Event("resize",Q)),U&&this.fire(new H.Event("moveend",Q)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(Q){return this.transform.setMaxBounds(H.LngLatBounds.convert(Q)),this._update()}setMinZoom(Q){if((Q=Q??-2)>=-2&&Q<=this.transform.maxZoom)return this.transform.minZoom=Q,this._update(),this.getZoom()<Q?this.setZoom(Q):this.fire(new H.Event("zoomstart")).fire(new H.Event("zoom")).fire(new H.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(Q){if((Q=Q??22)>=this.transform.minZoom)return this.transform.maxZoom=Q,this._update(),this.getZoom()>Q?this.setZoom(Q):this.fire(new H.Event("zoomstart")).fire(new H.Event("zoom")).fire(new H.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(Q){if((Q=Q??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(Q>=0&&Q<=this.transform.maxPitch)return this.transform.minPitch=Q,this._update(),this.getPitch()<Q?this.setPitch(Q):this.fire(new H.Event("pitchstart")).fire(new H.Event("pitch")).fire(new H.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(Q){if((Q=Q??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(Q>=this.transform.minPitch)return this.transform.maxPitch=Q,this._update(),this.getPitch()>Q?this.setPitch(Q):this.fire(new H.Event("pitchstart")).fire(new H.Event("pitch")).fire(new H.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(Q){return this.transform.renderWorldCopies=Q,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(Q){return Q==="auto"?H.window.navigator.language:Array.isArray(Q)?Q.length===0?void 0:Q.map(U=>U==="auto"?H.window.navigator.language:U):Q}setLanguage(Q){const U=this._parseLanguage(Q);if(!this.style||U===this._language)return this;this._language=U,this.style._reloadSources();for(const Y of this._controls)Y._setLanguage&&Y._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(Q){return this.style&&Q!==this._worldview?(this._worldview=Q,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(Q){return this._lazyInitEmptyStyle(),Q?typeof Q=="string"&&(Q={name:Q}):Q=null,this._useExplicitProjection=!!Q,this._prioritizeAndUpdateProjection(Q,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const Q=this.transform,U=Q.projection.name;let Y;U==="globe"&&Q.zoom>=H.GLOBE_ZOOM_THRESHOLD_MAX?(Q.setMercatorFromTransition(),Y=!0):U==="mercator"&&Q.zoom<H.GLOBE_ZOOM_THRESHOLD_MAX&&(Q.setProjection({name:"globe"}),Y=!0),Y&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(Q,U){return this._updateProjection(Q||U||{name:"mercator"})}_updateProjection(Q){let U;if(U=Q.name==="globe"&&this.transform.zoom>=H.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(Q),this.style.applyProjectionUpdate(),U){this.painter.clearBackgroundTiles();for(const Y in this.style._sourceCaches)this.style._sourceCaches[Y].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(Q){return this.transform.locationPoint3D(H.LngLat.convert(Q))}unproject(Q){return this.transform.pointLocation3D(H.Point.convert(Q))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(Q,U,Y){if(Q==="mouseenter"||Q==="mouseover"){let te=!1;const ne=he=>{const fe=U.filter(ve=>this.getLayer(ve)),de=fe.length?this.queryRenderedFeatures(he.point,{layers:fe}):[];de.length?te||(te=!0,Y.call(this,new ji(Q,this,he.originalEvent,{features:de}))):te=!1},ae=()=>{te=!1};return{layers:new Set(U),listener:Y,delegates:{mousemove:ne,mouseout:ae}}}if(Q==="mouseleave"||Q==="mouseout"){let te=!1;const ne=he=>{const fe=U.filter(de=>this.getLayer(de));(fe.length?this.queryRenderedFeatures(he.point,{layers:fe}):[]).length?te=!0:te&&(te=!1,Y.call(this,new ji(Q,this,he.originalEvent)))},ae=he=>{te&&(te=!1,Y.call(this,new ji(Q,this,he.originalEvent)))};return{layers:new Set(U),listener:Y,delegates:{mousemove:ne,mouseout:ae}}}{const te=ne=>{const ae=U.filter(fe=>this.getLayer(fe)),he=ae.length?this.queryRenderedFeatures(ne.point,{layers:ae}):[];he.length&&(ne.features=he,Y.call(this,ne),delete ne.features)};return{layers:new Set(U),listener:Y,delegates:{[Q]:te}}}}on(Q,U,Y){if(Y===void 0)return super.on(Q,U);Array.isArray(U)||(U=[U]);const te=this._createDelegatedListener(Q,U,Y);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[Q]=this._delegatedListeners[Q]||[],this._delegatedListeners[Q].push(te);for(const ne in te.delegates)this.on(ne,te.delegates[ne]);return this}once(Q,U,Y){if(Y===void 0)return super.once(Q,U);Array.isArray(U)||(U=[U]);const te=this._createDelegatedListener(Q,U,Y);for(const ne in te.delegates)this.once(ne,te.delegates[ne]);return this}off(Q,U,Y){if(Y===void 0)return super.off(Q,U);U=new Set(Array.isArray(U)?U:[U]);const te=(ae,he)=>{if(ae.size!==he.size)return!1;for(const fe of ae)if(!he.has(fe))return!1;return!0},ne=this._delegatedListeners?this._delegatedListeners[Q]:void 0;return ne&&(ae=>{for(let he=0;he<ae.length;he++){const fe=ae[he];if(fe.listener===Y&&te(fe.layers,U)){for(const de in fe.delegates)this.off(de,fe.delegates[de]);return ae.splice(he,1),this}}})(ne),this}queryRenderedFeatures(Q,U){return this.style?(U!==void 0||Q===void 0||Q instanceof H.Point||Array.isArray(Q)||(U=Q,Q=void 0),this.style.queryRenderedFeatures(Q=Q||[[0,0],[this.transform.width,this.transform.height]],U=U||{},this.transform)):[]}querySourceFeatures(Q,U){return this.style.querySourceFeatures(Q,U)}isPointOnSurface(Q){const{name:U}=this.transform.projection;return U!=="globe"&&U!=="mercator"&&H.warnOnce(`${U} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(H.Point.convert(Q))}setStyle(Q,U){return(U=H.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},U)).diff!==!1&&U.localIdeographFontFamily===this._localIdeographFontFamily&&U.localFontFamily===this._localFontFamily&&this.style&&Q?(this._diffStyle(Q,U),this):(this._localIdeographFontFamily=U.localIdeographFontFamily,this._localFontFamily=U.localFontFamily,this._updateStyle(Q,U))}_getUIString(Q){const U=this._locale[Q];if(U==null)throw new Error(`Missing UI string '${Q}'`);return U}_updateStyle(Q,U){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),Q&&(this.style=new Wn(this,U||{}),this.style.setEventedParent(this,{style:this.style}),typeof Q=="string"?this.style.loadURL(Q):this.style.loadJSON(Q)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Wn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(Q,U){if(typeof Q=="string"){const Y=this._requestManager.normalizeStyleURL(Q),te=this._requestManager.transformRequest(Y,H.ResourceType.Style);H.getJSON(te,(ne,ae)=>{ne?this.fire(new H.ErrorEvent(ne)):ae&&this._updateDiff(ae,U)})}else typeof Q=="object"&&this._updateDiff(Q,U)}_updateDiff(Q,U){try{this.style.setState(Q)&&this._update(!0)}catch(Y){H.warnOnce(`Unable to perform style diff: ${Y.message||Y.error||Y}.  Rebuilding the style from scratch.`),this._updateStyle(Q,U)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(H.warnOnce("There is no style added to the map."),!1)}addSource(Q,U){return this._lazyInitEmptyStyle(),this.style.addSource(Q,U),this._update(!0)}isSourceLoaded(Q){return!!this.style&&this.style._isSourceCacheLoaded(Q)}areTilesLoaded(){const Q=this.style&&this.style._sourceCaches;for(const U in Q){const Y=Q[U]._tiles;for(const te in Y){const ne=Y[te];if(ne.state!=="loaded"&&ne.state!=="errored")return!1}}return!0}addSourceType(Q,U,Y){this._lazyInitEmptyStyle(),this.style.addSourceType(Q,U,Y)}removeSource(Q){return this.style.removeSource(Q),this._updateTerrain(),this._update(!0)}getSource(Q){return this.style.getSource(Q)}addImage(Q,U,{pixelRatio:Y=1,sdf:te=!1,stretchX:ne,stretchY:ae,content:he}={}){if(this._lazyInitEmptyStyle(),U instanceof H.window.HTMLImageElement||H.window.ImageBitmap&&U instanceof H.window.ImageBitmap){const{width:fe,height:de,data:ve}=H.exported.getImageData(U);this.style.addImage(Q,{data:new H.RGBAImage({width:fe,height:de},ve),pixelRatio:Y,stretchX:ne,stretchY:ae,content:he,sdf:te,version:0})}else if(U.width===void 0||U.height===void 0)this.fire(new H.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:fe,height:de}=U,ve=U;this.style.addImage(Q,{data:new H.RGBAImage({width:fe,height:de},new Uint8Array(ve.data)),pixelRatio:Y,stretchX:ne,stretchY:ae,content:he,sdf:te,version:0,userImage:ve}),ve.onAdd&&ve.onAdd(this,Q)}}updateImage(Q,U){const Y=this.style.getImage(Q);if(!Y)return void this.fire(new H.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const te=U instanceof H.window.HTMLImageElement||H.window.ImageBitmap&&U instanceof H.window.ImageBitmap?H.exported.getImageData(U):U,{width:ne,height:ae}=te;ne!==void 0&&ae!==void 0?ne===Y.data.width&&ae===Y.data.height?(Y.data.replace(te.data,!(U instanceof H.window.HTMLImageElement||H.window.ImageBitmap&&U instanceof H.window.ImageBitmap)),this.style.updateImage(Q,Y)):this.fire(new H.ErrorEvent(new Error(`The width and height of the updated image (${ne}, ${ae})
                must be that same as the previous version of the image
                (${Y.data.width}, ${Y.data.height})`))):this.fire(new H.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(Q){return Q?!!this.style.getImage(Q):(this.fire(new H.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(Q){this.style.removeImage(Q)}loadImage(Q,U){H.getImage(this._requestManager.transformRequest(Q,H.ResourceType.Image),(Y,te)=>{U(Y,te instanceof H.window.HTMLImageElement?H.exported.getImageData(te):te)})}listImages(){return this.style.listImages()}addLayer(Q,U){return this._lazyInitEmptyStyle(),this.style.addLayer(Q,U),this._update(!0)}moveLayer(Q,U){return this.style.moveLayer(Q,U),this._update(!0)}removeLayer(Q){return this.style.removeLayer(Q),this._update(!0)}getLayer(Q){return this.style.getLayer(Q)}setLayerZoomRange(Q,U,Y){return this.style.setLayerZoomRange(Q,U,Y),this._update(!0)}setFilter(Q,U,Y={}){return this.style.setFilter(Q,U,Y),this._update(!0)}getFilter(Q){return this.style.getFilter(Q)}setPaintProperty(Q,U,Y,te={}){return this.style.setPaintProperty(Q,U,Y,te),this._update(!0)}getPaintProperty(Q,U){return this.style.getPaintProperty(Q,U)}setLayoutProperty(Q,U,Y,te={}){return this.style.setLayoutProperty(Q,U,Y,te),this._update(!0)}getLayoutProperty(Q,U){return this.style.getLayoutProperty(Q,U)}setLight(Q,U={}){return this._lazyInitEmptyStyle(),this.style.setLight(Q,U),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(Q){return this._lazyInitEmptyStyle(),!Q&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(Q),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(Q){return this._lazyInitEmptyStyle(),this.style.setFog(Q),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(Q){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(H.LngLat.convert(Q),this.transform):0}setFeatureState(Q,U){return this.style.setFeatureState(Q,U),this._update()}removeFeatureState(Q,U){return this.style.removeFeatureState(Q,U),this._update()}getFeatureState(Q){return this.style.getFeatureState(Q)}_updateContainerDimensions(){if(!this._container)return;const Q=this._container.getBoundingClientRect().width||400,U=this._container.getBoundingClientRect().height||300;let Y,te,ne,ae=this._container;for(;ae&&(!te||!ne);){const he=H.window.getComputedStyle(ae).transform;he&&he!=="none"&&(Y=he.match(/matrix.*\((.+)\)/)[1].split(", "),Y[0]&&Y[0]!=="0"&&Y[0]!=="1"&&(te=Y[0]),Y[3]&&Y[3]!=="0"&&Y[3]!=="1"&&(ne=Y[3])),ae=ae.parentElement}this._containerWidth=te?Math.abs(Q/te):Q,this._containerHeight=ne?Math.abs(U/ne):U}_detectMissingCSS(){H.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&H.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const Q=this._container;Q.classList.add("mapboxgl-map"),(this._missingCSSCanary=je("div","mapboxgl-canary",Q)).style.visibility="hidden",this._detectMissingCSS();const U=this._canvasContainer=je("div","mapboxgl-canvas-container",Q);this._interactive&&U.classList.add("mapboxgl-interactive"),this._canvas=je("canvas","mapboxgl-canvas",U),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const Y=this._controlContainer=je("div","mapboxgl-control-container",Q),te=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(ne=>{te[ne]=je("div",`mapboxgl-ctrl-${ne}`,Y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(Q,U){const Y=H.exported.devicePixelRatio||1;this._canvas.width=Y*Math.ceil(Q),this._canvas.height=Y*Math.ceil(U),this._canvas.style.width=`${Q}px`,this._canvas.style.height=`${U}px`}_addMarker(Q){this._markers.push(Q)}_removeMarker(Q){const U=this._markers.indexOf(Q);U!==-1&&this._markers.splice(U,1)}_addPopup(Q){this._popups.push(Q)}_removePopup(Q){const U=this._popups.indexOf(Q);U!==-1&&this._popups.splice(U,1)}_setupPainter(){const Q=H.extend({},Ie.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),U=this._useWebGL2&&this._canvas.getContext("webgl2",Q),Y=U||this._canvas.getContext("webgl",Q)||this._canvas.getContext("experimental-webgl",Q);Y?(this._useWebGL2&&!U&&H.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),H.storeAuthState(Y,!0),this.painter=new ua(Y,this.transform,!!U),this.on("data",te=>{te.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),H.exported$1.testSupport(Y)):this.fire(new H.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(Q){Q.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new H.Event("webglcontextlost",{originalEvent:Q}))}_contextRestored(Q){this._setupPainter(),this.resize(),this._update(),this.fire(new H.Event("webglcontextrestored",{originalEvent:Q}))}_onMapScroll(Q){if(Q.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(Q){return this.style?(this._styleDirty=this._styleDirty||Q,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(Q){return this._update(),this._renderTaskQueue.add(Q)}_cancelRenderFrame(Q){this._renderTaskQueue.remove(Q)}_requestDomTask(Q){!this.loaded()||this.loaded()&&!this.isMoving()?Q():this._domRenderTaskQueue.add(Q)}_render(Q){let U;const Y=this.painter.context.extTimerQuery,te=H.exported.now();if(this.listens("gpu-timing-frame")&&(U=Y.createQueryEXT(),Y.beginQueryEXT(Y.TIME_ELAPSED_EXT,U)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],H.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],H.window.performance.now())),this._renderTaskQueue.run(Q),this._domRenderTaskQueue.run(Q),this._removed)return;this._updateProjectionTransition();const ne=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const fe=this.transform.zoom,de=this.transform.pitch,ve=H.exported.now(),ge=new H.EvaluationParameters(fe,{now:ve,fadeDuration:ne,pitch:de,transition:this.style.getTransition()});this.style.update(ge)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let ae=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),ae=this._updateAverageElevation(te),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):ae=this._updateAverageElevation(te),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,ne,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:ne,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new H.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new H.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),U){const fe=H.exported.now()-te;Y.endQueryEXT(Y.TIME_ELAPSED_EXT,U),setTimeout(()=>{const de=Y.getQueryObjectEXT(U,Y.QUERY_RESULT_EXT)/1e6;Y.deleteQueryEXT(U),this.fire(new H.Event("gpu-timing-frame",{cpuTime:fe,gpuTime:de})),H.window.performance.mark("frame-gpu",{startTime:te,detail:{gpuTime:de}})},50)}if(this.listens("gpu-timing-layer")){const fe=this.painter.collectGpuTimers();setTimeout(()=>{const de=this.painter.queryGpuTimers(fe);this.fire(new H.Event("gpu-timing-layer",{layerTimes:de}))},50)}if(this.listens("gpu-timing-deferred-render")){const fe=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const de=this.painter.queryGpuTimeDeferredRender(fe);this.fire(new H.Event("gpu-timing-deferred-render",{gpuTime:de}))},50)}const he=this._sourcesDirty||this._styleDirty||this._placementDirty||ae;if(he||this._repaint)this.triggerRepaint();else{const fe=!this.isMoving()&&this.loaded();if(fe&&(ae=this._updateAverageElevation(te,!0)),ae)this.triggerRepaint();else if(this._triggerFrame(!1),fe&&(this.fire(new H.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const de=this._calculateSpeedIndex();this.fire(new H.Event("speedindexcompleted",{speedIndex:de})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||he||(this._fullyLoaded=!0,H.LivePerformanceUtils.mark(H.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&H.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(Q){for(const U of this._markers)Q&&!this.getRenderWorldCopies()&&(U._lngLat=U._lngLat.wrap()),U._update();for(const U of this._popups)!Q||this.getRenderWorldCopies()||U._trackPointer||(U._lngLat=U._lngLat.wrap()),U._update()}_updateAverageElevation(Q,U=!1){const Y=te=>(this.transform.averageElevation=te,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&Y(0);if((U||Q-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(Q)){const te=this.transform.averageElevation;let ne=this.transform.sampleAverageElevation(),ae=!1;this.transform.elevation&&(ae=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(ne)?ne=0:this._averageElevationLastSampledAt=Q;const he=Math.abs(te-ne);if(he>1){if(this._isInitialLoad||ae)return this._averageElevation.jumpTo(ne),Y(ne);this._averageElevation.easeTo(ne,Q,300)}else if(he>1e-4)return this._averageElevation.jumpTo(ne),Y(ne)}return!!this._averageElevation.isEasing(Q)&&Y(this._averageElevation.getValue(Q))}_authenticate(){H.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,Q=>{if(Q&&(Q.message===H.AUTH_ERR_MSG||Q.status===401)){const U=this.painter.context.gl;H.storeAuthState(U,!1),this._logoControl instanceof nc&&this._logoControl._updateLogo(),U&&U.clear(U.DEPTH_BUFFER_BIT|U.COLOR_BUFFER_BIT|U.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new H.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),H.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const Q=this._isDragging();this.painter.updateTerrain(this.style,Q)}_calculateSpeedIndex(){const Q=this.painter.canvasCopy(),U=this.painter.getCanvasCopiesAndTimestamps();U.timeStamps.push(performance.now());const Y=this.painter.context.gl,te=Y.createFramebuffer();function ne(ae){Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,ae,0);const he=new Uint8Array(Y.drawingBufferWidth*Y.drawingBufferHeight*4);return Y.readPixels(0,0,Y.drawingBufferWidth,Y.drawingBufferHeight,Y.RGBA,Y.UNSIGNED_BYTE,he),he}return Y.bindFramebuffer(Y.FRAMEBUFFER,te),this._canvasPixelComparison(ne(Q),U.canvasCopies.map(ne),U.timeStamps)}_canvasPixelComparison(Q,U,Y){let te=Y[1]-Y[0];const ne=Q.length/4;for(let ae=0;ae<U.length;ae++){const he=U[ae];let fe=0;for(let de=0;de<he.length;de+=4)he[de]===Q[de]&&he[de+1]===Q[de+1]&&he[de+2]===Q[de+2]&&he[de+3]===Q[de+3]&&(fe+=1);te+=(Y[ae+2]-Y[ae+1])*(1-fe/ne)}return te}remove(){this._hash&&this._hash.remove();for(const U of this._controls)U.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),H.window!==void 0&&(H.window.removeEventListener("resize",this._onWindowResize,!1),H.window.removeEventListener("orientationchange",this._onWindowResize,!1),H.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),H.window.removeEventListener("online",this._onWindowOnline,!1),H.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const Q=this.painter.context.gl.getExtension("WEBGL_lose_context");Q&&Q.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),H.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new H.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(Q){this._renderNextFrame=this._renderNextFrame||Q,this.style&&!this._frame&&(this._frame=H.exported.frame(U=>{const Y=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,Y&&this._render(U)}))}_preloadTiles(Q){const U=this.style?Object.values(this.style._sourceCaches):[];return H.asyncAll(U,(Y,te)=>Y._preloadTiles(Q,te),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(Q){this._trackResize&&this.resize({originalEvent:Q})._update()}_onVisibilityChange(){H.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(Q){this._showTileBoundaries!==Q&&(this._showTileBoundaries=Q,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(Q){this._showTerrainWireframe!==Q&&(this._showTerrainWireframe=Q,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(Q){this._speedIndexTiming!==Q&&(this._speedIndexTiming=Q,this._update())}get showPadding(){return!!this._showPadding}set showPadding(Q){this._showPadding!==Q&&(this._showPadding=Q,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(Q){this._showCollisionBoxes!==Q&&(this._showCollisionBoxes=Q,Q?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(Q){this._showOverdrawInspector!==Q&&(this._showOverdrawInspector=Q,this._update())}get repaint(){return!!this._repaint}set repaint(Q){this._repaint!==Q&&(this._repaint=Q,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(Q){this._vertices=Q,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(Q){this._showTileAABBs!==Q&&(this._showTileAABBs=Q,Q&&this._update())}_setCacheLimits(Q,U){H.setCacheLimits(Q,U)}get version(){return H.version}},NavigationControl:class{constructor(Q){this.options=H.extend({},Fh,Q),this._container=je("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",U=>U.preventDefault()),this.options.showZoom&&(H.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",U=>{this._map&&this._map.zoomIn({},{originalEvent:U})}),je("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",U=>{this._map&&this._map.zoomOut({},{originalEvent:U})}),je("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(H.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",U=>{const Y=this._map;Y&&(this.options.visualizePitch?Y.resetNorthPitch({},{originalEvent:U}):Y.resetNorth({},{originalEvent:U}))}),this._compassIcon=je("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const Q=this._map;if(!Q)return;const U=Q.getZoom(),Y=U===Q.getMaxZoom(),te=U===Q.getMinZoom();this._zoomInButton.disabled=Y,this._zoomOutButton.disabled=te,this._zoomInButton.setAttribute("aria-disabled",Y.toString()),this._zoomOutButton.setAttribute("aria-disabled",te.toString())}_rotateCompassArrow(){const Q=this._map;if(!Q)return;const U=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(Q.transform.pitch*(Math.PI/180)),.5)}) rotateX(${Q.transform.pitch}deg) rotateZ(${Q.transform.angle*(180/Math.PI)}deg)`:`rotate(${Q.transform.angle*(180/Math.PI)}deg)`;Q._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=U)})}onAdd(Q){return this._map=Q,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),Q.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&Q.on("pitch",this._rotateCompassArrow),Q.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zh(Q,this._compass,this.options.visualizePitch)),this._container}onRemove(){const Q=this._map;Q&&(this._container.remove(),this.options.showZoom&&Q.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&Q.off("pitch",this._rotateCompassArrow),Q.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(Q,U){const Y=je("button",Q,this._container);return Y.type="button",Y.addEventListener("click",U),Y}_setButtonTitle(Q,U){if(!this._map)return;const Y=this._map._getUIString(`NavigationControl.${U}`);Q.setAttribute("aria-label",Y),Q.firstElementChild&&Q.firstElementChild.setAttribute("title",Y)}},GeolocateControl:class extends H.Evented{constructor(Q){super(),this.options=H.extend({geolocation:H.window.navigator.geolocation},lc,Q),H.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=pa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(Q){return this._map=Q,this._container=je("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(Q){const U=(Y=!!this.options.geolocation)=>{this._supportsGeolocation=Y,Q(Y)};this._supportsGeolocation!==void 0?Q(this._supportsGeolocation):H.window.navigator.permissions!==void 0?H.window.navigator.permissions.query({name:"geolocation"}).then(Y=>U(Y.state!=="denied")).catch(()=>U()):U()}_isOutOfMapMaxBounds(Q){const U=this._map.getMaxBounds(),Y=Q.coords;return!!U&&(Y.longitude<U.getWest()||Y.longitude>U.getEast()||Y.latitude<U.getSouth()||Y.latitude>U.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(Q){if(this._map){if(this._isOutOfMapMaxBounds(Q))return this._setErrorState(),this.fire(new H.Event("outofmaxbounds",Q)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=Q,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(Q),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(Q),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new H.Event("geolocate",Q)),this._finish()}}_updateCamera(Q){const U=new H.LngLat(Q.coords.longitude,Q.coords.latitude),Y=Q.coords.accuracy,te=this._map.getBearing(),ne=H.extend({bearing:te},this.options.fitBoundsOptions);this._map.fitBounds(U.toBounds(Y),ne,{geolocateSource:!0})}_updateMarker(Q){if(Q){const U=new H.LngLat(Q.coords.longitude,Q.coords.latitude);this._accuracyCircleMarker.setLngLat(U).addTo(this._map),this._userLocationDotMarker.setLngLat(U).addTo(this._map),this._accuracy=Q.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const Q=this._map.transform,U=H.mercatorZfromAltitude(1,Q._center.lat)*Q.worldSize,Y=Math.ceil(2*this._accuracy*U);this._circleElement.style.width=`${Y}px`,this._circleElement.style.height=`${Y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(Q){if(this._map){if(this.options.trackUserLocation)if(Q.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const U=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",U),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",U),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(Q.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new H.Event("error",Q)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(Q){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",U=>U.preventDefault()),this._geolocateButton=je("button","mapboxgl-ctrl-geolocate",this._container),je("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",Q===!1){H.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const U=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",U),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",U)}else{const U=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",U),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",U)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=je("div","mapboxgl-user-location"),this._dotElement.appendChild(je("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(je("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Jt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=je("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",U=>{U.geolocateSource||this._watchState!=="ACTIVE_LOCK"||U.originalEvent&&U.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new H.Event("trackuserlocationend")))})}}_onDeviceOrientation(Q){this._userLocationDotMarker&&(Q.webkitCompassHeading?this._heading=Q.webkitCompassHeading:Q.absolute===!0&&(this._heading=-1*Q.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return H.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new H.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new H.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new H.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let Q;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(Q={maximumAge:6e5,timeout:0},this._noTimeout=!0):(Q=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,Q),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const Q=()=>{H.window.addEventListener("ondeviceorientationabsolute"in H.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};H.window.DeviceMotionEvent!==void 0&&typeof H.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(U=>{U==="granted"&&Q()}).catch(console.error):Q()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),H.window.removeEventListener("deviceorientation",this._onDeviceOrientation),H.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:tr,ScaleControl:class{constructor(Q){this.options=H.extend({},cc,Q),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),H.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const Q=this.options.maxWidth||100,U=this._map,Y=U._containerHeight/2,te=U._containerWidth/2-Q/2,ne=U.unproject([te,Y]),ae=U.unproject([te+Q,Y]),he=ne.distanceTo(ae);if(this.options.unit==="imperial"){const fe=3.2808*he;fe>5280?this._setScale(Q,fe/5280,"mile"):this._setScale(Q,fe,"foot")}else this.options.unit==="nautical"?this._setScale(Q,he/1852,"nautical-mile"):he>=1e3?this._setScale(Q,he/1e3,"kilometer"):this._setScale(Q,he,"meter")}_setScale(Q,U,Y){this._map._requestDomTask(()=>{const te=function(ae){const he=Math.pow(10,`${Math.floor(ae)}`.length-1);let fe=ae/he;return fe=fe>=10?10:fe>=5?5:fe>=3?3:fe>=2?2:fe>=1?1:function(de){const ve=Math.pow(10,Math.ceil(-Math.log(de)/Math.LN10));return Math.round(de*ve)/ve}(fe),he*fe}(U),ne=te/U;this._container.innerHTML=this._isNumberFormatSupported&&Y!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:Y}).format(te):`${te}&nbsp;${uc[Y]}`,this._container.style.width=Q*ne+"px"})}onAdd(Q){return this._map=Q,this._language=Q.getLanguage(),this._container=je("div","mapboxgl-ctrl mapboxgl-ctrl-scale",Q.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(Q){this._language=Q,this._update()}setUnit(Q){this.options.unit=Q,this._update()}},FullscreenControl:class{constructor(Q){this._fullscreen=!1,Q&&Q.container&&(Q.container instanceof H.window.HTMLElement?this._container=Q.container:H.warnOnce("Full screen control 'container' must be a DOM element.")),H.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in H.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in H.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(Q){return this._map=Q,this._container||(this._container=this._map.getContainer()),this._controlContainer=je("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",H.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,H.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!H.window.document.fullscreenEnabled&&!H.window.document.webkitFullscreenEnabled)}_setupUI(){const Q=this._fullscreenButton=je("button","mapboxgl-ctrl-fullscreen",this._controlContainer);je("span","mapboxgl-ctrl-icon",Q).setAttribute("aria-hidden","true"),Q.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),H.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const Q=this._getTitle();this._fullscreenButton.setAttribute("aria-label",Q),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",Q)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(H.window.document.fullscreenElement||H.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?H.window.document.exitFullscreen?H.window.document.exitFullscreen():H.window.document.webkitCancelFullScreen&&H.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends H.Evented{constructor(Q){super(),this.options=H.extend(Object.create(ac),Q),H.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(Q&&Q.className?Q.className.trim().split(/\s+/):[])}addTo(Q){return this._map&&this.remove(),this._map=Q,this.options.closeOnClick&&Q.on("preclick",this._onClose),this.options.closeOnMove&&Q.on("move",this._onClose),Q.on("remove",this.remove),this._update(),Q._addPopup(this),this._focusFirstElement(),this._trackPointer?(Q.on("mousemove",this._onMouseEvent),Q.on("mouseup",this._onMouseEvent),Q._canvasContainer.classList.add("mapboxgl-track-pointer")):Q.on("move",this._update),this.fire(new H.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const Q=this._map;return Q&&(Q.off("move",this._update),Q.off("move",this._onClose),Q.off("preclick",this._onClose),Q.off("click",this._onClose),Q.off("remove",this.remove),Q.off("mousemove",this._onMouseEvent),Q.off("mouseup",this._onMouseEvent),Q.off("drag",this._onMouseEvent),Q._canvasContainer&&Q._canvasContainer.classList.remove("mapboxgl-track-pointer"),Q._removePopup(this),this._map=void 0),this.fire(new H.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(Q){this._lngLat=H.LngLat.convert(Q),this._pos=null,this._trackPointer=!1,this._update();const U=this._map;return U&&(U.on("move",this._update),U.off("mousemove",this._onMouseEvent),U._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const Q=this._map;return Q&&(Q.off("move",this._update),Q.on("mousemove",this._onMouseEvent),Q.on("drag",this._onMouseEvent),Q._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(Q){return this.setDOMContent(H.window.document.createTextNode(Q))}setHTML(Q){const U=H.window.document.createDocumentFragment(),Y=H.window.document.createElement("body");let te;for(Y.innerHTML=Q;te=Y.firstChild,te;)U.appendChild(te);return this.setDOMContent(U)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(Q){return this.options.maxWidth=Q,this._update(),this}setDOMContent(Q){let U=this._content;if(U)for(;U.hasChildNodes();)U.firstChild&&U.removeChild(U.firstChild);else U=this._content=je("div","mapboxgl-popup-content",this._container||void 0);if(U.appendChild(Q),this.options.closeButton){const Y=this._closeButton=je("button","mapboxgl-popup-close-button",U);Y.type="button",Y.setAttribute("aria-label","Close popup"),Y.setAttribute("aria-hidden","true"),Y.innerHTML="&#215;",Y.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(Q){return this._classList.add(Q),this._updateClassList(),this}removeClassName(Q){return this._classList.delete(Q),this._updateClassList(),this}setOffset(Q){return this.options.offset=Q,this._update(),this}toggleClassName(Q){let U;return this._classList.delete(Q)?U=!1:(this._classList.add(Q),U=!0),this._updateClassList(),U}_onMouseEvent(Q){this._update(Q.point)}_getAnchor(Q){if(this.options.anchor)return this.options.anchor;const U=this._map,Y=this._container,te=this._pos;if(!U||!Y||!te)return"bottom";const ne=Y.offsetWidth,ae=Y.offsetHeight,he=te.x<ne/2,fe=te.x>U.transform.width-ne/2;if(te.y+Q<ae)return he?"top-left":fe?"top-right":"top";if(te.y>U.transform.height-ae){if(he)return"bottom-left";if(fe)return"bottom-right"}return he?"left":fe?"right":"bottom"}_updateClassList(){const Q=this._container;if(!Q)return;const U=[...this._classList];U.push("mapboxgl-popup"),this._anchor&&U.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&U.push("mapboxgl-popup-track-pointer"),Q.className=U.join(" ")}_update(Q){const U=this._map,Y=this._content;if(!U||!this._lngLat&&!this._trackPointer||!Y)return;let te=this._container;if(te||(te=this._container=je("div","mapboxgl-popup",U.getContainer()),this._tip=je("div","mapboxgl-popup-tip",te),te.appendChild(Y)),this.options.maxWidth&&te.style.maxWidth!==this.options.maxWidth&&(te.style.maxWidth=this.options.maxWidth),U.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ya(this._lngLat,this._pos,U.transform)),!this._trackPointer||Q){const ne=this._pos=this._trackPointer&&Q?Q:U.project(this._lngLat),ae=Pu(this.options.offset),he=this._anchor=this._getAnchor(ae.y),fe=Pu(this.options.offset,he),de=ne.add(fe).round();U._requestDomTask(()=>{this._container&&he&&(this._container.style.transform=`${Uo[he]} translate(${de.x}px,${de.y}px)`)})}if(!this._marker&&U._showingGlobe()){const ne=H.isLngLatBehindGlobe(U.transform,this._lngLat)?0:1;this._setOpacity(ne)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const Q=this._container.querySelector(Nh);Q&&Q.focus()}_onClose(){this.remove()}_setOpacity(Q){this._container&&(this._container.style.opacity=`${Q}`),this._content&&(this._content.style.pointerEvents=Q?"auto":"none")}},Marker:Jt,Style:Wn,LngLat:H.LngLat,LngLatBounds:H.LngLatBounds,Point:H.Point,MercatorCoordinate:H.MercatorCoordinate,FreeCameraOptions:yu,Evented:H.Evented,config:H.config,prewarm:function(){Qo().acquire(jn)},clearPrewarmedResources:function(){const Q=ln;Q&&(Q.isPreloaded()&&Q.numActive()===1?(Q.release(jn),ln=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return H.config.ACCESS_TOKEN},set accessToken(Q){H.config.ACCESS_TOKEN=Q},get baseApiUrl(){return H.config.API_URL},set baseApiUrl(Q){H.config.API_URL=Q},get workerCount(){return zi.workerCount},set workerCount(Q){zi.workerCount=Q},get maxParallelImageRequests(){return H.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(Q){H.config.MAX_PARALLEL_IMAGE_REQUESTS=Q},clearStorage(Q){H.clearTileCache(Q)},workerUrl:"",workerClass:null,setNow:H.exported.setNow,restoreNow:H.exported.restoreNow};return _a});var ue=re;return ue})})(mapboxGl);var mapboxGlExports=mapboxGl.exports;const mapboxgl=getDefaultExportFromCjs(mapboxGlExports),TRIP_SHAPE_ARROW_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABkCAMAAAAmJEckAAAAnFBMVEUAAAAA//+AgP9Vqv9JtttAr+9HqvFJqudDpulHo+tFp+tHqupFpepBpu1EquhFp+tDqu1EqelFqepFp+xEqOtFqetEqOxDqOxDp+pEp+tEp+tFqexEqOpEqOxEqOtEqOxEqOtEqOtEqOtEqOtEqOtDqOxEqOtEqOtEqOtEqOtEqOtEqOtEqOtEqOtEqOtEqOtEqOtEqOtEqOv///+CAFIPAAAAMnRSTlMAAQIGBxASFRcZGiQlKy00OUdKXWZoaWpudICRk6qzuLzLzNHb3+Hi5Ofo6vL29/n7/gX8zyAAAAABYktHRDM31XxeAAABlElEQVRYw+2ZWVICQRBEQWVwFBVEodVW3FHEhbz/4fxVp7eqSmL8mDzAiyDm0V2V3et16WJMNTsfMHmjJbCaEHkvALC52qXyANyPuDxgPeXyAFybv021xK88nhiBc/zJ50XfBJyhkcW+BThYNYk2JSebJtGmpEcgFiX3HkLE9ZmeePQeIlqUdEEgnsZaYP8mTPy63FESh69hIm4PiO4AAN5Ome5YlAy7Y1Ey4o5BSYd4VErG3NErGXVHrWTUHbWSPgXUKJlwR6lkwh2lki4NlCuZdEelZNIdlZJpdzRKemQjUzLjjkLJnDtyJR0KIlEy745Uybw7UiXz7kiV9EVAgZIl7siUPP4oJD5XTHcAYN4SkP2Tyz9K3Y42bLHZf73Cw2Ha2vHFPmDpV4DnybeVa5R90dNHEceTbyvjHH3gZI/EmaG9lvLYawV98WGvZqnlUVOx0ddb9gLOrgjiJUat4tFrFnYRxK6qImWavt9l133sQpJemdJLXXrtTC/G6dU9/3HhB/Hu8J8+0PCfkPiPXF26lOUbWqrC+sGueMcAAAAASUVORK5CYII=",VEHICLE_POINT_COLOR=["case",["!=",["get","delay"],null],["interpolate",["linear"],["get","delay"],0,["to-color","#2ecc71"],90,["to-color","#eebb00"],210,["to-color","#ee2200"]],"#e0e0e0"],FOCUSED_TRIP_SHAPE_OPACITY={base:.3,stops:[[9,.3],[15,.8]]};mapboxgl.accessToken="pk.eyJ1IjoiZGVyaHVlcnN0IiwiYSI6ImNrajRuNnB3cjVyMWEycXFqMmh4dWUxZjMifQ.VVjBdXpzJVGbGc4u2n8Fog";setTimeout(()=>{mapboxgl.prewarm()},100);class MapView extends b{constructor(){super(),this.ref=_()}updateVehiclePositions(){const{feedData:W}=this.props.state,V=(W.entity||[]).filter(ue=>ue.vehicle&&ue.vehicle.position);if(V.length===0)return;const Z=this.map.getSource("vehicle-positions");if(!Z)return;Z.setData({type:"FeatureCollection",features:V.map(ue=>{var H,ye;return{type:"Feature",properties:{vehicleId:(H=ue.vehicle.vehicle)==null?void 0:H.id,trip_id:(ye=ue.vehicle.trip)==null?void 0:ye.trip_id,delay:ue.vehicle.delay},geometry:{type:"Point",coordinates:[ue.vehicle.position.longitude,ue.vehicle.position.latitude]}}})});const re=[V[0].vehicle.position.longitude,V[0].vehicle.position.latitude],se=new mapboxgl.LngLatBounds(re,re);for(const ue of V)se.extend([ue.vehicle.position.longitude,ue.vehicle.position.latitude]);this.map.fitBounds(se,{padding:50})}updateFocusedTripShape(){const{focusedTripShape:W}=this.props.state,X=this.map.getSource("focused-trip-shape");X&&(W===null?X.setData({type:"FeatureCollection",features:[]}):X.setData(W))}updateFocusedVehiclePosition(){const{focusedVehiclePosition:W}=this.props.state,X=this.map.getSource("focused-vehicle-position");X&&(W===null?X.setData({type:"FeatureCollection",features:[]}):X.setData(W))}updateMap(){this.map&&(this.updateVehiclePositions(),this.updateFocusedTripShape(),this.updateFocusedVehiclePosition())}componentDidMount(){const{emit:W}=this.props;this.map=new mapboxgl.Map({container:this.ref.current,style:"mapbox://styles/mapbox/dark-v10",center:[-74.5,40],zoom:9}),this.map.once("load",()=>{this.map.addSource("vehicle-positions",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"vehicle-positions",source:"vehicle-positions",type:"circle",paint:{"circle-radius":{base:1.5,stops:[[1,1],[20,35]]},"circle-color":VEHICLE_POINT_COLOR}}),this.map.on("mouseenter","vehicle-positions",()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave","vehicle-positions",()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click","vehicle-positions",V=>{var se,ue;const Z=((se=V.features[0])==null?void 0:se.properties.vehicleId)||null;W("focus-vehicle-id",Z);const re=((ue=V.features[0])==null?void 0:ue.properties.trip_id)||null;W("focus-trip-id",re)}),this.map.addSource("focused-trip-shape",{type:"geojson",data:null}),this.map.addLayer({id:"focused-trip-shape",source:"focused-trip-shape",type:"line",paint:{"line-width":{base:1,stops:[[1,.6],[20,4]]},"line-color":"#44a8eb","line-opacity":FOCUSED_TRIP_SHAPE_OPACITY}});const X=this.map;X.loadImage(TRIP_SHAPE_ARROW_URL,(V,Z)=>{if(V){console.error("failed to load trip shape arrow",V);return}X.addImage("focused-trip-shape-arrow",Z),X.addLayer({id:"focused-trip-shape-arrows",type:"symbol",source:"focused-trip-shape",paint:{"icon-opacity":FOCUSED_TRIP_SHAPE_OPACITY},layout:{"symbol-placement":"line","icon-ignore-placement":!0,"icon-image":"focused-trip-shape-arrow","icon-size":.15}})}),this.map.addSource("focused-vehicle-position",{type:"geojson",data:null}),this.map.addLayer({id:"focused-vehicle-position",source:"focused-vehicle-position",type:"circle",paint:{"circle-radius":{base:5,stops:[[1,5],[20,100]]},"circle-color":VEHICLE_POINT_COLOR}}),this.updateMap()})}componentDidUpdate(){this.updateMap()}componentWillUnmount(){this.map&&(this.map.remove(),this.map=null)}render(){return u("div",{class:"map",ref:this.ref})}}const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);var hasMap=typeof Map=="function"&&Map.prototype,mapSizeDescriptor=Object.getOwnPropertyDescriptor&&hasMap?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,mapSize=hasMap&&mapSizeDescriptor&&typeof mapSizeDescriptor.get=="function"?mapSizeDescriptor.get:null,mapForEach=hasMap&&Map.prototype.forEach,hasSet=typeof Set=="function"&&Set.prototype,setSizeDescriptor=Object.getOwnPropertyDescriptor&&hasSet?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,setSize=hasSet&&setSizeDescriptor&&typeof setSizeDescriptor.get=="function"?setSizeDescriptor.get:null,setForEach=hasSet&&Set.prototype.forEach,hasWeakMap=typeof WeakMap=="function"&&WeakMap.prototype,weakMapHas=hasWeakMap?WeakMap.prototype.has:null,hasWeakSet=typeof WeakSet=="function"&&WeakSet.prototype,weakSetHas=hasWeakSet?WeakSet.prototype.has:null,hasWeakRef=typeof WeakRef=="function"&&WeakRef.prototype,weakRefDeref=hasWeakRef?WeakRef.prototype.deref:null,booleanValueOf=Boolean.prototype.valueOf,objectToString=Object.prototype.toString,functionToString=Function.prototype.toString,$match=String.prototype.match,$slice=String.prototype.slice,$replace=String.prototype.replace,$toUpperCase=String.prototype.toUpperCase,$toLowerCase=String.prototype.toLowerCase,$test=RegExp.prototype.test,$concat=Array.prototype.concat,$join=Array.prototype.join,$arrSlice=Array.prototype.slice,$floor=Math.floor,bigIntValueOf=typeof BigInt=="function"?BigInt.prototype.valueOf:null,gOPS=Object.getOwnPropertySymbols,symToString=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,hasShammedSymbols=typeof Symbol=="function"&&typeof Symbol.iterator=="object",toStringTag=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===hasShammedSymbols||!0)?Symbol.toStringTag:null,isEnumerable=Object.prototype.propertyIsEnumerable,gPO=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(G){return G.__proto__}:null);function addNumericSeparator(G,W){if(G===1/0||G===-1/0||G!==G||G&&G>-1e3&&G<1e3||$test.call(/e/,W))return W;var X=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof G=="number"){var V=G<0?-$floor(-G):$floor(G);if(V!==G){var Z=String(V),re=$slice.call(W,Z.length+1);return $replace.call(Z,X,"$&_")+"."+$replace.call($replace.call(re,/([0-9]{3})/g,"$&_"),/_$/,"")}}return $replace.call(W,X,"$&_")}var utilInspect=require$$0,inspectCustom=utilInspect.custom,inspectSymbol=isSymbol(inspectCustom)?inspectCustom:null,objectInspect=function G(W,X,V,Z){var re=X||{};if(has(re,"quoteStyle")&&re.quoteStyle!=="single"&&re.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(has(re,"maxStringLength")&&(typeof re.maxStringLength=="number"?re.maxStringLength<0&&re.maxStringLength!==1/0:re.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var se=has(re,"customInspect")?re.customInspect:!0;if(typeof se!="boolean"&&se!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(has(re,"indent")&&re.indent!==null&&re.indent!=="	"&&!(parseInt(re.indent,10)===re.indent&&re.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(has(re,"numericSeparator")&&typeof re.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var ue=re.numericSeparator;if(typeof W>"u")return"undefined";if(W===null)return"null";if(typeof W=="boolean")return W?"true":"false";if(typeof W=="string")return inspectString(W,re);if(typeof W=="number"){if(W===0)return 1/0/W>0?"0":"-0";var H=String(W);return ue?addNumericSeparator(W,H):H}if(typeof W=="bigint"){var ye=String(W)+"n";return ue?addNumericSeparator(W,ye):ye}var Ie=typeof re.depth>"u"?5:re.depth;if(typeof V>"u"&&(V=0),V>=Ie&&Ie>0&&typeof W=="object")return isArray(W)?"[Array]":"[Object]";var Ee=getIndent(re,V);if(typeof Z>"u")Z=[];else if(indexOf(Z,W)>=0)return"[Circular]";function Fe(dr,kr,un){if(kr&&(Z=$arrSlice.call(Z),Z.push(kr)),un){var qi={depth:re.depth};return has(re,"quoteStyle")&&(qi.quoteStyle=re.quoteStyle),G(dr,qi,V+1,Z)}return G(dr,re,V+1,Z)}if(typeof W=="function"&&!isRegExp(W)){var je=nameOf(W),mt=arrObjKeys(W,Fe);return"[Function"+(je?": "+je:" (anonymous)")+"]"+(mt.length>0?" { "+$join.call(mt,", ")+" }":"")}if(isSymbol(W)){var wt=hasShammedSymbols?$replace.call(String(W),/^(Symbol\(.*\))_[^)]*$/,"$1"):symToString.call(W);return typeof W=="object"&&!hasShammedSymbols?markBoxed(wt):wt}if(isElement(W)){for(var Ot="<"+$toLowerCase.call(String(W.nodeName)),$t=W.attributes||[],jt=0;jt<$t.length;jt++)Ot+=" "+$t[jt].name+"="+wrapQuotes(quote($t[jt].value),"double",re);return Ot+=">",W.childNodes&&W.childNodes.length&&(Ot+="..."),Ot+="</"+$toLowerCase.call(String(W.nodeName))+">",Ot}if(isArray(W)){if(W.length===0)return"[]";var nr=arrObjKeys(W,Fe);return Ee&&!singleLineValues(nr)?"["+indentedJoin(nr,Ee)+"]":"[ "+$join.call(nr,", ")+" ]"}if(isError(W)){var sr=arrObjKeys(W,Fe);return!("cause"in Error.prototype)&&"cause"in W&&!isEnumerable.call(W,"cause")?"{ ["+String(W)+"] "+$join.call($concat.call("[cause]: "+Fe(W.cause),sr),", ")+" }":sr.length===0?"["+String(W)+"]":"{ ["+String(W)+"] "+$join.call(sr,", ")+" }"}if(typeof W=="object"&&se){if(inspectSymbol&&typeof W[inspectSymbol]=="function"&&utilInspect)return utilInspect(W,{depth:Ie-V});if(se!=="symbol"&&typeof W.inspect=="function")return W.inspect()}if(isMap(W)){var gr=[];return mapForEach&&mapForEach.call(W,function(dr,kr){gr.push(Fe(kr,W,!0)+" => "+Fe(dr,W))}),collectionOf("Map",mapSize.call(W),gr,Ee)}if(isSet(W)){var hr=[];return setForEach&&setForEach.call(W,function(dr){hr.push(Fe(dr,W))}),collectionOf("Set",setSize.call(W),hr,Ee)}if(isWeakMap(W))return weakCollectionOf("WeakMap");if(isWeakSet(W))return weakCollectionOf("WeakSet");if(isWeakRef(W))return weakCollectionOf("WeakRef");if(isNumber(W))return markBoxed(Fe(Number(W)));if(isBigInt(W))return markBoxed(Fe(bigIntValueOf.call(W)));if(isBoolean(W))return markBoxed(booleanValueOf.call(W));if(isString(W))return markBoxed(Fe(String(W)));if(typeof window<"u"&&W===window)return"{ [object Window] }";if(W===commonjsGlobal)return"{ [object globalThis] }";if(!isDate(W)&&!isRegExp(W)){var Ir=arrObjKeys(W,Fe),br=gPO?gPO(W)===Object.prototype:W instanceof Object||W.constructor===Object,yr=W instanceof Object?"":"null prototype",zt=!br&&toStringTag&&Object(W)===W&&toStringTag in W?$slice.call(toStr(W),8,-1):yr?"Object":"",gi=br||typeof W.constructor!="function"?"":W.constructor.name?W.constructor.name+" ":"",Ti=gi+(zt||yr?"["+$join.call($concat.call([],zt||[],yr||[]),": ")+"] ":"");return Ir.length===0?Ti+"{}":Ee?Ti+"{"+indentedJoin(Ir,Ee)+"}":Ti+"{ "+$join.call(Ir,", ")+" }"}return String(W)};function wrapQuotes(G,W,X){var V=(X.quoteStyle||W)==="double"?'"':"'";return V+G+V}function quote(G){return $replace.call(String(G),/"/g,"&quot;")}function isArray(G){return toStr(G)==="[object Array]"&&(!toStringTag||!(typeof G=="object"&&toStringTag in G))}function isDate(G){return toStr(G)==="[object Date]"&&(!toStringTag||!(typeof G=="object"&&toStringTag in G))}function isRegExp(G){return toStr(G)==="[object RegExp]"&&(!toStringTag||!(typeof G=="object"&&toStringTag in G))}function isError(G){return toStr(G)==="[object Error]"&&(!toStringTag||!(typeof G=="object"&&toStringTag in G))}function isString(G){return toStr(G)==="[object String]"&&(!toStringTag||!(typeof G=="object"&&toStringTag in G))}function isNumber(G){return toStr(G)==="[object Number]"&&(!toStringTag||!(typeof G=="object"&&toStringTag in G))}function isBoolean(G){return toStr(G)==="[object Boolean]"&&(!toStringTag||!(typeof G=="object"&&toStringTag in G))}function isSymbol(G){if(hasShammedSymbols)return G&&typeof G=="object"&&G instanceof Symbol;if(typeof G=="symbol")return!0;if(!G||typeof G!="object"||!symToString)return!1;try{return symToString.call(G),!0}catch{}return!1}function isBigInt(G){if(!G||typeof G!="object"||!bigIntValueOf)return!1;try{return bigIntValueOf.call(G),!0}catch{}return!1}var hasOwn=Object.prototype.hasOwnProperty||function(G){return G in this};function has(G,W){return hasOwn.call(G,W)}function toStr(G){return objectToString.call(G)}function nameOf(G){if(G.name)return G.name;var W=$match.call(functionToString.call(G),/^function\s*([\w$]+)/);return W?W[1]:null}function indexOf(G,W){if(G.indexOf)return G.indexOf(W);for(var X=0,V=G.length;X<V;X++)if(G[X]===W)return X;return-1}function isMap(G){if(!mapSize||!G||typeof G!="object")return!1;try{mapSize.call(G);try{setSize.call(G)}catch{return!0}return G instanceof Map}catch{}return!1}function isWeakMap(G){if(!weakMapHas||!G||typeof G!="object")return!1;try{weakMapHas.call(G,weakMapHas);try{weakSetHas.call(G,weakSetHas)}catch{return!0}return G instanceof WeakMap}catch{}return!1}function isWeakRef(G){if(!weakRefDeref||!G||typeof G!="object")return!1;try{return weakRefDeref.call(G),!0}catch{}return!1}function isSet(G){if(!setSize||!G||typeof G!="object")return!1;try{setSize.call(G);try{mapSize.call(G)}catch{return!0}return G instanceof Set}catch{}return!1}function isWeakSet(G){if(!weakSetHas||!G||typeof G!="object")return!1;try{weakSetHas.call(G,weakSetHas);try{weakMapHas.call(G,weakMapHas)}catch{return!0}return G instanceof WeakSet}catch{}return!1}function isElement(G){return!G||typeof G!="object"?!1:typeof HTMLElement<"u"&&G instanceof HTMLElement?!0:typeof G.nodeName=="string"&&typeof G.getAttribute=="function"}function inspectString(G,W){if(G.length>W.maxStringLength){var X=G.length-W.maxStringLength,V="... "+X+" more character"+(X>1?"s":"");return inspectString($slice.call(G,0,W.maxStringLength),W)+V}var Z=$replace.call($replace.call(G,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,lowbyte);return wrapQuotes(Z,"single",W)}function lowbyte(G){var W=G.charCodeAt(0),X={8:"b",9:"t",10:"n",12:"f",13:"r"}[W];return X?"\\"+X:"\\x"+(W<16?"0":"")+$toUpperCase.call(W.toString(16))}function markBoxed(G){return"Object("+G+")"}function weakCollectionOf(G){return G+" { ? }"}function collectionOf(G,W,X,V){var Z=V?indentedJoin(X,V):$join.call(X,", ");return G+" ("+W+") {"+Z+"}"}function singleLineValues(G){for(var W=0;W<G.length;W++)if(indexOf(G[W],`
`)>=0)return!1;return!0}function getIndent(G,W){var X;if(G.indent==="	")X="	";else if(typeof G.indent=="number"&&G.indent>0)X=$join.call(Array(G.indent+1)," ");else return null;return{base:X,prev:$join.call(Array(W+1),X)}}function indentedJoin(G,W){if(G.length===0)return"";var X=`
`+W.prev+W.base;return X+$join.call(G,","+X)+`
`+W.prev}function arrObjKeys(G,W){var X=isArray(G),V=[];if(X){V.length=G.length;for(var Z=0;Z<G.length;Z++)V[Z]=has(G,Z)?W(G[Z],G):""}var re=typeof gOPS=="function"?gOPS(G):[],se;if(hasShammedSymbols){se={};for(var ue=0;ue<re.length;ue++)se["$"+re[ue]]=re[ue]}for(var H in G)has(G,H)&&(X&&String(Number(H))===H&&H<G.length||hasShammedSymbols&&se["$"+H]instanceof Symbol||($test.call(/[^\w$]/,H)?V.push(W(H,G)+": "+W(G[H],G)):V.push(H+": "+W(G[H],G))));if(typeof gOPS=="function")for(var ye=0;ye<re.length;ye++)isEnumerable.call(G,re[ye])&&V.push("["+W(re[ye])+"]: "+W(G[re[ye]],G));return V}const inspect=getDefaultExportFromCjs(objectInspect),errorView=({state:G,emit:W})=>{const X=G.feedError,V=("	"+X.stack.replace(/\n/g,`	
`)).trim();return u("div",{class:"error",children:[u("h2",{children:u("code",{children:"failed to fetch the feed"})}),u("pre",{children:u("code",{children:inspect(X)+`
`+V})})]})},mainView=({state:G,emit:W})=>{const X={log:logView,inspector:inspectorView,map:MapView}[G.view]||inspectorView;return u("div",{class:"app",children:[u(barView,{state:G,emit:W}),u("div",{class:"view",children:G.feedData?u(X,{state:G,emit:W}):G.feedError?u(errorView,{state:G,emit:W}):null})]})},state={},bus=new EventEmitter$3;bus.STATE_CHANGE=Symbol("state change");const emit=bus.emit.bind(bus);viewStore(state,bus);feedStore(state,bus);feedLogStore(state,bus);focusStore(state,bus);urlStore(state,bus);const rerender=()=>{B(u(mainView,{state,emit}),document.body)};bus.on(bus.STATE_CHANGE,rerender);rerender();
